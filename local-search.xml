<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title></title>
    <link href="/article/0.html"/>
    <url>/article/0.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>n8nçŸ¥è¯†ç‚¹æ€»ç»“</title>
    <link href="/article/31bb5e7c.html"/>
    <url>/article/31bb5e7c.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /><h5 id=""><a href="#" class="headerlink" title=""></a></h5><p>1.n8næµç¨‹è¡¨è¾¾å¼èƒ½è¯»å–ç³»ç»Ÿç¯å¢ƒå˜é‡å—</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">æ˜¯çš„ï¼Œn8n æµç¨‹è¡¨è¾¾å¼ï¼ˆExpressionsï¼‰å¯ä»¥è¯»å–ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚æ‚¨å¯ä»¥åœ¨è¡¨è¾¾å¼æˆ–ä»£ç ä¸­é€šè¿‡å†…ç½®å˜é‡è®¿é—®ç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¯»å–ç¯å¢ƒå˜é‡ï¼š<br><br>- ç”¨è¡¨è¾¾å¼æ¥è¯´ï¼š`&#123;&#123;<span class="hljs-variable">$env</span>.YOUR_ENV_VARIABLE&#125;&#125;`<br>    <br>- åœ¨ä»£ç èŠ‚ç‚¹ä¸­ï¼š`<span class="hljs-variable">$env</span>.YOUR_ENV_VARIABLE`<br>    <br><br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡è®¾ç½®`N8N_BLOCK_ENV_ACCESS_IN_NODE`ç¯å¢ƒå˜é‡æ¥åœ¨è¡¨è¾¾å¼å’Œä»£ç èŠ‚ç‚¹ä¸­è®¿é—®ç¯å¢ƒå˜é‡ã€‚å¦‚æœè¯¥å˜é‡è®¾ç½®ä¸º`true`ï¼Œåˆ™æ— æ³•åœ¨è¡¨è¾¾å¼å’Œä»£ç èŠ‚ç‚¹ä¸­è®¿é—®[ç¯å¢ƒå˜é‡å®‰å…¨ç¯å¢ƒå˜é‡](https:<span class="hljs-regexp">//</span>docs.n8n.io<span class="hljs-regexp">/hosting/</span>configuration<span class="hljs-regexp">/environment-variables/</span>security/<span class="hljs-comment">#security-environment-variables)ã€‚</span><br><br></code></pre></td></tr></table></figure><p>2.ä¸ºä»€ä¹ˆæˆ‘åœ¨ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®äº†exportç¯å¢ƒå˜é‡ï¼Œåœ¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¯»å–ä¸åˆ°å‘¢</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino">åœ¨n8nä¸­ï¼ŒèŠ‚ç‚¹ä¹‹é—´å¹¶ä¸ä¼šå…±äº«ä½ åœ¨æŸä¸ªèŠ‚ç‚¹ä¸­é€šè¿‡<span class="hljs-keyword">export</span>æˆ–setå‘½ä»¤è®¾ç½®çš„ç¯å¢ƒå˜é‡ã€‚n8nçš„ç¯å¢ƒå˜é‡æ˜¯åœ¨å¯åŠ¨n8næœåŠ¡æ—¶ç”±ç½‘ç»œä¼ é€’ç»™æ•´ä¸ªn8nè¿›ç¨‹çš„ï¼Œè€Œä¸æ˜¯åœ¨å•ä¸ªèŠ‚ç‚¹æ‰§è¡Œæ—¶åŠ¨æ€è®¾ç½®å’Œä¼ é€’çš„ã€‚<br><br>ä¹Ÿå°±æ˜¯è¯´ï¼š<br><br>- ä½ éœ€è¦åœ¨å¯åŠ¨ n8n æœåŠ¡ï¼ˆæ¯”å¦‚ docker runã€docker-composeã€æˆ–è€…ç›´æ¥åœ¨ shell å¯åŠ¨ n8n å‰ï¼‰å°±è®¾ç½®å¥½ç¯å¢ƒå˜é‡ï¼Œè¿™æ · n8n çš„æ‰€æœ‰èŠ‚ç‚¹æ‰èƒ½è¯»å–åˆ°è¿™äº›å˜é‡ã€‚<br>    <br>- åœ¨æŸä¸ªèŠ‚ç‚¹ï¼ˆæ¯”å¦‚æ‰§è¡Œå‘½ä»¤æˆ–ä»£ç èŠ‚ç‚¹ï¼‰é‡Œç”¨å¯¼å‡ºè®¾ç½®çš„ç¯å¢ƒå˜é‡ï¼Œåªåœ¨è¯¥èŠ‚ç‚¹çš„å­è¿›ç¨‹æˆ–å½“å‰è„šæœ¬ä¸­æœ‰æ•ˆï¼Œä¸ä¼šå½±å“n8nè¿›ç¨‹æœ¬èº«ï¼Œä¹Ÿä¸ä¼šè¢«å…¶ä»–èŠ‚ç‚¹è¯»å–åˆ°ã€‚<br></code></pre></td></tr></table></figure><p>3.n8n $varå®šä¹‰çš„ç¯å¢ƒå˜é‡æ€ä¹ˆä¿®æ”¹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">n8n</span> ä¸­é€šè¿‡ <span class="hljs-variable">$vars</span> å®šä¹‰çš„ç¯å¢ƒå˜é‡ï¼ˆå³è‡ªå®šä¹‰å˜é‡ï¼‰æ˜¯å¯ä»¥ä¿®æ”¹**çš„**ï¼Œä¸èƒ½åœ¨å·¥ä½œæµæˆ–ä»£ç èŠ‚ç‚¹ä¸­ç›´æ¥ä¿®æ”¹ã€‚ä½ åªèƒ½é€šè¿‡ n8n çš„ UIï¼ˆç•Œé¢ï¼‰è¿›è¡Œæ·»åŠ ã€ç¼–è¾‘æˆ–åˆ é™¤è¿™äº›å˜é‡ï¼Œä¸èƒ½åœ¨æµæ‰§è¡Œè¿‡ç¨‹ä¸­ç”¨ä»£ç æˆ–è¡¨è¾¾å¼åŠ¨æ€æ›´æ”¹å…¶å€¼ã€‚<br></code></pre></td></tr></table></figure><p>4.n8n æ€ä¹ˆå¼•ç”¨å˜é‡</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">é€‰æ‹©è¡¨è¾¾å¼ï¼Œä½¿ç”¨</span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">å˜é‡</span> &#125;&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>n8n</tag>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>github Action åŒæ­¥forkåˆ†æ”¯</title>
    <link href="/article/1ff04a9a.html"/>
    <url>/article/1ff04a9a.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Upstream</span> <span class="hljs-string">Sync</span><br><br><span class="hljs-attr">permissions:</span><br>  <span class="hljs-attr">contents:</span> <span class="hljs-string">write</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">schedule:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">cron:</span> <span class="hljs-string">&quot;0 0 * * *&quot;</span> <span class="hljs-comment"># every day</span><br>  <span class="hljs-attr">workflow_dispatch:</span><br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">sync_latest_from_upstream:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">Sync</span> <span class="hljs-string">latest</span> <span class="hljs-string">commits</span> <span class="hljs-string">from</span> <span class="hljs-string">upstream</span> <span class="hljs-string">repo</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">if:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">github.event.repository.fork</span> <span class="hljs-string">&#125;&#125;</span><br><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-comment"># Step 1: run a standard checkout action</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">target</span> <span class="hljs-string">repo</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span><br><br>      <span class="hljs-comment"># Step 2: run the sync action</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Sync</span> <span class="hljs-string">upstream</span> <span class="hljs-string">changes</span><br>        <span class="hljs-attr">id:</span> <span class="hljs-string">sync</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">aormsby/Fork-Sync-With-Upstream-action@v3.4</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">upstream_sync_repo:</span> <span class="hljs-string">qist/tvbox</span><br>          <span class="hljs-attr">upstream_sync_branch:</span> <span class="hljs-string">master</span><br>          <span class="hljs-attr">target_sync_branch:</span> <span class="hljs-string">master</span><br>          <span class="hljs-attr">target_repo_token:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.GITHUB_TOKEN</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-comment"># automatically generated, no need to set</span><br><br>          <span class="hljs-comment"># Set test_mode true to run tests instead of the true action!!</span><br>          <span class="hljs-attr">test_mode:</span> <span class="hljs-literal">false</span><br><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Sync</span> <span class="hljs-string">check</span><br>        <span class="hljs-attr">if:</span> <span class="hljs-string">failure()</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          echo &quot;[Error] ç”±äºä¸Šæ¸¸ä»“åº“çš„ workflow æ–‡ä»¶å˜æ›´ï¼Œå¯¼è‡´ GitHub è‡ªåŠ¨æš‚åœäº†æœ¬æ¬¡è‡ªåŠ¨æ›´æ–°ï¼Œä½ éœ€è¦æ‰‹åŠ¨ Sync Fork ä¸€æ¬¡ï¼Œè¯¦ç»†æ•™ç¨‹è¯·æŸ¥çœ‹ï¼šhttps://github.com/Yidadaa/ChatGPT-Next-Web/blob/main/README_CN.md#%E6%89%93%E5%BC%80%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0&quot;</span><br><span class="hljs-string">          echo &quot;[Error] Due to a change in the workflow file of the upstream repository, GitHub has automatically suspended the scheduled automatic update. You need to manually sync your fork. Please refer to the detailed tutorial for instructions: https://github.com/Yidadaa/ChatGPT-Next-Web#enable-automatic-updates&quot;</span><br><span class="hljs-string">          exit 1</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AIçŸ¥è¯†è¯</title>
    <link href="/article/7ebf4bf3.html"/>
    <url>/article/7ebf4bf3.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />å¯è§†åŒ–å®¢æˆ·ç«¯- cherry studio- chatboxå¯è§†åŒ–æµç¨‹å·¥å…·- Dify- RAGFlow- FastGptJAVA AIæ¡†æ¶- LangChain4J- Spring AI]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Tomcat+eclipse+jspä¹±ç </title>
    <link href="/article/5698545a.html"/>
    <url>/article/5698545a.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /># [åœ¨eclipseä¸­ä½¿ç”¨Tomcatå¯åŠ¨é¡¹ç›®ä¹±ç ](https://www.cnblogs.com/breeze-zZ/p/17614593.html "å‘å¸ƒäº 2023-08-08 15:49")<p>ä¿®æ”¹tomcatçš„é…ç½®æ–‡ä»¶</p><p>1ï¼‰ä¿®æ”¹Tomcatçš„server.xmlé…ç½®ï¼ˆconfigç›®å½•ä¸‹ï¼‰</p><p>å…ˆæ‰¾åˆ°ç¬¬ä¸€å¤„æ·»åŠ URIEncoding&#x3D;â€œUTF-8â€</p><p><Connector port="8080" protocol="HTTP/1.1" connectionTimeout="20000" redirectPort="8443" URIEncoding="UTF-8"/></p><p>å†æ‰¾åˆ°ç¬¬äºŒå¤„æ·»åŠ URIEncoding&#x3D;â€œUTF-8â€</p><Connector port="8009" protocol="AJP/1.3" redirectPort="8443" URIEncoding="UTF-8"/><p>2ï¼‰ä¿®æ”¹catalina.baté…ç½®ï¼ˆbinç›®å½•ä¸‹ï¼‰</p><p>æ‰¾åˆ°â€JAVA_OPTS&#x3D;%JAVA_OPTS% %JSSE_OPTS%â€æ¢è¡Œæ·»åŠ </p><p><strong>-Dfile.encoding&#x3D;UTF8 -Dsun.jnu.encoding&#x3D;UTF8</strong></p><p>if not â€œ%JSSE_OPTS%â€ &#x3D;&#x3D; â€œâ€ goto gotJsseOpts<br>set â€œJSSE_OPTS&#x3D;-Djdk.tls.ephemeralDHKeySize&#x3D;2048â€<br>:gotJsseOpts<br>set â€œJAVA_OPTS&#x3D;%JAVA_OPTS% %JSSE_OPTS%â€<br>-Dfile.encoding&#x3D;UTF8 -Dsun.jnu.encoding&#x3D;UTF8</p><p>â€”â€”â€”â€”â€“ä»¥ä¸Šéƒ½ä¸è¡Œâ€”â€”â€”-</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> servlets;<br><br>  <br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebFilter;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-meta">@WebFilter(&quot;/*&quot;)</span> <span class="hljs-comment">// è¿‡æ»¤æ‰€æœ‰è¯·æ±‚</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CharacterEncodingFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br><br><span class="hljs-meta">@Override</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;&#125;<br><br><span class="hljs-meta">@Override</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span><br><br><span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br><br><span class="hljs-comment">// è®¾ç½®è¯·æ±‚å’Œå“åº”ç¼–ç </span><br><br>request.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br><br>response.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br><br>response.setContentType(<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>);<br><br>chain.doFilter(request, response);<br><br>&#125;<br><br><span class="hljs-meta">@Override</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tomcat</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Guava LoadingCacheçš„getå’ŒgetIfPresent</title>
    <link href="/article/33c98566.html"/>
    <url>/article/33c98566.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /><p>æˆ‘ä»¬åœ¨ä½¿ç”¨LoadingCacheç±»çš„é€‚åˆï¼Œbuilderä¸­ä¼šä¼ å…¥ä¸€ä¸ªCacheLoaderï¼Œè¿™ä¸ªloadæ–¹æ³•æ˜¯ç”¨æ¥ä»åˆ«çš„åœ°æ–¹å–å€¼ä¿å­˜åœ¨å†…å­˜ä¸­çš„ã€‚</p><p>ä½¿ç”¨getæ—¶ï¼Œå¦‚æœå†…å­˜ä¸­æ²¡æœ‰å€¼ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨loadæ–¹æ³•ï¼Œå¦‚æœloadæ–¹æ³•è¿”å›çš„æ˜¯nullï¼Œé‚£ä¹ˆgetä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>ä½¿ç”¨getIfPresentæ—¶ï¼Œå¦‚æœå†…å­˜ä¸­æ²¡æœ‰å€¼ï¼Œä¸ä¼šè°ƒç”¨loadæ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›nullã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linux æ™®é€šç”¨æˆ· é€šè¿‡ä¿¡ä»»å…³ç³» åˆ‡æ¢root</title>
    <link href="/article/74cace2a.html"/>
    <url>/article/74cace2a.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />1ã€ç™»å½•æ™®é€šsu - admin<p>2ã€æ‰§è¡Œå‘½ä»¤</p><p>ssh-keygen -t rsa</p><p>3ã€ç”Ÿæˆå¦‚ä¸‹ç›®å½•</p><p><img src="https://img2020.cnblogs.com/blog/1616156/202107/1616156-20210727161552811-1400724794.png"></p><p>Â 4ã€åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œæ‰§è¡Œå‘½ä»¤</p><p>ssh-keygen -t rsa</p><p>5ã€ç§é’¥ä¸åŠ¨id_rsaï¼Œæ™®é€šç”¨æˆ·å…¬é’¥id_rsa.pubå†…å®¹è¿½åŠ è‡³ .ssh&#x2F;authorized_keysÂ </p><p>cat &#x2F;home&#x2F;admin&#x2F;.ssh&#x2F;id_rsa.pub &gt;.ssh&#x2F;authorized_keys</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DeepSeekå…è´¹ä½¿ç”¨æ¸ é“å¤§å…¨ ğŸš€</title>
    <link href="/article/3f69882.html"/>
    <url>/article/3f69882.html</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ”¥-DeepSeekå…è´¹ä½¿ç”¨æ¸ é“å¤§å…¨-ğŸš€"><a href="#ğŸ”¥-DeepSeekå…è´¹ä½¿ç”¨æ¸ é“å¤§å…¨-ğŸš€" class="headerlink" title="ğŸ”¥ DeepSeekå…è´¹ä½¿ç”¨æ¸ é“å¤§å…¨ ğŸš€"></a>ğŸ”¥ DeepSeekå…è´¹ä½¿ç”¨æ¸ é“å¤§å…¨ ğŸš€</h1><h2 id="ä¸€ã€æ”¯æŒè”ç½‘æœç´¢æ¸ é“-ç”µè„‘å’Œæ‰‹æœºéƒ½å¯ç”¨-ğŸŒ"><a href="#ä¸€ã€æ”¯æŒè”ç½‘æœç´¢æ¸ é“-ç”µè„‘å’Œæ‰‹æœºéƒ½å¯ç”¨-ğŸŒ" class="headerlink" title="ä¸€ã€æ”¯æŒè”ç½‘æœç´¢æ¸ é“ (ç”µè„‘å’Œæ‰‹æœºéƒ½å¯ç”¨) ğŸŒ"></a>ä¸€ã€æ”¯æŒè”ç½‘æœç´¢æ¸ é“ (ç”µè„‘å’Œæ‰‹æœºéƒ½å¯ç”¨) ğŸŒ</h2><ul><li>åä¸ºå°è‰º : <a href="https://xiaoyi.huawei.com/">https://xiaoyi.huawei.com</a></li><li>MiniMax : <a href="https://chat.minimax.io/">https://chat.minimax.io</a></li><li>QQæµè§ˆå™¨ : <a href="https://aisearch.qq.com/">https://aisearch.qq.com</a></li><li>å¤©å·¥AI : <a href="https://www.tiangong.cn/">https://www.tiangong.cn</a></li><li>å½“è´AI : <a href="https://ai.dangbei.com/">https://ai.dangbei.com</a></li><li>WPSçµçŠ€ : <a href="https://copilot.wps.cn/">https://copilot.wps.cn</a></li><li>è…¾è®¯å…ƒå® : <a href="https://yuanbao.tencent.com/">https://yuanbao.tencent.com</a></li><li>Getç¬”è®° : <a href="https://www.biji.com/">https://www.biji.com</a></li><li>æœ‰é“ç¿»è¯‘ : <a href="https://fanyi.youdao.com/">https://fanyi.youdao.com</a></li><li>å¿ƒæµAIåŠ©æ‰‹ : <a href="https://www.iflow.cn/">https://www.iflow.cn</a></li><li>ima : <a href="https://ima.qq.com/">https://ima.qq.com</a></li><li>è·ƒé—® : <a href="https://www.yuewen.cn/">https://www.yuewen.cn</a></li><li>é—®å°ç™½ : <a href="https://www.wenxiaobai.com/">https://www.wenxiaobai.com</a></li><li>AskManyAI : <a href="https://www.askmanyai.cn/">https://www.askmanyai.cn</a></li><li>ç§˜å¡”AIæœç´¢ : <a href="https://www.metaso.cn/">https://www.metaso.cn</a></li><li>çº³ç±³AIæœç´¢ : <a href="https://www.n.cn/">https://www.n.cn</a></li><li>Poe : <a href="https://www.poe.com/DeepSeek-R1">https://www.poe.com/DeepSeek-R1</a></li><li>Perplexity : <a href="https://www.perplexity.ai/">https://www.perplexity.ai</a></li><li>Monica : <a href="https://www.monica.cn/">https://www.monica.cn</a></li><li>ç™¾åº¦æ–‡åº“ : <a href="https://wenku.baidu.com/">https://wenku.baidu.com</a></li><li>è®¯é£æ™ºæ–‡ : <a href="https://zhiwen.xfyun.cn/">https://zhiwen.xfyun.cn</a></li><li>è…¾è®¯æ–‡æ¡£ : <a href="https://docs.qq.com/">https://docs.qq.com</a></li><li>çŸ¥ä¹ç›´ç­” : <a href="https://zhida.zhihu.com/">https://zhida.zhihu.com</a></li><li>æ— æ¶¯é—®çŸ¥AI : <a href="https://www.wuya-ai.com/">https://www.wuya-ai.com</a></li><li>è…¾è®¯äº‘AIä»£ç åŠ©æ‰‹ : <a href="https://copilot.tencent.com/chat">https://copilot.tencent.com/chat</a></li><li>deepseek-r1-online : <a href="https://deepseek-r1-online.com/chat/">https://deepseek-r1-online.com/chat/</a></li></ul><hr><h2 id="äºŒã€æä¾›å…è´¹APIé¢åº¦-å¯è°ƒæ•´å‚æ•°-âš™ï¸"><a href="#äºŒã€æä¾›å…è´¹APIé¢åº¦-å¯è°ƒæ•´å‚æ•°-âš™ï¸" class="headerlink" title="äºŒã€æä¾›å…è´¹APIé¢åº¦ (å¯è°ƒæ•´å‚æ•°) âš™ï¸"></a>äºŒã€æä¾›å…è´¹APIé¢åº¦ (å¯è°ƒæ•´å‚æ•°) âš™ï¸</h2><ul><li>ç«å±±æ–¹èˆŸ : <a href="https://console.volcengine.com/">https://console.volcengine.com</a></li><li>ç¡…åŸºæµåŠ¨ : <a href="https://cloud.siliconflow.cn/">https://cloud.siliconflow.cn</a></li><li>æ— é—®èŠ¯ç©¹ : <a href="https://cloud.infini-ai.com/">https://cloud.infini-ai.com</a></li><li>æ¨¡åŠ›æ–¹èˆŸ : <a href="https://ai.gitee.com/models">https://ai.gitee.com/models</a></li><li>è‹±ä¼Ÿè¾¾ : <a href="https://build.nvidia.com/deepseek-ai/deepseek-r1">https://build.nvidia.com/deepseek-ai/deepseek-r1</a></li><li>Deep Infra : <a href="https://deepinfra.com/deepseek-ai/DeepSeek-R1">https://deepinfra.com/deepseek-ai/DeepSeek-R1</a></li><li>é˜¿é‡Œäº‘ç™¾ç‚¼ : <a href="https://bailian.console.aliyun.com/">https://bailian.console.aliyun.com</a></li><li>è®¯é£æ˜Ÿè¾°MaaSå¹³å° : <a href="https://training.xfyun.cn/">https://training.xfyun.cn</a></li></ul><hr><h2 id="ä¸‰ã€åˆ›å»ºæ™ºèƒ½ä½“é€‰æ‹©R1æ¨¡å‹-å¯è°ƒå‚æ•°-ğŸ¤–"><a href="#ä¸‰ã€åˆ›å»ºæ™ºèƒ½ä½“é€‰æ‹©R1æ¨¡å‹-å¯è°ƒå‚æ•°-ğŸ¤–" class="headerlink" title="ä¸‰ã€åˆ›å»ºæ™ºèƒ½ä½“é€‰æ‹©R1æ¨¡å‹ (å¯è°ƒå‚æ•°) ğŸ¤–"></a>ä¸‰ã€åˆ›å»ºæ™ºèƒ½ä½“é€‰æ‹©R1æ¨¡å‹ (å¯è°ƒå‚æ•°) ğŸ¤–</h2><ul><li>æ‰£å­ : <a href="https://www.coze.cn/">https://www.coze.cn</a></li><li>FastGPT : <a href="https://cloud.tryfastgpt.ai/">https://cloud.tryfastgpt.ai</a></li><li>æ”¯ä»˜å®ç™¾å®ç®± : <a href="https://tbox.alipay.com/">https://tbox.alipay.com</a></li><li>OpenRouter : <a href="https://openrouter.ai/deepseek/deepseek-r1">https://openrouter.ai/deepseek/deepseek-r1</a></li><li>è…¾è®¯äº‘å¤§æ¨¡å‹çŸ¥è¯†å¼•æ“ : <a href="https://lke.cloud.tencent.com/">https://lke.cloud.tencent.com</a></li><li>ç™¾åº¦æ™ºèƒ½äº‘åƒå¸†AppBuilder : <a href="https://qianfan.cloud.baidu.com/appbuilder">https://qianfan.cloud.baidu.com/appbuilder</a></li></ul><hr><h2 id="å››ã€æ¥å…¥DeepSeek-R1çš„å„ç±»å¹³å°-ğŸ”Œ"><a href="#å››ã€æ¥å…¥DeepSeek-R1çš„å„ç±»å¹³å°-ğŸ”Œ" class="headerlink" title="å››ã€æ¥å…¥DeepSeek R1çš„å„ç±»å¹³å° ğŸ”Œ"></a>å››ã€æ¥å…¥DeepSeek R1çš„å„ç±»å¹³å° ğŸ”Œ</h2><h3 id="åœ¨çº¿å¹³å°"><a href="#åœ¨çº¿å¹³å°" class="headerlink" title="åœ¨çº¿å¹³å°"></a>åœ¨çº¿å¹³å°</h3><ul><li>è¶…ç®—äº’è”ç½‘ : <a href="https://www.scnet.cn/ui/console">https://www.scnet.cn/ui/console</a></li><li>Hugging Face : <a href="https://huggingface.co/deepseek-ai/DeepSeek-R1">https://huggingface.co/deepseek-ai/DeepSeek-R1</a></li><li>Groq : <a href="https://www.groq.com/">https://www.groq.com</a></li><li>è…¾è®¯äº‘DeepSeekè”ç½‘åŠ©æ‰‹ : <a href="https://lke.cloud.tencent.com/lke#/experience-center">https://lke.cloud.tencent.com/lke#/experience-center</a></li><li>ç«å±±æ–¹èˆŸDeepSeekæ¨¡å‹ä½“éªŒ : <a href="https://www.volcengine.com/experience/ark">https://www.volcengine.com/experience/ark</a></li></ul><h3 id="å†™ä½œå¹³å°"><a href="#å†™ä½œå¹³å°" class="headerlink" title="å†™ä½œå¹³å°"></a>å†™ä½œå¹³å°</h3><ul><li>ä½œå®¶åŠ©æ‰‹ : <a href="https://zuojia.write.qq.com/">https://zuojia.write.qq.com</a></li></ul><h3 id="å¼€å‘å¹³å°"><a href="#å¼€å‘å¹³å°" class="headerlink" title="å¼€å‘å¹³å°"></a>å¼€å‘å¹³å°</h3><ul><li>Trae : <a href="https://www.trae.com.cn/">https://www.trae.com.cn</a></li></ul><h3 id="æ•°æ®åˆ†æå¹³å°"><a href="#æ•°æ®åˆ†æå¹³å°" class="headerlink" title="æ•°æ®åˆ†æå¹³å°"></a>æ•°æ®åˆ†æå¹³å°</h3><ul><li>ChatExcel : <a href="https://www.chatexcel.com/">https://www.chatexcel.com</a></li></ul><h3 id="PPTåˆ¶ä½œå¹³å°"><a href="#PPTåˆ¶ä½œå¹³å°" class="headerlink" title="PPTåˆ¶ä½œå¹³å°"></a>PPTåˆ¶ä½œå¹³å°</h3><ul><li>ç¬”æ ¼PPT : <a href="https://bigppt.cn/">https://bigppt.cn</a></li><li>ç¾å›¾è®¾è®¡å¸ˆLive PPT : <a href="https://www.designkit.com/ppt">https://www.designkit.com/ppt</a></li></ul><hr><p><em>æ³¨ï¼šä»¥ä¸Šé“¾æ¥å‡ä¸ºç›´æ¥å¯ç”¨çš„DeepSeekèµ„æºï¼Œå»ºè®®æ”¶è—å¤‡ç”¨ã€‚</em></p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerfile ä¹‹æœ€å°åŒ– Java é•œåƒçš„å¸¸ç”¨æŠ€å·§</title>
    <link href="/article/91fe9850.html"/>
    <url>/article/91fe9850.html</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>éšç€<a href="https://cloud.tencent.com/product/tke?from_column=20065&from=20065">å®¹å™¨</a>æŠ€æœ¯çš„æ™®åŠï¼Œè¶Šæ¥è¶Šå¤šçš„åº”ç”¨è¢«å®¹å™¨åŒ–ã€‚äººä»¬ä½¿ç”¨å®¹å™¨çš„é¢‘ç‡è¶Šæ¥è¶Šé«˜ï¼Œä½†å¸¸å¸¸å¿½ç•¥ä¸€ä¸ªåŸºæœ¬ä½†åˆéå¸¸é‡è¦çš„é—®é¢˜ - <a href="https://cloud.tencent.com/product/tcr?from_column=20065&from=20065">å®¹å™¨é•œåƒ</a>çš„ä½“ç§¯ã€‚æœ¬æ–‡å°†ä»‹ç»ç²¾ç®€å®¹å™¨é•œåƒçš„å¿…è¦æ€§å¹¶ä»¥åŸºäº spring boot çš„ java åº”ç”¨ä¸ºä¾‹æè¿°æœ€å°åŒ–å®¹å™¨é•œåƒçš„å¸¸ç”¨æŠ€å·§ã€‚</p><h2 id="ç²¾ç®€å®¹å™¨é•œåƒçš„å¿…è¦æ€§"><a href="#ç²¾ç®€å®¹å™¨é•œåƒçš„å¿…è¦æ€§" class="headerlink" title="ç²¾ç®€å®¹å™¨é•œåƒçš„å¿…è¦æ€§"></a>ç²¾ç®€å®¹å™¨é•œåƒçš„å¿…è¦æ€§</h2><p>ç²¾ç®€å®¹å™¨é•œåƒæ˜¯éå¸¸å¿…è¦çš„ï¼Œä¸‹é¢åˆ†åˆ«ä»å®‰å…¨æ€§å’Œæ•æ·æ€§ä¸¤ä¸ªè§’åº¦è¿›è¡Œé˜é‡Šã€‚</p><h3 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h3><p>åŸºäºå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼Œå°†ä¸å¿…è¦çš„ç»„ä»¶ä»é•œåƒä¸­ç§»é™¤å¯ä»¥å‡å°‘æ”»å‡»é¢ã€é™ä½å®‰å…¨é£é™©ã€‚è™½ç„¶ docker æ”¯æŒç”¨æˆ·é€šè¿‡ Seccomp é™åˆ¶å®¹å™¨å†…å¯ä»¥æ‰§è¡Œæ“ä½œæˆ–è€…ä½¿ç”¨ AppArmor ä¸ºå®¹å™¨é…ç½®å®‰å…¨ç­–ç•¥ï¼Œä½†å®ƒä»¬çš„ä½¿ç”¨é—¨æ§›è¾ƒé«˜ï¼Œè¦æ±‚ç”¨æˆ·å…·å¤‡å®‰å…¨é¢†åŸŸçš„ä¸“ä¸šç´ å…»ã€‚</p><h3 id="æ•æ·æ€§"><a href="#æ•æ·æ€§" class="headerlink" title="æ•æ·æ€§"></a>æ•æ·æ€§</h3><p>ç²¾ç®€çš„å®¹å™¨é•œåƒèƒ½æé«˜å®¹å™¨çš„éƒ¨ç½²é€Ÿåº¦ã€‚å‡è®¾æŸä¸€æ—¶åˆ»è®¿é—®æµé‡æ¿€å¢ï¼Œæ‚¨éœ€è¦é€šè¿‡å¢åŠ å®¹å™¨å‰¯æœ¬æ•°ä»¥åº”å¯¹çªå‘å‹åŠ›ã€‚å¦‚æœæŸäº›<a href="https://cloud.tencent.com/product/cdh?from_column=20065&from=20065">å®¿ä¸»æœº</a>ä¸åŒ…å«ç›®æ ‡é•œåƒï¼Œéœ€è¦å…ˆæ‹‰å–é•œåƒï¼Œç„¶åå¯åŠ¨å®¹å™¨ï¼Œè¿™æ—¶ä½¿ç”¨ä½“ç§¯è¾ƒå°çš„é•œåƒèƒ½åŠ é€Ÿè¿™ä¸€è¿‡ç¨‹ã€ç¼©çŸ­æ‰©å®¹æ—¶é—´ã€‚å¦å¤–ï¼Œé•œåƒä½“ç§¯è¶Šå°ï¼Œå…¶æ„å»ºé€Ÿåº¦ä¹Ÿè¶Šå¿«ï¼ŒåŒæ—¶è¿˜èƒ½å‡å°‘å­˜å‚¨å’Œä¼ è¾“çš„æˆæœ¬ã€‚</p><h2 id="å¸¸ç”¨æŠ€å·§"><a href="#å¸¸ç”¨æŠ€å·§" class="headerlink" title="å¸¸ç”¨æŠ€å·§"></a>å¸¸ç”¨æŠ€å·§</h2><p>å°†ä¸€ä¸ª java åº”ç”¨å®¹å™¨åŒ–æ‰€éœ€çš„æ­¥éª¤å¯å½’çº³å¦‚ä¸‹ï¼š</p><ol><li>ç¼–è¯‘ java æºç å¹¶ç”Ÿæˆ jar åŒ…ã€‚</li><li>å°†åº”ç”¨ jar åŒ…å’Œä¾èµ–çš„ç¬¬ä¸‰æ–¹ jar åŒ…ç§»åŠ¨åˆ°åˆé€‚çš„ä½ç½®ã€‚</li></ol><p>æœ¬ç« æ‰€ç”¨çš„æ ·ä¾‹æ˜¯ä¸€ä¸ªåŸºäº spring boot çš„ java åº”ç”¨ spring-boot-dockerï¼Œæ‰€ç”¨çš„æœªç»ä¼˜åŒ–çš„ dockerfile å¦‚ä¸‹ï¼š</p><p>ä»£ç è¯­è¨€ï¼šjavascript</p><p>ä»£ç è¿è¡Œæ¬¡æ•°ï¼š0</p><p>è¿è¡Œ</p><p>AIä»£ç è§£é‡Š</p><p>å¤åˆ¶</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">FROM</span> maven:<span class="hljs-number">3.5</span>-jdk-<span class="hljs-number">8</span><br><span class="hljs-keyword">COPY</span> src <span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/app/</span>src<br><span class="hljs-keyword">COPY</span> pom.xml <span class="hljs-regexp">/usr/</span>src/app<br>RUN mvn -f <span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/app/</span>pom.xml clean <span class="hljs-keyword">package</span><br>ENTRYPOINT [<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;-jar&quot;</span>,<span class="hljs-string">&quot;/usr/src/app/target/spring-boot-docker-1.0.0.jar&quot;</span>]<br></code></pre></td></tr></table></figure><p>ç”±äºåº”ç”¨ä½¿ç”¨ maven æ„å»ºï¼Œdockerfile ä¸­æŒ‡å®š<code>maven:3.5-jdk-8</code>ä½œä¸ºåŸºç¡€é•œåƒï¼Œè¯¥é•œåƒçš„å¤§å°ä¸º 635MBã€‚é€šè¿‡è¿™ç§æ–¹å¼æœ€ç»ˆæ„å»ºå‡ºçš„é•œåƒéå¸¸å¤§ï¼Œè¾¾åˆ°äº† 719MBï¼Œè¿™æ˜¯å› ä¸ºä¸€æ–¹é¢åŸºç¡€é•œåƒæœ¬èº«å°±å¾ˆå¤§ï¼Œå¦ä¸€æ–¹é¢ maven åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¼šä¸‹è½½è®¸å¤šç”¨äºæ‰§è¡Œæ„å»ºä»»åŠ¡çš„ jar åŒ…ã€‚</p><h3 id="å¤šé˜¶æ®µæ„å»º"><a href="#å¤šé˜¶æ®µæ„å»º" class="headerlink" title="å¤šé˜¶æ®µæ„å»º"></a>å¤šé˜¶æ®µæ„å»º</h3><p>Java ç¨‹åºçš„è¿è¡Œåªä¾èµ– JREï¼Œå¹¶ä¸éœ€è¦ maven æˆ–è€… JDK ä¸­ä¼—å¤šç”¨äºç¼–è¯‘ã€è°ƒè¯•ã€è¿è¡Œçš„å·¥å…·ï¼Œå› æ­¤ä¸€ä¸ªæ˜æ˜¾çš„ä¼˜åŒ–æ–¹æ³•æ˜¯å°†ç”¨äºç¼–è¯‘æ„å»º java æºç çš„é•œåƒå’Œç”¨äºè¿è¡Œ java åº”ç”¨çš„é•œåƒåˆ†å¼€ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸€ç›®çš„ï¼Œåœ¨ docker 17.05 ç‰ˆæœ¬ä¹‹å‰éœ€è¦ç”¨æˆ·ç»´æŠ¤ 2 ä¸ª dockerfile æ–‡ä»¶ï¼Œè¿™æ— ç–‘å¢åŠ äº†æ„å»ºçš„å¤æ‚æ€§ã€‚å¥½åœ¨è‡ª 17.05 å¼€å§‹ï¼Œdocker å¼•å…¥äº†å¤šé˜¶æ®µæ„å»ºçš„æ¦‚å¿µï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨ä¸€ä¸ª dockerfile ä¸­ä½¿ç”¨å¤šä¸ª From è¯­å¥ã€‚æ¯ä¸ª From è¯­å¥å¯ä»¥æŒ‡å®šä¸åŒçš„åŸºç¡€é•œåƒå¹¶å°†å¼€å¯ä¸€ä¸ªå…¨æ–°çš„æ„å»ºæµç¨‹ã€‚æ‚¨å¯ä»¥é€‰æ‹©æ€§åœ°å°†å‰ä¸€é˜¶æ®µçš„æ„å»ºäº§ç‰©å¤åˆ¶åˆ°å¦ä¸€ä¸ªé˜¶æ®µï¼Œä»è€Œåªå°†å¿…è¦çš„å†…å®¹ä¿ç•™åœ¨æœ€ç»ˆçš„é•œåƒé‡Œã€‚ä¼˜åŒ–åçš„ dockerfile å¦‚ä¸‹ï¼š</p><p>ä»£ç è¯­è¨€ï¼šjavascript</p><p>ä»£ç è¿è¡Œæ¬¡æ•°ï¼š0</p><p>è¿è¡Œ</p><p>AIä»£ç è§£é‡Š</p><p>å¤åˆ¶</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">FROM</span> maven:<span class="hljs-number">3.5</span>-jdk-<span class="hljs-number">8</span> AS build<br><span class="hljs-keyword">COPY</span> src <span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/app/</span>src<br><span class="hljs-keyword">COPY</span> pom.xml <span class="hljs-regexp">/usr/</span>src/app<br>RUN mvn -f <span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/app/</span>pom.xml clean <span class="hljs-keyword">package</span><br><br><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">8</span>-jre<br>ARG DEPENDENCY=<span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/app/</span>target/dependency<br><span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=build $&#123;DEPENDENCY&#125;<span class="hljs-regexp">/BOOT-INF/</span>lib <span class="hljs-regexp">/app/</span>lib<br><span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=build $&#123;DEPENDENCY&#125;<span class="hljs-regexp">/META-INF /</span>app/META-INF<br><span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=build $&#123;DEPENDENCY&#125;<span class="hljs-regexp">/BOOT-INF/</span>classes /app<br>ENTRYPOINT [<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;-cp&quot;</span>,<span class="hljs-string">&quot;app:app/lib/*&quot;</span>,<span class="hljs-string">&quot;hello.Application&quot;</span>]<br></code></pre></td></tr></table></figure><p>è¯¥ dockerfile é€‰ç”¨<code>maven:3.5-jdk-8</code>ä½œä¸ºç¬¬ä¸€é˜¶æ®µçš„æ„å»ºé•œåƒï¼Œé€‰ç”¨<code>openjdk:8-jre</code>ä½œä¸ºè¿è¡Œ java åº”ç”¨çš„åŸºç¡€é•œåƒå¹¶ä¸”åªæ‹·è´äº†ç¬¬ä¸€é˜¶æ®µç¼–è¯‘å¥½çš„<code>.claass</code>æ–‡ä»¶å’Œä¾èµ–çš„ç¬¬ä¸‰æ–¹ jar åŒ…åˆ°æœ€ç»ˆçš„é•œåƒé‡Œã€‚é€šè¿‡è¿™ç§æ–¹å¼ä¼˜åŒ–åçš„é•œåƒå¤§å°ä¸º 459MBã€‚</p><h3 id="ä½¿ç”¨-distroless-ä½œä¸ºåŸºç¡€é•œåƒ"><a href="#ä½¿ç”¨-distroless-ä½œä¸ºåŸºç¡€é•œåƒ" class="headerlink" title="ä½¿ç”¨ distroless ä½œä¸ºåŸºç¡€é•œåƒ"></a>ä½¿ç”¨ distroless ä½œä¸ºåŸºç¡€é•œåƒ</h3><p>è™½ç„¶é€šè¿‡å¤šé˜¶æ®µæ„å»ºèƒ½å‡å°æœ€ç»ˆç”Ÿæˆçš„é•œåƒçš„å¤§å°ï¼Œä½† 459MB çš„ä½“ç§¯ä»ç›¸å¯¹è¿‡å¤§ã€‚ç»è°ƒæŸ¥å‘ç°ï¼Œè¿™æ˜¯å› ä¸ºä½¿ç”¨çš„åŸºç¡€é•œåƒ<code>openjdk:8-jre</code>ä½“ç§¯è¿‡å¤§ï¼Œåˆ°è¾¾äº† 443MBï¼Œå› æ­¤ä¸‹ä¸€æ­¥çš„ä¼˜åŒ–æ–¹å‘æ˜¯å‡å°åŸºç¡€é•œåƒçš„ä½“ç§¯ã€‚</p><p>Google å¼€æºçš„é¡¹ç›® distroless æ­£æ˜¯ä¸ºäº†è§£å†³åŸºç¡€é•œåƒä½“ç§¯è¿‡å¤§è¿™ä¸€é—®é¢˜ã€‚Distroless é•œåƒåªåŒ…å«åº”ç”¨ç¨‹åºåŠå…¶è¿è¡Œæ—¶ä¾èµ–é¡¹ï¼Œä¸åŒ…å«åŒ…ç®¡ç†å™¨ã€shell ä»¥åŠåœ¨æ ‡å‡† Linux å‘è¡Œç‰ˆä¸­å¯ä»¥æ‰¾åˆ°çš„ä»»ä½•å…¶ä»–ç¨‹åºã€‚ç›®å‰ï¼Œdistroless ä¸ºä¾èµ– javaã€pythonã€nodejsã€dotnet ç­‰ç¯å¢ƒçš„åº”ç”¨æä¾›äº†åŸºç¡€é•œåƒã€‚</p><p>ä½¿ç”¨ distroless çš„ dockerfile å¦‚ä¸‹ï¼š</p><p>ä»£ç è¯­è¨€ï¼šjavascript</p><p>ä»£ç è¿è¡Œæ¬¡æ•°ï¼š0</p><p>è¿è¡Œ</p><p>AIä»£ç è§£é‡Š</p><p>å¤åˆ¶</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">FROM</span> maven:<span class="hljs-number">3.5</span>-jdk-<span class="hljs-number">8</span> AS build<br><span class="hljs-keyword">COPY</span> src <span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/app/</span>src<br><span class="hljs-keyword">COPY</span> pom.xml <span class="hljs-regexp">/usr/</span>src/app<br>RUN mvn -f <span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/app/</span>pom.xml clean <span class="hljs-keyword">package</span><br><br><span class="hljs-keyword">FROM</span> gcr.io<span class="hljs-regexp">/distroless/</span>java<br>ARG DEPENDENCY=<span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/app/</span>target/dependency<br><span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=build $&#123;DEPENDENCY&#125;<span class="hljs-regexp">/BOOT-INF/</span>lib <span class="hljs-regexp">/app/</span>lib<br><span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=build $&#123;DEPENDENCY&#125;<span class="hljs-regexp">/META-INF /</span>app/META-INF<br><span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=build $&#123;DEPENDENCY&#125;<span class="hljs-regexp">/BOOT-INF/</span>classes /app<br>ENTRYPOINT [<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;-cp&quot;</span>,<span class="hljs-string">&quot;app:app/lib/*&quot;</span>,<span class="hljs-string">&quot;hello.Application&quot;</span>]<br></code></pre></td></tr></table></figure><p>è¯¥ dockerfile å’Œä¸Šä¸€ç‰ˆçš„å”¯ä¸€åŒºåˆ«åœ¨äºå°†è¿è¡Œé˜¶æ®µä¾èµ–çš„åŸºç¡€é•œåƒç”±<code>openjdk:8-jre</code>ï¼ˆ443 MBï¼‰æ›¿æ¢æˆäº†<code>gcr.io/distroless/java</code>ï¼ˆ119 MBï¼‰ã€‚ç»è¿‡è¿™ä¸€ä¼˜åŒ–ï¼Œæœ€ç»ˆé•œåƒçš„å¤§å°ä¸º 135MBã€‚</p><p>ä½¿ç”¨ distroless çš„å”¯ä¸€ä¸ä¾¿æ˜¯æ‚¨æ— æ³• attach åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸Šæ’æŸ¥é—®é¢˜ï¼Œå› ä¸ºé•œåƒä¸­ä¸åŒ…å« shellã€‚è™½ç„¶ distroless çš„ debug é•œåƒæä¾› busybox shellï¼Œä½†éœ€è¦ç”¨æˆ·é‡æ–°æ‰“åŒ…é•œåƒã€éƒ¨ç½²å®¹å™¨ï¼Œå¯¹äºé‚£äº›å·²ç»åŸºäºé debug é•œåƒéƒ¨ç½²çš„å®¹å™¨æ— æµäºäº‹ã€‚ ä½†ä»å®‰å…¨è§’åº¦æ¥çœ‹ï¼Œæ— æ³• attach å®¹å™¨å¹¶ä¸å®Œå…¨æ˜¯åäº‹ï¼Œå› ä¸ºæ”»å‡»è€…æ— æ³•é€šè¿‡ shell è¿›è¡Œæ”»å‡»ã€‚</p><h3 id="ä½¿ç”¨-alpine-ä½œä¸ºåŸºç¡€é•œåƒ"><a href="#ä½¿ç”¨-alpine-ä½œä¸ºåŸºç¡€é•œåƒ" class="headerlink" title="ä½¿ç”¨ alpine ä½œä¸ºåŸºç¡€é•œåƒ"></a>ä½¿ç”¨ alpine ä½œä¸ºåŸºç¡€é•œåƒ</h3><p>å¦‚æœæ‚¨ç¡®å®æœ‰ attach å®¹å™¨çš„éœ€æ±‚ï¼Œåˆå¸Œæœ›æœ€å°åŒ–é•œåƒçš„å¤§å°ï¼Œå¯ä»¥é€‰ç”¨ alpine ä½œä¸ºåŸºç¡€é•œåƒã€‚Alpine é•œåƒçš„ç‰¹ç‚¹æ˜¯ä½“ç§¯éå¸¸ä¸‹ï¼ŒåŸºç¡€æ¬¾é•œåƒçš„ä½“ç§¯ä»… 4 MB å·¦å³ã€‚</p><p>ä½¿ç”¨ alpine åçš„ dockerfile å¦‚ä¸‹ï¼š</p><p>ä»£ç è¯­è¨€ï¼šjavascript</p><p>ä»£ç è¿è¡Œæ¬¡æ•°ï¼š0</p><p>è¿è¡Œ</p><p>AIä»£ç è§£é‡Š</p><p>å¤åˆ¶</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">FROM</span> maven:<span class="hljs-number">3.5</span>-jdk-<span class="hljs-number">8</span> AS build<br><span class="hljs-keyword">COPY</span> src <span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/app/</span>src<br><span class="hljs-keyword">COPY</span> pom.xml <span class="hljs-regexp">/usr/</span>src/app<br>RUN mvn -f <span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/app/</span>pom.xml clean <span class="hljs-keyword">package</span><br><br><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">8</span>-jre-alpine<br>ARG DEPENDENCY=<span class="hljs-regexp">/usr/</span>src<span class="hljs-regexp">/app/</span>target/dependency<br><span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=build $&#123;DEPENDENCY&#125;<span class="hljs-regexp">/BOOT-INF/</span>lib <span class="hljs-regexp">/app/</span>lib<br><span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=build $&#123;DEPENDENCY&#125;<span class="hljs-regexp">/META-INF /</span>app/META-INF<br><span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=build $&#123;DEPENDENCY&#125;<span class="hljs-regexp">/BOOT-INF/</span>classes /app<br>ENTRYPOINT [<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;-cp&quot;</span>,<span class="hljs-string">&quot;app:app/lib/*&quot;</span>,<span class="hljs-string">&quot;hello.Application&quot;</span>]<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¹¶æœªç›´æ¥ç»§æ‰¿åŸºç¡€æ¬¾ alpineï¼Œè€Œæ˜¯é€‰ç”¨ä» alpine æ„å»ºå‡ºçš„åŒ…å« java è¿è¡Œæ—¶çš„<code>openjdk:8-jre-alpine</code>ï¼ˆ83MBï¼‰ä½œä¸ºåŸºç¡€é•œåƒã€‚ä½¿ç”¨è¯¥ dockerfile æ„å»ºå‡ºçš„é•œåƒä½“ç§¯ä¸º 99.2MBï¼Œæ¯”åŸºäº distroless çš„è¿˜è¦å°ã€‚</p><p>æ‰§è¡Œå‘½ä»¤<code>docker exec -ti &lt;container_id&gt; sh</code>å¯ä»¥æˆåŠŸ attach åˆ°è¿è¡Œçš„å®¹å™¨ä¸­ã€‚</p><h3 id="distroless-vs-alpine"><a href="#distroless-vs-alpine" class="headerlink" title="distroless vs alpine"></a>distroless vs alpine</h3><p>æ—¢ç„¶ distroless å’Œ alpine éƒ½èƒ½æä¾›éå¸¸å°çš„åŸºç¡€é•œåƒï¼Œé‚£ä¹ˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸­åˆ°åº•åº”è¯¥é€‰æ‹©å“ªä¸€ç§å‘¢ï¼Ÿå¦‚æœå®‰å…¨æ€§æ˜¯æ‚¨çš„é¦–è¦è€ƒè™‘å› ç´ ï¼Œå»ºè®®é€‰ç”¨ distrolessï¼Œå› ä¸ºå®ƒå”¯ä¸€å¯è¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶å°±æ˜¯æ‚¨æ‰“åŒ…çš„åº”ç”¨ï¼›å¦‚æœæ‚¨æ›´å…³æ³¨é•œåƒçš„ä½“ç§¯ï¼Œå¯ä»¥é€‰ç”¨ alpineã€‚</p><h3 id="å…¶ä»–æŠ€å·§"><a href="#å…¶ä»–æŠ€å·§" class="headerlink" title="å…¶ä»–æŠ€å·§"></a>å…¶ä»–æŠ€å·§</h3><p>é™¤äº†å¯ä»¥é€šè¿‡ä¸Šè¿°æŠ€å·§ç²¾ç®€é•œåƒå¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹æ–¹å¼ï¼š</p><ol><li>å°† dockerfile ä¸­çš„å¤šæ¡æŒ‡ä»¤åˆå¹¶æˆä¸€æ¡ï¼Œé€šè¿‡å‡å°‘é•œåƒå±‚æ•°çš„æ–¹å¼è¾¾åˆ°ç²¾ç®€é•œåƒä½“ç§¯çš„ç›®çš„ã€‚</li><li>å°†ç¨³å®šä¸”ä½“ç§¯è¾ƒå¤§çš„å†…å®¹ç½®äºé•œåƒä¸‹å±‚ï¼Œå°†å˜åŠ¨é¢‘ç¹ä¸”ä½“ç§¯è¾ƒå°çš„å†…å®¹ç½®äºé•œåƒä¸Šå±‚ã€‚è™½ç„¶è¯¥æ–¹å¼æ— æ³•ç›´æ¥ç²¾ç®€é•œåƒä½“ç§¯ï¼Œä½†å……åˆ†åˆ©ç”¨äº†é•œåƒçš„ç¼“å­˜æœºåˆ¶ï¼ŒåŒæ ·å¯ä»¥è¾¾åˆ°åŠ å¿«é•œåƒæ„å»ºå’Œå®¹å™¨éƒ¨ç½²çš„ç›®çš„ã€‚</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>æœ¬æ–‡é€šè¿‡ä¸€ç³»åˆ—çš„ä¼˜åŒ–ï¼Œå°† java åº”ç”¨çš„é•œåƒä½“ç§¯ç”±æœ€åˆçš„ 719MB ç¼©å°åˆ° 100MB å·¦å³ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ä¾èµ–å…¶ä»–ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„åŸåˆ™è¿›è¡Œä¼˜åŒ–ã€‚</li><li>é’ˆå¯¹ java é•œåƒï¼Œgoogle æä¾›çš„å¦ä¸€æ¬¾å·¥å…· jib èƒ½ä¸ºæ‚¨å±è”½é•œåƒæ„å»ºè¿‡ç¨‹ä¸­çš„å¤æ‚ç»†èŠ‚ï¼Œè‡ªåŠ¨æ„å»ºå‡ºç²¾ç®€çš„ java é•œåƒã€‚ä½¿ç”¨å®ƒæ‚¨æ— é¡»ç¼–å†™ dockerfileï¼Œç”šè‡³ä¸éœ€è¦å®‰è£… dockerã€‚</li><li>å¯¹äºç±»ä¼¼ distroless è¿™æ ·æ— æ³• attach æˆ–è€…ä¸æ–¹ä¾¿ attach çš„å®¹å™¨ï¼Œå»ºè®®æ‚¨å°†å®ƒä»¬çš„æ—¥å¿—ä¸­å¿ƒåŒ–å­˜å‚¨ï¼Œä»¥ä¾¿é—®é¢˜çš„è¿½è¸ªå’Œæ’æŸ¥ã€‚</li></ol><!-- toc --><meta name="referrer" content="no-referrer" />]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootä¸‰ç§æ–¹æ³•æ¥å£è¿”å›æ—¥æœŸæ ¼å¼åŒ–</title>
    <link href="/article/a5d2a699.html"/>
    <url>/article/a5d2a699.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />### æ–¹æ³•ä¸€ï¼š@[JsonFormatæ³¨è§£](https://so.csdn.net/so/search?q=JsonFormat%E6%B3%A8%E8%A7%A3&spm=1001.2101.3001.7020)<p>åœ¨è¿”å›å®ä½“çš„å­—æ®µä¸Šæ·»åŠ @JsonFormatæ³¨è§£ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@<span class="hljs-constructor">JsonFormat(<span class="hljs-params">pattern</span> = <span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>, <span class="hljs-params">timezone</span> = <span class="hljs-string">&quot;GMT+8&quot;</span>)</span><br><span class="hljs-keyword">private</span> Date createDate;<br><br></code></pre></td></tr></table></figure><p>patternæ˜¯<a href="https://so.csdn.net/so/search?q=%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F&spm=1001.2101.3001.7020">æ—¥æœŸæ ¼å¼</a>ï¼Œtimezoneæ˜¯æ—¶é—´åˆ†åŒºã€‚æ ¼å¼å…·ä½“å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š<br><img src="https://i-blog.csdnimg.cn/direct/027c0dd81c53430e8eeb503f68afbdec.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="æ–¹æ³•äºŒï¼šJsonConfigé…ç½®"><a href="#æ–¹æ³•äºŒï¼šJsonConfigé…ç½®" class="headerlink" title="æ–¹æ³•äºŒï¼šJsonConfigé…ç½®"></a>æ–¹æ³•äºŒï¼šJsonConfigé…ç½®</h3><p>å…¨å±€é…ç½®ã€‚å¥½å¤„ï¼šæ— éœ€æ¯ä¸ªç±»é…ç½®æ—¥æœŸæ ¼å¼åå¤„ï¼šä¸çµæ´»ï¼Œåªèƒ½ç»Ÿä¸€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xy.config;<br><br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.SerializationFeature;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.jackson.Jackson2ObjectMapperBuilderCustomizer;<br><span class="hljs-keyword">import</span> org.springframework.boot.jackson.JsonComponent;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.text.DateFormat;<br><span class="hljs-keyword">import</span> java.text.SimpleDateFormat;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><span class="hljs-keyword">import</span> java.time.format.DateTimeFormatter;<br><span class="hljs-keyword">import</span> java.util.TimeZone;<br><br><span class="hljs-comment">//jacksonæ—¥æœŸ</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@JsonComponent</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JacksonConfig</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;my.jackson.date-format:yyyy-MM-dd HH:mm:ss&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String pattern;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Jackson2ObjectMapperBuilderCustomizer <span class="hljs-title function_">jackson2ObjectMapperBuilder</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-keyword">return</span> builder -&gt; &#123;<br>            <span class="hljs-type">TimeZone</span> <span class="hljs-variable">tz</span> <span class="hljs-operator">=</span> TimeZone.getTimeZone(<span class="hljs-string">&quot;GMT+8&quot;</span>);<br>            <span class="hljs-type">DateFormat</span> <span class="hljs-variable">df</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(pattern);<br>            df.setTimeZone(tz);<br>            builder.failOnEmptyBeans(<span class="hljs-literal">false</span>)<br>                    .failOnUnknownProperties(<span class="hljs-literal">false</span>)<br>                    .featuresToDisable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS)<br>                    .dateFormat(df);<br>        &#125;;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> LocalDateTimeSerializer <span class="hljs-title function_">localDateTimeDeserializer</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalDateTimeSerializer</span>(DateTimeFormatter.ofPattern(pattern));<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Jackson2ObjectMapperBuilderCustomizer <span class="hljs-title function_">jackson2ObjectMapperBuilderCustomizer</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> builder -&gt; builder.serializerByType(LocalDateTime.class, localDateTimeDeserializer());<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åé…ç½®æ–‡ä»¶é‡Œé…ç½®å¥½æ ¼å¼å°±è¡Œã€‚</p><h3 id="æ–¹æ³•ä¸‰ï¼šymlé…ç½®"><a href="#æ–¹æ³•ä¸‰ï¼šymlé…ç½®" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šymlé…ç½®"></a>æ–¹æ³•ä¸‰ï¼šymlé…ç½®</h3><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">spring</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">jackson</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">date-format</span><span class="hljs-punctuation">:</span> <span class="hljs-string">yyyy-MM-dd HH:mm:ss</span><br>    <span class="hljs-attribute">time-zone</span><span class="hljs-punctuation">:</span> <span class="hljs-string">GMT+8</span><br></code></pre></td></tr></table></figure><p>UTCå’Œ GMTåŒºåˆ«UTCâ€Œï¼šåè°ƒä¸–ç•Œæ—¶é—´ï¼ˆUTCï¼‰æ˜¯åŸºäºåŸå­æ—¶é’Ÿçš„æ—¶é—´è®¡é‡ç³»ç»Ÿï¼Œæ—¨åœ¨å°½é‡æ¥è¿‘ä¸–ç•Œæ—¶ï¼ˆUTï¼‰ã€‚UTCçš„æ—¶é—´å°ºåº¦æ˜¯å‡åŒ€çš„ï¼Œä¸è€ƒè™‘åœ°çƒè‡ªè½¬é€Ÿåº¦çš„å˜åŒ–â€Œã€‚â€ŒGMT+8â€Œï¼šæ ¼æ—å¨æ²»å¹³å‡æ—¶é—´åŠ 8å°æ—¶ï¼Œå³ä¸œå…«åŒºçš„æœ¬åœ°æ—¶é—´ã€‚GMT+8é€šå¸¸ç”¨äºè¡¨ç¤ºä¸­å›½åŒ—äº¬æ—¶é—´â€Œâ€ŒUTCâ€Œï¼šåœ¨å›½é™…æ— çº¿ç”µé€šä¿¡ã€å«æ˜Ÿå¯¼èˆªç­‰éœ€è¦é«˜ç²¾åº¦æ—¶é—´è®¡é‡çš„åœºåˆå¹¿æ³›ä½¿ç”¨â€Œã€‚â€ŒGMT+8â€Œï¼šå¸¸ç”¨äºè¡¨ç¤ºä¸­å›½åŒ—äº¬æ—¶é—´ï¼Œåœ¨ç”µå­é‚®ä»¶ä¿¡å¤´ã€è½¯ä»¶æ˜¾ç¤ºæ—¶é—´ç­‰åœºåˆä½¿ç”¨â€Œã€‚æ€»ç»“ï¼šUTCå’ŒGMT+8åŸºæœ¬ç›¸åŒï¼ŒUTCæ›´ç²¾ç¡®è€ŒGMT+8å¸¸ä»£è¡¨åŒ—äº¬æ—¶é—´ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸‰ç§æ–¹æ³•ä¸ªäººæ¨èç¬¬ä¸‰ç§ã€‚ä¸ºä»€ä¹ˆï¼Œå› ä¸ºå¤ªæ–¹ä¾¿äº†ï¼Œå¦å¤–å¦‚æœæœ‰ç‰¹æ®Šæ ¼å¼ï¼Œå¯ä»¥å†åŠ @JsonFormatå•ç‹¬æ³¨è§£ï¼Œä¼šä¼˜å…ˆä»¥æ·»åŠ äº†@JsonFormatæ³¨è§£çš„ä¸ºå‡†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äº‹åŠ¡å›æ»šåï¼Œè‡ªå¢IDä»ç„¶å¢åŠ </title>
    <link href="/article/3214cdba.html"/>
    <url>/article/3214cdba.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />## [äº‹åŠ¡å›æ»š](https://so.csdn.net/so/search?q=%E4%BA%8B%E5%8A%A1%E5%9B%9E%E6%BB%9A&spm=1001.2101.3001.7020)åï¼Œè‡ªå¢IDä»ç„¶å¢åŠ <p>å›æ»šåï¼Œè‡ªå¢IDä»ç„¶å¢åŠ ã€‚</p><p>æ¯”å¦‚å½“å‰IDæ˜¯7ï¼Œæ’å…¥ä¸€æ¡æ•°æ®åï¼Œåˆå›æ»šäº†ã€‚<br>ç„¶åä½ å†æ’å…¥ä¸€æ¡æ•°æ®ï¼Œæ­¤æ—¶æ’å…¥æˆåŠŸï¼Œè¿™æ—¶å€™ä½ çš„IDä¸æ˜¯8ï¼Œè€Œæ˜¯9.<br>å› ä¸ºè™½ç„¶ä½ ä¹‹å‰æ’å…¥å›æ»šï¼Œä½†æ˜¯IDè¿˜æ˜¯è‡ªå¢äº†ã€‚</p><p>å¦‚æœä½ è®¤ä¸ºè‡ªå¢IDä¸åº”è¯¥è¢«äº‹åŠ¡åŒ–ï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡ä¸å¾—ä¸ç­‰å¾…ç€ï¼Œæ£€æŸ¥è‡ªå¢IDæ˜¯è¢«ä½¿ç”¨è¿˜æ˜¯è¢«å›æ»šï¼Œè¿™å°±å¯¼è‡´é˜»å¡ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼ŒAè¡¨ä½¿ç”¨è‡ªå¢IDã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">User</span> <span class="hljs-number">1</span><br><span class="hljs-comment">------------</span><br><span class="hljs-keyword">begin</span> transaction<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> A ...<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> B ...<br><span class="hljs-keyword">update</span> C ...<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> D ...<br><span class="hljs-keyword">commit</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><br><span class="hljs-section">User 2</span><br><span class="hljs-section">-----------</span><br>begin transaction<br>insert into A ...<br>insert into B ...<br>commit<br></code></pre></td></tr></table></figure><p>çœ‹ä»¥ä¸Šçš„ä¾‹å­ä»£ç ï¼Œå¦‚æœè‡ªå¢IDä¹Ÿè¦è¢«äº‹åŠ¡åŒ–ï¼Œé‚£ä¹ˆå‡è®¾user 2 çš„äº‹åŠ¡åœ¨user 1æ‰§è¡Œåçš„1æ¯«ç§’åæ‰§è¡Œï¼Œé‚£ä¹ˆä»–çš„æ’å…¥åˆ°Aè¡¨ä¸å¾—ä¸ç­‰å¾…User 1çš„æ•´ä¸ªäº‹åŠ¡ç»“æŸï¼Œæ£€æŸ¥ç¬¬ä¸€ä¸ªè‡ªå¢IDæ˜¯ä¸æ˜¯è¢«ä½¿ç”¨äº†ã€‚è¿™å°±å¯¼è‡´é˜»å¡ã€‚</p><p><strong>è‡ªå¢IDä¸è¢«äº‹åŠ¡åŒ–æ˜¯è®¾è®¡ä½¿ç„¶ï¼Œä¸æ˜¯bugï¼Œå¦‚æœéœ€è¦ç´§å¯†è¿ç»­çš„è‡ªå¢åºåˆ—ï¼Œå»ºè®®é‡‡ç”¨å…¶ä»–æ–¹æ³•ç”Ÿæˆã€‚</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-comment">--ä¸é€£çºŒæ²’é—œä¿‚,éœ€è¦æ™‚å€™ç”Ÿæˆä¸€åˆ—</span><br><span class="hljs-keyword">if</span> object_id(<span class="hljs-string">&#x27;tb&#x27;</span>)<span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> tb<br>go<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tb(ID <span class="hljs-type">int</span> )<br><span class="hljs-keyword">insert</span> tb <span class="hljs-keyword">select</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">insert</span> tb <span class="hljs-keyword">select</span> <span class="hljs-number">2</span><br><span class="hljs-keyword">insert</span> tb <span class="hljs-keyword">select</span> <span class="hljs-number">5</span><br><span class="hljs-keyword">insert</span> tb <span class="hljs-keyword">select</span> <span class="hljs-number">18</span><br><span class="hljs-keyword">insert</span> tb <span class="hljs-keyword">select</span> <span class="hljs-number">13</span><br><span class="hljs-keyword">select</span> id ,[newid]=(<span class="hljs-keyword">select</span> count(*) <span class="hljs-keyword">from</span> tb <span class="hljs-keyword">where</span> id&lt;=t.id) <span class="hljs-keyword">from</span> tb t <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> [newid]<br><span class="hljs-comment">/*id     newid   </span><br><span class="hljs-comment">----------- -----------</span><br><span class="hljs-comment">1      1</span><br><span class="hljs-comment">2      2</span><br><span class="hljs-comment">5      3</span><br><span class="hljs-comment">13     4</span><br><span class="hljs-comment">18     5</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">(å½±éŸ¿ 5 å€‹è³‡æ–™åˆ—)</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="ä¸ºä»€ä¹ˆmysqläº‹åŠ¡å›æ»šåï¼Œè‡ªå¢IDä¾ç„¶è‡ªå¢"><a href="#ä¸ºä»€ä¹ˆmysqläº‹åŠ¡å›æ»šåï¼Œè‡ªå¢IDä¾ç„¶è‡ªå¢" class="headerlink" title="ä¸ºä»€ä¹ˆmysqläº‹åŠ¡å›æ»šåï¼Œè‡ªå¢IDä¾ç„¶è‡ªå¢"></a>ä¸ºä»€ä¹ˆmysqläº‹åŠ¡å›æ»šåï¼Œè‡ªå¢IDä¾ç„¶è‡ªå¢</h2><p>å› ä¸ºinnodbçš„auto_increamentçš„è®¡æ•°å™¨è®°å½•çš„å½“å‰å€¼æ˜¯ä¿å­˜åœ¨å­˜å†… å­˜ä¸­çš„ï¼Œå¹¶ä¸æ˜¯å­˜åœ¨äºç£ç›˜ä¸Šï¼Œå½“mysql<br>serverå¤„äºè¿è¡Œçš„æ—¶å€™ï¼Œè¿™ä¸ªè®¡æ•°å€¼åªä¼šéšç€<a href="https://so.csdn.net/so/search?q=insert&spm=1001.2101.3001.7020">insert</a>æ”¹å¢é•¿ï¼Œä¸ä¼šéšç€deleteè€Œå‡å°‘ã€‚è€Œå½“mysql<br>serverå¯åŠ¨æ—¶ï¼Œå½“æˆ‘ä»¬éœ€è¦å»æŸ¥è¯¢auto_incrementè®¡æ•°å€¼æ—¶ï¼Œmysqlä¾¿ä¼šè‡ªåŠ¨æ‰§è¡Œï¼šSELECT MAX(id) FROM è¡¨å<br>FOR UPDATE;è¯­å¥æ¥è·å¾—å½“å‰auto_incrementåˆ—çš„æœ€å¤§å€¼ï¼Œç„¶åå°†è¿™ä¸ªå€¼æ”¾åˆ°auto_incrementè®¡æ•°å™¨ä¸­ã€‚æ‰€ä»¥å°±ç®—<br>Rollback MySQLçš„auto_increamentè®¡æ•°å™¨ä¹Ÿä¸ä¼šä½œè´Ÿè¿ç®—ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis ç»å…¸ç¼“å­˜é—®é¢˜ï¼šä¸€è‡´æ€§ã€ç©¿é€ã€å‡»ç©¿ã€é›ªå´©ä¸æ±¡æŸ“</title>
    <link href="/article/1c3f5ec1.html"/>
    <url>/article/1c3f5ec1.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /><p>Redis æ˜¯ä¸€ç§å¹¿æ³›åº”ç”¨çš„é«˜æ€§èƒ½å†…å­˜æ•°æ®åº“ï¼Œå¸¸ç”¨äºç¼“å­˜åœºæ™¯ä»¥æå‡ç³»ç»Ÿæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚ç„¶è€Œï¼Œä½¿ç”¨ Redis ç¼“å­˜æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›ç»å…¸é—®é¢˜ï¼Œæ¯”å¦‚ä¸€è‡´æ€§é—®é¢˜ã€ç¼“å­˜ç©¿å‡»ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ï¼Œä»¥åŠç¼“å­˜æ±¡æŸ“ç­‰ã€‚è¿™äº›é—®é¢˜å¦‚æœä¸åŠ ä»¥æœ‰æ•ˆå¤„ç†ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œç”šè‡³å¼•å‘æœåŠ¡ä¸å¯ç”¨çš„ä¸¥é‡åæœã€‚</p><p><img src="https://oscimg.oschina.net/oscnet/c2f99605-adfa-4d4b-b592-9abb4171a039.jpg"></p><p>æœ¬æ–‡ä¸»è¦æ¢è®¨ Redis ä½œä¸ºç¼“å­˜ï¼Œåœ¨å®è·µä¸­å¯èƒ½ä¼šæœ‰å“ªäº›é—®é¢˜ã€‚</p><p><strong>æœ¬æ–‡ç›®å½•ï¼š</strong></p><ul><li><p>ä¸ºä»€ä¹ˆè¦ç†è§£ Redis ç¼“å­˜é—®é¢˜</p></li><li><p>ç¼“å­˜ç©¿é€</p></li><li><p>ç¼“å­˜å‡»ç©¿</p></li><li><p>ç¼“å­˜é›ªå´©</p></li><li><p>ç¼“å­˜æ±¡æŸ“</p></li><li><p>æ•°æ®åº“å’Œç¼“å­˜ä¸€è‡´æ€§</p></li></ul><p>Â <strong>1. ä¸ºä»€ä¹ˆè¦ç†è§£ Redis ç¼“å­˜é—®é¢˜</strong></p><hr><p>Redis ç¼“å­˜èƒ½å¤Ÿæ˜¾è‘—æå‡æ•°æ®è®¿é—®é€Ÿåº¦ï¼Œä½†å…¶é—®é¢˜å¸¸ä¸å®é™…ä¸šåŠ¡åœºæ™¯ç›¸å…³ã€‚æ·±å…¥ç†è§£è¿™äº›é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…è®¾è®¡æ›´åŠ å¥å£®å’Œé«˜æ•ˆçš„ç³»ç»Ÿæ¶æ„ã€‚</p><p>åœ¨é«˜å¹¶å‘çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæ•°æ®åº“å¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯ç”¨æˆ·å¹¶å‘è®¿é—®æœ€è–„å¼±çš„ç¯èŠ‚ã€‚æ‰€ä»¥ï¼Œå°±éœ€è¦ä½¿ç”¨ redis åšä¸€ä¸ªç¼“å†²æ“ä½œï¼Œè®©è¯·æ±‚å…ˆè®¿é—®åˆ° redisï¼Œè€Œä¸æ˜¯ç›´æ¥è®¿é—® Mysql ç­‰æ•°æ®åº“ã€‚è¿™æ ·å¯ä»¥å¤§å¤§ç¼“è§£æ•°æ®åº“çš„å‹åŠ›ã€‚</p><p>å½“ç¼“å­˜åº“å‡ºç°æ—¶ï¼Œå¿…é¡»è¦è€ƒè™‘å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li><p>ç¼“å­˜ç©¿é€</p></li><li><p>ç¼“å­˜ç©¿å‡»</p></li><li><p>ç¼“å­˜é›ªå´©</p></li><li><p>ç¼“å­˜æ±¡æŸ“</p></li><li><p>ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§</p></li></ul><p><strong>2. ç¼“å­˜ç©¿é€</strong></p><hr><h3 id="é—®é¢˜å®šä¹‰ï¼š"><a href="#é—®é¢˜å®šä¹‰ï¼š" class="headerlink" title="é—®é¢˜å®šä¹‰ï¼š"></a><strong>é—®é¢˜å®šä¹‰ï¼š</strong></h3><p>ç¼“å­˜ç©¿é€æŒ‡çš„æ˜¯å®¢æˆ·ç«¯é¢‘ç¹è¯·æ±‚æ•°æ®åº“ä¸­æ ¹æœ¬ä¸å­˜åœ¨çš„é”®ï¼Œç”±äºç¼“å­˜ä¸­æ— æ³•å‘½ä¸­ï¼ˆå› ä¸ºæ•°æ®ä¸å­˜åœ¨ï¼Œæ— æ³•å†™å…¥ç¼“å­˜ï¼‰ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“è´Ÿè½½å¢åŠ ã€‚</p><p><img src="https://oscimg.oschina.net/oscnet/c65e3f89-d69d-4d6b-9755-617e6e79042a.jpg"></p><h4 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h4><ol><li><p><strong>å¸ƒéš†è¿‡æ»¤å™¨</strong></p><p>åœ¨ç¼“å­˜å±‚å¢åŠ å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†å¯èƒ½çš„åˆæ³•æ•°æ®æå‰å­˜å‚¨åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œæ‹¦æˆªéæ³•è¯·æ±‚ã€‚</p><p><img src="https://oscimg.oschina.net/oscnet/593a4a05-b12c-457d-adba-49a08df485c1.png"></p></li><li><p><strong>ç¼“å­˜ç©ºå€¼</strong></p><p>å¯¹äºä¸å­˜åœ¨çš„é”®ï¼Œä¹Ÿå°†å…¶å€¼è®¾ç½®ä¸ºÂ  <code>null</code> Â å¹¶ç¼“å­˜ä¸€å®šæ—¶é—´ï¼Œä½†éœ€è¦æ³¨æ„é¿å…ç¼“å­˜æ±¡æŸ“ï¼ˆè¯¦è§åæ–‡ï¼‰ã€‚</p></li></ol><p><strong>3. ç¼“å­˜å‡»ç©¿</strong></p><hr><h3 id="é—®é¢˜å®šä¹‰ï¼š-1"><a href="#é—®é¢˜å®šä¹‰ï¼š-1" class="headerlink" title="é—®é¢˜å®šä¹‰ï¼š"></a><strong>é—®é¢˜å®šä¹‰ï¼š</strong></h3><p>ç¼“å­˜å‡»ç©¿å‘ç”Ÿåœ¨æŸä¸ªçƒ­ç‚¹ç¼“å­˜é”®è¿‡æœŸæ—¶ï¼Œå¤§é‡è¯·æ±‚åŒæ—¶æ¶Œå‘æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“ç¬æ—¶å‹åŠ›è¿‡é«˜ã€‚</p><p><img src="https://oscimg.oschina.net/oscnet/20d818ae-56f8-4670-b615-864d84a706d2.jpg"></p><h4 id="è§£å†³æ–¹æ³•ï¼š-1"><a href="#è§£å†³æ–¹æ³•ï¼š-1" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h4><ol><li><p><strong>è®¾ç½®çƒ­ç‚¹æ•°æ®ä¸è¿‡æœŸ</strong></p><p>å°†çƒ­ç‚¹æ•°æ®çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºæé•¿ï¼Œæˆ–è€…åŠ¨æ€æ›´æ–°çƒ­ç‚¹æ•°æ®çš„è¿‡æœŸæ—¶é—´ã€‚</p></li><li><p><strong>äº’æ–¥é”</strong></p><p>å¯¹è®¿é—®è¿‡æœŸç¼“å­˜çš„è¯·æ±‚åŠ é”ï¼Œåªæœ‰è·å–é”çš„è¯·æ±‚å¯ä»¥åŠ è½½æ•°æ®å¹¶æ›´æ–°ç¼“å­˜ï¼Œå…¶ä½™è¯·æ±‚ç­‰å¾…ã€‚</p></li></ol><p><strong>4. ç¼“å­˜é›ªå´©</strong></p><hr><h3 id="é—®é¢˜å®šä¹‰ï¼š-2"><a href="#é—®é¢˜å®šä¹‰ï¼š-2" class="headerlink" title="é—®é¢˜å®šä¹‰ï¼š"></a>é—®é¢˜å®šä¹‰ï¼š</h3><p>ç¼“å­˜é›ªå´©æŒ‡çš„æ˜¯å¤§é‡ç¼“å­˜æ•°æ®åœ¨åŒä¸€æ—¶é—´æ®µå¤±æ•ˆï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½æ¶Œå‘æ•°æ®åº“ï¼Œå¼•å‘æ•°æ®åº“å´©æºƒã€‚</p><p><img src="https://oscimg.oschina.net/oscnet/16a0b50a-e17d-426f-b208-0455c31f055c.jpg"></p><h4 id="è§£å†³æ–¹æ³•ï¼š-2"><a href="#è§£å†³æ–¹æ³•ï¼š-2" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h4><ol><li><p><strong>ç¼“å­˜è¿‡æœŸæ—¶é—´åˆ†å¸ƒåŒ–</strong></p><p>ä¸ºä¸åŒçš„ç¼“å­˜é”®è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´ï¼Œé¿å…åŒä¸€æ—¶é—´å¤§æ‰¹é‡ç¼“å­˜å¤±æ•ˆã€‚</p></li><li><p><strong>å¤šçº§ç¼“å­˜</strong></p><p>åœ¨ Redis ç¼“å­˜å‰å¢åŠ æœ¬åœ°ç¼“å­˜å±‚ï¼Œå‡è½»æ•°æ®åº“ç›´æ¥å‹åŠ›ã€‚</p></li><li><p><strong>é™çº§é™æµ</strong></p><p>åœ¨æ•°æ®åº“å‹åŠ›è¿‡å¤§æ—¶ï¼Œå¼€å¯æœåŠ¡é™çº§æˆ–è¯·æ±‚é™æµæœºåˆ¶ã€‚</p></li></ol><p><strong>5. ç¼“å­˜æ±¡æŸ“</strong></p><hr><h3 id="é—®é¢˜å®šä¹‰ï¼š-3"><a href="#é—®é¢˜å®šä¹‰ï¼š-3" class="headerlink" title="é—®é¢˜å®šä¹‰ï¼š"></a>é—®é¢˜å®šä¹‰ï¼š</h3><p>ç¼“å­˜æ±¡æŸ“æ˜¯æŒ‡ç¼“å­˜ä¸­å­˜å‚¨äº†ä½å‘½ä¸­ç‡æˆ–æ— æ„ä¹‰çš„æ•°æ®ï¼Œå ç”¨äº†å¤§é‡å†…å­˜èµ„æºï¼Œé™ä½ç¼“å­˜æ•ˆç‡ã€‚</p><p><img src="https://oscimg.oschina.net/oscnet/466f5442-daac-413d-a1c1-84380bc348cf.jpg"></p><h4 id="è§£å†³æ–¹æ³•ï¼š-3"><a href="#è§£å†³æ–¹æ³•ï¼š-3" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h4><ol><li><p><strong>è®¾ç½®ç¼“å­˜æ·˜æ±°ç­–ç•¥</strong></p><p>æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ·˜æ±°ç­–ç•¥ï¼ˆå¦‚ LRUã€LFUï¼‰ã€‚</p></li><li><p><strong>è¿‡æ»¤ä½ä»·å€¼æ•°æ®</strong></p><p>å¯¹å¯èƒ½å½±å“ç¼“å­˜æ•ˆç‡çš„æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œé¿å…å†™å…¥ç¼“å­˜ã€‚</p></li></ol><p><strong>6. æ•°æ®åº“å’Œç¼“å­˜ä¸€è‡´æ€§</strong></p><hr><h3 id="é—®é¢˜å®šä¹‰ï¼š-4"><a href="#é—®é¢˜å®šä¹‰ï¼š-4" class="headerlink" title="é—®é¢˜å®šä¹‰ï¼š"></a>é—®é¢˜å®šä¹‰ï¼š</h3><p>Redis ç¼“å­˜å’Œæ•°æ®åº“ä¸­çš„æ•°æ®å¯èƒ½å‡ºç°ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®æ›´æ–°æ—¶ï¼Œå¯èƒ½å¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®é™ˆæ—§ã€‚</p><p><img src="https://oscimg.oschina.net/oscnet/0699db42-903c-4de3-9d41-03e66c80bc8e.jpg"></p><h4 id="è§£å†³æ–¹æ³•ï¼š-4"><a href="#è§£å†³æ–¹æ³•ï¼š-4" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h4><ol><li><p><strong>åˆ é™¤ç¼“å­˜ç­–ç•¥</strong></p><p>åœ¨æ›´æ–°æ•°æ®åº“åç«‹å³åˆ é™¤ç¼“å­˜ï¼Œä½¿ä¸‹ä¸€æ¬¡è®¿é—®é‡æ–°åŠ è½½æœ€æ–°æ•°æ®ã€‚</p><p>æ³¨æ„ï¼Œæˆ‘ä»¬çš„æ›´æ–°æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼ŒæˆåŠŸåï¼Œè®©ç¼“å­˜å¤±æ•ˆã€‚</p></li><li><p><strong>å»¶æ—¶åŒåˆ ç­–ç•¥</strong></p><p>åœ¨æ›´æ–°æ•°æ®åº“åï¼Œåˆ é™¤ç¼“å­˜ï¼Œå¹¶åœ¨ä¸€å®šå»¶æ—¶åå†æ¬¡åˆ é™¤ç¼“å­˜ï¼Œç¡®ä¿ç¼“å­˜æ•°æ®æ›´æ–°ã€‚</p><p><img src="https://oscimg.oschina.net/oscnet/45ef7f3f-0832-46c1-84f5-65a58ae0aacf.jpg"></p></li><li><p><strong>è®¢é˜…é€šçŸ¥</strong></p><p>é€šè¿‡ Redis çš„ Pub&#x2F;Sub åŠŸèƒ½æˆ–ç±»ä¼¼å·¥å…·ï¼ˆå¦‚ Canalï¼‰ç›‘å¬æ•°æ®åº“å˜æ›´å¹¶åŒæ­¥æ›´æ–°ç¼“å­˜ã€‚</p></li></ol><h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a><strong>ç»“è¯­</strong></h3><hr><p>Redis æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç¼“å­˜å·¥å…·ï¼Œä½†åœ¨é«˜å¹¶å‘åœºæ™¯ä¸­ï¼Œç¼“å­˜ç›¸å…³é—®é¢˜å¦‚ç©¿é€ã€å‡»ç©¿å’Œé›ªå´©å¯èƒ½ä¸¥é‡å½±å“ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚äº†è§£è¿™äº›é—®é¢˜å¹¶é‡‡ç”¨åˆé€‚çš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯è®¾è®¡é«˜æ€§èƒ½ç³»ç»Ÿçš„å…³é”®ã€‚å¸Œæœ›æœ¬æ–‡èƒ½ä¸ºæ‚¨è§£å†³å®é™…é—®é¢˜æä¾›å¸®åŠ©ï¼</p><hr>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>@Transactional å¤±æ•ˆåœºæ™¯</title>
    <link href="/article/e0bb1c9a.html"/>
    <url>/article/e0bb1c9a.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />  <p>åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œéœ€è¦åŒæ—¶å†™å…¥å¤šå¼ è¡¨çš„æ•°æ®æˆ–è€…æ‰§è¡Œå¤šæ¡sqlã€‚ä¸ºäº†ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼ˆè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼‰ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šç”¨åˆ°springäº‹åŠ¡ã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/cd5de7a66d2a919e9210b222a7dce169.png" alt="å¼ºå¤§çš„springæ¡†æ¶ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç®€å•çš„æ³¨è§£ï¼š@Transactionalï¼Œå°±èƒ½è½»æ¾æå®šäº‹åŠ¡ï¼Œä¸€ç›´ç”¨ä¸€ç›´çˆ½å•Šï¼ï¼"></p><h2 id="ä¸€-ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘"><a href="#ä¸€-ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘" class="headerlink" title="ä¸€ ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘"></a>ä¸€ ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘</h2><h3 id="1-è®¿é—®æƒé™é—®é¢˜-åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ"><a href="#1-è®¿é—®æƒé™é—®é¢˜-åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ" class="headerlink" title="1.è®¿é—®æƒé™é—®é¢˜ (åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ)"></a>1.è®¿é—®æƒé™é—®é¢˜ (åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ)</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œjavaçš„è®¿é—®æƒé™ä¸»è¦æœ‰å››ç§ï¼šprivateã€defaultã€protectedã€publicï¼Œå®ƒä»¬çš„æƒé™ä»å·¦åˆ°å³ï¼Œä¾æ¬¡å˜å¤§ã€‚</p><p>ä½†å¦‚æœæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒæŠŠæœ‰æŸäº›äº‹åŠ¡æ–¹æ³•ï¼Œå®šä¹‰äº†é”™è¯¯çš„è®¿é—®æƒé™ï¼Œå°±ä¼šå¯¼è‡´äº‹åŠ¡åŠŸèƒ½å‡ºé—®é¢˜ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-keyword">@Transactional</span><br>    private void add(UserModel userModel) &#123;<br>         <span class="hljs-built_in">saveData</span>(userModel);<br>         <span class="hljs-built_in">updateData</span>(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•çš„è®¿é—®æƒé™è¢«å®šä¹‰æˆäº†privateï¼Œè¿™æ ·ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Œspringè¦æ±‚è¢«ä»£ç†æ–¹æ³•å¿…é¡»å¾—æ˜¯publicçš„ã€‚</p><p>è¯´ç™½äº†ï¼Œåœ¨AbstractFallbackTransactionAttributeSourceç±»çš„computeTransactionAttributeæ–¹æ³•ä¸­æœ‰ä¸ªåˆ¤æ–­ï¼Œ<strong>å¦‚æœç›®æ ‡æ–¹æ³•ä¸æ˜¯public</strong>ï¼Œåˆ™TransactionAttributeè¿”å›nullï¼Œå³ä¸æ”¯æŒäº‹åŠ¡ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">protected TransactionAttribute compute<span class="hljs-constructor">TransactionAttribute(Method <span class="hljs-params">method</span>, @Nullable Class&lt;?&gt; <span class="hljs-params">targetClass</span>)</span> &#123;<br>    <span class="hljs-comment">// Don&#x27;t allow no-public methods as required.å¯ä»¥çœ‹åˆ°ï¼Œ è¿™é‡Œä¸æ”¯æŒpublicç±»å‹çš„æ–¹æ³•</span><br>    <span class="hljs-keyword">if</span> (allow<span class="hljs-constructor">PublicMethodsOnly()</span><span class="hljs-operator"> &amp;&amp; </span>!<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Modifier</span>.</span></span>is<span class="hljs-constructor">Public(<span class="hljs-params">method</span>.<span class="hljs-params">getModifiers</span>()</span>)) &#123;<br>      return null;<br>    &#125;<br><br>    <span class="hljs-comment">// The method may be on an interface, but we need attributes from the target class.</span><br>    <span class="hljs-comment">// If the target class is null, the method will be unchanged.</span><br>    Method specificMethod = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AopUtils</span>.</span></span>get<span class="hljs-constructor">MostSpecificMethod(<span class="hljs-params">method</span>, <span class="hljs-params">targetClass</span>)</span>;<br><br>    <span class="hljs-comment">// First try is the method in the target class.</span><br>    TransactionAttribute txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">specificMethod</span>)</span>;<br>    <span class="hljs-keyword">if</span> (txAttr != null) &#123;<br>      return txAttr;<br>    &#125;<br><br>    <span class="hljs-comment">// Second try is the transaction attribute on the target class.</span><br>    txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">specificMethod</span>.<span class="hljs-params">getDeclaringClass</span>()</span>);<br>    <span class="hljs-keyword">if</span> (txAttr != null<span class="hljs-operator"> &amp;&amp; </span><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ClassUtils</span>.</span></span>is<span class="hljs-constructor">UserLevelMethod(<span class="hljs-params">method</span>)</span>) &#123;<br>      return txAttr;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (specificMethod != <span class="hljs-keyword">method</span>) &#123;<br>      <span class="hljs-comment">// Fallback is to look at the original method.</span><br>      txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">method</span>)</span>;<br>      <span class="hljs-keyword">if</span> (txAttr != null) &#123;<br>        return txAttr;<br>      &#125;<br>      <span class="hljs-comment">// Last fallback is the class of the original method.</span><br>      txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">method</span>.<span class="hljs-params">getDeclaringClass</span>()</span>);<br>      <span class="hljs-keyword">if</span> (txAttr != null<span class="hljs-operator"> &amp;&amp; </span><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ClassUtils</span>.</span></span>is<span class="hljs-constructor">UserLevelMethod(<span class="hljs-params">method</span>)</span>) &#123;<br>        return txAttr;<br>      &#125;<br>    &#125;<br>    return null;<br>  &#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰çš„äº‹åŠ¡æ–¹æ³•ï¼ˆå³ç›®æ ‡æ–¹æ³•ï¼‰ï¼Œå®ƒçš„è®¿é—®æƒé™ä¸æ˜¯publicï¼Œè€Œæ˜¯privateã€defaultæˆ–protectedçš„è¯ï¼Œspringåˆ™ä¸ä¼šæä¾›äº‹åŠ¡åŠŸèƒ½ã€‚</p><h3 id="2-æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ"><a href="#2-æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ" class="headerlink" title="2.æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ"></a>2.æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ</h3><p>æœ‰æ—¶å€™ï¼ŒæŸä¸ªæ–¹æ³•ä¸æƒ³è¢«å­ç±»é‡æ–°ï¼Œè¿™æ—¶å¯ä»¥å°†è¯¥æ–¹æ³•å®šä¹‰æˆfinalçš„ã€‚æ™®é€šæ–¹æ³•è¿™æ ·å®šä¹‰æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†å¦‚æœå°†äº‹åŠ¡æ–¹æ³•å®šä¹‰æˆfinalï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(UserModel userModel)</span></span>&#123;<br>        saveData(userModel);<br>        updateData(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•è¢«å®šä¹‰æˆäº†finalçš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´<a href="https://so.csdn.net/so/search?q=%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88&spm=1001.2101.3001.7020">äº‹åŠ¡å¤±æ•ˆ</a>ã€‚</p><p>ä¸ºä»€ä¹ˆï¼Ÿ</p><p>å¦‚æœä½ çœ‹è¿‡<a href="https://so.csdn.net/so/search?q=spring%E4%BA%8B%E5%8A%A1&spm=1001.2101.3001.7020">springäº‹åŠ¡</a>çš„æºç ï¼Œå¯èƒ½ä¼šçŸ¥é“springäº‹åŠ¡åº•å±‚ä½¿ç”¨äº†aopï¼Œä¹Ÿå°±æ˜¯é€šè¿‡jdkåŠ¨æ€ä»£ç†æˆ–è€…cglibï¼Œå¸®æˆ‘ä»¬ç”Ÿæˆäº†ä»£ç†ç±»ï¼Œåœ¨ä»£ç†ç±»ä¸­å®ç°çš„äº‹åŠ¡åŠŸèƒ½ã€‚<strong>ä½†å¦‚æœæŸä¸ªæ–¹æ³•ç”¨finalä¿®é¥°äº†ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„ä»£ç†ç±»ä¸­ï¼Œå°±æ— æ³•é‡å†™è¯¥æ–¹æ³•</strong>ï¼Œè€Œæ·»åŠ äº‹åŠ¡åŠŸèƒ½ã€‚</p><p>æ³¨æ„ï¼šå¦‚æœæŸä¸ªæ–¹æ³•æ˜¯staticçš„ï¼ŒåŒæ ·æ— æ³•é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œå˜æˆäº‹åŠ¡æ–¹æ³•ã€‚</p><h3 id="3-åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ"><a href="#3-åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ" class="headerlink" title="3.åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ"></a>3.åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨æŸä¸ªServiceç±»çš„æŸä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserMapper</span> userMapper;<br><br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">UserModel userModel</span>) &#123;<br>        userMapper.<span class="hljs-title function_">insertUser</span>(userModel);<br>        <span class="hljs-title function_">updateStatus</span>(userModel);<br>    &#125;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">updateStatus</span>(<span class="hljs-params">UserModel userModel</span>) &#123;<br>        <span class="hljs-title function_">doSameThing</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°åœ¨äº‹åŠ¡æ–¹æ³•addä¸­ï¼Œç›´æ¥è°ƒç”¨äº‹åŠ¡æ–¹æ³•updateStatusã€‚ä»å‰é¢ä»‹ç»çš„å†…å®¹å¯ä»¥çŸ¥é“ï¼ŒupdateStatusæ–¹æ³•æ‹¥æœ‰äº‹åŠ¡çš„èƒ½åŠ›æ˜¯å› ä¸ºspring aopç”Ÿæˆä»£ç†äº†å¯¹è±¡ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ç›´æ¥è°ƒç”¨äº†thiså¯¹è±¡çš„æ–¹æ³•ï¼Œæ‰€ä»¥updateStatusæ–¹æ³•ä¸ä¼šç”Ÿæˆäº‹åŠ¡ã€‚<a href="https://blog.csdn.net/yyoc97/article/details/81911744">æ ¹æœ¬åŸå› </a> <a href="https://blog.csdn.net/mccand1234/article/details/124578233">æ ¹æœ¬åŸå› 2</a></p><p>ç”±æ­¤å¯è§ï¼Œåœ¨åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæœ‰äº›åœºæ™¯ï¼Œç¡®å®æƒ³åœ¨åŒä¸€ä¸ªç±»çš„æŸä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨å®ƒè‡ªå·±çš„å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h4 id="3-1-æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•"><a href="#3-1-æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•" class="headerlink" title="3.1 æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•"></a>3.1 æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•</h4><p>è¿™ä¸ªæ–¹æ³•éå¸¸ç®€å•ï¼Œåªéœ€è¦æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•ï¼ŒæŠŠ@Transactionalæ³¨è§£åŠ åˆ°æ–°Serviceæ–¹æ³•ä¸Šï¼ŒæŠŠéœ€è¦äº‹åŠ¡æ‰§è¡Œçš„ä»£ç ç§»åˆ°æ–°æ–¹æ³•ä¸­ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Servcie</span><br>public class ServiceA &#123;<br>   <span class="hljs-keyword">@Autowired</span><br>   prvate ServiceB serviceB;<br><br>   public void <span class="hljs-built_in">save</span>(User user) &#123;<br>         <span class="hljs-built_in">queryData1</span>();<br>         <span class="hljs-built_in">queryData2</span>();<br>         serviceB<span class="hljs-selector-class">.doSave</span>(user);<br>   &#125;<br> &#125;<br><br> <span class="hljs-keyword">@Servcie</span><br> public class ServiceB &#123;<br><br>    <span class="hljs-keyword">@Transactional</span>(rollbackFor=Exception.class)<br>    public void doSave(User user) &#123;<br>       <span class="hljs-built_in">addData1</span>();<br>       <span class="hljs-built_in">updateData2</span>();<br>    &#125;<br><br> &#125;<br></code></pre></td></tr></table></figure><h4 id="3-2-åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±"><a href="#3-2-åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±" class="headerlink" title="3.2 åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±"></a>3.2 åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±</h4><p>å¦‚æœä¸æƒ³å†æ–°åŠ ä¸€ä¸ªServiceç±»ï¼Œåœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±ä¹Ÿæ˜¯ä¸€ç§é€‰æ‹©ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Servcie</span><br>public class ServiceA &#123;<br>   <span class="hljs-keyword">@Autowired</span><br>   prvate ServiceA serviceA;<br><br>   public void <span class="hljs-built_in">save</span>(User user) &#123;<br>         <span class="hljs-built_in">queryData1</span>();<br>         <span class="hljs-built_in">queryData2</span>();<br>         serviceA<span class="hljs-selector-class">.doSave</span>(user);<br>   &#125;<br><br>   <span class="hljs-keyword">@Transactional</span>(rollbackFor=Exception.class)<br>   public void doSave(User user) &#123;<br>       <span class="hljs-built_in">addData1</span>();<br>       <span class="hljs-built_in">updateData2</span>();<br>    &#125;<br> &#125;<br></code></pre></td></tr></table></figure><p>å¯èƒ½æœ‰äº›äººå¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼šè¿™ç§åšæ³•ä¼šä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿ</p><p>ç­”æ¡ˆï¼šä¸ä¼šã€‚</p><p>å…¶å®spring iocå†…éƒ¨çš„<a href="https://blog.csdn.net/mccand1234/article/details/116403266">ä¸‰çº§ç¼“å­˜</a>ä¿è¯äº†å®ƒï¼Œä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</p><h4 id="3-3-é€šè¿‡AopContentç±»"><a href="#3-3-é€šè¿‡AopContentç±»" class="headerlink" title="3.3 é€šè¿‡AopContentç±»"></a>3.3 é€šè¿‡AopContentç±»</h4><p>åœ¨è¯¥Serviceç±»ä¸­ä½¿ç”¨AopContext.currentProxy()è·å–ä»£ç†å¯¹è±¡</p><p>ä¸Šé¢çš„æ–¹æ³•2ç¡®å®å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ä»£ç çœ‹èµ·æ¥å¹¶ä¸ç›´è§‚ï¼Œè¿˜å¯ä»¥é€šè¿‡åœ¨è¯¥Serviceç±»ä¸­ä½¿ç”¨AOPProxyè·å–ä»£ç†å¯¹è±¡ï¼Œå®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Servcie</span><br>public class ServiceA &#123;<br><br>   public void <span class="hljs-built_in">save</span>(User user) &#123;<br>         <span class="hljs-built_in">queryData1</span>();<br>         <span class="hljs-built_in">queryData2</span>();<br>         ((ServiceA)AopContext<span class="hljs-selector-class">.currentProxy</span>())<span class="hljs-selector-class">.doSave</span>(user);<br>   &#125;<br><br>   <span class="hljs-keyword">@Transactional</span>(rollbackFor=Exception.class)<br>   public void doSave(User user) &#123;<br>       <span class="hljs-built_in">addData1</span>();<br>       <span class="hljs-built_in">updateData2</span>();<br>    &#125;<br> &#125;<br></code></pre></td></tr></table></figure><h3 id="4-ç±»æœ¬èº«-æœªè¢«springç®¡ç†"><a href="#4-ç±»æœ¬èº«-æœªè¢«springç®¡ç†" class="headerlink" title="4.(ç±»æœ¬èº«) æœªè¢«springç®¡ç†"></a>4.(ç±»æœ¬èº«) æœªè¢«springç®¡ç†</h3><p>åœ¨æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªç»†èŠ‚å¾ˆå®¹æ˜“è¢«å¿½ç•¥ã€‚å³ä½¿ç”¨springäº‹åŠ¡çš„å‰ææ˜¯ï¼šå¯¹è±¡è¦è¢«springç®¡ç†ï¼Œéœ€è¦åˆ›å»ºbeanå®ä¾‹ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡@Controllerã€@Serviceã€@Componentã€@Repositoryç­‰æ³¨è§£ï¼Œå¯ä»¥è‡ªåŠ¨å®ç°beanå®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ã€‚å½“ç„¶åˆ›å»ºbeanå®ä¾‹çš„æ–¹æ³•è¿˜æœ‰å¾ˆå¤šï¼Œä¸ä¸€ä¸€è¯´äº†ã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š@Autowiredçš„è¿™äº›éªšæ“ä½œï¼Œä½ éƒ½çŸ¥é“å—ï¼Ÿ</p><p>å¦‚ä¸‹æ‰€ç¤º, å¼€å‘äº†ä¸€ä¸ªServiceç±»ï¼Œä½†å¿˜äº†åŠ @Serviceæ³¨è§£ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">UserModel userModel</span>) &#123;<br>         <span class="hljs-title function_">saveData</span>(userModel);<br>         <span class="hljs-title function_">updateData</span>(userModel);<br>    &#125;    <br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°UserServiceç±»æ²¡æœ‰åŠ @Serviceæ³¨è§£ï¼Œé‚£ä¹ˆè¯¥ç±»ä¸ä¼šäº¤ç»™springç®¡ç†ï¼Œæ‰€ä»¥å®ƒçš„addæ–¹æ³•ä¹Ÿä¸ä¼šç”Ÿæˆäº‹åŠ¡ã€‚</p><h3 id="5-å¤šçº¿ç¨‹è°ƒç”¨"><a href="#5-å¤šçº¿ç¨‹è°ƒç”¨" class="headerlink" title="5.å¤šçº¿ç¨‹è°ƒç”¨"></a>5.å¤šçº¿ç¨‹è°ƒç”¨</h3><p>åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œå¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯è¿˜æ˜¯æŒºå¤šçš„ã€‚å¦‚æœspringäº‹åŠ¡ç”¨åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­ï¼Œä¼šæœ‰é—®é¢˜å—ï¼Ÿ</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Slf</span>4j<br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RoleService roleService;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(UserModel userModel)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        userMapper.insertUser(userModel);<br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            roleService.doOtherThing();<br>        &#125;).start();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoleService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doOtherThing</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¿å­˜roleè¡¨æ•°æ®&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº‹åŠ¡æ–¹æ³•addä¸­ï¼Œè°ƒç”¨äº†äº‹åŠ¡æ–¹æ³•doOtherThingï¼Œä½†æ˜¯äº‹åŠ¡æ–¹æ³•doOtherThingæ˜¯åœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨çš„ã€‚</p><p>è¿™æ ·ä¼šå¯¼è‡´ä¸¤ä¸ªæ–¹æ³•ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè·å–åˆ°çš„æ•°æ®åº“è¿æ¥ä¸ä¸€æ ·ï¼Œä»è€Œæ˜¯ä¸¤ä¸ªä¸åŒçš„äº‹åŠ¡ã€‚å¦‚æœæƒ³doOtherThingæ–¹æ³•ä¸­æŠ›äº†å¼‚å¸¸ï¼Œaddæ–¹æ³•ä¹Ÿå›æ»šæ˜¯ä¸å¯èƒ½çš„ã€‚</p><p>å¦‚æœçœ‹è¿‡springäº‹åŠ¡æºç çš„æœ‹å‹ï¼Œå¯èƒ½ä¼šçŸ¥é“springçš„äº‹åŠ¡æ˜¯é€šè¿‡æ•°æ®åº“è¿æ¥æ¥å®ç°çš„ã€‚å½“å‰çº¿ç¨‹ä¸­ä¿å­˜äº†ä¸€ä¸ªmapï¼Œkeyæ˜¯æ•°æ®æºï¼Œvalueæ˜¯æ•°æ®åº“è¿æ¥ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">Object</span>, <span class="hljs-built_in">Object</span>&gt;&gt; resources =<br><br>  <span class="hljs-keyword">new</span> NamedThreadLocal&lt;&gt;(<span class="hljs-string">&quot;Transactional resources&quot;</span>);<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¯´çš„åŒä¸€ä¸ªäº‹åŠ¡ï¼Œå…¶å®æ˜¯æŒ‡åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œåªæœ‰æ‹¥æœ‰åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥æ‰èƒ½åŒæ—¶æäº¤å’Œå›æ»šã€‚å¦‚æœåœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œæ‹¿åˆ°çš„æ•°æ®åº“è¿æ¥è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ˜¯ä¸åŒçš„äº‹åŠ¡ã€‚</p><h3 id="6-å­˜å‚¨å¼•æ“-è¡¨ä¸æ”¯æŒäº‹åŠ¡"><a href="#6-å­˜å‚¨å¼•æ“-è¡¨ä¸æ”¯æŒäº‹åŠ¡" class="headerlink" title="6.(å­˜å‚¨å¼•æ“)è¡¨ä¸æ”¯æŒäº‹åŠ¡"></a>6.(å­˜å‚¨å¼•æ“)è¡¨ä¸æ”¯æŒäº‹åŠ¡</h3><p>å‘¨æ‰€å‘¨çŸ¥ï¼Œåœ¨mysql5ä¹‹å‰ï¼Œé»˜è®¤çš„æ•°æ®åº“å¼•æ“æ˜¯myisamã€‚</p><p>å®ƒçš„å¥½å¤„å°±ä¸ç”¨å¤šè¯´äº†ï¼šç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå¯¹äºæŸ¥å¤šå†™å°‘çš„å•è¡¨æ“ä½œï¼Œæ€§èƒ½æ¯”innodbæ›´å¥½ã€‚</p><p>æœ‰äº›è€é¡¹ç›®ä¸­ï¼Œå¯èƒ½è¿˜åœ¨ç”¨å®ƒã€‚</p><p>åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠENGINEå‚æ•°è®¾ç½®æˆMyISAMå³å¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `category` (<br>  `id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `one_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `two_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `three_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `four_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>MyISAM AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">4</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_bin<br></code></pre></td></tr></table></figure><p>myisamå¥½ç”¨ï¼Œä½†æœ‰ä¸ªå¾ˆè‡´å‘½çš„é—®é¢˜æ˜¯ï¼š<strong>ä¸æ”¯æŒäº‹åŠ¡</strong>ã€‚</p><p>å¦‚æœåªæ˜¯å•è¡¨æ“ä½œè¿˜å¥½ï¼Œä¸ä¼šå‡ºç°å¤ªå¤§çš„é—®é¢˜ã€‚ä½†å¦‚æœéœ€è¦è·¨å¤šå¼ è¡¨æ“ä½œï¼Œç”±äºå…¶ä¸æ”¯æŒäº‹åŠ¡ï¼Œæ•°æ®ææœ‰å¯èƒ½ä¼šå‡ºç°ä¸å®Œæ•´çš„æƒ…å†µã€‚</p><p>æ­¤å¤–ï¼Œmyisamè¿˜ä¸æ”¯æŒè¡Œé”å’Œå¤–é”®ã€‚</p><p>æ‰€ä»¥åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œmyisamä½¿ç”¨çš„å¹¶ä¸å¤šã€‚åœ¨mysql5ä»¥åï¼Œmyisamå·²ç»é€æ¸é€€å‡ºäº†å†å²çš„èˆå°ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯innodbã€‚</p><p>æœ‰æ—¶å€™æˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æŸå¼ è¡¨çš„äº‹åŠ¡ä¸€ç›´éƒ½æ²¡æœ‰ç”Ÿæ•ˆï¼Œé‚£ä¸ä¸€å®šæ˜¯springäº‹åŠ¡çš„é”…ï¼Œæœ€å¥½ç¡®è®¤ä¸€ä¸‹ä½ ä½¿ç”¨çš„é‚£å¼ è¡¨ï¼Œæ˜¯å¦æ”¯æŒäº‹åŠ¡ã€‚</p><h3 id="7-æœªå¼€å¯äº‹åŠ¡"><a href="#7-æœªå¼€å¯äº‹åŠ¡" class="headerlink" title="7.æœªå¼€å¯äº‹åŠ¡"></a>7.æœªå¼€å¯äº‹åŠ¡</h3><p>æœ‰æ—¶å€™ï¼Œäº‹åŠ¡æ²¡æœ‰ç”Ÿæ•ˆçš„æ ¹æœ¬åŸå› æ˜¯æ²¡æœ‰å¼€å¯äº‹åŠ¡ã€‚</p><p>ä½ çœ‹åˆ°è¿™å¥è¯å¯èƒ½ä¼šè§‰å¾—å¥½ç¬‘ã€‚</p><p>å¼€å¯äº‹åŠ¡ä¸æ˜¯ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæœ€æœ€æœ€åŸºæœ¬çš„åŠŸèƒ½å—ï¼Ÿ</p><p>ä¸ºä»€ä¹ˆè¿˜ä¼šæ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Ÿ</p><p>æ²¡é”™ï¼Œå¦‚æœé¡¹ç›®å·²ç»æ­å»ºå¥½äº†ï¼Œäº‹åŠ¡åŠŸèƒ½è‚¯å®šæ˜¯æœ‰çš„ã€‚</p><p>ä½†å¦‚æœä½ æ˜¯åœ¨æ­å»ºé¡¹ç›®demoçš„æ—¶å€™ï¼Œåªæœ‰ä¸€å¼ è¡¨ï¼Œè€Œè¿™å¼ è¡¨çš„äº‹åŠ¡æ²¡æœ‰ç”Ÿæ•ˆã€‚é‚£ä¹ˆä¼šæ˜¯ä»€ä¹ˆåŸå› é€ æˆçš„å‘¢ï¼Ÿ</p><p>å½“ç„¶åŸå› æœ‰å¾ˆå¤šï¼Œä½†æ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Œè¿™ä¸ªåŸå› æå…¶å®¹æ˜“è¢«å¿½ç•¥ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯springbooté¡¹ç›®ï¼Œé‚£ä¹ˆä½ å¾ˆå¹¸è¿ã€‚å› ä¸ºspringbooté€šè¿‡DataSourceTransactionManagerAutoConfigurationç±»ï¼Œå·²ç»é»˜é»˜çš„å¸®ä½ å¼€å¯äº†äº‹åŠ¡ã€‚</p><p>ä½ æ‰€è¦åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œåªéœ€è¦é…ç½®spring.datasourceç›¸å…³å‚æ•°å³å¯ã€‚</p><p>ä½†å¦‚æœä½ ä½¿ç”¨çš„è¿˜æ˜¯ä¼ ç»Ÿçš„springé¡¹ç›®ï¼Œåˆ™éœ€è¦åœ¨applicationContext.xmlæ–‡ä»¶ä¸­ï¼Œæ‰‹åŠ¨é…ç½®äº‹åŠ¡ç›¸å…³å‚æ•°ã€‚å¦‚æœå¿˜äº†é…ç½®ï¼Œäº‹åŠ¡è‚¯å®šæ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚</p><p>å…·ä½“é…ç½®å¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨ --&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;advice&quot;</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRED&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span> <br><span class="hljs-comment">&lt;!-- ç”¨åˆ‡ç‚¹æŠŠäº‹åŠ¡åˆ‡è¿›å» --&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.susan.*.*(..))&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pointcut&quot;</span>/&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;advice&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pointcut&quot;</span>/&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span> <br><br></code></pre></td></tr></table></figure><p>é»˜é»˜çš„è¯´ä¸€å¥ï¼Œå¦‚æœåœ¨pointcutæ ‡ç­¾ä¸­çš„åˆ‡å…¥ç‚¹åŒ¹é…è§„åˆ™ï¼Œé…é”™äº†çš„è¯ï¼Œæœ‰äº›ç±»çš„äº‹åŠ¡ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚</p><h2 id="äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘"><a href="#äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘" class="headerlink" title="äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘"></a>äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘</h2><h3 id="1-é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§"><a href="#1-é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§" class="headerlink" title="1.é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§"></a>1.é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§</h3><p>å…¶å®ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨@Transactionalæ³¨è§£æ—¶ï¼Œæ˜¯å¯ä»¥æŒ‡å®špropagationå‚æ•°çš„ã€‚</p><p>è¯¥å‚æ•°çš„ä½œç”¨æ˜¯æŒ‡å®šäº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§ï¼Œspringç›®å‰æ”¯æŒ7ç§ä¼ æ’­ç‰¹æ€§ï¼š</p><p>REQUIRED å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œé‚£ä¹ˆåŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ˜¯é»˜è®¤çš„ä¼ æ’­å±æ€§å€¼ã€‚<br>SUPPORTS å¦‚æœå½“å‰ä¸Šä¸‹æ–‡å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æ”¯æŒäº‹åŠ¡åŠ å…¥äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä½¿ç”¨éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œã€‚<br>MANDATORY å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚<br>REQUIRES_NEW æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶ä¸”åŒæ—¶å°†ä¸Šä¸‹æ–‡ä¸­çš„äº‹åŠ¡æŒ‚èµ·ï¼Œæ‰§è¡Œå½“å‰æ–°å»ºäº‹åŠ¡å®Œæˆä»¥åï¼Œä¸Šä¸‹æ–‡äº‹åŠ¡æ¢å¤å†æ‰§è¡Œã€‚<br>NOT_SUPPORTED å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œç„¶åæ–°çš„æ–¹æ³•åœ¨æ²¡æœ‰äº‹åŠ¡çš„ç¯å¢ƒä¸­æ‰§è¡Œã€‚<br>NEVER å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™åœ¨æ— äº‹åŠ¡ç¯å¢ƒä¸Šæ‰§è¡Œä»£ç ã€‚<br>NESTED å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åµŒå¥—äº‹åŠ¡æ‰§è¡Œï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æ–°å»ºäº‹åŠ¡ã€‚<br>å¦‚æœæˆ‘ä»¬åœ¨æ‰‹åŠ¨è®¾ç½®propagationå‚æ•°çš„æ—¶å€™ï¼ŒæŠŠä¼ æ’­ç‰¹æ€§è®¾ç½®é”™äº†ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Transactional(propagation = Propagation.NEVER)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(UserModel userModel)</span> &#123;<br>        saveData(userModel);<br>        updateData(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•çš„äº‹åŠ¡ä¼ æ’­ç‰¹æ€§å®šä¹‰æˆäº†Propagation.NEVERï¼Œè¿™ç§ç±»å‹çš„ä¼ æ’­ç‰¹æ€§ä¸æ”¯æŒäº‹åŠ¡ï¼Œå¦‚æœæœ‰äº‹åŠ¡åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚</p><p>ç›®å‰åªæœ‰è¿™ä¸‰ç§ä¼ æ’­ç‰¹æ€§æ‰ä¼šåˆ›å»ºæ–°äº‹åŠ¡ï¼šREQUIREDï¼ŒREQUIRES_NEWï¼ŒNESTEDã€‚</p><h3 id="2-è‡ªå·±åäº†å¼‚å¸¸"><a href="#2-è‡ªå·±åäº†å¼‚å¸¸" class="headerlink" title="2.è‡ªå·±åäº†å¼‚å¸¸"></a>2.è‡ªå·±åäº†å¼‚å¸¸</h3><p>äº‹åŠ¡ä¸ä¼šå›æ»šï¼Œæœ€å¸¸è§çš„é—®é¢˜æ˜¯ï¼šå¼€å‘è€…åœ¨ä»£ç ä¸­æ‰‹åŠ¨tryâ€¦catchäº†å¼‚å¸¸ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-variable">@Transactional</span><br>    public void <span class="hljs-built_in">add</span>(UserModel userModel) &#123;<br>        <span class="hljs-selector-tag">try</span> &#123;<br>            <span class="hljs-selector-tag">saveData</span>(userModel);<br>            <span class="hljs-selector-tag">updateData</span>(userModel);<br>        &#125; <span class="hljs-selector-tag">catch</span> (Exception e) &#123;<br>            <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.error</span>(e.<span class="hljs-built_in">getMessage</span>(), e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹springäº‹åŠ¡å½“ç„¶ä¸ä¼šå›æ»šï¼Œå› ä¸ºå¼€å‘è€…<strong>è‡ªå·±æ•è·äº†å¼‚å¸¸</strong>ï¼Œåˆæ²¡æœ‰æ‰‹åŠ¨æŠ›å‡ºï¼Œæ¢å¥è¯è¯´å°±æ˜¯æŠŠå¼‚å¸¸åæ‰äº†ã€‚</p><p>å¦‚æœæƒ³è¦springäº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸å›æ»šï¼Œå¿…é¡»æŠ›å‡ºå®ƒèƒ½å¤Ÿå¤„ç†çš„å¼‚å¸¸ã€‚å¦‚æœæ²¡æœ‰æŠ›å¼‚å¸¸ï¼Œåˆ™springè®¤ä¸ºç¨‹åºæ˜¯æ­£å¸¸çš„ã€‚</p><h3 id="3-æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸"><a href="#3-æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸" class="headerlink" title="3.æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸"></a>3.æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸</h3><p>å³ä½¿å¼€å‘è€…æ²¡æœ‰æ‰‹åŠ¨æ•è·å¼‚å¸¸ï¼Œä½†å¦‚æœæŠ›çš„å¼‚å¸¸ä¸æ­£ç¡®ï¼Œspringäº‹åŠ¡ä¹Ÿä¸ä¼šå›æ»šã€‚</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Slf</span>4j<br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(UserModel userModel)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>             saveData(userModel);<br>             updateData(userModel);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.<span class="hljs-keyword">error</span>(e.getMessage(), e);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™ç§æƒ…å†µï¼Œå¼€å‘äººå‘˜è‡ªå·±æ•è·äº†å¼‚å¸¸ï¼Œåˆæ‰‹åŠ¨æŠ›å‡ºäº†å¼‚å¸¸ï¼šExceptionï¼Œäº‹åŠ¡åŒæ ·ä¸ä¼šå›æ»šã€‚  </p><p>å› ä¸ºspringäº‹åŠ¡ï¼Œé»˜è®¤æƒ…å†µä¸‹åªä¼šå›æ»šRuntimeExceptionï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰å’ŒErrorï¼ˆé”™è¯¯ï¼‰ï¼Œå¯¹äºæ™®é€šçš„Exceptionï¼ˆ<a href="https://blog.csdn.net/mccand1234/article/details/51579425?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165164871416780357228953%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=165164871416780357228953&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-51579425.nonecase&utm_term=error&spm=1018.2226.3001.4450">éè¿è¡Œæ—¶å¼‚å¸¸</a>ï¼‰ï¼Œå®ƒä¸ä¼šå›æ»šã€‚æ¯”å¦‚å¸¸è§çš„IOExeptionå’ŒSQLException</p><h3 id="4-è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸"><a href="#4-è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸" class="headerlink" title="4.è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸"></a>4.è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸</h3><p>åœ¨ä½¿ç”¨@Transactionalæ³¨è§£å£°æ˜äº‹åŠ¡æ—¶ï¼Œæœ‰æ—¶æˆ‘ä»¬æƒ³è‡ªå®šä¹‰å›æ»šçš„å¼‚å¸¸ï¼Œspringä¹Ÿæ˜¯æ”¯æŒçš„ã€‚å¯ä»¥é€šè¿‡è®¾ç½®rollbackForå‚æ•°ï¼Œæ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p><p>ä½†å¦‚æœè¿™ä¸ªå‚æ•°çš„å€¼è®¾ç½®é”™äº†ï¼Œå°±ä¼šå¼•å‡ºä¸€äº›è«åå…¶å¦™çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-variable">@Transactional</span>(rollbackFor = BusinessException.class)<br>    public void <span class="hljs-built_in">add</span>(UserModel userModel) throws Exception &#123;<br>       <span class="hljs-selector-tag">saveData</span>(userModel);<br>       <span class="hljs-selector-tag">updateData</span>(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨æ‰§è¡Œä¸Šé¢è¿™æ®µä»£ç ï¼Œä¿å­˜å’Œæ›´æ–°æ•°æ®æ—¶ï¼Œç¨‹åºæŠ¥é”™äº†ï¼ŒæŠ›äº†SqlExceptionã€DuplicateKeyExceptionç­‰å¼‚å¸¸ã€‚è€ŒBusinessExceptionæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å¼‚å¸¸ï¼ŒæŠ¥é”™çš„å¼‚å¸¸ä¸å±äºBusinessExceptionï¼Œæ‰€ä»¥äº‹åŠ¡ä¹Ÿä¸ä¼šå›æ»šã€‚</p><p>å³ä½¿rollbackForæœ‰é»˜è®¤å€¼ï¼Œä½†é˜¿é‡Œå·´å·´å¼€å‘è€…è§„èŒƒä¸­ï¼Œè¿˜æ˜¯è¦æ±‚å¼€å‘è€…é‡æ–°æŒ‡å®šè¯¥å‚æ•°ã€‚</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å› ä¸ºå¦‚æœä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸€æ—¦ç¨‹åºæŠ›å‡ºäº†Exceptionï¼Œäº‹åŠ¡ä¸ä¼šå›æ»šï¼Œè¿™ä¼šå‡ºç°å¾ˆå¤§çš„bugã€‚æ‰€ä»¥ï¼Œå»ºè®®ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°†è¯¥å‚æ•°è®¾ç½®æˆï¼šExceptionæˆ–Throwableã€‚</p><h3 id="5-åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†"><a href="#5-åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†" class="headerlink" title="5.åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†"></a>5.åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RoleService roleService;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(UserModel userModel)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        userMapper.insertUser(userModel);<br>        roleService.doOtherThing();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoleService</span> &#123;<br><br>    <span class="hljs-meta">@Transactional(propagation = Propagation.NESTED)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doOtherThing</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¿å­˜roleè¡¨æ•°æ®&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä½¿ç”¨äº†åµŒå¥—çš„å†…éƒ¨äº‹åŠ¡ï¼ŒåŸæœ¬æ˜¯å¸Œæœ›è°ƒç”¨roleService.doOtherThingæ–¹æ³•æ—¶ï¼Œå¦‚æœå‡ºç°äº†å¼‚å¸¸ï¼Œåªå›æ»šdoOtherThingæ–¹æ³•é‡Œçš„å†…å®¹ï¼Œä¸å›æ»š userMapper.insertUseré‡Œçš„å†…å®¹ï¼Œå³å›æ»šä¿å­˜ç‚¹ã€‚ä½†äº‹å®æ˜¯ï¼ŒinsertUserä¹Ÿå›æ»šäº†ã€‚</p><p>why?</p><p>å› ä¸ºdoOtherThingæ–¹æ³•å‡ºç°äº†å¼‚å¸¸ï¼Œ<strong>æ²¡æœ‰æ‰‹åŠ¨æ•è·</strong>ï¼Œä¼šç»§ç»­å¾€ä¸ŠæŠ›ï¼Œåˆ°å¤–å±‚addæ–¹æ³•çš„ä»£ç†æ–¹æ³•ä¸­æ•è·äº†å¼‚å¸¸ã€‚æ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µæ˜¯ç›´æ¥å›æ»šäº†æ•´ä¸ªäº‹åŠ¡ï¼Œä¸åªå›æ»šå•ä¸ªä¿å­˜ç‚¹ã€‚</p><p>æ€ä¹ˆæ ·æ‰èƒ½åªå›æ»šä¿å­˜ç‚¹å‘¢ï¼Ÿ</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@Service</span><br>public class UserService &#123;<br><br>    <span class="hljs-variable">@Autowired</span><br>    private UserMapper userMapper;<br><br>    <span class="hljs-variable">@Autowired</span><br>    private RoleService roleService;<br><br>    <span class="hljs-variable">@Transactional</span><br>    public void <span class="hljs-built_in">add</span>(UserModel userModel) throws Exception &#123;<br><br>        <span class="hljs-selector-tag">userMapper</span><span class="hljs-selector-class">.insertUser</span>(userModel);<br>        <span class="hljs-selector-tag">try</span> &#123;<br>            <span class="hljs-selector-tag">roleService</span><span class="hljs-selector-class">.doOtherThing</span>();<br>        &#125; <span class="hljs-selector-tag">catch</span> (Exception e) &#123;<br>            <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.error</span>(e.<span class="hljs-built_in">getMessage</span>(), e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥å°†å†…éƒ¨åµŒå¥—äº‹åŠ¡æ”¾åœ¨try&#x2F;catchä¸­ï¼Œå¹¶ä¸”ä¸ç»§ç»­å¾€ä¸ŠæŠ›å¼‚å¸¸ã€‚è¿™æ ·å°±èƒ½ä¿è¯ï¼Œå¦‚æœå†…éƒ¨åµŒå¥—äº‹åŠ¡ä¸­å‡ºç°å¼‚å¸¸ï¼Œåªå›æ»šå†…éƒ¨äº‹åŠ¡ï¼Œè€Œä¸å½±å“å¤–éƒ¨äº‹åŠ¡ã€‚</p><h2 id="ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡"><a href="#ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡" class="headerlink" title="ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡"></a>ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡</h2><h3 id="1-å¤§äº‹åŠ¡é—®é¢˜"><a href="#1-å¤§äº‹åŠ¡é—®é¢˜" class="headerlink" title="1. å¤§äº‹åŠ¡é—®é¢˜"></a>1. å¤§äº‹åŠ¡é—®é¢˜</h3><p>åœ¨ä½¿ç”¨springäº‹åŠ¡æ—¶ï¼Œæœ‰ä¸ªè®©äººéå¸¸å¤´ç–¼çš„é—®é¢˜ï¼Œå°±æ˜¯å¤§äº‹åŠ¡é—®é¢˜ã€‚<br>å…³äºå¤§äº‹åŠ¡å¯å‚è€ƒï¼š<a href="https://blog.csdn.net/mccand1234/article/details/124560532">å¤§äº‹åŠ¡é—®é¢˜</a></p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šåœ¨æ–¹æ³•ä¸Š@Transactionalæ³¨è§£ï¼Œå¡«åŠ äº‹åŠ¡åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-keyword">@Autowired</span> <br>    private RoleService roleService;<br>    <br>    <span class="hljs-keyword">@Transactional</span><br>    public void add(UserModel userModel) throws Exception &#123;<br>       <span class="hljs-built_in">query1</span>();<br>       <span class="hljs-built_in">query2</span>();<br>       <span class="hljs-built_in">query3</span>();<br>       roleService<span class="hljs-selector-class">.save</span>(userModel);<br>       <span class="hljs-built_in">update</span>(userModel);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">@Service</span><br>public class RoleService &#123;<br>    <br>    <span class="hljs-keyword">@Autowired</span> <br>    private RoleService roleService;<br>    <br>    <span class="hljs-keyword">@Transactional</span><br>    public void save(UserModel userModel) throws Exception &#123;<br>       <span class="hljs-built_in">query4</span>();<br>       <span class="hljs-built_in">query5</span>();<br>       <span class="hljs-built_in">query6</span>();<br>       <span class="hljs-built_in">saveData</span>(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†@Transactionalæ³¨è§£ï¼Œå¦‚æœè¢«åŠ åˆ°æ–¹æ³•ä¸Šï¼Œæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯æ•´ä¸ªæ–¹æ³•éƒ½åŒ…å«åœ¨äº‹åŠ¡å½“ä¸­äº†ã€‚</p><p>ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨UserServiceç±»ä¸­ï¼Œå…¶å®åªæœ‰è¿™ä¸¤è¡Œæ‰éœ€è¦äº‹åŠ¡ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">roleService<span class="hljs-selector-class">.save</span>(userModel);<br><span class="hljs-built_in">update</span>(userModel);<br></code></pre></td></tr></table></figure><p>åœ¨RoleServiceç±»ä¸­ï¼Œåªæœ‰è¿™ä¸€è¡Œéœ€è¦äº‹åŠ¡ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">save<span class="hljs-constructor">Data(<span class="hljs-params">userModel</span>)</span>;<br></code></pre></td></tr></table></figure><p>ç°åœ¨çš„è¿™ç§å†™æ³•ï¼Œä¼šå¯¼è‡´æ‰€æœ‰çš„queryæ–¹æ³•ä¹Ÿè¢«åŒ…å«åœ¨åŒä¸€ä¸ªäº‹åŠ¡å½“ä¸­ã€‚</p><p>å¦‚æœqueryæ–¹æ³•éå¸¸å¤šï¼Œè°ƒç”¨å±‚çº§å¾ˆæ·±ï¼Œè€Œä¸”æœ‰éƒ¨åˆ†æŸ¥è¯¢æ–¹æ³•æ¯”è¾ƒè€—æ—¶çš„è¯ï¼Œä¼šé€ æˆæ•´ä¸ªäº‹åŠ¡éå¸¸è€—æ—¶ï¼Œè€Œä»é€ æˆå¤§äº‹åŠ¡é—®é¢˜ã€‚</p><h3 id="2-ç¼–ç¨‹å¼äº‹åŠ¡"><a href="#2-ç¼–ç¨‹å¼äº‹åŠ¡" class="headerlink" title="2. ç¼–ç¨‹å¼äº‹åŠ¡"></a>2. ç¼–ç¨‹å¼äº‹åŠ¡</h3><p>ä¸Šé¢çš„è¿™äº›å†…å®¹éƒ½æ˜¯åŸºäº@Transactionalæ³¨è§£çš„ï¼Œä¸»è¦è®²çš„æ˜¯å®ƒçš„äº‹åŠ¡é—®é¢˜ï¼Œæˆ‘ä»¬æŠŠè¿™ç§äº‹åŠ¡å«åšï¼šå£°æ˜å¼äº‹åŠ¡ã€‚</p><p>å…¶å®ï¼Œspringè¿˜æä¾›äº†å¦å¤–ä¸€ç§åˆ›å»ºäº‹åŠ¡çš„æ–¹å¼ï¼Œå³é€šè¿‡æ‰‹åŠ¨ç¼–å†™ä»£ç å®ç°çš„äº‹åŠ¡ï¼Œæˆ‘ä»¬æŠŠè¿™ç§äº‹åŠ¡å«åšï¼šç¼–ç¨‹å¼äº‹åŠ¡ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Autowired</span><br>private TransactionTemplate transactionTemplate;<br><br>public void <span class="hljs-built_in">save</span>(final User user) &#123;<br>      <span class="hljs-built_in">queryData1</span>();<br>      <span class="hljs-built_in">queryData2</span>();<br>      transactionTemplate<span class="hljs-selector-class">.execute</span>(transactionStatus -&gt; &#123;<br>         addData1();<br>         <span class="hljs-built_in">updateData2</span>();<br>         return Boolean<span class="hljs-selector-class">.TRUE</span>;<br>     &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨springä¸­ä¸ºäº†æ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ï¼Œä¸“é—¨æä¾›äº†ä¸€ä¸ªç±»ï¼šTransactionTemplateï¼Œåœ¨å®ƒçš„executeæ–¹æ³•ä¸­ï¼Œå°±å®ç°äº†äº‹åŠ¡çš„åŠŸèƒ½ã€‚</p><p>ç›¸è¾ƒäº@Transactionalæ³¨è§£å£°æ˜å¼äº‹åŠ¡ï¼Œæ›´å»ºè®®å¤§å®¶ä½¿ç”¨ï¼ŒåŸºäºTransactionTemplateçš„ç¼–ç¨‹å¼äº‹åŠ¡ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š</p><p>é¿å…ç”±äºspring aopé—®é¢˜ï¼Œå¯¼è‡´äº‹åŠ¡å¤±æ•ˆçš„é—®é¢˜ã€‚<br>èƒ½å¤Ÿæ›´å°ç²’åº¦çš„æ§åˆ¶äº‹åŠ¡çš„èŒƒå›´ï¼Œæ›´ç›´è§‚ã€‚<br>å»ºè®®åœ¨é¡¹ç›®ä¸­å°‘ä½¿ç”¨@Transactionalæ³¨è§£å¼€å¯äº‹åŠ¡ã€‚ä½†å¹¶ä¸æ˜¯è¯´ä¸€å®šä¸èƒ½ç”¨å®ƒï¼Œå¦‚æœé¡¹ç›®ä¸­æœ‰äº›ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”ä¸ç»å¸¸å˜åŠ¨ï¼Œä½¿ç”¨@Transactionalæ³¨è§£å¼€å¯äº‹åŠ¡å¼€å¯äº‹åŠ¡ä¹Ÿæ— å¦¨ï¼Œå› ä¸ºå®ƒæ›´ç®€å•ï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯åƒä¸‡è¦å°å¿ƒäº‹åŠ¡å¤±æ•ˆçš„é—®é¢˜ã€‚</p><p>å‚è€ƒ:<br><a href="https://blog.csdn.net/wang/_luwei/article/details/121549005">https://blog.csdn.net/wang\_luwei/article/details/121549005</a> (springäº‹åŠ¡ï¼ˆæ³¨è§£ @Transactional ï¼‰å¤±æ•ˆçš„12ç§åœºæ™¯)<br><a href="https://www.bilibili.com/video/BV1fR4y1u7N8?spm%5C_id%5C_from=333.337.search-card.all.click(%E5%88%86%E6%9E%90spring%E4%BA%8B%E5%8A%A1@Transactional%E6%B3%A8%E8%A7%A3,%E4%BA%8B%E5%8A%A1%E4%B8%8D%E7%94%9F%E6%95%88%E7%9A%84%E5%9C%BA%E6%99%AF%E5%8F%8A%E5%8E%9F%E5%9B%A0%EF%BC%8C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88)">https://www.bilibili.com/video/BV1fR4y1u7N8?spm\_id\_from=333.337.search-card.all.click(åˆ†æspringäº‹åŠ¡@Transactionalæ³¨è§£,äº‹åŠ¡ä¸ç”Ÿæ•ˆçš„åœºæ™¯åŠåŸå› ï¼Œå’Œè§£å†³æ–¹æ¡ˆ)</a></p><p>Â  Â </p><p>æ˜¾ç¤ºæ¨èå†…å®¹# springäº‹åŠ¡ï¼ˆæ³¨è§£ @Transactional ï¼‰å¤±æ•ˆçš„12ç§åœºæ™¯</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/reprint.png"></p><p><a href="https://blog.csdn.net/mccand1234" title="æ˜¥å¤©çš„æ—©æ™¨">æ˜¥å¤©çš„æ—©æ™¨</a> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newUpTime2.png"> å·²äºÂ 2022-05-04 21:52:01Â ä¿®æ”¹</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/articleReadEyes2.png"> é˜…è¯»é‡3.4w <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollect2.png"> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollectionActive2.png"> æ”¶è— 788</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newHeart2023Active.png"> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newHeart2023Black.png"> ç‚¹èµæ•° 104</p><p>åˆ†ç±»ä¸“æ ï¼š <a href="https://blog.csdn.net/mccand1234/category_8743333.html">é¢è¯•</a> <a href="https://blog.csdn.net/mccand1234/category_6432539.html">Spring</a> æ–‡ç« æ ‡ç­¾ï¼š <a href="https://so.csdn.net/so/search/s.do?q=spring&t=all&o=vip&s=&l=&f=&viparticle=&from_tracking_code=tag_word&from_code=app_blog_art">spring</a> <a href="https://so.csdn.net/so/search/s.do?q=%E4%BA%8B%E5%8A%A1&t=all&o=vip&s=&l=&f=&viparticle=&from_tracking_code=tag_word&from_code=app_blog_art">äº‹åŠ¡</a></p><p>äºÂ 2022-05-04 15:57:04Â é¦–æ¬¡å‘å¸ƒ</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/wang_luwei/article/details/121549005">https://blog.csdn.net/wang_luwei&#x2F;article&#x2F;details&#x2F;121549005</a></p><p>ç‰ˆæƒ</p><p> <a href="javascript:;" title="GitCode å¼€æºç¤¾åŒº"><img src="https://devpress.csdnimg.cn/8bc8dd1a2bc24184a16a142654c4a49e.png"> GitCode å¼€æºç¤¾åŒº æ–‡ç« å·²è¢«ç¤¾åŒºæ”¶å½•</a></p><p>åŠ å…¥ç¤¾åŒº</p><p> <a href="https://blog.csdn.net/mccand1234/category_8743333.html" title="é¢è¯•"><img src="https://i-blog.csdnimg.cn/columns/default/20201014180756928.png?x-oss-process=image/resize,m_fixed,h_224,w_224"> é¢è¯• åŒæ—¶è¢« 2 ä¸ªä¸“æ æ”¶å½•<img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newArrowDown1White.png"></a></p><p>57 ç¯‡æ–‡ç«  4 è®¢é˜…</p><p>è®¢é˜…ä¸“æ </p><p> <a href="https://blog.csdn.net/mccand1234/category_6432539.html" title="Spring"><img src="https://i-blog.csdnimg.cn/columns/default/20201014180756780.png?x-oss-process=image/resize,m_fixed,h_224,w_224"> Spring</a></p><p>31 ç¯‡æ–‡ç«  1 è®¢é˜…</p><p>è®¢é˜…ä¸“æ </p><p><img src="https://img-home.csdnimg.cn/images/20240711042549.png"> æœ¬æ–‡è¯¦ç»†åˆ†æäº†Springäº‹åŠ¡ç®¡ç†ä¸­@Transactionalæ³¨è§£å¤±æ•ˆçš„ä¸ƒç§æƒ…å†µï¼ŒåŒ…æ‹¬è®¿é—®æƒé™ã€finalä¿®é¥°ã€å†…éƒ¨è°ƒç”¨ã€æœªè¢«ç®¡ç†ã€å¤šçº¿ç¨‹ã€å­˜å‚¨å¼•æ“ä¸æ”¯æŒäº‹åŠ¡ä»¥åŠæœªå¼€å¯äº‹åŠ¡ã€‚åŒæ—¶ï¼Œæ¢è®¨äº†äº‹åŠ¡ä¸å›æ»šçš„äº”ç§åŸå› ï¼Œå¦‚é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§ã€å¼‚å¸¸å¤„ç†ä¸å½“ç­‰ã€‚æœ€åï¼Œè®¨è®ºäº†å¤§äº‹åŠ¡é—®é¢˜å’Œç¼–ç¨‹å¼äº‹åŠ¡çš„ä¼˜åŠ¿ï¼Œå¼ºè°ƒäº†å¦‚ä½•æ›´å¥½åœ°æ§åˆ¶äº‹åŠ¡èŒƒå›´å’Œé¿å…å¤§äº‹åŠ¡é—®é¢˜ã€‚</p><p>æ‘˜è¦ç”±CSDNé€šè¿‡æ™ºèƒ½æŠ€æœ¯ç”Ÿæˆ</p><h4 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h4><ul><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#__6">ä¸€ ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘</a></li><li><ul><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#1_public_7">1.è®¿é—®æƒé™é—®é¢˜ (åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ)</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#2final_65">2.æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#3_86">3.åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ</a></li><li><ul><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#31_Service_113">3.1 æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#32_Service_139">3.2 åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#33_AopContent_166">3.3 é€šè¿‡AopContentç±»</a></li></ul></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#4_spring_187">4.(ç±»æœ¬èº«) æœªè¢«springç®¡ç†</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#5_206">5.å¤šçº¿ç¨‹è°ƒç”¨</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#6_249">6.(å­˜å‚¨å¼•æ“)è¡¨ä¸æ”¯æŒäº‹åŠ¡</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#7_277">7.æœªå¼€å¯äº‹åŠ¡</a></li></ul></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#_318">äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘</a></li><li><ul><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#1_319">1.é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#2_347">2.è‡ªå·±åäº†å¼‚å¸¸</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#3_369">3.æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#4_392">4.è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#5_416">5.åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†</a></li></ul></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#_474">ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡</a></li><li><ul><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#1__475">1. å¤§äº‹åŠ¡é—®é¢˜</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#2__528">2. ç¼–ç¨‹å¼äº‹åŠ¡</a></li></ul></li></ul><p>åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œéœ€è¦åŒæ—¶å†™å…¥å¤šå¼ è¡¨çš„æ•°æ®æˆ–è€…æ‰§è¡Œå¤šæ¡sqlã€‚ä¸ºäº†ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼ˆè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼‰ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šç”¨åˆ°springäº‹åŠ¡ã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/cd5de7a66d2a919e9210b222a7dce169.png" alt="å¼ºå¤§çš„springæ¡†æ¶ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç®€å•çš„æ³¨è§£ï¼š@Transactionalï¼Œå°±èƒ½è½»æ¾æå®šäº‹åŠ¡ï¼Œä¸€ç›´ç”¨ä¸€ç›´çˆ½å•Šï¼ï¼"></p><h2 id="ä¸€-ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘-1"><a href="#ä¸€-ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘-1" class="headerlink" title="ä¸€ ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘"></a>ä¸€ ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘</h2><h3 id="1-è®¿é—®æƒé™é—®é¢˜-åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ-1"><a href="#1-è®¿é—®æƒé™é—®é¢˜-åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ-1" class="headerlink" title="1.è®¿é—®æƒé™é—®é¢˜ (åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ)"></a>1.è®¿é—®æƒé™é—®é¢˜ (åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ)</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œjavaçš„è®¿é—®æƒé™ä¸»è¦æœ‰å››ç§ï¼šprivateã€defaultã€protectedã€publicï¼Œå®ƒä»¬çš„æƒé™ä»å·¦åˆ°å³ï¼Œä¾æ¬¡å˜å¤§ã€‚</p><p>ä½†å¦‚æœæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒæŠŠæœ‰æŸäº›äº‹åŠ¡æ–¹æ³•ï¼Œå®šä¹‰äº†é”™è¯¯çš„è®¿é—®æƒé™ï¼Œå°±ä¼šå¯¼è‡´äº‹åŠ¡åŠŸèƒ½å‡ºé—®é¢˜ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-keyword">@Transactional</span><br>    private void add(UserModel userModel) &#123;<br>         <span class="hljs-built_in">saveData</span>(userModel);<br>         <span class="hljs-built_in">updateData</span>(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•çš„è®¿é—®æƒé™è¢«å®šä¹‰æˆäº†privateï¼Œè¿™æ ·ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Œspringè¦æ±‚è¢«ä»£ç†æ–¹æ³•å¿…é¡»å¾—æ˜¯publicçš„ã€‚</p><p>è¯´ç™½äº†ï¼Œåœ¨AbstractFallbackTransactionAttributeSourceç±»çš„computeTransactionAttributeæ–¹æ³•ä¸­æœ‰ä¸ªåˆ¤æ–­ï¼Œ<strong>å¦‚æœç›®æ ‡æ–¹æ³•ä¸æ˜¯public</strong>ï¼Œåˆ™TransactionAttributeè¿”å›nullï¼Œå³ä¸æ”¯æŒäº‹åŠ¡ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">protected TransactionAttribute compute<span class="hljs-constructor">TransactionAttribute(Method <span class="hljs-params">method</span>, @Nullable Class&lt;?&gt; <span class="hljs-params">targetClass</span>)</span> &#123;<br>    <span class="hljs-comment">// Don&#x27;t allow no-public methods as required.å¯ä»¥çœ‹åˆ°ï¼Œ è¿™é‡Œä¸æ”¯æŒpublicç±»å‹çš„æ–¹æ³•</span><br>    <span class="hljs-keyword">if</span> (allow<span class="hljs-constructor">PublicMethodsOnly()</span><span class="hljs-operator"> &amp;&amp; </span>!<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Modifier</span>.</span></span>is<span class="hljs-constructor">Public(<span class="hljs-params">method</span>.<span class="hljs-params">getModifiers</span>()</span>)) &#123;<br>      return null;<br>    &#125;<br><br>    <span class="hljs-comment">// The method may be on an interface, but we need attributes from the target class.</span><br>    <span class="hljs-comment">// If the target class is null, the method will be unchanged.</span><br>    Method specificMethod = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AopUtils</span>.</span></span>get<span class="hljs-constructor">MostSpecificMethod(<span class="hljs-params">method</span>, <span class="hljs-params">targetClass</span>)</span>;<br><br>    <span class="hljs-comment">// First try is the method in the target class.</span><br>    TransactionAttribute txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">specificMethod</span>)</span>;<br>    <span class="hljs-keyword">if</span> (txAttr != null) &#123;<br>      return txAttr;<br>    &#125;<br><br>    <span class="hljs-comment">// Second try is the transaction attribute on the target class.</span><br>    txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">specificMethod</span>.<span class="hljs-params">getDeclaringClass</span>()</span>);<br>    <span class="hljs-keyword">if</span> (txAttr != null<span class="hljs-operator"> &amp;&amp; </span><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ClassUtils</span>.</span></span>is<span class="hljs-constructor">UserLevelMethod(<span class="hljs-params">method</span>)</span>) &#123;<br>      return txAttr;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (specificMethod != <span class="hljs-keyword">method</span>) &#123;<br>      <span class="hljs-comment">// Fallback is to look at the original method.</span><br>      txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">method</span>)</span>;<br>      <span class="hljs-keyword">if</span> (txAttr != null) &#123;<br>        return txAttr;<br>      &#125;<br>      <span class="hljs-comment">// Last fallback is the class of the original method.</span><br>      txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">method</span>.<span class="hljs-params">getDeclaringClass</span>()</span>);<br>      <span class="hljs-keyword">if</span> (txAttr != null<span class="hljs-operator"> &amp;&amp; </span><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ClassUtils</span>.</span></span>is<span class="hljs-constructor">UserLevelMethod(<span class="hljs-params">method</span>)</span>) &#123;<br>        return txAttr;<br>      &#125;<br>    &#125;<br>    return null;<br>  &#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰çš„äº‹åŠ¡æ–¹æ³•ï¼ˆå³ç›®æ ‡æ–¹æ³•ï¼‰ï¼Œå®ƒçš„è®¿é—®æƒé™ä¸æ˜¯publicï¼Œè€Œæ˜¯privateã€defaultæˆ–protectedçš„è¯ï¼Œspringåˆ™ä¸ä¼šæä¾›äº‹åŠ¡åŠŸèƒ½ã€‚</p><h3 id="2-æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ-1"><a href="#2-æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ-1" class="headerlink" title="2.æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ"></a>2.æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ</h3><p>æœ‰æ—¶å€™ï¼ŒæŸä¸ªæ–¹æ³•ä¸æƒ³è¢«å­ç±»é‡æ–°ï¼Œè¿™æ—¶å¯ä»¥å°†è¯¥æ–¹æ³•å®šä¹‰æˆfinalçš„ã€‚æ™®é€šæ–¹æ³•è¿™æ ·å®šä¹‰æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†å¦‚æœå°†äº‹åŠ¡æ–¹æ³•å®šä¹‰æˆfinalï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(UserModel userModel)</span></span>&#123;<br>        saveData(userModel);<br>        updateData(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•è¢«å®šä¹‰æˆäº†finalçš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´<a href="https://so.csdn.net/so/search?q=%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88&spm=1001.2101.3001.7020">äº‹åŠ¡å¤±æ•ˆ</a>ã€‚</p><p>ä¸ºä»€ä¹ˆï¼Ÿ</p><p>å¦‚æœä½ çœ‹è¿‡<a href="https://so.csdn.net/so/search?q=spring%E4%BA%8B%E5%8A%A1&spm=1001.2101.3001.7020">springäº‹åŠ¡</a>çš„æºç ï¼Œå¯èƒ½ä¼šçŸ¥é“springäº‹åŠ¡åº•å±‚ä½¿ç”¨äº†aopï¼Œä¹Ÿå°±æ˜¯é€šè¿‡jdkåŠ¨æ€ä»£ç†æˆ–è€…cglibï¼Œå¸®æˆ‘ä»¬ç”Ÿæˆäº†ä»£ç†ç±»ï¼Œåœ¨ä»£ç†ç±»ä¸­å®ç°çš„äº‹åŠ¡åŠŸèƒ½ã€‚<strong>ä½†å¦‚æœæŸä¸ªæ–¹æ³•ç”¨finalä¿®é¥°äº†ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„ä»£ç†ç±»ä¸­ï¼Œå°±æ— æ³•é‡å†™è¯¥æ–¹æ³•</strong>ï¼Œè€Œæ·»åŠ äº‹åŠ¡åŠŸèƒ½ã€‚</p><p>æ³¨æ„ï¼šå¦‚æœæŸä¸ªæ–¹æ³•æ˜¯staticçš„ï¼ŒåŒæ ·æ— æ³•é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œå˜æˆäº‹åŠ¡æ–¹æ³•ã€‚</p><h3 id="3-åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ-1"><a href="#3-åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ-1" class="headerlink" title="3.åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ"></a>3.åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨æŸä¸ªServiceç±»çš„æŸä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserMapper</span> userMapper;<br><br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">UserModel userModel</span>) &#123;<br>        userMapper.<span class="hljs-title function_">insertUser</span>(userModel);<br>        <span class="hljs-title function_">updateStatus</span>(userModel);<br>    &#125;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">updateStatus</span>(<span class="hljs-params">UserModel userModel</span>) &#123;<br>        <span class="hljs-title function_">doSameThing</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°åœ¨äº‹åŠ¡æ–¹æ³•addä¸­ï¼Œç›´æ¥è°ƒç”¨äº‹åŠ¡æ–¹æ³•updateStatusã€‚ä»å‰é¢ä»‹ç»çš„å†…å®¹å¯ä»¥çŸ¥é“ï¼ŒupdateStatusæ–¹æ³•æ‹¥æœ‰äº‹åŠ¡çš„èƒ½åŠ›æ˜¯å› ä¸ºspring aopç”Ÿæˆä»£ç†äº†å¯¹è±¡ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ç›´æ¥è°ƒç”¨äº†thiså¯¹è±¡çš„æ–¹æ³•ï¼Œæ‰€ä»¥updateStatusæ–¹æ³•ä¸ä¼šç”Ÿæˆäº‹åŠ¡ã€‚<a href="https://blog.csdn.net/yyoc97/article/details/81911744">æ ¹æœ¬åŸå› </a> <a href="https://blog.csdn.net/mccand1234/article/details/124578233">æ ¹æœ¬åŸå› 2</a></p><p>ç”±æ­¤å¯è§ï¼Œåœ¨åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæœ‰äº›åœºæ™¯ï¼Œç¡®å®æƒ³åœ¨åŒä¸€ä¸ªç±»çš„æŸä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨å®ƒè‡ªå·±çš„å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h4 id="3-1-æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•-1"><a href="#3-1-æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•-1" class="headerlink" title="3.1 æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•"></a>3.1 æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•</h4><p>è¿™ä¸ªæ–¹æ³•éå¸¸ç®€å•ï¼Œåªéœ€è¦æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•ï¼ŒæŠŠ@Transactionalæ³¨è§£åŠ åˆ°æ–°Serviceæ–¹æ³•ä¸Šï¼ŒæŠŠéœ€è¦äº‹åŠ¡æ‰§è¡Œçš„ä»£ç ç§»åˆ°æ–°æ–¹æ³•ä¸­ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Servcie</span><br>public class ServiceA &#123;<br>   <span class="hljs-keyword">@Autowired</span><br>   prvate ServiceB serviceB;<br><br>   public void <span class="hljs-built_in">save</span>(User user) &#123;<br>         <span class="hljs-built_in">queryData1</span>();<br>         <span class="hljs-built_in">queryData2</span>();<br>         serviceB<span class="hljs-selector-class">.doSave</span>(user);<br>   &#125;<br> &#125;<br><br> <span class="hljs-keyword">@Servcie</span><br> public class ServiceB &#123;<br><br>    <span class="hljs-keyword">@Transactional</span>(rollbackFor=Exception.class)<br>    public void doSave(User user) &#123;<br>       <span class="hljs-built_in">addData1</span>();<br>       <span class="hljs-built_in">updateData2</span>();<br>    &#125;<br><br> &#125;<br></code></pre></td></tr></table></figure><h4 id="3-2-åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±-1"><a href="#3-2-åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±-1" class="headerlink" title="3.2 åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±"></a>3.2 åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±</h4><p>å¦‚æœä¸æƒ³å†æ–°åŠ ä¸€ä¸ªServiceç±»ï¼Œåœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±ä¹Ÿæ˜¯ä¸€ç§é€‰æ‹©ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Servcie</span><br>public class ServiceA &#123;<br>   <span class="hljs-keyword">@Autowired</span><br>   prvate ServiceA serviceA;<br><br>   public void <span class="hljs-built_in">save</span>(User user) &#123;<br>         <span class="hljs-built_in">queryData1</span>();<br>         <span class="hljs-built_in">queryData2</span>();<br>         serviceA<span class="hljs-selector-class">.doSave</span>(user);<br>   &#125;<br><br>   <span class="hljs-keyword">@Transactional</span>(rollbackFor=Exception.class)<br>   public void doSave(User user) &#123;<br>       <span class="hljs-built_in">addData1</span>();<br>       <span class="hljs-built_in">updateData2</span>();<br>    &#125;<br> &#125;<br></code></pre></td></tr></table></figure><p>å¯èƒ½æœ‰äº›äººå¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼šè¿™ç§åšæ³•ä¼šä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿ</p><p>ç­”æ¡ˆï¼šä¸ä¼šã€‚</p><p>å…¶å®spring iocå†…éƒ¨çš„<a href="https://blog.csdn.net/mccand1234/article/details/116403266">ä¸‰çº§ç¼“å­˜</a>ä¿è¯äº†å®ƒï¼Œä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</p><h4 id="3-3-é€šè¿‡AopContentç±»-1"><a href="#3-3-é€šè¿‡AopContentç±»-1" class="headerlink" title="3.3 é€šè¿‡AopContentç±»"></a>3.3 é€šè¿‡AopContentç±»</h4><p>åœ¨è¯¥Serviceç±»ä¸­ä½¿ç”¨AopContext.currentProxy()è·å–ä»£ç†å¯¹è±¡</p><p>ä¸Šé¢çš„æ–¹æ³•2ç¡®å®å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ä»£ç çœ‹èµ·æ¥å¹¶ä¸ç›´è§‚ï¼Œè¿˜å¯ä»¥é€šè¿‡åœ¨è¯¥Serviceç±»ä¸­ä½¿ç”¨AOPProxyè·å–ä»£ç†å¯¹è±¡ï¼Œå®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Servcie</span><br>public class ServiceA &#123;<br><br>   public void <span class="hljs-built_in">save</span>(User user) &#123;<br>         <span class="hljs-built_in">queryData1</span>();<br>         <span class="hljs-built_in">queryData2</span>();<br>         ((ServiceA)AopContext<span class="hljs-selector-class">.currentProxy</span>())<span class="hljs-selector-class">.doSave</span>(user);<br>   &#125;<br><br>   <span class="hljs-keyword">@Transactional</span>(rollbackFor=Exception.class)<br>   public void doSave(User user) &#123;<br>       <span class="hljs-built_in">addData1</span>();<br>       <span class="hljs-built_in">updateData2</span>();<br>    &#125;<br> &#125;<br></code></pre></td></tr></table></figure><h3 id="4-ç±»æœ¬èº«-æœªè¢«springç®¡ç†-1"><a href="#4-ç±»æœ¬èº«-æœªè¢«springç®¡ç†-1" class="headerlink" title="4.(ç±»æœ¬èº«) æœªè¢«springç®¡ç†"></a>4.(ç±»æœ¬èº«) æœªè¢«springç®¡ç†</h3><p>åœ¨æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªç»†èŠ‚å¾ˆå®¹æ˜“è¢«å¿½ç•¥ã€‚å³ä½¿ç”¨springäº‹åŠ¡çš„å‰ææ˜¯ï¼šå¯¹è±¡è¦è¢«springç®¡ç†ï¼Œéœ€è¦åˆ›å»ºbeanå®ä¾‹ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡@Controllerã€@Serviceã€@Componentã€@Repositoryç­‰æ³¨è§£ï¼Œå¯ä»¥è‡ªåŠ¨å®ç°beanå®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ã€‚å½“ç„¶åˆ›å»ºbeanå®ä¾‹çš„æ–¹æ³•è¿˜æœ‰å¾ˆå¤šï¼Œä¸ä¸€ä¸€è¯´äº†ã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š@Autowiredçš„è¿™äº›éªšæ“ä½œï¼Œä½ éƒ½çŸ¥é“å—ï¼Ÿ</p><p>å¦‚ä¸‹æ‰€ç¤º, å¼€å‘äº†ä¸€ä¸ªServiceç±»ï¼Œä½†å¿˜äº†åŠ @Serviceæ³¨è§£ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">UserModel userModel</span>) &#123;<br>         <span class="hljs-title function_">saveData</span>(userModel);<br>         <span class="hljs-title function_">updateData</span>(userModel);<br>    &#125;    <br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°UserServiceç±»æ²¡æœ‰åŠ @Serviceæ³¨è§£ï¼Œé‚£ä¹ˆè¯¥ç±»ä¸ä¼šäº¤ç»™springç®¡ç†ï¼Œæ‰€ä»¥å®ƒçš„addæ–¹æ³•ä¹Ÿä¸ä¼šç”Ÿæˆäº‹åŠ¡ã€‚</p><h3 id="5-å¤šçº¿ç¨‹è°ƒç”¨-1"><a href="#5-å¤šçº¿ç¨‹è°ƒç”¨-1" class="headerlink" title="5.å¤šçº¿ç¨‹è°ƒç”¨"></a>5.å¤šçº¿ç¨‹è°ƒç”¨</h3><p>åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œå¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯è¿˜æ˜¯æŒºå¤šçš„ã€‚å¦‚æœspringäº‹åŠ¡ç”¨åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­ï¼Œä¼šæœ‰é—®é¢˜å—ï¼Ÿ</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Slf</span>4j<br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RoleService roleService;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(UserModel userModel)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        userMapper.insertUser(userModel);<br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            roleService.doOtherThing();<br>        &#125;).start();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoleService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doOtherThing</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¿å­˜roleè¡¨æ•°æ®&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº‹åŠ¡æ–¹æ³•addä¸­ï¼Œè°ƒç”¨äº†äº‹åŠ¡æ–¹æ³•doOtherThingï¼Œä½†æ˜¯äº‹åŠ¡æ–¹æ³•doOtherThingæ˜¯åœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨çš„ã€‚</p><p>è¿™æ ·ä¼šå¯¼è‡´ä¸¤ä¸ªæ–¹æ³•ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè·å–åˆ°çš„æ•°æ®åº“è¿æ¥ä¸ä¸€æ ·ï¼Œä»è€Œæ˜¯ä¸¤ä¸ªä¸åŒçš„äº‹åŠ¡ã€‚å¦‚æœæƒ³doOtherThingæ–¹æ³•ä¸­æŠ›äº†å¼‚å¸¸ï¼Œaddæ–¹æ³•ä¹Ÿå›æ»šæ˜¯ä¸å¯èƒ½çš„ã€‚</p><p>å¦‚æœçœ‹è¿‡springäº‹åŠ¡æºç çš„æœ‹å‹ï¼Œå¯èƒ½ä¼šçŸ¥é“springçš„äº‹åŠ¡æ˜¯é€šè¿‡æ•°æ®åº“è¿æ¥æ¥å®ç°çš„ã€‚å½“å‰çº¿ç¨‹ä¸­ä¿å­˜äº†ä¸€ä¸ªmapï¼Œkeyæ˜¯æ•°æ®æºï¼Œvalueæ˜¯æ•°æ®åº“è¿æ¥ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">Object</span>, <span class="hljs-built_in">Object</span>&gt;&gt; resources =<br><br>  <span class="hljs-keyword">new</span> NamedThreadLocal&lt;&gt;(<span class="hljs-string">&quot;Transactional resources&quot;</span>);<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¯´çš„åŒä¸€ä¸ªäº‹åŠ¡ï¼Œå…¶å®æ˜¯æŒ‡åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œåªæœ‰æ‹¥æœ‰åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥æ‰èƒ½åŒæ—¶æäº¤å’Œå›æ»šã€‚å¦‚æœåœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œæ‹¿åˆ°çš„æ•°æ®åº“è¿æ¥è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ˜¯ä¸åŒçš„äº‹åŠ¡ã€‚</p><h3 id="6-å­˜å‚¨å¼•æ“-è¡¨ä¸æ”¯æŒäº‹åŠ¡-1"><a href="#6-å­˜å‚¨å¼•æ“-è¡¨ä¸æ”¯æŒäº‹åŠ¡-1" class="headerlink" title="6.(å­˜å‚¨å¼•æ“)è¡¨ä¸æ”¯æŒäº‹åŠ¡"></a>6.(å­˜å‚¨å¼•æ“)è¡¨ä¸æ”¯æŒäº‹åŠ¡</h3><p>å‘¨æ‰€å‘¨çŸ¥ï¼Œåœ¨mysql5ä¹‹å‰ï¼Œé»˜è®¤çš„æ•°æ®åº“å¼•æ“æ˜¯myisamã€‚</p><p>å®ƒçš„å¥½å¤„å°±ä¸ç”¨å¤šè¯´äº†ï¼šç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå¯¹äºæŸ¥å¤šå†™å°‘çš„å•è¡¨æ“ä½œï¼Œæ€§èƒ½æ¯”innodbæ›´å¥½ã€‚</p><p>æœ‰äº›è€é¡¹ç›®ä¸­ï¼Œå¯èƒ½è¿˜åœ¨ç”¨å®ƒã€‚</p><p>åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠENGINEå‚æ•°è®¾ç½®æˆMyISAMå³å¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `category` (<br>  `id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `one_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `two_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `three_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `four_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>MyISAM AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">4</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_bin<br></code></pre></td></tr></table></figure><p>myisamå¥½ç”¨ï¼Œä½†æœ‰ä¸ªå¾ˆè‡´å‘½çš„é—®é¢˜æ˜¯ï¼š<strong>ä¸æ”¯æŒäº‹åŠ¡</strong>ã€‚</p><p>å¦‚æœåªæ˜¯å•è¡¨æ“ä½œè¿˜å¥½ï¼Œä¸ä¼šå‡ºç°å¤ªå¤§çš„é—®é¢˜ã€‚ä½†å¦‚æœéœ€è¦è·¨å¤šå¼ è¡¨æ“ä½œï¼Œç”±äºå…¶ä¸æ”¯æŒäº‹åŠ¡ï¼Œæ•°æ®ææœ‰å¯èƒ½ä¼šå‡ºç°ä¸å®Œæ•´çš„æƒ…å†µã€‚</p><p>æ­¤å¤–ï¼Œmyisamè¿˜ä¸æ”¯æŒè¡Œé”å’Œå¤–é”®ã€‚</p><p>æ‰€ä»¥åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œmyisamä½¿ç”¨çš„å¹¶ä¸å¤šã€‚åœ¨mysql5ä»¥åï¼Œmyisamå·²ç»é€æ¸é€€å‡ºäº†å†å²çš„èˆå°ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯innodbã€‚</p><p>æœ‰æ—¶å€™æˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æŸå¼ è¡¨çš„äº‹åŠ¡ä¸€ç›´éƒ½æ²¡æœ‰ç”Ÿæ•ˆï¼Œé‚£ä¸ä¸€å®šæ˜¯springäº‹åŠ¡çš„é”…ï¼Œæœ€å¥½ç¡®è®¤ä¸€ä¸‹ä½ ä½¿ç”¨çš„é‚£å¼ è¡¨ï¼Œæ˜¯å¦æ”¯æŒäº‹åŠ¡ã€‚</p><h3 id="7-æœªå¼€å¯äº‹åŠ¡-1"><a href="#7-æœªå¼€å¯äº‹åŠ¡-1" class="headerlink" title="7.æœªå¼€å¯äº‹åŠ¡"></a>7.æœªå¼€å¯äº‹åŠ¡</h3><p>æœ‰æ—¶å€™ï¼Œäº‹åŠ¡æ²¡æœ‰ç”Ÿæ•ˆçš„æ ¹æœ¬åŸå› æ˜¯æ²¡æœ‰å¼€å¯äº‹åŠ¡ã€‚</p><p>ä½ çœ‹åˆ°è¿™å¥è¯å¯èƒ½ä¼šè§‰å¾—å¥½ç¬‘ã€‚</p><p>å¼€å¯äº‹åŠ¡ä¸æ˜¯ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæœ€æœ€æœ€åŸºæœ¬çš„åŠŸèƒ½å—ï¼Ÿ</p><p>ä¸ºä»€ä¹ˆè¿˜ä¼šæ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Ÿ</p><p>æ²¡é”™ï¼Œå¦‚æœé¡¹ç›®å·²ç»æ­å»ºå¥½äº†ï¼Œäº‹åŠ¡åŠŸèƒ½è‚¯å®šæ˜¯æœ‰çš„ã€‚</p><p>ä½†å¦‚æœä½ æ˜¯åœ¨æ­å»ºé¡¹ç›®demoçš„æ—¶å€™ï¼Œåªæœ‰ä¸€å¼ è¡¨ï¼Œè€Œè¿™å¼ è¡¨çš„äº‹åŠ¡æ²¡æœ‰ç”Ÿæ•ˆã€‚é‚£ä¹ˆä¼šæ˜¯ä»€ä¹ˆåŸå› é€ æˆçš„å‘¢ï¼Ÿ</p><p>å½“ç„¶åŸå› æœ‰å¾ˆå¤šï¼Œä½†æ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Œè¿™ä¸ªåŸå› æå…¶å®¹æ˜“è¢«å¿½ç•¥ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯springbooté¡¹ç›®ï¼Œé‚£ä¹ˆä½ å¾ˆå¹¸è¿ã€‚å› ä¸ºspringbooté€šè¿‡DataSourceTransactionManagerAutoConfigurationç±»ï¼Œå·²ç»é»˜é»˜çš„å¸®ä½ å¼€å¯äº†äº‹åŠ¡ã€‚</p><p>ä½ æ‰€è¦åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œåªéœ€è¦é…ç½®spring.datasourceç›¸å…³å‚æ•°å³å¯ã€‚</p><p>ä½†å¦‚æœä½ ä½¿ç”¨çš„è¿˜æ˜¯ä¼ ç»Ÿçš„springé¡¹ç›®ï¼Œåˆ™éœ€è¦åœ¨applicationContext.xmlæ–‡ä»¶ä¸­ï¼Œæ‰‹åŠ¨é…ç½®äº‹åŠ¡ç›¸å…³å‚æ•°ã€‚å¦‚æœå¿˜äº†é…ç½®ï¼Œäº‹åŠ¡è‚¯å®šæ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚</p><p>å…·ä½“é…ç½®å¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨ --&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;advice&quot;</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRED&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span> <br><span class="hljs-comment">&lt;!-- ç”¨åˆ‡ç‚¹æŠŠäº‹åŠ¡åˆ‡è¿›å» --&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.susan.*.*(..))&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pointcut&quot;</span>/&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;advice&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pointcut&quot;</span>/&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span> <br><br></code></pre></td></tr></table></figure><p>é»˜é»˜çš„è¯´ä¸€å¥ï¼Œå¦‚æœåœ¨pointcutæ ‡ç­¾ä¸­çš„åˆ‡å…¥ç‚¹åŒ¹é…è§„åˆ™ï¼Œé…é”™äº†çš„è¯ï¼Œæœ‰äº›ç±»çš„äº‹åŠ¡ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚</p><h2 id="äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘-1"><a href="#äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘-1" class="headerlink" title="äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘"></a>äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘</h2><h3 id="1-é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§-1"><a href="#1-é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§-1" class="headerlink" title="1.é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§"></a>1.é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§</h3><p>å…¶å®ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨@Transactionalæ³¨è§£æ—¶ï¼Œæ˜¯å¯ä»¥æŒ‡å®špropagationå‚æ•°çš„ã€‚</p><p>è¯¥å‚æ•°çš„ä½œç”¨æ˜¯æŒ‡å®šäº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§ï¼Œspringç›®å‰æ”¯æŒ7ç§ä¼ æ’­ç‰¹æ€§ï¼š</p><p>REQUIRED å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œé‚£ä¹ˆåŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ˜¯é»˜è®¤çš„ä¼ æ’­å±æ€§å€¼ã€‚<br>SUPPORTS å¦‚æœå½“å‰ä¸Šä¸‹æ–‡å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æ”¯æŒäº‹åŠ¡åŠ å…¥äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä½¿ç”¨éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œã€‚<br>MANDATORY å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚<br>REQUIRES_NEW æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶ä¸”åŒæ—¶å°†ä¸Šä¸‹æ–‡ä¸­çš„äº‹åŠ¡æŒ‚èµ·ï¼Œæ‰§è¡Œå½“å‰æ–°å»ºäº‹åŠ¡å®Œæˆä»¥åï¼Œä¸Šä¸‹æ–‡äº‹åŠ¡æ¢å¤å†æ‰§è¡Œã€‚<br>NOT_SUPPORTED å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œç„¶åæ–°çš„æ–¹æ³•åœ¨æ²¡æœ‰äº‹åŠ¡çš„ç¯å¢ƒä¸­æ‰§è¡Œã€‚<br>NEVER å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™åœ¨æ— äº‹åŠ¡ç¯å¢ƒä¸Šæ‰§è¡Œä»£ç ã€‚<br>NESTED å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åµŒå¥—äº‹åŠ¡æ‰§è¡Œï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æ–°å»ºäº‹åŠ¡ã€‚<br>å¦‚æœæˆ‘ä»¬åœ¨æ‰‹åŠ¨è®¾ç½®propagationå‚æ•°çš„æ—¶å€™ï¼ŒæŠŠä¼ æ’­ç‰¹æ€§è®¾ç½®é”™äº†ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Transactional(propagation = Propagation.NEVER)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(UserModel userModel)</span> &#123;<br>        saveData(userModel);<br>        updateData(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•çš„äº‹åŠ¡ä¼ æ’­ç‰¹æ€§å®šä¹‰æˆäº†Propagation.NEVERï¼Œè¿™ç§ç±»å‹çš„ä¼ æ’­ç‰¹æ€§ä¸æ”¯æŒäº‹åŠ¡ï¼Œå¦‚æœæœ‰äº‹åŠ¡åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚</p><p>ç›®å‰åªæœ‰è¿™ä¸‰ç§ä¼ æ’­ç‰¹æ€§æ‰ä¼šåˆ›å»ºæ–°äº‹åŠ¡ï¼šREQUIREDï¼ŒREQUIRES_NEWï¼ŒNESTEDã€‚</p><h3 id="2-è‡ªå·±åäº†å¼‚å¸¸-1"><a href="#2-è‡ªå·±åäº†å¼‚å¸¸-1" class="headerlink" title="2.è‡ªå·±åäº†å¼‚å¸¸"></a>2.è‡ªå·±åäº†å¼‚å¸¸</h3><p>äº‹åŠ¡ä¸ä¼šå›æ»šï¼Œæœ€å¸¸è§çš„é—®é¢˜æ˜¯ï¼šå¼€å‘è€…åœ¨ä»£ç ä¸­æ‰‹åŠ¨tryâ€¦catchäº†å¼‚å¸¸ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-variable">@Transactional</span><br>    public void <span class="hljs-built_in">add</span>(UserModel userModel) &#123;<br>        <span class="hljs-selector-tag">try</span> &#123;<br>            <span class="hljs-selector-tag">saveData</span>(userModel);<br>            <span class="hljs-selector-tag">updateData</span>(userModel);<br>        &#125; <span class="hljs-selector-tag">catch</span> (Exception e) &#123;<br>            <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.error</span>(e.<span class="hljs-built_in">getMessage</span>(), e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹springäº‹åŠ¡å½“ç„¶ä¸ä¼šå›æ»šï¼Œå› ä¸ºå¼€å‘è€…<strong>è‡ªå·±æ•è·äº†å¼‚å¸¸</strong>ï¼Œåˆæ²¡æœ‰æ‰‹åŠ¨æŠ›å‡ºï¼Œæ¢å¥è¯è¯´å°±æ˜¯æŠŠå¼‚å¸¸åæ‰äº†ã€‚</p><p>å¦‚æœæƒ³è¦springäº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸å›æ»šï¼Œå¿…é¡»æŠ›å‡ºå®ƒèƒ½å¤Ÿå¤„ç†çš„å¼‚å¸¸ã€‚å¦‚æœæ²¡æœ‰æŠ›å¼‚å¸¸ï¼Œåˆ™springè®¤ä¸ºç¨‹åºæ˜¯æ­£å¸¸çš„ã€‚</p><h3 id="3-æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸-1"><a href="#3-æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸-1" class="headerlink" title="3.æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸"></a>3.æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸</h3><p>å³ä½¿å¼€å‘è€…æ²¡æœ‰æ‰‹åŠ¨æ•è·å¼‚å¸¸ï¼Œä½†å¦‚æœæŠ›çš„å¼‚å¸¸ä¸æ­£ç¡®ï¼Œspringäº‹åŠ¡ä¹Ÿä¸ä¼šå›æ»šã€‚</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Slf</span>4j<br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(UserModel userModel)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>             saveData(userModel);<br>             updateData(userModel);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.<span class="hljs-keyword">error</span>(e.getMessage(), e);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™ç§æƒ…å†µï¼Œå¼€å‘äººå‘˜è‡ªå·±æ•è·äº†å¼‚å¸¸ï¼Œåˆæ‰‹åŠ¨æŠ›å‡ºäº†å¼‚å¸¸ï¼šExceptionï¼Œäº‹åŠ¡åŒæ ·ä¸ä¼šå›æ»šã€‚  </p><p>å› ä¸ºspringäº‹åŠ¡ï¼Œé»˜è®¤æƒ…å†µä¸‹åªä¼šå›æ»šRuntimeExceptionï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰å’ŒErrorï¼ˆé”™è¯¯ï¼‰ï¼Œå¯¹äºæ™®é€šçš„Exceptionï¼ˆ<a href="https://blog.csdn.net/mccand1234/article/details/51579425?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165164871416780357228953%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=165164871416780357228953&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-51579425.nonecase&utm_term=error&spm=1018.2226.3001.4450">éè¿è¡Œæ—¶å¼‚å¸¸</a>ï¼‰ï¼Œå®ƒä¸ä¼šå›æ»šã€‚æ¯”å¦‚å¸¸è§çš„IOExeptionå’ŒSQLException</p><h3 id="4-è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸-1"><a href="#4-è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸-1" class="headerlink" title="4.è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸"></a>4.è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸</h3><p>åœ¨ä½¿ç”¨@Transactionalæ³¨è§£å£°æ˜äº‹åŠ¡æ—¶ï¼Œæœ‰æ—¶æˆ‘ä»¬æƒ³è‡ªå®šä¹‰å›æ»šçš„å¼‚å¸¸ï¼Œspringä¹Ÿæ˜¯æ”¯æŒçš„ã€‚å¯ä»¥é€šè¿‡è®¾ç½®rollbackForå‚æ•°ï¼Œæ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p><p>ä½†å¦‚æœè¿™ä¸ªå‚æ•°çš„å€¼è®¾ç½®é”™äº†ï¼Œå°±ä¼šå¼•å‡ºä¸€äº›è«åå…¶å¦™çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-variable">@Transactional</span>(rollbackFor = BusinessException.class)<br>    public void <span class="hljs-built_in">add</span>(UserModel userModel) throws Exception &#123;<br>       <span class="hljs-selector-tag">saveData</span>(userModel);<br>       <span class="hljs-selector-tag">updateData</span>(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨æ‰§è¡Œä¸Šé¢è¿™æ®µä»£ç ï¼Œä¿å­˜å’Œæ›´æ–°æ•°æ®æ—¶ï¼Œç¨‹åºæŠ¥é”™äº†ï¼ŒæŠ›äº†SqlExceptionã€DuplicateKeyExceptionç­‰å¼‚å¸¸ã€‚è€ŒBusinessExceptionæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å¼‚å¸¸ï¼ŒæŠ¥é”™çš„å¼‚å¸¸ä¸å±äºBusinessExceptionï¼Œæ‰€ä»¥äº‹åŠ¡ä¹Ÿä¸ä¼šå›æ»šã€‚</p><p>å³ä½¿rollbackForæœ‰é»˜è®¤å€¼ï¼Œä½†é˜¿é‡Œå·´å·´å¼€å‘è€…è§„èŒƒä¸­ï¼Œè¿˜æ˜¯è¦æ±‚å¼€å‘è€…é‡æ–°æŒ‡å®šè¯¥å‚æ•°ã€‚</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å› ä¸ºå¦‚æœä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸€æ—¦ç¨‹åºæŠ›å‡ºäº†Exceptionï¼Œäº‹åŠ¡ä¸ä¼šå›æ»šï¼Œè¿™ä¼šå‡ºç°å¾ˆå¤§çš„bugã€‚æ‰€ä»¥ï¼Œå»ºè®®ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°†è¯¥å‚æ•°è®¾ç½®æˆï¼šExceptionæˆ–Throwableã€‚</p><h3 id="5-åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†-1"><a href="#5-åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†-1" class="headerlink" title="5.åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†"></a>5.åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RoleService roleService;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(UserModel userModel)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        userMapper.insertUser(userModel);<br>        roleService.doOtherThing();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoleService</span> &#123;<br><br>    <span class="hljs-meta">@Transactional(propagation = Propagation.NESTED)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doOtherThing</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¿å­˜roleè¡¨æ•°æ®&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä½¿ç”¨äº†åµŒå¥—çš„å†…éƒ¨äº‹åŠ¡ï¼ŒåŸæœ¬æ˜¯å¸Œæœ›è°ƒç”¨roleService.doOtherThingæ–¹æ³•æ—¶ï¼Œå¦‚æœå‡ºç°äº†å¼‚å¸¸ï¼Œåªå›æ»šdoOtherThingæ–¹æ³•é‡Œçš„å†…å®¹ï¼Œä¸å›æ»š userMapper.insertUseré‡Œçš„å†…å®¹ï¼Œå³å›æ»šä¿å­˜ç‚¹ã€‚ä½†äº‹å®æ˜¯ï¼ŒinsertUserä¹Ÿå›æ»šäº†ã€‚</p><p>why?</p><p>å› ä¸ºdoOtherThingæ–¹æ³•å‡ºç°äº†å¼‚å¸¸ï¼Œ<strong>æ²¡æœ‰æ‰‹åŠ¨æ•è·</strong>ï¼Œä¼šç»§ç»­å¾€ä¸ŠæŠ›ï¼Œåˆ°å¤–å±‚addæ–¹æ³•çš„ä»£ç†æ–¹æ³•ä¸­æ•è·äº†å¼‚å¸¸ã€‚æ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µæ˜¯ç›´æ¥å›æ»šäº†æ•´ä¸ªäº‹åŠ¡ï¼Œä¸åªå›æ»šå•ä¸ªä¿å­˜ç‚¹ã€‚</p><p>æ€ä¹ˆæ ·æ‰èƒ½åªå›æ»šä¿å­˜ç‚¹å‘¢ï¼Ÿ</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@Service</span><br>public class UserService &#123;<br><br>    <span class="hljs-variable">@Autowired</span><br>    private UserMapper userMapper;<br><br>    <span class="hljs-variable">@Autowired</span><br>    private RoleService roleService;<br><br>    <span class="hljs-variable">@Transactional</span><br>    public void <span class="hljs-built_in">add</span>(UserModel userModel) throws Exception &#123;<br><br>        <span class="hljs-selector-tag">userMapper</span><span class="hljs-selector-class">.insertUser</span>(userModel);<br>        <span class="hljs-selector-tag">try</span> &#123;<br>            <span class="hljs-selector-tag">roleService</span><span class="hljs-selector-class">.doOtherThing</span>();<br>        &#125; <span class="hljs-selector-tag">catch</span> (Exception e) &#123;<br>            <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.error</span>(e.<span class="hljs-built_in">getMessage</span>(), e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥å°†å†…éƒ¨åµŒå¥—äº‹åŠ¡æ”¾åœ¨try&#x2F;catchä¸­ï¼Œå¹¶ä¸”ä¸ç»§ç»­å¾€ä¸ŠæŠ›å¼‚å¸¸ã€‚è¿™æ ·å°±èƒ½ä¿è¯ï¼Œå¦‚æœå†…éƒ¨åµŒå¥—äº‹åŠ¡ä¸­å‡ºç°å¼‚å¸¸ï¼Œåªå›æ»šå†…éƒ¨äº‹åŠ¡ï¼Œè€Œä¸å½±å“å¤–éƒ¨äº‹åŠ¡ã€‚</p><h2 id="ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡-1"><a href="#ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡-1" class="headerlink" title="ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡"></a>ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡</h2><h3 id="1-å¤§äº‹åŠ¡é—®é¢˜-1"><a href="#1-å¤§äº‹åŠ¡é—®é¢˜-1" class="headerlink" title="1. å¤§äº‹åŠ¡é—®é¢˜"></a>1. å¤§äº‹åŠ¡é—®é¢˜</h3><p>åœ¨ä½¿ç”¨springäº‹åŠ¡æ—¶ï¼Œæœ‰ä¸ªè®©äººéå¸¸å¤´ç–¼çš„é—®é¢˜ï¼Œå°±æ˜¯å¤§äº‹åŠ¡é—®é¢˜ã€‚<br>å…³äºå¤§äº‹åŠ¡å¯å‚è€ƒï¼š<a href="https://blog.csdn.net/mccand1234/article/details/124560532">å¤§äº‹åŠ¡é—®é¢˜</a></p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šåœ¨æ–¹æ³•ä¸Š@Transactionalæ³¨è§£ï¼Œå¡«åŠ äº‹åŠ¡åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-keyword">@Autowired</span> <br>    private RoleService roleService;<br>    <br>    <span class="hljs-keyword">@Transactional</span><br>    public void add(UserModel userModel) throws Exception &#123;<br>       <span class="hljs-built_in">query1</span>();<br>       <span class="hljs-built_in">query2</span>();<br>       <span class="hljs-built_in">query3</span>();<br>       roleService<span class="hljs-selector-class">.save</span>(userModel);<br>       <span class="hljs-built_in">update</span>(userModel);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">@Service</span><br>public class RoleService &#123;<br>    <br>    <span class="hljs-keyword">@Autowired</span> <br>    private RoleService roleService;<br>    <br>    <span class="hljs-keyword">@Transactional</span><br>    public void save(UserModel userModel) throws Exception &#123;<br>       <span class="hljs-built_in">query4</span>();<br>       <span class="hljs-built_in">query5</span>();<br>       <span class="hljs-built_in">query6</span>();<br>       <span class="hljs-built_in">saveData</span>(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†@Transactionalæ³¨è§£ï¼Œå¦‚æœè¢«åŠ åˆ°æ–¹æ³•ä¸Šï¼Œæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯æ•´ä¸ªæ–¹æ³•éƒ½åŒ…å«åœ¨äº‹åŠ¡å½“ä¸­äº†ã€‚</p><p>ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨UserServiceç±»ä¸­ï¼Œå…¶å®åªæœ‰è¿™ä¸¤è¡Œæ‰éœ€è¦äº‹åŠ¡ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">roleService<span class="hljs-selector-class">.save</span>(userModel);<br><span class="hljs-built_in">update</span>(userModel);<br></code></pre></td></tr></table></figure><p>åœ¨RoleServiceç±»ä¸­ï¼Œåªæœ‰è¿™ä¸€è¡Œéœ€è¦äº‹åŠ¡ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">save<span class="hljs-constructor">Data(<span class="hljs-params">userModel</span>)</span>;<br></code></pre></td></tr></table></figure><p>ç°åœ¨çš„è¿™ç§å†™æ³•ï¼Œä¼šå¯¼è‡´æ‰€æœ‰çš„queryæ–¹æ³•ä¹Ÿè¢«åŒ…å«åœ¨åŒä¸€ä¸ªäº‹åŠ¡å½“ä¸­ã€‚</p><p>å¦‚æœqueryæ–¹æ³•éå¸¸å¤šï¼Œè°ƒç”¨å±‚çº§å¾ˆæ·±ï¼Œè€Œä¸”æœ‰éƒ¨åˆ†æŸ¥è¯¢æ–¹æ³•æ¯”è¾ƒè€—æ—¶çš„è¯ï¼Œä¼šé€ æˆæ•´ä¸ªäº‹åŠ¡éå¸¸è€—æ—¶ï¼Œè€Œä»é€ æˆå¤§äº‹åŠ¡é—®é¢˜ã€‚</p><h3 id="2-ç¼–ç¨‹å¼äº‹åŠ¡-1"><a href="#2-ç¼–ç¨‹å¼äº‹åŠ¡-1" class="headerlink" title="2. ç¼–ç¨‹å¼äº‹åŠ¡"></a>2. ç¼–ç¨‹å¼äº‹åŠ¡</h3><p>ä¸Šé¢çš„è¿™äº›å†…å®¹éƒ½æ˜¯åŸºäº@Transactionalæ³¨è§£çš„ï¼Œä¸»è¦è®²çš„æ˜¯å®ƒçš„äº‹åŠ¡é—®é¢˜ï¼Œæˆ‘ä»¬æŠŠè¿™ç§äº‹åŠ¡å«åšï¼šå£°æ˜å¼äº‹åŠ¡ã€‚</p><p>å…¶å®ï¼Œspringè¿˜æä¾›äº†å¦å¤–ä¸€ç§åˆ›å»ºäº‹åŠ¡çš„æ–¹å¼ï¼Œå³é€šè¿‡æ‰‹åŠ¨ç¼–å†™ä»£ç å®ç°çš„äº‹åŠ¡ï¼Œæˆ‘ä»¬æŠŠè¿™ç§äº‹åŠ¡å«åšï¼šç¼–ç¨‹å¼äº‹åŠ¡ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Autowired</span><br>private TransactionTemplate transactionTemplate;<br><br>public void <span class="hljs-built_in">save</span>(final User user) &#123;<br>      <span class="hljs-built_in">queryData1</span>();<br>      <span class="hljs-built_in">queryData2</span>();<br>      transactionTemplate<span class="hljs-selector-class">.execute</span>(transactionStatus -&gt; &#123;<br>         addData1();<br>         <span class="hljs-built_in">updateData2</span>();<br>         return Boolean<span class="hljs-selector-class">.TRUE</span>;<br>     &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨springä¸­ä¸ºäº†æ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ï¼Œä¸“é—¨æä¾›äº†ä¸€ä¸ªç±»ï¼šTransactionTemplateï¼Œåœ¨å®ƒçš„executeæ–¹æ³•ä¸­ï¼Œå°±å®ç°äº†äº‹åŠ¡çš„åŠŸèƒ½ã€‚</p><p>ç›¸è¾ƒäº@Transactionalæ³¨è§£å£°æ˜å¼äº‹åŠ¡ï¼Œæ›´å»ºè®®å¤§å®¶ä½¿ç”¨ï¼ŒåŸºäºTransactionTemplateçš„ç¼–ç¨‹å¼äº‹åŠ¡ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š</p><p>é¿å…ç”±äºspring aopé—®é¢˜ï¼Œå¯¼è‡´äº‹åŠ¡å¤±æ•ˆçš„é—®é¢˜ã€‚<br>èƒ½å¤Ÿæ›´å°ç²’åº¦çš„æ§åˆ¶äº‹åŠ¡çš„èŒƒå›´ï¼Œæ›´ç›´è§‚ã€‚<br>å»ºè®®åœ¨é¡¹ç›®ä¸­å°‘ä½¿ç”¨@Transactionalæ³¨è§£å¼€å¯äº‹åŠ¡ã€‚ä½†å¹¶ä¸æ˜¯è¯´ä¸€å®šä¸èƒ½ç”¨å®ƒï¼Œå¦‚æœé¡¹ç›®ä¸­æœ‰äº›ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”ä¸ç»å¸¸å˜åŠ¨ï¼Œä½¿ç”¨@Transactionalæ³¨è§£å¼€å¯äº‹åŠ¡å¼€å¯äº‹åŠ¡ä¹Ÿæ— å¦¨ï¼Œå› ä¸ºå®ƒæ›´ç®€å•ï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯åƒä¸‡è¦å°å¿ƒäº‹åŠ¡å¤±æ•ˆçš„é—®é¢˜ã€‚</p><p>å‚è€ƒ:<br><a href="https://blog.csdn.net/wang/_luwei/article/details/121549005">https://blog.csdn.net/wang\_luwei/article/details/121549005</a> (springäº‹åŠ¡ï¼ˆæ³¨è§£ @Transactional ï¼‰å¤±æ•ˆçš„12ç§åœºæ™¯)<br><a href="https://www.bilibili.com/video/BV1fR4y1u7N8?spm%5C_id%5C_from=333.337.search-card.all.click(%E5%88%86%E6%9E%90spring%E4%BA%8B%E5%8A%A1@Transactional%E6%B3%A8%E8%A7%A3,%E4%BA%8B%E5%8A%A1%E4%B8%8D%E7%94%9F%E6%95%88%E7%9A%84%E5%9C%BA%E6%99%AF%E5%8F%8A%E5%8E%9F%E5%9B%A0%EF%BC%8C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88)">https://www.bilibili.com/video/BV1fR4y1u7N8?spm\_id\_from=333.337.search-card.all.click(åˆ†æspringäº‹åŠ¡@Transactionalæ³¨è§£,äº‹åŠ¡ä¸ç”Ÿæ•ˆçš„åœºæ™¯åŠåŸå› ï¼Œå’Œè§£å†³æ–¹æ¡ˆ)</a></p><p>Â  Â </p><p>æ˜¾ç¤ºæ¨èå†…å®¹# springäº‹åŠ¡ï¼ˆæ³¨è§£ @Transactional ï¼‰å¤±æ•ˆçš„12ç§åœºæ™¯</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/reprint.png"></p><p><a href="https://blog.csdn.net/mccand1234" title="æ˜¥å¤©çš„æ—©æ™¨">æ˜¥å¤©çš„æ—©æ™¨</a> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newUpTime2.png"> å·²äºÂ 2022-05-04 21:52:01Â ä¿®æ”¹</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/articleReadEyes2.png"> é˜…è¯»é‡3.4w <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollect2.png"> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollectionActive2.png"> æ”¶è— 788</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newHeart2023Active.png"> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newHeart2023Black.png"> ç‚¹èµæ•° 104</p><p>åˆ†ç±»ä¸“æ ï¼š <a href="https://blog.csdn.net/mccand1234/category_8743333.html">é¢è¯•</a> <a href="https://blog.csdn.net/mccand1234/category_6432539.html">Spring</a> æ–‡ç« æ ‡ç­¾ï¼š <a href="https://so.csdn.net/so/search/s.do?q=spring&t=all&o=vip&s=&l=&f=&viparticle=&from_tracking_code=tag_word&from_code=app_blog_art">spring</a> <a href="https://so.csdn.net/so/search/s.do?q=%E4%BA%8B%E5%8A%A1&t=all&o=vip&s=&l=&f=&viparticle=&from_tracking_code=tag_word&from_code=app_blog_art">äº‹åŠ¡</a></p><p>äºÂ 2022-05-04 15:57:04Â é¦–æ¬¡å‘å¸ƒ</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/wang_luwei/article/details/121549005">https://blog.csdn.net/wang_luwei&#x2F;article&#x2F;details&#x2F;121549005</a></p><p>ç‰ˆæƒ</p><p> <a href="javascript:;" title="GitCode å¼€æºç¤¾åŒº"><img src="https://devpress.csdnimg.cn/8bc8dd1a2bc24184a16a142654c4a49e.png"> GitCode å¼€æºç¤¾åŒº æ–‡ç« å·²è¢«ç¤¾åŒºæ”¶å½•</a></p><p>åŠ å…¥ç¤¾åŒº</p><p> <a href="https://blog.csdn.net/mccand1234/category_8743333.html" title="é¢è¯•"><img src="https://i-blog.csdnimg.cn/columns/default/20201014180756928.png?x-oss-process=image/resize,m_fixed,h_224,w_224"> é¢è¯• åŒæ—¶è¢« 2 ä¸ªä¸“æ æ”¶å½•<img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newArrowDown1White.png"></a></p><p>57 ç¯‡æ–‡ç«  4 è®¢é˜…</p><p>è®¢é˜…ä¸“æ </p><p> <a href="https://blog.csdn.net/mccand1234/category_6432539.html" title="Spring"><img src="https://i-blog.csdnimg.cn/columns/default/20201014180756780.png?x-oss-process=image/resize,m_fixed,h_224,w_224"> Spring</a></p><p>31 ç¯‡æ–‡ç«  1 è®¢é˜…</p><p>è®¢é˜…ä¸“æ </p><p><img src="https://img-home.csdnimg.cn/images/20240711042549.png"> æœ¬æ–‡è¯¦ç»†åˆ†æäº†Springäº‹åŠ¡ç®¡ç†ä¸­@Transactionalæ³¨è§£å¤±æ•ˆçš„ä¸ƒç§æƒ…å†µï¼ŒåŒ…æ‹¬è®¿é—®æƒé™ã€finalä¿®é¥°ã€å†…éƒ¨è°ƒç”¨ã€æœªè¢«ç®¡ç†ã€å¤šçº¿ç¨‹ã€å­˜å‚¨å¼•æ“ä¸æ”¯æŒäº‹åŠ¡ä»¥åŠæœªå¼€å¯äº‹åŠ¡ã€‚åŒæ—¶ï¼Œæ¢è®¨äº†äº‹åŠ¡ä¸å›æ»šçš„äº”ç§åŸå› ï¼Œå¦‚é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§ã€å¼‚å¸¸å¤„ç†ä¸å½“ç­‰ã€‚æœ€åï¼Œè®¨è®ºäº†å¤§äº‹åŠ¡é—®é¢˜å’Œç¼–ç¨‹å¼äº‹åŠ¡çš„ä¼˜åŠ¿ï¼Œå¼ºè°ƒäº†å¦‚ä½•æ›´å¥½åœ°æ§åˆ¶äº‹åŠ¡èŒƒå›´å’Œé¿å…å¤§äº‹åŠ¡é—®é¢˜ã€‚</p><p>æ‘˜è¦ç”±CSDNé€šè¿‡æ™ºèƒ½æŠ€æœ¯ç”Ÿæˆ</p><h4 id="æ–‡ç« ç›®å½•-1"><a href="#æ–‡ç« ç›®å½•-1" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h4><ul><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#__6">ä¸€ ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘</a></li><li><ul><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#1_public_7">1.è®¿é—®æƒé™é—®é¢˜ (åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ)</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#2final_65">2.æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#3_86">3.åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ</a></li><li><ul><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#31_Service_113">3.1 æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#32_Service_139">3.2 åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#33_AopContent_166">3.3 é€šè¿‡AopContentç±»</a></li></ul></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#4_spring_187">4.(ç±»æœ¬èº«) æœªè¢«springç®¡ç†</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#5_206">5.å¤šçº¿ç¨‹è°ƒç”¨</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#6_249">6.(å­˜å‚¨å¼•æ“)è¡¨ä¸æ”¯æŒäº‹åŠ¡</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#7_277">7.æœªå¼€å¯äº‹åŠ¡</a></li></ul></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#_318">äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘</a></li><li><ul><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#1_319">1.é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#2_347">2.è‡ªå·±åäº†å¼‚å¸¸</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#3_369">3.æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#4_392">4.è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#5_416">5.åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†</a></li></ul></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#_474">ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡</a></li><li><ul><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#1__475">1. å¤§äº‹åŠ¡é—®é¢˜</a></li><li><a href="https://blog.csdn.net/mccand1234/article/details/124571619#2__528">2. ç¼–ç¨‹å¼äº‹åŠ¡</a></li></ul></li></ul><p>åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œéœ€è¦åŒæ—¶å†™å…¥å¤šå¼ è¡¨çš„æ•°æ®æˆ–è€…æ‰§è¡Œå¤šæ¡sqlã€‚ä¸ºäº†ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼ˆè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼‰ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šç”¨åˆ°springäº‹åŠ¡ã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/cd5de7a66d2a919e9210b222a7dce169.png" alt="å¼ºå¤§çš„springæ¡†æ¶ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç®€å•çš„æ³¨è§£ï¼š@Transactionalï¼Œå°±èƒ½è½»æ¾æå®šäº‹åŠ¡ï¼Œä¸€ç›´ç”¨ä¸€ç›´çˆ½å•Šï¼ï¼"></p><h2 id="ä¸€-ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘-2"><a href="#ä¸€-ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘-2" class="headerlink" title="ä¸€ ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘"></a>ä¸€ ã€äº‹åŠ¡ä¸ç”Ÿæ•ˆã€ä¸ƒç§ã€‘</h2><h3 id="1-è®¿é—®æƒé™é—®é¢˜-åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ-2"><a href="#1-è®¿é—®æƒé™é—®é¢˜-åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ-2" class="headerlink" title="1.è®¿é—®æƒé™é—®é¢˜ (åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ)"></a>1.è®¿é—®æƒé™é—®é¢˜ (åªæœ‰publicæ–¹æ³•ä¼šç”Ÿæ•ˆ)</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œjavaçš„è®¿é—®æƒé™ä¸»è¦æœ‰å››ç§ï¼šprivateã€defaultã€protectedã€publicï¼Œå®ƒä»¬çš„æƒé™ä»å·¦åˆ°å³ï¼Œä¾æ¬¡å˜å¤§ã€‚</p><p>ä½†å¦‚æœæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒæŠŠæœ‰æŸäº›äº‹åŠ¡æ–¹æ³•ï¼Œå®šä¹‰äº†é”™è¯¯çš„è®¿é—®æƒé™ï¼Œå°±ä¼šå¯¼è‡´äº‹åŠ¡åŠŸèƒ½å‡ºé—®é¢˜ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-keyword">@Transactional</span><br>    private void add(UserModel userModel) &#123;<br>         <span class="hljs-built_in">saveData</span>(userModel);<br>         <span class="hljs-built_in">updateData</span>(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•çš„è®¿é—®æƒé™è¢«å®šä¹‰æˆäº†privateï¼Œè¿™æ ·ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Œspringè¦æ±‚è¢«ä»£ç†æ–¹æ³•å¿…é¡»å¾—æ˜¯publicçš„ã€‚</p><p>è¯´ç™½äº†ï¼Œåœ¨AbstractFallbackTransactionAttributeSourceç±»çš„computeTransactionAttributeæ–¹æ³•ä¸­æœ‰ä¸ªåˆ¤æ–­ï¼Œ<strong>å¦‚æœç›®æ ‡æ–¹æ³•ä¸æ˜¯public</strong>ï¼Œåˆ™TransactionAttributeè¿”å›nullï¼Œå³ä¸æ”¯æŒäº‹åŠ¡ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">protected TransactionAttribute compute<span class="hljs-constructor">TransactionAttribute(Method <span class="hljs-params">method</span>, @Nullable Class&lt;?&gt; <span class="hljs-params">targetClass</span>)</span> &#123;<br>    <span class="hljs-comment">// Don&#x27;t allow no-public methods as required.å¯ä»¥çœ‹åˆ°ï¼Œ è¿™é‡Œä¸æ”¯æŒpublicç±»å‹çš„æ–¹æ³•</span><br>    <span class="hljs-keyword">if</span> (allow<span class="hljs-constructor">PublicMethodsOnly()</span><span class="hljs-operator"> &amp;&amp; </span>!<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Modifier</span>.</span></span>is<span class="hljs-constructor">Public(<span class="hljs-params">method</span>.<span class="hljs-params">getModifiers</span>()</span>)) &#123;<br>      return null;<br>    &#125;<br><br>    <span class="hljs-comment">// The method may be on an interface, but we need attributes from the target class.</span><br>    <span class="hljs-comment">// If the target class is null, the method will be unchanged.</span><br>    Method specificMethod = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AopUtils</span>.</span></span>get<span class="hljs-constructor">MostSpecificMethod(<span class="hljs-params">method</span>, <span class="hljs-params">targetClass</span>)</span>;<br><br>    <span class="hljs-comment">// First try is the method in the target class.</span><br>    TransactionAttribute txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">specificMethod</span>)</span>;<br>    <span class="hljs-keyword">if</span> (txAttr != null) &#123;<br>      return txAttr;<br>    &#125;<br><br>    <span class="hljs-comment">// Second try is the transaction attribute on the target class.</span><br>    txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">specificMethod</span>.<span class="hljs-params">getDeclaringClass</span>()</span>);<br>    <span class="hljs-keyword">if</span> (txAttr != null<span class="hljs-operator"> &amp;&amp; </span><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ClassUtils</span>.</span></span>is<span class="hljs-constructor">UserLevelMethod(<span class="hljs-params">method</span>)</span>) &#123;<br>      return txAttr;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (specificMethod != <span class="hljs-keyword">method</span>) &#123;<br>      <span class="hljs-comment">// Fallback is to look at the original method.</span><br>      txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">method</span>)</span>;<br>      <span class="hljs-keyword">if</span> (txAttr != null) &#123;<br>        return txAttr;<br>      &#125;<br>      <span class="hljs-comment">// Last fallback is the class of the original method.</span><br>      txAttr = find<span class="hljs-constructor">TransactionAttribute(<span class="hljs-params">method</span>.<span class="hljs-params">getDeclaringClass</span>()</span>);<br>      <span class="hljs-keyword">if</span> (txAttr != null<span class="hljs-operator"> &amp;&amp; </span><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ClassUtils</span>.</span></span>is<span class="hljs-constructor">UserLevelMethod(<span class="hljs-params">method</span>)</span>) &#123;<br>        return txAttr;<br>      &#125;<br>    &#125;<br>    return null;<br>  &#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰çš„äº‹åŠ¡æ–¹æ³•ï¼ˆå³ç›®æ ‡æ–¹æ³•ï¼‰ï¼Œå®ƒçš„è®¿é—®æƒé™ä¸æ˜¯publicï¼Œè€Œæ˜¯privateã€defaultæˆ–protectedçš„è¯ï¼Œspringåˆ™ä¸ä¼šæä¾›äº‹åŠ¡åŠŸèƒ½ã€‚</p><h3 id="2-æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ-2"><a href="#2-æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ-2" class="headerlink" title="2.æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ"></a>2.æ–¹æ³•ç”¨finalä¿®é¥°ï¼Œä¸ä¼šç”Ÿæ•ˆ</h3><p>æœ‰æ—¶å€™ï¼ŒæŸä¸ªæ–¹æ³•ä¸æƒ³è¢«å­ç±»é‡æ–°ï¼Œè¿™æ—¶å¯ä»¥å°†è¯¥æ–¹æ³•å®šä¹‰æˆfinalçš„ã€‚æ™®é€šæ–¹æ³•è¿™æ ·å®šä¹‰æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†å¦‚æœå°†äº‹åŠ¡æ–¹æ³•å®šä¹‰æˆfinalï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(UserModel userModel)</span></span>&#123;<br>        saveData(userModel);<br>        updateData(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•è¢«å®šä¹‰æˆäº†finalçš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´<a href="https://so.csdn.net/so/search?q=%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88&spm=1001.2101.3001.7020">äº‹åŠ¡å¤±æ•ˆ</a>ã€‚</p><p>ä¸ºä»€ä¹ˆï¼Ÿ</p><p>å¦‚æœä½ çœ‹è¿‡<a href="https://so.csdn.net/so/search?q=spring%E4%BA%8B%E5%8A%A1&spm=1001.2101.3001.7020">springäº‹åŠ¡</a>çš„æºç ï¼Œå¯èƒ½ä¼šçŸ¥é“springäº‹åŠ¡åº•å±‚ä½¿ç”¨äº†aopï¼Œä¹Ÿå°±æ˜¯é€šè¿‡jdkåŠ¨æ€ä»£ç†æˆ–è€…cglibï¼Œå¸®æˆ‘ä»¬ç”Ÿæˆäº†ä»£ç†ç±»ï¼Œåœ¨ä»£ç†ç±»ä¸­å®ç°çš„äº‹åŠ¡åŠŸèƒ½ã€‚<strong>ä½†å¦‚æœæŸä¸ªæ–¹æ³•ç”¨finalä¿®é¥°äº†ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„ä»£ç†ç±»ä¸­ï¼Œå°±æ— æ³•é‡å†™è¯¥æ–¹æ³•</strong>ï¼Œè€Œæ·»åŠ äº‹åŠ¡åŠŸèƒ½ã€‚</p><p>æ³¨æ„ï¼šå¦‚æœæŸä¸ªæ–¹æ³•æ˜¯staticçš„ï¼ŒåŒæ ·æ— æ³•é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œå˜æˆäº‹åŠ¡æ–¹æ³•ã€‚</p><h3 id="3-åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ-2"><a href="#3-åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ-2" class="headerlink" title="3.åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ"></a>3.åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨æŸä¸ªServiceç±»çš„æŸä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserMapper</span> userMapper;<br><br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">UserModel userModel</span>) &#123;<br>        userMapper.<span class="hljs-title function_">insertUser</span>(userModel);<br>        <span class="hljs-title function_">updateStatus</span>(userModel);<br>    &#125;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">updateStatus</span>(<span class="hljs-params">UserModel userModel</span>) &#123;<br>        <span class="hljs-title function_">doSameThing</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°åœ¨äº‹åŠ¡æ–¹æ³•addä¸­ï¼Œç›´æ¥è°ƒç”¨äº‹åŠ¡æ–¹æ³•updateStatusã€‚ä»å‰é¢ä»‹ç»çš„å†…å®¹å¯ä»¥çŸ¥é“ï¼ŒupdateStatusæ–¹æ³•æ‹¥æœ‰äº‹åŠ¡çš„èƒ½åŠ›æ˜¯å› ä¸ºspring aopç”Ÿæˆä»£ç†äº†å¯¹è±¡ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ç›´æ¥è°ƒç”¨äº†thiså¯¹è±¡çš„æ–¹æ³•ï¼Œæ‰€ä»¥updateStatusæ–¹æ³•ä¸ä¼šç”Ÿæˆäº‹åŠ¡ã€‚<a href="https://blog.csdn.net/yyoc97/article/details/81911744">æ ¹æœ¬åŸå› </a> <a href="https://blog.csdn.net/mccand1234/article/details/124578233">æ ¹æœ¬åŸå› 2</a></p><p>ç”±æ­¤å¯è§ï¼Œåœ¨åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæœ‰äº›åœºæ™¯ï¼Œç¡®å®æƒ³åœ¨åŒä¸€ä¸ªç±»çš„æŸä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨å®ƒè‡ªå·±çš„å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h4 id="3-1-æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•-2"><a href="#3-1-æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•-2" class="headerlink" title="3.1 æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•"></a>3.1 æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•</h4><p>è¿™ä¸ªæ–¹æ³•éå¸¸ç®€å•ï¼Œåªéœ€è¦æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•ï¼ŒæŠŠ@Transactionalæ³¨è§£åŠ åˆ°æ–°Serviceæ–¹æ³•ä¸Šï¼ŒæŠŠéœ€è¦äº‹åŠ¡æ‰§è¡Œçš„ä»£ç ç§»åˆ°æ–°æ–¹æ³•ä¸­ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Servcie</span><br>public class ServiceA &#123;<br>   <span class="hljs-keyword">@Autowired</span><br>   prvate ServiceB serviceB;<br><br>   public void <span class="hljs-built_in">save</span>(User user) &#123;<br>         <span class="hljs-built_in">queryData1</span>();<br>         <span class="hljs-built_in">queryData2</span>();<br>         serviceB<span class="hljs-selector-class">.doSave</span>(user);<br>   &#125;<br> &#125;<br><br> <span class="hljs-keyword">@Servcie</span><br> public class ServiceB &#123;<br><br>    <span class="hljs-keyword">@Transactional</span>(rollbackFor=Exception.class)<br>    public void doSave(User user) &#123;<br>       <span class="hljs-built_in">addData1</span>();<br>       <span class="hljs-built_in">updateData2</span>();<br>    &#125;<br><br> &#125;<br></code></pre></td></tr></table></figure><h4 id="3-2-åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±-2"><a href="#3-2-åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±-2" class="headerlink" title="3.2 åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±"></a>3.2 åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±</h4><p>å¦‚æœä¸æƒ³å†æ–°åŠ ä¸€ä¸ªServiceç±»ï¼Œåœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±ä¹Ÿæ˜¯ä¸€ç§é€‰æ‹©ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Servcie</span><br>public class ServiceA &#123;<br>   <span class="hljs-keyword">@Autowired</span><br>   prvate ServiceA serviceA;<br><br>   public void <span class="hljs-built_in">save</span>(User user) &#123;<br>         <span class="hljs-built_in">queryData1</span>();<br>         <span class="hljs-built_in">queryData2</span>();<br>         serviceA<span class="hljs-selector-class">.doSave</span>(user);<br>   &#125;<br><br>   <span class="hljs-keyword">@Transactional</span>(rollbackFor=Exception.class)<br>   public void doSave(User user) &#123;<br>       <span class="hljs-built_in">addData1</span>();<br>       <span class="hljs-built_in">updateData2</span>();<br>    &#125;<br> &#125;<br></code></pre></td></tr></table></figure><p>å¯èƒ½æœ‰äº›äººå¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼šè¿™ç§åšæ³•ä¼šä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿ</p><p>ç­”æ¡ˆï¼šä¸ä¼šã€‚</p><p>å…¶å®spring iocå†…éƒ¨çš„<a href="https://blog.csdn.net/mccand1234/article/details/116403266">ä¸‰çº§ç¼“å­˜</a>ä¿è¯äº†å®ƒï¼Œä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</p><h4 id="3-3-é€šè¿‡AopContentç±»-2"><a href="#3-3-é€šè¿‡AopContentç±»-2" class="headerlink" title="3.3 é€šè¿‡AopContentç±»"></a>3.3 é€šè¿‡AopContentç±»</h4><p>åœ¨è¯¥Serviceç±»ä¸­ä½¿ç”¨AopContext.currentProxy()è·å–ä»£ç†å¯¹è±¡</p><p>ä¸Šé¢çš„æ–¹æ³•2ç¡®å®å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ä»£ç çœ‹èµ·æ¥å¹¶ä¸ç›´è§‚ï¼Œè¿˜å¯ä»¥é€šè¿‡åœ¨è¯¥Serviceç±»ä¸­ä½¿ç”¨AOPProxyè·å–ä»£ç†å¯¹è±¡ï¼Œå®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Servcie</span><br>public class ServiceA &#123;<br><br>   public void <span class="hljs-built_in">save</span>(User user) &#123;<br>         <span class="hljs-built_in">queryData1</span>();<br>         <span class="hljs-built_in">queryData2</span>();<br>         ((ServiceA)AopContext<span class="hljs-selector-class">.currentProxy</span>())<span class="hljs-selector-class">.doSave</span>(user);<br>   &#125;<br><br>   <span class="hljs-keyword">@Transactional</span>(rollbackFor=Exception.class)<br>   public void doSave(User user) &#123;<br>       <span class="hljs-built_in">addData1</span>();<br>       <span class="hljs-built_in">updateData2</span>();<br>    &#125;<br> &#125;<br></code></pre></td></tr></table></figure><h3 id="4-ç±»æœ¬èº«-æœªè¢«springç®¡ç†-2"><a href="#4-ç±»æœ¬èº«-æœªè¢«springç®¡ç†-2" class="headerlink" title="4.(ç±»æœ¬èº«) æœªè¢«springç®¡ç†"></a>4.(ç±»æœ¬èº«) æœªè¢«springç®¡ç†</h3><p>åœ¨æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªç»†èŠ‚å¾ˆå®¹æ˜“è¢«å¿½ç•¥ã€‚å³ä½¿ç”¨springäº‹åŠ¡çš„å‰ææ˜¯ï¼šå¯¹è±¡è¦è¢«springç®¡ç†ï¼Œéœ€è¦åˆ›å»ºbeanå®ä¾‹ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡@Controllerã€@Serviceã€@Componentã€@Repositoryç­‰æ³¨è§£ï¼Œå¯ä»¥è‡ªåŠ¨å®ç°beanå®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ã€‚å½“ç„¶åˆ›å»ºbeanå®ä¾‹çš„æ–¹æ³•è¿˜æœ‰å¾ˆå¤šï¼Œä¸ä¸€ä¸€è¯´äº†ã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š@Autowiredçš„è¿™äº›éªšæ“ä½œï¼Œä½ éƒ½çŸ¥é“å—ï¼Ÿ</p><p>å¦‚ä¸‹æ‰€ç¤º, å¼€å‘äº†ä¸€ä¸ªServiceç±»ï¼Œä½†å¿˜äº†åŠ @Serviceæ³¨è§£ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">UserModel userModel</span>) &#123;<br>         <span class="hljs-title function_">saveData</span>(userModel);<br>         <span class="hljs-title function_">updateData</span>(userModel);<br>    &#125;    <br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°UserServiceç±»æ²¡æœ‰åŠ @Serviceæ³¨è§£ï¼Œé‚£ä¹ˆè¯¥ç±»ä¸ä¼šäº¤ç»™springç®¡ç†ï¼Œæ‰€ä»¥å®ƒçš„addæ–¹æ³•ä¹Ÿä¸ä¼šç”Ÿæˆäº‹åŠ¡ã€‚</p><h3 id="5-å¤šçº¿ç¨‹è°ƒç”¨-2"><a href="#5-å¤šçº¿ç¨‹è°ƒç”¨-2" class="headerlink" title="5.å¤šçº¿ç¨‹è°ƒç”¨"></a>5.å¤šçº¿ç¨‹è°ƒç”¨</h3><p>åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œå¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯è¿˜æ˜¯æŒºå¤šçš„ã€‚å¦‚æœspringäº‹åŠ¡ç”¨åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­ï¼Œä¼šæœ‰é—®é¢˜å—ï¼Ÿ</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Slf</span>4j<br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RoleService roleService;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(UserModel userModel)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        userMapper.insertUser(userModel);<br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            roleService.doOtherThing();<br>        &#125;).start();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoleService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doOtherThing</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¿å­˜roleè¡¨æ•°æ®&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº‹åŠ¡æ–¹æ³•addä¸­ï¼Œè°ƒç”¨äº†äº‹åŠ¡æ–¹æ³•doOtherThingï¼Œä½†æ˜¯äº‹åŠ¡æ–¹æ³•doOtherThingæ˜¯åœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨çš„ã€‚</p><p>è¿™æ ·ä¼šå¯¼è‡´ä¸¤ä¸ªæ–¹æ³•ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè·å–åˆ°çš„æ•°æ®åº“è¿æ¥ä¸ä¸€æ ·ï¼Œä»è€Œæ˜¯ä¸¤ä¸ªä¸åŒçš„äº‹åŠ¡ã€‚å¦‚æœæƒ³doOtherThingæ–¹æ³•ä¸­æŠ›äº†å¼‚å¸¸ï¼Œaddæ–¹æ³•ä¹Ÿå›æ»šæ˜¯ä¸å¯èƒ½çš„ã€‚</p><p>å¦‚æœçœ‹è¿‡springäº‹åŠ¡æºç çš„æœ‹å‹ï¼Œå¯èƒ½ä¼šçŸ¥é“springçš„äº‹åŠ¡æ˜¯é€šè¿‡æ•°æ®åº“è¿æ¥æ¥å®ç°çš„ã€‚å½“å‰çº¿ç¨‹ä¸­ä¿å­˜äº†ä¸€ä¸ªmapï¼Œkeyæ˜¯æ•°æ®æºï¼Œvalueæ˜¯æ•°æ®åº“è¿æ¥ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">Object</span>, <span class="hljs-built_in">Object</span>&gt;&gt; resources =<br><br>  <span class="hljs-keyword">new</span> NamedThreadLocal&lt;&gt;(<span class="hljs-string">&quot;Transactional resources&quot;</span>);<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¯´çš„åŒä¸€ä¸ªäº‹åŠ¡ï¼Œå…¶å®æ˜¯æŒ‡åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œåªæœ‰æ‹¥æœ‰åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥æ‰èƒ½åŒæ—¶æäº¤å’Œå›æ»šã€‚å¦‚æœåœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œæ‹¿åˆ°çš„æ•°æ®åº“è¿æ¥è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ˜¯ä¸åŒçš„äº‹åŠ¡ã€‚</p><h3 id="6-å­˜å‚¨å¼•æ“-è¡¨ä¸æ”¯æŒäº‹åŠ¡-2"><a href="#6-å­˜å‚¨å¼•æ“-è¡¨ä¸æ”¯æŒäº‹åŠ¡-2" class="headerlink" title="6.(å­˜å‚¨å¼•æ“)è¡¨ä¸æ”¯æŒäº‹åŠ¡"></a>6.(å­˜å‚¨å¼•æ“)è¡¨ä¸æ”¯æŒäº‹åŠ¡</h3><p>å‘¨æ‰€å‘¨çŸ¥ï¼Œåœ¨mysql5ä¹‹å‰ï¼Œé»˜è®¤çš„æ•°æ®åº“å¼•æ“æ˜¯myisamã€‚</p><p>å®ƒçš„å¥½å¤„å°±ä¸ç”¨å¤šè¯´äº†ï¼šç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå¯¹äºæŸ¥å¤šå†™å°‘çš„å•è¡¨æ“ä½œï¼Œæ€§èƒ½æ¯”innodbæ›´å¥½ã€‚</p><p>æœ‰äº›è€é¡¹ç›®ä¸­ï¼Œå¯èƒ½è¿˜åœ¨ç”¨å®ƒã€‚</p><p>åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠENGINEå‚æ•°è®¾ç½®æˆMyISAMå³å¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `category` (<br>  `id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `one_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `two_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `three_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `four_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>MyISAM AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">4</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_bin<br></code></pre></td></tr></table></figure><p>myisamå¥½ç”¨ï¼Œä½†æœ‰ä¸ªå¾ˆè‡´å‘½çš„é—®é¢˜æ˜¯ï¼š<strong>ä¸æ”¯æŒäº‹åŠ¡</strong>ã€‚</p><p>å¦‚æœåªæ˜¯å•è¡¨æ“ä½œè¿˜å¥½ï¼Œä¸ä¼šå‡ºç°å¤ªå¤§çš„é—®é¢˜ã€‚ä½†å¦‚æœéœ€è¦è·¨å¤šå¼ è¡¨æ“ä½œï¼Œç”±äºå…¶ä¸æ”¯æŒäº‹åŠ¡ï¼Œæ•°æ®ææœ‰å¯èƒ½ä¼šå‡ºç°ä¸å®Œæ•´çš„æƒ…å†µã€‚</p><p>æ­¤å¤–ï¼Œmyisamè¿˜ä¸æ”¯æŒè¡Œé”å’Œå¤–é”®ã€‚</p><p>æ‰€ä»¥åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œmyisamä½¿ç”¨çš„å¹¶ä¸å¤šã€‚åœ¨mysql5ä»¥åï¼Œmyisamå·²ç»é€æ¸é€€å‡ºäº†å†å²çš„èˆå°ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯innodbã€‚</p><p>æœ‰æ—¶å€™æˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æŸå¼ è¡¨çš„äº‹åŠ¡ä¸€ç›´éƒ½æ²¡æœ‰ç”Ÿæ•ˆï¼Œé‚£ä¸ä¸€å®šæ˜¯springäº‹åŠ¡çš„é”…ï¼Œæœ€å¥½ç¡®è®¤ä¸€ä¸‹ä½ ä½¿ç”¨çš„é‚£å¼ è¡¨ï¼Œæ˜¯å¦æ”¯æŒäº‹åŠ¡ã€‚</p><h3 id="7-æœªå¼€å¯äº‹åŠ¡-2"><a href="#7-æœªå¼€å¯äº‹åŠ¡-2" class="headerlink" title="7.æœªå¼€å¯äº‹åŠ¡"></a>7.æœªå¼€å¯äº‹åŠ¡</h3><p>æœ‰æ—¶å€™ï¼Œäº‹åŠ¡æ²¡æœ‰ç”Ÿæ•ˆçš„æ ¹æœ¬åŸå› æ˜¯æ²¡æœ‰å¼€å¯äº‹åŠ¡ã€‚</p><p>ä½ çœ‹åˆ°è¿™å¥è¯å¯èƒ½ä¼šè§‰å¾—å¥½ç¬‘ã€‚</p><p>å¼€å¯äº‹åŠ¡ä¸æ˜¯ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæœ€æœ€æœ€åŸºæœ¬çš„åŠŸèƒ½å—ï¼Ÿ</p><p>ä¸ºä»€ä¹ˆè¿˜ä¼šæ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Ÿ</p><p>æ²¡é”™ï¼Œå¦‚æœé¡¹ç›®å·²ç»æ­å»ºå¥½äº†ï¼Œäº‹åŠ¡åŠŸèƒ½è‚¯å®šæ˜¯æœ‰çš„ã€‚</p><p>ä½†å¦‚æœä½ æ˜¯åœ¨æ­å»ºé¡¹ç›®demoçš„æ—¶å€™ï¼Œåªæœ‰ä¸€å¼ è¡¨ï¼Œè€Œè¿™å¼ è¡¨çš„äº‹åŠ¡æ²¡æœ‰ç”Ÿæ•ˆã€‚é‚£ä¹ˆä¼šæ˜¯ä»€ä¹ˆåŸå› é€ æˆçš„å‘¢ï¼Ÿ</p><p>å½“ç„¶åŸå› æœ‰å¾ˆå¤šï¼Œä½†æ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Œè¿™ä¸ªåŸå› æå…¶å®¹æ˜“è¢«å¿½ç•¥ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯springbooté¡¹ç›®ï¼Œé‚£ä¹ˆä½ å¾ˆå¹¸è¿ã€‚å› ä¸ºspringbooté€šè¿‡DataSourceTransactionManagerAutoConfigurationç±»ï¼Œå·²ç»é»˜é»˜çš„å¸®ä½ å¼€å¯äº†äº‹åŠ¡ã€‚</p><p>ä½ æ‰€è¦åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œåªéœ€è¦é…ç½®spring.datasourceç›¸å…³å‚æ•°å³å¯ã€‚</p><p>ä½†å¦‚æœä½ ä½¿ç”¨çš„è¿˜æ˜¯ä¼ ç»Ÿçš„springé¡¹ç›®ï¼Œåˆ™éœ€è¦åœ¨applicationContext.xmlæ–‡ä»¶ä¸­ï¼Œæ‰‹åŠ¨é…ç½®äº‹åŠ¡ç›¸å…³å‚æ•°ã€‚å¦‚æœå¿˜äº†é…ç½®ï¼Œäº‹åŠ¡è‚¯å®šæ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚</p><p>å…·ä½“é…ç½®å¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨ --&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;advice&quot;</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRED&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span> <br><span class="hljs-comment">&lt;!-- ç”¨åˆ‡ç‚¹æŠŠäº‹åŠ¡åˆ‡è¿›å» --&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.susan.*.*(..))&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pointcut&quot;</span>/&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;advice&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pointcut&quot;</span>/&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span> <br><br></code></pre></td></tr></table></figure><p>é»˜é»˜çš„è¯´ä¸€å¥ï¼Œå¦‚æœåœ¨pointcutæ ‡ç­¾ä¸­çš„åˆ‡å…¥ç‚¹åŒ¹é…è§„åˆ™ï¼Œé…é”™äº†çš„è¯ï¼Œæœ‰äº›ç±»çš„äº‹åŠ¡ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚</p><h2 id="äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘-2"><a href="#äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘-2" class="headerlink" title="äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘"></a>äºŒã€äº‹åŠ¡ä¸å›æ»šã€äº”ç§ã€‘</h2><h3 id="1-é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§-2"><a href="#1-é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§-2" class="headerlink" title="1.é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§"></a>1.é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§</h3><p>å…¶å®ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨@Transactionalæ³¨è§£æ—¶ï¼Œæ˜¯å¯ä»¥æŒ‡å®špropagationå‚æ•°çš„ã€‚</p><p>è¯¥å‚æ•°çš„ä½œç”¨æ˜¯æŒ‡å®šäº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§ï¼Œspringç›®å‰æ”¯æŒ7ç§ä¼ æ’­ç‰¹æ€§ï¼š</p><p>REQUIRED å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œé‚£ä¹ˆåŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ˜¯é»˜è®¤çš„ä¼ æ’­å±æ€§å€¼ã€‚<br>SUPPORTS å¦‚æœå½“å‰ä¸Šä¸‹æ–‡å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æ”¯æŒäº‹åŠ¡åŠ å…¥äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä½¿ç”¨éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œã€‚<br>MANDATORY å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚<br>REQUIRES_NEW æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶ä¸”åŒæ—¶å°†ä¸Šä¸‹æ–‡ä¸­çš„äº‹åŠ¡æŒ‚èµ·ï¼Œæ‰§è¡Œå½“å‰æ–°å»ºäº‹åŠ¡å®Œæˆä»¥åï¼Œä¸Šä¸‹æ–‡äº‹åŠ¡æ¢å¤å†æ‰§è¡Œã€‚<br>NOT_SUPPORTED å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œç„¶åæ–°çš„æ–¹æ³•åœ¨æ²¡æœ‰äº‹åŠ¡çš„ç¯å¢ƒä¸­æ‰§è¡Œã€‚<br>NEVER å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™åœ¨æ— äº‹åŠ¡ç¯å¢ƒä¸Šæ‰§è¡Œä»£ç ã€‚<br>NESTED å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åµŒå¥—äº‹åŠ¡æ‰§è¡Œï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æ–°å»ºäº‹åŠ¡ã€‚<br>å¦‚æœæˆ‘ä»¬åœ¨æ‰‹åŠ¨è®¾ç½®propagationå‚æ•°çš„æ—¶å€™ï¼ŒæŠŠä¼ æ’­ç‰¹æ€§è®¾ç½®é”™äº†ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Transactional(propagation = Propagation.NEVER)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(UserModel userModel)</span> &#123;<br>        saveData(userModel);<br>        updateData(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•çš„äº‹åŠ¡ä¼ æ’­ç‰¹æ€§å®šä¹‰æˆäº†Propagation.NEVERï¼Œè¿™ç§ç±»å‹çš„ä¼ æ’­ç‰¹æ€§ä¸æ”¯æŒäº‹åŠ¡ï¼Œå¦‚æœæœ‰äº‹åŠ¡åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚</p><p>ç›®å‰åªæœ‰è¿™ä¸‰ç§ä¼ æ’­ç‰¹æ€§æ‰ä¼šåˆ›å»ºæ–°äº‹åŠ¡ï¼šREQUIREDï¼ŒREQUIRES_NEWï¼ŒNESTEDã€‚</p><h3 id="2-è‡ªå·±åäº†å¼‚å¸¸-2"><a href="#2-è‡ªå·±åäº†å¼‚å¸¸-2" class="headerlink" title="2.è‡ªå·±åäº†å¼‚å¸¸"></a>2.è‡ªå·±åäº†å¼‚å¸¸</h3><p>äº‹åŠ¡ä¸ä¼šå›æ»šï¼Œæœ€å¸¸è§çš„é—®é¢˜æ˜¯ï¼šå¼€å‘è€…åœ¨ä»£ç ä¸­æ‰‹åŠ¨tryâ€¦catchäº†å¼‚å¸¸ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-variable">@Transactional</span><br>    public void <span class="hljs-built_in">add</span>(UserModel userModel) &#123;<br>        <span class="hljs-selector-tag">try</span> &#123;<br>            <span class="hljs-selector-tag">saveData</span>(userModel);<br>            <span class="hljs-selector-tag">updateData</span>(userModel);<br>        &#125; <span class="hljs-selector-tag">catch</span> (Exception e) &#123;<br>            <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.error</span>(e.<span class="hljs-built_in">getMessage</span>(), e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹springäº‹åŠ¡å½“ç„¶ä¸ä¼šå›æ»šï¼Œå› ä¸ºå¼€å‘è€…<strong>è‡ªå·±æ•è·äº†å¼‚å¸¸</strong>ï¼Œåˆæ²¡æœ‰æ‰‹åŠ¨æŠ›å‡ºï¼Œæ¢å¥è¯è¯´å°±æ˜¯æŠŠå¼‚å¸¸åæ‰äº†ã€‚</p><p>å¦‚æœæƒ³è¦springäº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸å›æ»šï¼Œå¿…é¡»æŠ›å‡ºå®ƒèƒ½å¤Ÿå¤„ç†çš„å¼‚å¸¸ã€‚å¦‚æœæ²¡æœ‰æŠ›å¼‚å¸¸ï¼Œåˆ™springè®¤ä¸ºç¨‹åºæ˜¯æ­£å¸¸çš„ã€‚</p><h3 id="3-æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸-2"><a href="#3-æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸-2" class="headerlink" title="3.æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸"></a>3.æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸</h3><p>å³ä½¿å¼€å‘è€…æ²¡æœ‰æ‰‹åŠ¨æ•è·å¼‚å¸¸ï¼Œä½†å¦‚æœæŠ›çš„å¼‚å¸¸ä¸æ­£ç¡®ï¼Œspringäº‹åŠ¡ä¹Ÿä¸ä¼šå›æ»šã€‚</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Slf</span>4j<br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(UserModel userModel)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>             saveData(userModel);<br>             updateData(userModel);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.<span class="hljs-keyword">error</span>(e.getMessage(), e);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™ç§æƒ…å†µï¼Œå¼€å‘äººå‘˜è‡ªå·±æ•è·äº†å¼‚å¸¸ï¼Œåˆæ‰‹åŠ¨æŠ›å‡ºäº†å¼‚å¸¸ï¼šExceptionï¼Œäº‹åŠ¡åŒæ ·ä¸ä¼šå›æ»šã€‚  </p><p>å› ä¸ºspringäº‹åŠ¡ï¼Œé»˜è®¤æƒ…å†µä¸‹åªä¼šå›æ»šRuntimeExceptionï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰å’ŒErrorï¼ˆé”™è¯¯ï¼‰ï¼Œå¯¹äºæ™®é€šçš„Exceptionï¼ˆ<a href="https://blog.csdn.net/mccand1234/article/details/51579425?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165164871416780357228953%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=165164871416780357228953&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-51579425.nonecase&utm_term=error&spm=1018.2226.3001.4450">éè¿è¡Œæ—¶å¼‚å¸¸</a>ï¼‰ï¼Œå®ƒä¸ä¼šå›æ»šã€‚æ¯”å¦‚å¸¸è§çš„IOExeptionå’ŒSQLException</p><h3 id="4-è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸-2"><a href="#4-è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸-2" class="headerlink" title="4.è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸"></a>4.è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸</h3><p>åœ¨ä½¿ç”¨@Transactionalæ³¨è§£å£°æ˜äº‹åŠ¡æ—¶ï¼Œæœ‰æ—¶æˆ‘ä»¬æƒ³è‡ªå®šä¹‰å›æ»šçš„å¼‚å¸¸ï¼Œspringä¹Ÿæ˜¯æ”¯æŒçš„ã€‚å¯ä»¥é€šè¿‡è®¾ç½®rollbackForå‚æ•°ï¼Œæ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p><p>ä½†å¦‚æœè¿™ä¸ªå‚æ•°çš„å€¼è®¾ç½®é”™äº†ï¼Œå°±ä¼šå¼•å‡ºä¸€äº›è«åå…¶å¦™çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-variable">@Transactional</span>(rollbackFor = BusinessException.class)<br>    public void <span class="hljs-built_in">add</span>(UserModel userModel) throws Exception &#123;<br>       <span class="hljs-selector-tag">saveData</span>(userModel);<br>       <span class="hljs-selector-tag">updateData</span>(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨æ‰§è¡Œä¸Šé¢è¿™æ®µä»£ç ï¼Œä¿å­˜å’Œæ›´æ–°æ•°æ®æ—¶ï¼Œç¨‹åºæŠ¥é”™äº†ï¼ŒæŠ›äº†SqlExceptionã€DuplicateKeyExceptionç­‰å¼‚å¸¸ã€‚è€ŒBusinessExceptionæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å¼‚å¸¸ï¼ŒæŠ¥é”™çš„å¼‚å¸¸ä¸å±äºBusinessExceptionï¼Œæ‰€ä»¥äº‹åŠ¡ä¹Ÿä¸ä¼šå›æ»šã€‚</p><p>å³ä½¿rollbackForæœ‰é»˜è®¤å€¼ï¼Œä½†é˜¿é‡Œå·´å·´å¼€å‘è€…è§„èŒƒä¸­ï¼Œè¿˜æ˜¯è¦æ±‚å¼€å‘è€…é‡æ–°æŒ‡å®šè¯¥å‚æ•°ã€‚</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å› ä¸ºå¦‚æœä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸€æ—¦ç¨‹åºæŠ›å‡ºäº†Exceptionï¼Œäº‹åŠ¡ä¸ä¼šå›æ»šï¼Œè¿™ä¼šå‡ºç°å¾ˆå¤§çš„bugã€‚æ‰€ä»¥ï¼Œå»ºè®®ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°†è¯¥å‚æ•°è®¾ç½®æˆï¼šExceptionæˆ–Throwableã€‚</p><h3 id="5-åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†-2"><a href="#5-åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†-2" class="headerlink" title="5.åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†"></a>5.åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RoleService roleService;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(UserModel userModel)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        userMapper.insertUser(userModel);<br>        roleService.doOtherThing();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoleService</span> &#123;<br><br>    <span class="hljs-meta">@Transactional(propagation = Propagation.NESTED)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doOtherThing</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¿å­˜roleè¡¨æ•°æ®&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä½¿ç”¨äº†åµŒå¥—çš„å†…éƒ¨äº‹åŠ¡ï¼ŒåŸæœ¬æ˜¯å¸Œæœ›è°ƒç”¨roleService.doOtherThingæ–¹æ³•æ—¶ï¼Œå¦‚æœå‡ºç°äº†å¼‚å¸¸ï¼Œåªå›æ»šdoOtherThingæ–¹æ³•é‡Œçš„å†…å®¹ï¼Œä¸å›æ»š userMapper.insertUseré‡Œçš„å†…å®¹ï¼Œå³å›æ»šä¿å­˜ç‚¹ã€‚ä½†äº‹å®æ˜¯ï¼ŒinsertUserä¹Ÿå›æ»šäº†ã€‚</p><p>why?</p><p>å› ä¸ºdoOtherThingæ–¹æ³•å‡ºç°äº†å¼‚å¸¸ï¼Œ<strong>æ²¡æœ‰æ‰‹åŠ¨æ•è·</strong>ï¼Œä¼šç»§ç»­å¾€ä¸ŠæŠ›ï¼Œåˆ°å¤–å±‚addæ–¹æ³•çš„ä»£ç†æ–¹æ³•ä¸­æ•è·äº†å¼‚å¸¸ã€‚æ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µæ˜¯ç›´æ¥å›æ»šäº†æ•´ä¸ªäº‹åŠ¡ï¼Œä¸åªå›æ»šå•ä¸ªä¿å­˜ç‚¹ã€‚</p><p>æ€ä¹ˆæ ·æ‰èƒ½åªå›æ»šä¿å­˜ç‚¹å‘¢ï¼Ÿ</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@Service</span><br>public class UserService &#123;<br><br>    <span class="hljs-variable">@Autowired</span><br>    private UserMapper userMapper;<br><br>    <span class="hljs-variable">@Autowired</span><br>    private RoleService roleService;<br><br>    <span class="hljs-variable">@Transactional</span><br>    public void <span class="hljs-built_in">add</span>(UserModel userModel) throws Exception &#123;<br><br>        <span class="hljs-selector-tag">userMapper</span><span class="hljs-selector-class">.insertUser</span>(userModel);<br>        <span class="hljs-selector-tag">try</span> &#123;<br>            <span class="hljs-selector-tag">roleService</span><span class="hljs-selector-class">.doOtherThing</span>();<br>        &#125; <span class="hljs-selector-tag">catch</span> (Exception e) &#123;<br>            <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.error</span>(e.<span class="hljs-built_in">getMessage</span>(), e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥å°†å†…éƒ¨åµŒå¥—äº‹åŠ¡æ”¾åœ¨try&#x2F;catchä¸­ï¼Œå¹¶ä¸”ä¸ç»§ç»­å¾€ä¸ŠæŠ›å¼‚å¸¸ã€‚è¿™æ ·å°±èƒ½ä¿è¯ï¼Œå¦‚æœå†…éƒ¨åµŒå¥—äº‹åŠ¡ä¸­å‡ºç°å¼‚å¸¸ï¼Œåªå›æ»šå†…éƒ¨äº‹åŠ¡ï¼Œè€Œä¸å½±å“å¤–éƒ¨äº‹åŠ¡ã€‚</p><h2 id="ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡-2"><a href="#ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡-2" class="headerlink" title="ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡"></a>ä¸‰ã€å¤§äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡</h2><h3 id="1-å¤§äº‹åŠ¡é—®é¢˜-2"><a href="#1-å¤§äº‹åŠ¡é—®é¢˜-2" class="headerlink" title="1. å¤§äº‹åŠ¡é—®é¢˜"></a>1. å¤§äº‹åŠ¡é—®é¢˜</h3><p>åœ¨ä½¿ç”¨springäº‹åŠ¡æ—¶ï¼Œæœ‰ä¸ªè®©äººéå¸¸å¤´ç–¼çš„é—®é¢˜ï¼Œå°±æ˜¯å¤§äº‹åŠ¡é—®é¢˜ã€‚<br>å…³äºå¤§äº‹åŠ¡å¯å‚è€ƒï¼š<a href="https://blog.csdn.net/mccand1234/article/details/124560532">å¤§äº‹åŠ¡é—®é¢˜</a></p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šåœ¨æ–¹æ³•ä¸Š@Transactionalæ³¨è§£ï¼Œå¡«åŠ äº‹åŠ¡åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Service</span><br>public class UserService &#123;<br>    <br>    <span class="hljs-keyword">@Autowired</span> <br>    private RoleService roleService;<br>    <br>    <span class="hljs-keyword">@Transactional</span><br>    public void add(UserModel userModel) throws Exception &#123;<br>       <span class="hljs-built_in">query1</span>();<br>       <span class="hljs-built_in">query2</span>();<br>       <span class="hljs-built_in">query3</span>();<br>       roleService<span class="hljs-selector-class">.save</span>(userModel);<br>       <span class="hljs-built_in">update</span>(userModel);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">@Service</span><br>public class RoleService &#123;<br>    <br>    <span class="hljs-keyword">@Autowired</span> <br>    private RoleService roleService;<br>    <br>    <span class="hljs-keyword">@Transactional</span><br>    public void save(UserModel userModel) throws Exception &#123;<br>       <span class="hljs-built_in">query4</span>();<br>       <span class="hljs-built_in">query5</span>();<br>       <span class="hljs-built_in">query6</span>();<br>       <span class="hljs-built_in">saveData</span>(userModel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†@Transactionalæ³¨è§£ï¼Œå¦‚æœè¢«åŠ åˆ°æ–¹æ³•ä¸Šï¼Œæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯æ•´ä¸ªæ–¹æ³•éƒ½åŒ…å«åœ¨äº‹åŠ¡å½“ä¸­äº†ã€‚</p><p>ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨UserServiceç±»ä¸­ï¼Œå…¶å®åªæœ‰è¿™ä¸¤è¡Œæ‰éœ€è¦äº‹åŠ¡ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">roleService<span class="hljs-selector-class">.save</span>(userModel);<br><span class="hljs-built_in">update</span>(userModel);<br></code></pre></td></tr></table></figure><p>åœ¨RoleServiceç±»ä¸­ï¼Œåªæœ‰è¿™ä¸€è¡Œéœ€è¦äº‹åŠ¡ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">save<span class="hljs-constructor">Data(<span class="hljs-params">userModel</span>)</span>;<br></code></pre></td></tr></table></figure><p>ç°åœ¨çš„è¿™ç§å†™æ³•ï¼Œä¼šå¯¼è‡´æ‰€æœ‰çš„queryæ–¹æ³•ä¹Ÿè¢«åŒ…å«åœ¨åŒä¸€ä¸ªäº‹åŠ¡å½“ä¸­ã€‚</p><p>å¦‚æœqueryæ–¹æ³•éå¸¸å¤šï¼Œè°ƒç”¨å±‚çº§å¾ˆæ·±ï¼Œè€Œä¸”æœ‰éƒ¨åˆ†æŸ¥è¯¢æ–¹æ³•æ¯”è¾ƒè€—æ—¶çš„è¯ï¼Œä¼šé€ æˆæ•´ä¸ªäº‹åŠ¡éå¸¸è€—æ—¶ï¼Œè€Œä»é€ æˆå¤§äº‹åŠ¡é—®é¢˜ã€‚</p><h3 id="2-ç¼–ç¨‹å¼äº‹åŠ¡-2"><a href="#2-ç¼–ç¨‹å¼äº‹åŠ¡-2" class="headerlink" title="2. ç¼–ç¨‹å¼äº‹åŠ¡"></a>2. ç¼–ç¨‹å¼äº‹åŠ¡</h3><p>ä¸Šé¢çš„è¿™äº›å†…å®¹éƒ½æ˜¯åŸºäº@Transactionalæ³¨è§£çš„ï¼Œä¸»è¦è®²çš„æ˜¯å®ƒçš„äº‹åŠ¡é—®é¢˜ï¼Œæˆ‘ä»¬æŠŠè¿™ç§äº‹åŠ¡å«åšï¼šå£°æ˜å¼äº‹åŠ¡ã€‚</p><p>å…¶å®ï¼Œspringè¿˜æä¾›äº†å¦å¤–ä¸€ç§åˆ›å»ºäº‹åŠ¡çš„æ–¹å¼ï¼Œå³é€šè¿‡æ‰‹åŠ¨ç¼–å†™ä»£ç å®ç°çš„äº‹åŠ¡ï¼Œæˆ‘ä»¬æŠŠè¿™ç§äº‹åŠ¡å«åšï¼šç¼–ç¨‹å¼äº‹åŠ¡ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Autowired</span><br>private TransactionTemplate transactionTemplate;<br><br>public void <span class="hljs-built_in">save</span>(final User user) &#123;<br>      <span class="hljs-built_in">queryData1</span>();<br>      <span class="hljs-built_in">queryData2</span>();<br>      transactionTemplate<span class="hljs-selector-class">.execute</span>(transactionStatus -&gt; &#123;<br>         addData1();<br>         <span class="hljs-built_in">updateData2</span>();<br>         return Boolean<span class="hljs-selector-class">.TRUE</span>;<br>     &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨springä¸­ä¸ºäº†æ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ï¼Œä¸“é—¨æä¾›äº†ä¸€ä¸ªç±»ï¼šTransactionTemplateï¼Œåœ¨å®ƒçš„executeæ–¹æ³•ä¸­ï¼Œå°±å®ç°äº†äº‹åŠ¡çš„åŠŸèƒ½ã€‚</p><p>ç›¸è¾ƒäº@Transactionalæ³¨è§£å£°æ˜å¼äº‹åŠ¡ï¼Œæ›´å»ºè®®å¤§å®¶ä½¿ç”¨ï¼ŒåŸºäºTransactionTemplateçš„ç¼–ç¨‹å¼äº‹åŠ¡ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š</p><p>é¿å…ç”±äºspring aopé—®é¢˜ï¼Œå¯¼è‡´äº‹åŠ¡å¤±æ•ˆçš„é—®é¢˜ã€‚<br>èƒ½å¤Ÿæ›´å°ç²’åº¦çš„æ§åˆ¶äº‹åŠ¡çš„èŒƒå›´ï¼Œæ›´ç›´è§‚ã€‚<br>å»ºè®®åœ¨é¡¹ç›®ä¸­å°‘ä½¿ç”¨@Transactionalæ³¨è§£å¼€å¯äº‹åŠ¡ã€‚ä½†å¹¶ä¸æ˜¯è¯´ä¸€å®šä¸èƒ½ç”¨å®ƒï¼Œå¦‚æœé¡¹ç›®ä¸­æœ‰äº›ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”ä¸ç»å¸¸å˜åŠ¨ï¼Œä½¿ç”¨@Transactionalæ³¨è§£å¼€å¯äº‹åŠ¡å¼€å¯äº‹åŠ¡ä¹Ÿæ— å¦¨ï¼Œå› ä¸ºå®ƒæ›´ç®€å•ï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯åƒä¸‡è¦å°å¿ƒäº‹åŠ¡å¤±æ•ˆçš„é—®é¢˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlç´¢å¼•å¤±æ•ˆåœºæ™¯</title>
    <link href="/article/77f73530.html"/>
    <url>/article/77f73530.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /><p>explain ä½¿ç”¨å¦‚ä¸‹ï¼Œåªéœ€è¦åœ¨æŸ¥è¯¢çš„ SQL å‰é¢æ·»åŠ ä¸Š explain å…³é”®å­—å³å¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s2.51cto.com/oss/202401/05/c98243459b3d07235b86190a0b1484c26eeca4.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><p>è€Œä»¥ä¸ŠæŸ¥è¯¢ç»“æœçš„åˆ—ä¸­ï¼Œæˆ‘ä»¬æœ€ä¸»è¦è§‚å¯Ÿ key è¿™ä¸€åˆ—ï¼Œkey è¿™ä¸€åˆ—è¡¨ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æœä¸º NULL åˆ™è¡¨ç¤ºæœªä½¿ç”¨ç´¢å¼•ï¼Œåä¹‹åˆ™ä½¿ç”¨äº†ç´¢å¼•ã€‚</p><p>ä»¥ä¸Šæ‰€æœ‰ç»“æœåˆ—è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>id â€” é€‰æ‹©æ ‡è¯†ç¬¦ï¼Œid è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œï¼›</li><li>select_type â€” è¡¨ç¤ºæŸ¥è¯¢çš„ç±»å‹ï¼›</li><li>table â€” è¾“å‡ºç»“æœé›†çš„è¡¨ï¼›</li><li>partitions â€” åŒ¹é…çš„åˆ†åŒºï¼›</li><li>type â€” è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹ï¼›</li><li>possible_keys â€” è¡¨ç¤ºæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä½¿ç”¨çš„ç´¢å¼•ï¼›</li><li>key â€” è¡¨ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼›</li><li>key_len â€” ç´¢å¼•å­—æ®µçš„é•¿åº¦ï¼›</li><li>refâ€” Â åˆ—ä¸ç´¢å¼•çš„æ¯”è¾ƒï¼›</li><li>rows â€” å¤§æ¦‚ä¼°ç®—çš„è¡Œæ•°ï¼›</li><li>filtered â€” æŒ‰è¡¨æ¡ä»¶è¿‡æ»¤çš„è¡Œç™¾åˆ†æ¯”ï¼›</li><li>Extra â€” æ‰§è¡Œæƒ…å†µçš„æè¿°å’Œè¯´æ˜ã€‚</li></ul><p>å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ type å­—æ®µï¼Œtype å€¼ç±»å‹å¦‚ä¸‹ï¼š</p><ul><li>all â€” æ‰«æå…¨è¡¨æ•°æ®ï¼›</li><li>index â€” éå†ç´¢å¼•ï¼›</li><li>range â€” ç´¢å¼•èŒƒå›´æŸ¥æ‰¾ï¼›</li><li>index_subquery â€” åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ refï¼›</li><li>unique_subquery â€” åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ eq_refï¼›</li><li>ref_or_null â€” å¯¹ null è¿›è¡Œç´¢å¼•çš„ä¼˜åŒ–çš„ refï¼›</li><li>fulltext â€” ä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼›</li><li>ref â€” ä½¿ç”¨éå”¯ä¸€ç´¢å¼•æŸ¥æ‰¾æ•°æ®ï¼›</li><li>eq_ref â€” åœ¨ join æŸ¥è¯¢ä¸­ä½¿ç”¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•å…³è”ï¼›</li><li>const â€” å°†ä¸€ä¸ªä¸»é”®æ”¾ç½®åˆ° where åé¢ä½œä¸ºæ¡ä»¶æŸ¥è¯¢ï¼Œ MySQL ä¼˜åŒ–å™¨å°±èƒ½æŠŠè¿™æ¬¡æŸ¥è¯¢ä¼˜åŒ–è½¬åŒ–ä¸ºä¸€ä¸ªå¸¸é‡ï¼Œå¦‚ä½•è½¬åŒ–ä»¥åŠä½•æ—¶è½¬åŒ–ï¼Œè¿™ä¸ªå–å†³äºä¼˜åŒ–å™¨ï¼Œè¿™ä¸ªæ¯” eq_ref æ•ˆç‡é«˜ä¸€ç‚¹ã€‚</li></ul><h2 id="åˆ›å»ºæµ‹è¯•è¡¨å’Œæ•°æ®"><a href="#åˆ›å»ºæµ‹è¯•è¡¨å’Œæ•°æ®" class="headerlink" title="åˆ›å»ºæµ‹è¯•è¡¨å’Œæ•°æ®"></a>åˆ›å»ºæµ‹è¯•è¡¨å’Œæ•°æ®</h2><p>ä¸ºäº†æ¼”ç¤ºå’Œæµ‹è¯•é‚£ç§æƒ…å†µä¸‹ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•è¡¨å’Œç›¸åº”çš„æ•°æ®ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-comment">-- åˆ›å»ºè¡¨</span><br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> student;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>  id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;ä¸»é”®&#x27;</span>,<br>  sn <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;å­¦å·&#x27;</span>,<br>  <span class="hljs-type">name</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">250</span>) <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;å§“å&#x27;</span>,<br>  age <span class="hljs-type">int</span> <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;å¹´é¾„&#x27;</span>,<br>  sex <span class="hljs-type">bit</span> <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;æ€§åˆ«&#x27;</span>,<br>  address <span class="hljs-type">varchar</span>(<span class="hljs-number">250</span>) <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;å®¶åº­åœ°å€&#x27;</span>,<br>  key idx_address (address),<br>  key idx_sn_name_age (sn,<span class="hljs-type">name</span>,age)<br>)ENGINE=InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8;<br><span class="hljs-comment">-- æ·»åŠ æµ‹è¯•æ•°æ®</span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student(id,sn,<span class="hljs-type">name</span>,age,sex,address) <br>  <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;cn001&#x27;</span>,<span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>,<span class="hljs-number">18</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;é«˜è€åº„&#x27;</span>),<br>  (<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;cn002&#x27;</span>,<span class="hljs-string">&#x27;æå››&#x27;</span>,<span class="hljs-number">20</span>,<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;èŠ±æœå±±&#x27;</span>),<br>  (<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;cn003&#x27;</span>,<span class="hljs-string">&#x27;ç‹äº”&#x27;</span>,<span class="hljs-number">50</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;æ°´å¸˜æ´&#x27;</span>);<br></code></pre></td></tr></table></figure><p>å½“å‰è¡¨ä¸­æ€»å…±æœ‰ 3 ä¸ªç´¢å¼•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s9.51cto.com/oss/202401/05/3806d4a9089f58dbd3b641618e1def4c648fbc.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><blockquote><p>PSï¼šæœ¬æ–‡ä»¥ä¸‹å†…å®¹åŸºäº MySQL 5.7 InnoDB æ•°æ®å¼•æ“ä¸‹ã€‚</p></blockquote><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ1ï¼šéæœ€å·¦åŒ¹é…"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ1ï¼šéæœ€å·¦åŒ¹é…" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ1ï¼šéæœ€å·¦åŒ¹é…"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ1ï¼šéæœ€å·¦åŒ¹é…</h2><p>æœ€å·¦åŒ¹é…åŸåˆ™æŒ‡çš„æ˜¯ï¼Œä»¥æœ€å·¦è¾¹çš„ä¸ºèµ·ç‚¹å­—æ®µæŸ¥è¯¢å¯ä»¥ä½¿ç”¨è”åˆç´¢å¼•ï¼Œå¦åˆ™å°†ä¸èƒ½ä½¿ç”¨è”åˆç´¢å¼•ã€‚æˆ‘ä»¬æœ¬æ–‡çš„è”åˆç´¢å¼•çš„å­—æ®µé¡ºåºæ˜¯ sn + name + ageï¼Œæˆ‘ä»¬å‡è®¾å®ƒä»¬çš„é¡ºåºæ˜¯ A + B + Cï¼Œä»¥ä¸‹è”åˆç´¢å¼•çš„ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š</p><p><img src="https://s2.51cto.com/oss/202401/05/529c1db624f52d1e7d597156acc2ba4edc02d9.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><p>ä»ä¸Šè¿°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæ˜¯ä»¥æœ€å·¦è¾¹å¼€å§‹åŒ¹é…çš„å­—æ®µéƒ½å¯ä»¥ä½¿ç”¨ä¸Šè”åˆç´¢å¼•ï¼Œæ¯”å¦‚ï¼š</p><ul><li>A+B+C</li><li>A+B</li><li>A+C</li></ul><p>å…¶ä¸­ï¼šA ç­‰äºå­—æ®µ snï¼ŒB ç­‰äºå­—æ®µ nameï¼ŒC ç­‰äºå­—æ®µ ageã€‚</p><p>è€Œ B+C å´ä¸èƒ½ä½¿ç”¨åˆ°è”åˆç´¢å¼•ï¼Œè¿™å°±æ˜¯æœ€å·¦åŒ¹é…åŸåˆ™ã€‚</p><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ2ï¼šé”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ2ï¼šé”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ2ï¼šé”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ2ï¼šé”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢</h2><p>æ¨¡ç³ŠæŸ¥è¯¢ like çš„å¸¸è§ç”¨æ³•æœ‰ 3 ç§ï¼š</p><ol><li>æ¨¡ç³ŠåŒ¹é…åé¢ä»»æ„å­—ç¬¦ï¼šlike â€˜å¼ %â€™</li><li>æ¨¡ç³ŠåŒ¹é…å‰é¢ä»»æ„å­—ç¬¦ï¼šlike â€˜%å¼ â€™</li><li>æ¨¡ç³ŠåŒ¹é…å‰åä»»æ„å­—ç¬¦ï¼šlike â€˜%å¼ %â€™</li></ol><p>è€Œè¿™ 3 ç§æ¨¡ç³ŠæŸ¥è¯¢ä¸­åªæœ‰ç¬¬ 1 ç§æŸ¥è¯¢æ–¹å¼å¯ä»¥ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œå…·ä½“æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://s4.51cto.com/oss/202401/05/a4710fc55f261bb9c7b906d333145243664f8b.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ3ï¼šåˆ—è¿ç®—"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ3ï¼šåˆ—è¿ç®—" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ3ï¼šåˆ—è¿ç®—"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ3ï¼šåˆ—è¿ç®—</h2><p>å¦‚æœç´¢å¼•åˆ—ä½¿ç”¨äº†è¿ç®—ï¼Œé‚£ä¹ˆç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s9.51cto.com/oss/202401/05/a963cdb838e68bcc651773b024f8993f2b76af.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ4ï¼šä½¿ç”¨å‡½æ•°"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ4ï¼šä½¿ç”¨å‡½æ•°" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ4ï¼šä½¿ç”¨å‡½æ•°"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ4ï¼šä½¿ç”¨å‡½æ•°</h2><p>æŸ¥è¯¢åˆ—å¦‚æœä½¿ç”¨ä»»æ„ MySQL æä¾›çš„å‡½æ•°å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œæ¯”å¦‚ä»¥ä¸‹åˆ—ä½¿ç”¨äº† ifnull å‡½æ•°ä¹‹åçš„æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹ï¼š</p><p><img src="https://s6.51cto.com/oss/202401/05/e8d7d8421b0f5b5efa083794173cadc3eda521.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ5ï¼šç±»å‹è½¬æ¢"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ5ï¼šç±»å‹è½¬æ¢" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ5ï¼šç±»å‹è½¬æ¢"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ5ï¼šç±»å‹è½¬æ¢</h2><p>å¦‚æœç´¢å¼•åˆ—å­˜åœ¨ç±»å‹è½¬æ¢ï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šèµ°ç´¢å¼•ï¼Œæ¯”å¦‚ address ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œè€ŒæŸ¥è¯¢çš„æ—¶å€™è®¾ç½®äº† int ç±»å‹çš„å€¼å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s4.51cto.com/oss/202401/05/51d31085298744d53a2404a4a67ca315ccc92c.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ6ï¼šä½¿ç”¨-is-not-null"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ6ï¼šä½¿ç”¨-is-not-null" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ6ï¼šä½¿ç”¨ is not null"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ6ï¼šä½¿ç”¨ is not null</h2><p>å½“åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨äº† is not null ä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè€Œ is null åˆ™ä¼šæ­£å¸¸è§¦å‘ç´¢å¼•çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s3.51cto.com/oss/202401/05/181383c59fd058393171363a28a3a6f5fba130.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯¼è‡´ MySQL ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯æœ‰ä»¥ä¸‹ 6 ç§ï¼š</p><ol><li>è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™ã€‚</li><li>æ¨¡ç³ŠæŸ¥è¯¢æœ€å‰é¢çš„ä¸ºä¸ç¡®å®šåŒ¹é…å­—ç¬¦ã€‚</li><li>ç´¢å¼•åˆ—å‚ä¸äº†è¿ç®—ã€‚</li><li>ç´¢å¼•åˆ—ä½¿ç”¨äº†å‡½æ•°ã€‚</li><li>ç´¢å¼•åˆ—å­˜åœ¨ç±»å‹è½¬æ¢ã€‚</li><li>ç´¢å¼•åˆ—ä½¿ç”¨ is not null æŸ¥è¯¢ã€‚ä¸ºäº†éªŒè¯ MySQL ä¸­å“ªäº›æƒ…å†µä¸‹ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© explain æ‰§è¡Œè®¡åˆ’æ¥åˆ†æç´¢å¼•å¤±æ•ˆçš„å…·ä½“åœºæ™¯ã€‚</li></ol><p>explain ä½¿ç”¨å¦‚ä¸‹ï¼Œåªéœ€è¦åœ¨æŸ¥è¯¢çš„ SQL å‰é¢æ·»åŠ ä¸Š explain å…³é”®å­—å³å¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s2.51cto.com/oss/202401/05/c98243459b3d07235b86190a0b1484c26eeca4.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><p>è€Œä»¥ä¸ŠæŸ¥è¯¢ç»“æœçš„åˆ—ä¸­ï¼Œæˆ‘ä»¬æœ€ä¸»è¦è§‚å¯Ÿ key è¿™ä¸€åˆ—ï¼Œkey è¿™ä¸€åˆ—è¡¨ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æœä¸º NULL åˆ™è¡¨ç¤ºæœªä½¿ç”¨ç´¢å¼•ï¼Œåä¹‹åˆ™ä½¿ç”¨äº†ç´¢å¼•ã€‚</p><p>ä»¥ä¸Šæ‰€æœ‰ç»“æœåˆ—è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>id â€” é€‰æ‹©æ ‡è¯†ç¬¦ï¼Œid è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œï¼›</li><li>select_type â€” è¡¨ç¤ºæŸ¥è¯¢çš„ç±»å‹ï¼›</li><li>table â€” è¾“å‡ºç»“æœé›†çš„è¡¨ï¼›</li><li>partitions â€” åŒ¹é…çš„åˆ†åŒºï¼›</li><li>type â€” è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹ï¼›</li><li>possible_keys â€” è¡¨ç¤ºæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä½¿ç”¨çš„ç´¢å¼•ï¼›</li><li>key â€” è¡¨ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼›</li><li>key_len â€” ç´¢å¼•å­—æ®µçš„é•¿åº¦ï¼›</li><li>refâ€” Â åˆ—ä¸ç´¢å¼•çš„æ¯”è¾ƒï¼›</li><li>rows â€” å¤§æ¦‚ä¼°ç®—çš„è¡Œæ•°ï¼›</li><li>filtered â€” æŒ‰è¡¨æ¡ä»¶è¿‡æ»¤çš„è¡Œç™¾åˆ†æ¯”ï¼›</li><li>Extra â€” æ‰§è¡Œæƒ…å†µçš„æè¿°å’Œè¯´æ˜ã€‚</li></ul><p>å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ type å­—æ®µï¼Œtype å€¼ç±»å‹å¦‚ä¸‹ï¼š</p><ul><li>all â€” æ‰«æå…¨è¡¨æ•°æ®ï¼›</li><li>index â€” éå†ç´¢å¼•ï¼›</li><li>range â€” ç´¢å¼•èŒƒå›´æŸ¥æ‰¾ï¼›</li><li>index_subquery â€” åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ refï¼›</li><li>unique_subquery â€” åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ eq_refï¼›</li><li>ref_or_null â€” å¯¹ null è¿›è¡Œç´¢å¼•çš„ä¼˜åŒ–çš„ refï¼›</li><li>fulltext â€” ä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼›</li><li>ref â€” ä½¿ç”¨éå”¯ä¸€ç´¢å¼•æŸ¥æ‰¾æ•°æ®ï¼›</li><li>eq_ref â€” åœ¨ join æŸ¥è¯¢ä¸­ä½¿ç”¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•å…³è”ï¼›</li><li>const â€” å°†ä¸€ä¸ªä¸»é”®æ”¾ç½®åˆ° where åé¢ä½œä¸ºæ¡ä»¶æŸ¥è¯¢ï¼Œ MySQL ä¼˜åŒ–å™¨å°±èƒ½æŠŠè¿™æ¬¡æŸ¥è¯¢ä¼˜åŒ–è½¬åŒ–ä¸ºä¸€ä¸ªå¸¸é‡ï¼Œå¦‚ä½•è½¬åŒ–ä»¥åŠä½•æ—¶è½¬åŒ–ï¼Œè¿™ä¸ªå–å†³äºä¼˜åŒ–å™¨ï¼Œè¿™ä¸ªæ¯” eq_ref æ•ˆç‡é«˜ä¸€ç‚¹ã€‚</li></ul><h2 id="åˆ›å»ºæµ‹è¯•è¡¨å’Œæ•°æ®-1"><a href="#åˆ›å»ºæµ‹è¯•è¡¨å’Œæ•°æ®-1" class="headerlink" title="åˆ›å»ºæµ‹è¯•è¡¨å’Œæ•°æ®"></a>åˆ›å»ºæµ‹è¯•è¡¨å’Œæ•°æ®</h2><p>ä¸ºäº†æ¼”ç¤ºå’Œæµ‹è¯•é‚£ç§æƒ…å†µä¸‹ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•è¡¨å’Œç›¸åº”çš„æ•°æ®ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-comment">-- åˆ›å»ºè¡¨</span><br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> student;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>  id <span class="hljs-type">int</span> <span class="hljs-keyword">primary key</span> auto_increment <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;ä¸»é”®&#x27;</span>,<br>  sn <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;å­¦å·&#x27;</span>,<br>  <span class="hljs-type">name</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">250</span>) <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;å§“å&#x27;</span>,<br>  age <span class="hljs-type">int</span> <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;å¹´é¾„&#x27;</span>,<br>  sex <span class="hljs-type">bit</span> <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;æ€§åˆ«&#x27;</span>,<br>  address <span class="hljs-type">varchar</span>(<span class="hljs-number">250</span>) <span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;å®¶åº­åœ°å€&#x27;</span>,<br>  key idx_address (address),<br>  key idx_sn_name_age (sn,<span class="hljs-type">name</span>,age)<br>)ENGINE=InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8;<br><span class="hljs-comment">-- æ·»åŠ æµ‹è¯•æ•°æ®</span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student(id,sn,<span class="hljs-type">name</span>,age,sex,address) <br>  <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;cn001&#x27;</span>,<span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>,<span class="hljs-number">18</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;é«˜è€åº„&#x27;</span>),<br>  (<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;cn002&#x27;</span>,<span class="hljs-string">&#x27;æå››&#x27;</span>,<span class="hljs-number">20</span>,<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;èŠ±æœå±±&#x27;</span>),<br>  (<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;cn003&#x27;</span>,<span class="hljs-string">&#x27;ç‹äº”&#x27;</span>,<span class="hljs-number">50</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;æ°´å¸˜æ´&#x27;</span>);<br></code></pre></td></tr></table></figure><p>å½“å‰è¡¨ä¸­æ€»å…±æœ‰ 3 ä¸ªç´¢å¼•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s9.51cto.com/oss/202401/05/3806d4a9089f58dbd3b641618e1def4c648fbc.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><blockquote><p>PSï¼šæœ¬æ–‡ä»¥ä¸‹å†…å®¹åŸºäº MySQL 5.7 InnoDB æ•°æ®å¼•æ“ä¸‹ã€‚</p></blockquote><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ1ï¼šéæœ€å·¦åŒ¹é…-1"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ1ï¼šéæœ€å·¦åŒ¹é…-1" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ1ï¼šéæœ€å·¦åŒ¹é…"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ1ï¼šéæœ€å·¦åŒ¹é…</h2><p>æœ€å·¦åŒ¹é…åŸåˆ™æŒ‡çš„æ˜¯ï¼Œä»¥æœ€å·¦è¾¹çš„ä¸ºèµ·ç‚¹å­—æ®µæŸ¥è¯¢å¯ä»¥ä½¿ç”¨è”åˆç´¢å¼•ï¼Œå¦åˆ™å°†ä¸èƒ½ä½¿ç”¨è”åˆç´¢å¼•ã€‚æˆ‘ä»¬æœ¬æ–‡çš„è”åˆç´¢å¼•çš„å­—æ®µé¡ºåºæ˜¯ sn + name + ageï¼Œæˆ‘ä»¬å‡è®¾å®ƒä»¬çš„é¡ºåºæ˜¯ A + B + Cï¼Œä»¥ä¸‹è”åˆç´¢å¼•çš„ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š</p><p><img src="https://s2.51cto.com/oss/202401/05/529c1db624f52d1e7d597156acc2ba4edc02d9.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><p>ä»ä¸Šè¿°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæ˜¯ä»¥æœ€å·¦è¾¹å¼€å§‹åŒ¹é…çš„å­—æ®µéƒ½å¯ä»¥ä½¿ç”¨ä¸Šè”åˆç´¢å¼•ï¼Œæ¯”å¦‚ï¼š</p><ul><li>A+B+C</li><li>A+B</li><li>A+C</li></ul><p>å…¶ä¸­ï¼šA ç­‰äºå­—æ®µ snï¼ŒB ç­‰äºå­—æ®µ nameï¼ŒC ç­‰äºå­—æ®µ ageã€‚</p><p>è€Œ B+C å´ä¸èƒ½ä½¿ç”¨åˆ°è”åˆç´¢å¼•ï¼Œè¿™å°±æ˜¯æœ€å·¦åŒ¹é…åŸåˆ™ã€‚</p><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ2ï¼šé”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢-1"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ2ï¼šé”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢-1" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ2ï¼šé”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ2ï¼šé”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢</h2><p>æ¨¡ç³ŠæŸ¥è¯¢ like çš„å¸¸è§ç”¨æ³•æœ‰ 3 ç§ï¼š</p><ol><li>æ¨¡ç³ŠåŒ¹é…åé¢ä»»æ„å­—ç¬¦ï¼šlike â€˜å¼ %â€™</li><li>æ¨¡ç³ŠåŒ¹é…å‰é¢ä»»æ„å­—ç¬¦ï¼šlike â€˜%å¼ â€™</li><li>æ¨¡ç³ŠåŒ¹é…å‰åä»»æ„å­—ç¬¦ï¼šlike â€˜%å¼ %â€™</li></ol><p>è€Œè¿™ 3 ç§æ¨¡ç³ŠæŸ¥è¯¢ä¸­åªæœ‰ç¬¬ 1 ç§æŸ¥è¯¢æ–¹å¼å¯ä»¥ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œå…·ä½“æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://s4.51cto.com/oss/202401/05/a4710fc55f261bb9c7b906d333145243664f8b.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ3ï¼šåˆ—è¿ç®—-1"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ3ï¼šåˆ—è¿ç®—-1" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ3ï¼šåˆ—è¿ç®—"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ3ï¼šåˆ—è¿ç®—</h2><p>å¦‚æœç´¢å¼•åˆ—ä½¿ç”¨äº†è¿ç®—ï¼Œé‚£ä¹ˆç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s9.51cto.com/oss/202401/05/a963cdb838e68bcc651773b024f8993f2b76af.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ4ï¼šä½¿ç”¨å‡½æ•°-1"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ4ï¼šä½¿ç”¨å‡½æ•°-1" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ4ï¼šä½¿ç”¨å‡½æ•°"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ4ï¼šä½¿ç”¨å‡½æ•°</h2><p>æŸ¥è¯¢åˆ—å¦‚æœä½¿ç”¨ä»»æ„ MySQL æä¾›çš„å‡½æ•°å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œæ¯”å¦‚ä»¥ä¸‹åˆ—ä½¿ç”¨äº† ifnull å‡½æ•°ä¹‹åçš„æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹ï¼š</p><p><img src="https://s6.51cto.com/oss/202401/05/e8d7d8421b0f5b5efa083794173cadc3eda521.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ5ï¼šç±»å‹è½¬æ¢-1"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ5ï¼šç±»å‹è½¬æ¢-1" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ5ï¼šç±»å‹è½¬æ¢"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ5ï¼šç±»å‹è½¬æ¢</h2><p>å¦‚æœç´¢å¼•åˆ—å­˜åœ¨ç±»å‹è½¬æ¢ï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šèµ°ç´¢å¼•ï¼Œæ¯”å¦‚ address ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œè€ŒæŸ¥è¯¢çš„æ—¶å€™è®¾ç½®äº† int ç±»å‹çš„å€¼å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s4.51cto.com/oss/202401/05/51d31085298744d53a2404a4a67ca315ccc92c.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><h2 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ6ï¼šä½¿ç”¨-is-not-null-1"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ6ï¼šä½¿ç”¨-is-not-null-1" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ6ï¼šä½¿ç”¨ is not null"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ6ï¼šä½¿ç”¨ is not null</h2><p>å½“åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨äº† is not null ä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè€Œ is null åˆ™ä¼šæ­£å¸¸è§¦å‘ç´¢å¼•çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s3.51cto.com/oss/202401/05/181383c59fd058393171363a28a3a6f5fba130.png" alt="å›¾ç‰‡" title="å›¾ç‰‡">å›¾ç‰‡</p><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯¼è‡´ MySQL ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯æœ‰ä»¥ä¸‹ 6 ç§ï¼š</p><ol><li>è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™ã€‚</li><li>æ¨¡ç³ŠæŸ¥è¯¢æœ€å‰é¢çš„ä¸ºä¸ç¡®å®šåŒ¹é…å­—ç¬¦ã€‚</li><li>ç´¢å¼•åˆ—å‚ä¸äº†è¿ç®—ã€‚</li><li>ç´¢å¼•åˆ—ä½¿ç”¨äº†å‡½æ•°ã€‚</li><li>ç´¢å¼•åˆ—å­˜åœ¨ç±»å‹è½¬æ¢ã€‚</li><li>ç´¢å¼•åˆ—ä½¿ç”¨ is not null æŸ¥è¯¢ã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
      <tag>ç´¢å¼•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redisé›†ç¾¤ç»´æŠ¤</title>
    <link href="/article/7ea8260e.html"/>
    <url>/article/7ea8260e.html</url>
    
    <content type="html"><![CDATA[<p><strong>ç›®å½•</strong></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t0">å‰è¨€</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t1">1ã€ â€“cluster createÂ  åˆ›å»ºé›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t2">2ã€â€“cluster checkÂ Â æ£€æŸ¥é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t3">3ã€â€“cluster info æŸ¥çœ‹é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t4">4ã€â€“cluster fixÂ  ä¿®å¤é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t5">5ã€â€“cluster rehard è¿ç§»æ§½ä½</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t6">6ã€ â€“cluster rebalance å¹³è¡¡é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t7">7ã€ â€“clusterÂ Â add-nodeÂ  Â  é›†ç¾¤æ‰©å®¹</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t8">8ã€â€“cluster del-nodeÂ  Â  Â  é›†ç¾¤ç¼©å®¹</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t9">9ã€ â€“cluster callÂ  åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t10">10ã€â€“cluster set-timeoutÂ  Â  Â æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t11">11ã€â€“cluster importÂ  Â  Â  Â  Â  å¯¼å…¥æ•°æ®è‡³é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t12">12ã€â€“cluster backupÂ  Â  Â  Â  Â å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶</a></p><hr><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>redis-trib.rb</code>æ˜¯å®˜æ–¹æä¾›çš„Redis Clusterçš„ç®¡ç†å·¥å…·ï¼Œå®ƒæä¾›äº†é›†ç¾¤åˆ›å»ºã€æ£€æŸ¥ã€ä¿®å¤ã€å‡è¡¡ç­‰å‘½ä»¤è¡Œå·¥å…·ã€‚Redis Cluster åœ¨5.0ä¹‹åå–æ¶ˆäº†rubyè„šæœ¬çš„æ”¯æŒï¼Œè€Œæ˜¯ç›´æ¥é›†åˆåˆ°redis-clié‡Œï¼Œé¿å…äº†å†å®‰è£…rubyçš„ç›¸å…³ç¯å¢ƒã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">[root@localhost bin]# ./redis-cli --cluster helpCluster Manager Commands:  create         host1:port1 ... hostN:portN                 --cluster-replicas <span class="hljs-symbol">&lt;arg&gt;</span>  check          hos<span class="hljs-variable">t:port</span>                 --cluster-<span class="hljs-built_in">search</span>-multiple-owners  info           hos<span class="hljs-variable">t:port</span>  <span class="hljs-keyword">fix</span>            hos<span class="hljs-variable">t:port</span>                 --cluster-<span class="hljs-built_in">search</span>-multiple-owners                 --cluster-<span class="hljs-keyword">fix</span>-with-unreachable-masters  reshard        hos<span class="hljs-variable">t:port</span>                 --cluster-from <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-<span class="hljs-keyword">to</span> <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-slots <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-yes                 --cluster-timeout <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-pipeline <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-replace  rebalance      hos<span class="hljs-variable">t:port</span>                 --cluster-weight &lt;node1=w1...nodeN=<span class="hljs-keyword">wN</span>&gt;                 --cluster-use-<span class="hljs-built_in">empty</span>-masters                 --cluster-timeout <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-simulate                 --cluster-pipeline <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-threshold <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-replace  <span class="hljs-built_in">add</span>-node       new_hos<span class="hljs-variable">t:new_port</span> existing_hos<span class="hljs-variable">t:existing_port</span>                 --cluster-slave                 --cluster-master-id <span class="hljs-symbol">&lt;arg&gt;</span>  del-node       hos<span class="hljs-variable">t:port</span> node_id  <span class="hljs-keyword">call</span>           hos<span class="hljs-variable">t:port</span> <span class="hljs-keyword">command</span> arg arg .. arg                 --cluster-<span class="hljs-keyword">only</span>-masters                 --cluster-<span class="hljs-keyword">only</span>-replicas  <span class="hljs-keyword">set</span>-timeout    hos<span class="hljs-variable">t:port</span> milliseconds  import         hos<span class="hljs-variable">t:port</span>                 --cluster-from <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-from-user <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-from-pass <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-from-askpass                 --cluster-<span class="hljs-keyword">copy</span>                 --cluster-replace  backup         hos<span class="hljs-variable">t:port</span> backup_directory  <span class="hljs-keyword">help</span>            For check, <span class="hljs-keyword">fix</span>, reshard, del-node, <span class="hljs-keyword">set</span>-timeout you can specify the host <span class="hljs-built_in">and</span> port of any working node in the cluster. Cluster Manager Options:  --cluster-yes  Automatic yes <span class="hljs-keyword">to</span> cluster commands prompts <br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†çš„è¯´ä¸‹å„å‘½ä»¤çš„ç”¨æ³•å’Œä½œç”¨ï¼š</p><h2 id="1ã€-â€“cluster-create-åˆ›å»ºé›†ç¾¤"><a href="#1ã€-â€“cluster-create-åˆ›å»ºé›†ç¾¤" class="headerlink" title="1ã€ â€“cluster createÂ  åˆ›å»ºé›†ç¾¤"></a><strong>1ã€ â€“cluster create</strong>Â  åˆ›å»º<strong>é›†ç¾¤</strong></h2><p>create Â  Â  Â  Â  host1:port1 â€¦ hostN:portN<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replicas <arg></p><p>è¯¥å‘½ä»¤ç”¨æ¥åˆ›å»ºé›†ç¾¤ï¼Œå‡è®¾æˆ‘ç°åœ¨æƒ³æ­å»ºä¸‰ä¸»ä¸‰ä»çš„é›†ç¾¤127.0.0.1:7001~7006</p><p>å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹åï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ­å»ºï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">redis-cli --cluster create <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7001 127.0</span>.<span class="hljs-number">0.1:7002</span>Â <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7003Â 127.0</span>.<span class="hljs-number">0.1:7004</span>Â <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7005Â 127.0</span>.<span class="hljs-number">0.1:7006</span>Â --cluster-replicas <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>--cluster-replicas 1 :è¡¨ç¤ºæ¯ä¸ªä¸»èŠ‚ç‚¹éœ€è¦1ä¸ªä»èŠ‚ç‚¹ã€‚è¿™é‡Œéšæœºåˆ†é…ä¸»ä»å…³ç³»ï¼Œå¦‚æœéœ€è¦å®šåˆ¶ï¼Œåˆ™å¯ä»¥ä¸åŠ è¯¥å‚æ•°ï¼Œä½¿ç”¨add-nodeæ¥å®šåˆ¶,æŸ¥çœ‹ç¬¬7èŠ‚</p><h2 id="2ã€â€“cluster-check-æ£€æŸ¥é›†ç¾¤"><a href="#2ã€â€“cluster-check-æ£€æŸ¥é›†ç¾¤" class="headerlink" title="2ã€â€“cluster checkÂ Â æ£€æŸ¥é›†ç¾¤"></a><strong>2ã€â€“cluster checkÂ Â æ£€æŸ¥é›†ç¾¤</strong></h2><p>check Â  Â  Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-search-multiple-ownersÂ #æ£€æŸ¥æ˜¯å¦æœ‰æ§½åŒæ—¶è¢«åˆ†é…ç»™äº†å¤šä¸ªèŠ‚ç‚¹</p><p>è¯¥å‘½ä»¤ç»å¸¸ä½¿ç”¨ï¼Œéœ€è¦æ‹¥æœ‰æ§½ä½çš„æ‰€æœ‰èŠ‚ç‚¹ä¸ºå¯åŠ¨çŠ¶æ€ï¼Œç”¨äºæ£€æŸ¥é›†ç¾¤çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œåªæœ‰å½“æ‰€æœ‰çš„æ§½ä½æ­£å¸¸æ—¶ï¼Œé›†ç¾¤çŠ¶æ€æ‰OK</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/f1b7cd4b9fc1eb68c1e9383ac8005d40.png"></p><h2 id="3ã€â€“cluster-info-æŸ¥çœ‹é›†ç¾¤"><a href="#3ã€â€“cluster-info-æŸ¥çœ‹é›†ç¾¤" class="headerlink" title="3ã€â€“cluster info æŸ¥çœ‹é›†ç¾¤"></a><strong>3ã€â€“cluster info æŸ¥çœ‹é›†ç¾¤</strong></h2><p>ç”¨äºæŸ¥çœ‹é›†ç¾¤çš„ç®€æ˜“ä¿¡æ¯</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/d3968b7dce8b99f3fc589b2eba9104df.png"></p><h2 id="4ã€â€“cluster-fix-ä¿®å¤é›†ç¾¤"><a href="#4ã€â€“cluster-fix-ä¿®å¤é›†ç¾¤" class="headerlink" title="4ã€â€“cluster fixÂ  ä¿®å¤é›†ç¾¤"></a><strong>4ã€â€“cluster fixÂ  ä¿®å¤é›†ç¾¤</strong></h2><p>fix Â  Â  Â  Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-search-multiple-ownersÂ  Â Â <br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-fix-with-unreachable-mastersÂ Â </p><p>è¯¥å‘½ä»¤ååˆ†æœ‰ç”¨ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š</p><p>Â â€“cluster-search-multiple-owners ï¼š æ˜¯å¦ä¿®å¤å¤šä¸ªæ‹¥æœ‰è€…çš„æ§½ä½ã€‚å½“é›†ç¾¤ä¸­çš„æ§½ä½åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå‡ºç°æ„å¤–æ—¶ï¼Œä½¿ç”¨fixå¯ä½¿ç”¨è¯¥å‚æ•°ã€‚fixåŠŸèƒ½ï¼Œrediså†…éƒ¨åœ¨æ§½ä½çš„æŸäº›å¼‚å¸¸æƒ…å†µä¸‹ä¼šäº¤äº’å¼çš„è¯¢é—®æ“ä½œè€…æ˜¯å¦åŒæ„å®ƒçš„ä¿®å¤ç­–ç•¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé»˜è®¤å³å¯ã€‚</p><p>Â â€“cluster-fix-with-unreachable-masters ï¼š æ˜¯å¦ä¿®å¤ä¸å¯è¾¾çš„ä¸»èŠ‚ç‚¹ä¸Šçš„æ§½ä½ã€‚ä¾‹å¦‚ï¼Œé›†ç¾¤ä¸­æŸä¸ªä¸»èŠ‚ç‚¹å°±æ˜¯åæ‰äº†ï¼Œä¹Ÿæ²¡æœ‰æ•…éšœè½¬ç§»æˆåŠŸã€‚æ­¤æ—¶å¦‚ä½•æ¢å¤è¯¥ä¸»èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æ§½ä½å‘¢ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨è¯¥å‚æ•°ï¼Œä¼šå°†å¤„äºè¯¥ä¸»èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æ§½ä½æ¢å¤åˆ°å­˜æ´»çš„ä¸»èŠ‚ç‚¹ä¸Šï¼ˆä¹‹å‰çš„æ•°æ®ä¼šä¸¢å¤±ï¼Œä»…ä»…æ˜¯æ¢å¤äº†æ§½ä½ï¼‰ã€‚</p><h2 id="5ã€â€“cluster-rehard-è¿ç§»æ§½ä½"><a href="#5ã€â€“cluster-rehard-è¿ç§»æ§½ä½" class="headerlink" title="5ã€â€“cluster rehard è¿ç§»æ§½ä½"></a><strong>5ã€â€“cluster rehard è¿ç§»æ§½ä½</strong></h2><p>reshard Â  Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from <arg>Â  Â #æ§½ä½æ¥æºçš„èŠ‚ç‚¹è¿è¡Œidï¼Œå¤šä¸ªç”¨,åˆ†å‰²ï¼Œallè¡¨ç¤ºå…¨éƒ¨èŠ‚ç‚¹<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-to <arg>Â  Â  Â  Â #ç›®æ ‡èŠ‚ç‚¹çš„è¿è¡Œidï¼Œåªå…ä¸€ä¸ª<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-slots <arg>Â  Â #è¿ç§»çš„æ§½ä½æ•°<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-yesÂ  Â  Â  Â  Â  Â  Â  Â #æ˜¯å¦é»˜è®¤åŒæ„é›†ç¾¤å†…éƒ¨çš„è¿ç§»è®¡åˆ’ï¼ˆé»˜è®¤åŒæ„å°±å¯ä»¥ï¼‰<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-timeout <arg>Â  Â #è¿ç§»å‘½ä»¤ï¼ˆmigrateï¼‰çš„è¶…æ—¶æ—¶é—´<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-pipeline <arg>Â  #è¿ç§»keyæ—¶ï¼Œä¸€æ¬¡å–å‡º çš„keyæ•°é‡ï¼Œé»˜è®¤10<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replaceÂ  Â  Â  Â  Â  Â #æ˜¯å¦ç›´æ¥replaceåˆ°ç›®æ ‡èŠ‚ç‚¹</p><p>è¿ç§»ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼ˆâ€“cluster-fromï¼‰èŠ‚ç‚¹ä¸Šçš„â€“cluster-slotsä¸ªæ§½ä½è‡³ä¸€ä¸ªç›®æ ‡èŠ‚ç‚¹ï¼ˆâ€“cluster-toï¼‰ä¸Šã€‚</p><p>Â â€“cluster-from çš„å€¼ä¸ä¸ºallçš„æƒ…å†µä¸‹ï¼ŒÂ â€“cluster-fromä¸èƒ½åŒ…å«â€“cluster-to</p><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ•´ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰è¿è¡Œid</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">[root@localhost bin]# ./redis-cli -h <span class="hljs-number">192.168.84.1</span> -p <span class="hljs-number">7001</span> cluster nodes8ae862c1815ff89e49d6c8801ea0cb074e82855c <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7006@17006</span> slave <span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span> <span class="hljs-number">0</span> <span class="hljs-number">1694427906290</span> <span class="hljs-number">3</span> connectedf6df82f6c67fbe83049d6f95a8473221afee2ee<span class="hljs-number">6 192.168.84</span>.<span class="hljs-number">1</span>:<span class="hljs-number">7004@17004</span> slave <span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41ea <span class="hljs-number">0</span> <span class="hljs-number">1694427905000</span> <span class="hljs-number">1</span> connected222df2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span> <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7003@17003</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1694427904000</span> <span class="hljs-number">3</span> connected <span class="hljs-number">10923</span>-<span class="hljs-number">163834</span>cdc4c8127dc5ea8d15a239fa6c2f3c09b0d5f3a <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7005@17005</span> slave <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-number">0</span> <span class="hljs-number">1694427905255</span> <span class="hljs-number">2</span> connected30c69d9e408015082c1a2145875cd1ec0c7a41ea <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001@17001</span> myself,master - <span class="hljs-number">0</span> <span class="hljs-number">1694427902000</span> <span class="hljs-number">1</span> connected <span class="hljs-number">0</span>-<span class="hljs-number">546010</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7002@17002</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1694427902000</span> <span class="hljs-number">2</span> connected <span class="hljs-number">5461-10922</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡é›†ç¾¤çš„é…ç½®æ–‡ä»¶æŸ¥çœ‹ä¹Ÿå¯ä»¥</p><h2 id="6ã€-â€“cluster-rebalance-å¹³è¡¡é›†ç¾¤"><a href="#6ã€-â€“cluster-rebalance-å¹³è¡¡é›†ç¾¤" class="headerlink" title="6ã€ â€“cluster rebalance å¹³è¡¡é›†ç¾¤"></a>6ã€ <strong>â€“cluster rebalance å¹³è¡¡é›†ç¾¤</strong></h2><p>rebalance Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-weight &lt;node1&#x3D;w1â€¦nodeN&#x3D;wN&gt;<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-use-empty-masters<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-timeout <arg>Â  Â  Â #è¿ç§»å‘½ä»¤ï¼ˆmigrateï¼‰çš„è¶…æ—¶æ—¶é—´<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-simulateÂ  Â  Â  Â  Â  Â  Â  #Â æ¨¡æ‹Ÿrebalanceæ“ä½œï¼Œä¸ä¼šçœŸæ­£æ‰§è¡Œè¿ç§»æ“ä½œ<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-pipeline <arg>Â  Â  #å®šä¹‰Â getkeysinslotå‘½ä»¤ä¸€æ¬¡å–å‡ºçš„keyæ•°é‡ï¼Œé»˜è®¤å€¼ä¸º10<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-threshold <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replaceÂ  Â  Â  Â  Â  Â  Â  Â #æ˜¯å¦ç›´æ¥replaceåˆ°ç›®æ ‡èŠ‚ç‚¹</p><p>--cluster-weightï¼š æ§½ä½æƒé‡ï¼ˆæµ®ç‚¹å‹ï¼‰æ¯”å€¼ï¼Œä¾‹å¦‚ï¼ˆè¿™é‡Œä½¿ç”¨ç«¯å£å·ä»£æ›¿è¿è¡Œidï¼‰ï¼š 7001&#x3D;1.0,7002&#x3D;1.0,7003&#x3D;2.0 åˆ™è¡¨ç¤ºï¼Œæ€»æƒé‡ä¸º4.0ï¼Œ 7001å’Œ7002å°†åˆ†é…åˆ° (16384&#x2F;4)*1Â  ä¸ªæ§½ä½ï¼Œ7003åˆ™æ˜¯(16384&#x2F;4)*2ä¸ªæ§½ä½ã€‚</p><p>Â â€“cluster-threshold: å¹³è¡¡è§¦å‘çš„é˜ˆå€¼æ¡ä»¶ï¼Œé»˜è®¤ä¸º2.00%ã€‚ä¾‹å¦‚ä¸Šä¸€æ­¥ï¼Œ7001å’Œ7002åº”è¯¥æœ‰4096ä¸ªæ§½ä½ï¼Œå¦‚æœ7001çš„æ§½ä½æ•°ä¸å¤Ÿ4096ä¸ªï¼Œä¸”è¶…è¿‡ (4096*0.02 çº¦ç­‰äº)82ä¸ªåŠä»¥ä¸Šï¼›æˆ–è€…7001çš„æ§½ä½æ•°æ¯”4096å°‘äº82ä¸ªåŠä»¥ä¸Šï¼Œåˆ™ä¼šè§¦å‘è‡ªå¹³è¡¡ã€‚</p><h2 id="7ã€-â€“cluster-add-node-é›†ç¾¤æ‰©å®¹"><a href="#7ã€-â€“cluster-add-node-é›†ç¾¤æ‰©å®¹" class="headerlink" title="7ã€ â€“clusterÂ Â add-nodeÂ  Â  é›†ç¾¤æ‰©å®¹"></a><strong>7ã€ â€“clusterÂ Â add-nodeÂ  Â  é›†ç¾¤æ‰©å®¹</strong></h2><p>add-node Â  Â new_host:new_portÂ  Â  Â  Â  Â  Â Â Â Â Â Â Â Â #æ–°åŠ å…¥é›†ç¾¤çš„ipå’Œport</p><p>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â existing_host:existing_portÂ  Â  Â  Â  Â  #é›†ç¾¤ä¸­ä»»ä¸€èŠ‚ç‚¹çš„ipå’Œport<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-slaveÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â #æ–°èŠ‚ç‚¹ä½œä¸ºä»èŠ‚ç‚¹ï¼Œé»˜è®¤éšæœºä¸€ä¸ªä¸»èŠ‚ç‚¹<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-master-id <arg>Â  Â  Â  Â  Â  Â  #ç»™æ–°èŠ‚ç‚¹æŒ‡å®šä¸»èŠ‚ç‚¹,å€¼ä¸ºèŠ‚ç‚¹çš„è¿è¡Œid</p><p>å¯ç”¨äºå‘é›†ç¾¤ä¸­æ·»åŠ ä¸»ã€ä»èŠ‚ç‚¹(å³æ‰©å®¹)</p><p>å‡è®¾æˆ‘ç°åœ¨é›†ç¾¤ä¸­æœ‰7001 7002 7003ä¸‰ä¸ªä¸»èŠ‚ç‚¹äº†ï¼Œæƒ³ä¸º7001æ·»åŠ ä¸€ä¸ªä»èŠ‚ç‚¹127.0.0.1:7006ï¼Œåˆ™å¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">redis-cli --cluster<span class="hljs-built_in"> add-node </span>127.0.0.1:7006 127.0.0.1:7001Â Â --cluster-slave --cluster-master-id 30c69d9e408015082c1a2145875cd1ec0c7a41ea<br></code></pre></td></tr></table></figure><p>Â ä¸ä¼ å…¥â€“cluster-slave â€“cluster-master-id å‚æ•°ï¼Œè¡¨ç¤ºæ·»åŠ ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚</p><p>å½“æ·»åŠ çš„æ˜¯ä¸€ä¸ªä¸»èŠ‚ç‚¹æ—¶ï¼Œæ­¤æ—¶ï¼Œè¯¥ä¸»èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•æ§½ä½ï¼Œå¯ä»¥ä½¿ç”¨rebalanceæˆ–è€…reshardæ¥è¿ç§»æ§½ä½ç»™å®ƒã€‚</p><h2 id="8ã€â€“cluster-del-node-é›†ç¾¤ç¼©å®¹"><a href="#8ã€â€“cluster-del-node-é›†ç¾¤ç¼©å®¹" class="headerlink" title="8ã€â€“cluster del-nodeÂ  Â  Â  é›†ç¾¤ç¼©å®¹"></a><strong>8ã€â€“cluster del-nodeÂ  Â  Â  é›†ç¾¤ç¼©å®¹</strong></h2><p>del-nodeÂ  Â  host:port node_idÂ  Â  Â  Â  Â #åˆ é™¤ç»™å®šçš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæˆåŠŸåå…³é—­è¯¥èŠ‚ç‚¹æœåŠ¡</p><p>ä¹Ÿå°±æ˜¯ç¼©å®¹ã€‚</p><p>åˆ é™¤ä¸€ä¸ªä¸»èŠ‚ç‚¹è¦æ±‚å…ˆè¿ç§»èµ°æ”¹ä¸»èŠ‚ç‚¹ä¸Šçš„æ§½ä½ï¼ˆæ•°æ®ï¼‰ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨reshardå‘½ä»¤äº†ã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[root@localhost bin]</span># ./redis-cli --cluster del-node <span class="hljs-number">192.168</span><span class="hljs-number">.84</span><span class="hljs-number">.1</span>:<span class="hljs-number">7002</span> <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe&gt;&gt;&gt; Removing node <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-keyword">from</span> cluster <span class="hljs-number">192.168</span><span class="hljs-number">.84</span><span class="hljs-number">.1</span>:<span class="hljs-number">7002</span>[ERR] Node <span class="hljs-number">192.168</span><span class="hljs-number">.84</span><span class="hljs-number">.1</span>:<span class="hljs-number">7002</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> empty! Reshard data away <span class="hljs-keyword">and</span> <span class="hljs-keyword">try</span> again.<br></code></pre></td></tr></table></figure><h2 id="9ã€-â€“cluster-call-åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤"><a href="#9ã€-â€“cluster-call-åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤" class="headerlink" title="9ã€ â€“cluster callÂ  åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤"></a><strong>9ã€ â€“cluster call</strong>Â  åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤</h2><p>call Â  Â  Â  Â  Â  host:port command arg arg .. argÂ  Â  Â  Â  Â  Â  Â  Â #åœ¨é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œç›¸å…³å‘½ä»¤<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-only-mastersÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  #æ˜¯å¦åªåœ¨ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-only-replicasÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â #æ˜¯å¦åªåœ¨ä»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/59db12799c1a7acd9c6fc267ccf790fc.png"></p><h2 id="10ã€â€“cluster-set-timeout-æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´"><a href="#10ã€â€“cluster-set-timeout-æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´" class="headerlink" title="10ã€â€“cluster set-timeoutÂ  Â  Â æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´"></a><strong>10ã€â€“cluster set-timeout</strong>Â  Â  Â æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´</h2><p>Â Â Â Â Â Â Â Â set-timeout Â  Â host:port milliseconds</p><p>è®¾ç½®æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´</p><h2 id="11ã€â€“cluster-import-å¯¼å…¥æ•°æ®è‡³é›†ç¾¤"><a href="#11ã€â€“cluster-import-å¯¼å…¥æ•°æ®è‡³é›†ç¾¤" class="headerlink" title="11ã€â€“cluster importÂ  Â  Â  Â  Â  å¯¼å…¥æ•°æ®è‡³é›†ç¾¤"></a><strong>11ã€â€“cluster import</strong>Â  Â  Â  Â  Â  å¯¼å…¥æ•°æ®è‡³é›†ç¾¤</h2><p>import Â  Â  Â  Â  host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from-user <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from-pass <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from-askpass<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-copyÂ  Â  Â Â Â Â Â Â Â Â Â Â Â #migrateæ—¶æŒ‡å®šç±»å‹ä¸ºcopy<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replaceÂ  Â Â Â Â Â Â Â Â Â #migrateæ—¶æŒ‡å®šç±»å‹ä¸ºreplace</p><p>å°†å¤–éƒ¨redisçš„æ•°æ®å¯¼å…¥é›†ç¾¤Â </p><p>redis-cli â€“cluster import 127.0.01:6379 â€“cluster-from 127.0.0.2:6379 â€“cluster-replace â€“cluster-copy</p><p>è¯´æ˜ï¼šå¤–éƒ¨Rediså®ä¾‹ï¼ˆ127.0.0.2:6379ï¼‰å¯¼å…¥åˆ°é›†ç¾¤ä¸­çš„ä»»æ„ä¸€èŠ‚ç‚¹ï¼Œå€’å…¥ä¹‹åï¼ŒåŸæ¥é›†ç¾¤çš„keyå˜ä¸ºç©ºï¼Œå¯¼å…¥åˆ°æ–°é›†ç¾¤çš„keyä¼šè‡ªåŠ¨åˆ†ç‰‡åˆ°å„ä¸ªmaterèŠ‚ç‚¹çš„slot</p><p>--cluster-replace å¦‚æœé›†ç¾¤ï¼ˆ127.0.01:6379ï¼‰ä¸­å­˜åœ¨å¤–éƒ¨rediså®ä¾‹ï¼ˆ127.0.0.2:6379ï¼‰çš„keyï¼Œåˆ™ä¼šè¦†ç›–æ‰ï¼ˆ10.35.2.68:6379ï¼‰çš„value</p><p>--cluster-copy é»˜è®¤æƒ…å†µä¸‹ï¼Œimport å‘½ä»¤åœ¨å‘é›†ç¾¤å¯¼å…¥æ•°æ®çš„åŒæ—¶ï¼Œè¿˜ä¼šåˆ é™¤å•æœºæœåŠ¡å™¨ä¸­æºæ•°æ®ã€‚å¦‚æœç”¨æˆ·æƒ³è¦ä¿ç•™å•æœºæœåŠ¡å™¨ä¸­çš„æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨æ‰§è¡Œå‘½ä»¤çš„åŒæ—¶ç»™å®š â€“cluster-copy é€‰é¡¹Â </p><p>è¯¥å‘½ä»¤å°†æ­£åœ¨è¿è¡Œçš„å®ä¾‹çš„æ‰€æœ‰é”®ï¼ˆä»æºå®ä¾‹ä¸­åˆ é™¤é”®ï¼‰ç§»åŠ¨åˆ°æŒ‡å®šçš„é¢„å…ˆå­˜åœ¨çš„ Redis é›†ç¾¤ã€‚</p><p>å®é™…é¡¹ç›®ä¸Šï¼Œæ•°æ®å¯¼å…¥åº”è¯¥ç”¨redis-shakeå·¥å…·çš„æ¯”è¾ƒå¤šã€‚</p><h2 id="12ã€â€“cluster-backup-å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶"><a href="#12ã€â€“cluster-backup-å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶" class="headerlink" title="12ã€â€“cluster backupÂ  Â  Â  Â  Â å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶"></a>12ã€â€“cluster backupÂ  Â  Â  Â  Â å¤‡ä»½é›†ç¾¤<a href="https://so.csdn.net/so/search?q=rdb&spm=1001.2101.3001.7020">rdb</a>æ–‡ä»¶</h2><p>backup Â  Â  Â  Â  host:port backup_directoryÂ  Â Â </p><p>å¤‡ä»½ä¸»èŠ‚ç‚¹ä¸Šçš„æ•°æ®å€¼RDBæ–‡ä»¶</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">[root@localhost bin]# mkdir backup[root@localhost bin]# ./redis-cli --cluster backup <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span>  ./backup&gt;&gt;&gt; Performing Cluster Check (using node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span>)M: <span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41ea <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span>   slots:[<span class="hljs-number">0</span>-<span class="hljs-number">5460</span>] (<span class="hljs-number">5461</span> slots) master   <span class="hljs-number">1</span> additional replica(s)S: <span class="hljs-number">8</span>ae862c1815ff89e49d6c8801ea0cb074e82855c <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7006</span>   slots: (<span class="hljs-number">0</span> slots) slave   replicates <span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad292637873S: f6df82f6c67fbe83049d6f95a8473221afee2ee<span class="hljs-number">6 192.168.84</span>.<span class="hljs-number">1</span>:<span class="hljs-number">7004</span>   slots: (<span class="hljs-number">0</span> slots) slave   replicates <span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41eaM: <span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span> <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7003</span>   slots:[<span class="hljs-number">10923-16383</span>] (<span class="hljs-number">5461</span> slots) master   <span class="hljs-number">1</span> additional replica(s)S: <span class="hljs-number">4</span>cdc4c8127dc5ea8d15a239fa6c2f3c09b0d5f3a <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7005</span>   slots: (<span class="hljs-number">0</span> slots) slave   replicates <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43feM: <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7002</span>   slots:[<span class="hljs-number">5461-10922</span>] (<span class="hljs-number">5462</span> slots) master   <span class="hljs-number">1</span> additional replica(s)[OK] All nodes agree about slots configuration.&gt;&gt;&gt; Check for open slots...&gt;&gt;&gt; Check slots coverage...[OK] All <span class="hljs-number">16384</span> slots covered.&gt;&gt;&gt; Node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span> -&gt; Saving RDB...SYNC sent to master, writing <span class="hljs-number">232</span> bytes to &#x27;./backup/redis-node-<span class="hljs-number">192.168.84.1</span>-<span class="hljs-number">7001</span>-<span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41ea.rdb&#x27;Transfer finished with success.&gt;&gt;&gt; Node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7003</span> -&gt; Saving RDB...SYNC sent to master, writing <span class="hljs-number">226</span> bytes to &#x27;./backup/redis-node-<span class="hljs-number">192.168.84.1</span>-<span class="hljs-number">7003</span>-<span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span>.rdb&#x27;Transfer finished with success.&gt;&gt;&gt; Node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7002</span> -&gt; Saving RDB...SYNC sent to master, writing <span class="hljs-number">206</span> bytes to &#x27;./backup/redis-node-<span class="hljs-number">192.168.84.1</span>-<span class="hljs-number">7002</span>-<span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe.rdb&#x27;Transfer finished with success.Saving cluster configuration to: ./backup/nodes.json[OK] Backup created into: ./backup<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/47dcb320ce3a8ca6ab958daf758a3194.png"></p><p>nodes.jsonä¿å­˜çš„æ˜¯é›†ç¾¤ç»“æ„ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">[root@localhost bin]# cat nodes.json [  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;30c69d9e408015082c1a2145875cd1ec0c7a41ea&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7001</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: null,    <span class="hljs-string">&quot;slots&quot;</span>: <span class="hljs-string">[[0,5460]]</span>,    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">5461</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">1</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;8ae862c1815ff89e49d6c8801ea0cb074e82855c&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7006</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: <span class="hljs-string">&quot;222df2165b7b9dba291cfa572d472ad292637873&quot;</span>,    <span class="hljs-string">&quot;slots&quot;</span>: [],    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;slave&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">3</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;f6df82f6c67fbe83049d6f95a8473221afee2ee6&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7004</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: <span class="hljs-string">&quot;30c69d9e408015082c1a2145875cd1ec0c7a41ea&quot;</span>,    <span class="hljs-string">&quot;slots&quot;</span>: [],    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;slave&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">1</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;222df2165b7b9dba291cfa572d472ad292637873&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7003</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: null,    <span class="hljs-string">&quot;slots&quot;</span>: <span class="hljs-string">[[10923,16383]]</span>,    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">5461</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">3</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;4cdc4c8127dc5ea8d15a239fa6c2f3c09b0d5f3a&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7005</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: <span class="hljs-string">&quot;10a4381d9869e293cad95bf75482f506de9f43fe&quot;</span>,    <span class="hljs-string">&quot;slots&quot;</span>: [],    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;slave&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">2</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;10a4381d9869e293cad95bf75482f506de9f43fe&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7002</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: null,    <span class="hljs-string">&quot;slots&quot;</span>: <span class="hljs-string">[[5461,10922]]</span>,    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">5462</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">2</span>  &#125;]<br></code></pre></td></tr></table></figure><p>Â  Â </p><p>æ˜¾ç¤ºæ¨èå†…å®¹# redisé›†ç¾¤çš„ç»´æŠ¤ï¼ˆredis-cli â€“cluster å‘½ä»¤ç”¨æ³•ï¼‰</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/original.png"></p><p><a href="https://blog.csdn.net/cj_eryue" title="cj_eryue">cj_eryue</a> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newUpTime2.png"> å·²äºÂ 2024-06-11 10:54:16Â ä¿®æ”¹</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/articleReadEyes2.png"> é˜…è¯»é‡7.1k <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollect2.png"> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollectionActive2.png"> æ”¶è— 19</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newHeart2023Active.png"> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newHeart2023Black.png"> ç‚¹èµæ•° 6</p><p>åˆ†ç±»ä¸“æ ï¼š <a href="https://blog.csdn.net/cj_eryue/category_7806826.html">redis</a> æ–‡ç« æ ‡ç­¾ï¼š <a href="https://so.csdn.net/so/search/s.do?q=redis&t=all&o=vip&s=&l=&f=&viparticle=&from_tracking_code=tag_word&from_code=app_blog_art">redis</a></p><p>äºÂ 2023-09-12 10:51:33Â é¦–æ¬¡å‘å¸ƒ</p><p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œéµå¾ª <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC 4.0 BY-SA</a> ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥å’Œæœ¬å£°æ˜ã€‚</p><p>æœ¬æ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/cj_eryue/article/details/132811758">https://blog.csdn.net/cj_eryue&#x2F;article&#x2F;details&#x2F;132811758</a></p><p>ç‰ˆæƒ</p><p> <a href="javascript:;" title="å¼€æ”¾åŸå­å¼€å‘è€…å·¥ä½œåŠ"><img src="https://devpress.csdnimg.cn/79de2bf0b7994defa4242ef90d5513fa.jpg"> å¼€æ”¾åŸå­å¼€å‘è€…å·¥ä½œåŠ æ–‡ç« å·²è¢«ç¤¾åŒºæ”¶å½•</a></p><p>åŠ å…¥ç¤¾åŒº</p><p> <a href="https://blog.csdn.net/cj_eryue/category_7806826.html" title="redis"><img src="https://i-blog.csdnimg.cn/columns/default/20201014180756913.png?x-oss-process=image/resize,m_fixed,h_224,w_224"> redis ä¸“æ æ”¶å½•è¯¥å†…å®¹</a></p><p>12 ç¯‡æ–‡ç«  2 è®¢é˜…</p><p>è®¢é˜…ä¸“æ </p><p><strong>ç›®å½•</strong></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t0">å‰è¨€</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t1">1ã€ â€“cluster createÂ  åˆ›å»ºé›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t2">2ã€â€“cluster checkÂ Â æ£€æŸ¥é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t3">3ã€â€“cluster info æŸ¥çœ‹é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t4">4ã€â€“cluster fixÂ  ä¿®å¤é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t5">5ã€â€“cluster rehard è¿ç§»æ§½ä½</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t6">6ã€ â€“cluster rebalance å¹³è¡¡é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t7">7ã€ â€“clusterÂ Â add-nodeÂ  Â  é›†ç¾¤æ‰©å®¹</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t8">8ã€â€“cluster del-nodeÂ  Â  Â  é›†ç¾¤ç¼©å®¹</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t9">9ã€ â€“cluster callÂ  åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t10">10ã€â€“cluster set-timeoutÂ  Â  Â æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t11">11ã€â€“cluster importÂ  Â  Â  Â  Â  å¯¼å…¥æ•°æ®è‡³é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t12">12ã€â€“cluster backupÂ  Â  Â  Â  Â å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶</a></p><hr><h2 id="å‰è¨€-1"><a href="#å‰è¨€-1" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>redis-trib.rb</code>æ˜¯å®˜æ–¹æä¾›çš„Redis Clusterçš„ç®¡ç†å·¥å…·ï¼Œå®ƒæä¾›äº†é›†ç¾¤åˆ›å»ºã€æ£€æŸ¥ã€ä¿®å¤ã€å‡è¡¡ç­‰å‘½ä»¤è¡Œå·¥å…·ã€‚Redis Cluster åœ¨5.0ä¹‹åå–æ¶ˆäº†rubyè„šæœ¬çš„æ”¯æŒï¼Œè€Œæ˜¯ç›´æ¥é›†åˆåˆ°redis-clié‡Œï¼Œé¿å…äº†å†å®‰è£…rubyçš„ç›¸å…³ç¯å¢ƒã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">[root@localhost bin]# ./redis-cli --cluster helpCluster Manager Commands:  create         host1:port1 ... hostN:portN                 --cluster-replicas <span class="hljs-symbol">&lt;arg&gt;</span>  check          hos<span class="hljs-variable">t:port</span>                 --cluster-<span class="hljs-built_in">search</span>-multiple-owners  info           hos<span class="hljs-variable">t:port</span>  <span class="hljs-keyword">fix</span>            hos<span class="hljs-variable">t:port</span>                 --cluster-<span class="hljs-built_in">search</span>-multiple-owners                 --cluster-<span class="hljs-keyword">fix</span>-with-unreachable-masters  reshard        hos<span class="hljs-variable">t:port</span>                 --cluster-from <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-<span class="hljs-keyword">to</span> <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-slots <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-yes                 --cluster-timeout <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-pipeline <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-replace  rebalance      hos<span class="hljs-variable">t:port</span>                 --cluster-weight &lt;node1=w1...nodeN=<span class="hljs-keyword">wN</span>&gt;                 --cluster-use-<span class="hljs-built_in">empty</span>-masters                 --cluster-timeout <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-simulate                 --cluster-pipeline <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-threshold <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-replace  <span class="hljs-built_in">add</span>-node       new_hos<span class="hljs-variable">t:new_port</span> existing_hos<span class="hljs-variable">t:existing_port</span>                 --cluster-slave                 --cluster-master-id <span class="hljs-symbol">&lt;arg&gt;</span>  del-node       hos<span class="hljs-variable">t:port</span> node_id  <span class="hljs-keyword">call</span>           hos<span class="hljs-variable">t:port</span> <span class="hljs-keyword">command</span> arg arg .. arg                 --cluster-<span class="hljs-keyword">only</span>-masters                 --cluster-<span class="hljs-keyword">only</span>-replicas  <span class="hljs-keyword">set</span>-timeout    hos<span class="hljs-variable">t:port</span> milliseconds  import         hos<span class="hljs-variable">t:port</span>                 --cluster-from <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-from-user <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-from-pass <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-from-askpass                 --cluster-<span class="hljs-keyword">copy</span>                 --cluster-replace  backup         hos<span class="hljs-variable">t:port</span> backup_directory  <span class="hljs-keyword">help</span>            For check, <span class="hljs-keyword">fix</span>, reshard, del-node, <span class="hljs-keyword">set</span>-timeout you can specify the host <span class="hljs-built_in">and</span> port of any working node in the cluster. Cluster Manager Options:  --cluster-yes  Automatic yes <span class="hljs-keyword">to</span> cluster commands prompts <br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†çš„è¯´ä¸‹å„å‘½ä»¤çš„ç”¨æ³•å’Œä½œç”¨ï¼š</p><h2 id="1ã€-â€“cluster-create-åˆ›å»ºé›†ç¾¤-1"><a href="#1ã€-â€“cluster-create-åˆ›å»ºé›†ç¾¤-1" class="headerlink" title="1ã€ â€“cluster createÂ  åˆ›å»ºé›†ç¾¤"></a><strong>1ã€ â€“cluster create</strong>Â  åˆ›å»º<strong>é›†ç¾¤</strong></h2><p>create Â  Â  Â  Â  host1:port1 â€¦ hostN:portN<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replicas <arg></p><p>è¯¥å‘½ä»¤ç”¨æ¥åˆ›å»ºé›†ç¾¤ï¼Œå‡è®¾æˆ‘ç°åœ¨æƒ³æ­å»ºä¸‰ä¸»ä¸‰ä»çš„é›†ç¾¤127.0.0.1:7001~7006</p><p>å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹åï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ­å»ºï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">redis-cli --cluster create <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7001 127.0</span>.<span class="hljs-number">0.1:7002</span>Â <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7003Â 127.0</span>.<span class="hljs-number">0.1:7004</span>Â <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7005Â 127.0</span>.<span class="hljs-number">0.1:7006</span>Â --cluster-replicas <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>--cluster-replicas 1 :è¡¨ç¤ºæ¯ä¸ªä¸»èŠ‚ç‚¹éœ€è¦1ä¸ªä»èŠ‚ç‚¹ã€‚è¿™é‡Œéšæœºåˆ†é…ä¸»ä»å…³ç³»ï¼Œå¦‚æœéœ€è¦å®šåˆ¶ï¼Œåˆ™å¯ä»¥ä¸åŠ è¯¥å‚æ•°ï¼Œä½¿ç”¨add-nodeæ¥å®šåˆ¶,æŸ¥çœ‹ç¬¬7èŠ‚</p><h2 id="2ã€â€“cluster-check-æ£€æŸ¥é›†ç¾¤-1"><a href="#2ã€â€“cluster-check-æ£€æŸ¥é›†ç¾¤-1" class="headerlink" title="2ã€â€“cluster checkÂ Â æ£€æŸ¥é›†ç¾¤"></a><strong>2ã€â€“cluster checkÂ Â æ£€æŸ¥é›†ç¾¤</strong></h2><p>check Â  Â  Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-search-multiple-ownersÂ #æ£€æŸ¥æ˜¯å¦æœ‰æ§½åŒæ—¶è¢«åˆ†é…ç»™äº†å¤šä¸ªèŠ‚ç‚¹</p><p>è¯¥å‘½ä»¤ç»å¸¸ä½¿ç”¨ï¼Œéœ€è¦æ‹¥æœ‰æ§½ä½çš„æ‰€æœ‰èŠ‚ç‚¹ä¸ºå¯åŠ¨çŠ¶æ€ï¼Œç”¨äºæ£€æŸ¥é›†ç¾¤çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œåªæœ‰å½“æ‰€æœ‰çš„æ§½ä½æ­£å¸¸æ—¶ï¼Œé›†ç¾¤çŠ¶æ€æ‰OK</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/f1b7cd4b9fc1eb68c1e9383ac8005d40.png"></p><h2 id="3ã€â€“cluster-info-æŸ¥çœ‹é›†ç¾¤-1"><a href="#3ã€â€“cluster-info-æŸ¥çœ‹é›†ç¾¤-1" class="headerlink" title="3ã€â€“cluster info æŸ¥çœ‹é›†ç¾¤"></a><strong>3ã€â€“cluster info æŸ¥çœ‹é›†ç¾¤</strong></h2><p>ç”¨äºæŸ¥çœ‹é›†ç¾¤çš„ç®€æ˜“ä¿¡æ¯</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/d3968b7dce8b99f3fc589b2eba9104df.png"></p><h2 id="4ã€â€“cluster-fix-ä¿®å¤é›†ç¾¤-1"><a href="#4ã€â€“cluster-fix-ä¿®å¤é›†ç¾¤-1" class="headerlink" title="4ã€â€“cluster fixÂ  ä¿®å¤é›†ç¾¤"></a><strong>4ã€â€“cluster fixÂ  ä¿®å¤é›†ç¾¤</strong></h2><p>fix Â  Â  Â  Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-search-multiple-ownersÂ  Â Â <br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-fix-with-unreachable-mastersÂ Â </p><p>è¯¥å‘½ä»¤ååˆ†æœ‰ç”¨ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š</p><p>Â â€“cluster-search-multiple-owners ï¼š æ˜¯å¦ä¿®å¤å¤šä¸ªæ‹¥æœ‰è€…çš„æ§½ä½ã€‚å½“é›†ç¾¤ä¸­çš„æ§½ä½åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå‡ºç°æ„å¤–æ—¶ï¼Œä½¿ç”¨fixå¯ä½¿ç”¨è¯¥å‚æ•°ã€‚fixåŠŸèƒ½ï¼Œrediså†…éƒ¨åœ¨æ§½ä½çš„æŸäº›å¼‚å¸¸æƒ…å†µä¸‹ä¼šäº¤äº’å¼çš„è¯¢é—®æ“ä½œè€…æ˜¯å¦åŒæ„å®ƒçš„ä¿®å¤ç­–ç•¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé»˜è®¤å³å¯ã€‚</p><p>Â â€“cluster-fix-with-unreachable-masters ï¼š æ˜¯å¦ä¿®å¤ä¸å¯è¾¾çš„ä¸»èŠ‚ç‚¹ä¸Šçš„æ§½ä½ã€‚ä¾‹å¦‚ï¼Œé›†ç¾¤ä¸­æŸä¸ªä¸»èŠ‚ç‚¹å°±æ˜¯åæ‰äº†ï¼Œä¹Ÿæ²¡æœ‰æ•…éšœè½¬ç§»æˆåŠŸã€‚æ­¤æ—¶å¦‚ä½•æ¢å¤è¯¥ä¸»èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æ§½ä½å‘¢ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨è¯¥å‚æ•°ï¼Œä¼šå°†å¤„äºè¯¥ä¸»èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æ§½ä½æ¢å¤åˆ°å­˜æ´»çš„ä¸»èŠ‚ç‚¹ä¸Šï¼ˆä¹‹å‰çš„æ•°æ®ä¼šä¸¢å¤±ï¼Œä»…ä»…æ˜¯æ¢å¤äº†æ§½ä½ï¼‰ã€‚</p><h2 id="5ã€â€“cluster-rehard-è¿ç§»æ§½ä½-1"><a href="#5ã€â€“cluster-rehard-è¿ç§»æ§½ä½-1" class="headerlink" title="5ã€â€“cluster rehard è¿ç§»æ§½ä½"></a><strong>5ã€â€“cluster rehard è¿ç§»æ§½ä½</strong></h2><p>reshard Â  Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from <arg>Â  Â #æ§½ä½æ¥æºçš„èŠ‚ç‚¹è¿è¡Œidï¼Œå¤šä¸ªç”¨,åˆ†å‰²ï¼Œallè¡¨ç¤ºå…¨éƒ¨èŠ‚ç‚¹<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-to <arg>Â  Â  Â  Â #ç›®æ ‡èŠ‚ç‚¹çš„è¿è¡Œidï¼Œåªå…ä¸€ä¸ª<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-slots <arg>Â  Â #è¿ç§»çš„æ§½ä½æ•°<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-yesÂ  Â  Â  Â  Â  Â  Â  Â #æ˜¯å¦é»˜è®¤åŒæ„é›†ç¾¤å†…éƒ¨çš„è¿ç§»è®¡åˆ’ï¼ˆé»˜è®¤åŒæ„å°±å¯ä»¥ï¼‰<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-timeout <arg>Â  Â #è¿ç§»å‘½ä»¤ï¼ˆmigrateï¼‰çš„è¶…æ—¶æ—¶é—´<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-pipeline <arg>Â  #è¿ç§»keyæ—¶ï¼Œä¸€æ¬¡å–å‡º çš„keyæ•°é‡ï¼Œé»˜è®¤10<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replaceÂ  Â  Â  Â  Â  Â #æ˜¯å¦ç›´æ¥replaceåˆ°ç›®æ ‡èŠ‚ç‚¹</p><p>è¿ç§»ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼ˆâ€“cluster-fromï¼‰èŠ‚ç‚¹ä¸Šçš„â€“cluster-slotsä¸ªæ§½ä½è‡³ä¸€ä¸ªç›®æ ‡èŠ‚ç‚¹ï¼ˆâ€“cluster-toï¼‰ä¸Šã€‚</p><p>Â â€“cluster-from çš„å€¼ä¸ä¸ºallçš„æƒ…å†µä¸‹ï¼ŒÂ â€“cluster-fromä¸èƒ½åŒ…å«â€“cluster-to</p><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ•´ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰è¿è¡Œid</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">[root@localhost bin]# ./redis-cli -h <span class="hljs-number">192.168.84.1</span> -p <span class="hljs-number">7001</span> cluster nodes8ae862c1815ff89e49d6c8801ea0cb074e82855c <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7006@17006</span> slave <span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span> <span class="hljs-number">0</span> <span class="hljs-number">1694427906290</span> <span class="hljs-number">3</span> connectedf6df82f6c67fbe83049d6f95a8473221afee2ee<span class="hljs-number">6 192.168.84</span>.<span class="hljs-number">1</span>:<span class="hljs-number">7004@17004</span> slave <span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41ea <span class="hljs-number">0</span> <span class="hljs-number">1694427905000</span> <span class="hljs-number">1</span> connected222df2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span> <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7003@17003</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1694427904000</span> <span class="hljs-number">3</span> connected <span class="hljs-number">10923</span>-<span class="hljs-number">163834</span>cdc4c8127dc5ea8d15a239fa6c2f3c09b0d5f3a <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7005@17005</span> slave <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-number">0</span> <span class="hljs-number">1694427905255</span> <span class="hljs-number">2</span> connected30c69d9e408015082c1a2145875cd1ec0c7a41ea <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001@17001</span> myself,master - <span class="hljs-number">0</span> <span class="hljs-number">1694427902000</span> <span class="hljs-number">1</span> connected <span class="hljs-number">0</span>-<span class="hljs-number">546010</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7002@17002</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1694427902000</span> <span class="hljs-number">2</span> connected <span class="hljs-number">5461-10922</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡é›†ç¾¤çš„é…ç½®æ–‡ä»¶æŸ¥çœ‹ä¹Ÿå¯ä»¥</p><h2 id="6ã€-â€“cluster-rebalance-å¹³è¡¡é›†ç¾¤-1"><a href="#6ã€-â€“cluster-rebalance-å¹³è¡¡é›†ç¾¤-1" class="headerlink" title="6ã€ â€“cluster rebalance å¹³è¡¡é›†ç¾¤"></a>6ã€ <strong>â€“cluster rebalance å¹³è¡¡é›†ç¾¤</strong></h2><p>rebalance Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-weight &lt;node1&#x3D;w1â€¦nodeN&#x3D;wN&gt;<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-use-empty-masters<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-timeout <arg>Â  Â  Â #è¿ç§»å‘½ä»¤ï¼ˆmigrateï¼‰çš„è¶…æ—¶æ—¶é—´<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-simulateÂ  Â  Â  Â  Â  Â  Â  #Â æ¨¡æ‹Ÿrebalanceæ“ä½œï¼Œä¸ä¼šçœŸæ­£æ‰§è¡Œè¿ç§»æ“ä½œ<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-pipeline <arg>Â  Â  #å®šä¹‰Â getkeysinslotå‘½ä»¤ä¸€æ¬¡å–å‡ºçš„keyæ•°é‡ï¼Œé»˜è®¤å€¼ä¸º10<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-threshold <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replaceÂ  Â  Â  Â  Â  Â  Â  Â #æ˜¯å¦ç›´æ¥replaceåˆ°ç›®æ ‡èŠ‚ç‚¹</p><p>--cluster-weightï¼š æ§½ä½æƒé‡ï¼ˆæµ®ç‚¹å‹ï¼‰æ¯”å€¼ï¼Œä¾‹å¦‚ï¼ˆè¿™é‡Œä½¿ç”¨ç«¯å£å·ä»£æ›¿è¿è¡Œidï¼‰ï¼š 7001&#x3D;1.0,7002&#x3D;1.0,7003&#x3D;2.0 åˆ™è¡¨ç¤ºï¼Œæ€»æƒé‡ä¸º4.0ï¼Œ 7001å’Œ7002å°†åˆ†é…åˆ° (16384&#x2F;4)*1Â  ä¸ªæ§½ä½ï¼Œ7003åˆ™æ˜¯(16384&#x2F;4)*2ä¸ªæ§½ä½ã€‚</p><p>Â â€“cluster-threshold: å¹³è¡¡è§¦å‘çš„é˜ˆå€¼æ¡ä»¶ï¼Œé»˜è®¤ä¸º2.00%ã€‚ä¾‹å¦‚ä¸Šä¸€æ­¥ï¼Œ7001å’Œ7002åº”è¯¥æœ‰4096ä¸ªæ§½ä½ï¼Œå¦‚æœ7001çš„æ§½ä½æ•°ä¸å¤Ÿ4096ä¸ªï¼Œä¸”è¶…è¿‡ (4096*0.02 çº¦ç­‰äº)82ä¸ªåŠä»¥ä¸Šï¼›æˆ–è€…7001çš„æ§½ä½æ•°æ¯”4096å°‘äº82ä¸ªåŠä»¥ä¸Šï¼Œåˆ™ä¼šè§¦å‘è‡ªå¹³è¡¡ã€‚</p><h2 id="7ã€-â€“cluster-add-node-é›†ç¾¤æ‰©å®¹-1"><a href="#7ã€-â€“cluster-add-node-é›†ç¾¤æ‰©å®¹-1" class="headerlink" title="7ã€ â€“clusterÂ Â add-nodeÂ  Â  é›†ç¾¤æ‰©å®¹"></a><strong>7ã€ â€“clusterÂ Â add-nodeÂ  Â  é›†ç¾¤æ‰©å®¹</strong></h2><p>add-node Â  Â new_host:new_portÂ  Â  Â  Â  Â  Â Â Â Â Â Â Â Â #æ–°åŠ å…¥é›†ç¾¤çš„ipå’Œport</p><p>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â existing_host:existing_portÂ  Â  Â  Â  Â  #é›†ç¾¤ä¸­ä»»ä¸€èŠ‚ç‚¹çš„ipå’Œport<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-slaveÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â #æ–°èŠ‚ç‚¹ä½œä¸ºä»èŠ‚ç‚¹ï¼Œé»˜è®¤éšæœºä¸€ä¸ªä¸»èŠ‚ç‚¹<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-master-id <arg>Â  Â  Â  Â  Â  Â  #ç»™æ–°èŠ‚ç‚¹æŒ‡å®šä¸»èŠ‚ç‚¹,å€¼ä¸ºèŠ‚ç‚¹çš„è¿è¡Œid</p><p>å¯ç”¨äºå‘é›†ç¾¤ä¸­æ·»åŠ ä¸»ã€ä»èŠ‚ç‚¹(å³æ‰©å®¹)</p><p>å‡è®¾æˆ‘ç°åœ¨é›†ç¾¤ä¸­æœ‰7001 7002 7003ä¸‰ä¸ªä¸»èŠ‚ç‚¹äº†ï¼Œæƒ³ä¸º7001æ·»åŠ ä¸€ä¸ªä»èŠ‚ç‚¹127.0.0.1:7006ï¼Œåˆ™å¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">redis-cli --cluster<span class="hljs-built_in"> add-node </span>127.0.0.1:7006 127.0.0.1:7001Â Â --cluster-slave --cluster-master-id 30c69d9e408015082c1a2145875cd1ec0c7a41ea<br></code></pre></td></tr></table></figure><p>Â ä¸ä¼ å…¥â€“cluster-slave â€“cluster-master-id å‚æ•°ï¼Œè¡¨ç¤ºæ·»åŠ ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚</p><p>å½“æ·»åŠ çš„æ˜¯ä¸€ä¸ªä¸»èŠ‚ç‚¹æ—¶ï¼Œæ­¤æ—¶ï¼Œè¯¥ä¸»èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•æ§½ä½ï¼Œå¯ä»¥ä½¿ç”¨rebalanceæˆ–è€…reshardæ¥è¿ç§»æ§½ä½ç»™å®ƒã€‚</p><h2 id="8ã€â€“cluster-del-node-é›†ç¾¤ç¼©å®¹-1"><a href="#8ã€â€“cluster-del-node-é›†ç¾¤ç¼©å®¹-1" class="headerlink" title="8ã€â€“cluster del-nodeÂ  Â  Â  é›†ç¾¤ç¼©å®¹"></a><strong>8ã€â€“cluster del-nodeÂ  Â  Â  é›†ç¾¤ç¼©å®¹</strong></h2><p>del-nodeÂ  Â  host:port node_idÂ  Â  Â  Â  Â #åˆ é™¤ç»™å®šçš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæˆåŠŸåå…³é—­è¯¥èŠ‚ç‚¹æœåŠ¡</p><p>ä¹Ÿå°±æ˜¯ç¼©å®¹ã€‚</p><p>åˆ é™¤ä¸€ä¸ªä¸»èŠ‚ç‚¹è¦æ±‚å…ˆè¿ç§»èµ°æ”¹ä¸»èŠ‚ç‚¹ä¸Šçš„æ§½ä½ï¼ˆæ•°æ®ï¼‰ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨reshardå‘½ä»¤äº†ã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[root@localhost bin]</span># ./redis-cli --cluster del-node <span class="hljs-number">192.168</span><span class="hljs-number">.84</span><span class="hljs-number">.1</span>:<span class="hljs-number">7002</span> <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe&gt;&gt;&gt; Removing node <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-keyword">from</span> cluster <span class="hljs-number">192.168</span><span class="hljs-number">.84</span><span class="hljs-number">.1</span>:<span class="hljs-number">7002</span>[ERR] Node <span class="hljs-number">192.168</span><span class="hljs-number">.84</span><span class="hljs-number">.1</span>:<span class="hljs-number">7002</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> empty! Reshard data away <span class="hljs-keyword">and</span> <span class="hljs-keyword">try</span> again.<br></code></pre></td></tr></table></figure><h2 id="9ã€-â€“cluster-call-åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤-1"><a href="#9ã€-â€“cluster-call-åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤-1" class="headerlink" title="9ã€ â€“cluster callÂ  åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤"></a><strong>9ã€ â€“cluster call</strong>Â  åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤</h2><p>call Â  Â  Â  Â  Â  host:port command arg arg .. argÂ  Â  Â  Â  Â  Â  Â  Â #åœ¨é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œç›¸å…³å‘½ä»¤<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-only-mastersÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  #æ˜¯å¦åªåœ¨ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-only-replicasÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â #æ˜¯å¦åªåœ¨ä»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/59db12799c1a7acd9c6fc267ccf790fc.png"></p><h2 id="10ã€â€“cluster-set-timeout-æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´-1"><a href="#10ã€â€“cluster-set-timeout-æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´-1" class="headerlink" title="10ã€â€“cluster set-timeoutÂ  Â  Â æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´"></a><strong>10ã€â€“cluster set-timeout</strong>Â  Â  Â æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´</h2><p>Â Â Â Â Â Â Â Â set-timeout Â  Â host:port milliseconds</p><p>è®¾ç½®æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´</p><h2 id="11ã€â€“cluster-import-å¯¼å…¥æ•°æ®è‡³é›†ç¾¤-1"><a href="#11ã€â€“cluster-import-å¯¼å…¥æ•°æ®è‡³é›†ç¾¤-1" class="headerlink" title="11ã€â€“cluster importÂ  Â  Â  Â  Â  å¯¼å…¥æ•°æ®è‡³é›†ç¾¤"></a><strong>11ã€â€“cluster import</strong>Â  Â  Â  Â  Â  å¯¼å…¥æ•°æ®è‡³é›†ç¾¤</h2><p>import Â  Â  Â  Â  host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from-user <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from-pass <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from-askpass<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-copyÂ  Â  Â Â Â Â Â Â Â Â Â Â Â #migrateæ—¶æŒ‡å®šç±»å‹ä¸ºcopy<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replaceÂ  Â Â Â Â Â Â Â Â Â #migrateæ—¶æŒ‡å®šç±»å‹ä¸ºreplace</p><p>å°†å¤–éƒ¨redisçš„æ•°æ®å¯¼å…¥é›†ç¾¤Â </p><p>redis-cli â€“cluster import 127.0.01:6379 â€“cluster-from 127.0.0.2:6379 â€“cluster-replace â€“cluster-copy</p><p>è¯´æ˜ï¼šå¤–éƒ¨Rediså®ä¾‹ï¼ˆ127.0.0.2:6379ï¼‰å¯¼å…¥åˆ°é›†ç¾¤ä¸­çš„ä»»æ„ä¸€èŠ‚ç‚¹ï¼Œå€’å…¥ä¹‹åï¼ŒåŸæ¥é›†ç¾¤çš„keyå˜ä¸ºç©ºï¼Œå¯¼å…¥åˆ°æ–°é›†ç¾¤çš„keyä¼šè‡ªåŠ¨åˆ†ç‰‡åˆ°å„ä¸ªmaterèŠ‚ç‚¹çš„slot</p><p>--cluster-replace å¦‚æœé›†ç¾¤ï¼ˆ127.0.01:6379ï¼‰ä¸­å­˜åœ¨å¤–éƒ¨rediså®ä¾‹ï¼ˆ127.0.0.2:6379ï¼‰çš„keyï¼Œåˆ™ä¼šè¦†ç›–æ‰ï¼ˆ10.35.2.68:6379ï¼‰çš„value</p><p>--cluster-copy é»˜è®¤æƒ…å†µä¸‹ï¼Œimport å‘½ä»¤åœ¨å‘é›†ç¾¤å¯¼å…¥æ•°æ®çš„åŒæ—¶ï¼Œè¿˜ä¼šåˆ é™¤å•æœºæœåŠ¡å™¨ä¸­æºæ•°æ®ã€‚å¦‚æœç”¨æˆ·æƒ³è¦ä¿ç•™å•æœºæœåŠ¡å™¨ä¸­çš„æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨æ‰§è¡Œå‘½ä»¤çš„åŒæ—¶ç»™å®š â€“cluster-copy é€‰é¡¹Â </p><p>è¯¥å‘½ä»¤å°†æ­£åœ¨è¿è¡Œçš„å®ä¾‹çš„æ‰€æœ‰é”®ï¼ˆä»æºå®ä¾‹ä¸­åˆ é™¤é”®ï¼‰ç§»åŠ¨åˆ°æŒ‡å®šçš„é¢„å…ˆå­˜åœ¨çš„ Redis é›†ç¾¤ã€‚</p><p>å®é™…é¡¹ç›®ä¸Šï¼Œæ•°æ®å¯¼å…¥åº”è¯¥ç”¨redis-shakeå·¥å…·çš„æ¯”è¾ƒå¤šã€‚</p><h2 id="12ã€â€“cluster-backup-å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶-1"><a href="#12ã€â€“cluster-backup-å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶-1" class="headerlink" title="12ã€â€“cluster backupÂ  Â  Â  Â  Â å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶"></a>12ã€â€“cluster backupÂ  Â  Â  Â  Â å¤‡ä»½é›†ç¾¤<a href="https://so.csdn.net/so/search?q=rdb&spm=1001.2101.3001.7020">rdb</a>æ–‡ä»¶</h2><p>backup Â  Â  Â  Â  host:port backup_directoryÂ  Â Â </p><p>å¤‡ä»½ä¸»èŠ‚ç‚¹ä¸Šçš„æ•°æ®å€¼RDBæ–‡ä»¶</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">[root@localhost bin]# mkdir backup[root@localhost bin]# ./redis-cli --cluster backup <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span>  ./backup&gt;&gt;&gt; Performing Cluster Check (using node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span>)M: <span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41ea <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span>   slots:[<span class="hljs-number">0</span>-<span class="hljs-number">5460</span>] (<span class="hljs-number">5461</span> slots) master   <span class="hljs-number">1</span> additional replica(s)S: <span class="hljs-number">8</span>ae862c1815ff89e49d6c8801ea0cb074e82855c <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7006</span>   slots: (<span class="hljs-number">0</span> slots) slave   replicates <span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad292637873S: f6df82f6c67fbe83049d6f95a8473221afee2ee<span class="hljs-number">6 192.168.84</span>.<span class="hljs-number">1</span>:<span class="hljs-number">7004</span>   slots: (<span class="hljs-number">0</span> slots) slave   replicates <span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41eaM: <span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span> <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7003</span>   slots:[<span class="hljs-number">10923-16383</span>] (<span class="hljs-number">5461</span> slots) master   <span class="hljs-number">1</span> additional replica(s)S: <span class="hljs-number">4</span>cdc4c8127dc5ea8d15a239fa6c2f3c09b0d5f3a <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7005</span>   slots: (<span class="hljs-number">0</span> slots) slave   replicates <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43feM: <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7002</span>   slots:[<span class="hljs-number">5461-10922</span>] (<span class="hljs-number">5462</span> slots) master   <span class="hljs-number">1</span> additional replica(s)[OK] All nodes agree about slots configuration.&gt;&gt;&gt; Check for open slots...&gt;&gt;&gt; Check slots coverage...[OK] All <span class="hljs-number">16384</span> slots covered.&gt;&gt;&gt; Node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span> -&gt; Saving RDB...SYNC sent to master, writing <span class="hljs-number">232</span> bytes to &#x27;./backup/redis-node-<span class="hljs-number">192.168.84.1</span>-<span class="hljs-number">7001</span>-<span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41ea.rdb&#x27;Transfer finished with success.&gt;&gt;&gt; Node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7003</span> -&gt; Saving RDB...SYNC sent to master, writing <span class="hljs-number">226</span> bytes to &#x27;./backup/redis-node-<span class="hljs-number">192.168.84.1</span>-<span class="hljs-number">7003</span>-<span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span>.rdb&#x27;Transfer finished with success.&gt;&gt;&gt; Node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7002</span> -&gt; Saving RDB...SYNC sent to master, writing <span class="hljs-number">206</span> bytes to &#x27;./backup/redis-node-<span class="hljs-number">192.168.84.1</span>-<span class="hljs-number">7002</span>-<span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe.rdb&#x27;Transfer finished with success.Saving cluster configuration to: ./backup/nodes.json[OK] Backup created into: ./backup<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/47dcb320ce3a8ca6ab958daf758a3194.png"></p><p>nodes.jsonä¿å­˜çš„æ˜¯é›†ç¾¤ç»“æ„ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">[root@localhost bin]# cat nodes.json [  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;30c69d9e408015082c1a2145875cd1ec0c7a41ea&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7001</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: null,    <span class="hljs-string">&quot;slots&quot;</span>: <span class="hljs-string">[[0,5460]]</span>,    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">5461</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">1</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;8ae862c1815ff89e49d6c8801ea0cb074e82855c&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7006</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: <span class="hljs-string">&quot;222df2165b7b9dba291cfa572d472ad292637873&quot;</span>,    <span class="hljs-string">&quot;slots&quot;</span>: [],    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;slave&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">3</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;f6df82f6c67fbe83049d6f95a8473221afee2ee6&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7004</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: <span class="hljs-string">&quot;30c69d9e408015082c1a2145875cd1ec0c7a41ea&quot;</span>,    <span class="hljs-string">&quot;slots&quot;</span>: [],    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;slave&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">1</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;222df2165b7b9dba291cfa572d472ad292637873&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7003</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: null,    <span class="hljs-string">&quot;slots&quot;</span>: <span class="hljs-string">[[10923,16383]]</span>,    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">5461</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">3</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;4cdc4c8127dc5ea8d15a239fa6c2f3c09b0d5f3a&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7005</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: <span class="hljs-string">&quot;10a4381d9869e293cad95bf75482f506de9f43fe&quot;</span>,    <span class="hljs-string">&quot;slots&quot;</span>: [],    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;slave&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">2</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;10a4381d9869e293cad95bf75482f506de9f43fe&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7002</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: null,    <span class="hljs-string">&quot;slots&quot;</span>: <span class="hljs-string">[[5461,10922]]</span>,    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">5462</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">2</span>  &#125;]<br></code></pre></td></tr></table></figure><p>Â  Â </p><p>æ˜¾ç¤ºæ¨èå†…å®¹# redisé›†ç¾¤çš„ç»´æŠ¤ï¼ˆredis-cli â€“cluster å‘½ä»¤ç”¨æ³•ï¼‰</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/original.png"></p><p><a href="https://blog.csdn.net/cj_eryue" title="cj_eryue">cj_eryue</a> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newUpTime2.png"> å·²äºÂ 2024-06-11 10:54:16Â ä¿®æ”¹</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/articleReadEyes2.png"> é˜…è¯»é‡7.1k <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollect2.png"> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollectionActive2.png"> æ”¶è— 19</p><p><img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newHeart2023Active.png"> <img src="https://csdnimg.cn/release/blogv2/dist/pc/img/newHeart2023Black.png"> ç‚¹èµæ•° 6</p><p>åˆ†ç±»ä¸“æ ï¼š <a href="https://blog.csdn.net/cj_eryue/category_7806826.html">redis</a> æ–‡ç« æ ‡ç­¾ï¼š <a href="https://so.csdn.net/so/search/s.do?q=redis&t=all&o=vip&s=&l=&f=&viparticle=&from_tracking_code=tag_word&from_code=app_blog_art">redis</a></p><p>äºÂ 2023-09-12 10:51:33Â é¦–æ¬¡å‘å¸ƒ</p><p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œéµå¾ª <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC 4.0 BY-SA</a> ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥å’Œæœ¬å£°æ˜ã€‚</p><p>æœ¬æ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/cj_eryue/article/details/132811758">https://blog.csdn.net/cj_eryue&#x2F;article&#x2F;details&#x2F;132811758</a></p><p>ç‰ˆæƒ</p><p> <a href="javascript:;" title="å¼€æ”¾åŸå­å¼€å‘è€…å·¥ä½œåŠ"><img src="https://devpress.csdnimg.cn/79de2bf0b7994defa4242ef90d5513fa.jpg"> å¼€æ”¾åŸå­å¼€å‘è€…å·¥ä½œåŠ æ–‡ç« å·²è¢«ç¤¾åŒºæ”¶å½•</a></p><p>åŠ å…¥ç¤¾åŒº</p><p> <a href="https://blog.csdn.net/cj_eryue/category_7806826.html" title="redis"><img src="https://i-blog.csdnimg.cn/columns/default/20201014180756913.png?x-oss-process=image/resize,m_fixed,h_224,w_224"> redis ä¸“æ æ”¶å½•è¯¥å†…å®¹</a></p><p>12 ç¯‡æ–‡ç«  2 è®¢é˜…</p><p>è®¢é˜…ä¸“æ </p><p><strong>ç›®å½•</strong></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t0">å‰è¨€</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t1">1ã€ â€“cluster createÂ  åˆ›å»ºé›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t2">2ã€â€“cluster checkÂ Â æ£€æŸ¥é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t3">3ã€â€“cluster info æŸ¥çœ‹é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t4">4ã€â€“cluster fixÂ  ä¿®å¤é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t5">5ã€â€“cluster rehard è¿ç§»æ§½ä½</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t6">6ã€ â€“cluster rebalance å¹³è¡¡é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t7">7ã€ â€“clusterÂ Â add-nodeÂ  Â  é›†ç¾¤æ‰©å®¹</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t8">8ã€â€“cluster del-nodeÂ  Â  Â  é›†ç¾¤ç¼©å®¹</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t9">9ã€ â€“cluster callÂ  åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t10">10ã€â€“cluster set-timeoutÂ  Â  Â æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t11">11ã€â€“cluster importÂ  Â  Â  Â  Â  å¯¼å…¥æ•°æ®è‡³é›†ç¾¤</a></p><p><a href="https://blog.csdn.net/cj_eryue/article/details/132811758#t12">12ã€â€“cluster backupÂ  Â  Â  Â  Â å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶</a></p><hr><h2 id="å‰è¨€-2"><a href="#å‰è¨€-2" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>redis-trib.rb</code>æ˜¯å®˜æ–¹æä¾›çš„Redis Clusterçš„ç®¡ç†å·¥å…·ï¼Œå®ƒæä¾›äº†é›†ç¾¤åˆ›å»ºã€æ£€æŸ¥ã€ä¿®å¤ã€å‡è¡¡ç­‰å‘½ä»¤è¡Œå·¥å…·ã€‚Redis Cluster åœ¨5.0ä¹‹åå–æ¶ˆäº†rubyè„šæœ¬çš„æ”¯æŒï¼Œè€Œæ˜¯ç›´æ¥é›†åˆåˆ°redis-clié‡Œï¼Œé¿å…äº†å†å®‰è£…rubyçš„ç›¸å…³ç¯å¢ƒã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">[root@localhost bin]# ./redis-cli --cluster helpCluster Manager Commands:  create         host1:port1 ... hostN:portN                 --cluster-replicas <span class="hljs-symbol">&lt;arg&gt;</span>  check          hos<span class="hljs-variable">t:port</span>                 --cluster-<span class="hljs-built_in">search</span>-multiple-owners  info           hos<span class="hljs-variable">t:port</span>  <span class="hljs-keyword">fix</span>            hos<span class="hljs-variable">t:port</span>                 --cluster-<span class="hljs-built_in">search</span>-multiple-owners                 --cluster-<span class="hljs-keyword">fix</span>-with-unreachable-masters  reshard        hos<span class="hljs-variable">t:port</span>                 --cluster-from <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-<span class="hljs-keyword">to</span> <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-slots <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-yes                 --cluster-timeout <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-pipeline <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-replace  rebalance      hos<span class="hljs-variable">t:port</span>                 --cluster-weight &lt;node1=w1...nodeN=<span class="hljs-keyword">wN</span>&gt;                 --cluster-use-<span class="hljs-built_in">empty</span>-masters                 --cluster-timeout <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-simulate                 --cluster-pipeline <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-threshold <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-replace  <span class="hljs-built_in">add</span>-node       new_hos<span class="hljs-variable">t:new_port</span> existing_hos<span class="hljs-variable">t:existing_port</span>                 --cluster-slave                 --cluster-master-id <span class="hljs-symbol">&lt;arg&gt;</span>  del-node       hos<span class="hljs-variable">t:port</span> node_id  <span class="hljs-keyword">call</span>           hos<span class="hljs-variable">t:port</span> <span class="hljs-keyword">command</span> arg arg .. arg                 --cluster-<span class="hljs-keyword">only</span>-masters                 --cluster-<span class="hljs-keyword">only</span>-replicas  <span class="hljs-keyword">set</span>-timeout    hos<span class="hljs-variable">t:port</span> milliseconds  import         hos<span class="hljs-variable">t:port</span>                 --cluster-from <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-from-user <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-from-pass <span class="hljs-symbol">&lt;arg&gt;</span>                 --cluster-from-askpass                 --cluster-<span class="hljs-keyword">copy</span>                 --cluster-replace  backup         hos<span class="hljs-variable">t:port</span> backup_directory  <span class="hljs-keyword">help</span>            For check, <span class="hljs-keyword">fix</span>, reshard, del-node, <span class="hljs-keyword">set</span>-timeout you can specify the host <span class="hljs-built_in">and</span> port of any working node in the cluster. Cluster Manager Options:  --cluster-yes  Automatic yes <span class="hljs-keyword">to</span> cluster commands prompts <br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†çš„è¯´ä¸‹å„å‘½ä»¤çš„ç”¨æ³•å’Œä½œç”¨ï¼š</p><h2 id="1ã€-â€“cluster-create-åˆ›å»ºé›†ç¾¤-2"><a href="#1ã€-â€“cluster-create-åˆ›å»ºé›†ç¾¤-2" class="headerlink" title="1ã€ â€“cluster createÂ  åˆ›å»ºé›†ç¾¤"></a><strong>1ã€ â€“cluster create</strong>Â  åˆ›å»º<strong>é›†ç¾¤</strong></h2><p>create Â  Â  Â  Â  host1:port1 â€¦ hostN:portN<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replicas <arg></p><p>è¯¥å‘½ä»¤ç”¨æ¥åˆ›å»ºé›†ç¾¤ï¼Œå‡è®¾æˆ‘ç°åœ¨æƒ³æ­å»ºä¸‰ä¸»ä¸‰ä»çš„é›†ç¾¤127.0.0.1:7001~7006</p><p>å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹åï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ­å»ºï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">redis-cli --cluster create <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7001 127.0</span>.<span class="hljs-number">0.1:7002</span>Â <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7003Â 127.0</span>.<span class="hljs-number">0.1:7004</span>Â <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7005Â 127.0</span>.<span class="hljs-number">0.1:7006</span>Â --cluster-replicas <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>--cluster-replicas 1 :è¡¨ç¤ºæ¯ä¸ªä¸»èŠ‚ç‚¹éœ€è¦1ä¸ªä»èŠ‚ç‚¹ã€‚è¿™é‡Œéšæœºåˆ†é…ä¸»ä»å…³ç³»ï¼Œå¦‚æœéœ€è¦å®šåˆ¶ï¼Œåˆ™å¯ä»¥ä¸åŠ è¯¥å‚æ•°ï¼Œä½¿ç”¨add-nodeæ¥å®šåˆ¶,æŸ¥çœ‹ç¬¬7èŠ‚</p><h2 id="2ã€â€“cluster-check-æ£€æŸ¥é›†ç¾¤-2"><a href="#2ã€â€“cluster-check-æ£€æŸ¥é›†ç¾¤-2" class="headerlink" title="2ã€â€“cluster checkÂ Â æ£€æŸ¥é›†ç¾¤"></a><strong>2ã€â€“cluster checkÂ Â æ£€æŸ¥é›†ç¾¤</strong></h2><p>check Â  Â  Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-search-multiple-ownersÂ #æ£€æŸ¥æ˜¯å¦æœ‰æ§½åŒæ—¶è¢«åˆ†é…ç»™äº†å¤šä¸ªèŠ‚ç‚¹</p><p>è¯¥å‘½ä»¤ç»å¸¸ä½¿ç”¨ï¼Œéœ€è¦æ‹¥æœ‰æ§½ä½çš„æ‰€æœ‰èŠ‚ç‚¹ä¸ºå¯åŠ¨çŠ¶æ€ï¼Œç”¨äºæ£€æŸ¥é›†ç¾¤çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œåªæœ‰å½“æ‰€æœ‰çš„æ§½ä½æ­£å¸¸æ—¶ï¼Œé›†ç¾¤çŠ¶æ€æ‰OK</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/f1b7cd4b9fc1eb68c1e9383ac8005d40.png"></p><h2 id="3ã€â€“cluster-info-æŸ¥çœ‹é›†ç¾¤-2"><a href="#3ã€â€“cluster-info-æŸ¥çœ‹é›†ç¾¤-2" class="headerlink" title="3ã€â€“cluster info æŸ¥çœ‹é›†ç¾¤"></a><strong>3ã€â€“cluster info æŸ¥çœ‹é›†ç¾¤</strong></h2><p>ç”¨äºæŸ¥çœ‹é›†ç¾¤çš„ç®€æ˜“ä¿¡æ¯</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/d3968b7dce8b99f3fc589b2eba9104df.png"></p><h2 id="4ã€â€“cluster-fix-ä¿®å¤é›†ç¾¤-2"><a href="#4ã€â€“cluster-fix-ä¿®å¤é›†ç¾¤-2" class="headerlink" title="4ã€â€“cluster fixÂ  ä¿®å¤é›†ç¾¤"></a><strong>4ã€â€“cluster fixÂ  ä¿®å¤é›†ç¾¤</strong></h2><p>fix Â  Â  Â  Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-search-multiple-ownersÂ  Â Â <br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-fix-with-unreachable-mastersÂ Â </p><p>è¯¥å‘½ä»¤ååˆ†æœ‰ç”¨ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š</p><p>Â â€“cluster-search-multiple-owners ï¼š æ˜¯å¦ä¿®å¤å¤šä¸ªæ‹¥æœ‰è€…çš„æ§½ä½ã€‚å½“é›†ç¾¤ä¸­çš„æ§½ä½åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå‡ºç°æ„å¤–æ—¶ï¼Œä½¿ç”¨fixå¯ä½¿ç”¨è¯¥å‚æ•°ã€‚fixåŠŸèƒ½ï¼Œrediså†…éƒ¨åœ¨æ§½ä½çš„æŸäº›å¼‚å¸¸æƒ…å†µä¸‹ä¼šäº¤äº’å¼çš„è¯¢é—®æ“ä½œè€…æ˜¯å¦åŒæ„å®ƒçš„ä¿®å¤ç­–ç•¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé»˜è®¤å³å¯ã€‚</p><p>Â â€“cluster-fix-with-unreachable-masters ï¼š æ˜¯å¦ä¿®å¤ä¸å¯è¾¾çš„ä¸»èŠ‚ç‚¹ä¸Šçš„æ§½ä½ã€‚ä¾‹å¦‚ï¼Œé›†ç¾¤ä¸­æŸä¸ªä¸»èŠ‚ç‚¹å°±æ˜¯åæ‰äº†ï¼Œä¹Ÿæ²¡æœ‰æ•…éšœè½¬ç§»æˆåŠŸã€‚æ­¤æ—¶å¦‚ä½•æ¢å¤è¯¥ä¸»èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æ§½ä½å‘¢ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨è¯¥å‚æ•°ï¼Œä¼šå°†å¤„äºè¯¥ä¸»èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æ§½ä½æ¢å¤åˆ°å­˜æ´»çš„ä¸»èŠ‚ç‚¹ä¸Šï¼ˆä¹‹å‰çš„æ•°æ®ä¼šä¸¢å¤±ï¼Œä»…ä»…æ˜¯æ¢å¤äº†æ§½ä½ï¼‰ã€‚</p><h2 id="5ã€â€“cluster-rehard-è¿ç§»æ§½ä½-2"><a href="#5ã€â€“cluster-rehard-è¿ç§»æ§½ä½-2" class="headerlink" title="5ã€â€“cluster rehard è¿ç§»æ§½ä½"></a><strong>5ã€â€“cluster rehard è¿ç§»æ§½ä½</strong></h2><p>reshard Â  Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from <arg>Â  Â #æ§½ä½æ¥æºçš„èŠ‚ç‚¹è¿è¡Œidï¼Œå¤šä¸ªç”¨,åˆ†å‰²ï¼Œallè¡¨ç¤ºå…¨éƒ¨èŠ‚ç‚¹<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-to <arg>Â  Â  Â  Â #ç›®æ ‡èŠ‚ç‚¹çš„è¿è¡Œidï¼Œåªå…ä¸€ä¸ª<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-slots <arg>Â  Â #è¿ç§»çš„æ§½ä½æ•°<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-yesÂ  Â  Â  Â  Â  Â  Â  Â #æ˜¯å¦é»˜è®¤åŒæ„é›†ç¾¤å†…éƒ¨çš„è¿ç§»è®¡åˆ’ï¼ˆé»˜è®¤åŒæ„å°±å¯ä»¥ï¼‰<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-timeout <arg>Â  Â #è¿ç§»å‘½ä»¤ï¼ˆmigrateï¼‰çš„è¶…æ—¶æ—¶é—´<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-pipeline <arg>Â  #è¿ç§»keyæ—¶ï¼Œä¸€æ¬¡å–å‡º çš„keyæ•°é‡ï¼Œé»˜è®¤10<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replaceÂ  Â  Â  Â  Â  Â #æ˜¯å¦ç›´æ¥replaceåˆ°ç›®æ ‡èŠ‚ç‚¹</p><p>è¿ç§»ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼ˆâ€“cluster-fromï¼‰èŠ‚ç‚¹ä¸Šçš„â€“cluster-slotsä¸ªæ§½ä½è‡³ä¸€ä¸ªç›®æ ‡èŠ‚ç‚¹ï¼ˆâ€“cluster-toï¼‰ä¸Šã€‚</p><p>Â â€“cluster-from çš„å€¼ä¸ä¸ºallçš„æƒ…å†µä¸‹ï¼ŒÂ â€“cluster-fromä¸èƒ½åŒ…å«â€“cluster-to</p><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ•´ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰è¿è¡Œid</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">[root@localhost bin]# ./redis-cli -h <span class="hljs-number">192.168.84.1</span> -p <span class="hljs-number">7001</span> cluster nodes8ae862c1815ff89e49d6c8801ea0cb074e82855c <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7006@17006</span> slave <span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span> <span class="hljs-number">0</span> <span class="hljs-number">1694427906290</span> <span class="hljs-number">3</span> connectedf6df82f6c67fbe83049d6f95a8473221afee2ee<span class="hljs-number">6 192.168.84</span>.<span class="hljs-number">1</span>:<span class="hljs-number">7004@17004</span> slave <span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41ea <span class="hljs-number">0</span> <span class="hljs-number">1694427905000</span> <span class="hljs-number">1</span> connected222df2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span> <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7003@17003</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1694427904000</span> <span class="hljs-number">3</span> connected <span class="hljs-number">10923</span>-<span class="hljs-number">163834</span>cdc4c8127dc5ea8d15a239fa6c2f3c09b0d5f3a <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7005@17005</span> slave <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-number">0</span> <span class="hljs-number">1694427905255</span> <span class="hljs-number">2</span> connected30c69d9e408015082c1a2145875cd1ec0c7a41ea <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001@17001</span> myself,master - <span class="hljs-number">0</span> <span class="hljs-number">1694427902000</span> <span class="hljs-number">1</span> connected <span class="hljs-number">0</span>-<span class="hljs-number">546010</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7002@17002</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1694427902000</span> <span class="hljs-number">2</span> connected <span class="hljs-number">5461-10922</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡é›†ç¾¤çš„é…ç½®æ–‡ä»¶æŸ¥çœ‹ä¹Ÿå¯ä»¥</p><h2 id="6ã€-â€“cluster-rebalance-å¹³è¡¡é›†ç¾¤-2"><a href="#6ã€-â€“cluster-rebalance-å¹³è¡¡é›†ç¾¤-2" class="headerlink" title="6ã€ â€“cluster rebalance å¹³è¡¡é›†ç¾¤"></a>6ã€ <strong>â€“cluster rebalance å¹³è¡¡é›†ç¾¤</strong></h2><p>rebalance Â  Â  Â host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-weight &lt;node1&#x3D;w1â€¦nodeN&#x3D;wN&gt;<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-use-empty-masters<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-timeout <arg>Â  Â  Â #è¿ç§»å‘½ä»¤ï¼ˆmigrateï¼‰çš„è¶…æ—¶æ—¶é—´<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-simulateÂ  Â  Â  Â  Â  Â  Â  #Â æ¨¡æ‹Ÿrebalanceæ“ä½œï¼Œä¸ä¼šçœŸæ­£æ‰§è¡Œè¿ç§»æ“ä½œ<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-pipeline <arg>Â  Â  #å®šä¹‰Â getkeysinslotå‘½ä»¤ä¸€æ¬¡å–å‡ºçš„keyæ•°é‡ï¼Œé»˜è®¤å€¼ä¸º10<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-threshold <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replaceÂ  Â  Â  Â  Â  Â  Â  Â #æ˜¯å¦ç›´æ¥replaceåˆ°ç›®æ ‡èŠ‚ç‚¹</p><p>--cluster-weightï¼š æ§½ä½æƒé‡ï¼ˆæµ®ç‚¹å‹ï¼‰æ¯”å€¼ï¼Œä¾‹å¦‚ï¼ˆè¿™é‡Œä½¿ç”¨ç«¯å£å·ä»£æ›¿è¿è¡Œidï¼‰ï¼š 7001&#x3D;1.0,7002&#x3D;1.0,7003&#x3D;2.0 åˆ™è¡¨ç¤ºï¼Œæ€»æƒé‡ä¸º4.0ï¼Œ 7001å’Œ7002å°†åˆ†é…åˆ° (16384&#x2F;4)*1Â  ä¸ªæ§½ä½ï¼Œ7003åˆ™æ˜¯(16384&#x2F;4)*2ä¸ªæ§½ä½ã€‚</p><p>Â â€“cluster-threshold: å¹³è¡¡è§¦å‘çš„é˜ˆå€¼æ¡ä»¶ï¼Œé»˜è®¤ä¸º2.00%ã€‚ä¾‹å¦‚ä¸Šä¸€æ­¥ï¼Œ7001å’Œ7002åº”è¯¥æœ‰4096ä¸ªæ§½ä½ï¼Œå¦‚æœ7001çš„æ§½ä½æ•°ä¸å¤Ÿ4096ä¸ªï¼Œä¸”è¶…è¿‡ (4096*0.02 çº¦ç­‰äº)82ä¸ªåŠä»¥ä¸Šï¼›æˆ–è€…7001çš„æ§½ä½æ•°æ¯”4096å°‘äº82ä¸ªåŠä»¥ä¸Šï¼Œåˆ™ä¼šè§¦å‘è‡ªå¹³è¡¡ã€‚</p><h2 id="7ã€-â€“cluster-add-node-é›†ç¾¤æ‰©å®¹-2"><a href="#7ã€-â€“cluster-add-node-é›†ç¾¤æ‰©å®¹-2" class="headerlink" title="7ã€ â€“clusterÂ Â add-nodeÂ  Â  é›†ç¾¤æ‰©å®¹"></a><strong>7ã€ â€“clusterÂ Â add-nodeÂ  Â  é›†ç¾¤æ‰©å®¹</strong></h2><p>add-node Â  Â new_host:new_portÂ  Â  Â  Â  Â  Â Â Â Â Â Â Â Â #æ–°åŠ å…¥é›†ç¾¤çš„ipå’Œport</p><p>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â existing_host:existing_portÂ  Â  Â  Â  Â  #é›†ç¾¤ä¸­ä»»ä¸€èŠ‚ç‚¹çš„ipå’Œport<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-slaveÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â #æ–°èŠ‚ç‚¹ä½œä¸ºä»èŠ‚ç‚¹ï¼Œé»˜è®¤éšæœºä¸€ä¸ªä¸»èŠ‚ç‚¹<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-master-id <arg>Â  Â  Â  Â  Â  Â  #ç»™æ–°èŠ‚ç‚¹æŒ‡å®šä¸»èŠ‚ç‚¹,å€¼ä¸ºèŠ‚ç‚¹çš„è¿è¡Œid</p><p>å¯ç”¨äºå‘é›†ç¾¤ä¸­æ·»åŠ ä¸»ã€ä»èŠ‚ç‚¹(å³æ‰©å®¹)</p><p>å‡è®¾æˆ‘ç°åœ¨é›†ç¾¤ä¸­æœ‰7001 7002 7003ä¸‰ä¸ªä¸»èŠ‚ç‚¹äº†ï¼Œæƒ³ä¸º7001æ·»åŠ ä¸€ä¸ªä»èŠ‚ç‚¹127.0.0.1:7006ï¼Œåˆ™å¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">redis-cli --cluster<span class="hljs-built_in"> add-node </span>127.0.0.1:7006 127.0.0.1:7001Â Â --cluster-slave --cluster-master-id 30c69d9e408015082c1a2145875cd1ec0c7a41ea<br></code></pre></td></tr></table></figure><p>Â ä¸ä¼ å…¥â€“cluster-slave â€“cluster-master-id å‚æ•°ï¼Œè¡¨ç¤ºæ·»åŠ ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚</p><p>å½“æ·»åŠ çš„æ˜¯ä¸€ä¸ªä¸»èŠ‚ç‚¹æ—¶ï¼Œæ­¤æ—¶ï¼Œè¯¥ä¸»èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•æ§½ä½ï¼Œå¯ä»¥ä½¿ç”¨rebalanceæˆ–è€…reshardæ¥è¿ç§»æ§½ä½ç»™å®ƒã€‚</p><h2 id="8ã€â€“cluster-del-node-é›†ç¾¤ç¼©å®¹-2"><a href="#8ã€â€“cluster-del-node-é›†ç¾¤ç¼©å®¹-2" class="headerlink" title="8ã€â€“cluster del-nodeÂ  Â  Â  é›†ç¾¤ç¼©å®¹"></a><strong>8ã€â€“cluster del-nodeÂ  Â  Â  é›†ç¾¤ç¼©å®¹</strong></h2><p>del-nodeÂ  Â  host:port node_idÂ  Â  Â  Â  Â #åˆ é™¤ç»™å®šçš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæˆåŠŸåå…³é—­è¯¥èŠ‚ç‚¹æœåŠ¡</p><p>ä¹Ÿå°±æ˜¯ç¼©å®¹ã€‚</p><p>åˆ é™¤ä¸€ä¸ªä¸»èŠ‚ç‚¹è¦æ±‚å…ˆè¿ç§»èµ°æ”¹ä¸»èŠ‚ç‚¹ä¸Šçš„æ§½ä½ï¼ˆæ•°æ®ï¼‰ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨reshardå‘½ä»¤äº†ã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[root@localhost bin]</span># ./redis-cli --cluster del-node <span class="hljs-number">192.168</span><span class="hljs-number">.84</span><span class="hljs-number">.1</span>:<span class="hljs-number">7002</span> <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe&gt;&gt;&gt; Removing node <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-keyword">from</span> cluster <span class="hljs-number">192.168</span><span class="hljs-number">.84</span><span class="hljs-number">.1</span>:<span class="hljs-number">7002</span>[ERR] Node <span class="hljs-number">192.168</span><span class="hljs-number">.84</span><span class="hljs-number">.1</span>:<span class="hljs-number">7002</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> empty! Reshard data away <span class="hljs-keyword">and</span> <span class="hljs-keyword">try</span> again.<br></code></pre></td></tr></table></figure><h2 id="9ã€-â€“cluster-call-åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤-2"><a href="#9ã€-â€“cluster-call-åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤-2" class="headerlink" title="9ã€ â€“cluster callÂ  åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤"></a><strong>9ã€ â€“cluster call</strong>Â  åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤</h2><p>call Â  Â  Â  Â  Â  host:port command arg arg .. argÂ  Â  Â  Â  Â  Â  Â  Â #åœ¨é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œç›¸å…³å‘½ä»¤<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-only-mastersÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  #æ˜¯å¦åªåœ¨ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-only-replicasÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â #æ˜¯å¦åªåœ¨ä»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/59db12799c1a7acd9c6fc267ccf790fc.png"></p><h2 id="10ã€â€“cluster-set-timeout-æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´-2"><a href="#10ã€â€“cluster-set-timeout-æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´-2" class="headerlink" title="10ã€â€“cluster set-timeoutÂ  Â  Â æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´"></a><strong>10ã€â€“cluster set-timeout</strong>Â  Â  Â æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´</h2><p>Â Â Â Â Â Â Â Â set-timeout Â  Â host:port milliseconds</p><p>è®¾ç½®æ•´ä¸ªé›†ç¾¤çš„cluster-node-timeoutæ—¶é—´</p><h2 id="11ã€â€“cluster-import-å¯¼å…¥æ•°æ®è‡³é›†ç¾¤-2"><a href="#11ã€â€“cluster-import-å¯¼å…¥æ•°æ®è‡³é›†ç¾¤-2" class="headerlink" title="11ã€â€“cluster importÂ  Â  Â  Â  Â  å¯¼å…¥æ•°æ®è‡³é›†ç¾¤"></a><strong>11ã€â€“cluster import</strong>Â  Â  Â  Â  Â  å¯¼å…¥æ•°æ®è‡³é›†ç¾¤</h2><p>import Â  Â  Â  Â  host:port<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from-user <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from-pass <arg><br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-from-askpass<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-copyÂ  Â  Â Â Â Â Â Â Â Â Â Â Â #migrateæ—¶æŒ‡å®šç±»å‹ä¸ºcopy<br>Â  Â  Â  Â  Â  Â  Â  Â  Â â€“cluster-replaceÂ  Â Â Â Â Â Â Â Â Â #migrateæ—¶æŒ‡å®šç±»å‹ä¸ºreplace</p><p>å°†å¤–éƒ¨redisçš„æ•°æ®å¯¼å…¥é›†ç¾¤Â </p><p>redis-cli â€“cluster import 127.0.01:6379 â€“cluster-from 127.0.0.2:6379 â€“cluster-replace â€“cluster-copy</p><p>è¯´æ˜ï¼šå¤–éƒ¨Rediså®ä¾‹ï¼ˆ127.0.0.2:6379ï¼‰å¯¼å…¥åˆ°é›†ç¾¤ä¸­çš„ä»»æ„ä¸€èŠ‚ç‚¹ï¼Œå€’å…¥ä¹‹åï¼ŒåŸæ¥é›†ç¾¤çš„keyå˜ä¸ºç©ºï¼Œå¯¼å…¥åˆ°æ–°é›†ç¾¤çš„keyä¼šè‡ªåŠ¨åˆ†ç‰‡åˆ°å„ä¸ªmaterèŠ‚ç‚¹çš„slot</p><p>--cluster-replace å¦‚æœé›†ç¾¤ï¼ˆ127.0.01:6379ï¼‰ä¸­å­˜åœ¨å¤–éƒ¨rediså®ä¾‹ï¼ˆ127.0.0.2:6379ï¼‰çš„keyï¼Œåˆ™ä¼šè¦†ç›–æ‰ï¼ˆ10.35.2.68:6379ï¼‰çš„value</p><p>--cluster-copy é»˜è®¤æƒ…å†µä¸‹ï¼Œimport å‘½ä»¤åœ¨å‘é›†ç¾¤å¯¼å…¥æ•°æ®çš„åŒæ—¶ï¼Œè¿˜ä¼šåˆ é™¤å•æœºæœåŠ¡å™¨ä¸­æºæ•°æ®ã€‚å¦‚æœç”¨æˆ·æƒ³è¦ä¿ç•™å•æœºæœåŠ¡å™¨ä¸­çš„æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨æ‰§è¡Œå‘½ä»¤çš„åŒæ—¶ç»™å®š â€“cluster-copy é€‰é¡¹Â </p><p>è¯¥å‘½ä»¤å°†æ­£åœ¨è¿è¡Œçš„å®ä¾‹çš„æ‰€æœ‰é”®ï¼ˆä»æºå®ä¾‹ä¸­åˆ é™¤é”®ï¼‰ç§»åŠ¨åˆ°æŒ‡å®šçš„é¢„å…ˆå­˜åœ¨çš„ Redis é›†ç¾¤ã€‚</p><p>å®é™…é¡¹ç›®ä¸Šï¼Œæ•°æ®å¯¼å…¥åº”è¯¥ç”¨redis-shakeå·¥å…·çš„æ¯”è¾ƒå¤šã€‚</p><h2 id="12ã€â€“cluster-backup-å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶-2"><a href="#12ã€â€“cluster-backup-å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶-2" class="headerlink" title="12ã€â€“cluster backupÂ  Â  Â  Â  Â å¤‡ä»½é›†ç¾¤rdbæ–‡ä»¶"></a>12ã€â€“cluster backupÂ  Â  Â  Â  Â å¤‡ä»½é›†ç¾¤<a href="https://so.csdn.net/so/search?q=rdb&spm=1001.2101.3001.7020">rdb</a>æ–‡ä»¶</h2><p>backup Â  Â  Â  Â  host:port backup_directoryÂ  Â Â </p><p>å¤‡ä»½ä¸»èŠ‚ç‚¹ä¸Šçš„æ•°æ®å€¼RDBæ–‡ä»¶</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">[root@localhost bin]# mkdir backup[root@localhost bin]# ./redis-cli --cluster backup <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span>  ./backup&gt;&gt;&gt; Performing Cluster Check (using node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span>)M: <span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41ea <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span>   slots:[<span class="hljs-number">0</span>-<span class="hljs-number">5460</span>] (<span class="hljs-number">5461</span> slots) master   <span class="hljs-number">1</span> additional replica(s)S: <span class="hljs-number">8</span>ae862c1815ff89e49d6c8801ea0cb074e82855c <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7006</span>   slots: (<span class="hljs-number">0</span> slots) slave   replicates <span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad292637873S: f6df82f6c67fbe83049d6f95a8473221afee2ee<span class="hljs-number">6 192.168.84</span>.<span class="hljs-number">1</span>:<span class="hljs-number">7004</span>   slots: (<span class="hljs-number">0</span> slots) slave   replicates <span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41eaM: <span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span> <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7003</span>   slots:[<span class="hljs-number">10923-16383</span>] (<span class="hljs-number">5461</span> slots) master   <span class="hljs-number">1</span> additional replica(s)S: <span class="hljs-number">4</span>cdc4c8127dc5ea8d15a239fa6c2f3c09b0d5f3a <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7005</span>   slots: (<span class="hljs-number">0</span> slots) slave   replicates <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43feM: <span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7002</span>   slots:[<span class="hljs-number">5461-10922</span>] (<span class="hljs-number">5462</span> slots) master   <span class="hljs-number">1</span> additional replica(s)[OK] All nodes agree about slots configuration.&gt;&gt;&gt; Check for open slots...&gt;&gt;&gt; Check slots coverage...[OK] All <span class="hljs-number">16384</span> slots covered.&gt;&gt;&gt; Node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7001</span> -&gt; Saving RDB...SYNC sent to master, writing <span class="hljs-number">232</span> bytes to &#x27;./backup/redis-node-<span class="hljs-number">192.168.84.1</span>-<span class="hljs-number">7001</span>-<span class="hljs-number">30</span>c69d9e408015082c1a2145875cd1ec0c7a41ea.rdb&#x27;Transfer finished with success.&gt;&gt;&gt; Node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7003</span> -&gt; Saving RDB...SYNC sent to master, writing <span class="hljs-number">226</span> bytes to &#x27;./backup/redis-node-<span class="hljs-number">192.168.84.1</span>-<span class="hljs-number">7003</span>-<span class="hljs-number">222d</span>f2165b7b9dba291cfa572d472ad<span class="hljs-number">292637873</span>.rdb&#x27;Transfer finished with success.&gt;&gt;&gt; Node <span class="hljs-number">192.168.84.1</span>:<span class="hljs-number">7002</span> -&gt; Saving RDB...SYNC sent to master, writing <span class="hljs-number">206</span> bytes to &#x27;./backup/redis-node-<span class="hljs-number">192.168.84.1</span>-<span class="hljs-number">7002</span>-<span class="hljs-number">10</span>a4381d9869e293cad95bf75482f506de9f43fe.rdb&#x27;Transfer finished with success.Saving cluster configuration to: ./backup/nodes.json[OK] Backup created into: ./backup<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/47dcb320ce3a8ca6ab958daf758a3194.png"></p><p>nodes.jsonä¿å­˜çš„æ˜¯é›†ç¾¤ç»“æ„ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">[root@localhost bin]# cat nodes.json [  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;30c69d9e408015082c1a2145875cd1ec0c7a41ea&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7001</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: null,    <span class="hljs-string">&quot;slots&quot;</span>: <span class="hljs-string">[[0,5460]]</span>,    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">5461</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">1</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;8ae862c1815ff89e49d6c8801ea0cb074e82855c&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7006</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: <span class="hljs-string">&quot;222df2165b7b9dba291cfa572d472ad292637873&quot;</span>,    <span class="hljs-string">&quot;slots&quot;</span>: [],    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;slave&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">3</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;f6df82f6c67fbe83049d6f95a8473221afee2ee6&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7004</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: <span class="hljs-string">&quot;30c69d9e408015082c1a2145875cd1ec0c7a41ea&quot;</span>,    <span class="hljs-string">&quot;slots&quot;</span>: [],    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;slave&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">1</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;222df2165b7b9dba291cfa572d472ad292637873&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7003</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: null,    <span class="hljs-string">&quot;slots&quot;</span>: <span class="hljs-string">[[10923,16383]]</span>,    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">5461</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">3</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;4cdc4c8127dc5ea8d15a239fa6c2f3c09b0d5f3a&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7005</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: <span class="hljs-string">&quot;10a4381d9869e293cad95bf75482f506de9f43fe&quot;</span>,    <span class="hljs-string">&quot;slots&quot;</span>: [],    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;slave&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">2</span>  &#125;,  &#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;10a4381d9869e293cad95bf75482f506de9f43fe&quot;</span>,    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;192.168.84.1&quot;</span>,    <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">7002</span>,    <span class="hljs-string">&quot;replicate&quot;</span>: null,    <span class="hljs-string">&quot;slots&quot;</span>: <span class="hljs-string">[[5461,10922]]</span>,    <span class="hljs-string">&quot;slots_count&quot;</span>: <span class="hljs-number">5462</span>,    <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,    <span class="hljs-string">&quot;current_epoch&quot;</span>: <span class="hljs-number">2</span>  &#125;]<br></code></pre></td></tr></table></figure><p>Â  Â </p><p>æ˜¾ç¤ºæ¨èå†…å®¹</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redissonåˆ†å¸ƒå¼é”</title>
    <link href="/article/41a6994d.html"/>
    <url>/article/41a6994d.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />åœ¨[å¤šçº¿ç¨‹](https://so.csdn.net/so/search?q=%E5%A4%9A%E7%BA%BF%E7%A8%8B&spm=1001.2101.3001.7020)ç¯å¢ƒä¸‹ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨åŠ é”çš„æ–¹å¼ï¼Œä½¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¯¹è¿™ä¸ªå…±äº«èµ„æºè¿›è¡Œæ“ä½œï¼Œ**åœ¨å•æœåŠ¡ç³»ç»Ÿæˆ‘ä»¬å¸¸ç”¨JVMé”â€”â€”[Synchronizedã€ReentrantLockç­‰](https://blog.csdn.net/weixin_45433817/article/details/132216383 "Synchronizedã€ReentrantLockç­‰")ã€‚ç„¶è€Œåœ¨å¤šå°æœåŠ¡ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼ŒJVMé”å°±æ— æ³•åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´ç”Ÿæ•ˆäº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚**<p>åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¸»æµçš„å°±æ˜¯åŸºäº<strong>æ•°æ®åº“ã€zookeeperä»¥åŠredis</strong>ï¼Œå½“ç„¶ä½¿ç”¨redisçš„å±…å¤šï¼Œç”±äºç¯‡å¹…åŸå› ï¼Œæœ¬èŠ‚å°±è¯¦ç»†ä»‹ç»ä¸€ä¸‹ä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”çš„å‡ ç§æ–¹å¼ã€‚</p><h2 id="ä¸€ã€SETNXå®ç°"><a href="#ä¸€ã€SETNXå®ç°" class="headerlink" title="ä¸€ã€SETNXå®ç°"></a>ä¸€ã€SETNXå®ç°</h2><p><strong>psï¼šæœ¬æ–‡é‡ç‚¹ä½¿Redissonå®ç°åˆ†å¸ƒå¼é”ï¼Œå’±å°±ä¸ä»SETNX+EXPIREã€SETNX+LUAè„šæœ¬â€¦ä»€ä¹ˆçš„é€æ­¥æ¼”è¿›äº†ï¼Œæœ¬èº«å°±æ˜¯ä¸€å›äº‹ï¼Œç›´æ¥ä¸€æ­¥åˆ°ä½ï¼Œç”¨set ex px nx+å”¯ä¸€æ ¡éªŒ+LUAè„šæœ¬åˆ é™¤ç­‰æ“ä½œå®ç°ã€‚</strong></p><p>åˆ©ç”¨<strong>Redisçš„å•çº¿ç¨‹</strong>ç‰¹æ€§ï¼Œåœ¨å¤šä¸ªRediså®¢æˆ·ç«¯é€šè¿‡SETNXï¼Œå¦‚æœè¿”å›1è¡¨ç¤ºè·å–é”æˆåŠŸï¼Œåä¹‹å¤±è´¥ã€‚å› ä¸ºRedisçš„å•çº¿ç¨‹æœºåˆ¶ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯ä¸€ä¸ªå®¢æˆ·ç«¯æˆåŠŸè·å–åï¼Œå…¶å®ƒå®¢æˆ·ç«¯éƒ½ä¼šè·å–å¤±è´¥ã€‚ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">public class RedisLock &#123; Â  Â private Jedis jedis; Â  Â private void init()&#123; Â  Â  Â  Â //å»ºç«‹è¿æ¥ Â  Â  Â  Â jedis = JedisPoolFactory.getJedis(); Â   &#125; Â  Â /** Â  Â  * è·å–é” Â  Â  * @param lockKey é”çš„é”®å€¼ Â  Â  * @param requestId å”¯ä¸€æ ‡è¯† Â  Â  * @param expireTime è¿‡æœŸæ—¶é—´ Â  Â  * @<span class="hljs-keyword">return</span> æ˜¯å¦è·å–é” æˆåŠŸè¿”å›<span class="hljs-keyword">true</span>ï¼Œåä¹‹<span class="hljs-keyword">false</span> Â  Â  */ Â  Â public boolean tryLock(<span class="hljs-keyword">String</span> lockKey,<span class="hljs-keyword">String</span> requestId,int expireTime)&#123; Â  Â  Â  Â //<span class="hljs-number">2</span>ã€åŠ é” Â  Â  Â  Â <span class="hljs-keyword">String</span> result = jedis.<span class="hljs-keyword">set</span>(lockKey,requestId,<span class="hljs-string">&quot;NX&quot;</span>,<span class="hljs-string">&quot;EX&quot;</span>,expireTime);â€‹ Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;OK&quot;</span>.equals(result); Â   &#125;â€‹ Â  Â /** Â  Â  * é‡Šæ”¾é” Â  Â  * @param lockKey é”çš„é”®å€¼ Â  Â  * @param requestId å”¯ä¸€æ ‡è¯† Â  Â  * @<span class="hljs-keyword">return</span> æˆåŠŸ<span class="hljs-keyword">true</span>ï¼Œå¤±è´¥<span class="hljs-keyword">false</span> Â  Â  */ Â  Â public boolean unlock(<span class="hljs-keyword">String</span> lockKey,<span class="hljs-keyword">String</span> requestId)&#123; Â  Â  Â  Â //LUAè„šæœ¬ï¼šåˆ¤æ–­å½“å‰é”çš„å€¼æ˜¯å¦ç­‰äºè¯·æ±‚æ ‡è¯†requestIdï¼Œå¦‚æœæ˜¯åˆ™åˆ é™¤é”å¹¶è¿”å›<span class="hljs-keyword">true</span>ï¼Œåä¹‹è¿”å›<span class="hljs-keyword">false</span>ã€‚ Â  Â  Â  Â <span class="hljs-keyword">String</span> scripts = <span class="hljs-string">&quot;if redis.call(&#x27;get&#x27;,KEYS[1]) == ARGV[1] then &quot;</span> + Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-string">&quot;return redis.call(&#x27;del&#x27;,KEYS[1]) else return 0 end&quot;</span>; Â  Â  Â  Â Object result = jedis.eval(scripts, Collections.singletonList(lockKey), Collections.singletonList(requestId)); Â  Â  Â  Â <span class="hljs-keyword">return</span> Long.parseLong(result.toString())==<span class="hljs-number">1</span>L; Â   &#125;&#125;<br></code></pre></td></tr></table></figure><p><strong>å­˜åœ¨çš„é—®é¢˜ï¼š</strong></p><blockquote><ul><li><strong>é”æ— æ³•ç»­æœŸï¼š</strong>å‡è®¾çº¿ç¨‹Aè·å–äº†é”ï¼Œä½†æ˜¯ç”±äºç½‘ç»œåŸå› ï¼Œæ‰§è¡Œæ—¶é—´è¶…è¿‡äº†è®¾ç½®çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ˜¯é”è¢«é‡Šæ”¾äº†ï¼Œçº¿ç¨‹Bè·å–é”æˆåŠŸï¼Œæ­¤æ—¶çº¿ç¨‹Aå’ŒBéƒ½ä¼šæ‰§è¡Œä¸´ç•ŒåŒºçš„ä»£ç ï¼Œè¿™æ˜¯ç»å¯¹ä¸å…è®¸çš„ã€‚</li></ul></blockquote><h2 id="äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”"><a href="#äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”"></a>äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”</h2><p>åœ¨ä½¿ç”¨SETNXå®ç°çš„åˆ†å¸ƒå¼é”ä¸­ï¼Œå­˜åœ¨é”æ— æ³•ç»­æœŸå¯¼è‡´å¹¶å‘å†²çªçš„é—®é¢˜ã€‚ä¸è¿‡è¿™ä¸ªé—®é¢˜åœ¨Redissonä¸­ç”¨çœ‹é—¨ç‹—çš„æœºåˆ¶å·§å¦™åœ°è§£å†³äº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å®ç°åˆ†å¸ƒå¼é”æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚</p><h3 id="2-1-æ•´ä½“ç±»å›¾"><a href="#2-1-æ•´ä½“ç±»å›¾" class="headerlink" title="2.1 æ•´ä½“ç±»å›¾"></a>2.1 æ•´ä½“ç±»å›¾</h3><p><img src="https://i-blog.csdnimg.cn/blog_migrate/2163205be5f25e23897ced4a05a14cb9.png"></p><p>æ ‡é»„çš„ä¸¤ä¸ªç±»å°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„é‡ç‚¹ï¼Œçœ‹é—¨ç‹—ç»­æœŸçš„å®ç°é€»è¾‘åœ¨<strong>RedissionBaseLockç±»</strong>ä¸­ï¼ŒåŠ é”é€»è¾‘åœ¨<strong>RedissionLockç±»</strong>ä¸­ã€‚</p><h3 id="2-2-å¤§è‡´æµç¨‹"><a href="#2-2-å¤§è‡´æµç¨‹" class="headerlink" title="2.2 å¤§è‡´æµç¨‹"></a>2.2 å¤§è‡´æµç¨‹</h3><p>åœ¨æ·±å…¥ä»£ç å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹åŠ é”ã€çœ‹é—¨ç‹—ç»­æœŸå¤§è‡´çš„æµç¨‹ï¼Œæœ‰ä¸ªå¤§è‡´å°è±¡ã€‚</p><p><img src="https://i-blog.csdnimg.cn/direct/47e9d6b55dd9448d8fe54d097e8bfbd3.png"></p><h3 id="2-3-åŠ é”æµç¨‹æºç åˆ†æ"><a href="#2-3-åŠ é”æµç¨‹æºç åˆ†æ" class="headerlink" title="2.3 åŠ é”æµç¨‹æºç åˆ†æ"></a>2.3 åŠ é”æµç¨‹æºç åˆ†æ</h3><p>ä¸‹é¢æˆ‘ä»¬å°±æŒ‰ä¸Šé¢çš„æµç¨‹å›¾ï¼Œèµ°èµ°æºç ã€‚</p><h4 id="2-3-1-lock-â€”åŠ é”å…¥å£"><a href="#2-3-1-lock-â€”åŠ é”å…¥å£" class="headerlink" title="2.3.1 lock()â€”åŠ é”å…¥å£"></a>2.3.1 lock()â€”åŠ é”å…¥å£</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/5c90322cb4a159b87fd04aca1081c2e2.png"></p><ul><li>lockæ–¹æ³•ï¼Œä¸€ä¸ªæ²¡è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¸€ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´ã€‚</li></ul><p><img src="https://i-blog.csdnimg.cn/blog_migrate/096f1c9bba501ea1e6b22b942c56c93f.png"></p><p>è§£æï¼š</p><blockquote><ul><li>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šå°è¯•åŠ é”ï¼Œä¼šè¿”å›nullæˆ–è€…å…·ä½“çš„å€¼ï¼Œ<strong>è¿”å›nullè¡¨ç¤ºåŠ é”æˆåŠŸï¼Œåä¹‹æœ‰çº¿ç¨‹æŒæœ‰è¯¥é”ï¼ŒåŠ é”å¤±è´¥ã€‚</strong></li><li>ç¬¬äºŒä¸ªçº¢æ¡†ï¼š<strong>åŠ é”å¤±è´¥ï¼Œwhileå¾ªç¯ä¸æ–­å°è¯•ã€‚</strong></li></ul></blockquote><h4 id="2-3-2-tryAcquire-â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ"><a href="#2-3-2-tryAcquire-â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ" class="headerlink" title="2.3.2 tryAcquire()â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ"></a>2.3.2 tryAcquire()â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/17e3ff2ffae885cde2e3349b11819e08.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/8ab1b8816bdb35dc5cd7918ee3e682dc.png"></p><blockquote><ul><li><p>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šæ‰§è¡ŒåŠ é”LUAè„šæœ¬ï¼Œè¿”å›nullè¯´æ˜åŠ é”æˆåŠŸï¼Œåä¹‹å¤±è´¥ã€‚</p><ul><li><p><strong>å¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±ä¼ è®¾ç½®çš„æ—¶é—´ã€‚</strong></p></li><li><p>åä¹‹ï¼Œä½¿ç”¨é»˜è®¤çš„<strong>internallockLeaseTime</strong>æ—¶é—´ã€‚</p></li></ul></li><li><p>ç¬¬äºŒä¸ªçº¢æ¡†ï¼šå¦‚æœåŠ é”æˆåŠŸï¼ˆnullï¼‰ï¼Œä¸”è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå°†è®¾ç½®è¿‡æœŸæ—¶é—´èµ‹å€¼ç»™internallockLeaseTimeï¼Œå¦‚æœæ²¡è®¾ç½®ï¼Œåˆ™æ‰§è¡Œ<strong>scheduleExpirationRenewalæ–¹æ³•ï¼ˆçœ‹é—¨ç‹—ï¼‰ã€‚</strong>è¿”å›ç»“æœã€‚</p></li></ul></blockquote><p><strong>psï¼šinternallockLeaseTimeé»˜è®¤å°±æ˜¯30sã€‚</strong></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/3776045e441c2b913a359ec9fbe4266d.png"><img src="https://i-blog.csdnimg.cn/blog_migrate/a0950ff3af7e06b77e31416b71c66999.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/04323d9885389ecb586ed19b62ac751c.png"></p><h4 id="2-3-3-tryLockInnerAsync-â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬"><a href="#2-3-3-tryLockInnerAsync-â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬" class="headerlink" title="2.3.3 tryLockInnerAsync()â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬"></a>2.3.3 tryLockInnerAsync()â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬</h4><p>æˆ‘ä»¬å…ˆçœ‹å¦‚ä½•æ‰§è¡ŒLUAåŠ é”è„šæœ¬çš„ï¼Œè¿™é‡Œé¢æœ‰ç‚¹æ·±ã€‚ã€‚ã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/16032194b6c649b468f75692ef55f6b4.png">Â <img src="https://i-blog.csdnimg.cn/blog_migrate/3aac08c39e8ead75464cc1c9aeb18fe7.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/cff71f24ba3ea06fa99bc94dc294f563.png"></p><p><strong>slotæ§½è¿™é‡Œå°±ä¸å¤šè®²äº†ã€‚ã€‚ã€‚æˆ‘ä»¬å›åˆ°LUAè„šæœ¬ã€‚</strong></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/aaa3bc287881377ff5ecdf9d7b7c1fdd.png"></p><blockquote><ul><li><strong>é¦–å…ˆæ£€æŸ¥é”çš„keyæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€çº¿ç¨‹å†æ¬¡è¿‡æ¥å¯¹åŒä¸€ä¸ªkeyè¿›è¡ŒåŠ é”ï¼Œä¹Ÿå°±æ˜¯å½“å‰keyæ˜¯å¦è¢«å½“å‰çº¿ç¨‹æŒæœ‰ï¼ˆå¯é‡å…¥æ€§ï¼‰ã€‚</strong></li><li>å¦‚æœä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ä»»æ„ä¸€ä¸ªæˆç«‹ï¼Œåˆ™å¯¹å½“å‰keyæ‰§è¡Œè‡ªå¢å’Œè®¾ç½®è¿‡æœŸæ—¶é—´æ“ä½œï¼Œå¹¶<strong>è¿”å›nullè¡¨ç¤ºåŠ é”æˆåŠŸã€‚</strong></li><li><strong>åä¹‹ï¼Œè¿”å›å½“å‰é”çš„è¿‡æœŸæ—¶é—´ï¼Œè¡¨ç¤ºåŠ é”å¤±è´¥ã€‚</strong></li></ul></blockquote><h3 id="2-4-watch-dogæºç åˆ†æ"><a href="#2-4-watch-dogæºç åˆ†æ" class="headerlink" title="2.4 watch dogæºç åˆ†æ"></a>2.4 watch dogæºç åˆ†æ</h3><h4 id="2-4-1-scheduleExpirationRenewal-â€“é”ç»­æœŸå…¥å£"><a href="#2-4-1-scheduleExpirationRenewal-â€“é”ç»­æœŸå…¥å£" class="headerlink" title="2.4.1 scheduleExpirationRenewal()â€“é”ç»­æœŸå…¥å£"></a>2.4.1 scheduleExpirationRenewal()â€“é”ç»­æœŸå…¥å£</h4><p>å½“åŠ é”æˆåŠŸï¼Œä¸”æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰§è¡Œ<strong>scheduleExpirationRenewal()æ–¹æ³•</strong>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„â€çœ‹é—¨ç‹—â€çš„å®ç°é€»è¾‘ã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/708d64a8687a87050b20fe1e5e88a36e.png"></p><blockquote><ul><li>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šEXPIRATION_RENEWAL_MAPå­˜æ”¾ç»­æœŸä»»åŠ¡ï¼Œgetæœ‰å€¼è¯´æ˜å½“å‰é”éœ€è¦ç»­æœŸï¼Œä¸ºnullåˆ™ä¸éœ€è¦å†ç»­æœŸäº†ã€‚</li><li>ç¬¬äºŒä¸ªçº¢æ¡†ï¼Œæ‰§è¡Œç»­æœŸæ“ä½œã€‚</li></ul></blockquote><h4 id="2-4-2-renewExpiration-â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ"><a href="#2-4-2-renewExpiration-â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ" class="headerlink" title="2.4.2 renewExpiration()â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ"></a>2.4.2 renewExpiration()â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ</h4><p>è¿™ä¸ªæ–¹æ³•ç”¨<strong>nettyçš„æ—¶é—´è½®</strong>è¿›è¡Œç»­æœŸã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/50ed4ade0574c203c1e118abc1920cfd.png"></p><blockquote><ul><li><p>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šé¦–å…ˆä¼šä»<strong>EXPIRATION_RENEWAL_MAP</strong>ä¸­è·å–ä¸€ä¸ªå€¼ï¼Œå¦‚æœä¸ºnullï¼Œå°±ä¸ç»­æœŸäº†ï¼Œ<strong>è¯´æ˜è¿™ä¸ªé”å¯èƒ½å·²ç»è¢«é‡Šæ”¾æˆ–è¿‡æœŸäº†ã€‚</strong></p></li><li><p>ç¬¬äºŒä¸ªçº¢æ¡†ï¼šåŸºäºTimerTaskå®ç°ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œè®¾ç½®<strong>internalLockLeaseTime &#x2F; 3</strong>çš„æ—¶é•¿è¿›è¡Œä¸€æ¬¡é”ç»­æœŸï¼Œä¹Ÿå°±æ˜¯æ¯10sè¿›è¡Œä¸€æ¬¡ç»­æœŸã€‚</p><ul><li><p>è¿™é‡Œä¹Ÿä¼šä»<strong>EXPIRATION_RENEWAL_MAP</strong>é‡Œè·å–ä¸€ä¸ªå€¼ï¼Œæ£€æŸ¥é”æ˜¯å¦è¢«é‡Šæ”¾ã€‚</p></li><li><p><strong>å¦‚æœä¸ä¸ºnullï¼Œåˆ™è·å–ç¬¬ä¸€ä¸ªthreadï¼ˆä¹Ÿå°±æ˜¯æŒæœ‰é”çš„çº¿ç¨‹ï¼‰ï¼Œå¦‚æœä¸ºnullåˆ™è¯´æ˜é”ä¹Ÿè¢«é‡Šæ”¾äº†ï¼Œæ­¤æ—¶ä¹Ÿä¸éœ€è¦ç»­æœŸã€‚</strong></p></li><li><p>å¦‚æœä¸ä¸ºnullï¼Œè¯´æ˜éœ€è¦ç»­æœŸï¼Œå®ƒä¼šå¼‚æ­¥è°ƒç”¨<strong>renewExpirationAsync(threadId)æ–¹æ³•</strong>æ¥å®ç°ç»­æœŸã€‚</p></li><li><p>å½“å¼‚æ­¥ç»­æœŸæ“ä½œå®Œæˆï¼Œä¼šè°ƒç”¨whenCompleteæ–¹æ³•æ¥å¤„ç†ç»“æœï¼Œå¦‚æœæœ‰å¼‚å¸¸ï¼Œåˆ™å°†è¯¥é”ä»<strong>EXPIRATION_RENEWAL_MAP</strong>ä¸­ç§»é™¤ã€‚å¦‚æœç»­æœŸæˆåŠŸï¼Œåˆ™ä¼šé‡æ–°è°ƒç”¨<strong>renewExpiration()æ–¹æ³•</strong>è¿›è¡Œä¸‹ä¸€æ¬¡ç»­æœŸï¼Œå¦‚æœç»­æœŸå¤±è´¥ï¼Œåˆ™è°ƒç”¨<strong>cancelExpirationRenewal()æ–¹æ³•</strong>å–æ¶ˆç»­æœŸã€‚</p></li></ul></li></ul></blockquote><h4 id="2-4-3-renewExpirationAsync-â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬"><a href="#2-4-3-renewExpirationAsync-â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬" class="headerlink" title="2.4.3 renewExpirationAsync()â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬"></a>2.4.3 renewExpirationAsync()â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/2bc37246d829ed6149898214984c7ab2.png"></p><blockquote><ul><li><strong>å¦‚æœå½“å‰keyå­˜åœ¨ï¼Œè¯´æ˜å½“å‰é”è¿˜è¢«è¯¥çº¿ç¨‹æŒæœ‰ï¼Œé‚£ä¹ˆå°±é‡ç½®è¿‡æœŸæ—¶é—´ä¸º30sï¼Œå¹¶è¿”å›trueï¼Œè¡¨ç¤ºç»­æœŸæˆåŠŸï¼Œåä¹‹è¿”å›falseã€‚</strong></li></ul></blockquote><h4 id="2-4-4-cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ"><a href="#2-4-4-cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ" class="headerlink" title="2.4.4 cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ"></a>2.4.4 cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/70dd77797eb7311864199dbdc59537b6.png"></p><blockquote><ul><li>è¿˜æ˜¯ä»è¿™ä¸ªmapé‡Œè·å–é”®å€¼å¯¹ï¼Œå¦‚æœä¸ºnullï¼Œè¯´æ˜ç»­æœŸä»»åŠ¡ä¸å­˜åœ¨ï¼Œä¹Ÿæ²¡å¿…è¦è¿›è¡Œä¸‹å»äº†ï¼Œç›´æ¥è¿”å›ã€‚</li><li>å¦‚æœthreadIdä¸ä¸ºnullï¼Œç›´æ¥å°†è¿™ä¸ªç»­æœŸä»»åŠ¡ä»taské‡Œç§»é™¤ã€‚</li><li>å¦‚æœthreadIdä¸ºnullæˆ–è€…taskä¸­ä¸å†æœ‰ä»»ä½•çº¿ç¨‹åœ¨ç­‰å¾…ç»­æœŸï¼Œæ­¤æ—¶å°±è°ƒç”¨cancelæ–¹æ³•æ¥å–æ¶ˆå®šæ—¶ä»»åŠ¡ï¼Œç„¶ååœ¨ä»<strong>EXPIRATION_RENEWAL_MAP</strong>ä¸­ç§»é™¤è¯¥ç»­æœŸä»»åŠ¡ã€‚</li></ul></blockquote><p><strong>psï¼šå½“unlockçš„æ—¶å€™ä¹Ÿä¼šè°ƒè¯¥æ–¹æ³•ï¼Œæ¥æ‰§è¡Œå–æ¶ˆé”ç»­æœŸçš„æ“ä½œã€‚</strong></p><h3 id="2-5-å°ç»“"><a href="#2-5-å°ç»“" class="headerlink" title="2.5 å°ç»“"></a>2.5 å°ç»“</h3><h4 id="2-5-1-ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ"><a href="#2-5-1-ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ" class="headerlink" title="2.5.1 ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ"></a>2.5.1 ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ</h4><blockquote><p>åŠ é”æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œåˆ™é»˜è®¤è¿‡æœŸæ—¶é—´ä¸º30sä¸”æ¯éš”10sè¿›è¡Œé”ç»­æœŸæ“ä½œã€‚</p><p><strong>psï¼šå‚è€ƒ2.3.2å’Œ2.4.2å°èŠ‚ã€‚</strong></p></blockquote><h4 id="2-5-2-ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ"><a href="#2-5-2-ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ" class="headerlink" title="2.5.2 ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ"></a>2.5.2 ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ</h4><blockquote><ul><li><p>é”è¢«é‡Šæ”¾ã€‚</p></li><li><p>ç»­æœŸæ—¶å‘ç”Ÿå¼‚å¸¸ã€‚</p></li><li><p>æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬å¤±è´¥ã€‚</p></li><li><p>Redissionçš„ç»­æœŸæ—¶Nettyæ—¶é—´è½®ï¼ˆTimerTaskã€TimeOutã€Timerï¼‰çš„ï¼Œå¹¶ä¸”æ“ä½œéƒ½æ˜¯åŸºäºJVMï¼Œæ‰€ä»¥å½“åº”ç”¨å®•æœºã€ä¸‹çº¿æˆ–é‡å¯åï¼Œç»­æœŸä»»åŠ¡ä¹Ÿæ²¡æœ‰äº†ã€‚</p></li></ul><p><strong>psï¼šå‚è€ƒ2.4.3å°èŠ‚ã€‚</strong></p></blockquote><h3 id="2-6-lock-å’Œtrylock-çš„åŒºåˆ«"><a href="#2-6-lock-å’Œtrylock-çš„åŒºåˆ«" class="headerlink" title="2.6 lock()å’Œtrylock()çš„åŒºåˆ«"></a>2.6 lock()å’Œtrylock()çš„åŒºåˆ«</h3><p>è®²äº†åŠå¤©å¿˜äº†è¯´ä½¿ç”¨redissionå®ç°åˆ†å¸ƒå¼é”çš„ç¤ºä¾‹äº†ğŸ˜‚ï¼Œç´¢æ€§å°±åœ¨è¿™è¡¥å……ä¸€ä¸‹å§ã€‚</p><p><strong>lock()ï¼š</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">RLock lock = redisson.getLock(<span class="hljs-string">&quot;MyLock&quot;</span>);lock.lock();<span class="hljs-regexp">//</span>é˜»å¡æ–¹æ³•ï¼ŒçŸ¥é“è·å–åˆ°é”try &#123; Â  Â <span class="hljs-regexp">//</span>ä¸šåŠ¡ä»£ç &#125;finally &#123; Â  Â <span class="hljs-regexp">//</span>å½“å‰é”å­˜åœ¨ä¸”è¢«å½“å‰çº¿ç¨‹æŒæœ‰ Â  Â  <span class="hljs-keyword">if</span>(lock.isLocked() &amp;&amp; lock.isHeldByCurrentThread())&#123; Â  Â  Â <span class="hljs-regexp">//</span>é‡Šæ”¾é” Â  Â  Â lock.unlock(); Â  &#125;&#125;<br></code></pre></td></tr></table></figure><blockquote><p>lockçš„åŸç†æ˜¯ä»¥é˜»å¡çš„æ–¹å¼è·å–é”ï¼Œå¦‚æœè·å–å¤±è´¥åˆ™ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å–æˆåŠŸã€‚</p><p><strong>psï¼šå¯ä»¥å‚è€ƒ2.3.1å°èŠ‚ã€‚</strong></p></blockquote><p><strong>trylock()ï¼š</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">RLock lock = redisson.getLock(<span class="hljs-string">&quot;MyLock&quot;</span>);boolean b = lock.tryLock();<span class="hljs-regexp">//</span>éé˜»å¡æ–¹æ³•ï¼Œç«‹å³è¿”å›è·å–ç»“æœ<span class="hljs-keyword">if</span>(b)&#123; Â  Â  try &#123; Â  Â  Â  Â  Â <span class="hljs-regexp">//</span>ä¸šåŠ¡ä»£ç  Â  Â  &#125;finally &#123; Â  Â  Â  Â  Â <span class="hljs-regexp">//</span>å½“å‰é”å­˜åœ¨ä¸”è¢«å½“å‰çº¿ç¨‹æŒæœ‰ Â  Â  Â  Â  Â <span class="hljs-keyword">if</span>(lock.isLocked() &amp;&amp; lock.isHeldByCurrentThread())&#123; Â  Â  Â  Â  Â  Â  Â  <span class="hljs-regexp">//</span>é‡Šæ”¾é” Â  Â  Â  Â  Â  Â  Â  lock.unlock(); Â  Â  Â  Â  Â  &#125; Â  Â  &#125;&#125;<span class="hljs-keyword">else</span> &#123; Â  <span class="hljs-regexp">//</span>è·å–é”å¤±è´¥ï¼Œå¤„ç†é€»è¾‘&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/1c9d3a00e609d59fa4984a1f606e3953.png"></p><blockquote><p>tryLockæ˜¯å°è¯•è·å–é”ï¼Œå¦‚æœèƒ½è·å–ç›´æ¥è¿”å›trueï¼Œå¦‚æœæ— æ³•è·å–ï¼Œå®ƒä¼šæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„è¶…æ—¶æ—¶é—´è¿›è¡Œé˜»å¡ï¼Œ<strong>è¿™ä¸ªæ—¶é—´å†…è¿˜ä¼šå°è¯•è·å–é”ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æ²¡è·å–åˆ°ï¼Œç›´æ¥è¿”å›falseã€‚</strong>å¦‚æœæ²¡æœ‰æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œå°±å¦‚æˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œé‚£è·å–ä¸åˆ°çš„è¯ç›´æ¥å°±è¿”å›falseã€‚</p></blockquote><p><strong>æˆ‘ä»¬çœ‹ä¸‹æºç ï¼š</strong></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/5bf0550041bf17578d7a01ed660437db.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/f9968619e85e7c4660cc7331cb48315d.png"></p><p><strong>è¿™æ˜¯æ²¡æœ‰æŒ‡å®šè¶…æ—¶æ—¶é—´æ‰§è¡Œçš„æ–¹æ³•ï¼Œæ–¹æ³•åä¹Ÿå¾ˆè§åçŸ¥æ„ï¼Œå°±æ˜¯å°è¯•ä¸€æ¬¡åŠ é”ã€‚æŒ‡å®šäº†è¶…æ—¶æ—¶é—´çš„è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œæ— éæ˜¯åœ¨è¶…æ—¶æ—¶é—´å†…æ‰§è¡Œwhileå¾ªç¯å°è¯•è·å–é”ã€‚</strong></p><h2 id="ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨"><a href="#ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨" class="headerlink" title="ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨"></a>ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨</h2><p><strong>psï¼šè¿™å‡ ç§é”éƒ½ä¸å¸¸ç”¨ï¼Œæ‰€ä»¥å°±ä¸ç»†è®²äº†ï¼ŒçŸ¥é“æœ‰è¿™ä¸ªäº‹å°±è¡Œã€‚</strong></p><h3 id="3-1-å…¬å¹³é”ï¼ˆFairLockï¼‰"><a href="#3-1-å…¬å¹³é”ï¼ˆFairLockï¼‰" class="headerlink" title="3.1 å…¬å¹³é”ï¼ˆFairLockï¼‰"></a>3.1 å…¬å¹³é”ï¼ˆFairLockï¼‰</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">RLock <span class="hljs-keyword">lock</span> = redisson.getFairLock(<span class="hljs-string">&quot;MyLock&quot;</span>);<span class="hljs-keyword">lock</span>.<span class="hljs-keyword">lock</span>();<br></code></pre></td></tr></table></figure><h3 id="3-2-è”é”ï¼ˆMultiLockï¼‰"><a href="#3-2-è”é”ï¼ˆMultiLockï¼‰" class="headerlink" title="3.2 è”é”ï¼ˆMultiLockï¼‰"></a>3.2 è”é”ï¼ˆMultiLockï¼‰</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">RLock lock1 = redisson.get<span class="hljs-constructor">Lock(<span class="hljs-string">&quot;MyLock1&quot;</span>)</span>;RLock lock2 = redisson.get<span class="hljs-constructor">Lock(<span class="hljs-string">&quot;MyLock2&quot;</span>)</span>;RLock lock3 = redisson.get<span class="hljs-constructor">Lock(<span class="hljs-string">&quot;MyLock3&quot;</span>)</span>;RedissonMultiLock lock=<span class="hljs-keyword">new</span> <span class="hljs-constructor">RedissonMultiLock(<span class="hljs-params">lock1</span>,<span class="hljs-params">lock2</span>,<span class="hljs-params">lock3</span>)</span>;<span class="hljs-comment">//åŒæ—¶åŠ é”lock1ã€lock2ã€lock3//æ‰€æœ‰çš„é”éƒ½ä¸Šé”æˆåŠŸæ‰ç®—æˆåŠŸlock.lock(); //...lock.unlock();</span><br></code></pre></td></tr></table></figure><h3 id="3-3-è¯»å†™é”"><a href="#3-3-è¯»å†™é”" class="headerlink" title="3.3 è¯»å†™é”"></a>3.3 è¯»å†™é”</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">RReadWriteLock <span class="hljs-keyword">lock</span> = redisson.getReadWriteLock(&quot;myLock&quot;);//è¯»é”<span class="hljs-keyword">lock</span>.readLock().<span class="hljs-keyword">lock</span>();//å†™é”<span class="hljs-keyword">lock</span>.writeLock().<span class="hljs-keyword">lock</span>();<br></code></pre></td></tr></table></figure><p><strong>psï¼šè¿˜æœ‰ä¸ªRedLockï¼Œè¿™ä¸ªå¯ä»¥ç»†è®²ä¸€ä¸‹ï¼Œä½†æ˜¯ç”±äºç¯‡å¹…åŸå› ï¼Œå°±æ”¾åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å§ã€‚</strong></p><h2 id="å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜"><a href="#å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜"></a>å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜</h2><p>Redissionä½¿ç”¨çœ‹é—¨ç‹—ç»­æœŸçš„æ–¹æ¡ˆåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹æ˜¯æŒºä¸é”™çš„ï¼Œä½†åœ¨æç«¯æƒ…å†µä¸‹è¿˜æ˜¯ä¼šå­˜åœ¨é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><blockquote><ul><li>çº¿ç¨‹1é¦–å…ˆè·å–é”æˆåŠŸï¼Œå°†é”®å€¼å¯¹å†™å…¥redisçš„masterèŠ‚ç‚¹ã€‚</li><li><strong>åœ¨rediså°†masteræ•°æ®åŒæ­¥åˆ°slaveèŠ‚ç‚¹ä¹‹å‰ï¼Œmasteræ•…éšœäº†ã€‚</strong></li><li>æ­¤æ—¶ä¼šè§¦å‘æ•…éšœè½¬ç§»ï¼Œå°†å…¶ä¸­ä¸€ä¸ªslaveå‡çº§ä¸ºmasterã€‚</li><li>ä½†æ–°çš„masterå¹¶æ²¡æœ‰çº¿ç¨‹1å†™å…¥çš„é”®å€¼å¯¹ï¼Œå› æ­¤å¦‚æœæ­¤æ—¶æ¥ä¸ªçº¿ç¨‹2ï¼Œä¹ŸåŒæ ·å¯ä»¥è·å–åˆ°é”ï¼Œè¿™å°±è¿èƒŒäº†é”çš„åˆè¡·ã€‚</li></ul></blockquote><p>è¿™ä¸ªåœºæ™¯å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<a href="https://blog.csdn.net/weixin_45433817/article/details/137209295?spm=1001.2014.3001.5501" title="é›†ç¾¤è„‘è£‚">é›†ç¾¤è„‘è£‚</a><strong>ï¼ˆç½‘ç»œåˆ†åŒºï¼‰</strong>é—®é¢˜ã€‚</p><p>é‚£ä¹ˆæ¯”è¾ƒä¸»æµçš„è§£å†³æ–¹æ¡ˆå°±æ˜¯<strong>Redisä½œè€…æå‡ºçš„Redlock</strong>å’Œ<strong>Zookeeper</strong>å®ç°çš„åˆ†å¸ƒå¼é”ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸‹èŠ‚å†è®²ã€‚</p><p><strong>Endï¼šå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æœæœ‰çº°æ¼æˆ–è€…æ›´å¥½çš„æƒ³æ³•ï¼Œè¯·æ‚¨ä¸€å®šä¸è¦åå•¬ä½ çš„èµæ•™ğŸ™‹ã€‚</strong>åœ¨<a href="https://so.csdn.net/so/search?q=%E5%A4%9A%E7%BA%BF%E7%A8%8B&spm=1001.2101.3001.7020">å¤šçº¿ç¨‹</a>ç¯å¢ƒä¸‹ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨åŠ é”çš„æ–¹å¼ï¼Œä½¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¯¹è¿™ä¸ªå…±äº«èµ„æºè¿›è¡Œæ“ä½œï¼Œ<strong>åœ¨å•æœåŠ¡ç³»ç»Ÿæˆ‘ä»¬å¸¸ç”¨JVMé”â€”â€”<a href="https://blog.csdn.net/weixin_45433817/article/details/132216383" title="Synchronizedã€ReentrantLockç­‰">Synchronizedã€ReentrantLockç­‰</a>ã€‚ç„¶è€Œåœ¨å¤šå°æœåŠ¡ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼ŒJVMé”å°±æ— æ³•åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´ç”Ÿæ•ˆäº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</strong></p><p>åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¸»æµçš„å°±æ˜¯åŸºäº<strong>æ•°æ®åº“ã€zookeeperä»¥åŠredis</strong>ï¼Œå½“ç„¶ä½¿ç”¨redisçš„å±…å¤šï¼Œç”±äºç¯‡å¹…åŸå› ï¼Œæœ¬èŠ‚å°±è¯¦ç»†ä»‹ç»ä¸€ä¸‹ä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”çš„å‡ ç§æ–¹å¼ã€‚</p><h2 id="ä¸€ã€SETNXå®ç°-1"><a href="#ä¸€ã€SETNXå®ç°-1" class="headerlink" title="ä¸€ã€SETNXå®ç°"></a>ä¸€ã€SETNXå®ç°</h2><p><strong>psï¼šæœ¬æ–‡é‡ç‚¹ä½¿Redissonå®ç°åˆ†å¸ƒå¼é”ï¼Œå’±å°±ä¸ä»SETNX+EXPIREã€SETNX+LUAè„šæœ¬â€¦ä»€ä¹ˆçš„é€æ­¥æ¼”è¿›äº†ï¼Œæœ¬èº«å°±æ˜¯ä¸€å›äº‹ï¼Œç›´æ¥ä¸€æ­¥åˆ°ä½ï¼Œç”¨set ex px nx+å”¯ä¸€æ ¡éªŒ+LUAè„šæœ¬åˆ é™¤ç­‰æ“ä½œå®ç°ã€‚</strong></p><p>åˆ©ç”¨<strong>Redisçš„å•çº¿ç¨‹</strong>ç‰¹æ€§ï¼Œåœ¨å¤šä¸ªRediså®¢æˆ·ç«¯é€šè¿‡SETNXï¼Œå¦‚æœè¿”å›1è¡¨ç¤ºè·å–é”æˆåŠŸï¼Œåä¹‹å¤±è´¥ã€‚å› ä¸ºRedisçš„å•çº¿ç¨‹æœºåˆ¶ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯ä¸€ä¸ªå®¢æˆ·ç«¯æˆåŠŸè·å–åï¼Œå…¶å®ƒå®¢æˆ·ç«¯éƒ½ä¼šè·å–å¤±è´¥ã€‚ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">public class RedisLock &#123; Â  Â private Jedis jedis; Â  Â private void init()&#123; Â  Â  Â  Â //å»ºç«‹è¿æ¥ Â  Â  Â  Â jedis = JedisPoolFactory.getJedis(); Â   &#125; Â  Â /** Â  Â  * è·å–é” Â  Â  * @param lockKey é”çš„é”®å€¼ Â  Â  * @param requestId å”¯ä¸€æ ‡è¯† Â  Â  * @param expireTime è¿‡æœŸæ—¶é—´ Â  Â  * @<span class="hljs-keyword">return</span> æ˜¯å¦è·å–é” æˆåŠŸè¿”å›<span class="hljs-keyword">true</span>ï¼Œåä¹‹<span class="hljs-keyword">false</span> Â  Â  */ Â  Â public boolean tryLock(<span class="hljs-keyword">String</span> lockKey,<span class="hljs-keyword">String</span> requestId,int expireTime)&#123; Â  Â  Â  Â //<span class="hljs-number">2</span>ã€åŠ é” Â  Â  Â  Â <span class="hljs-keyword">String</span> result = jedis.<span class="hljs-keyword">set</span>(lockKey,requestId,<span class="hljs-string">&quot;NX&quot;</span>,<span class="hljs-string">&quot;EX&quot;</span>,expireTime);â€‹ Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;OK&quot;</span>.equals(result); Â   &#125;â€‹ Â  Â /** Â  Â  * é‡Šæ”¾é” Â  Â  * @param lockKey é”çš„é”®å€¼ Â  Â  * @param requestId å”¯ä¸€æ ‡è¯† Â  Â  * @<span class="hljs-keyword">return</span> æˆåŠŸ<span class="hljs-keyword">true</span>ï¼Œå¤±è´¥<span class="hljs-keyword">false</span> Â  Â  */ Â  Â public boolean unlock(<span class="hljs-keyword">String</span> lockKey,<span class="hljs-keyword">String</span> requestId)&#123; Â  Â  Â  Â //LUAè„šæœ¬ï¼šåˆ¤æ–­å½“å‰é”çš„å€¼æ˜¯å¦ç­‰äºè¯·æ±‚æ ‡è¯†requestIdï¼Œå¦‚æœæ˜¯åˆ™åˆ é™¤é”å¹¶è¿”å›<span class="hljs-keyword">true</span>ï¼Œåä¹‹è¿”å›<span class="hljs-keyword">false</span>ã€‚ Â  Â  Â  Â <span class="hljs-keyword">String</span> scripts = <span class="hljs-string">&quot;if redis.call(&#x27;get&#x27;,KEYS[1]) == ARGV[1] then &quot;</span> + Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-string">&quot;return redis.call(&#x27;del&#x27;,KEYS[1]) else return 0 end&quot;</span>; Â  Â  Â  Â Object result = jedis.eval(scripts, Collections.singletonList(lockKey), Collections.singletonList(requestId)); Â  Â  Â  Â <span class="hljs-keyword">return</span> Long.parseLong(result.toString())==<span class="hljs-number">1</span>L; Â   &#125;&#125;<br></code></pre></td></tr></table></figure><p><strong>å­˜åœ¨çš„é—®é¢˜ï¼š</strong></p><blockquote><ul><li><strong>é”æ— æ³•ç»­æœŸï¼š</strong>å‡è®¾çº¿ç¨‹Aè·å–äº†é”ï¼Œä½†æ˜¯ç”±äºç½‘ç»œåŸå› ï¼Œæ‰§è¡Œæ—¶é—´è¶…è¿‡äº†è®¾ç½®çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ˜¯é”è¢«é‡Šæ”¾äº†ï¼Œçº¿ç¨‹Bè·å–é”æˆåŠŸï¼Œæ­¤æ—¶çº¿ç¨‹Aå’ŒBéƒ½ä¼šæ‰§è¡Œä¸´ç•ŒåŒºçš„ä»£ç ï¼Œè¿™æ˜¯ç»å¯¹ä¸å…è®¸çš„ã€‚</li></ul></blockquote><h2 id="äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”-1"><a href="#äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”-1" class="headerlink" title="äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”"></a>äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”</h2><p>åœ¨ä½¿ç”¨SETNXå®ç°çš„åˆ†å¸ƒå¼é”ä¸­ï¼Œå­˜åœ¨é”æ— æ³•ç»­æœŸå¯¼è‡´å¹¶å‘å†²çªçš„é—®é¢˜ã€‚ä¸è¿‡è¿™ä¸ªé—®é¢˜åœ¨Redissonä¸­ç”¨çœ‹é—¨ç‹—çš„æœºåˆ¶å·§å¦™åœ°è§£å†³äº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å®ç°åˆ†å¸ƒå¼é”æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚</p><h3 id="2-1-æ•´ä½“ç±»å›¾-1"><a href="#2-1-æ•´ä½“ç±»å›¾-1" class="headerlink" title="2.1 æ•´ä½“ç±»å›¾"></a>2.1 æ•´ä½“ç±»å›¾</h3><p><img src="https://i-blog.csdnimg.cn/blog_migrate/2163205be5f25e23897ced4a05a14cb9.png"></p><p>æ ‡é»„çš„ä¸¤ä¸ªç±»å°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„é‡ç‚¹ï¼Œçœ‹é—¨ç‹—ç»­æœŸçš„å®ç°é€»è¾‘åœ¨<strong>RedissionBaseLockç±»</strong>ä¸­ï¼ŒåŠ é”é€»è¾‘åœ¨<strong>RedissionLockç±»</strong>ä¸­ã€‚</p><h3 id="2-2-å¤§è‡´æµç¨‹-1"><a href="#2-2-å¤§è‡´æµç¨‹-1" class="headerlink" title="2.2 å¤§è‡´æµç¨‹"></a>2.2 å¤§è‡´æµç¨‹</h3><p>åœ¨æ·±å…¥ä»£ç å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹åŠ é”ã€çœ‹é—¨ç‹—ç»­æœŸå¤§è‡´çš„æµç¨‹ï¼Œæœ‰ä¸ªå¤§è‡´å°è±¡ã€‚</p><p><img src="https://i-blog.csdnimg.cn/direct/47e9d6b55dd9448d8fe54d097e8bfbd3.png"></p><h3 id="2-3-åŠ é”æµç¨‹æºç åˆ†æ-1"><a href="#2-3-åŠ é”æµç¨‹æºç åˆ†æ-1" class="headerlink" title="2.3 åŠ é”æµç¨‹æºç åˆ†æ"></a>2.3 åŠ é”æµç¨‹æºç åˆ†æ</h3><p>ä¸‹é¢æˆ‘ä»¬å°±æŒ‰ä¸Šé¢çš„æµç¨‹å›¾ï¼Œèµ°èµ°æºç ã€‚</p><h4 id="2-3-1-lock-â€”åŠ é”å…¥å£-1"><a href="#2-3-1-lock-â€”åŠ é”å…¥å£-1" class="headerlink" title="2.3.1 lock()â€”åŠ é”å…¥å£"></a>2.3.1 lock()â€”åŠ é”å…¥å£</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/5c90322cb4a159b87fd04aca1081c2e2.png"></p><ul><li>lockæ–¹æ³•ï¼Œä¸€ä¸ªæ²¡è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¸€ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´ã€‚</li></ul><p><img src="https://i-blog.csdnimg.cn/blog_migrate/096f1c9bba501ea1e6b22b942c56c93f.png"></p><p>è§£æï¼š</p><blockquote><ul><li>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šå°è¯•åŠ é”ï¼Œä¼šè¿”å›nullæˆ–è€…å…·ä½“çš„å€¼ï¼Œ<strong>è¿”å›nullè¡¨ç¤ºåŠ é”æˆåŠŸï¼Œåä¹‹æœ‰çº¿ç¨‹æŒæœ‰è¯¥é”ï¼ŒåŠ é”å¤±è´¥ã€‚</strong></li><li>ç¬¬äºŒä¸ªçº¢æ¡†ï¼š<strong>åŠ é”å¤±è´¥ï¼Œwhileå¾ªç¯ä¸æ–­å°è¯•ã€‚</strong></li></ul></blockquote><h4 id="2-3-2-tryAcquire-â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ-1"><a href="#2-3-2-tryAcquire-â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ-1" class="headerlink" title="2.3.2 tryAcquire()â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ"></a>2.3.2 tryAcquire()â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/17e3ff2ffae885cde2e3349b11819e08.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/8ab1b8816bdb35dc5cd7918ee3e682dc.png"></p><blockquote><ul><li><p>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šæ‰§è¡ŒåŠ é”LUAè„šæœ¬ï¼Œè¿”å›nullè¯´æ˜åŠ é”æˆåŠŸï¼Œåä¹‹å¤±è´¥ã€‚</p><ul><li><p><strong>å¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±ä¼ è®¾ç½®çš„æ—¶é—´ã€‚</strong></p></li><li><p>åä¹‹ï¼Œä½¿ç”¨é»˜è®¤çš„<strong>internallockLeaseTime</strong>æ—¶é—´ã€‚</p></li></ul></li><li><p>ç¬¬äºŒä¸ªçº¢æ¡†ï¼šå¦‚æœåŠ é”æˆåŠŸï¼ˆnullï¼‰ï¼Œä¸”è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå°†è®¾ç½®è¿‡æœŸæ—¶é—´èµ‹å€¼ç»™internallockLeaseTimeï¼Œå¦‚æœæ²¡è®¾ç½®ï¼Œåˆ™æ‰§è¡Œ<strong>scheduleExpirationRenewalæ–¹æ³•ï¼ˆçœ‹é—¨ç‹—ï¼‰ã€‚</strong>è¿”å›ç»“æœã€‚</p></li></ul></blockquote><p><strong>psï¼šinternallockLeaseTimeé»˜è®¤å°±æ˜¯30sã€‚</strong></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/3776045e441c2b913a359ec9fbe4266d.png"><img src="https://i-blog.csdnimg.cn/blog_migrate/a0950ff3af7e06b77e31416b71c66999.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/04323d9885389ecb586ed19b62ac751c.png"></p><h4 id="2-3-3-tryLockInnerAsync-â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬-1"><a href="#2-3-3-tryLockInnerAsync-â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬-1" class="headerlink" title="2.3.3 tryLockInnerAsync()â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬"></a>2.3.3 tryLockInnerAsync()â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬</h4><p>æˆ‘ä»¬å…ˆçœ‹å¦‚ä½•æ‰§è¡ŒLUAåŠ é”è„šæœ¬çš„ï¼Œè¿™é‡Œé¢æœ‰ç‚¹æ·±ã€‚ã€‚ã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/16032194b6c649b468f75692ef55f6b4.png">Â <img src="https://i-blog.csdnimg.cn/blog_migrate/3aac08c39e8ead75464cc1c9aeb18fe7.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/cff71f24ba3ea06fa99bc94dc294f563.png"></p><p><strong>slotæ§½è¿™é‡Œå°±ä¸å¤šè®²äº†ã€‚ã€‚ã€‚æˆ‘ä»¬å›åˆ°LUAè„šæœ¬ã€‚</strong></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/aaa3bc287881377ff5ecdf9d7b7c1fdd.png"></p><blockquote><ul><li><strong>é¦–å…ˆæ£€æŸ¥é”çš„keyæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€çº¿ç¨‹å†æ¬¡è¿‡æ¥å¯¹åŒä¸€ä¸ªkeyè¿›è¡ŒåŠ é”ï¼Œä¹Ÿå°±æ˜¯å½“å‰keyæ˜¯å¦è¢«å½“å‰çº¿ç¨‹æŒæœ‰ï¼ˆå¯é‡å…¥æ€§ï¼‰ã€‚</strong></li><li>å¦‚æœä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ä»»æ„ä¸€ä¸ªæˆç«‹ï¼Œåˆ™å¯¹å½“å‰keyæ‰§è¡Œè‡ªå¢å’Œè®¾ç½®è¿‡æœŸæ—¶é—´æ“ä½œï¼Œå¹¶<strong>è¿”å›nullè¡¨ç¤ºåŠ é”æˆåŠŸã€‚</strong></li><li><strong>åä¹‹ï¼Œè¿”å›å½“å‰é”çš„è¿‡æœŸæ—¶é—´ï¼Œè¡¨ç¤ºåŠ é”å¤±è´¥ã€‚</strong></li></ul></blockquote><h3 id="2-4-watch-dogæºç åˆ†æ-1"><a href="#2-4-watch-dogæºç åˆ†æ-1" class="headerlink" title="2.4 watch dogæºç åˆ†æ"></a>2.4 watch dogæºç åˆ†æ</h3><h4 id="2-4-1-scheduleExpirationRenewal-â€“é”ç»­æœŸå…¥å£-1"><a href="#2-4-1-scheduleExpirationRenewal-â€“é”ç»­æœŸå…¥å£-1" class="headerlink" title="2.4.1 scheduleExpirationRenewal()â€“é”ç»­æœŸå…¥å£"></a>2.4.1 scheduleExpirationRenewal()â€“é”ç»­æœŸå…¥å£</h4><p>å½“åŠ é”æˆåŠŸï¼Œä¸”æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰§è¡Œ<strong>scheduleExpirationRenewal()æ–¹æ³•</strong>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„â€çœ‹é—¨ç‹—â€çš„å®ç°é€»è¾‘ã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/708d64a8687a87050b20fe1e5e88a36e.png"></p><blockquote><ul><li>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šEXPIRATION_RENEWAL_MAPå­˜æ”¾ç»­æœŸä»»åŠ¡ï¼Œgetæœ‰å€¼è¯´æ˜å½“å‰é”éœ€è¦ç»­æœŸï¼Œä¸ºnullåˆ™ä¸éœ€è¦å†ç»­æœŸäº†ã€‚</li><li>ç¬¬äºŒä¸ªçº¢æ¡†ï¼Œæ‰§è¡Œç»­æœŸæ“ä½œã€‚</li></ul></blockquote><h4 id="2-4-2-renewExpiration-â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ-1"><a href="#2-4-2-renewExpiration-â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ-1" class="headerlink" title="2.4.2 renewExpiration()â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ"></a>2.4.2 renewExpiration()â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ</h4><p>è¿™ä¸ªæ–¹æ³•ç”¨<strong>nettyçš„æ—¶é—´è½®</strong>è¿›è¡Œç»­æœŸã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/50ed4ade0574c203c1e118abc1920cfd.png"></p><blockquote><ul><li><p>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šé¦–å…ˆä¼šä»<strong>EXPIRATION_RENEWAL_MAP</strong>ä¸­è·å–ä¸€ä¸ªå€¼ï¼Œå¦‚æœä¸ºnullï¼Œå°±ä¸ç»­æœŸäº†ï¼Œ<strong>è¯´æ˜è¿™ä¸ªé”å¯èƒ½å·²ç»è¢«é‡Šæ”¾æˆ–è¿‡æœŸäº†ã€‚</strong></p></li><li><p>ç¬¬äºŒä¸ªçº¢æ¡†ï¼šåŸºäºTimerTaskå®ç°ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œè®¾ç½®<strong>internalLockLeaseTime &#x2F; 3</strong>çš„æ—¶é•¿è¿›è¡Œä¸€æ¬¡é”ç»­æœŸï¼Œä¹Ÿå°±æ˜¯æ¯10sè¿›è¡Œä¸€æ¬¡ç»­æœŸã€‚</p><ul><li><p>è¿™é‡Œä¹Ÿä¼šä»<strong>EXPIRATION_RENEWAL_MAP</strong>é‡Œè·å–ä¸€ä¸ªå€¼ï¼Œæ£€æŸ¥é”æ˜¯å¦è¢«é‡Šæ”¾ã€‚</p></li><li><p><strong>å¦‚æœä¸ä¸ºnullï¼Œåˆ™è·å–ç¬¬ä¸€ä¸ªthreadï¼ˆä¹Ÿå°±æ˜¯æŒæœ‰é”çš„çº¿ç¨‹ï¼‰ï¼Œå¦‚æœä¸ºnullåˆ™è¯´æ˜é”ä¹Ÿè¢«é‡Šæ”¾äº†ï¼Œæ­¤æ—¶ä¹Ÿä¸éœ€è¦ç»­æœŸã€‚</strong></p></li><li><p>å¦‚æœä¸ä¸ºnullï¼Œè¯´æ˜éœ€è¦ç»­æœŸï¼Œå®ƒä¼šå¼‚æ­¥è°ƒç”¨<strong>renewExpirationAsync(threadId)æ–¹æ³•</strong>æ¥å®ç°ç»­æœŸã€‚</p></li><li><p>å½“å¼‚æ­¥ç»­æœŸæ“ä½œå®Œæˆï¼Œä¼šè°ƒç”¨whenCompleteæ–¹æ³•æ¥å¤„ç†ç»“æœï¼Œå¦‚æœæœ‰å¼‚å¸¸ï¼Œåˆ™å°†è¯¥é”ä»<strong>EXPIRATION_RENEWAL_MAP</strong>ä¸­ç§»é™¤ã€‚å¦‚æœç»­æœŸæˆåŠŸï¼Œåˆ™ä¼šé‡æ–°è°ƒç”¨<strong>renewExpiration()æ–¹æ³•</strong>è¿›è¡Œä¸‹ä¸€æ¬¡ç»­æœŸï¼Œå¦‚æœç»­æœŸå¤±è´¥ï¼Œåˆ™è°ƒç”¨<strong>cancelExpirationRenewal()æ–¹æ³•</strong>å–æ¶ˆç»­æœŸã€‚</p></li></ul></li></ul></blockquote><h4 id="2-4-3-renewExpirationAsync-â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬-1"><a href="#2-4-3-renewExpirationAsync-â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬-1" class="headerlink" title="2.4.3 renewExpirationAsync()â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬"></a>2.4.3 renewExpirationAsync()â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/2bc37246d829ed6149898214984c7ab2.png"></p><blockquote><ul><li><strong>å¦‚æœå½“å‰keyå­˜åœ¨ï¼Œè¯´æ˜å½“å‰é”è¿˜è¢«è¯¥çº¿ç¨‹æŒæœ‰ï¼Œé‚£ä¹ˆå°±é‡ç½®è¿‡æœŸæ—¶é—´ä¸º30sï¼Œå¹¶è¿”å›trueï¼Œè¡¨ç¤ºç»­æœŸæˆåŠŸï¼Œåä¹‹è¿”å›falseã€‚</strong></li></ul></blockquote><h4 id="2-4-4-cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ-1"><a href="#2-4-4-cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ-1" class="headerlink" title="2.4.4 cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ"></a>2.4.4 cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/70dd77797eb7311864199dbdc59537b6.png"></p><blockquote><ul><li>è¿˜æ˜¯ä»è¿™ä¸ªmapé‡Œè·å–é”®å€¼å¯¹ï¼Œå¦‚æœä¸ºnullï¼Œè¯´æ˜ç»­æœŸä»»åŠ¡ä¸å­˜åœ¨ï¼Œä¹Ÿæ²¡å¿…è¦è¿›è¡Œä¸‹å»äº†ï¼Œç›´æ¥è¿”å›ã€‚</li><li>å¦‚æœthreadIdä¸ä¸ºnullï¼Œç›´æ¥å°†è¿™ä¸ªç»­æœŸä»»åŠ¡ä»taské‡Œç§»é™¤ã€‚</li><li>å¦‚æœthreadIdä¸ºnullæˆ–è€…taskä¸­ä¸å†æœ‰ä»»ä½•çº¿ç¨‹åœ¨ç­‰å¾…ç»­æœŸï¼Œæ­¤æ—¶å°±è°ƒç”¨cancelæ–¹æ³•æ¥å–æ¶ˆå®šæ—¶ä»»åŠ¡ï¼Œç„¶ååœ¨ä»<strong>EXPIRATION_RENEWAL_MAP</strong>ä¸­ç§»é™¤è¯¥ç»­æœŸä»»åŠ¡ã€‚</li></ul></blockquote><p><strong>psï¼šå½“unlockçš„æ—¶å€™ä¹Ÿä¼šè°ƒè¯¥æ–¹æ³•ï¼Œæ¥æ‰§è¡Œå–æ¶ˆé”ç»­æœŸçš„æ“ä½œã€‚</strong></p><h3 id="2-5-å°ç»“-1"><a href="#2-5-å°ç»“-1" class="headerlink" title="2.5 å°ç»“"></a>2.5 å°ç»“</h3><h4 id="2-5-1-ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ-1"><a href="#2-5-1-ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ-1" class="headerlink" title="2.5.1 ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ"></a>2.5.1 ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ</h4><blockquote><p>åŠ é”æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œåˆ™é»˜è®¤è¿‡æœŸæ—¶é—´ä¸º30sä¸”æ¯éš”10sè¿›è¡Œé”ç»­æœŸæ“ä½œã€‚</p><p><strong>psï¼šå‚è€ƒ2.3.2å’Œ2.4.2å°èŠ‚ã€‚</strong></p></blockquote><h4 id="2-5-2-ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ-1"><a href="#2-5-2-ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ-1" class="headerlink" title="2.5.2 ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ"></a>2.5.2 ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ</h4><blockquote><ul><li><p>é”è¢«é‡Šæ”¾ã€‚</p></li><li><p>ç»­æœŸæ—¶å‘ç”Ÿå¼‚å¸¸ã€‚</p></li><li><p>æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬å¤±è´¥ã€‚</p></li><li><p>Redissionçš„ç»­æœŸæ—¶Nettyæ—¶é—´è½®ï¼ˆTimerTaskã€TimeOutã€Timerï¼‰çš„ï¼Œå¹¶ä¸”æ“ä½œéƒ½æ˜¯åŸºäºJVMï¼Œæ‰€ä»¥å½“åº”ç”¨å®•æœºã€ä¸‹çº¿æˆ–é‡å¯åï¼Œç»­æœŸä»»åŠ¡ä¹Ÿæ²¡æœ‰äº†ã€‚</p></li></ul><p><strong>psï¼šå‚è€ƒ2.4.3å°èŠ‚ã€‚</strong></p></blockquote><h3 id="2-6-lock-å’Œtrylock-çš„åŒºåˆ«-1"><a href="#2-6-lock-å’Œtrylock-çš„åŒºåˆ«-1" class="headerlink" title="2.6 lock()å’Œtrylock()çš„åŒºåˆ«"></a>2.6 lock()å’Œtrylock()çš„åŒºåˆ«</h3><p>è®²äº†åŠå¤©å¿˜äº†è¯´ä½¿ç”¨redissionå®ç°åˆ†å¸ƒå¼é”çš„ç¤ºä¾‹äº†ğŸ˜‚ï¼Œç´¢æ€§å°±åœ¨è¿™è¡¥å……ä¸€ä¸‹å§ã€‚</p><p><strong>lock()ï¼š</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">RLock lock = redisson.getLock(<span class="hljs-string">&quot;MyLock&quot;</span>);lock.lock();<span class="hljs-regexp">//</span>é˜»å¡æ–¹æ³•ï¼ŒçŸ¥é“è·å–åˆ°é”try &#123; Â  Â <span class="hljs-regexp">//</span>ä¸šåŠ¡ä»£ç &#125;finally &#123; Â  Â <span class="hljs-regexp">//</span>å½“å‰é”å­˜åœ¨ä¸”è¢«å½“å‰çº¿ç¨‹æŒæœ‰ Â  Â  <span class="hljs-keyword">if</span>(lock.isLocked() &amp;&amp; lock.isHeldByCurrentThread())&#123; Â  Â  Â <span class="hljs-regexp">//</span>é‡Šæ”¾é” Â  Â  Â lock.unlock(); Â  &#125;&#125;<br></code></pre></td></tr></table></figure><blockquote><p>lockçš„åŸç†æ˜¯ä»¥é˜»å¡çš„æ–¹å¼è·å–é”ï¼Œå¦‚æœè·å–å¤±è´¥åˆ™ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å–æˆåŠŸã€‚</p><p><strong>psï¼šå¯ä»¥å‚è€ƒ2.3.1å°èŠ‚ã€‚</strong></p></blockquote><p><strong>trylock()ï¼š</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">RLock lock = redisson.getLock(<span class="hljs-string">&quot;MyLock&quot;</span>);boolean b = lock.tryLock();<span class="hljs-regexp">//</span>éé˜»å¡æ–¹æ³•ï¼Œç«‹å³è¿”å›è·å–ç»“æœ<span class="hljs-keyword">if</span>(b)&#123; Â  Â  try &#123; Â  Â  Â  Â  Â <span class="hljs-regexp">//</span>ä¸šåŠ¡ä»£ç  Â  Â  &#125;finally &#123; Â  Â  Â  Â  Â <span class="hljs-regexp">//</span>å½“å‰é”å­˜åœ¨ä¸”è¢«å½“å‰çº¿ç¨‹æŒæœ‰ Â  Â  Â  Â  Â <span class="hljs-keyword">if</span>(lock.isLocked() &amp;&amp; lock.isHeldByCurrentThread())&#123; Â  Â  Â  Â  Â  Â  Â  <span class="hljs-regexp">//</span>é‡Šæ”¾é” Â  Â  Â  Â  Â  Â  Â  lock.unlock(); Â  Â  Â  Â  Â  &#125; Â  Â  &#125;&#125;<span class="hljs-keyword">else</span> &#123; Â  <span class="hljs-regexp">//</span>è·å–é”å¤±è´¥ï¼Œå¤„ç†é€»è¾‘&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/1c9d3a00e609d59fa4984a1f606e3953.png"></p><blockquote><p>tryLockæ˜¯å°è¯•è·å–é”ï¼Œå¦‚æœèƒ½è·å–ç›´æ¥è¿”å›trueï¼Œå¦‚æœæ— æ³•è·å–ï¼Œå®ƒä¼šæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„è¶…æ—¶æ—¶é—´è¿›è¡Œé˜»å¡ï¼Œ<strong>è¿™ä¸ªæ—¶é—´å†…è¿˜ä¼šå°è¯•è·å–é”ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æ²¡è·å–åˆ°ï¼Œç›´æ¥è¿”å›falseã€‚</strong>å¦‚æœæ²¡æœ‰æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œå°±å¦‚æˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œé‚£è·å–ä¸åˆ°çš„è¯ç›´æ¥å°±è¿”å›falseã€‚</p></blockquote><p><strong>æˆ‘ä»¬çœ‹ä¸‹æºç ï¼š</strong></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/5bf0550041bf17578d7a01ed660437db.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/f9968619e85e7c4660cc7331cb48315d.png"></p><p><strong>è¿™æ˜¯æ²¡æœ‰æŒ‡å®šè¶…æ—¶æ—¶é—´æ‰§è¡Œçš„æ–¹æ³•ï¼Œæ–¹æ³•åä¹Ÿå¾ˆè§åçŸ¥æ„ï¼Œå°±æ˜¯å°è¯•ä¸€æ¬¡åŠ é”ã€‚æŒ‡å®šäº†è¶…æ—¶æ—¶é—´çš„è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œæ— éæ˜¯åœ¨è¶…æ—¶æ—¶é—´å†…æ‰§è¡Œwhileå¾ªç¯å°è¯•è·å–é”ã€‚</strong></p><h2 id="ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨-1"><a href="#ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨-1" class="headerlink" title="ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨"></a>ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨</h2><p><strong>psï¼šè¿™å‡ ç§é”éƒ½ä¸å¸¸ç”¨ï¼Œæ‰€ä»¥å°±ä¸ç»†è®²äº†ï¼ŒçŸ¥é“æœ‰è¿™ä¸ªäº‹å°±è¡Œã€‚</strong></p><h3 id="3-1-å…¬å¹³é”ï¼ˆFairLockï¼‰-1"><a href="#3-1-å…¬å¹³é”ï¼ˆFairLockï¼‰-1" class="headerlink" title="3.1 å…¬å¹³é”ï¼ˆFairLockï¼‰"></a>3.1 å…¬å¹³é”ï¼ˆFairLockï¼‰</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">RLock <span class="hljs-keyword">lock</span> = redisson.getFairLock(<span class="hljs-string">&quot;MyLock&quot;</span>);<span class="hljs-keyword">lock</span>.<span class="hljs-keyword">lock</span>();<br></code></pre></td></tr></table></figure><h3 id="3-2-è”é”ï¼ˆMultiLockï¼‰-1"><a href="#3-2-è”é”ï¼ˆMultiLockï¼‰-1" class="headerlink" title="3.2 è”é”ï¼ˆMultiLockï¼‰"></a>3.2 è”é”ï¼ˆMultiLockï¼‰</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">RLock lock1 = redisson.get<span class="hljs-constructor">Lock(<span class="hljs-string">&quot;MyLock1&quot;</span>)</span>;RLock lock2 = redisson.get<span class="hljs-constructor">Lock(<span class="hljs-string">&quot;MyLock2&quot;</span>)</span>;RLock lock3 = redisson.get<span class="hljs-constructor">Lock(<span class="hljs-string">&quot;MyLock3&quot;</span>)</span>;RedissonMultiLock lock=<span class="hljs-keyword">new</span> <span class="hljs-constructor">RedissonMultiLock(<span class="hljs-params">lock1</span>,<span class="hljs-params">lock2</span>,<span class="hljs-params">lock3</span>)</span>;<span class="hljs-comment">//åŒæ—¶åŠ é”lock1ã€lock2ã€lock3//æ‰€æœ‰çš„é”éƒ½ä¸Šé”æˆåŠŸæ‰ç®—æˆåŠŸlock.lock(); //...lock.unlock();</span><br></code></pre></td></tr></table></figure><h3 id="3-3-è¯»å†™é”-1"><a href="#3-3-è¯»å†™é”-1" class="headerlink" title="3.3 è¯»å†™é”"></a>3.3 è¯»å†™é”</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">RReadWriteLock <span class="hljs-keyword">lock</span> = redisson.getReadWriteLock(&quot;myLock&quot;);//è¯»é”<span class="hljs-keyword">lock</span>.readLock().<span class="hljs-keyword">lock</span>();//å†™é”<span class="hljs-keyword">lock</span>.writeLock().<span class="hljs-keyword">lock</span>();<br></code></pre></td></tr></table></figure><p><strong>psï¼šè¿˜æœ‰ä¸ªRedLockï¼Œè¿™ä¸ªå¯ä»¥ç»†è®²ä¸€ä¸‹ï¼Œä½†æ˜¯ç”±äºç¯‡å¹…åŸå› ï¼Œå°±æ”¾åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å§ã€‚</strong></p><h2 id="å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜-1"><a href="#å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜-1" class="headerlink" title="å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜"></a>å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜</h2><p>Redissionä½¿ç”¨çœ‹é—¨ç‹—ç»­æœŸçš„æ–¹æ¡ˆåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹æ˜¯æŒºä¸é”™çš„ï¼Œä½†åœ¨æç«¯æƒ…å†µä¸‹è¿˜æ˜¯ä¼šå­˜åœ¨é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><blockquote><ul><li>çº¿ç¨‹1é¦–å…ˆè·å–é”æˆåŠŸï¼Œå°†é”®å€¼å¯¹å†™å…¥redisçš„masterèŠ‚ç‚¹ã€‚</li><li><strong>åœ¨rediså°†masteræ•°æ®åŒæ­¥åˆ°slaveèŠ‚ç‚¹ä¹‹å‰ï¼Œmasteræ•…éšœäº†ã€‚</strong></li><li>æ­¤æ—¶ä¼šè§¦å‘æ•…éšœè½¬ç§»ï¼Œå°†å…¶ä¸­ä¸€ä¸ªslaveå‡çº§ä¸ºmasterã€‚</li><li>ä½†æ–°çš„masterå¹¶æ²¡æœ‰çº¿ç¨‹1å†™å…¥çš„é”®å€¼å¯¹ï¼Œå› æ­¤å¦‚æœæ­¤æ—¶æ¥ä¸ªçº¿ç¨‹2ï¼Œä¹ŸåŒæ ·å¯ä»¥è·å–åˆ°é”ï¼Œè¿™å°±è¿èƒŒäº†é”çš„åˆè¡·ã€‚</li></ul></blockquote><p>è¿™ä¸ªåœºæ™¯å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<a href="https://blog.csdn.net/weixin_45433817/article/details/137209295?spm=1001.2014.3001.5501" title="é›†ç¾¤è„‘è£‚">é›†ç¾¤è„‘è£‚</a><strong>ï¼ˆç½‘ç»œåˆ†åŒºï¼‰</strong>é—®é¢˜ã€‚</p><p>é‚£ä¹ˆæ¯”è¾ƒä¸»æµçš„è§£å†³æ–¹æ¡ˆå°±æ˜¯<strong>Redisä½œè€…æå‡ºçš„Redlock</strong>å’Œ<strong>Zookeeper</strong>å®ç°çš„åˆ†å¸ƒå¼é”ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸‹èŠ‚å†è®²ã€‚</p><p><strong>Endï¼šå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æœæœ‰çº°æ¼æˆ–è€…æ›´å¥½çš„æƒ³æ³•ï¼Œè¯·æ‚¨ä¸€å®šä¸è¦åå•¬ä½ çš„èµæ•™ğŸ™‹ã€‚</strong>åœ¨<a href="https://so.csdn.net/so/search?q=%E5%A4%9A%E7%BA%BF%E7%A8%8B&spm=1001.2101.3001.7020">å¤šçº¿ç¨‹</a>ç¯å¢ƒä¸‹ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨åŠ é”çš„æ–¹å¼ï¼Œä½¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¯¹è¿™ä¸ªå…±äº«èµ„æºè¿›è¡Œæ“ä½œï¼Œ<strong>åœ¨å•æœåŠ¡ç³»ç»Ÿæˆ‘ä»¬å¸¸ç”¨JVMé”â€”â€”<a href="https://blog.csdn.net/weixin_45433817/article/details/132216383" title="Synchronizedã€ReentrantLockç­‰">Synchronizedã€ReentrantLockç­‰</a>ã€‚ç„¶è€Œåœ¨å¤šå°æœåŠ¡ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼ŒJVMé”å°±æ— æ³•åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´ç”Ÿæ•ˆäº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</strong></p><p>åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¸»æµçš„å°±æ˜¯åŸºäº<strong>æ•°æ®åº“ã€zookeeperä»¥åŠredis</strong>ï¼Œå½“ç„¶ä½¿ç”¨redisçš„å±…å¤šï¼Œç”±äºç¯‡å¹…åŸå› ï¼Œæœ¬èŠ‚å°±è¯¦ç»†ä»‹ç»ä¸€ä¸‹ä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”çš„å‡ ç§æ–¹å¼ã€‚</p><h2 id="ä¸€ã€SETNXå®ç°-2"><a href="#ä¸€ã€SETNXå®ç°-2" class="headerlink" title="ä¸€ã€SETNXå®ç°"></a>ä¸€ã€SETNXå®ç°</h2><p><strong>psï¼šæœ¬æ–‡é‡ç‚¹ä½¿Redissonå®ç°åˆ†å¸ƒå¼é”ï¼Œå’±å°±ä¸ä»SETNX+EXPIREã€SETNX+LUAè„šæœ¬â€¦ä»€ä¹ˆçš„é€æ­¥æ¼”è¿›äº†ï¼Œæœ¬èº«å°±æ˜¯ä¸€å›äº‹ï¼Œç›´æ¥ä¸€æ­¥åˆ°ä½ï¼Œç”¨set ex px nx+å”¯ä¸€æ ¡éªŒ+LUAè„šæœ¬åˆ é™¤ç­‰æ“ä½œå®ç°ã€‚</strong></p><p>åˆ©ç”¨<strong>Redisçš„å•çº¿ç¨‹</strong>ç‰¹æ€§ï¼Œåœ¨å¤šä¸ªRediså®¢æˆ·ç«¯é€šè¿‡SETNXï¼Œå¦‚æœè¿”å›1è¡¨ç¤ºè·å–é”æˆåŠŸï¼Œåä¹‹å¤±è´¥ã€‚å› ä¸ºRedisçš„å•çº¿ç¨‹æœºåˆ¶ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯ä¸€ä¸ªå®¢æˆ·ç«¯æˆåŠŸè·å–åï¼Œå…¶å®ƒå®¢æˆ·ç«¯éƒ½ä¼šè·å–å¤±è´¥ã€‚ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">public class RedisLock &#123; Â  Â private Jedis jedis; Â  Â private void init()&#123; Â  Â  Â  Â //å»ºç«‹è¿æ¥ Â  Â  Â  Â jedis = JedisPoolFactory.getJedis(); Â   &#125; Â  Â /** Â  Â  * è·å–é” Â  Â  * @param lockKey é”çš„é”®å€¼ Â  Â  * @param requestId å”¯ä¸€æ ‡è¯† Â  Â  * @param expireTime è¿‡æœŸæ—¶é—´ Â  Â  * @<span class="hljs-keyword">return</span> æ˜¯å¦è·å–é” æˆåŠŸè¿”å›<span class="hljs-keyword">true</span>ï¼Œåä¹‹<span class="hljs-keyword">false</span> Â  Â  */ Â  Â public boolean tryLock(<span class="hljs-keyword">String</span> lockKey,<span class="hljs-keyword">String</span> requestId,int expireTime)&#123; Â  Â  Â  Â //<span class="hljs-number">2</span>ã€åŠ é” Â  Â  Â  Â <span class="hljs-keyword">String</span> result = jedis.<span class="hljs-keyword">set</span>(lockKey,requestId,<span class="hljs-string">&quot;NX&quot;</span>,<span class="hljs-string">&quot;EX&quot;</span>,expireTime);â€‹ Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;OK&quot;</span>.equals(result); Â   &#125;â€‹ Â  Â /** Â  Â  * é‡Šæ”¾é” Â  Â  * @param lockKey é”çš„é”®å€¼ Â  Â  * @param requestId å”¯ä¸€æ ‡è¯† Â  Â  * @<span class="hljs-keyword">return</span> æˆåŠŸ<span class="hljs-keyword">true</span>ï¼Œå¤±è´¥<span class="hljs-keyword">false</span> Â  Â  */ Â  Â public boolean unlock(<span class="hljs-keyword">String</span> lockKey,<span class="hljs-keyword">String</span> requestId)&#123; Â  Â  Â  Â //LUAè„šæœ¬ï¼šåˆ¤æ–­å½“å‰é”çš„å€¼æ˜¯å¦ç­‰äºè¯·æ±‚æ ‡è¯†requestIdï¼Œå¦‚æœæ˜¯åˆ™åˆ é™¤é”å¹¶è¿”å›<span class="hljs-keyword">true</span>ï¼Œåä¹‹è¿”å›<span class="hljs-keyword">false</span>ã€‚ Â  Â  Â  Â <span class="hljs-keyword">String</span> scripts = <span class="hljs-string">&quot;if redis.call(&#x27;get&#x27;,KEYS[1]) == ARGV[1] then &quot;</span> + Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-string">&quot;return redis.call(&#x27;del&#x27;,KEYS[1]) else return 0 end&quot;</span>; Â  Â  Â  Â Object result = jedis.eval(scripts, Collections.singletonList(lockKey), Collections.singletonList(requestId)); Â  Â  Â  Â <span class="hljs-keyword">return</span> Long.parseLong(result.toString())==<span class="hljs-number">1</span>L; Â   &#125;&#125;<br></code></pre></td></tr></table></figure><p><strong>å­˜åœ¨çš„é—®é¢˜ï¼š</strong></p><blockquote><ul><li><strong>é”æ— æ³•ç»­æœŸï¼š</strong>å‡è®¾çº¿ç¨‹Aè·å–äº†é”ï¼Œä½†æ˜¯ç”±äºç½‘ç»œåŸå› ï¼Œæ‰§è¡Œæ—¶é—´è¶…è¿‡äº†è®¾ç½®çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ˜¯é”è¢«é‡Šæ”¾äº†ï¼Œçº¿ç¨‹Bè·å–é”æˆåŠŸï¼Œæ­¤æ—¶çº¿ç¨‹Aå’ŒBéƒ½ä¼šæ‰§è¡Œä¸´ç•ŒåŒºçš„ä»£ç ï¼Œè¿™æ˜¯ç»å¯¹ä¸å…è®¸çš„ã€‚</li></ul></blockquote><h2 id="äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”-2"><a href="#äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”-2" class="headerlink" title="äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”"></a>äºŒã€Redissonå®ç°åˆ†å¸ƒå¼é”</h2><p>åœ¨ä½¿ç”¨SETNXå®ç°çš„åˆ†å¸ƒå¼é”ä¸­ï¼Œå­˜åœ¨é”æ— æ³•ç»­æœŸå¯¼è‡´å¹¶å‘å†²çªçš„é—®é¢˜ã€‚ä¸è¿‡è¿™ä¸ªé—®é¢˜åœ¨Redissonä¸­ç”¨çœ‹é—¨ç‹—çš„æœºåˆ¶å·§å¦™åœ°è§£å†³äº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å®ç°åˆ†å¸ƒå¼é”æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚</p><h3 id="2-1-æ•´ä½“ç±»å›¾-2"><a href="#2-1-æ•´ä½“ç±»å›¾-2" class="headerlink" title="2.1 æ•´ä½“ç±»å›¾"></a>2.1 æ•´ä½“ç±»å›¾</h3><p><img src="https://i-blog.csdnimg.cn/blog_migrate/2163205be5f25e23897ced4a05a14cb9.png"></p><p>æ ‡é»„çš„ä¸¤ä¸ªç±»å°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„é‡ç‚¹ï¼Œçœ‹é—¨ç‹—ç»­æœŸçš„å®ç°é€»è¾‘åœ¨<strong>RedissionBaseLockç±»</strong>ä¸­ï¼ŒåŠ é”é€»è¾‘åœ¨<strong>RedissionLockç±»</strong>ä¸­ã€‚</p><h3 id="2-2-å¤§è‡´æµç¨‹-2"><a href="#2-2-å¤§è‡´æµç¨‹-2" class="headerlink" title="2.2 å¤§è‡´æµç¨‹"></a>2.2 å¤§è‡´æµç¨‹</h3><p>åœ¨æ·±å…¥ä»£ç å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹åŠ é”ã€çœ‹é—¨ç‹—ç»­æœŸå¤§è‡´çš„æµç¨‹ï¼Œæœ‰ä¸ªå¤§è‡´å°è±¡ã€‚</p><p><img src="https://i-blog.csdnimg.cn/direct/47e9d6b55dd9448d8fe54d097e8bfbd3.png"></p><h3 id="2-3-åŠ é”æµç¨‹æºç åˆ†æ-2"><a href="#2-3-åŠ é”æµç¨‹æºç åˆ†æ-2" class="headerlink" title="2.3 åŠ é”æµç¨‹æºç åˆ†æ"></a>2.3 åŠ é”æµç¨‹æºç åˆ†æ</h3><p>ä¸‹é¢æˆ‘ä»¬å°±æŒ‰ä¸Šé¢çš„æµç¨‹å›¾ï¼Œèµ°èµ°æºç ã€‚</p><h4 id="2-3-1-lock-â€”åŠ é”å…¥å£-2"><a href="#2-3-1-lock-â€”åŠ é”å…¥å£-2" class="headerlink" title="2.3.1 lock()â€”åŠ é”å…¥å£"></a>2.3.1 lock()â€”åŠ é”å…¥å£</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/5c90322cb4a159b87fd04aca1081c2e2.png"></p><ul><li>lockæ–¹æ³•ï¼Œä¸€ä¸ªæ²¡è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¸€ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´ã€‚</li></ul><p><img src="https://i-blog.csdnimg.cn/blog_migrate/096f1c9bba501ea1e6b22b942c56c93f.png"></p><p>è§£æï¼š</p><blockquote><ul><li>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šå°è¯•åŠ é”ï¼Œä¼šè¿”å›nullæˆ–è€…å…·ä½“çš„å€¼ï¼Œ<strong>è¿”å›nullè¡¨ç¤ºåŠ é”æˆåŠŸï¼Œåä¹‹æœ‰çº¿ç¨‹æŒæœ‰è¯¥é”ï¼ŒåŠ é”å¤±è´¥ã€‚</strong></li><li>ç¬¬äºŒä¸ªçº¢æ¡†ï¼š<strong>åŠ é”å¤±è´¥ï¼Œwhileå¾ªç¯ä¸æ–­å°è¯•ã€‚</strong></li></ul></blockquote><h4 id="2-3-2-tryAcquire-â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ-2"><a href="#2-3-2-tryAcquire-â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ-2" class="headerlink" title="2.3.2 tryAcquire()â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ"></a>2.3.2 tryAcquire()â€”æ‰§è¡ŒåŠ é”LUAè„šæœ¬å¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œé”ç»­æœŸ</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/17e3ff2ffae885cde2e3349b11819e08.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/8ab1b8816bdb35dc5cd7918ee3e682dc.png"></p><blockquote><ul><li><p>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šæ‰§è¡ŒåŠ é”LUAè„šæœ¬ï¼Œè¿”å›nullè¯´æ˜åŠ é”æˆåŠŸï¼Œåä¹‹å¤±è´¥ã€‚</p><ul><li><p><strong>å¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±ä¼ è®¾ç½®çš„æ—¶é—´ã€‚</strong></p></li><li><p>åä¹‹ï¼Œä½¿ç”¨é»˜è®¤çš„<strong>internallockLeaseTime</strong>æ—¶é—´ã€‚</p></li></ul></li><li><p>ç¬¬äºŒä¸ªçº¢æ¡†ï¼šå¦‚æœåŠ é”æˆåŠŸï¼ˆnullï¼‰ï¼Œä¸”è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå°†è®¾ç½®è¿‡æœŸæ—¶é—´èµ‹å€¼ç»™internallockLeaseTimeï¼Œå¦‚æœæ²¡è®¾ç½®ï¼Œåˆ™æ‰§è¡Œ<strong>scheduleExpirationRenewalæ–¹æ³•ï¼ˆçœ‹é—¨ç‹—ï¼‰ã€‚</strong>è¿”å›ç»“æœã€‚</p></li></ul></blockquote><p><strong>psï¼šinternallockLeaseTimeé»˜è®¤å°±æ˜¯30sã€‚</strong></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/3776045e441c2b913a359ec9fbe4266d.png"><img src="https://i-blog.csdnimg.cn/blog_migrate/a0950ff3af7e06b77e31416b71c66999.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/04323d9885389ecb586ed19b62ac751c.png"></p><h4 id="2-3-3-tryLockInnerAsync-â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬-2"><a href="#2-3-3-tryLockInnerAsync-â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬-2" class="headerlink" title="2.3.3 tryLockInnerAsync()â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬"></a>2.3.3 tryLockInnerAsync()â€”â€“é€‰æ‹©slotæ§½å¹¶æ‰§è¡Œluaè„šæœ¬</h4><p>æˆ‘ä»¬å…ˆçœ‹å¦‚ä½•æ‰§è¡ŒLUAåŠ é”è„šæœ¬çš„ï¼Œè¿™é‡Œé¢æœ‰ç‚¹æ·±ã€‚ã€‚ã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/16032194b6c649b468f75692ef55f6b4.png">Â <img src="https://i-blog.csdnimg.cn/blog_migrate/3aac08c39e8ead75464cc1c9aeb18fe7.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/cff71f24ba3ea06fa99bc94dc294f563.png"></p><p><strong>slotæ§½è¿™é‡Œå°±ä¸å¤šè®²äº†ã€‚ã€‚ã€‚æˆ‘ä»¬å›åˆ°LUAè„šæœ¬ã€‚</strong></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/aaa3bc287881377ff5ecdf9d7b7c1fdd.png"></p><blockquote><ul><li><strong>é¦–å…ˆæ£€æŸ¥é”çš„keyæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€çº¿ç¨‹å†æ¬¡è¿‡æ¥å¯¹åŒä¸€ä¸ªkeyè¿›è¡ŒåŠ é”ï¼Œä¹Ÿå°±æ˜¯å½“å‰keyæ˜¯å¦è¢«å½“å‰çº¿ç¨‹æŒæœ‰ï¼ˆå¯é‡å…¥æ€§ï¼‰ã€‚</strong></li><li>å¦‚æœä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ä»»æ„ä¸€ä¸ªæˆç«‹ï¼Œåˆ™å¯¹å½“å‰keyæ‰§è¡Œè‡ªå¢å’Œè®¾ç½®è¿‡æœŸæ—¶é—´æ“ä½œï¼Œå¹¶<strong>è¿”å›nullè¡¨ç¤ºåŠ é”æˆåŠŸã€‚</strong></li><li><strong>åä¹‹ï¼Œè¿”å›å½“å‰é”çš„è¿‡æœŸæ—¶é—´ï¼Œè¡¨ç¤ºåŠ é”å¤±è´¥ã€‚</strong></li></ul></blockquote><h3 id="2-4-watch-dogæºç åˆ†æ-2"><a href="#2-4-watch-dogæºç åˆ†æ-2" class="headerlink" title="2.4 watch dogæºç åˆ†æ"></a>2.4 watch dogæºç åˆ†æ</h3><h4 id="2-4-1-scheduleExpirationRenewal-â€“é”ç»­æœŸå…¥å£-2"><a href="#2-4-1-scheduleExpirationRenewal-â€“é”ç»­æœŸå…¥å£-2" class="headerlink" title="2.4.1 scheduleExpirationRenewal()â€“é”ç»­æœŸå…¥å£"></a>2.4.1 scheduleExpirationRenewal()â€“é”ç»­æœŸå…¥å£</h4><p>å½“åŠ é”æˆåŠŸï¼Œä¸”æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰§è¡Œ<strong>scheduleExpirationRenewal()æ–¹æ³•</strong>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„â€çœ‹é—¨ç‹—â€çš„å®ç°é€»è¾‘ã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/708d64a8687a87050b20fe1e5e88a36e.png"></p><blockquote><ul><li>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šEXPIRATION_RENEWAL_MAPå­˜æ”¾ç»­æœŸä»»åŠ¡ï¼Œgetæœ‰å€¼è¯´æ˜å½“å‰é”éœ€è¦ç»­æœŸï¼Œä¸ºnullåˆ™ä¸éœ€è¦å†ç»­æœŸäº†ã€‚</li><li>ç¬¬äºŒä¸ªçº¢æ¡†ï¼Œæ‰§è¡Œç»­æœŸæ“ä½œã€‚</li></ul></blockquote><h4 id="2-4-2-renewExpiration-â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ-2"><a href="#2-4-2-renewExpiration-â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ-2" class="headerlink" title="2.4.2 renewExpiration()â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ"></a>2.4.2 renewExpiration()â€”-æ‰§è¡Œé”ç»­æœŸæ“ä½œ</h4><p>è¿™ä¸ªæ–¹æ³•ç”¨<strong>nettyçš„æ—¶é—´è½®</strong>è¿›è¡Œç»­æœŸã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/50ed4ade0574c203c1e118abc1920cfd.png"></p><blockquote><ul><li><p>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šé¦–å…ˆä¼šä»<strong>EXPIRATION_RENEWAL_MAP</strong>ä¸­è·å–ä¸€ä¸ªå€¼ï¼Œå¦‚æœä¸ºnullï¼Œå°±ä¸ç»­æœŸäº†ï¼Œ<strong>è¯´æ˜è¿™ä¸ªé”å¯èƒ½å·²ç»è¢«é‡Šæ”¾æˆ–è¿‡æœŸäº†ã€‚</strong></p></li><li><p>ç¬¬äºŒä¸ªçº¢æ¡†ï¼šåŸºäºTimerTaskå®ç°ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œè®¾ç½®<strong>internalLockLeaseTime &#x2F; 3</strong>çš„æ—¶é•¿è¿›è¡Œä¸€æ¬¡é”ç»­æœŸï¼Œä¹Ÿå°±æ˜¯æ¯10sè¿›è¡Œä¸€æ¬¡ç»­æœŸã€‚</p><ul><li><p>è¿™é‡Œä¹Ÿä¼šä»<strong>EXPIRATION_RENEWAL_MAP</strong>é‡Œè·å–ä¸€ä¸ªå€¼ï¼Œæ£€æŸ¥é”æ˜¯å¦è¢«é‡Šæ”¾ã€‚</p></li><li><p><strong>å¦‚æœä¸ä¸ºnullï¼Œåˆ™è·å–ç¬¬ä¸€ä¸ªthreadï¼ˆä¹Ÿå°±æ˜¯æŒæœ‰é”çš„çº¿ç¨‹ï¼‰ï¼Œå¦‚æœä¸ºnullåˆ™è¯´æ˜é”ä¹Ÿè¢«é‡Šæ”¾äº†ï¼Œæ­¤æ—¶ä¹Ÿä¸éœ€è¦ç»­æœŸã€‚</strong></p></li><li><p>å¦‚æœä¸ä¸ºnullï¼Œè¯´æ˜éœ€è¦ç»­æœŸï¼Œå®ƒä¼šå¼‚æ­¥è°ƒç”¨<strong>renewExpirationAsync(threadId)æ–¹æ³•</strong>æ¥å®ç°ç»­æœŸã€‚</p></li><li><p>å½“å¼‚æ­¥ç»­æœŸæ“ä½œå®Œæˆï¼Œä¼šè°ƒç”¨whenCompleteæ–¹æ³•æ¥å¤„ç†ç»“æœï¼Œå¦‚æœæœ‰å¼‚å¸¸ï¼Œåˆ™å°†è¯¥é”ä»<strong>EXPIRATION_RENEWAL_MAP</strong>ä¸­ç§»é™¤ã€‚å¦‚æœç»­æœŸæˆåŠŸï¼Œåˆ™ä¼šé‡æ–°è°ƒç”¨<strong>renewExpiration()æ–¹æ³•</strong>è¿›è¡Œä¸‹ä¸€æ¬¡ç»­æœŸï¼Œå¦‚æœç»­æœŸå¤±è´¥ï¼Œåˆ™è°ƒç”¨<strong>cancelExpirationRenewal()æ–¹æ³•</strong>å–æ¶ˆç»­æœŸã€‚</p></li></ul></li></ul></blockquote><h4 id="2-4-3-renewExpirationAsync-â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬-2"><a href="#2-4-3-renewExpirationAsync-â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬-2" class="headerlink" title="2.4.3 renewExpirationAsync()â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬"></a>2.4.3 renewExpirationAsync()â€“æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/2bc37246d829ed6149898214984c7ab2.png"></p><blockquote><ul><li><strong>å¦‚æœå½“å‰keyå­˜åœ¨ï¼Œè¯´æ˜å½“å‰é”è¿˜è¢«è¯¥çº¿ç¨‹æŒæœ‰ï¼Œé‚£ä¹ˆå°±é‡ç½®è¿‡æœŸæ—¶é—´ä¸º30sï¼Œå¹¶è¿”å›trueï¼Œè¡¨ç¤ºç»­æœŸæˆåŠŸï¼Œåä¹‹è¿”å›falseã€‚</strong></li></ul></blockquote><h4 id="2-4-4-cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ-2"><a href="#2-4-4-cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ-2" class="headerlink" title="2.4.4 cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ"></a>2.4.4 cancelExpirationRenewalâ€”å–æ¶ˆé”ç»­æœŸ</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/70dd77797eb7311864199dbdc59537b6.png"></p><blockquote><ul><li>è¿˜æ˜¯ä»è¿™ä¸ªmapé‡Œè·å–é”®å€¼å¯¹ï¼Œå¦‚æœä¸ºnullï¼Œè¯´æ˜ç»­æœŸä»»åŠ¡ä¸å­˜åœ¨ï¼Œä¹Ÿæ²¡å¿…è¦è¿›è¡Œä¸‹å»äº†ï¼Œç›´æ¥è¿”å›ã€‚</li><li>å¦‚æœthreadIdä¸ä¸ºnullï¼Œç›´æ¥å°†è¿™ä¸ªç»­æœŸä»»åŠ¡ä»taské‡Œç§»é™¤ã€‚</li><li>å¦‚æœthreadIdä¸ºnullæˆ–è€…taskä¸­ä¸å†æœ‰ä»»ä½•çº¿ç¨‹åœ¨ç­‰å¾…ç»­æœŸï¼Œæ­¤æ—¶å°±è°ƒç”¨cancelæ–¹æ³•æ¥å–æ¶ˆå®šæ—¶ä»»åŠ¡ï¼Œç„¶ååœ¨ä»<strong>EXPIRATION_RENEWAL_MAP</strong>ä¸­ç§»é™¤è¯¥ç»­æœŸä»»åŠ¡ã€‚</li></ul></blockquote><p><strong>psï¼šå½“unlockçš„æ—¶å€™ä¹Ÿä¼šè°ƒè¯¥æ–¹æ³•ï¼Œæ¥æ‰§è¡Œå–æ¶ˆé”ç»­æœŸçš„æ“ä½œã€‚</strong></p><h3 id="2-5-å°ç»“-2"><a href="#2-5-å°ç»“-2" class="headerlink" title="2.5 å°ç»“"></a>2.5 å°ç»“</h3><h4 id="2-5-1-ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ-2"><a href="#2-5-1-ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ-2" class="headerlink" title="2.5.1 ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ"></a>2.5.1 ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œé”ç»­æœŸ</h4><blockquote><p>åŠ é”æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œåˆ™é»˜è®¤è¿‡æœŸæ—¶é—´ä¸º30sä¸”æ¯éš”10sè¿›è¡Œé”ç»­æœŸæ“ä½œã€‚</p><p><strong>psï¼šå‚è€ƒ2.3.2å’Œ2.4.2å°èŠ‚ã€‚</strong></p></blockquote><h4 id="2-5-2-ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ-2"><a href="#2-5-2-ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ-2" class="headerlink" title="2.5.2 ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ"></a>2.5.2 ä»€ä¹ˆæƒ…å†µä¼šåœæ­¢ç»­æœŸ</h4><blockquote><ul><li><p>é”è¢«é‡Šæ”¾ã€‚</p></li><li><p>ç»­æœŸæ—¶å‘ç”Ÿå¼‚å¸¸ã€‚</p></li><li><p>æ‰§è¡Œé”ç»­æœŸLUAè„šæœ¬å¤±è´¥ã€‚</p></li><li><p>Redissionçš„ç»­æœŸæ—¶Nettyæ—¶é—´è½®ï¼ˆTimerTaskã€TimeOutã€Timerï¼‰çš„ï¼Œå¹¶ä¸”æ“ä½œéƒ½æ˜¯åŸºäºJVMï¼Œæ‰€ä»¥å½“åº”ç”¨å®•æœºã€ä¸‹çº¿æˆ–é‡å¯åï¼Œç»­æœŸä»»åŠ¡ä¹Ÿæ²¡æœ‰äº†ã€‚</p></li></ul><p><strong>psï¼šå‚è€ƒ2.4.3å°èŠ‚ã€‚</strong></p></blockquote><h3 id="2-6-lock-å’Œtrylock-çš„åŒºåˆ«-2"><a href="#2-6-lock-å’Œtrylock-çš„åŒºåˆ«-2" class="headerlink" title="2.6 lock()å’Œtrylock()çš„åŒºåˆ«"></a>2.6 lock()å’Œtrylock()çš„åŒºåˆ«</h3><p>è®²äº†åŠå¤©å¿˜äº†è¯´ä½¿ç”¨redissionå®ç°åˆ†å¸ƒå¼é”çš„ç¤ºä¾‹äº†ğŸ˜‚ï¼Œç´¢æ€§å°±åœ¨è¿™è¡¥å……ä¸€ä¸‹å§ã€‚</p><p><strong>lock()ï¼š</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">RLock lock = redisson.getLock(<span class="hljs-string">&quot;MyLock&quot;</span>);lock.lock();<span class="hljs-regexp">//</span>é˜»å¡æ–¹æ³•ï¼ŒçŸ¥é“è·å–åˆ°é”try &#123; Â  Â <span class="hljs-regexp">//</span>ä¸šåŠ¡ä»£ç &#125;finally &#123; Â  Â <span class="hljs-regexp">//</span>å½“å‰é”å­˜åœ¨ä¸”è¢«å½“å‰çº¿ç¨‹æŒæœ‰ Â  Â  <span class="hljs-keyword">if</span>(lock.isLocked() &amp;&amp; lock.isHeldByCurrentThread())&#123; Â  Â  Â <span class="hljs-regexp">//</span>é‡Šæ”¾é” Â  Â  Â lock.unlock(); Â  &#125;&#125;<br></code></pre></td></tr></table></figure><blockquote><p>lockçš„åŸç†æ˜¯ä»¥é˜»å¡çš„æ–¹å¼è·å–é”ï¼Œå¦‚æœè·å–å¤±è´¥åˆ™ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å–æˆåŠŸã€‚</p><p><strong>psï¼šå¯ä»¥å‚è€ƒ2.3.1å°èŠ‚ã€‚</strong></p></blockquote><p><strong>trylock()ï¼š</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">RLock lock = redisson.getLock(<span class="hljs-string">&quot;MyLock&quot;</span>);boolean b = lock.tryLock();<span class="hljs-regexp">//</span>éé˜»å¡æ–¹æ³•ï¼Œç«‹å³è¿”å›è·å–ç»“æœ<span class="hljs-keyword">if</span>(b)&#123; Â  Â  try &#123; Â  Â  Â  Â  Â <span class="hljs-regexp">//</span>ä¸šåŠ¡ä»£ç  Â  Â  &#125;finally &#123; Â  Â  Â  Â  Â <span class="hljs-regexp">//</span>å½“å‰é”å­˜åœ¨ä¸”è¢«å½“å‰çº¿ç¨‹æŒæœ‰ Â  Â  Â  Â  Â <span class="hljs-keyword">if</span>(lock.isLocked() &amp;&amp; lock.isHeldByCurrentThread())&#123; Â  Â  Â  Â  Â  Â  Â  <span class="hljs-regexp">//</span>é‡Šæ”¾é” Â  Â  Â  Â  Â  Â  Â  lock.unlock(); Â  Â  Â  Â  Â  &#125; Â  Â  &#125;&#125;<span class="hljs-keyword">else</span> &#123; Â  <span class="hljs-regexp">//</span>è·å–é”å¤±è´¥ï¼Œå¤„ç†é€»è¾‘&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/1c9d3a00e609d59fa4984a1f606e3953.png"></p><blockquote><p>tryLockæ˜¯å°è¯•è·å–é”ï¼Œå¦‚æœèƒ½è·å–ç›´æ¥è¿”å›trueï¼Œå¦‚æœæ— æ³•è·å–ï¼Œå®ƒä¼šæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„è¶…æ—¶æ—¶é—´è¿›è¡Œé˜»å¡ï¼Œ<strong>è¿™ä¸ªæ—¶é—´å†…è¿˜ä¼šå°è¯•è·å–é”ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æ²¡è·å–åˆ°ï¼Œç›´æ¥è¿”å›falseã€‚</strong>å¦‚æœæ²¡æœ‰æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œå°±å¦‚æˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œé‚£è·å–ä¸åˆ°çš„è¯ç›´æ¥å°±è¿”å›falseã€‚</p></blockquote><p><strong>æˆ‘ä»¬çœ‹ä¸‹æºç ï¼š</strong></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/5bf0550041bf17578d7a01ed660437db.png"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/f9968619e85e7c4660cc7331cb48315d.png"></p><p><strong>è¿™æ˜¯æ²¡æœ‰æŒ‡å®šè¶…æ—¶æ—¶é—´æ‰§è¡Œçš„æ–¹æ³•ï¼Œæ–¹æ³•åä¹Ÿå¾ˆè§åçŸ¥æ„ï¼Œå°±æ˜¯å°è¯•ä¸€æ¬¡åŠ é”ã€‚æŒ‡å®šäº†è¶…æ—¶æ—¶é—´çš„è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œæ— éæ˜¯åœ¨è¶…æ—¶æ—¶é—´å†…æ‰§è¡Œwhileå¾ªç¯å°è¯•è·å–é”ã€‚</strong></p><h2 id="ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨-2"><a href="#ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨-2" class="headerlink" title="ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨"></a>ä¸‰ã€Redissionå…¬å¹³é”ï¼ˆFairLockï¼‰ã€è”é”ï¼ˆMultiLockï¼‰ã€è¯»å†™é”çš„ä½¿ç”¨</h2><p><strong>psï¼šè¿™å‡ ç§é”éƒ½ä¸å¸¸ç”¨ï¼Œæ‰€ä»¥å°±ä¸ç»†è®²äº†ï¼ŒçŸ¥é“æœ‰è¿™ä¸ªäº‹å°±è¡Œã€‚</strong></p><h3 id="3-1-å…¬å¹³é”ï¼ˆFairLockï¼‰-2"><a href="#3-1-å…¬å¹³é”ï¼ˆFairLockï¼‰-2" class="headerlink" title="3.1 å…¬å¹³é”ï¼ˆFairLockï¼‰"></a>3.1 å…¬å¹³é”ï¼ˆFairLockï¼‰</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">RLock <span class="hljs-keyword">lock</span> = redisson.getFairLock(<span class="hljs-string">&quot;MyLock&quot;</span>);<span class="hljs-keyword">lock</span>.<span class="hljs-keyword">lock</span>();<br></code></pre></td></tr></table></figure><h3 id="3-2-è”é”ï¼ˆMultiLockï¼‰-2"><a href="#3-2-è”é”ï¼ˆMultiLockï¼‰-2" class="headerlink" title="3.2 è”é”ï¼ˆMultiLockï¼‰"></a>3.2 è”é”ï¼ˆMultiLockï¼‰</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">RLock lock1 = redisson.get<span class="hljs-constructor">Lock(<span class="hljs-string">&quot;MyLock1&quot;</span>)</span>;RLock lock2 = redisson.get<span class="hljs-constructor">Lock(<span class="hljs-string">&quot;MyLock2&quot;</span>)</span>;RLock lock3 = redisson.get<span class="hljs-constructor">Lock(<span class="hljs-string">&quot;MyLock3&quot;</span>)</span>;RedissonMultiLock lock=<span class="hljs-keyword">new</span> <span class="hljs-constructor">RedissonMultiLock(<span class="hljs-params">lock1</span>,<span class="hljs-params">lock2</span>,<span class="hljs-params">lock3</span>)</span>;<span class="hljs-comment">//åŒæ—¶åŠ é”lock1ã€lock2ã€lock3//æ‰€æœ‰çš„é”éƒ½ä¸Šé”æˆåŠŸæ‰ç®—æˆåŠŸlock.lock(); //...lock.unlock();</span><br></code></pre></td></tr></table></figure><h3 id="3-3-è¯»å†™é”-2"><a href="#3-3-è¯»å†™é”-2" class="headerlink" title="3.3 è¯»å†™é”"></a>3.3 è¯»å†™é”</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">RReadWriteLock <span class="hljs-keyword">lock</span> = redisson.getReadWriteLock(&quot;myLock&quot;);//è¯»é”<span class="hljs-keyword">lock</span>.readLock().<span class="hljs-keyword">lock</span>();//å†™é”<span class="hljs-keyword">lock</span>.writeLock().<span class="hljs-keyword">lock</span>();<br></code></pre></td></tr></table></figure><p><strong>psï¼šè¿˜æœ‰ä¸ªRedLockï¼Œè¿™ä¸ªå¯ä»¥ç»†è®²ä¸€ä¸‹ï¼Œä½†æ˜¯ç”±äºç¯‡å¹…åŸå› ï¼Œå°±æ”¾åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å§ã€‚</strong></p><h2 id="å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜-2"><a href="#å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜-2" class="headerlink" title="å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜"></a>å››ã€Redissionå®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜</h2><p>Redissionä½¿ç”¨çœ‹é—¨ç‹—ç»­æœŸçš„æ–¹æ¡ˆåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹æ˜¯æŒºä¸é”™çš„ï¼Œä½†åœ¨æç«¯æƒ…å†µä¸‹è¿˜æ˜¯ä¼šå­˜åœ¨é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><blockquote><ul><li>çº¿ç¨‹1é¦–å…ˆè·å–é”æˆåŠŸï¼Œå°†é”®å€¼å¯¹å†™å…¥redisçš„masterèŠ‚ç‚¹ã€‚</li><li><strong>åœ¨rediså°†masteræ•°æ®åŒæ­¥åˆ°slaveèŠ‚ç‚¹ä¹‹å‰ï¼Œmasteræ•…éšœäº†ã€‚</strong></li><li>æ­¤æ—¶ä¼šè§¦å‘æ•…éšœè½¬ç§»ï¼Œå°†å…¶ä¸­ä¸€ä¸ªslaveå‡çº§ä¸ºmasterã€‚</li><li>ä½†æ–°çš„masterå¹¶æ²¡æœ‰çº¿ç¨‹1å†™å…¥çš„é”®å€¼å¯¹ï¼Œå› æ­¤å¦‚æœæ­¤æ—¶æ¥ä¸ªçº¿ç¨‹2ï¼Œä¹ŸåŒæ ·å¯ä»¥è·å–åˆ°é”ï¼Œè¿™å°±è¿èƒŒäº†é”çš„åˆè¡·ã€‚</li></ul></blockquote><p>è¿™ä¸ªåœºæ™¯å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<a href="https://blog.csdn.net/weixin_45433817/article/details/137209295?spm=1001.2014.3001.5501" title="é›†ç¾¤è„‘è£‚">é›†ç¾¤è„‘è£‚</a><strong>ï¼ˆç½‘ç»œåˆ†åŒºï¼‰</strong>é—®é¢˜ã€‚</p><p>é‚£ä¹ˆæ¯”è¾ƒä¸»æµçš„è§£å†³æ–¹æ¡ˆå°±æ˜¯<strong>Redisä½œè€…æå‡ºçš„Redlock</strong>å’Œ<strong>Zookeeper</strong>å®ç°çš„åˆ†å¸ƒå¼é”ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸‹èŠ‚å†è®²ã€‚</p><p><strong>Endï¼šå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æœæœ‰çº°æ¼æˆ–è€…æ›´å¥½çš„æƒ³æ³•ï¼Œè¯·æ‚¨ä¸€å®šä¸è¦åå•¬ä½ çš„èµæ•™ğŸ™‹ã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redisåˆ†å¸ƒå¼é”</title>
    <link href="/article/e2ee4148.html"/>
    <url>/article/e2ee4148.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />## å‰è¨€<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»åŸºäºRedisçš„<a href="https://link.zhihu.com/?target=https://so.csdn.net/so/search?q=%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E9%2594%2581&spm=1001.2101.3001.7020">åˆ†å¸ƒå¼é”</a>å®ç°åˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œå…¶ä¸­å‚è€ƒäº†è®¸å¤šå¤§ä½¬å†™çš„æ–‡ç« ï¼Œç®—æ˜¯å¯¹åˆ†å¸ƒå¼é”åšä¸€ä¸ªæ€»ç»“</p><h2 id="åˆ†å¸ƒå¼é”æ¦‚è§ˆ"><a href="#åˆ†å¸ƒå¼é”æ¦‚è§ˆ" class="headerlink" title="åˆ†å¸ƒå¼é”æ¦‚è§ˆ"></a>åˆ†å¸ƒå¼é”æ¦‚è§ˆ</h2><p>åœ¨<a href="https://link.zhihu.com/?target=https://so.csdn.net/so/search?q=%25E5%25A4%259A%25E7%25BA%25BF%25E7%25A8%258B&spm=1001.2101.3001.7020">å¤šçº¿ç¨‹</a>çš„ç¯å¢ƒä¸‹ï¼Œä¸ºäº†ä¿è¯ä¸€ä¸ªä»£ç å—åœ¨åŒä¸€æ—¶é—´åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼ŒJavaä¸­æˆ‘ä»¬ä¸€èˆ¬å¯ä»¥ä½¿ç”¨synchronizedè¯­æ³•å’ŒReetrantLockå»ä¿è¯ï¼Œè¿™å®é™…ä¸Šæ˜¯æœ¬åœ°é”çš„æ–¹å¼ã€‚ä½†æ˜¯ç°åœ¨å…¬å¸éƒ½æ˜¯æµè¡Œ<a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=1&q=%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84&zhida_source=entity">åˆ†å¸ƒå¼æ¶æ„</a>ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•ä¿è¯ä¸åŒèŠ‚ç‚¹çš„<a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=1&q=%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5&zhida_source=entity">çº¿ç¨‹åŒæ­¥</a>æ‰§è¡Œå‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œå¯¹äºåˆ†å¸ƒå¼åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œå®ƒæ˜¯æ§åˆ¶<a href="https://link.zhihu.com/?target=https://so.csdn.net/so/search?q=%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F&spm=1001.2101.3001.7020">åˆ†å¸ƒå¼ç³»ç»Ÿ</a>ä¹‹é—´<strong>äº’æ–¥è®¿é—®å…±äº«èµ„æº</strong>çš„ä¸€ç§æ–¹å¼ã€‚</p><p>æ¯”å¦‚è¯´åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šå°æœºå™¨ä¸Šéƒ¨ç½²äº†å¤šä¸ªæœåŠ¡ï¼Œå½“å®¢æˆ·ç«¯ä¸€ä¸ªç”¨æˆ·å‘èµ·ä¸€ä¸ªæ•°æ®æ’å…¥è¯·æ±‚æ—¶ï¼Œå¦‚æœæ²¡æœ‰<a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=1&q=%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%9C%BA%E5%88%B6&zhida_source=entity">åˆ†å¸ƒå¼é”æœºåˆ¶</a>ä¿è¯ï¼Œé‚£ä¹ˆé‚£å¤šå°æœºå™¨ä¸Šçš„å¤šä¸ªæœåŠ¡å¯èƒ½è¿›è¡Œå¹¶å‘æ’å…¥æ“ä½œï¼Œå¯¼è‡´æ•°æ®é‡å¤æ’å…¥ï¼Œå¯¹äºæŸäº›ä¸å…è®¸æœ‰å¤šä½™æ•°æ®çš„ä¸šåŠ¡æ¥è¯´ï¼Œè¿™å°±ä¼šé€ æˆé—®é¢˜ã€‚è€Œåˆ†å¸ƒå¼é”æœºåˆ¶å°±æ˜¯ä¸ºäº†è§£å†³ç±»ä¼¼è¿™ç±»é—®é¢˜ï¼Œä¿è¯å¤šä¸ªæœåŠ¡ä¹‹é—´äº’æ–¥çš„è®¿é—®å…±äº«èµ„æºï¼Œå¦‚æœä¸€ä¸ªæœåŠ¡æŠ¢å äº†åˆ†å¸ƒå¼é”ï¼Œå…¶ä»–æœåŠ¡æ²¡è·å–åˆ°é”ï¼Œå°±ä¸è¿›è¡Œåç»­æ“ä½œã€‚å¤§è‡´æ„æ€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆä¸ä¸€å®šå‡†ç¡®ï¼‰ï¼š</p><p><img src="https://pica.zhimg.com/v2-838464fda75a3639278415e05543602e_1440w.jpg"></p><h3 id="åˆ†å¸ƒå¼é”çš„ç‰¹ç‚¹"><a href="#åˆ†å¸ƒå¼é”çš„ç‰¹ç‚¹" class="headerlink" title="åˆ†å¸ƒå¼é”çš„ç‰¹ç‚¹"></a>åˆ†å¸ƒå¼é”çš„ç‰¹ç‚¹</h3><p>åˆ†å¸ƒå¼é”ä¸€èˆ¬æœ‰å¦‚ä¸‹çš„ç‰¹ç‚¹ï¼š</p><ul><li>äº’æ–¥æ€§ï¼š åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”</li><li>å¯é‡å…¥æ€§ï¼š åŒä¸€èŠ‚ç‚¹ä¸Šçš„åŒä¸€ä¸ªçº¿ç¨‹å¦‚æœè·å–äº†é”ä¹‹åèƒ½å¤Ÿå†æ¬¡è·å–é”</li><li>é”è¶…æ—¶ï¼šå’ŒJ.U.Cä¸­çš„é”ä¸€æ ·æ”¯æŒé”è¶…æ—¶ï¼Œé˜²æ­¢æ­»é”</li><li>é«˜æ€§èƒ½å’Œé«˜å¯ç”¨ï¼š åŠ é”å’Œè§£é”éœ€è¦é«˜æ•ˆï¼ŒåŒæ—¶ä¹Ÿéœ€è¦ä¿è¯é«˜å¯ç”¨ï¼Œé˜²æ­¢åˆ†å¸ƒå¼é”å¤±æ•ˆ</li><li>å…·å¤‡é˜»å¡å’Œ<a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=1&q=%E9%9D%9E%E9%98%BB%E5%A1%9E%E6%80%A7&zhida_source=entity">éé˜»å¡æ€§</a>ï¼šèƒ½å¤ŸåŠæ—¶ä»é˜»å¡çŠ¶æ€ä¸­è¢«å”¤é†’</li></ul><h3 id="åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼"><a href="#åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼" class="headerlink" title="åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼"></a>åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼</h3><p>æˆ‘ä»¬ä¸€èˆ¬å®ç°åˆ†å¸ƒå¼é”æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ul><li>åŸºäºæ•°æ®åº“</li><li>åŸºäºRedis</li><li>åŸºäºzookeeper</li></ul><p>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»åŸºäºRediså¦‚ä½•å®ç°åˆ†å¸ƒå¼é”</p><h2 id="Redisçš„åˆ†å¸ƒå¼é”å®ç°"><a href="#Redisçš„åˆ†å¸ƒå¼é”å®ç°" class="headerlink" title="Redisçš„åˆ†å¸ƒå¼é”å®ç°"></a>Redisçš„åˆ†å¸ƒå¼é”å®ç°</h2><h3 id="1-åˆ©ç”¨setnx-expireå‘½ä»¤-é”™è¯¯çš„åšæ³•"><a href="#1-åˆ©ç”¨setnx-expireå‘½ä»¤-é”™è¯¯çš„åšæ³•" class="headerlink" title="1. åˆ©ç”¨setnx+expireå‘½ä»¤ (é”™è¯¯çš„åšæ³•)"></a>1. åˆ©ç”¨setnx+expireå‘½ä»¤ (é”™è¯¯çš„åšæ³•)</h3><p>Redisçš„SETNXå‘½ä»¤ï¼Œsetnx key valueï¼Œå°†keyè®¾ç½®ä¸ºvalueï¼Œå½“é”®ä¸å­˜åœ¨æ—¶ï¼Œæ‰èƒ½æˆåŠŸï¼Œè‹¥é”®å­˜åœ¨ï¼Œä»€ä¹ˆä¹Ÿä¸åšï¼ŒæˆåŠŸè¿”å›1ï¼Œå¤±è´¥è¿”å›0 ã€‚ SETNXå®é™…ä¸Šå°±æ˜¯SET IF NOT Existsçš„ç¼©å†™</p><p>å› ä¸ºåˆ†å¸ƒå¼é”è¿˜éœ€è¦è¶…æ—¶æœºåˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨<a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=2&q=expire%E5%91%BD%E4%BB%A4&zhida_source=entity">expireå‘½ä»¤</a>æ¥è®¾ç½®ï¼Œæ‰€ä»¥åˆ©ç”¨setnx+expireå‘½ä»¤çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs processing"><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span>(<span class="hljs-built_in">String</span> <span class="hljs-built_in">key</span>,<span class="hljs-built_in">String</span> requset,<span class="hljs-type">int</span> timeout) &#123;<br><br> Long result = jedis.<span class="hljs-property">setnx</span>(<span class="hljs-built_in">key</span>, requset);<br><br> <span class="hljs-comment">// result = 1æ—¶ï¼Œè®¾ç½®æˆåŠŸï¼Œå¦åˆ™è®¾ç½®å¤±è´¥</span><br><br> <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span>L) &#123;<br><br> <span class="hljs-keyword">return</span> jedis.<span class="hljs-property">expire</span>(<span class="hljs-built_in">key</span>, timeout) == <span class="hljs-number">1</span>L;<br><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br><br> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šä¸Šé¢çš„æ­¥éª¤æ˜¯æœ‰é—®é¢˜çš„ï¼Œsetnxå’Œexpireæ˜¯åˆ†å¼€çš„ä¸¤æ­¥æ“ä½œï¼Œä¸å…·æœ‰åŸå­æ€§ï¼Œå¦‚æœæ‰§è¡Œå®Œç¬¬ä¸€æ¡æŒ‡ä»¤åº”ç”¨å¼‚å¸¸æˆ–è€…é‡å¯äº†ï¼Œé”å°†æ— æ³•è¿‡æœŸã€‚</p><p>ä¸€ç§æ”¹å–„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨Luaè„šæœ¬æ¥ä¿è¯<a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=2&q=%E5%8E%9F%E5%AD%90%E6%80%A7&zhida_source=entity">åŸå­æ€§</a>ï¼ˆåŒ…å«setnxå’Œexpireä¸¤æ¡æŒ‡ä»¤ï¼‰</p><h3 id="2-ä½¿ç”¨Luaè„šæœ¬ï¼ˆåŒ…å«setnxå’Œexpireä¸¤æ¡æŒ‡ä»¤ï¼‰"><a href="#2-ä½¿ç”¨Luaè„šæœ¬ï¼ˆåŒ…å«setnxå’Œexpireä¸¤æ¡æŒ‡ä»¤ï¼‰" class="headerlink" title="2. ä½¿ç”¨Luaè„šæœ¬ï¼ˆåŒ…å«setnxå’Œexpireä¸¤æ¡æŒ‡ä»¤ï¼‰"></a>2. ä½¿ç”¨Luaè„šæœ¬ï¼ˆåŒ…å«setnxå’Œexpireä¸¤æ¡æŒ‡ä»¤ï¼‰</h3><p>ä»£ç å¦‚ä¸‹</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs processing"><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock_with_lua</span>(<span class="hljs-built_in">String</span> <span class="hljs-built_in">key</span>, <span class="hljs-built_in">String</span> UniqueId, <span class="hljs-type">int</span> seconds) &#123;<br><br> <span class="hljs-built_in">String</span> lua_scripts = <span class="hljs-string">&quot;if redis.call(&#x27;setnx&#x27;,KEYS[1],ARGV[1]) == 1 then&quot;</span> +<br><br> <span class="hljs-string">&quot;redis.call(&#x27;expire&#x27;,KEYS[1],ARGV[2]) return 1 else return 0 end&quot;</span>;<br><br> List&lt;<span class="hljs-built_in">String</span>&gt; keys = <span class="hljs-keyword">new </span><span class="hljs-class title_">ArrayList</span>&lt;&gt;();<br><br> List&lt;<span class="hljs-built_in">String</span>&gt; values = <span class="hljs-keyword">new </span><span class="hljs-class title_">ArrayList</span>&lt;&gt;();<br><br>    keys.<span class="hljs-property">add</span>(<span class="hljs-built_in">key</span>);<br><br>    values.<span class="hljs-property">add</span>(UniqueId);<br><br>    values.<span class="hljs-property">add</span>(<span class="hljs-built_in">String</span>.<span class="hljs-property">valueOf</span>(seconds));<br><br> <span class="hljs-built_in">Object</span> result = jedis.<span class="hljs-property">eval</span>(lua_scripts, keys, values);<br><br> <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æˆåŠŸ</span><br><br> <span class="hljs-keyword">return</span> result.<span class="hljs-property">equals</span>(<span class="hljs-number">1</span>L);<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-ä½¿ç”¨-set-key-value-EX-seconds-PX-milliseconds-NX-XX-å‘½ä»¤-æ­£ç¡®åšæ³•"><a href="#3-ä½¿ç”¨-set-key-value-EX-seconds-PX-milliseconds-NX-XX-å‘½ä»¤-æ­£ç¡®åšæ³•" class="headerlink" title="3. ä½¿ç”¨ set key value [EX seconds][PX milliseconds][NX|XX] å‘½ä»¤ (æ­£ç¡®åšæ³•)"></a>3. ä½¿ç”¨ set key value [EX seconds][PX milliseconds][NX|XX] å‘½ä»¤ (æ­£ç¡®åšæ³•)</h3><p>Redisåœ¨ 2.6.12 ç‰ˆæœ¬å¼€å§‹ï¼Œä¸º SET å‘½ä»¤å¢åŠ ä¸€ç³»åˆ—é€‰é¡¹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><br>SET key value<span class="hljs-selector-attr">[EX seconds]</span><span class="hljs-selector-attr">[PX milliseconds]</span><span class="hljs-selector-attr">[NX|XX]</span><br></code></pre></td></tr></table></figure><ul><li>EX seconds: è®¾å®šè¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºç§’</li><li>PX milliseconds: è®¾å®šè¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’</li><li>NX: ä»…å½“keyä¸å­˜åœ¨æ—¶è®¾ç½®å€¼</li><li>XX: ä»…å½“keyå­˜åœ¨æ—¶è®¾ç½®å€¼</li></ul><p>setå‘½ä»¤çš„nxé€‰é¡¹ï¼Œå°±ç­‰åŒäº<a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=1&q=setnx%E5%91%BD%E4%BB%A4&zhida_source=entity">setnxå‘½ä»¤</a>ï¼Œä»£ç è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs processing"><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock_with_set</span>(<span class="hljs-built_in">String</span> <span class="hljs-built_in">key</span>, <span class="hljs-built_in">String</span> UniqueId, <span class="hljs-type">int</span> seconds) &#123;<br><br> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;OK&quot;</span>.<span class="hljs-property">equals</span>(jedis.<span class="hljs-property">set</span>(<span class="hljs-built_in">key</span>, UniqueId, <span class="hljs-string">&quot;NX&quot;</span>, <span class="hljs-string">&quot;EX&quot;</span>, seconds));<br><br>&#125;<br></code></pre></td></tr></table></figure><p>valueå¿…é¡»è¦å…·æœ‰å”¯ä¸€æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨UUIDæ¥åšï¼Œè®¾ç½®éšæœºå­—ç¬¦ä¸²ä¿è¯å”¯ä¸€æ€§ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦ä¿è¯å”¯ä¸€æ€§ï¼Ÿå‡å¦‚valueä¸æ˜¯éšæœºå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œé‚£ä¹ˆå°±å¯èƒ½å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>1.å®¢æˆ·ç«¯1è·å–é”æˆåŠŸ</li><li>2.å®¢æˆ·ç«¯1åœ¨æŸä¸ªæ“ä½œä¸Šé˜»å¡äº†å¤ªé•¿æ—¶é—´</li><li>3.è®¾ç½®çš„keyè¿‡æœŸäº†ï¼Œé”è‡ªåŠ¨é‡Šæ”¾äº†</li><li>4.å®¢æˆ·ç«¯2è·å–åˆ°äº†å¯¹åº”åŒä¸€ä¸ªèµ„æºçš„é”</li><li>5.å®¢æˆ·ç«¯1ä»é˜»å¡ä¸­æ¢å¤è¿‡æ¥ï¼Œå› ä¸ºvalueå€¼ä¸€æ ·ï¼Œæ‰€ä»¥æ‰§è¡Œé‡Šæ”¾é”æ“ä½œæ—¶å°±ä¼šé‡Šæ”¾æ‰å®¢æˆ·ç«¯2æŒæœ‰çš„é”ï¼Œè¿™æ ·å°±ä¼šé€ æˆé—®é¢˜</li></ul><p>æ‰€ä»¥é€šå¸¸æ¥è¯´ï¼Œåœ¨é‡Šæ”¾é”æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹valueè¿›è¡ŒéªŒè¯</p><p>é‡Šæ”¾é”çš„å®ç°</p><p>é‡Šæ”¾é”æ—¶éœ€è¦éªŒè¯valueå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨è·å–é”çš„æ—¶å€™éœ€è¦è®¾ç½®ä¸€ä¸ªvalueï¼Œä¸èƒ½ç›´æ¥ç”¨del keyè¿™ç§ç²—æš´çš„æ–¹å¼ï¼Œå› ä¸ºç›´æ¥del keyä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¿›è¡Œè§£é”äº†ï¼Œæ‰€ä»¥<strong>è§£é”æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­é”æ˜¯å¦æ˜¯è‡ªå·±çš„ï¼ŒåŸºäºvalueå€¼æ¥åˆ¤æ–­</strong>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><br>public boolean release<span class="hljs-constructor">Lock_with_lua(String <span class="hljs-params">key</span>,String <span class="hljs-params">value</span>)</span> &#123;<br><br> String luaScript = <span class="hljs-string">&quot;if redis.call(&#x27;get&#x27;,KEYS[1]) == ARGV[1] then &quot;</span> +<br><br> <span class="hljs-string">&quot;return redis.call(&#x27;del&#x27;,KEYS[1]) else return 0 end&quot;</span>;<br><br> return jedis.eval(luaScript, <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Collections</span>.</span></span>singleton<span class="hljs-constructor">List(<span class="hljs-params">key</span>)</span>, <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Collections</span>.</span></span>singleton<span class="hljs-constructor">List(<span class="hljs-params">value</span>)</span>).equals(<span class="hljs-number">1L</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨Luaè„šæœ¬çš„æ–¹å¼ï¼Œå°½é‡ä¿è¯åŸå­æ€§ã€‚</p><p>ä½¿ç”¨ <code>set key value [EX seconds][PX milliseconds][NX|XX]</code> å‘½ä»¤ çœ‹ä¸Šå»å¾ˆOKï¼Œå®é™…ä¸Šåœ¨<a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=1&q=Redis%E9%9B%86%E7%BE%A4&zhida_source=entity">Redisé›†ç¾¤</a>çš„æ—¶å€™ä¹Ÿä¼šå‡ºç°é—®é¢˜ï¼Œæ¯”å¦‚è¯´Aå®¢æˆ·ç«¯åœ¨Redisçš„masterèŠ‚ç‚¹ä¸Šæ‹¿åˆ°äº†é”ï¼Œä½†æ˜¯è¿™ä¸ªåŠ é”çš„keyè¿˜æ²¡æœ‰åŒæ­¥åˆ°slaveèŠ‚ç‚¹ï¼Œmasteræ•…éšœï¼Œå‘ç”Ÿæ•…éšœè½¬ç§»ï¼Œä¸€ä¸ªslaveèŠ‚ç‚¹å‡çº§ä¸º<a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=2&q=master%E8%8A%82%E7%82%B9&zhida_source=entity">masterèŠ‚ç‚¹</a>ï¼ŒBå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥è·å–åŒä¸ªkeyçš„é”ï¼Œä½†å®¢æˆ·ç«¯Aä¹Ÿå·²ç»æ‹¿åˆ°é”äº†ï¼Œè¿™å°±å¯¼è‡´å¤šä¸ªå®¢æˆ·ç«¯éƒ½æ‹¿åˆ°é”ã€‚</p><p>æ‰€ä»¥é’ˆå¯¹Redisé›†ç¾¤è¿™ç§æƒ…å†µï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ¡ˆ</p><h3 id="4-Redlockç®—æ³•-ä¸-Redisson-å®ç°"><a href="#4-Redlockç®—æ³•-ä¸-Redisson-å®ç°" class="headerlink" title="4. Redlockç®—æ³• ä¸ Redisson å®ç°"></a>4. Redlockç®—æ³• ä¸ Redisson å®ç°</h3><p>Redisä½œè€… <a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=1&q=antirez&zhida_source=entity">antirez</a>åŸºäºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹æå‡ºäº†ä¸€ç§æ›´é«˜çº§çš„åˆ†å¸ƒå¼é”çš„å®ç°Redlockï¼ŒåŸç†å¦‚ä¸‹ï¼š</p><blockquote><p>ä¸‹é¢å‚è€ƒæ–‡ç« <a href="https://link.zhihu.com/?target=https://mp.weixin.qq.com/s?__biz=MzU5ODUwNzY1Nw==&mid=2247484155&idx=1&sn=0c73f45f2f641ba0bf4399f57170ac9b&scene=21%23wechat_redirect">Redlockï¼šRedisåˆ†å¸ƒå¼é”æœ€ç‰›é€¼çš„å®ç°</a> å’Œ <a href="https://link.zhihu.com/?target=https://redis.io/topics/distlock">redis.io&#x2F;topics&#x2F;distâ€¦</a></p></blockquote><p>å‡è®¾æœ‰5ä¸ªç‹¬ç«‹çš„<a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=1&q=Redis%E8%8A%82%E7%82%B9&zhida_source=entity">RedisèŠ‚ç‚¹</a>ï¼ˆ**æ³¨æ„è¿™é‡Œçš„èŠ‚ç‚¹å¯ä»¥æ˜¯5ä¸ªRediså•masterå®ä¾‹ï¼Œä¹Ÿå¯ä»¥æ˜¯5ä¸ªRedis Clusteré›†ç¾¤ï¼Œä½†å¹¶ä¸æ˜¯æœ‰5ä¸ªä¸»èŠ‚ç‚¹çš„<a href="https://zhida.zhihu.com/search?content_id=219936088&content_type=Article&match_order=1&q=cluster%E9%9B%86%E7%BE%A4&zhida_source=entity">clusteré›†ç¾¤</a>**ï¼‰ï¼š</p><ul><li>è·å–å½“å‰Unixæ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½</li><li>ä¾æ¬¡å°è¯•ä»5ä¸ªå®ä¾‹ï¼Œä½¿ç”¨ç›¸åŒçš„keyå’Œå…·æœ‰å”¯ä¸€æ€§çš„value(ä¾‹å¦‚UUID)è·å–é”ï¼Œå½“å‘Redisè¯·æ±‚è·å–é”æ—¶ï¼Œå®¢æˆ·ç«¯åº”è¯¥è®¾ç½®ä¸€ä¸ªç½‘ç»œè¿æ¥å’Œå“åº”è¶…æ—¶æ—¶é—´ï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´åº”ç”¨å°äºé”çš„å¤±æ•ˆæ—¶é—´ï¼Œä¾‹å¦‚ä½ çš„é”è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ä¸º10sï¼Œåˆ™è¶…æ—¶æ—¶é—´åº”è¯¥åœ¨5~50æ¯«ç§’ä¹‹é—´ï¼Œè¿™æ ·å¯ä»¥é¿å…æœåŠ¡å™¨ç«¯Rediså·²ç»æŒ‚æ‰çš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯è¿˜åœ¨æ­»æ­»åœ°ç­‰å¾…å“åº”ç»“æœã€‚å¦‚æœæœåŠ¡ç«¯æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”ï¼Œå®¢æˆ·ç«¯åº”è¯¥å°½å¿«å°è¯•å»å¦å¤–ä¸€ä¸ªRediså®ä¾‹è¯·æ±‚è·å–é”</li><li>å®¢æˆ·ç«¯ä½¿ç”¨å½“å‰æ—¶é—´å‡å»å¼€å§‹è·å–é”æ—¶é—´ï¼ˆæ­¥éª¤1è®°å½•çš„æ—¶é—´ï¼‰å°±å¾—åˆ°è·å–é”ä½¿ç”¨çš„æ—¶é—´ï¼Œå½“ä¸”ä»…å½“ä»å¤§å¤šæ•°(N&#x2F;2+1ï¼Œè¿™é‡Œæ˜¯3ä¸ªèŠ‚ç‚¹)çš„RedisèŠ‚ç‚¹éƒ½å–åˆ°é”ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ—¶é—´å°äºé”å¤±è´¥æ—¶é—´æ—¶ï¼Œé”æ‰ç®—è·å–æˆåŠŸã€‚</li><li>å¦‚æœå–åˆ°äº†é”ï¼Œkeyçš„çœŸæ­£æœ‰æ•ˆæ—¶é—´ç­‰äºæœ‰æ•ˆæ—¶é—´å‡å»è·å–é”æ‰€ä½¿ç”¨çš„æ—¶é—´ï¼ˆæ­¥éª¤3è®¡ç®—çš„ç»“æœï¼‰</li><li>å¦‚æœæŸäº›åŸå› ï¼Œè·å–é”å¤±è´¥ï¼ˆæ²¡æœ‰åœ¨è‡³å°‘N&#x2F;2+1ä¸ªRediså®ä¾‹å–åˆ°é”æˆ–è€…å–é”æ—¶é—´å·²ç»è¶…è¿‡äº†æœ‰æ•ˆæ—¶é—´ï¼‰ï¼Œå®¢æˆ·ç«¯åº”è¯¥åœ¨æ‰€æœ‰çš„Rediså®ä¾‹ä¸Šè¿›è¡Œè§£é”ï¼ˆå³ä¾¿æŸäº›Rediså®ä¾‹æ ¹æœ¬å°±æ²¡æœ‰åŠ é”æˆåŠŸï¼Œé˜²æ­¢æŸäº›èŠ‚ç‚¹è·å–åˆ°é”ä½†æ˜¯å®¢æˆ·ç«¯æ²¡æœ‰å¾—åˆ°å“åº”è€Œå¯¼è‡´æ¥ä¸‹æ¥çš„ä¸€æ®µæ—¶é—´ä¸èƒ½è¢«é‡æ–°è·å–é”ï¼‰</li></ul><p>Redissonå®ç°ç®€å•åˆ†å¸ƒå¼é”</p><p>å¯¹äºJavaç”¨æˆ·è€Œè¨€ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨Jedisï¼ŒJedisæ˜¯Redisçš„Javaå®¢æˆ·ç«¯ï¼Œé™¤äº†Jedisä¹‹å¤–ï¼ŒRedissonä¹Ÿæ˜¯Javaçš„å®¢æˆ·ç«¯ï¼ŒJedisæ˜¯é˜»å¡å¼I&#x2F;Oï¼Œè€ŒRedissonåº•å±‚ä½¿ç”¨Nettyå¯ä»¥å®ç°éé˜»å¡I&#x2F;Oï¼Œè¯¥å®¢æˆ·ç«¯å°è£…äº†é”çš„ï¼Œç»§æ‰¿äº†J.U.Cçš„Lockæ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨ReentrantLockä¸€æ ·ä½¿ç”¨Redissonï¼Œå…·ä½“ä½¿ç”¨è¿‡ç¨‹å¦‚ä¸‹ã€‚</p><ol><li>é¦–å…ˆåŠ å…¥POMä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.redisson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>redisson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.10.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><ol><li>ä½¿ç”¨Redissonï¼Œä»£ç å¦‚ä¸‹(ä¸ä½¿ç”¨ReentrantLockç±»ä¼¼ï¼‰</li></ol><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><br><span class="hljs-comment">// 1. é…ç½®æ–‡ä»¶</span><br><br>Config config = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Config()</span>;<br><br>config.use<span class="hljs-constructor">SingleServer()</span><br><br>        .set<span class="hljs-constructor">Address(<span class="hljs-string">&quot;redis://127.0.0.1:6379&quot;</span>)</span><br><br>        .set<span class="hljs-constructor">Password(RedisConfig.PASSWORD)</span><br><br>        .set<span class="hljs-constructor">Database(0)</span>;<br><br><span class="hljs-comment">//2. æ„é€ RedissonClient</span><br><br>RedissonClient redissonClient = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Redisson</span>.</span></span>create(config);<br><br> <br><br><span class="hljs-comment">//3. è®¾ç½®é”å®šèµ„æºåç§°</span><br><br>RLock lock = redissonClient.get<span class="hljs-constructor">Lock(<span class="hljs-string">&quot;redlock&quot;</span>)</span>;<br><br>lock.lock<span class="hljs-literal">()</span>;<br><br><span class="hljs-keyword">try</span> &#123;<br><br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;è·å–é”æˆåŠŸï¼Œå®ç°ä¸šåŠ¡é€»è¾‘&quot;</span>);<br><br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Thread</span>.</span></span>sleep(<span class="hljs-number">10000</span>);<br><br>&#125; catch (InterruptedException e) &#123;<br><br>    e.print<span class="hljs-constructor">StackTrace()</span>;<br><br>&#125; finally &#123;<br><br> lock.unlock<span class="hljs-literal">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å…³äºRedlockç®—æ³•çš„å®ç°ï¼Œåœ¨Redissonä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨RedissonRedLockæ¥å®Œæˆï¼Œå…·ä½“ä½¿ç”¨ç»†èŠ‚å¯ä»¥å‚è€ƒå¤§ä½¬çš„æ–‡ç« ï¼š <a href="https://link.zhihu.com/?target=https://mp.weixin.qq.com/s/8uhYult2h_YUHT7q7YCKYQ">mp.weixin.qq.com&#x2F;s&#x2F;8uhYult2hâ€¦</a></p><h2 id="Rediså®ç°çš„åˆ†å¸ƒå¼é”è½®å­"><a href="#Rediså®ç°çš„åˆ†å¸ƒå¼é”è½®å­" class="headerlink" title="Rediså®ç°çš„åˆ†å¸ƒå¼é”è½®å­"></a>Rediså®ç°çš„åˆ†å¸ƒå¼é”è½®å­</h2><p>ä¸‹é¢åˆ©ç”¨SpringBoot + Jedis + AOPçš„ç»„åˆæ¥å®ç°ä¸€ä¸ªç®€æ˜“çš„åˆ†å¸ƒå¼é”ã€‚</p><h3 id="1-è‡ªå®šä¹‰æ³¨è§£"><a href="#1-è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="1. è‡ªå®šä¹‰æ³¨è§£"></a>1. è‡ªå®šä¹‰æ³¨è§£</h3><p>è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œè¢«æ³¨è§£çš„æ–¹æ³•ä¼šæ‰§è¡Œè·å–åˆ†å¸ƒå¼é”çš„é€»è¾‘</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs less"><br><span class="hljs-variable">@Target</span>(ElementType.METHOD)<br><br><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<br><br><span class="hljs-variable">@Documented</span><br><br><span class="hljs-variable">@Inherited</span><br><br>public <span class="hljs-variable">@interface</span> RedisLock &#123;<br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * ä¸šåŠ¡é”®</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * @return</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">key</span>();<br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * é”çš„è¿‡æœŸç§’æ•°,é»˜è®¤æ˜¯5ç§’</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * @return</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br> <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">expire</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-number">5</span>;<br><br> <br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * å°è¯•åŠ é”ï¼Œæœ€å¤šç­‰å¾…æ—¶é—´</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * @return</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br> <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">waitTime</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-selector-tag">Long</span><span class="hljs-selector-class">.MIN_VALUE</span>;<br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * é”çš„è¶…æ—¶æ—¶é—´å•ä½</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * @return</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br> <span class="hljs-selector-tag">TimeUnit</span> <span class="hljs-selector-tag">timeUnit</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-selector-tag">TimeUnit</span><span class="hljs-selector-class">.SECONDS</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-AOPæ‹¦æˆªå™¨å®ç°"><a href="#2-AOPæ‹¦æˆªå™¨å®ç°" class="headerlink" title="2. AOPæ‹¦æˆªå™¨å®ç°"></a>2. AOPæ‹¦æˆªå™¨å®ç°</h3><p>åœ¨AOPä¸­æˆ‘ä»¬å»æ‰§è¡Œè·å–åˆ†å¸ƒå¼é”å’Œé‡Šæ”¾åˆ†å¸ƒå¼é”çš„é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Aspect</span><br><br><span class="hljs-meta">@Component</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockMethodAspect</span> &#123;<br><br> <span class="hljs-meta">@Autowired</span><br><br> <span class="hljs-keyword">private</span> RedisLockHelper redisLockHelper;<br><br> <span class="hljs-meta">@Autowired</span><br><br> <span class="hljs-keyword">private</span> JedisUtil jedisUtil;<br><br> <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(LockMethodAspect.class);<br><br> <br><br> <span class="hljs-meta">@Around(&quot;@annotation(com.redis.lock.annotation.RedisLock)&quot;)</span><br><br> <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> &#123;<br><br> <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> jedisUtil.getJedis();<br><br> <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> (MethodSignature) joinPoint.getSignature();<br><br> <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> signature.getMethod();<br><br> <br><br> <span class="hljs-type">RedisLock</span> <span class="hljs-variable">redisLock</span> <span class="hljs-operator">=</span> method.getAnnotation(RedisLock.class);<br><br> <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();<br><br> <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> redisLock.key();<br><br> <span class="hljs-keyword">try</span> &#123;<br><br> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">islock</span> <span class="hljs-operator">=</span> redisLockHelper.lock(jedis,key, value, redisLock.expire(), redisLock.timeUnit());<br><br>            logger.info(<span class="hljs-string">&quot;isLock : &#123;&#125;&quot;</span>,islock);<br><br> <span class="hljs-keyword">if</span> (!islock) &#123;<br><br>                logger.error(<span class="hljs-string">&quot;è·å–é”å¤±è´¥&quot;</span>);<br><br> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;è·å–é”å¤±è´¥&quot;</span>);<br><br>            &#125;<br><br> <span class="hljs-keyword">try</span> &#123;<br><br> <span class="hljs-keyword">return</span> joinPoint.proceed();<br><br>            &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;<br><br> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;ç³»ç»Ÿå¼‚å¸¸&quot;</span>);<br><br>            &#125;<br><br>        &#125;  <span class="hljs-keyword">finally</span> &#123;<br><br>            logger.info(<span class="hljs-string">&quot;é‡Šæ”¾é”&quot;</span>);<br><br>            redisLockHelper.unlock(jedis,key, value);<br><br>            jedis.close();<br><br>        &#125;<br><br>    &#125;<br><br>&#125;<br><br> <br></code></pre></td></tr></table></figure><h3 id="3-Rediså®ç°åˆ†å¸ƒå¼é”æ ¸å¿ƒç±»"><a href="#3-Rediså®ç°åˆ†å¸ƒå¼é”æ ¸å¿ƒç±»" class="headerlink" title="3. Rediså®ç°åˆ†å¸ƒå¼é”æ ¸å¿ƒç±»"></a>3. Rediså®ç°åˆ†å¸ƒå¼é”æ ¸å¿ƒç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Component</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisLockHelper</span> &#123;<br><br> <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">sleepTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * ç›´æ¥ä½¿ç”¨setnx + expireæ–¹å¼è·å–åˆ†å¸ƒå¼é”</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * éåŸå­æ€§</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> timeout</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br> <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">lock_setnx</span><span class="hljs-params">(Jedis jedis,String key, String value, <span class="hljs-type">int</span> timeout)</span> &#123;<br><br> <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.setnx(key, value);<br><br> <span class="hljs-comment">// result = 1æ—¶ï¼Œè®¾ç½®æˆåŠŸï¼Œå¦åˆ™è®¾ç½®å¤±è´¥</span><br><br> <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1L</span>) &#123;<br><br> <span class="hljs-keyword">return</span> jedis.expire(key, timeout) == <span class="hljs-number">1L</span>;<br><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br><br> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>        &#125;<br><br>    &#125;<br><br> <br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * ä½¿ç”¨Luaè„šæœ¬ï¼Œè„šæœ¬ä¸­ä½¿ç”¨setnex+expireå‘½ä»¤è¿›è¡ŒåŠ é”æ“ä½œ</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> jedis</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> UniqueId</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> seconds</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br> <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">Lock_with_lua</span><span class="hljs-params">(Jedis jedis,String key, String UniqueId, <span class="hljs-type">int</span> seconds)</span> &#123;<br><br> <span class="hljs-type">String</span> <span class="hljs-variable">lua_scripts</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;if redis.call(&#x27;setnx&#x27;,KEYS[1],ARGV[1]) == 1 then&quot;</span> +<br><br> <span class="hljs-string">&quot;redis.call(&#x27;expire&#x27;,KEYS[1],ARGV[2]) return 1 else return 0 end&quot;</span>;<br><br>        List&lt;String&gt; keys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>        List&lt;String&gt; values = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>        keys.add(key);<br><br>        values.add(UniqueId);<br><br>        values.add(String.valueOf(seconds));<br><br> <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.eval(lua_scripts, keys, values);<br><br> <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æˆåŠŸ</span><br><br> <span class="hljs-keyword">return</span> result.equals(<span class="hljs-number">1L</span>);<br><br>    &#125;<br><br> <br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * åœ¨Redisçš„2.6.12åŠä»¥åä¸­,ä½¿ç”¨ set key value [NX] [EX] å‘½ä»¤</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> timeout</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br> <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">lock</span><span class="hljs-params">(Jedis jedis,String key, String value, <span class="hljs-type">int</span> timeout, TimeUnit timeUnit)</span> &#123;<br><br> <span class="hljs-type">long</span> <span class="hljs-variable">seconds</span> <span class="hljs-operator">=</span> timeUnit.toSeconds(timeout);<br><br> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;OK&quot;</span>.equals(jedis.set(key, value, <span class="hljs-string">&quot;NX&quot;</span>, <span class="hljs-string">&quot;EX&quot;</span>, seconds));<br><br>    &#125;<br><br> <br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * è‡ªå®šä¹‰è·å–é”çš„è¶…æ—¶æ—¶é—´</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> jedis</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> timeout</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> waitTime</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> timeUnit</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br> <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">lock_with_waitTime</span><span class="hljs-params">(Jedis jedis,String key, String value, <span class="hljs-type">int</span> timeout, <span class="hljs-type">long</span> waitTime,TimeUnit timeUnit)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><br> <span class="hljs-type">long</span> <span class="hljs-variable">seconds</span> <span class="hljs-operator">=</span> timeUnit.toSeconds(timeout);<br><br> <span class="hljs-keyword">while</span> (waitTime &gt;= <span class="hljs-number">0</span>) &#123;<br><br> <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.set(key, value, <span class="hljs-string">&quot;nx&quot;</span>, <span class="hljs-string">&quot;ex&quot;</span>, seconds);<br><br> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;OK&quot;</span>.equals(result)) &#123;<br><br> <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><br>            &#125;<br><br>            waitTime -= sleepTime;<br><br>            Thread.sleep(sleepTime);<br><br>        &#125;<br><br> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>    &#125;<br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * é”™è¯¯çš„è§£é”æ–¹æ³•â€”ç›´æ¥åˆ é™¤key</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock_with_del</span><span class="hljs-params">(Jedis jedis,String key)</span> &#123;<br><br>        jedis.del(key);<br><br>    &#125;<br><br> <br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * ä½¿ç”¨Luaè„šæœ¬è¿›è¡Œè§£é”æ“çºµï¼Œè§£é”çš„æ—¶å€™éªŒè¯valueå€¼</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> jedis</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br> <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">(Jedis jedis,String key,String value)</span> &#123;<br><br> <span class="hljs-type">String</span> <span class="hljs-variable">luaScript</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;if redis.call(&#x27;get&#x27;,KEYS[1]) == ARGV[1] then &quot;</span> +<br><br> <span class="hljs-string">&quot;return redis.call(&#x27;del&#x27;,KEYS[1]) else return 0 end&quot;</span>;<br><br> <span class="hljs-keyword">return</span> jedis.eval(luaScript, Collections.singletonList(key), Collections.singletonList(value)).equals(<span class="hljs-number">1L</span>);<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-Controllerå±‚æ§åˆ¶"><a href="#4-Controllerå±‚æ§åˆ¶" class="headerlink" title="4. Controllerå±‚æ§åˆ¶"></a>4. Controllerå±‚æ§åˆ¶</h3><p>å®šä¹‰ä¸€ä¸ªTestControlleræ¥æµ‹è¯•æˆ‘ä»¬å®ç°çš„åˆ†å¸ƒå¼é”</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><br><span class="hljs-meta">@RestController</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestController</span> &#123;<br><br> <span class="hljs-meta">@RedisLock(key = <span class="hljs-string">&quot;redis_lock&quot;</span>)</span><br><br> <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/index&quot;</span>)</span><br><br> <span class="hljs-keyword">public</span> String index() &#123;<br><br> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br><br>    &#125;<br><br>&#125;<br><br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springä¸­çš„order</title>
    <link href="/article/402be486.html"/>
    <url>/article/402be486.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />è®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹Springä¸­çš„orderæ’åºè§„åˆ™:<ol><li>åŸºæœ¬åŸåˆ™:</li></ol><ul><li>orderå€¼è¶Šå°,ä¼˜å…ˆçº§è¶Šé«˜</li><li>é»˜è®¤æƒ…å†µä¸‹orderå€¼ä¸º0</li><li>orderå¯ä»¥æ˜¯è´Ÿæ•°,æ­£æ•°æˆ–0</li></ul><ol start="2"><li>å¸¸è§ä½¿ç”¨åœºæ™¯:</li></ol><p><code>// AOPåˆ‡é¢æ’åº @Order(1)   @Aspect public class LogAspect &#123;     //... &#125;  @Order(2) @Aspect  public class SecurityAspect &#123;     //... &#125;  // Filterè¿‡æ»¤å™¨æ’åº @Order(1) public class AuthenticationFilter implements Filter &#123;     //... &#125;  // äº‹ä»¶ç›‘å¬å™¨æ’åº @Order(1) public class EmailListener implements ApplicationListener&lt;OrderEvent&gt; &#123;     //... &#125;</code></p><ol start="3"><li>æ’åºè§„åˆ™:</li></ol><ul><li>ç›¸åŒç±»å‹çš„ç»„ä»¶æŒ‰orderå€¼ä»å°åˆ°å¤§æ’åº</li><li>orderå€¼ç›¸åŒæ—¶,æŒ‰ç…§ç±»åçš„å­—æ¯é¡ºåºæ’åº</li><li>æ²¡æœ‰æŒ‡å®šorderçš„é»˜è®¤å€¼ä¸ºæœ€ä½ä¼˜å…ˆçº§(Ordered.LOWEST_PRECEDENCE)</li></ul><ol start="4"><li>å®ç°æ–¹å¼:</li></ol><ul><li>ä½¿ç”¨@Orderæ³¨è§£</li><li>å®ç°Orderedæ¥å£</li><li>å®ç°PriorityOrderedæ¥å£(ä¼˜å…ˆçº§é«˜äºæ™®é€šOrdered)</li></ul><ol start="5"><li>æ³¨æ„äº‹é¡¹:</li></ol><ul><li>@Orderå¯¹@Autowiredæ³¨å…¥çš„ä¾èµ–é¡ºåºæ— æ•ˆ</li><li>è¦å¯¹@Autowiredæ³¨å…¥æ’åº,éœ€è¦ä½¿ç”¨@OrderByæ³¨è§£</li><li>PriorityOrderedæ¥å£çš„ä¼˜å…ˆçº§é«˜äº@Orderæ³¨è§£</li></ul><p>æ‰€ä»¥ç®€å•æ€»ç»“:orderå€¼è¶Šå° &#x3D; ä¼˜å…ˆçº§è¶Šé«˜ &#x3D; è¶Šå…ˆæ‰§è¡Œã€‚é€šè¿‡åˆç†è®¾ç½®orderå€¼,æˆ‘ä»¬å¯ä»¥æ§åˆ¶Springç»„ä»¶çš„æ‰§è¡Œé¡ºåºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>git é…ç½® github ç”¨æˆ·åå¯†ç </title>
    <link href="/article/ff88336e.html"/>
    <url>/article/ff88336e.html</url>
    
    <content type="html"><![CDATA[<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td></td><td># é…ç½®ç”¨æˆ·åå¯†ç </td></tr><tr><td></td><td>git config â€“global user.name username</td></tr><tr><td></td><td># ä½¿ç”¨ token</td></tr><tr><td></td><td>git config â€“global user.password token</td></tr><tr><td></td><td>git config â€“global user.emailÂ â€œemailâ€</td></tr><tr><td></td><td></td></tr><tr><td></td><td># è¾“å…¥çš„ç”¨æˆ·åå¯†ç å°†è¢«è®°ä½ï¼Œä¸ç”¨æ¯æ¬¡éƒ½è¾“å…¥äº†</td></tr><tr><td></td><td>git config â€“global credential.helper store</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸¤ä¸ªä»“åº“ä¹‹é—´å¦‚ä½•åŒæ­¥ä»£ç </title>
    <link href="/article/ccabb2b0.html"/>
    <url>/article/ccabb2b0.html</url>
    
    <content type="html"><![CDATA[<p>#æ‹‰å–Forkå‡ºæ¥çš„åˆ†æ”¯ <!-- toc --></p><meta name="referrer" content="no-referrer" />git clone Forkçš„åˆ†æ”¯url #æ³¨æ„ï¼šè¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢æ“ä½œ #æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹åº“(remote repo)çš„è¿œç¨‹url git remote -v #æ·»åŠ æºåˆ†æ”¯url git remote add upstream æ›¿æ¢æˆæºé¡¹ç›®url #æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹åº“(remote repo)çš„è¿œç¨‹url git remote -v #ä»æºåˆ†æ”¯è·å–æœ€æ–°çš„ä»£ç  git fetch upstream #åˆ‡æ¢åˆ°ä¸»åˆ†æ”¯ git checkout master #åˆå¹¶æœ¬åœ°åˆ†æ”¯å’Œæºåˆ†æ”¯,æœ¬åœ°åº“å’Œè¿œç¨‹çš„githubåŸä»“åº“åŒæ­¥ git merge upstream/master #pushåˆ°forkåˆ†æ”¯,æœ¬åœ°çš„ä»“åº“æäº¤åˆ°github git push origin master]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title> ä¸€æ–‡è§£è¯»exportsã€module.exports å’Œ exportã€export default</title>
    <link href="/article/9fd4703c.html"/>
    <url>/article/9fd4703c.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />### ç¬¬ä¸€éƒ¨åˆ†ï¼šexports å’ŒÂ [module](https://so.csdn.net/so/search?q=module&spm=1001.2101.3001.7020 "module").exports<p>ä¸ºäº†è®©<a href="https://so.csdn.net/so/search?q=Node&spm=1001.2101.3001.7020" title="Node">Node</a>.jsçš„æ–‡ä»¶å¯ä»¥ç›¸äº’è°ƒç”¨ï¼ŒNode.jsæä¾›äº†ä¸€ä¸ªç®€å•çš„æ¨¡å—ç³»ç»Ÿã€‚æ¨¡å—æ˜¯Node.js åº”ç”¨ç¨‹åºçš„åŸºæœ¬<a href="https://so.csdn.net/so/search?q=%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86&spm=1001.2101.3001.7020">ç»„æˆéƒ¨åˆ†</a>ï¼Œæ–‡ä»¶å’Œæ¨¡å—æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æ¢è¨€ä¹‹ï¼Œä¸€ä¸ª Node.js æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œè¿™ä¸ªæ–‡ä»¶å¯èƒ½æ˜¯JavaScript ä»£ç ã€JSON æˆ–è€…ç¼–è¯‘è¿‡çš„C&#x2F;C++ æ‰©å±•ã€‚</p><h4 id="1-exports"><a href="#1-exports" class="headerlink" title="1. exports"></a>1. exports</h4><h5 id="1-1-å¯¼å‡ºæ¨¡å—"><a href="#1-1-å¯¼å‡ºæ¨¡å—" class="headerlink" title="1.1 å¯¼å‡ºæ¨¡å—"></a>1.1 å¯¼å‡ºæ¨¡å—</h5><p>exports å¯¹è±¡æ˜¯ç”±æ¨¡å—ç³»ç»Ÿåˆ›å»ºçš„ã€‚åœ¨æˆ‘ä»¬è‡ªå·±å†™æ¨¡å—çš„æ—¶å€™ï¼Œéœ€è¦åœ¨æ¨¡å—æœ€åå†™å¥½æ¨¡å—æ¥å£ï¼Œå£°æ˜è¿™ä¸ªæ¨¡å—å¯¹å¤–æš´éœ²ä»€ä¹ˆå†…å®¹ï¼Œexports æä¾›äº†æš´éœ²æ¥å£çš„æ–¹æ³•ã€‚å¦‚ä¸‹ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>hello.jsvar sayHello = <span class="hljs-keyword">function</span> () &#123;    console.log(<span class="hljs-string">&#x27;hello&#x27;</span>)&#125;var sos = <span class="hljs-number">110</span>;var app = &#123;    name: <span class="hljs-string">&#x27;testApp&#x27;</span>,    version: <span class="hljs-string">&#x27;1.0.0&#x27;</span>,    help: <span class="hljs-keyword">function</span> () &#123;        console.log(<span class="hljs-string">&#x27;what can i do for you?&#x27;</span>)    &#125;&#125;<span class="hljs-regexp">//</span>å¯¼å‡ºä¸€ä¸ªæ–¹æ³•exports.sayHello = sayHello;<span class="hljs-regexp">//</span>å¯¼å‡ºä¸€ä¸ªå˜é‡exports.sos = sos;<span class="hljs-regexp">//</span>å¯¼å‡ºä¸€ä¸ªJSONå¯¹è±¡exports.app = app;<br></code></pre></td></tr></table></figure><p>æˆ–è€…å†™æˆä¸‹é¢çš„å½¢å¼ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">//hello.jsexports.sayHello = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span> &#123;    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)&#125;exports.sos = <span class="hljs-number">110</span>;exports.app = &#123;    name: <span class="hljs-string">&#x27;testApp&#x27;</span>,    version: <span class="hljs-string">&#x27;1.0.0&#x27;</span>,    help: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span> &#123;        console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;what can i do for you?&#x27;</span>)    &#125;&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œhello.js é€šè¿‡ exports å¯¹è±¡æŠŠ sayHello ä½œä¸ºæ¨¡å—çš„è®¿é—®æ¥å£ï¼Œåœ¨å…¶ä»–æ¨¡å—ï¼ˆæˆ–jsæ–‡ä»¶ï¼‰ä¸­é€šè¿‡ require(â€™.&#x2F;helloâ€™) åŠ è½½è¿™ä¸ªæ¨¡å—ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥è®¿ é—® hello.js ä¸­ exports å¯¹è±¡çš„æˆå‘˜<a href="https://marketing.csdn.net/p/3127db09a98e0723b83b2914d9256174?pId=2782&utm_source=glcblog&spm=1001.2101.3001.7020">å‡½æ•°</a>äº†ã€‚</p><h5 id="1-2-å¼•å…¥æ¨¡å—"><a href="#1-2-å¼•å…¥æ¨¡å—" class="headerlink" title="1.2 å¼•å…¥æ¨¡å—"></a>1.2 å¼•å…¥æ¨¡å—</h5><p>åœ¨ Node.js ä¸­ï¼Œå¼•å…¥ä¸€ä¸ªæ¨¡å—éå¸¸ç®€å•ï¼Œå¦‚ä¸‹æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª main.js æ–‡ä»¶å¹¶å¼•å…¥ hello æ¨¡å—ï¼Œä»£ç å¦‚ä¸‹:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//m</span>ain.jsvar hello = require(<span class="hljs-string">&#x27;./hello&#x27;</span>);<span class="hljs-regexp">//</span>è°ƒç”¨æ¨¡å—helloä¸­çš„æ–¹æ³•hello.sayHello();<span class="hljs-regexp">//</span>è°ƒç”¨æ¨¡å—helloä¸­çš„å˜é‡console.log(hello.sos)console.log(hello.app.version)<span class="hljs-regexp">//</span>è°ƒç”¨æ¨¡å—helloä¸­çš„JSONå¯¹è±¡å±æ€§hello.app.help()<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤ï¼ˆnode main.jsï¼‰è¿è¡Œmain.jsï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">hello1101</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>what can i do for you?<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šå®ä¾‹ä¸­ï¼Œä»£ç  require(â€™.&#x2F;helloâ€™) å¼•å…¥äº†å½“å‰ç›®å½•ä¸‹çš„ hello.js æ–‡ä»¶ï¼ˆ.&#x2F; ä¸ºå½“å‰ç›®å½•ï¼Œnode.js é»˜è®¤åç¼€ä¸º jsï¼‰ã€‚</p><p>Node.js æä¾›äº† exports å’Œ require ä¸¤ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­ exports æ˜¯æ¨¡å—å…¬å¼€çš„æ¥å£ï¼Œrequire ç”¨äºä»å¤–éƒ¨è·å–ä¸€ä¸ªæ¨¡å—çš„æ¥å£ï¼Œå³æ‰€è·å–æ¨¡å—çš„ exports å¯¹è±¡ã€‚</p><h4 id="2-module-exports"><a href="#2-module-exports" class="headerlink" title="2. module.exports"></a>2. module.exports</h4><h5 id="2-1-å¯¼å‡ºæ¨¡å—"><a href="#2-1-å¯¼å‡ºæ¨¡å—" class="headerlink" title="2.1 å¯¼å‡ºæ¨¡å—"></a>2.1 å¯¼å‡ºæ¨¡å—</h5><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›æŠŠä¸€ä¸ªå¯¹è±¡å°è£…åˆ°æ¨¡å—ä¸­ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">//hello.js <span class="hljs-keyword">function</span> Hello() &#123;    var <span class="hljs-type">name</span>;    var sos = <span class="hljs-string">&#x27;110&#x27;</span>;    this.setName = <span class="hljs-keyword">function</span> (thyName) &#123;        <span class="hljs-type">name</span> = thyName;    &#125;;    this.sayHello = <span class="hljs-keyword">function</span> () &#123;        console.log(<span class="hljs-string">&#x27;Hello &#x27;</span> + <span class="hljs-type">name</span>);    &#125;;    this.app = &#123;        <span class="hljs-type">name</span>: <span class="hljs-string">&#x27;testApp&#x27;</span>,        <span class="hljs-keyword">version</span>: <span class="hljs-string">&#x27;1.0.0&#x27;</span>,        help: <span class="hljs-keyword">function</span> () &#123;            console.log(<span class="hljs-string">&#x27;what can i do for you?&#x27;</span>)        &#125;    &#125;;&#125;;// æŠŠå˜é‡ã€æ–¹æ³•ã€<span class="hljs-type">JSON</span>å¯¹è±¡ç­‰å°è£…åœ¨ä¸€èµ·ï¼Œä¸€å¹¶å¯¼å‡ºmodule.exports = Hello;<br></code></pre></td></tr></table></figure><h5 id="2-2-å¼•å…¥æ¨¡å—"><a href="#2-2-å¼•å…¥æ¨¡å—" class="headerlink" title="2.2 å¼•å…¥æ¨¡å—"></a>2.2 å¼•å…¥æ¨¡å—</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//m</span>ain.jsvar Hello = require(<span class="hljs-string">&#x27;./hello&#x27;</span>)<span class="hljs-regexp">//</span>é€šè¿‡newå…³é”®å­—ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªhelloæ¨¡å—çš„å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡æ‰èƒ½è°ƒç”¨helloæ¨¡å—ç›¸å…³çš„æ–¹æ³•ã€‚hello = new Hello(); hello.setName(<span class="hljs-string">&quot;zhangSan&quot;</span>)hello.sayHello() console.log(hello.app.version)hello.app.help()<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤ï¼Œè¿è¡Œmain.jsï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Hello</span> zhangSan1.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>what can i do for you?<br></code></pre></td></tr></table></figure><h4 id="3-exports-å’Œ-module-exports-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#3-exports-å’Œ-module-exports-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3. exports å’Œ module.exports çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>3. exports å’Œ module.exports çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>ä¸Šé¢ä¸¤èŠ‚çš„å†…å®¹å¯ä»¥çŸ¥é“ï¼šç›¸è¾ƒäº exportsï¼Œæ¨¡å—æ¥å£çš„å”¯ä¸€å˜åŒ–æ˜¯ä½¿ç”¨ module.exports &#x3D; Hello ä»£æ›¿äº†exports.sayHello &#x3D; function(){}ï¼Œexports.sosï¼Œexports.appã€‚ åœ¨å¤–éƒ¨å¼•ç”¨è¯¥æ¨¡å—æ—¶ï¼Œå…¶æ¥å£å¯¹è±¡å°±æ˜¯è¦è¾“å‡ºçš„ Hello å¯¹è±¡æœ¬èº«ï¼Œè€Œä¸æ˜¯åŸå…ˆçš„ exportsã€‚</p><p>ä¸ºäº†ç›´è§‚åœ°å±•ç°ä¸¤è€…çš„å¼‚åŒç‚¹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸¤ä¸ªå®ä¾‹ï¼š</p><h5 id="3-1-exports-æ¨¡å¼ä¸‹ä¸¤è€…çš„å¼‚åŒ"><a href="#3-1-exports-æ¨¡å¼ä¸‹ä¸¤è€…çš„å¼‚åŒ" class="headerlink" title="3.1 exports æ¨¡å¼ä¸‹ä¸¤è€…çš„å¼‚åŒ"></a>3.1 exports æ¨¡å¼ä¸‹ä¸¤è€…çš„å¼‚åŒ</h5><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">//hello.jsvar sayHello = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span> &#123;    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)&#125;var sos = <span class="hljs-number">110</span>;var app = &#123;    name: <span class="hljs-string">&#x27;testApp&#x27;</span>,    version: <span class="hljs-string">&#x27;1.0.0&#x27;</span>,    help: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span> &#123;        console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;what can i do for you?&#x27;</span>)    &#125;&#125;exports.sayHello = sayHello;exports.sos = sos;exports.app = app;//æ‰“å°exportså’Œ<span class="hljs-built_in">module</span>.exportsçš„å†…å®¹console.<span class="hljs-built_in">log</span>(exports);console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">module</span>.exports);console.<span class="hljs-built_in">log</span>(exports === <span class="hljs-built_in">module</span>.exports);<br></code></pre></td></tr></table></figure><p>è¿è¡Œå¦‚ä¸‹ main.js ä»£ç ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//m</span>ain.jsvar Hello = require(<span class="hljs-string">&#x27;./exports_mode&#x27;</span>) Hello.sayHello()<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml">&#123;  <span class="hljs-attr">sayHello:</span> [<span class="hljs-attr">Function:</span> <span class="hljs-string">sayHello</span>],  <span class="hljs-attr">sos:</span> <span class="hljs-number">110</span>,  <span class="hljs-attr">app:</span> &#123; <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;testApp&#x27;</span>, <span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;1.0.0&#x27;</span>, <span class="hljs-attr">help:</span> [<span class="hljs-attr">Function:</span> <span class="hljs-string">help</span>] &#125;&#125;&#123;  <span class="hljs-attr">sayHello:</span> [<span class="hljs-attr">Function:</span> <span class="hljs-string">sayHello</span>],  <span class="hljs-attr">sos:</span> <span class="hljs-number">110</span>,  <span class="hljs-attr">app:</span> &#123; <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;testApp&#x27;</span>, <span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;1.0.0&#x27;</span>, <span class="hljs-attr">help:</span> [<span class="hljs-attr">Function:</span> <span class="hljs-string">help</span>] &#125;&#125;<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><blockquote><p>å¾ˆæ˜æ˜¾ï¼ï¼ï¼ exports å’Œ module.exports çš„å†…å®¹æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œæ¢è¨€ä¹‹ï¼šexports æŒ‡å‘çš„æ˜¯ module.exportsã€‚</p></blockquote><h5 id="3-2-module-exports-æ¨¡å¼ä¸‹ä¸¤è€…çš„å¼‚åŒ"><a href="#3-2-module-exports-æ¨¡å¼ä¸‹ä¸¤è€…çš„å¼‚åŒ" class="headerlink" title="3.2 module.exports æ¨¡å¼ä¸‹ä¸¤è€…çš„å¼‚åŒ"></a>3.2 module.exports æ¨¡å¼ä¸‹ä¸¤è€…çš„å¼‚åŒ</h5><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">//hello.jsfunction Hello() &#123;    var name;    this.setName = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(thyName)</span></span> &#123;        name = thyName;    &#125;;    this.sayHello = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span> &#123;        console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;Hello &#x27;</span> + name);    &#125;;    this.app = &#123;        name: <span class="hljs-string">&#x27;testApp&#x27;</span>,        version: <span class="hljs-string">&#x27;1.0.0&#x27;</span>,        help: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span> &#123;            console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;what can i do for you?&#x27;</span>)        &#125;    &#125;;&#125;; // æŠŠå˜é‡ã€æ–¹æ³•ã€JSONå¯¹è±¡ç­‰å°è£…åœ¨ä¸€èµ·ï¼Œä¸€å¹¶å¯¼å‡º<span class="hljs-built_in">module</span>.exports = Hello;//æ‰“å°exportså’Œ<span class="hljs-built_in">module</span>.exportsçš„å†…å®¹console.<span class="hljs-built_in">log</span>(exports);console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">module</span>.exports);console.<span class="hljs-built_in">log</span>(exports === <span class="hljs-built_in">module</span>.exports);<br></code></pre></td></tr></table></figure><p>è¿è¡Œmain.jså¦‚ä¸‹ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">var</span> Hello = require(<span class="hljs-string">&#x27;./exports_mode&#x27;</span>)hello = <span class="hljs-keyword">new</span> <span class="hljs-type">Hello</span>(); hello.setName(<span class="hljs-string">&quot;zhangSan&quot;</span>)hello.sayHello()<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;&#125;[<span class="hljs-keyword">Function</span>: Hello]falseHello zhangSan<br></code></pre></td></tr></table></figure><blockquote><p>å¾ˆæ˜æ˜¾ï¼ï¼ï¼module.exports æ¨¡å¼ä¸‹ï¼Œmodule.exports å’Œ exports çš„å†…å®¹æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œmodule.exports å¯¼å‡ºçš„æ˜¯æ¨¡å—ï¼ˆhello.jsï¼‰å¯¹è±¡æœ¬èº«ï¼ˆç±»åˆ«Javaï¼Œå¯ä»¥ç†è§£ä¸ºå¯¼å‡ºçš„æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸æ˜¯å®ä¾‹åŒ–çš„å¯¹è±¡ï¼‰ï¼Œåœ¨æ­¤åœºæ™¯ä¸‹ exports æ˜¯ç©ºçš„ï¼ˆç±»æ¯”Javaï¼Œç†è§£ä¸ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–å°±æ˜¯nullï¼‰ã€‚</p></blockquote><h5 id="3-3-å°ç»“"><a href="#3-3-å°ç»“" class="headerlink" title="3.3 å°ç»“"></a>3.3 å°ç»“</h5><p>åŸºäºä¸Šé¢çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºçš„ module.exports å¯¹è±¡å†…å®¹å°±æ˜¯ä¸€ä¸ª[Function]ï¼Œåœ¨ javascript é‡Œé¢æ˜¯ä¸€ä¸ªç±»ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ï¼š exports åªèƒ½å¯¹å¤–æš´éœ²å•ä¸ªå‡½æ•°ï¼Œä½†æ˜¯ module.exports å´èƒ½æš´éœ²ä¸€ä¸ªç±»ã€‚</p><h3 id="ç¬¬äºŒéƒ¨åˆ†ï¼šexport-å’Œ-export-default"><a href="#ç¬¬äºŒéƒ¨åˆ†ï¼šexport-å’Œ-export-default" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†ï¼šexport å’Œ export default"></a>ç¬¬äºŒéƒ¨åˆ†ï¼šexport å’Œ export default</h3><p>exports å’Œ module.exports æ˜¯Node.jsçš„æ¨¡å—ç³»ç»Ÿå…³é”®å­—ï¼Œè€Œ export å’Œ export default åˆ™æ˜¯ ES6æ¨¡å—ç³»ç»Ÿçš„å…³é”®å­—ã€‚å¾ˆæ˜æ˜¾ï¼Œä¸¤è€…å±äºä¸¤ä¸ªä½“ç³»ï¼š</p><blockquote><blockquote><p>require: node å’Œ es6 éƒ½æ”¯æŒçš„å¼•å…¥<br>export &#x2F; import : åªæœ‰es6 æ”¯æŒçš„å¯¼å‡ºå¼•å…¥<br>module.exports &#x2F; exports: åªæœ‰ node æ”¯æŒçš„å¯¼å‡º</p></blockquote></blockquote><h4 id="1-export"><a href="#1-export" class="headerlink" title="1.export"></a>1.export</h4><p>export ç”¨äºå¯¹å¤–è¾“å‡ºæœ¬æ¨¡å—ï¼ˆä¸€ä¸ªæ–‡ä»¶å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ¨¡å—ï¼‰å˜é‡çš„æ¥å£ï¼Œimport ç”¨äºåœ¨ä¸€ä¸ªæ¨¡å—ä¸­åŠ è½½å¦ä¸€ä¸ªå«æœ‰exportæ¥å£çš„æ¨¡å—ã€‚ä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨exportå‘½ä»¤å®šä¹‰äº†æ¨¡å—çš„å¯¹å¤–æ¥å£ä»¥åï¼Œå…¶ä»–JSæ–‡ä»¶å°±å¯ä»¥é€šè¿‡importå‘½ä»¤åŠ è½½è¿™ä¸ªæ¨¡å—ï¼ˆæ–‡ä»¶ï¼‰ã€‚è¿™å‡ ä¸ªéƒ½æ˜¯ES6çš„è¯­æ³•ã€‚</p><p>ç¤ºä¾‹1ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">//app.jsexport var name<span class="hljs-operator">=</span><span class="hljs-string">&quot;ZhangSan&quot;</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>app.jsvar name1=<span class="hljs-string">&quot;ZhangSan&quot;</span>;var name2=<span class="hljs-string">&quot;LiSi&quot;</span>;export &#123; name1 ,name2 &#125;<br></code></pre></td></tr></table></figure><h4 id="2-import"><a href="#2-import" class="headerlink" title="2.import"></a>2.import</h4><p>import ç”¨äºåœ¨ä¸€ä¸ªæ¨¡å—ä¸­åŠ è½½å¦ä¸€ä¸ªå«æœ‰exportæ¥å£çš„æ¨¡å—ã€‚å…·ä½“è§ä¸‹é¢çš„ç¤ºä¾‹ã€‚</p><p>å¯¹äºä¸Šé¢çš„ ç¤ºä¾‹1ï¼Œå¼•å…¥æ–¹å¼ä¸ºï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//m</span>ain.jsimport &#123; name &#125; from <span class="hljs-string">&quot;./app.js&quot;</span> <span class="hljs-regexp">//</span>è·¯å¾„æ ¹æ®å®é™…æƒ…å†µå¡«å†™<br></code></pre></td></tr></table></figure><p>å¯¹äºä¸Šé¢çš„ ç¤ºä¾‹2ï¼Œå¼•å…¥æ–¹å¼ä¸ºï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//m</span>ain.jsimport &#123; name1 , name2 &#125; from <span class="hljs-string">&quot;./app.js&quot;</span> <span class="hljs-regexp">//</span>è·¯å¾„æ ¹æ®å®é™…æƒ…å†µå¡«å†™<br></code></pre></td></tr></table></figure><h4 id="3-export-å’Œ-export-default"><a href="#3-export-å’Œ-export-default" class="headerlink" title="3.export å’Œ export default"></a>3.export å’Œ export default</h4><p>é€šè¿‡ä¸Šé¢è¿™å‡ ä¸ªä¾‹å­ï¼Œè¯»è€…ä¸€å®šäº†è§£äº†å¦‚ä½•ä½¿ç”¨exportï¼Œimportï¼Œå¦‚æœè¿˜æ˜¯ä¸æ‡‚å¯ä»¥è‡ªå·±åŠ¨æ‰‹è¯•ä¸€è¯•ã€‚ä¸Šé¢è®²çš„æ˜¯exportå’Œimportï¼Œä½†æ˜¯exportè·Ÿexport default æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå¦‚ä¸‹ï¼š</p><p>exportä¸export defaultå‡å¯ç”¨äºå¯¼å‡ºå¸¸é‡ã€å‡½æ•°ã€æ–‡ä»¶ã€æ¨¡å—ç­‰ï¼›<br>ä½ å¯ä»¥åœ¨å…¶å®ƒæ–‡ä»¶æˆ–æ¨¡å—ä¸­é€šè¿‡import+(å¸¸é‡ | å‡½æ•° | æ–‡ä»¶ | æ¨¡å—)åçš„æ–¹å¼ï¼Œå°†å…¶å¯¼å…¥ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œä½¿ç”¨ï¼›<br>åœ¨ä¸€ä¸ªæ–‡ä»¶æˆ–æ¨¡å—ä¸­ï¼Œexportã€importå¯ä»¥æœ‰å¤šä¸ªï¼Œexport defaultä»…æœ‰ä¸€ä¸ªï¼›<br>é€šè¿‡exportæ–¹å¼å¯¼å‡ºï¼Œåœ¨å¯¼å…¥æ—¶è¦åŠ { }ï¼Œexport defaultåˆ™ä¸éœ€è¦<br>å®é™…ä¸Šï¼Œå¾ˆå¤šæ—¶å€™exportä¸export defaultå¯ä»¥å®ç°åŒæ ·çš„ç›®çš„ï¼Œåªæ˜¯ç”¨æ³•æœ‰äº›åŒºåˆ«ã€‚æ³¨æ„ç¬¬4æ¡ï¼Œé€šè¿‡exportæ–¹å¼å¯¼å‡ºï¼Œåœ¨å¯¼å…¥æ—¶è¦åŠ { }ï¼Œexport defaultåˆ™ä¸éœ€è¦ã€‚ä½¿ç”¨export defaultå‘½ä»¤ï¼Œä¸ºæ¨¡å—æŒ‡å®šé»˜è®¤è¾“å‡ºï¼Œè¿™æ ·å°±ä¸éœ€è¦çŸ¥é“æ‰€è¦åŠ è½½æ¨¡å—çš„å˜é‡åã€‚</p><h3 id="ç¬¬ä¸‰éƒ¨åˆ†ï¼šCommonJS-å’Œ-ES6"><a href="#ç¬¬ä¸‰éƒ¨åˆ†ï¼šCommonJS-å’Œ-ES6" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ†ï¼šCommonJS å’Œ ES6"></a>ç¬¬ä¸‰éƒ¨åˆ†ï¼šCommonJS å’Œ ES6</h3><h4 id="1-CommonJS"><a href="#1-CommonJS" class="headerlink" title="1. CommonJS"></a>1. CommonJS</h4><p>Nodeé‡Œé¢çš„æ¨¡å—ç³»ç»Ÿéµå¾ªçš„æ˜¯CommonJSè§„èŒƒã€‚é‚£é—®é¢˜åˆæ¥äº†ï¼Œä»€ä¹ˆæ˜¯CommonJSè§„èŒƒå‘¢ï¼Ÿç”±äºjsä»¥å‰æ¯”è¾ƒæ··ä¹±ï¼Œå„å†™å„çš„ä»£ç ï¼Œæ²¡æœ‰ä¸€ä¸ªæ¨¡å—çš„æ¦‚å¿µï¼Œè€Œè¿™ä¸ªè§„èŒƒå‡ºæ¥å…¶å®å°±æ˜¯å¯¹æ¨¡å—çš„ä¸€ä¸ªå®šä¹‰ã€‚</p><p>CommonJSå®šä¹‰çš„æ¨¡å—åˆ†ä¸º:</p><blockquote><blockquote><p>æ¨¡å—æ ‡è¯†(module)ã€æ¨¡å—å®šä¹‰(exports) ã€æ¨¡å—å¼•ç”¨(require)</p></blockquote></blockquote><h5 id="1-1-exports-å’Œ-module-exports"><a href="#1-1-exports-å’Œ-module-exports" class="headerlink" title="1.1 exports å’Œ module.exports"></a>1.1 exports å’Œ module.exports</h5><p>åœ¨ä¸€ä¸ªnodeæ‰§è¡Œä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä¼šç»™è¿™ä¸ªæ–‡ä»¶å†…ç”Ÿæˆä¸€ä¸ª exportså’Œmoduleå¯¹è±¡ï¼Œè€Œmoduleåˆæœ‰ä¸€ä¸ªexportså±æ€§ã€‚ä»–ä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾ï¼Œéƒ½æŒ‡å‘ä¸€å—{}å†…å­˜åŒºåŸŸã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">exports</span> <span class="hljs-operator">=</span> module.exports <span class="hljs-operator">=</span> &#123;&#125;<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/62ec231d5f74446cb4347dfd6ca596a7.png">Â </p><p>å®é™…ä¸Šï¼Œrequireå¯¼å‡ºçš„å†…å®¹æ˜¯module.exportsçš„æŒ‡å‘çš„å†…å­˜å—å†…å®¹ï¼Œå¹¶ä¸æ˜¯exportsçš„ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒåŒºåˆ†ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«å°±æ˜¯ exports åªæ˜¯ module.exportsçš„å¼•ç”¨ï¼Œè¾…åŠ©åè€…æ·»åŠ å†…å®¹ç”¨çš„ã€‚</p><h5 id="1-2-æ³¨æ„äº‹é¡¹"><a href="#1-2-æ³¨æ„äº‹é¡¹" class="headerlink" title="1.2 æ³¨æ„äº‹é¡¹"></a>1.2 æ³¨æ„äº‹é¡¹</h5><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸ºäº†é¿å…ç³Šæ¶‚ï¼Œå°½é‡éƒ½ç”¨ module.exports å¯¼å‡ºï¼Œç„¶åç”¨requireå¯¼å…¥ã€‚</p><h4 id="2-ES6"><a href="#2-ES6" class="headerlink" title="2. ES6"></a>2. ES6</h4><p>ES6ï¼Œ å…¨ç§° ECMAScript 6.0 ï¼Œæ˜¯ JavaScript çš„ä¸‹ä¸€ä¸ªç‰ˆæœ¬æ ‡å‡†ï¼Œ2015.06 å‘ç‰ˆã€‚ES6 ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ ES5 çš„å…ˆå¤©ä¸è¶³ï¼Œæ¯”å¦‚ JavaScript é‡Œå¹¶æ²¡æœ‰ç±»çš„æ¦‚å¿µï¼Œä½†æ˜¯ç›®å‰æµè§ˆå™¨çš„ JavaScript æ˜¯ ES5 ç‰ˆæœ¬ï¼Œå¤§å¤šæ•°é«˜ç‰ˆæœ¬çš„æµè§ˆå™¨ä¹Ÿæ”¯æŒ ES6ï¼Œä¸è¿‡åªå®ç°äº† ES6 çš„éƒ¨åˆ†ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚</p><p>åœ¨ ES6 å‰ï¼Œ å®ç°æ¨¡å—åŒ–ä½¿ç”¨çš„æ˜¯ RequireJS æˆ–è€… seaJSï¼ˆåˆ†åˆ«æ˜¯åŸºäº AMD è§„èŒƒçš„æ¨¡å—åŒ–åº“ï¼Œ å’ŒåŸºäº CMD è§„èŒƒçš„æ¨¡å—åŒ–åº“ï¼‰ã€‚ES6 å¼•å…¥äº†æ¨¡å—åŒ–ï¼Œå…¶è®¾è®¡æ€æƒ³æ˜¯åœ¨ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šæ¨¡å—çš„ä¾èµ–å…³ç³»ï¼Œä»¥åŠè¾“å…¥å’Œè¾“å‡ºçš„å˜é‡ã€‚</p><blockquote><p>ES6 çš„æ¨¡å—åŒ–åˆ†ä¸ºå¯¼å‡ºï¼ˆexportï¼‰ ä¸å¯¼å…¥ï¼ˆimportï¼‰ä¸¤ä¸ªæ¨¡å—ã€‚</p></blockquote><h5 id="2-1-ES6-çš„ç‰¹ç‚¹"><a href="#2-1-ES6-çš„ç‰¹ç‚¹" class="headerlink" title="2.1 ES6 çš„ç‰¹ç‚¹"></a>2.1 ES6 çš„ç‰¹ç‚¹</h5><ul><li>ES6 çš„æ¨¡å—è‡ªåŠ¨å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¸ç®¡ä½ æœ‰æ²¡æœ‰åœ¨æ¨¡å—å¤´éƒ¨åŠ ä¸Š use strict;</li><li>æ¨¡å—ä¸­å¯ä»¥å¯¼å…¥å’Œå¯¼å‡ºå„ç§ç±»å‹çš„å˜é‡ï¼Œå¦‚å‡½æ•°ï¼Œå¯¹è±¡ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œå¸ƒå°”å€¼ï¼Œç±»ç­‰ã€‚</li><li>æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼Œæ¯ä¸€ä¸ªæ¨¡å—å†…å£°æ˜çš„å˜é‡éƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚</li><li>æ¯ä¸€ä¸ªæ¨¡å—åªåŠ è½½ä¸€æ¬¡ï¼ˆæ˜¯å•ä¾‹çš„ï¼‰ï¼Œ è‹¥å†å»åŠ è½½åŒç›®å½•ä¸‹åŒæ–‡ä»¶ï¼Œç›´æ¥ä»å†…å­˜ä¸­è¯»å–ã€‚</li></ul><h5 id="2-2-åŸºæœ¬ç”¨æ³•"><a href="#2-2-åŸºæœ¬ç”¨æ³•" class="headerlink" title="2.2 åŸºæœ¬ç”¨æ³•"></a>2.2 åŸºæœ¬ç”¨æ³•</h5><ul><li>æ¨¡å—å¯¼å…¥å¯¼å‡ºå„ç§ç±»å‹çš„å˜é‡ï¼Œå¦‚å­—ç¬¦ä¸²ï¼Œæ•°å€¼ï¼Œå‡½æ•°ï¼Œç±»ã€‚</li><li>å¯¼å‡ºçš„å‡½æ•°å£°æ˜ä¸ç±»å£°æ˜å¿…é¡»è¦æœ‰åç§°ï¼ˆexport default å‘½ä»¤å¦å¤–è€ƒè™‘ï¼‰ã€‚</li><li>ä¸ä»…èƒ½å¯¼å‡ºå£°æ˜è¿˜èƒ½å¯¼å‡ºå¼•ç”¨ï¼ˆä¾‹å¦‚å‡½æ•°ï¼‰ã€‚</li><li>export å‘½ä»¤å¯ä»¥å‡ºç°åœ¨æ¨¡å—çš„ä»»ä½•ä½ç½®ï¼Œä½†å¿…éœ€å¤„äºæ¨¡å—é¡¶å±‚ã€‚</li><li>import å‘½ä»¤ä¼šæå‡åˆ°æ•´ä¸ªæ¨¡å—çš„å¤´éƒ¨ï¼Œé¦–å…ˆæ‰§è¡Œã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½ å¬æˆ‘è¯´æˆ‘çš„çƒ¦æ¼</title>
    <link href="/article/b3200b03.html"/>
    <url>/article/b3200b03.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />1. ä¸€å¹´åˆå¿«åˆ°å¤´äº†ï¼Œä»Šå¹´æ·»äº†å®å®æ„Ÿè§‰æ—¶é—´è¿‡å¾—æ›´å¿«äº†ã€‚ä¸çŸ¥é“è¯´äº›å•¥ï¼Œéšä¾¿è¯´å§ã€‚  2. é”€å”®ç¯‡ï¼š20å¹´ä¹°äº†æˆ¿ï¼Œä¹°æˆ¿æ—¶ï¼Œæˆ‘è¡¨å§è¯´æœ‰ä¸ªç†Ÿäººé‚»å±…åœ¨åœ°äº§å…¬å¸ï¼Œç„¶åå½“æ—¶å»çœ‹äº†ç°æˆ¿ï¼Œå½“æ—¶è¯´çš„æœ‰ä¸ª98å¹³å…·ä½“æ¥¼å±‚è®°ä¸æ¸…äº†ï¼Œè¿˜æœ‰ä¸ª16å°é«˜ é¡¶æ¥¼128ï¼Œè¿˜æœ‰ä¸ª144ï¼Œå»çœ‹æˆ¿æ—¶ä¸‹é›¨å¤©ï¼Œé”€å”®è¯´98çš„åˆšå®šå‡ºå»ï¼Œï¼ˆåæ¥æƒ³æƒ³æœ‰å¯èƒ½æ˜¯ä¸ªå‘ï¼Œæƒ³å–å¤§æˆ·å‹ï¼‰ï¼Œå°±å»çœ‹äº†128çš„ï¼Œæˆ¿å­æ–¹æ­£ï¼Œå½“æ—¶ä¹Ÿæ²¡æƒ³ç€å»æ¥¼é¡¶çœ‹çœ‹ã€‚144çš„ç‹¬ç«‹ç”µæ¢¯ï¼Œæˆ·å‹æ¯”128å¤šä¸ªæˆ¿é—´ï¼Œå¿˜äº†å»æ²¡å»çœ‹äº†ã€‚ç„¶åå»å¦å¤–ä¸€ä¸ªæ¥¼ç›˜çœ‹äº†ï¼ŒæœŸæˆ¿ï¼Œ30å¤šå±‚ï¼Œåªæœ‰28å±‚äº†ï¼Œå»äº†å¦å¤–ä¸€ä¸ªæ¥¼ç›˜ï¼ŒæœŸæˆ¿ï¼Œæˆ¿å‹ä¹Ÿå¾ˆå¤šï¼Œå½“æ—¶ç®—äº†ç®—é¦–ä»˜å•¥çš„è®¢äº†128å¹³ï¼Œè®°å¾—äº¤é¦–ä»˜å¥½åƒé”€å”®åˆè¯´äº†å•¥ï¼Œå¾ˆåŒ†å¿™çš„äº¤äº†ï¼Œå…·ä½“ä¹Ÿè®°ä¸æ¸…äº†ï¼Œæ„Ÿè§‰ä¹Ÿæ˜¯æœ‰å‘ã€‚å½“æ—¶è‡ªå·±æ‰“è½¦å»çš„ï¼Œé”€å”®è¿˜ç»™æŠ¥é”€äº†æ‰“è½¦è´¹ï¼Œç¬¬ä¸€æ¬¡çŸ¥é“45wåŸæ¥é‚£ä¹ˆé‡ã€‚  3. è£…ä¿®ç¯‡ï¼šä¹‹åå°±æ˜¯è£…ä¿®ï¼Œå½“æ—¶æ‰¾äº†ä¸šä¹‹å³°ï¼ŒåŸå¸‚äººå®¶ï¼Œè¿˜ç™½å«–äº†äººå®¶èµ å“ï¼Œåæ¥è§‰å¾—æŠ¥ä»·é«˜ï¼Œæ¥¼ä¸‹æœ‰é‚£ç§ç§äººè£…ä¿®çš„æ‹‰æ´»ï¼Œçœ‹äº†çœ‹ä»–ä»¬è£…ä¿®çš„å‡ å®¶ï¼Œè¿˜ç®—å¯ä»¥å°±è®¢äº†ã€‚è£…ä¿®è¿‡ç¨‹æ¯”è¾ƒé¡ºåˆ©ï¼Œè£…ä¿®å®Œä¹‹åä¸¤ä¸ªæœˆï¼Œç§Ÿçš„æˆ¿å­æ­£å¥½åˆ°æœŸå°±ä½è¿›å»äº†ã€‚å½“æ—¶è£…ä¿®çš„å¸¦å®¢æˆ·å»æˆ‘ä»¬å®¶å‚è§‚æ—¶ï¼Œäººå®¶ä¸€ä¸ªäººè¯´ï¼Œè¿™ä¸ªæˆ¿é¡¶æ€ä¹ˆä¸å¹³å•Šï¼Œå½“æ—¶æ²¡åœ¨æ„ï¼Œåæ¥æƒ³æƒ³åº”è¯¥æ˜¯æ¼†é¢æ²¡åˆ·å¹³ï¼Œç„¶åä¸»å§çš„å¢™ä¸Šæœ‰å¤©å‡ºäº†ä¸€é“è£‚çº¹æ‰¾äº†è£…ä¿®ä»–ä»¬è¯´è¿™æ˜¯æ–½å·¥æ´ï¼Œè¯´è¿™æ˜¯å¼€å‘å•†è´£ä»»ï¼Œå°±æ‰¾äº†å¼€å‘å•†ï¼Œæ¥äº†ä¸ªå·¥äººè¯´è¦ä¿®å¤å°±åªèƒ½é“²äº†å¢™çš®ï¼Œé‡æ–°æŒ‚ç½‘ï¼Œå½“æ—¶å› ä¸ºè‡ªå·±ä¸€ä¸ªäººæˆ–è€…æ‡’ï¼Œä¹Ÿæ²¡æœ‰ç®¡ã€‚  4. å¼€å‘å•†ç¯‡ï¼šä½äº†å¤§çº¦åŠå¹´åï¼Œå‘ç°é˜³å°ä¸Šè§’ä¸Šæœ‰ç‚¹é˜´æ°´ï¼Œæ‰¾äº†ç‰©ä¸šï¼Œç‰©ä¸šæ‰¾äº†å¼€å‘å•†ï¼Œå½“æ—¶è¯´æ˜¯æˆ‘ä»¬è‡ªå·±å°çª—æˆ·æ—¶ï¼Œæ²¡æ‰“èƒ¶ï¼Œé›¨æ°´æµ¸è¿›æ¥çš„ï¼Œæ‰¾äº†å°çª—æˆ·çš„é‡æ–°æ‰“äº†èƒ¶ï¼Œåˆ°äº†ç¬¬äºŒå¹´å‘ç°è¿˜æ˜¯æœ‰ï¼Œåªè¦ä¸‹å¤§é›¨å°±ä¼šé˜´ï¼Œè¯´æ˜¯å¤–é¢é›¨æ°´æ¼æ–—æº…æ°´å¯¼è‡´çš„ï¼Œå…ˆç»™æŠŠæ¼æ–—æé«˜äº†ä¸€ä¸‹ï¼Œé›¨æ°´ä¸ä¹±æµ¸ï¼Œä¹Ÿæ²¡å•¥æ•ˆæœï¼Œå°±æŠŠæ¼æ–—å»äº†ï¼Œæ¢æˆç›´æ¥çš„äº†ï¼Œé›¨å­£ä¹Ÿè¿‡å»äº†ï¼Œåˆ°äº†ç¬¬ä¸‰å¹´ï¼Œå‘ç°è¿˜æ˜¯æµ¸æ°´ï¼Œå¼€å‘å•†æ¥ç»™æ‰“äº†èƒ¶ï¼Œä»Šå¹´å‘ç°æ‰“èƒ¶çš„åœ°æ–¹ä¸é˜´æ°´äº†ï¼Œå…¶ä»–åœ°æ–¹å¼€å§‹äº†ï¼Œä»Šå¹´æœ‰æ‰¾äº†ä»–ä»¬ï¼Œè®©ä»–ä»¬ç»™æ¥¼é¡¶åšäº†ä¸€ä¸‹é˜²æ°´ï¼Œåªèƒ½æ˜å¹´é›¨å­£è§‚å¯Ÿäº†ã€‚æ˜å¹´å°±æ˜¯é˜²æ°´ä¿ä¿®æœŸæœ€åä¸€å¹´äº†ï¼Œä¸çŸ¥é“è¿‡äº†ä¹‹åå†æ‰¾è°ã€‚  5. ä½æˆ¿å™ªéŸ³ç¯‡ï¼š20å¹´10æœˆä½è¿›æ¥ä¹‹åï¼Œè‡ªå·±æ‰‹é‡Œä¹Ÿæ²¡é’±ï¼Œåªä¹°äº†ä¸€å¼ åºŠè‡ªå·±ç¡ï¼Œä¹°äº†ä¸ªé­”æœ¯è´´çª—å¸˜ï¼Œå‘¨æœ«æ²¡äº‹å°±æ‰“æ‰“æ¸¸æˆï¼Œç›´åˆ°æœ‰ä¸€å¤©å¿½ç„¶å¬è§æ—©ä¸Šæœ‰äººå”±æ­Œï¼Œå°±å¾ˆè’™ï¼Œå£°éŸ³å¾ˆæ¸…æ¥šï¼Œå‘ç°æ˜¯æ—è¾¹å•å…ƒå£°éŸ³ï¼Œæˆ‘è®°å¾—åˆšåˆšäº¤æˆ¿æ—¶å¸¦æˆ‘å¦ˆæ¥çœ‹ï¼Œæˆ‘å§å®¶å‡ ä¸ªå­©å­ä¹Ÿæ¥ï¼Œåœ¨æˆ¿é—´é‡Œè·‘ï¼Œå–Šï¼Œæˆ‘å¦ˆè¯´è¿™æˆ¿å­æ€ä¹ˆè¿™ä¹ˆyingçš„æ…Œï¼ˆæ–¹è¨€åµï¼‰ï¼Œç»ˆäºçŸ¥é“æˆ¿é—´éš”éŸ³å¾ˆå·®ï¼Œç„¶ååé¢ä»–ä»¬å¥½åƒæ‰“æ¸¸æˆå¾ˆå¤§å£°éŸ³ï¼Œæ‰¾ç‰©ä¸šæŠ•è¯‰äº†ï¼Œå†åæ¥å¥½åƒä»–ä»¬å°±æ¬èµ°äº†ï¼Œæ–°æ¬æ¥çš„ä¸€æˆ·ï¼Œæˆ‘å‘ç°ä»–ä»¬å¥½åƒä¸åœ¨ä¸»å§ä½ï¼Œä¸çŸ¥é“æ˜¯ä¸šä¸»è¿˜æ˜¯ç§Ÿæˆ·ã€‚ç„¶åæ™šä¸Šç»å¸¸å¬åˆ°å’šä¸€å£°ï¼Œå‘ç°æ˜¯æ¥¼ä¸‹å…³å§å®¤é—¨å£°ï¼Œå¼€å…³ç¯å£°éƒ½å¾ˆæ¸…æ¥šï¼Œç›´åˆ°ç–«æƒ…å±…å®¶éš”ç¦»æ—¶ï¼Œæœ‰å¤©æ™šä¸Šå¾ˆæ™šä»–ä»¬å®¶è¿˜ä¸€ç›´åµï¼Œå°±ä¸¾æŠ¥äº†ä»–ä»¬ï¼Œè¿‡äº†æ²¡å¤šä¹…å¥½åƒåˆæ¬èµ°äº†ï¼Œè¿™ä¸¤å¹´æˆ‘å’Œå¯¹è±¡ä¸€ç›´ä½åœ¨å°æ¬¡å§ï¼Œå°æ¬¡å§ç›¸å¯¹å®‰é™ï¼Œ23å¹´ç»“äº†å©šï¼Œ10æœˆå·¦å³å‘ç°æœ‰äº†å®å®ï¼Œå½“æ—¶ä»–ä»¬æ¬èµ°äº†åŸºæœ¬æ²¡ä»€ä¹ˆå£°éŸ³ï¼Œç›´åˆ°æœ‰ä¸€å¤©æ¥¼ä¸‹2,3ç‚¹æœ‰å®å’šå£°ï¼Œæˆ‘ä¸‹å»æ‰¾äº†ä»–ä»¬ï¼Œæ˜¯ä¸€å¯¹å°æƒ…ä¾£æ–°æ¬æ¥åœ¨æ”¶æ‹¾ç©ºè°ƒï¼Œä¹‹åå‡ å¤©æ²¡å•¥å£°éŸ³ï¼Œå¿½ç„¶å¬åˆ°æ™šä¸Šæœ‰äººå¾ˆå¤§å£°åœ¨å–Šï¼Œåƒæ˜¯æ‰“æ¸¸æˆï¼Œä¸€ç›´åˆ°äº†å‡Œæ™¨4ç‚¹ï¼Œæˆ‘æ²¡ç¡ç€ï¼Œç›´æ¥å»æ¥¼ä¸‹æ‰¾äº†ä»–ä»¬ï¼Œå‘ç°å¼€é—¨çš„ä¸æ˜¯ä¹‹å‰çš„æƒ…ä¾£ï¼Œå’Œä»–ä»¬èŠå‘ç°ä»–ä»¬æ˜¯ææ¸¸æˆç›´æ’­çš„ï¼Œé‚£å¯¹å°æƒ…ä¾£ä½åœ¨ä¸»å§ï¼Œå°æ¬¡å§ä»–ä»¬æ‰“æ¸¸æˆï¼Œé¢†ä¸€ä¸ªæ¬¡å§ä¹Ÿä½äº†ä¸ªå¥³çš„æç›´æ’­ï¼Œä¹‹åæœ‰å› ä¸ºä»–ä»¬å¤§åŠå¤œ2ç‚¹å¤šå‰æ’éª¨ï¼Œæ‰¾äº†ä»–ä»¬ï¼Œç„¶åè¿‡å®Œå¹´ä»–ä»¬ä¹Ÿéƒ½æ¬èµ°äº†ï¼Œæˆ¿ä¸œå»å¹´å°±åœ¨å–æˆ¿ï¼Œæ²¡å–å‡ºå»ï¼Œä»Šå¹´5æœˆå®å®å‡ºç”Ÿï¼Œç„¶åæ¥¼ä¸‹6æœˆå–äº†å‡ºå»ï¼Œè£…ä¿®ç”µé’»å£°ï¼ŒæŠŠå­©å­å“å“­å¥½å‡ æ¬¡ï¼Œä½†æ˜¯äººå®¶æ­£å¸¸æ—¶é—´è£…ä¿®ä¹Ÿæ²¡æ‰¾ä»–ä»¬ã€‚æœ€è¿‘æ™šä¸Šä¸€ç‚¹å¤šéšéšçº¦çº¦å¬åˆ°æœ‰äººè¯´è¯å£°ï¼Œè¿˜æœ‰è¯ºå‡³å­å£°ï¼Œæ¥¼ä¸‹æ²¡äººï¼Œæ—è¾¹å•å…ƒä¸»å§æ²¡äººä½ï¼Œæ—è¾¹èƒ¡æ²¡å–å‡ºå»ï¼Œå®šä½åˆ°æ˜¯æ—è¾¹æˆ·å‹æ¥¼ä¸‹çš„äººï¼Œä¹‹å‰å°±çœ‹åˆ°ä»–ä»¬æ¬è¿‡æ¥ï¼Œæ²¡æƒ³åˆ°è¿˜ä¼šæœ‰äº¤é›†ï¼Œä»–ä»¬ä¸€ç›´æŒç»­å™ªéŸ³åˆ°æ—©ä¸Šï¼Œä¸‹æ¥¼ä¸Šç­æ—¶ï¼Œçœ‹åˆ°ä»–ä»¬ï¼Œä»ä»–ä»¬å°ç”µé©´çœ‹åº”è¯¥æ˜¯é€å¤–å–çš„ï¼Œå’Œä»–ä»¬èŠå¤©å‘ç°æµ‘èº«é…’æ°”ï¼Œä»–ä»¬å·²ç»ä¸¤æ¬¡å–é…’åˆ°å‡Œæ™¨äº†ï¼Œå’Œä»–ä»¬äº¤æµäº†ï¼Œä¸çŸ¥é“æ¥ä¸‹æ¥å•¥æ—¶å€™å†æ¥ä¸€æ¬¡ã€‚  6. å¦å¤–ä¸€ä¸ªå™ªéŸ³æ¥æºä¹Ÿæ˜¯ä¸€ç›´æŒç»­çš„å°±æ˜¯æ¥¼é¡¶ï¼Œä»ä½è¿›æ¥ä¸€å¹´ä¹‹åï¼Œå‘ç°æœ‰äººç»å¸¸ä¸Šæ¥¼é¡¶æ™¾æ™’ï¼Œæœ‰æ—¶ä¸­åˆç¡è§‰ï¼Œä¹Ÿä¼šè¢«å’šå’šå£°åµé†’ï¼Œåˆšå¼€å§‹è¿˜æœ‰åœ¨æ¥¼é¡¶é›ç‹—ï¼Œè·³ç»³ï¼ŒåŠå—“å­çš„ï¼Œå°±ä¸Šæ¥¼å»åŠå‘Šä»–ä»¬ï¼Œä½†æ˜¯æ™¾æ™’çš„è¿˜æ˜¯æœ‰äººï¼Œè”ç³»äº†ç‰©ä¸šï¼Œç‰©ä¸šä¹Ÿæ˜¯ä¸å…è®¸æ™¾æ™’çš„ï¼Œä½†æ˜¯æ¥¼é¡¶é—¨æ¶ˆé˜²ä¸Šä¸è®©å…³é€ƒç”Ÿé€šé“ï¼Œç‰©ä¸šå°±ç»™æ”¶äº†å‡ æ¬¡æ™¾è¡£ç»³ï¼Œä½†æ˜¯ä¸Šé¢æœ‰è¡£ç‰©çš„ä»–ä»¬ä¹Ÿä¸æ•¢æ”¶ï¼Œå…¶å®ä¸€ä¸ªæœˆæ™¾æ™’ä¸€æ¬¡ä¹Ÿæ²¡å•¥ï¼Œæ¥¼é¡¶é˜³å…‰é‚£ä¹ˆå¥½ï¼Œä½†æ˜¯å°±çƒ¦çš„æ˜¯å½“æˆè‡ªå®¶çš„æ¯å¤©éƒ½å¾€ä¸Šçˆ¬ï¼Œæ¥¼é‡Œå°±æœ‰ä¸ªå¥³çš„æ¯ä¸ªå‘¨æœ«éƒ½å¾€ä¸Šå»ï¼Œä¸ç®¡é˜´å¤©æ™´å¤©ã€‚æœ€è¿‘è¢«ä»–æŠ˜è…¾çƒ¦äº†ï¼Œåœ¨ç‰©ä¸šç¾¤é‡Œè¯´äº†ä»–ä»¬ï¼Œå†ä¸è¡Œå°±åªèƒ½ä»¥æ¶æ²»æ¶äº†  å½“æ—¶ä¹°æˆ¿æ—¶150w,é¦–ä»˜45ï¼Œè´·æ¬¾105,ä»æœˆä¾›5700å¤šåˆ°ç°åœ¨4700å¤šï¼Œç®—äº†ç®—æœ¬é‡‘åªè¿˜äº†7w,20å¤šæ˜¯åˆ©æ¯ï¼Œå»å¹´ç»“å©šåï¼Œæ”¶çš„ç¤¼é’±ï¼Œ+æˆ‘å’Œåª³å¦‡å…¬ç§¯é‡‘+å­©å­çš„ç¤¼é’±ï¼Œä¸€å…±è¿˜äº†22w,è¿˜å‰©75wï¼Œå¸Œæœ›æŠ“ç´§è¿˜å®Œï¼Œä¸‹ä¸€å¥—æˆ¿ä¸€å®šè¦å¥½å¥½å¸å–æ•™è®­ï¼Œå…¶å®æˆ‘è§‰å¾—è€ç ´å°æŒºå¥½çš„ï¼Œæˆ‘å–œæ¬¢æ—©ç¡ï¼Œåœ¨è€å®¶å°åŒº8ç‚¹å°±æ²¡å•¥äººäº†ã€‚  å¸Œæœ›ä½ çœ‹å®Œèƒ½å¯¹ä½ ä¹°æˆ¿å…¥å‘æœ‰æ‰€å¸®åŠ©ã€‚èº«è¾¹äººéƒ½è¯´æˆ‘ä¸çˆ±ç¬‘äº†ï¼Œå¤´å‘ä¹Ÿç™½äº†å¾ˆå¤šï¼Œéƒ½é—®æˆ‘æ„ä»€ä¹ˆï¼Œæœ‰è½¦æœ‰æˆ¿ã€‚æˆ‘ä¹Ÿä¸çŸ¥é“å¦‚ä½•ç»™ä»–ä»¬è¯´ã€‚å¹¸äºæˆ‘è€å©†ç¡è§‰ç†Ÿå¾ˆå¤šå™ªéŸ³å¥¹å¬ä¸åˆ°ï¼Œä¸ç„¶æˆ‘ä¼šæ›´ç„¦è™‘å“ˆå“ˆå“ˆå“ˆå“ˆã€‚]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>JSæ“ä½œç¬¦</title>
    <link href="/article/f1ff5bd.html"/>
    <url>/article/f1ff5bd.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /><p><code>?.</code>Â è¿ç®—ç¬¦ä¸Â <code>.</code>Â é“¾å¼è¿ç®—ç¬¦ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œå¦‚æœå¼•ç”¨æ˜¯<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Nullish">ç©ºå€¼</a>ï¼ˆ<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/null"><code>null</code></a>Â æˆ–Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/undefined"><code>undefined</code></a>ï¼‰ï¼Œå®ƒä¸ä¼šå¯¼è‡´é”™è¯¯ï¼Œè€Œæ˜¯ä½¿è¡¨è¾¾å¼çŸ­è·¯å¹¶è¿”å›Â <code>undefined</code>ã€‚å½“ç”¨äºå‡½æ•°è°ƒç”¨æ—¶ï¼Œå¦‚æœç»™å®šå‡½æ•°ä¸å­˜åœ¨ï¼Œå®ƒä¹Ÿä¼šè¿”å›Â <code>undefined</code>ã€‚</p><p><strong>ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦</strong>ï¼ˆ**<code>??</code>**ï¼‰æ˜¯ä¸€ä¸ªé€»è¾‘è¿ç®—ç¬¦ï¼Œå½“å·¦ä¾§çš„æ“ä½œæ•°ä¸ºÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/null"><code>null</code></a>Â æˆ–è€…Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/undefined"><code>undefined</code></a>Â æ—¶ï¼Œè¿”å›å…¶å³ä¾§æ“ä½œæ•°ï¼Œå¦åˆ™è¿”å›å·¦ä¾§æ“ä½œæ•°ã€‚</p><p>é€»è¾‘ç©ºèµ‹å€¼è¿ç®—ç¬¦ï¼ˆ<code>x ??= y</code>ï¼‰ä»…åœ¨Â <code>x</code>Â æ˜¯<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Nullish">ç©ºå€¼</a>ï¼ˆ<code>null</code>Â æˆ–Â <code>undefined</code>ï¼‰æ—¶å¯¹å…¶èµ‹å€¼ã€‚</p><p>ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ<code>===</code>ï¼‰ä¼šæ£€æŸ¥å®ƒçš„ä¸¤ä¸ªæ“ä½œæ•°æ˜¯å¦ç›¸ç­‰ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç»“æœã€‚ä¸<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Equality">ç›¸ç­‰</a>è¿ç®—ç¬¦ä¸åŒï¼Œä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦æ€»æ˜¯è®¤ä¸ºä¸åŒç±»å‹çš„æ“ä½œæ•°æ˜¯ä¸åŒçš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>K8Så†…ç½‘éƒ¨ç½²é—®é¢˜</title>
    <link href="/article/385fe79a.html"/>
    <url>/article/385fe79a.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />æŸ¥çœ‹podçš„dockerå¯åŠ¨æ—¥å¿—1.corednsæ— æ³•å¯åŠ¨ï¼ŒæŠ¥é”™ï¼š listen tcp :53: bind: permission deniedcentos 7.9 ä¸­æ— æ³•é€šè¿‡è®¾ç½® net.ipv4.ip_unprivileged_port_start è§£å†³ï¼Œ  æœ€åè§£å†³é€‰æ‹©äº† ä¿®æ”¹ coredns çš„ SecurityContext çš„ allowPrivilegeEscalation ä¸º true<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">securityContext:</span><br>  <span class="hljs-attr">allowPrivilegeEscalation:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>2.calico æŠ¥é”™customResourceDefinition default not found<br>å»æŸ¥çœ‹dockerå¯åŠ¨æ—¥å¿—å‘ç°calico.yaml å’Œ é•œåƒç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œå‚æ•°æ‰¾ä¸åˆ°ï¼Œå‡çº§calicoç‰ˆæœ¬</p><p>3.ä»èŠ‚ç‚¹ï¼Œkubectlæ—¥å¿—æç¤º &#x2F;var&#x2F;lib&#x2F;calico&#x2F;nodename not found æ‰‹åŠ¨åˆ›å»º</p><p>4.kubectl æç¤º # Â runtime create failed systemd cgroup flag passed, but systemd support for managingï¼Œå°†docker  å’Œ k8s cgroup-driveræ”¹ä¸ºcgroupfs,çŒœæµ‹ä¸dockerç‰ˆæœ¬æœ‰å…³ç†è®ºéƒ½ä½¿ç”¨systemedä¹Ÿå¯ä»¥.</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Dockerå­¦ä¹ ä¹‹ä¸€ï¼šç¦»çº¿å®‰è£…Dockeræ­¥éª¤</title>
    <link href="/article/c172ae43.html"/>
    <url>/article/c172ae43.html</url>
    
    <content type="html"><![CDATA[<p>0<!-- toc --></p><meta name="referrer" content="no-referrer" /><h2 id="1ã€Dockerå®‰è£…"><a href="#1ã€Dockerå®‰è£…" class="headerlink" title="1ã€Dockerå®‰è£…"></a>1ã€Dockerå®‰è£…</h2><h3 id="1-1ã€ç¦»çº¿å®‰è£…"><a href="#1-1ã€ç¦»çº¿å®‰è£…" class="headerlink" title="1.1ã€ç¦»çº¿å®‰è£…"></a>1.1ã€ç¦»çº¿å®‰è£…</h3><p><strong>æ­¥éª¤ä¸€</strong>ï¼šå®˜ç½‘ä¸‹è½½ <a href="https://download.docker.com/linux/static/stable/x86_64/">docker å®‰è£…åŒ…</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//</span>download.docker.com<span class="hljs-regexp">/linux/</span>static<span class="hljs-regexp">/stable/</span>x86_64/docker-<span class="hljs-number">24.0</span>.<span class="hljs-number">6</span>.tgz<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤äºŒ</strong>ï¼šè§£å‹å®‰è£…åŒ…;</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxvf docker-<span class="hljs-number">24</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6</span>.tgz<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤ä¸‰</strong>ï¼šå°†è§£å‹ä¹‹åçš„<code>docker</code>æ–‡ä»¶ç§»åˆ° <code>/usr/bin</code>ç›®å½•ä¸‹;</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo cp docker<span class="hljs-regexp">/* /u</span>sr<span class="hljs-regexp">/bin/</span><br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤å››</strong>ï¼šå°†<code>docker</code>æ³¨å†Œæˆç³»ç»ŸæœåŠ¡;</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>docker.service<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œé€€å‡ºå¹¶ä¿å­˜ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=Docker Application Container Engine<br><span class="hljs-attr">Documentation</span>=https://docs.docker.com<br><span class="hljs-attr">After</span>=network-<span class="hljs-literal">on</span>line.target firewalld.service<br><span class="hljs-attr">Wants</span>=network-<span class="hljs-literal">on</span>line.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Type</span>=notify<br><span class="hljs-attr">ExecStart</span>=/usr/bin/dockerd<br><span class="hljs-attr">ExecReload</span>=/bin/kill -s HUP <span class="hljs-variable">$MAINPID</span><br><span class="hljs-attr">LimitNOFILE</span>=infinity<br><span class="hljs-attr">LimitNPROC</span>=infinity<br><span class="hljs-attr">TimeoutStartSec</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">Delegate</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">KillMode</span>=process<br><span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-failure<br><span class="hljs-attr">StartLimitBurst</span>=<span class="hljs-number">3</span><br><span class="hljs-attr">StartLimitInterval</span>=<span class="hljs-number">60</span>s<br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤äº”</strong>ï¼šç»™æ–‡ä»¶å¢åŠ å¯æ‰§è¡Œæƒé™</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">chmod +x <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>docker.service<br>systemctl daemon-reload <br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤å…­</strong>ï¼šè®¾ç½®å¼€æœºè‡ªå¯åŠ¨</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">systemctl <span class="hljs-built_in">enable</span> docker.service<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤ä¸ƒ</strong> ï¼šå¯åŠ¨<code>docker</code></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">systemctl <span class="hljs-literal">start</span> docker<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤å…«</strong>ï¼šæµ‹è¯•<code>docker</code>æ˜¯å¦å¯åŠ¨</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> hello-world<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/947aab77e905b2f32a98354bec5454df.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>å¸è½½æ­¥éª¤</strong></p><p><strong>æ­¥éª¤ä¸€</strong>ï¼šåœæ­¢<code>docker</code></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">sudo systemctl stop docker<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤äºŒ</strong>ï¼šåˆ é™¤<code>Docker</code>æœåŠ¡</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># ç§»é™¤å¼€æœºè‡ªå¯åŠ¨</span><br>systemctl disable docker.service<br><span class="hljs-comment"># åˆ é™¤serviceæœåŠ¡</span><br>rm -f <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>docker.service<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤ä¸‰</strong>ï¼šåˆ é™¤<code>Docker</code>ç›¸å…³å‘½ä»¤</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">rm -f <span class="hljs-regexp">/usr/</span>bin/docker*<br>rm -f <span class="hljs-regexp">/usr/</span>bin/containerd*<br>rm -f <span class="hljs-regexp">/usr/</span>bin/ctr<br>rm -f <span class="hljs-regexp">/usr/</span>bin/runc<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤ä¸‰</strong>ï¼šåˆ é™¤<code>docker</code>ç›®å½•å’Œå®¹å™¨ç›¸å…³æ–‡ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo rm -rf <span class="hljs-regexp">/var/</span>lib/docker<br>sudo rm -rf <span class="hljs-regexp">/var/</span>lib/containerd<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤å››</strong>ï¼šéªŒè¯æ˜¯å¦å·²æˆåŠŸå¸è½½</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">docker <span class="hljs-comment">--version</span><br></code></pre></td></tr></table></figure><h3 id="1-2ã€åœ¨çº¿å®‰è£…"><a href="#1-2ã€åœ¨çº¿å®‰è£…" class="headerlink" title="1.2ã€åœ¨çº¿å®‰è£…"></a>1.2ã€åœ¨çº¿å®‰è£…</h3><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/install/ubuntu/">Dockerå®‰è£…æ­¥éª¤</a></p><h2 id="2ã€Dockeré•œåƒ"><a href="#2ã€Dockeré•œåƒ" class="headerlink" title="2ã€Dockeré•œåƒ"></a>2ã€Dockeré•œåƒ</h2><h3 id="2-1ã€é•œåƒä¸‹è½½"><a href="#2-1ã€é•œåƒä¸‹è½½" class="headerlink" title="2.1ã€é•œåƒä¸‹è½½"></a>2.1ã€é•œåƒä¸‹è½½</h3><p><strong>æ­¥éª¤ä¸€</strong>ï¼šæŸ¥æ‰¾é•œåƒ</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker search ubuntu</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/002563a36fcac500fbd9affb2ca35538.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­¥éª¤äºŒ</strong>ï¼šä¸‹è½½é•œåƒ</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker pull ubuntu</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/f94df933695d13be2220c5648e8d1015.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­¥éª¤ä¸‰</strong>ï¼šæŸ¥çœ‹é•œåƒ</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker images</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/86d5536a51e86c49c4d668ac03acdad7.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åˆ é™¤é•œåƒï¼Œå¯ä»¥æ‰§è¡Œï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> rmi e4c58958181a<br><span class="hljs-comment">#æˆ–è€…</span><br>docker rmi ubuntu:latest<br></code></pre></td></tr></table></figure><h3 id="2-2ã€å®¹å™¨å‘½ä»¤"><a href="#2-2ã€å®¹å™¨å‘½ä»¤" class="headerlink" title="2.2ã€å®¹å™¨å‘½ä»¤"></a>2.2ã€å®¹å™¨å‘½ä»¤</h3><p>è¿™é‡Œçš„<code>ubuntu</code>é•œåƒå°±ç±»ä¼¼è¿·ä½ ç‰ˆçš„<code>ISO</code>é•œåƒæ–‡ä»¶ï¼Œå¯åŠ¨é•œåƒçš„æ—¶å€™å¯ä»¥ç†è§£ä¸ºä»¥è¿™ä¸ªé•œåƒåˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œå¹¶æ‰§è¡Œäº†å°è£…é•œåƒçš„æ—¶å€™æ‰€ä¹¦å†™çš„å‘½ä»¤ï¼Œå¯¹äºè¿™æ ·å·²ç»å¯åŠ¨çš„é•œåƒæˆ‘ä»¬ç§°ä¹‹ä¸ºå®¹å™¨ï¼ˆ<code>containerd</code>ï¼‰ï¼Œè¿™é‡Œæµ‹è¯•æ‰€ä½¿ç”¨çš„åªæ˜¯ä¸€ä¸ª<code>ubuntu</code>çš„é•œåƒï¼Œå¯åŠ¨çš„æ—¶å€™åªæ˜¯ä¸€ä¸ª<code>ubuntu</code>çš„è™šæ‹Ÿæœºï¼Œæ²¡æœ‰å°è£…å®é™…çš„åŠŸèƒ½ã€‚</p><p><strong>æ­¥éª¤ä¸€</strong>ï¼šå¯åŠ¨å®¹å™¨</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> ubuntu:latest<br><span class="hljs-comment">#æˆ–è€…</span><br>docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> e4c58958181a<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/4a22d97af17fa8207fbd82c59b104106.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯ä»¥çœ‹å‡ºå¯åŠ¨ä¹‹åè¿›å…¥åˆ°ä¸€ä¸ªè¿·ä½ ç‰ˆæœ¬çš„<code>ubuntu</code>ç³»ç»Ÿï¼Œé‡Œé¢å°è£…äº†ä¸€éƒ¨åˆ†å¸¸ç”¨å‘½ä»¤ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†å‘½ä»¤éƒ½æ²¡æœ‰å®‰è£…ã€‚</p><p>æ‰§è¡Œ <code>eixt</code> å¯ä»¥é€€å‡ºå®¹å™¨ï¼Œå¹¶å…³é—­è¯¥å®¹å™¨è¿è¡Œï¼Œç±»ä¼¼äºè™šæ‹Ÿæœºå…³æœºï¼Œä½†æ˜¯è™šæ‹Ÿæœºæœ¬èº«è¿˜å­˜åœ¨ã€‚</p><p>ä¹Ÿå¯ä»¥æ‰§è¡Œ<code>ctrl + p</code> ä¹‹å æ‰§è¡Œ <code>ctrl + q</code>è¿™æ ·å¯ä»¥é€€å‡ºå®¹å™¨ï¼Œä½†å®¹å™¨æœ¬èº«åœ¨åå°ç»§ç»­è¿è¡Œï¼Œç±»ä¼¼äºè™šæ‹Ÿæœºè¿è¡ŒçŠ¶æ€ã€‚</p><p><strong>æ­¥éª¤äºŒ</strong>ï¼šæŸ¥çœ‹å¯åŠ¨çš„å®¹å™¨</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker ps -<span class="hljs-selector-tag">a</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/63d4501560b626d8bfc6aa885feeac65.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œæ˜¾ç¤ºçŠ¶æ€<code>Exited</code>è¡¨ç¤ºå®¹å™¨å·²ç»åœæ­¢è¿è¡Œäº†ï¼Œå¦‚æœæƒ³è¦é‡å¯å®¹å™¨ï¼Œå¯ä»¥æ‰§è¡Œ<code>docker start 700f9f498c9d</code>ï¼Œ å…¶ä¸­<code>700f9f498c9d</code>è¡¨ç¤ºå®¹å™¨çš„<code>ID</code></p><p><strong>æ­¥éª¤ä¸‰</strong>ï¼šé‡å¯å®¹å™¨</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> start <span class="hljs-number">700</span>f9f498c9d<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/07489fd549af058dff800a38f72c85ed.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­¥éª¤å››</strong>ï¼šåœæ­¢å®¹å™¨</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> stop <span class="hljs-number">700</span>f9f498c9d<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/4e7cb712a1baef76c4f853b04783d510.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­¥éª¤äº”</strong>ï¼šåˆ é™¤å®¹å™¨</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> rm <span class="hljs-number">700</span>f9f498c9d<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/e3f358bff7910b4ddd0c36e2a382c194.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­¥éª¤å…­</strong>ï¼šåå°å¯åŠ¨å®¹å™¨</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -itd ubuntu:latest<br><span class="hljs-comment">#æˆ–è€…</span><br>docker <span class="hljs-built_in">run</span> -itd e4c58958181a<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/d87d67d226187d8c0628e4c98fe40276.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­¥éª¤ä¸ƒ</strong>ï¼šè¿æ¥å®¹å™¨</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> attach <span class="hljs-number">725</span>f09c35ba6<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/f9eb1e1776a64b5243c783aeaad77e06.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™æ ·å¯åŠ¨æ‰§è¡Œ<code>eixt</code>ä¹‹åå®¹å™¨ä¹Ÿä¼šå…³é—­ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/e4d40f7210551589b1d486a11fb4db7a.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤é“¾æ¥å®¹å™¨ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker exec -it <span class="hljs-number">725</span>f09c35ba6 <span class="hljs-regexp">/bin/</span>bash<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/6804331f906b3631f7c6a631e80b3c86.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™æ ·ä½¿ç”¨<code>exit</code>é€€å‡ºå®¹å™¨ï¼Œå®¹å™¨ä¹Ÿä¸ä¼šå…³é—­ã€‚</p><p><strong>æ­¥éª¤å…«</strong>ï¼šæŸ¥çœ‹<code>ubuntu</code>ç‰ˆæœ¬</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cat <span class="hljs-regexp">/etc/i</span>ssue<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/d6e7f6d9892fac2bd644b62c658ab990.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="3ã€ç¨‹åºå°è£…"><a href="#3ã€ç¨‹åºå°è£…" class="headerlink" title="3ã€ç¨‹åºå°è£…"></a>3ã€ç¨‹åºå°è£…</h2><h3 id="3-1ã€éœ€æ±‚åˆ†æ"><a href="#3-1ã€éœ€æ±‚åˆ†æ" class="headerlink" title="3.1ã€éœ€æ±‚åˆ†æ"></a>3.1ã€éœ€æ±‚åˆ†æ</h3><p>éœ€è¦å°†åœ¨<code>ubuntu 22.04</code>ç‰ˆæœ¬ä¸‹ç¼–è¯‘çš„<code>coml_transcode</code>å¯æ‰§è¡Œç¨‹åºåŠè¿è¡Œç›®å½•ä¸Šä¼ åˆ°å®¹å™¨ä¸­ï¼Œå¹¶åœ¨å®¹å™¨ä¸­æˆåŠŸè¿è¡Œç¨‹åºï¼Œç„¶åå°†è¯¥å®¹å™¨æ‰“åŒ…æˆä¸€ä¸ªæ–°çš„é•œåƒåŸºç¡€æ–‡ä»¶ä½œä¸ºå‘å¸ƒç‰ˆä½¿ç”¨ï¼Œç°åœºæœåŠ¡å™¨éƒ¨ç½²å®Œ<code>docker</code>ä¹‹åç›´æ¥åŠ è½½å¯åŠ¨è¿™ä¸ªæ–°çš„é•œåƒå°±èƒ½æˆåŠŸè¿è¡Œ<code>coml_transcode</code>ç¨‹åºï¼Œè¿™æ ·å°±é¿å…äº†ä¾èµ–ç°åœºæœåŠ¡å™¨ç¯å¢ƒï¼ˆæ“ä½œç³»ç»Ÿä¸ä¸€è‡´ï¼Œglibcåº“ä¸ä¸€è‡´ç­‰å¯¼è‡´ç¨‹åºå¯åŠ¨ä¸æˆåŠŸç­‰é—®é¢˜ã€‚ï¼‰</p><h3 id="3-2ã€åˆ›å»ºé•œåƒ"><a href="#3-2ã€åˆ›å»ºé•œåƒ" class="headerlink" title="3.2ã€åˆ›å»ºé•œåƒ"></a>3.2ã€åˆ›å»ºé•œåƒ</h3><p><strong>æ­¥éª¤ä¸€</strong>ï¼šè™šæ‹Ÿæœºä¸Šç¼–è¯‘æºä»£ç ï¼Œå¹¶å°†è¿è¡Œç›®å½•ä¸Šä¼ </p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/753f22d955f28732cc4c8eb354f13287.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­¥éª¤äºŒ</strong>ï¼šç¼–å†™<code>DockerFile</code>æ–‡ä»¶</p><p>è¯¥æ–‡ä»¶å’Œæºæ–‡ä»¶åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåä¸º<strong>dockerfile</strong>ï¼Œæ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> ubuntu<br><br><span class="hljs-keyword">ENV</span> MYPATH /home/coml_transcode<br><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./coml_transcode <span class="hljs-variable">$MYPATH</span></span><br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> <span class="hljs-variable">$MYPATH</span></span><br><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;bash&quot;</span>, <span class="hljs-string">&quot;start.sh&quot;</span>]</span><br></code></pre></td></tr></table></figure><p><code>FROM ubuntu</code>: <code>FROM</code>æ˜¯åé¢æ˜¯è¯¥ç›®æ ‡é•œåƒä½¿ç”¨çš„åŸºç¡€é•œåƒï¼ŒåŸºç¡€é•œåƒæœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªï¼Œè¿™é‡Œä½¿ç”¨<code>ubuntu</code>ä½œä¸ºåŸºç¡€é•œåƒï¼›</p><p><code>ENV</code>: é…ç½®ç¯å¢ƒç›®å½•ï¼›</p><p><code>COPY</code>: å°†å®¿ä¸»æœºä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°é•œåƒï¼›</p><p><code>WORKDIR</code>ï¼šè®¾ç½®å®¹å™¨çš„é»˜è®¤å·¥ä½œç›®å½•ï¼›</p><p><code>ENTRYPOINT</code>: å™¨å¯åŠ¨æ—¶ç¬¬ä¸€ä¸ªè¿è¡Œçš„å‘½ä»¤åŠå…¶å‚æ•°ï¼Œè¿™é‡Œè¡¨ç¤ºå¯åŠ¨å®¹å™¨æ˜¯æ‰§è¡Œ<code>start.sh</code>è„šæœ¬ã€‚</p><p><strong>æ­¥éª¤ä¸‰</strong>ï¼šåˆ›å»ºé•œåƒ</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> build -f ./dockerfile -t coml_transcode:v1.<span class="hljs-number">0</span> .<br></code></pre></td></tr></table></figure><p><code>./dockerfile</code> è¡¨ç¤º<code>Dockerfile</code>çš„æ‰€åœ¨ä½ç½®;</p><p><code>coml_transcode:v1.0</code> è¡¨ç¤ºæ–°å»ºé•œåƒçš„åå­—åŠç‰ˆæœ¬å·</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/f3b5595e8556641b52dd050a8ec08f69.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ„å»ºå®ŒæŸ¥çœ‹æ˜¯å¦æˆåŠŸæ„å»ºï¼Œé€šè¿‡<strong>docker images</strong>å‘½ä»¤æŸ¥çœ‹å½“å‰æœ¬åœ°çš„æ‰€æœ‰é•œåƒï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker images</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/34d565175ce455eb75bef0b5dc5cf976.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œçš„<code>coml_trancode</code>é•œåƒä¾¿æ˜¯åˆšåˆ›å»ºçš„</p><p><strong>æ­¥éª¤å››</strong>ï¼šé€šè¿‡é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -d coml_transcode:v1.0<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/aff6cf8cb6f4571bd141879f30c13863.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­¥éª¤äº”</strong>ï¼šé“¾æ¥å®¹å™¨</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker exec -it <span class="hljs-number">02135</span>e2b8b7d <span class="hljs-regexp">/bin/</span>bash<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/fafb01c2d732307be107871a1895c5be.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­¥éª¤å…­</strong>ï¼šå¯¼å‡ºé•œåƒ</p><p>é€šè¿‡ä¸Šè¿°å¯ä»¥éªŒè¯ç¨‹åºèƒ½å¤Ÿåœ¨<code>ubuntu</code>åŸºç¡€è™šæ‹Ÿæœºä¸Šé¢è¿è¡Œï¼Œå°†<code>coml_transcode</code>è¿™ä¸ªé•œåƒå¯¼å‡º</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> save -o ./coml_transcode.tar coml_transcode:v1.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/48b2a17df68315ec7f9a12ec2b69862f.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="4ã€ç°åœºç¯å¢ƒ"><a href="#4ã€ç°åœºç¯å¢ƒ" class="headerlink" title="4ã€ç°åœºç¯å¢ƒ"></a>4ã€ç°åœºç¯å¢ƒ</h2><h3 id="4-1ã€å®‰è£…Docker"><a href="#4-1ã€å®‰è£…Docker" class="headerlink" title="4.1ã€å®‰è£…Docker"></a>4.1ã€å®‰è£…Docker</h3><p>ç°åœºæœåŠ¡å™¨æŒ‰ç…§<code>1.1</code>ç« èŠ‚æ­¥éª¤å®‰è£…<code>docker</code></p><h3 id="4-2ã€å¯¼å…¥é•œåƒ"><a href="#4-2ã€å¯¼å…¥é•œåƒ" class="headerlink" title="4.2ã€å¯¼å…¥é•œåƒ"></a>4.2ã€å¯¼å…¥é•œåƒ</h3><p><strong>æ­¥éª¤ä¸€</strong>ï¼šå°†<code>coml_transcode.tar</code>é•œåƒå¯¼å…¥åˆ°ç°åœºæœåŠ¡å™¨ä¸Š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker load -<span class="hljs-selector-tag">i</span> coml_transcode<span class="hljs-selector-class">.tar</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/cac5148262cfa483f3486711a15f0858.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­¥éª¤äºŒ</strong>ï¼šé€šè¿‡è¯¥é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -d 18820b82f7eb<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/b17e9fc6fc80c2300fa0d44de6b842ff.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­¥éª¤ä¸‰</strong>ï¼šé“¾æ¥å®¹å™¨</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">docker exec -it <span class="hljs-number">98</span><span class="hljs-keyword">c</span><span class="hljs-number">9</span><span class="hljs-keyword">c</span><span class="hljs-number">6</span><span class="hljs-keyword">c</span><span class="hljs-number">3</span>bf<span class="hljs-number">75</span> /bin/bash<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/80feef2dc9ae7f400155c0c1cdfc4bc4.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯ä»¥çœ‹åˆ°ç¨‹åºå·²ç»æˆåŠŸå¯åŠ¨</p><h2 id="5ã€æ€»ç»“"><a href="#5ã€æ€»ç»“" class="headerlink" title="5ã€æ€»ç»“"></a>5ã€æ€»ç»“</h2><p><strong>1ã€é¢„å®‰è£…å‘½ä»¤</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs autoit">vim<br>ifconfig<br>dstat<br>ufw<br>tcpdump<br><span class="hljs-built_in">ping</span><br></code></pre></td></tr></table></figure><p>åˆå§‹åŒ–<code>ubuntu</code>é•œåƒå®‰è£…çš„å‘½ä»¤å¾ˆå°‘ï¼Œå¯ä»¥é€šè¿‡<code>3.2</code>ç« èŠ‚ç¼–å†™<code>Dockerfile</code>æ–‡ä»¶æ¥é¢„å®‰è£…å¯èƒ½ç”¨åˆ°çš„å‘½ä»¤ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">FROM</span> ubuntu<br><br>ENV MYPATH /home/coml_transcode<br><br>COPY ./coml_transcode <span class="hljs-variable">$MYPATH</span><br><br>WORKDIR <span class="hljs-variable">$MYPATH</span><br><br><span class="hljs-comment">#æ›´æ–°apt</span><br><span class="hljs-built_in">RUN</span> apt-<span class="hljs-built_in">get</span> update<br><span class="hljs-comment">#å®‰è£…vimç¼–è¾‘å™¨</span><br><span class="hljs-built_in">RUN</span> apt -y install vim<br><span class="hljs-comment">#å®‰è£…ifconfigå‘½ä»¤æŸ¥çœ‹ç½‘ç»œIP</span><br><span class="hljs-built_in">RUN</span> apt -y install net-tools<br><span class="hljs-comment">#å®‰è£…é˜²ç«å¢™æŸ¥çœ‹æ”»å‡»</span><br><span class="hljs-built_in">RUN</span> apt -y install ufw<br><span class="hljs-comment">#å®‰è£…ç½‘ç»œIOæŸ¥çœ‹å·¥å…·</span><br><span class="hljs-built_in">RUN</span> apt -y install dstat<br><span class="hljs-comment">#å®‰è£…æŠ“åŒ…å·¥å…·</span><br><span class="hljs-built_in">RUN</span> apt -y install tcpdump<br><span class="hljs-comment">#å®‰è£…pingå‘½ä»¤</span><br><span class="hljs-built_in">RUN</span> apt -y install iputils-ping<br><br>ENTRYPOINT [<span class="hljs-string">&quot;bash&quot;</span>, <span class="hljs-string">&quot;start.sh&quot;</span>]<br></code></pre></td></tr></table></figure><p>ç„¶åå†åˆ›å»ºæ–°çš„é•œåƒå³å¯ï¼Œè¿™æ ·é€šè¿‡æ–°é•œåƒå¯åŠ¨çš„å®¹å™¨åˆå§‹å°±å­˜åœ¨è¿™äº›å‘½ä»¤ã€‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/af2c457cdbf68ad3dc38abec8942aaab.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>2ã€ç½‘ç»œé…ç½®</strong></p><p><code>Doker</code>å¯åŠ¨çš„å®¹å™¨å­˜åœ¨<code>4</code>ç§ç½‘ç»œé…ç½®ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th>ç½‘ç»œæ¨¡å¼</th><th>æŒ‡å®šæ–¹å¼</th><th>è§£é‡Š</th><th></th></tr></thead><tbody><tr><td><code>bridge</code></td><td><code>--network bridge</code>æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨<code>docker0</code></td><td><strong>æ¡¥æ¥æ¨¡å¼</strong>é“¾æ¥å®¿ä¸»æœºï¼Œé€šè¿‡è™šæ‹Ÿå‡ºæ¥çš„<code>docker0</code>ä½œä¸ºç½‘æ¡¥é“¾æ¥ç‰©ç†ç½‘å¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>docker network create --subnet=172.18.0.0/16 docker1</code>åˆ›å»ºæ–°çš„ç½‘æ¡¥ä½¿ç”¨ã€‚</td><td></td></tr><tr><td><code>host</code></td><td><code>--network host</code>æŒ‡å®š</td><td><strong>ä¸»æœºæ¨¡å¼</strong>é“¾æ¥å®¿ä¸»æœºï¼Œé€šè¿‡å’Œå®¿ä¸»æœºå…±äº«åŒä¸€ç‰©ç†ç½‘å¡é“¾æ¥ï¼Œè‡ªèº«ä¸åœ¨é…ç½®<code>IP</code>ï¼Œè¿™ç§æ¨¡å¼æ— æ³•åšåˆ°ç½‘ç»œç«¯å£æ˜ å°„ã€‚</td><td></td></tr><tr><td><code>none</code></td><td><code>--network none</code>æŒ‡å®š</td><td><strong><code>none</code>æ¨¡å¼</strong>ï¼Œç¦ç”¨ç½‘ç»œåŠŸèƒ½ï¼Œè¿™ä¸ª<code>Docker</code>å®¹å™¨ä¸å­˜åœ¨ç½‘å¡ï¼Œ<code>IP</code>ç­‰ä¿¡æ¯ã€‚ä¸èƒ½å’Œå…¶å®ƒå®¹å™¨æˆ–å®¿ä¸»æœºè¿›è¡Œé€šä¿¡ã€‚</td><td></td></tr><tr><td><code>container</code></td><td><code>--network container:NAME</code>æˆ–è€…å®¹å™¨<code>ID</code></td><td><strong><code>container</code>æ¨¡å¼</strong>ï¼ŒåŒå…¶å®ƒå®¹å™¨å…±äº«ç½‘ç»œï¼Œ<code>MAC</code>åœ°å€å’Œ<code>ip</code>ä¸€æ ·ã€‚</td><td></td></tr></tbody></table><p><code>docker</code>å®¹å™¨å¯åŠ¨çš„æ—¶å€™å¦‚æœä¸æŒ‡å®šç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤é€‰æ‹©<code>bridge</code>æ¨¡å¼</p><p><strong>3ã€CPUéš”ç¦»</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -d <span class="hljs-attribute">--cpuset-cpus</span>=1-20 coml_transcode:v2.0<br></code></pre></td></tr></table></figure><p>æŒ‡å®šè¯¥å®¹å™¨ä½¿ç”¨<code>CPU 1-20</code></p><p><strong>4ã€æ—¥å¿—æ–‡ä»¶åŒæ­¥</strong></p><p>æ—¥å¿—åŒæ­¥å¯ä»¥åšåˆ°å®¹å™¨æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶å¯ä»¥å’Œå®¿ä¸»æœºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡Œå®æ—¶åŒæ­¥åŠŸèƒ½ã€‚è¿™æ ·å¯ä»¥è§£å†³å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><p>1.å¦‚æœå¯åŠ¨çš„å®¹å™¨å¼‚å¸¸é€€å‡ºä¹‹åï¼Œé‡å¯ä¸èµ·æ¥ï¼Œå¯¼è‡´å®¹å™¨é‡Œå­˜åœ¨çš„ç¨‹åºæ—¥å¿—ä¿¡æ¯æ— æ³•æŸ¥çœ‹ï¼›</p><p>2.å¦‚æœéœ€è¦æ›´æ–°ç¨‹åºï¼Œåªéœ€è¦å°†æœ€æ–°ç‰ˆæœ¬çš„ç¨‹åºï¼Œä¸Šä¼ è‡³å®¿ä¸»æœºçš„å…±äº«ç›®å½•ä¸‹ï¼Œç„¶åé‡å¯å®¹å™¨å³å¯å®Œæˆç¨‹åºçš„è¿­ä»£æ›´æ–°ï¼›</p><p>3.å¯¹äºé›†ç¾¤éƒ¨ç½²çš„å®¹å™¨ï¼Œå¯ä»¥å°†å®¿ä¸»æœºå…±äº«æ–‡ä»¶ç»Ÿä¸€è®¾ç½®å†ä¸€ä¸ªç›®å½•ä¸‹ï¼Œå¦‚ï¼š<code>data/data1, data/data2, data/data3</code>è¿™æ ·çš„æ ¼å¼ï¼Œè¿™æ ·ä¾¿äºæŸ¥çœ‹æ¯ä¸ªå®¹å™¨æ‰€æ‰“å°çš„æ—¥å¿—ä¿¡æ¯ï¼Œä¸å¿…å»è¿æ¥åˆ°æ¯ä¸€ä¸ªå®¹å™¨å»æŸ¥çœ‹ã€‚</p><p>å¯åŠ¨å®¹å™¨æ—¶ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># è·å–å®¿ä¸»æœºå¯æ‰§è¡Œç¨‹åºè¿è¡Œç›®å½•</span><br>root@ubuntu:<span class="hljs-regexp">/home/</span>DockerTranscode/coml_transcode<span class="hljs-comment"># pwd</span><br><span class="hljs-regexp">/home/</span>DockerTranscode/coml_transcode<br><br><span class="hljs-comment"># å¯åŠ¨å®¹å™¨</span><br> docker run -d --privileged=true -v <span class="hljs-regexp">/home/</span>DockerTranscode<span class="hljs-regexp">/coml_transcode:/</span>home<span class="hljs-regexp">/coml_transcode/</span> coml_transcode:v5.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/5a2ad1875f76211f43d14a529b300906.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CloudFlare+SaaSå›æºä¼˜é€‰IPä½¿å›½å†…ç”¨æˆ·é«˜é€Ÿè®¿é—®ç½‘ç«™</title>
    <link href="/article/4c7bdcf0.html"/>
    <url>/article/4c7bdcf0.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /># å‰è¨€ ğŸš€<p>ç”±äºä¸å¯æŠ—åŠ›å› ç´ ,ä½¿ç”¨äº†Cloudflareå¼€å¯å°é»„äº‘åœ¨å›½å†…çš„è®¿é—®é€Ÿåº¦ååˆ†å ªå¿§,é—´æ­‡æ€§æŠ½é£</p><p>åœ¨ä¹‹å‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨cloudflare partneræ¥ä½¿è®¿é—®å›æºåˆ°ä¸€ä¸ªä¼˜é€‰è¿‡åçš„IP</p><p>ä½†æ˜¯åœ¨å»å¹´è¿™ä¸ªæ–¹æ³•å·²ç»è¡Œä¸é€šäº†, é‚£ä¹ˆæˆ‘ä»¬è¿™äº›ç™½å«–ç©å®¶åˆä¸æƒ³å¯¹æ¥å›½å†…å¤‡æ¡ˆå®åCDN,åŒæ—¶æƒ³è¦ä¿è¯å›½å†…çš„é«˜é€Ÿè®¿é—®</p><p>æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢?</p><p>è¿™å°±æ˜¯æˆ‘ä»¬è¿™æœŸè¦è®²çš„ä¸»è¦å†…å®¹,Cloudflare SaaSå›æº</p><h1 id="ä»€ä¹ˆæ˜¯SaaSå›æº-ğŸ¤”"><a href="#ä»€ä¹ˆæ˜¯SaaSå›æº-ğŸ¤”" class="headerlink" title="ä»€ä¹ˆæ˜¯SaaSå›æº? ğŸ¤”"></a>ä»€ä¹ˆæ˜¯SaaSå›æº? ğŸ¤”</h1><h2 id="SaaSå›æºä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†"><a href="#SaaSå›æºä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†" class="headerlink" title="SaaSå›æºä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†"></a>SaaSå›æºä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†</h2><ol><li>è‡ªå®šä¹‰ä¸»æœºå (Custom Hostnames)<ul><li>ä½ å¯ä»¥è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰ä¸»æœºå,æ¥ä½œä¸ºä½ çš„è®¿é—®åŸŸå</li></ul></li><li>å›æº (Origin Server)<ul><li>å½“ç”¨æˆ·è¯·æ±‚ç‰¹å®šçš„ä¸»æœºåï¼ˆå¦‚å®¢æˆ·è‡ªå·±çš„åŸŸåï¼‰æ—¶ï¼Œè¯·æ±‚ä¼šè¢«è½¬å‘åˆ°SaaSæä¾›å•†çš„åŸå§‹æœåŠ¡å™¨ï¼ˆæˆ–ç§°ä¸ºå›æºæœåŠ¡å™¨ï¼‰ã€‚</li></ul></li></ol><h1 id="SaaSå›æºæœ‰ä»€ä¹ˆç”¨-ğŸ§"><a href="#SaaSå›æºæœ‰ä»€ä¹ˆç”¨-ğŸ§" class="headerlink" title="SaaSå›æºæœ‰ä»€ä¹ˆç”¨? ğŸ§"></a>SaaSå›æºæœ‰ä»€ä¹ˆç”¨? ğŸ§</h1><ul><li><p>å¯èƒ½çœ‹åˆ°ç°åœ¨å¤§å®¶è¿˜æ˜¯ä¸€å¤´é›¾æ°´,ä¸è¿‡æ²¡å…³ç³»,æˆ‘ä¼šç»™å¤§å®¶æ ¹æ®å®ä¾‹æ¥é€šä¿—æ˜“æ‡‚çš„è§£é‡Šä¸€ä¸‹</p></li><li><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ”¯æŒåˆ†æµçš„DNSè§£ææœåŠ¡(ä¾‹å¦‚è…¾è®¯çš„DNSPOD),</p><p>å°†æˆ‘ä»¬éœ€è¦è®¿é—®çš„åŸŸåä¾‹å¦‚ <code>image.dooo.ng</code> é€šè¿‡CNAMEè§£æåˆ°ä»»æ„ä¸€ä¸ªCloudflareçš„èŠ‚ç‚¹,</p><p>ä¾‹å¦‚<code>csgo.com</code>, <code>visa.com</code>,è€Œè¿™äº›åŸŸåè§£æåˆ°çš„CFçš„IPé€šå¸¸æ˜¯ç»è¿‡å¤§é™†ç‰¹æ®Šä¼˜åŒ–çš„</p><p>æœ‰äº›æ˜¯ä¼˜é€‰çº¿è·¯,æœ‰äº›çš„ç™¾åº¦äº‘åˆä½œçš„IPåœ°å€</p></li><li><p>å°†æˆ‘ä»¬çš„ <code>image.dooo.ng</code> CNAMEè§£æåˆ° <code>csgo.com</code> ä¹‹å, æˆ‘ä»¬è®¿é—®image.dooo.ngçš„è¯·æ±‚å®åˆ™æ˜¯è¢«å‘é€åˆ°äº†</p><p><strong>ç»è¿‡ä¼˜é€‰åçº¿è·¯è¾ƒå¥½çš„Cloudflare IP</strong>ä¸Š è¿™ä¸ªæ­¥éª¤è¾¾åˆ°äº†æˆ‘ä»¬ä¼˜é€‰IPçš„ç›®çš„</p></li><li><p>æ­¤æ—¶Cloudflareçš„IPæ”¶åˆ°äº†æˆ‘ä»¬çš„è®¿é—®è¯·æ±‚, ä¼šåŒ¹é…æˆ‘ä»¬è®¿é—®çš„åŸŸå <code>image.dooo.ng</code> åœ¨Cloudflareä¸­æ˜¯å¦æœ‰åŒ¹é…çš„ <strong>è‡ªå®šä¹‰ä¸»æœºå</strong> å¦‚æœæœ‰, å®ƒä¼šå°†æˆ‘ä»¬å›æºåˆ°æˆ‘ä»¬è®¾ç½®çš„ <strong>å›æºæœåŠ¡å™¨</strong> ä¸Š</p></li><li><p>è¿™é‡Œæˆ‘ç»˜åˆ¶äº†ä¸€ä¸ªåºåˆ—å›¾æ¥å¸®åŠ©å¤§å®¶ç†è§£</p><p><img src="https://image.dooo.ng/i/2023/11/28/6565c28e8d95e.jpg"></p></li></ul><h2 id="ä½¿ç”¨Cloudflareçš„SaaSå›æº"><a href="#ä½¿ç”¨Cloudflareçš„SaaSå›æº" class="headerlink" title="ä½¿ç”¨Cloudflareçš„SaaSå›æº"></a>ä½¿ç”¨Cloudflareçš„SaaSå›æº</h2><ul><li>æˆ‘ä»¬å¯ä»¥è®¾ç½®è‡ªå®šä¹‰åŸŸåï¼ˆä¾‹å¦‚ <code>image.dooo.ng</code>ï¼‰ã€‚</li><li>å¹¶é€šè¿‡CNAMEè®°å½•å°†å…¶è§£æåˆ°å¦ä¸€ä¸ªåŸŸåï¼ˆä¾‹å¦‚ <code>csgo.com</code>ï¼‰ã€‚</li><li>è¿™æ ·è®¾ç½®æ˜¯ä¸ºäº†åˆ©ç”¨Cloudflareçš„å®‰å…¨å’Œæ€§èƒ½ç‰¹æ€§ï¼Œå¦‚DDoSé˜²æŠ¤ã€SSL&#x2F;TLSåŠ å¯†ã€CDNåŠ é€Ÿç­‰ã€‚</li></ul><h2 id="CNAMEè§£æè¿‡ç¨‹"><a href="#CNAMEè§£æè¿‡ç¨‹" class="headerlink" title="CNAMEè§£æè¿‡ç¨‹"></a>CNAMEè§£æè¿‡ç¨‹</h2><ul><li>è®¿é—® <code>image.dooo.ng</code> æ—¶ï¼ŒDNSæŸ¥è¯¢ä¼šæ ¹æ®CNAMEè®°å½•æ‰¾åˆ°å®ƒå®é™…æŒ‡å‘çš„ <code>csgo.com</code>ã€‚</li><li>ç”±äº <code>csgo.com</code> å·²æ¥å…¥Cloudflare CDNï¼Œç”¨æˆ·çš„è¯·æ±‚ä¼šè¢«è·¯ç”±åˆ°Cloudflareçš„è¾¹ç¼˜èŠ‚ç‚¹ã€‚</li></ul><h2 id="Cloudflareè¾¹ç¼˜èŠ‚ç‚¹å¤„ç†"><a href="#Cloudflareè¾¹ç¼˜èŠ‚ç‚¹å¤„ç†" class="headerlink" title="Cloudflareè¾¹ç¼˜èŠ‚ç‚¹å¤„ç†"></a>Cloudflareè¾¹ç¼˜èŠ‚ç‚¹å¤„ç†</h2><ul><li>Cloudflareçš„è¾¹ç¼˜èŠ‚ç‚¹å¤„ç†è¯·æ±‚ï¼ŒåŒ…æ‹¬åº”ç”¨å®‰å…¨è§„åˆ™ã€è¿›è¡Œç¼“å­˜ç­‰ã€‚</li><li>å¦‚æœè¯·æ±‚éœ€è¦å›æºï¼ˆå³è·å–åŸå§‹å†…å®¹ï¼‰ï¼ŒCloudflareä¼šå°†è¯·æ±‚è½¬å‘åˆ°åŸå§‹çš„å›æºæœåŠ¡å™¨ã€‚</li></ul><h2 id="è®¿é—®è¿‡ç¨‹çš„ç†è§£"><a href="#è®¿é—®è¿‡ç¨‹çš„ç†è§£" class="headerlink" title="è®¿é—®è¿‡ç¨‹çš„ç†è§£"></a>è®¿é—®è¿‡ç¨‹çš„ç†è§£</h2><ul><li>ç”¨æˆ·è®¿é—® <code>image.dooo.ng</code> å®é™…ä¸Šæ˜¯åœ¨è®¿é—®Cloudflareçš„èŠ‚ç‚¹ã€‚</li><li>ç„¶åï¼Œæ ¹æ®éœ€è¦ï¼ŒCloudflareä¼šä»åŸå§‹çš„å›æºæœåŠ¡å™¨è·å–å†…å®¹ã€‚</li><li>è¿™ä¸ªè¿‡ç¨‹å¯¹ç”¨æˆ·é€æ˜ï¼Œç”¨æˆ·åªçŸ¥é“ä»–ä»¬è®¿é—®çš„æ˜¯ <code>image.dooo.ng</code>ï¼Œä½†å®é™…ä¸Šå¾—åˆ°çš„å†…å®¹å¯èƒ½æ˜¯ç›´æ¥æ¥è‡ªCloudflareçš„ç¼“å­˜ï¼Œæˆ–è€…æ˜¯ç»è¿‡Cloudflareä¼˜åŒ–å¤„ç†åçš„æ¥è‡ªåŸå§‹æœåŠ¡å™¨çš„å†…å®¹ã€‚</li></ul><h1 id="å®é™…æ“ä½œ-ğŸ› ï¸"><a href="#å®é™…æ“ä½œ-ğŸ› ï¸" class="headerlink" title="å®é™…æ“ä½œ ğŸ› ï¸"></a>å®é™…æ“ä½œ ğŸ› ï¸</h1><h2 id="å‡†å¤‡åŸŸå-ğŸŒ"><a href="#å‡†å¤‡åŸŸå-ğŸŒ" class="headerlink" title="å‡†å¤‡åŸŸå ğŸŒ"></a>å‡†å¤‡åŸŸå ğŸŒ</h2><ul><li><p>åœ¨äº†è§£äº†SaaSå›æºçš„ç›¸å…³åŸç†ä¹‹å, æˆ‘ä»¬å¯ä»¥è¿›è¡Œå®æ“äº†!</p></li><li><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸¤ä¸ªåŸŸå</p><ol><li><p><code>tongyi.tw.cn</code> &lt;â€“ ä½œä¸º æˆ‘ä»¬çš„è®¿é—®åŸŸå,ä¹Ÿå°±æ˜¯è‡ªå®šä¹‰ä¸»æœºå,ç¨åæˆ‘ä»¬è®¿é—®æ­¤åŸŸåæ¥è®¿é—®ç½‘ç«™</p></li><li><p><code>fallback.tech</code> &lt;â€“ ä½œä¸º æˆ‘ä»¬çš„å›æºåŸŸå,ä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬è®¿é—® <code>tongyi.tw.cn</code> æ—¶,cloudflareåœ¨å†…éƒ¨å›æºçš„åŸŸå</p></li><li><p>æˆ‘å°†<code>tongyi.tw.cn</code> è§£æåœ¨è…¾è®¯çš„DNSPODä¸Š, è€Œ<code>fallback.tech</code> è§£æåœ¨Cloudflareä¸Š</p><ul><li><p>å‰è€…ä¸æ˜¯å¿…é¡»çš„,ä½ å¯ä»¥éƒ½è§£æåœ¨Cloudflareä¸Š,æˆ‘é€‰æ‹©DNSPODæ˜¯å› ä¸ºå®ƒæœ‰å…è´¹çš„åˆ†æµæœåŠ¡</p><p>å¯ä»¥å°†å¢ƒå†…å¢ƒå¤–è§£æåˆ°ä¸åŒçš„cnameä¸Š</p></li><li><p>è€Œåè€…åˆ™æ˜¯å¿…é¡»çš„! å› ä¸ºåªæœ‰è§£æåœ¨cloudflareä¸Šçš„åŸŸåæ‰å¯ä»¥å¯ç”¨SaaSå›æº</p></li></ul></li></ol></li></ul><h1 id="è®¾ç½®å›æºåŸŸå-ğŸ”„"><a href="#è®¾ç½®å›æºåŸŸå-ğŸ”„" class="headerlink" title="è®¾ç½®å›æºåŸŸå ğŸ”„"></a>è®¾ç½®å›æºåŸŸå ğŸ”„</h1><h2 id="æ·»åŠ DNSè§£æ-ğŸ§©"><a href="#æ·»åŠ DNSè§£æ-ğŸ§©" class="headerlink" title="æ·»åŠ DNSè§£æ ğŸ§©"></a>æ·»åŠ DNSè§£æ ğŸ§©</h2><p><img src="https://image.dooo.ng/i/2023/11/28/6565c5ed316f3.jpg" alt="image-20231128185020364"></p><ul><li>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥æ·»åŠ ä¸€ä¸ªDNSè§£æ</li><li>è§£æåˆ°æˆ‘ä»¬çš„çœŸå®æœåŠ¡å™¨IPåœ°å€, æ­£å¦‚ä¸Šé¢æ‰€è¯´çš„,è¿™æ˜¯ä¸€ä¸ªå›æºçš„åŸŸå,ä¹Ÿå°±æ˜¯è¯´,æœåŠ¡å™¨çš„IPåˆ°åº•æ˜¯ä»€ä¹ˆ åªæœ‰è¿™å°å›æºåŸŸåçŸ¥é“,å®ƒçš„å·¥ä½œä¹Ÿåªæ˜¯èµ·åˆ°å›æºçš„ä½œç”¨</li><li>è¿™é‡Œä½ å¯ä»¥éšæ„å¡«å†™ä¸€çº§åŸŸåæˆ–äºŒçº§åŸŸå,æˆ‘æ¨èå¡«å†™äºŒçº§åŸŸå ä¹Ÿå°±æ˜¯ <code>origin.fallback.tech</code> å¯ä»¥éšæ„èµ·å</li><li>å› ä¸ºå¡«å†™äºŒçº§åŸŸå, ä½ è¿˜å¯ä»¥åœ¨DNSä¸­æ­£å¸¸è§£æä¸€çº§åŸŸå,ä»…å°†äºŒçº§åŸŸåä½œä¸ºå›é€€æº</li></ul><h2 id="æ·»åŠ å›é€€æº-ğŸ”„"><a href="#æ·»åŠ å›é€€æº-ğŸ”„" class="headerlink" title="æ·»åŠ å›é€€æº ğŸ”„"></a>æ·»åŠ å›é€€æº ğŸ”„</h2><p><img src="https://image.dooo.ng/i/2023/11/28/6565c5010d985.jpg" alt="image-20231128184623739"></p><ul><li>è¿›å…¥åˆ°CloudflareåŸŸåç®¡ç†ç•Œé¢ -&gt; SSL&#x2F;TLS -&gt; è‡ªå®šä¹‰ä¸»æœºå -&gt; æ·»åŠ ä¸€ä¸ªå›é€€æº</li><li>å›é€€æºåœ°å€å³ä¸ºæˆ‘ä»¬åˆšæ‰è§£æçš„äºŒçº§åŸŸå</li></ul><p><img src="https://image.dooo.ng/i/2023/11/28/6565c6b4281c9.jpg" alt="image-20231128185339266"></p><h2 id="æ£€æŸ¥å›é€€æºæ˜¯å¦æœ‰æ•ˆ-âœ”ï¸"><a href="#æ£€æŸ¥å›é€€æºæ˜¯å¦æœ‰æ•ˆ-âœ”ï¸" class="headerlink" title="æ£€æŸ¥å›é€€æºæ˜¯å¦æœ‰æ•ˆ âœ”ï¸"></a>æ£€æŸ¥å›é€€æºæ˜¯å¦æœ‰æ•ˆ âœ”ï¸</h2><ul><li>å›é€€æºçŠ¶æ€: <code>æœ‰æ•ˆ</code> å³ä»£è¡¨å›é€€æºæ·»åŠ æˆåŠŸ,ç°åœ¨è®¿é—® <code>origin.fallback.tech</code> ä½ åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹ç•Œé¢</li></ul><p><img src="https://image.dooo.ng/i/2023/11/28/6565c753a0a85.jpg" alt="image-20231128185618750"></p><ul><li>è¿™æ˜¯å› ä¸ºè™½ç„¶è®¾ç½®äº†å›é€€æº,ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰è®¾ç½®è‡ªå®šä¹‰ä¸»æœºå,ä¹Ÿå°±æ˜¯å›é€€æºå¹¶ä¸çŸ¥é“è¦å°†å“ªä¸ªä¸»æœºåå›æºåˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨IP</li></ul><h1 id="è®¾ç½®è‡ªå®šä¹‰ä¸»æœºå-ğŸ "><a href="#è®¾ç½®è‡ªå®šä¹‰ä¸»æœºå-ğŸ " class="headerlink" title="è®¾ç½®è‡ªå®šä¹‰ä¸»æœºå ğŸ "></a>è®¾ç½®è‡ªå®šä¹‰ä¸»æœºå ğŸ </h1><h2 id="æ·»åŠ è‡ªå®šä¹‰ä¸»æœºå-ğŸŒ"><a href="#æ·»åŠ è‡ªå®šä¹‰ä¸»æœºå-ğŸŒ" class="headerlink" title="æ·»åŠ è‡ªå®šä¹‰ä¸»æœºå ğŸŒ"></a>æ·»åŠ è‡ªå®šä¹‰ä¸»æœºå ğŸŒ</h2><p><img src="https://image.dooo.ng/i/2023/11/28/6565c922e065d.jpg" alt="image-20231128190401927"></p><h2 id="è®¾ç½®ä¸»æœºåä¿¡æ¯-ğŸ› ï¸"><a href="#è®¾ç½®ä¸»æœºåä¿¡æ¯-ğŸ› ï¸" class="headerlink" title="è®¾ç½®ä¸»æœºåä¿¡æ¯ ğŸ› ï¸"></a>è®¾ç½®ä¸»æœºåä¿¡æ¯ ğŸ› ï¸</h2><p><img src="https://image.dooo.ng/i/2023/11/28/6565c9322b81f.jpg" alt="image-20231128190417387"></p><ul><li><p>è‡ªå®šä¹‰ä¸»æœºå: å¡«å†™ä½ è¦è§£æçš„åŸŸå, å¯ä»¥ä¸ºä¸€çº§æˆ–è€…äºŒçº§å‡å¯,è¿™é‡Œæˆ‘å¡«å†™ <code>tongyi.tw.cn</code></p></li><li><p>TLSç‰ˆæœ¬é»˜è®¤å¡«å†™1.0å³å¯</p></li><li><p>è¯ä¹¦éªŒè¯æ–¹æ³•å¡«å†™TXTéªŒè¯</p></li></ul><h2 id="éªŒè¯åŸŸåæ‰€æœ‰æƒ-ğŸ“‹"><a href="#éªŒè¯åŸŸåæ‰€æœ‰æƒ-ğŸ“‹" class="headerlink" title="éªŒè¯åŸŸåæ‰€æœ‰æƒ ğŸ“‹"></a>éªŒè¯åŸŸåæ‰€æœ‰æƒ ğŸ“‹</h2><p><img src="https://image.dooo.ng/i/2023/11/28/6565ca912e0fd.jpg" alt="image-20231128191006506"></p><ul><li><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦éªŒè¯æˆ‘ä»¬åŸŸåçš„æ‰€æœ‰æƒå’Œè¯ä¹¦éªŒè¯</p></li><li><p>å»åˆ°ä½ çš„DNSè§£æé¢æ¿æ·»åŠ è¿™ä¸¤ä¸ªTXTè§£æ</p></li><li><p>å€¼å¾—æ³¨æ„çš„æ˜¯ä½ çš„ä¸¤ä¸ªTXTéªŒè¯åç§°åº”è¯¥ä¸åŒ…å«ä¸»åŸŸå, ä¾‹å¦‚ç›´æ¥å¤åˆ¶ä¸‹æ¥æ˜¯<code>_acme-challenge.tongyi.tw.cn</code> ä½ åº”è¯¥åˆ å» <code>tongyi.tw.cn</code> å³ä¸º <code>_acme-challenge</code> å› ä¸ºå®ƒç»™ä½ çš„æ˜¯éªŒè¯çš„å®Œæ•´åœ°å€,ä½ çš„è§£æå·²ç»åŒ…æ‹¬<code>tongyi.tw.cn</code></p></li><li><p>äºŒçº§åŸŸååŒç†,ä¾‹å¦‚ <code>_acme-challenge.1.tongyi.tw.cn</code> ä½ åº”è¯¥æ”¹ä¸º <code>_acme-challenge.1</code></p></li><li><p>æ·»åŠ å¥½ä¹‹åç¨ç­‰ç‰‡åˆ»,ç­‰å¾…CFæœåŠ¡å™¨å»éªŒè¯</p></li></ul><h1 id="è®¾ç½®ä¼˜é€‰IP-ğŸš€"><a href="#è®¾ç½®ä¼˜é€‰IP-ğŸš€" class="headerlink" title="è®¾ç½®ä¼˜é€‰IP ğŸš€"></a>è®¾ç½®ä¼˜é€‰IP ğŸš€</h1><p>ç»è¿‡æˆ‘ä»¬ä¸€ç•ªæŠ˜è…¾,æœ€å¥½ç©çš„éƒ¨åˆ†æ¥äº†</p><h2 id="è®¾ç½®åˆ†æµ-ğŸ›£ï¸"><a href="#è®¾ç½®åˆ†æµ-ğŸ›£ï¸" class="headerlink" title="è®¾ç½®åˆ†æµ ğŸ›£ï¸"></a>è®¾ç½®åˆ†æµ ğŸ›£ï¸</h2><p><img src="https://image.dooo.ng/i/2023/11/28/6565cd52ead7e.jpg" alt="image-20231128192154083"></p><ul><li><p>æ·»åŠ ä¸¤ä¸ªäºŒçº§åŸŸåè®°å½•,ä¸€ä¸ª<code>çº¿è·¯</code>é€‰æ‹©<code>å¢ƒå†…</code>,å¦ä¸€ä¸ªé€‰æ‹©<code>å¢ƒå¤–</code></p></li><li><p>å¢ƒå¤–æˆ‘ä»¬ç›´æ¥è§£æåˆ° <code>1.0.0.5</code></p></li><li><p>å¢ƒå†…æˆ‘ä»¬CNAMEè§£æåˆ° <code>csgo.com</code> ä½ è¿˜å¯ä»¥é€‰æ‹©å¾ˆå¤š,åªè¦æ˜¯å›½å†…è®¿é—®é€Ÿåº¦ä¸é”™,ä½¿ç”¨Cloudflare CDNçš„,ä½ éƒ½å¯ä»¥cnameè§£æä¸Šå»</p><h3 id="å¯ä½¿ç”¨çš„CNAMEä¼˜é€‰åŸŸåå‚è€ƒ-ğŸŒ"><a href="#å¯ä½¿ç”¨çš„CNAMEä¼˜é€‰åŸŸåå‚è€ƒ-ğŸŒ" class="headerlink" title="å¯ä½¿ç”¨çš„CNAMEä¼˜é€‰åŸŸåå‚è€ƒ ğŸŒ"></a>å¯ä½¿ç”¨çš„CNAMEä¼˜é€‰åŸŸåå‚è€ƒ ğŸŒ</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Qatar2022</span><span class="hljs-params">(SAN JOSE IP)</span></span> : <br>www<span class="hljs-selector-class">.qatar2022</span><span class="hljs-selector-class">.qa</span><br><br>IPæŸ¥è¯¢ : <br>ip<span class="hljs-selector-class">.skk</span><span class="hljs-selector-class">.moe</span><br>ping<span class="hljs-selector-class">.pe</span><br><br>æ”¿åºœç½‘ç«™:<br>ä¹Œå…‹å…°ğŸ‡ºğŸ‡¦æ”¿åºœ<br>www<span class="hljs-selector-class">.gov</span><span class="hljs-selector-class">.ua</span><br><br>æ³°å›½ğŸ‡¹ğŸ‡­æ”¿åºœ<br>www<span class="hljs-selector-class">.thaigov</span><span class="hljs-selector-class">.go</span><span class="hljs-selector-class">.th</span><br><br>å¡å¡”å°”ğŸ‡¶ğŸ‡¦æ”¿åºœ<br>www<span class="hljs-selector-class">.gco</span><span class="hljs-selector-class">.gov</span><span class="hljs-selector-class">.qa</span><br><br>ç‘å…¸ğŸ‡¸ğŸ‡ªæ”¿åºœ<br>www<span class="hljs-selector-class">.gov</span><span class="hljs-selector-class">.se</span><br><br>ç¾å›½ğŸ‡ºğŸ‡¸FBI:<br>FBI<span class="hljs-selector-class">.GOV</span><br><br>å•†ä¸šç½‘ç«™ï¼š<br>CSGOå®˜æ–¹ç½‘ç«™<br>(Cloudflare LONDON ASN)ï¼š<br>CSGO<span class="hljs-selector-class">.COM</span><br><br>DigitalOcean<br>digitalocean<span class="hljs-selector-class">.com</span><br><br>VISAå®˜æ–¹ç½‘ç«™ï¼š<br>(æ ¼å¼ï¼š VISA.å›½å®¶é¡¶çº§åŸŸå)<br>VISA<span class="hljs-selector-class">.COM</span><br>VISA<span class="hljs-selector-class">.CN</span><br>VISA<span class="hljs-selector-class">.FI</span><br>VISA<span class="hljs-selector-class">.HK</span><br><br>ä¼ªAMEX:<br>AMEX<span class="hljs-selector-class">.COM</span><br><br><span class="hljs-function"><span class="hljs-title">SHOPIFY</span><span class="hljs-params">(æ¨è)</span></span>:<br>SHOPIFY<span class="hljs-selector-class">.COM</span><br><br>åŸŸåæ³¨å†Œå•†ï¼š<br>Dynadot<span class="hljs-selector-class">.COM</span><br><br>å…¶å®ƒç½‘ç«™ï¼š<br>SINGAPORE<span class="hljs-selector-class">.COM</span><br>JAPAN<span class="hljs-selector-class">.COM</span><br>BRAZIL<span class="hljs-selector-class">.COM</span><br>MALAYSIA<span class="hljs-selector-class">.COM</span><br>RUSSIA.COM<br></code></pre></td></tr></table></figure><p>Makefile</p></li></ul><h2 id="æ·»åŠ è§£æ-ğŸ§©"><a href="#æ·»åŠ è§£æ-ğŸ§©" class="headerlink" title="æ·»åŠ è§£æ ğŸ§©"></a>æ·»åŠ è§£æ ğŸ§©</h2><p><img src="https://image.dooo.ng/i/2023/11/28/6565cea7f34da.jpg" alt="image-20231128192733483"></p><ul><li>å†å°†æˆ‘ä»¬è¦è®¿é—®çš„åŸŸå,CNAMEè§£æåˆ°æˆ‘ä»¬çš„CDNè®°å½•ä¸Šå³å¯,</li></ul><h1 id="æ’æŸ¥é”™è¯¯-ğŸ”"><a href="#æ’æŸ¥é”™è¯¯-ğŸ”" class="headerlink" title="æ’æŸ¥é”™è¯¯ ğŸ”"></a>æ’æŸ¥é”™è¯¯ ğŸ”</h1><ul><li><p>æ³¨æ„å¦‚æœè¦è®¿é—®,æˆ‘ä»¬çš„ç«™ç‚¹å¿…é¡»å¼€å¯SSLè¯ä¹¦å’ŒHTTPSè®¿é—®,ä¸ç„¶ä¼šç›´æ¥404,å› ä¸ºå›æºåªå›æºåˆ°443ç«¯å£</p></li><li><p>ç°åœ¨æˆ‘ä»¬æ‰“å¼€ç½‘ç«™æµ‹è¯•ä¸‹èƒ½å¦æ­£å¸¸è®¿é—®</p></li></ul><h2 id="é‡å®šå‘æ¬¡æ•°è¿‡å¤š"><a href="#é‡å®šå‘æ¬¡æ•°è¿‡å¤š" class="headerlink" title="é‡å®šå‘æ¬¡æ•°è¿‡å¤š"></a>é‡å®šå‘æ¬¡æ•°è¿‡å¤š</h2><p><img src="https://image.dooo.ng/i/2023/11/28/6565cf6930430.jpg" alt="image-20231128193047979"></p><p>æç¤ºæˆ‘ä»¬é‡å®šå‘è¿‡å¤š,è¿™æ˜¯å› ä¸ºHTTPSåŠ å¯†çš„é—®é¢˜,æˆ‘ä»¬è¿›å…¥Cloudflareåå° -&gt; SSL&#x2F;TLS -&gt; æ¦‚è¿°</p><p>â€‹ <img src="https://image.dooo.ng/i/2023/11/28/6565cfc3f3346.jpg" alt="image-20231128193218725"></p><p>å°†SSL&#x2F;TLSåŠ å¯†æ¨¡å¼æ”¹ä¸º â€œå®Œå…¨â€ å†æ¬¡å°è¯•è®¿é—®</p><h2 id="Invalid-SSL-Certificate"><a href="#Invalid-SSL-Certificate" class="headerlink" title="Invalid SSL Certificate"></a>Invalid SSL Certificate</h2><p><img src="https://image.dooo.ng/i/2023/11/28/65660ac867011.webp"></p><ul><li>å‡ºç°æ­¤é—®é¢˜æ˜¯å› ä¸ºæˆ‘ä»¬çš„å›æºåŸŸå <code>fallback.tech</code> åœ¨è¿›è¡Œå›æºæ—¶,è®¿é—®çš„æ˜¯ <code>tongyi.tw.cn</code></li><li>è™½ç„¶æˆ‘ä»¬åœ¨éªŒè¯æ‰€æœ‰æƒæ—¶ç”³è¯·äº†ä¸€ä¸ªè¯ä¹¦,ä½†é‚£ä¸ªè¯ä¹¦æ˜¯ç”¨äºå›æºä¹‹åå‘ˆç°ç»™ç”¨æˆ·ç«¯çš„, åœ¨å›æºè¿‡ç¨‹ä¸­ä¸ä¼šç”Ÿæ•ˆ</li><li>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»™ <code>tongyi.tw.cn</code> ç”³è¯·ä¸€ä¸ªè¯ä¹¦, å¯ä»¥é€šè¿‡å®å¡”é¢æ¿,NPMç­‰ç­‰æ–¹å¼,åªè¦ç”³è¯·ä¸€ä¸ªè¯ä¹¦å¹¶é…ç½®å³å¯è§£å†³æ­¤é—®é¢˜</li></ul><h1 id="ç»“æœæµ‹è¯•-ğŸ§ª"><a href="#ç»“æœæµ‹è¯•-ğŸ§ª" class="headerlink" title="ç»“æœæµ‹è¯• ğŸ§ª"></a>ç»“æœæµ‹è¯• ğŸ§ª</h1><p><img src="https://image.dooo.ng/i/2023/11/28/6565d0b8e8501.jpg"></p><p>ç½‘ç«™è®¿é—®æˆåŠŸ! æˆ‘ä»¬å»itdog Pingä¸€ä¸‹è¯•è¯•çœ‹</p><h2 id="Ping-æµ‹è¯•"><a href="#Ping-æµ‹è¯•" class="headerlink" title="Ping æµ‹è¯•"></a>Ping æµ‹è¯•</h2><p><img src="https://image.dooo.ng/i/2023/11/28/6565d0ff7ae80.jpg" alt="image-20231128193734518"></p><ul><li>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç½‘å€æ˜¯ç»è¿‡csgo.comåŒæ¬¾çš„Cloudflare ASNè¿›è¡Œè§£æçš„</li><li>æµ·å¤–æ˜¯é€šè¿‡ 1.0.0.5 è¿›è¡Œè§£æçš„</li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><blockquote><p>é€šè¿‡è¿™ç§æ–¹æ³•,æˆ‘ä»¬å¯ä»¥å®ç°å‡ ä¹å›½å†…å…¨ç»¿<br>Cloudflare + SaaSè¿˜æœ‰å¾ˆå¤šç©æ³•,è‡ªå»ºCloudflareèŠ‚ç‚¹ç­‰ç­‰</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>go windowsç¯å¢ƒä¸‹ç¼–è¯‘æˆ linuxå¯æ‰§è¡Œæ–‡ä»¶</title>
    <link href="/article/7ec68bf.html"/>
    <url>/article/7ec68bf.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />cmdæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> <span class="hljs-attribute">GOARCH</span>=amd64<br>go env -w <span class="hljs-attribute">GOARCH</span>=amd64<br><span class="hljs-built_in">set</span> <span class="hljs-attribute">GOOS</span>=linux<br>go env -w <span class="hljs-attribute">GOOS</span>=linux<br></code></pre></td></tr></table></figure><p>go build -o myapp [<a href="https://so.csdn.net/so/search?q=%E6%96%87%E4%BB%B6%E5%90%8D&spm=1001.2101.3001.7020">æ–‡ä»¶å</a>]</p><p>ç„¶ågo build [æ–‡ä»¶å]ï¼Œç¼–è¯‘å¥½çš„ç¨‹åºæ”¾åˆ°linuxç¯å¢ƒä¸‹</p><p>chmod 777 [æ–‡ä»¶å] ç»™æƒé™ï¼Œæ‰§è¡Œå³å¯</p><p>å†åˆ‡æ¢å›windows</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">go env -w <span class="hljs-attribute">GOARCH</span>=amd64<br>go env -w <span class="hljs-attribute">GOOS</span>=windows<br></code></pre></td></tr></table></figure><p>åˆå¯ä»¥æ„‰å¿«çš„ç¼–è¯‘exe<a href="https://so.csdn.net/so/search?q=%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6&spm=1001.2101.3001.7020">å¯æ‰§è¡Œæ–‡ä»¶</a>å•¦</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goè¯­è¨€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title> golangä¸‹åˆ’çº¿çš„ä¸‰ç§ç”¨æ³•</title>
    <link href="/article/ea4c3f0f.html"/>
    <url>/article/ea4c3f0f.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />## 1\. å¿½ç•¥è¿”å›å€¼<blockquote><p>æŸä¸ªå‡½æ•°è¿”å›ä¸‰ä¸ªå‚æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€è¦å…¶ä¸­çš„ä¸¤ä¸ªï¼Œå¦å¤–ä¸€ä¸ªå‚æ•°å¯ä»¥å¿½ç•¥</p></blockquote><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">v1, v2, <span class="hljs-attr">_</span> := <span class="hljs-keyword">function</span>(<span class="hljs-params">...</span>)<br></code></pre></td></tr></table></figure><h2 id="2-ç”¨åœ¨-import-package"><a href="#2-ç”¨åœ¨-import-package" class="headerlink" title="2. ç”¨åœ¨ import package"></a>2. ç”¨åœ¨ import package</h2><blockquote><p>è‡ªåŠ¨è°ƒç”¨å¯¼å…¥åŒ…çš„ init() è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œä¸ä½¿ç”¨åŒ…ä¸­å…¶ä»–åŠŸèƒ½ã€‚</p></blockquote><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">import</span> <span class="hljs-literal">_</span> <span class="hljs-string">&quot;test/foo&quot;</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>        <span class="hljs-string">&quot;fmt&quot;</span><br>        _ <span class="hljs-string">&quot;test/foo&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>        fmt.Printf(<span class="hljs-string">&quot;hello world\n&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœ</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">init</span> foo <span class="hljs-built_in">object</span>: &amp;&#123;<span class="hljs-number">123</span> abc&#125;<br>hello world<br></code></pre></td></tr></table></figure><h2 id="3-å˜é‡æ–­è¨€"><a href="#3-å˜é‡æ–­è¨€" class="headerlink" title="3. å˜é‡æ–­è¨€"></a>3. å˜é‡æ–­è¨€</h2><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs elm">// å®šä¹‰äº†ä¸€ä¸ªæ¥å£<br><span class="hljs-keyword">type</span> <span class="hljs-type">Foo</span> interface &#123;<br>     <span class="hljs-type">Say</span>()<br>&#125;<br><br>// ç»“æ„ä½“<br><span class="hljs-keyword">type</span> <span class="hljs-type">Dog</span> struct &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¦‚æœDogæ²¡æœ‰å®ç°Fooï¼Œåˆ™ä¼šæŠ¥ç¼–è¯‘é”™è¯¯</strong></p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">var</span> <span class="hljs-literal">_</span> Foo = Dog&#123;&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goè¯­è¨€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VS codeä¸­goçš„importå¤±è´¥ã€æ ‡çº¢ç­‰é—®é¢˜</title>
    <link href="/article/71087366.html"/>
    <url>/article/71087366.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />å±å®æœ‰äº›çƒ¦<h1 id="å¯¼å…¥å®˜æ–¹åº“å¤±è´¥"><a href="#å¯¼å…¥å®˜æ–¹åº“å¤±è´¥" class="headerlink" title="å¯¼å…¥å®˜æ–¹åº“å¤±è´¥"></a>å¯¼å…¥å®˜æ–¹åº“å¤±è´¥</h1><p>æŸ¥çœ‹ä¸€ä¸‹<code>GOROOT</code>çš„é…ç½®æ˜¯ä¸æ˜¯Goçš„å®‰è£…ç›®å½•</p><h1 id="å¯¼å…¥ç¬¬ä¸‰æ–¹åº“å¤±è´¥"><a href="#å¯¼å…¥ç¬¬ä¸‰æ–¹åº“å¤±è´¥" class="headerlink" title="å¯¼å…¥ç¬¬ä¸‰æ–¹åº“å¤±è´¥"></a>å¯¼å…¥ç¬¬ä¸‰æ–¹åº“å¤±è´¥</h1><p>åœ¨vscodeä¸­å®‰è£…å®Œgoè¯­è¨€æ‰©å±•æ’ä»¶åï¼Œä¼šæç¤ºå®‰è£…<code>gopls</code>ï¼ˆgo pleaseï¼‰ã€‚å¦‚æœè‡ªåŠ¨å®‰è£…ä¸äº†ï¼Œå¯ä»¥æ‰‹åŠ¨ä½¿ç”¨go install å®‰è£…ã€‚</p><p>å¦‚æœå®‰è£…å®Œgoplsåï¼Œå¯¼å…¥åŒ…è¿˜å­˜åœ¨é—®é¢˜ï¼Œå¤§æ„æ˜¯æ‰¾ä¸åˆ°<code>%GOPATH%\src\XXX</code>,é‚£ä¹ˆå¯ä»¥æ£€æŸ¥ä¸€ä¸‹ï¼š</p><ol><li>vscodeçš„workspaceï¼Œä¸è¦ä¸€ä¸‹å­æ‰“å¼€æ•´ä¸ªGOPATHæ–‡ä»¶å¤¹ï¼Œè€Œæ˜¯æ‰“å¼€GOPATHä¸‹å•ä¸ªé¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼Œé”™è¯¯æç¤ºåº”è¯¥å°±ä¼šæ¶ˆå¤±ã€‚</li><li>è®¾ç½®go envçš„å…¨å±€å˜é‡<code>go env -w GO111MODULE=on</code>, é‡å¯vscode</li></ol><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://stackoverflow.com/questions/58518588/vscode-could-not-import-golang-package">https://stackoverflow.com/questions/58518588/vscode-could-not-import-golang-package</a></p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vscode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ymlçº¯æ•°å­—é…ç½®è¯»å–å¤±è´¥</title>
    <link href="/article/ffa963ad.html"/>
    <url>/article/ffa963ad.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />é¡¹ç›®ä¸­ç¢°åˆ°ä¸€ä¸ªè¯¡å¼‚é—®é¢˜ï¼Œymlæ–‡ä»¶ä¸­é…ç½®äº†ä¸€ä¸ªå€¼ä¸º[å­—ç¬¦ä¸²](https://so.csdn.net/so/search?q=%E5%AD%97%E7%AC%A6%E4%B8%B2&spm=1001.2101.3001.7020 "å­—ç¬¦ä¸²")çš„å±æ€§ï¼ˆ010112156ï¼‰ï¼Œç”¨@Valueæ³¨å…¥æ—¶ç¡®å‘ç°ä¸å¯¹åº”ï¼Œå‡ºç°äº†å…¨é¡¹ç›®ä¸­éƒ½æ‰¾ä¸åˆ°çš„å€¼ã€‚ç ”ç©¶äº†åŠå¤©æ‰å‘ç°ï¼Œymlä¼šæŠŠ0å¼€å¤´çš„æ•°å­—ä½œä¸º8è¿›åˆ¶å¯¹å¾…ï¼Œæ³¨å…¥æ—¶è½¬åŒ–ä¸ºåè¿›åˆ¶æ³¨å…¥<p>ä¾‹å¦‚</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/671fa7ddb76deb87403e7f2f8450701c.png"></p><p>Â è¯»å–åˆ°çš„æ•°å€¼ä¼šå˜æˆ555.0<br>æ­£ç¡®é…ç½®</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/049c0c5970f91147ca33b4799e425953.png"></p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringCloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloudé¡¹ç›®æ— æ³•è¯»å–bootstrap.ymlé…ç½®æ–‡ä»¶çš„è§£å†³åŠæ³•</title>
    <link href="/article/c796e17b.html"/>
    <url>/article/c796e17b.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />### é—®é¢˜æè¿°<p>åœ¨ä½¿ç”¨spring clouod 2021.0.0ï¼Œå‘ç°å¯¹æ¥<a href="https://so.csdn.net/so/search?q=nacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83&spm=1001.2101.3001.7020">nacosé…ç½®ä¸­å¿ƒ</a>çš„æ—¶å€™ï¼Œä¸€ç›´æ— æ³•è¯»å–åˆ°bootstarpçš„é…ç½®ä¿¡æ¯ã€‚</p><h3 id="é—®é¢˜ç»†ç©¶"><a href="#é—®é¢˜ç»†ç©¶" class="headerlink" title="é—®é¢˜ç»†ç©¶"></a>é—®é¢˜ç»†ç©¶</h3><p>ç½‘ä¸Šæœäº†ä¸€ä¸‹ï¼Œä»Spring Boot 2.4ç‰ˆæœ¬å¼€å§‹ï¼Œé…ç½®æ–‡ä»¶åŠ è½½æ–¹å¼è¿›è¡Œäº†é‡æ„ã€‚</p><p>spring cloud2.4ä¹‹å‰çš„æºç ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">package org.springframework.cloud.bootstrap;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BootstrapApplicationListener</span> <span class="hljs-title">implements</span> <span class="hljs-title">ApplicationListener</span>&lt;<span class="hljs-title">ApplicationEnvironmentPreparedEvent</span>&gt;, <span class="hljs-title">Ordered</span> &#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onApplicationEvent</span>(<span class="hljs-params">ApplicationEnvironmentPreparedEvent <span class="hljs-keyword">event</span></span>)</span> &#123;        ConfigurableEnvironment environment = <span class="hljs-keyword">event</span>.getEnvironment();        <span class="hljs-keyword">if</span> ((Boolean)environment.getProperty(<span class="hljs-string">&quot;spring.cloud.bootstrap.enabled&quot;</span>, Boolean.<span class="hljs-keyword">class</span>, <span class="hljs-literal">true</span>)) &#123;        &#125;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>spring cloud2.4ä¹‹åçš„æºç ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">package</span> org.springframework.cloud.util;<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> PropertyUtils &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> bootstrapEnabled(Environment environment) &#123;        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">Boolean</span>)environment.getProperty(<span class="hljs-string">&quot;spring.cloud.bootstrap.enabled&quot;</span>, <span class="hljs-keyword">Boolean</span>.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">false</span>) || MARKER_CLASS_EXISTS;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å¯¹æ¯”ä¹‹ä¸‹ï¼Œèƒ½çœ‹å‡ºé—®é¢˜ï¼Œåœ¨spring cloud2.4ä¹‹åå°†bootstrap.enabledè®¾ç½®ä¸ºfalseã€‚</p><h3 id="è§£å†³æ–¹å¼ä¸€ï¼š"><a href="#è§£å†³æ–¹å¼ä¸€ï¼š" class="headerlink" title="è§£å†³æ–¹å¼ä¸€ï¼š"></a>è§£å†³æ–¹å¼ä¸€ï¼š</h3><p>æ·»åŠ bootstrapçš„POMä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-comment">&lt;!-- è‡ªè¡Œä¿®æ”¹ç›¸åº”ç‰ˆæœ¬--&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹å¼äºŒï¼š"><a href="#è§£å†³æ–¹å¼äºŒï¼š" class="headerlink" title="è§£å†³æ–¹å¼äºŒï¼š"></a>è§£å†³æ–¹å¼äºŒï¼š</h3><p>æ·»åŠ ç¯å¢ƒå˜é‡ï¼š</p><p>spring.cloud.bootstrap.enabled&#x3D;trueÂ </p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/7ebbf16770e3420a6b64acf124399cc3.png"></p><p><strong>ç‰¹æ®Šè¯´æ˜ï¼š</strong>å¦‚æœä½ ä¸æ˜¯spring cloudé¡¹ç›®ï¼Œåªæ˜¯spring booté¡¹ç›®ï¼Œåœ¨å¯åŠ¨æ— æ³•åŠ è½½åˆ°bootstrapçš„é…ç½®ï¼Œåº”è¯¥ä¸ºå¦‚ä¸‹è§£å†³æ–¹å¼ï¼š</p><p>æ·»åŠ spring-cloud-contextçš„POMä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.1.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringCloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RabbitMqé›†ç¾¤</title>
    <link href="/article/28af8ecc.html"/>
    <url>/article/28af8ecc.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />-   [RabbitMQ å¦‚ä½•åšåˆ†å¸ƒå¼](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#rabbitmq-%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%86%E5%B8%83%E5%BC%8F)    -   [å‰è¨€](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E5%89%8D%E8%A8%80)    -   [é›†ç¾¤é…ç½®æ–¹æ¡ˆ](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88)        -   [cluster](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#cluster)            -   [æ™®é€šæ¨¡å¼](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E6%99%AE%E9%80%9A%E6%A8%A1%E5%BC%8F)            -   [é•œåƒæ¨¡å¼](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E9%95%9C%E5%83%8F%E6%A8%A1%E5%BC%8F)        -   [federation](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#federation)        -   [shovel](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#shovel)    -   [èŠ‚ç‚¹ç±»å‹](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B)        -   [RAM node](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#ram-node)        -   [Disk node](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#disk-node)    -   [é›†ç¾¤çš„æ­å»º](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E9%9B%86%E7%BE%A4%E7%9A%84%E6%90%AD%E5%BB%BA)        -   [1ã€å±€åŸŸç½‘é…ç½®](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#1%E5%B1%80%E5%9F%9F%E7%BD%91%E9%85%8D%E7%BD%AE)        -   [2ã€æ¯å°åŠå…¶ä¸­å®‰è£… RabbitMQ](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#2%E6%AF%8F%E5%8F%B0%E5%8F%8A%E5%85%B6%E4%B8%AD%E5%AE%89%E8%A3%85-rabbitmq)        -   [3ã€è®¾ç½®ä¸åŒèŠ‚ç‚¹é—´åŒä¸€è®¤è¯çš„Erlang Cookie](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#3%E8%AE%BE%E7%BD%AE%E4%B8%8D%E5%90%8C%E8%8A%82%E7%82%B9%E9%97%B4%E5%90%8C%E4%B8%80%E8%AE%A4%E8%AF%81%E7%9A%84erlang-cookie)        -   [4ã€ä½¿ç”¨ -detachedè¿è¡Œå„èŠ‚ç‚¹](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#4%E4%BD%BF%E7%94%A8--detached%E8%BF%90%E8%A1%8C%E5%90%84%E8%8A%82%E7%82%B9)        -   [5ã€å°†èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#5%E5%B0%86%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E5%88%B0%E9%9B%86%E7%BE%A4%E4%B8%AD)        -   [6ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#6%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81)    -   [å‚è€ƒ](https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E5%8F%82%E8%80%83)<h2 id="RabbitMQ-å¦‚ä½•åšåˆ†å¸ƒå¼"><a href="#RabbitMQ-å¦‚ä½•åšåˆ†å¸ƒå¼" class="headerlink" title="RabbitMQ å¦‚ä½•åšåˆ†å¸ƒå¼"></a>RabbitMQ å¦‚ä½•åšåˆ†å¸ƒå¼<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#rabbitmq-%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%86%E5%B8%83%E5%BC%8F"></a></h2><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E5%89%8D%E8%A8%80"></a></h3><p>å‰é¢å‡ ç¯‡æ–‡ç« ä»‹ç»äº†æ¶ˆæ¯é˜Ÿåˆ—ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œè¿™ç¯‡æ¥èŠèŠ RabbitMQ çš„é›†ç¾¤æ­å»ºã€‚</p><h3 id="é›†ç¾¤é…ç½®æ–¹æ¡ˆ"><a href="#é›†ç¾¤é…ç½®æ–¹æ¡ˆ" class="headerlink" title="é›†ç¾¤é…ç½®æ–¹æ¡ˆ"></a>é›†ç¾¤é…ç½®æ–¹æ¡ˆ<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88"></a></h3><p>RabbitMQ ä¸­é›†ç¾¤çš„éƒ¨ç½²æ–¹æ¡ˆæœ‰ä¸‰ç§ cluster,federation,shovelã€‚</p><h4 id="cluster"><a href="#cluster" class="headerlink" title="cluster"></a>cluster<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#cluster"></a></h4><p>cluster æœ‰ä¸¤ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯æ™®é€šæ¨¡å¼å’Œé•œåƒæ¨¡å¼</p><p>cluster çš„ç‰¹ç‚¹ï¼š</p><p>1ã€ä¸æ”¯æŒè·¨ç½‘æ®µï¼Œç”¨äºåŒä¸€ä¸ªç½‘æ®µå†…çš„å±€åŸŸç½‘ï¼›</p><p>2ã€å¯ä»¥éšæ„çš„åŠ¨æ€å¢åŠ æˆ–è€…å‡å°‘ï¼›</p><p>3ã€èŠ‚ç‚¹ä¹‹é—´éœ€è¦è¿è¡Œç›¸åŒç‰ˆæœ¬çš„ RabbitMQ å’Œ Erlang ã€‚</p><h5 id="æ™®é€šæ¨¡å¼"><a href="#æ™®é€šæ¨¡å¼" class="headerlink" title="æ™®é€šæ¨¡å¼"></a>æ™®é€šæ¨¡å¼<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E6%99%AE%E9%80%9A%E6%A8%A1%E5%BC%8F"></a></h5><p>cluster æ™®é€šæ¨¡å¼(é»˜è®¤çš„é›†ç¾¤æ¨¡å¼)ï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¸­çš„å…ƒæ•°æ®æ˜¯ä¸€è‡´çš„ï¼ŒRabbitMQ ä¸­çš„å…ƒæ•°æ®ä¼šè¢«å¤åˆ¶åˆ°æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚</p><p>é˜Ÿåˆ—é‡Œé¢çš„æ•°æ®åªä¼šå­˜åœ¨åˆ›å»ºå®ƒçš„èŠ‚ç‚¹ä¸Šï¼Œå…¶ä»–èŠ‚ç‚¹é™¤äº†å­˜å‚¨å…ƒæ•°æ®ï¼Œè¿˜å­˜å‚¨äº†æŒ‡å‘ Queue çš„ä¸»èŠ‚ç‚¹(owner node)çš„æŒ‡é’ˆã€‚</p><p>é›†ç¾¤ä¸­èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰ä¸»ä»èŠ‚ç‚¹ä¹‹åˆ†ã€‚</p><p><img src="https://boilingfrog.github.io//img/mq/mq-rabbitmq-cluster.png" alt="mq"></p><p>ä¸¾ä¸ªæ —å­æ¥è¯´æ˜ä¸‹æ™®é€šæ¨¡å¼çš„æ¶ˆæ¯ä¼ è¾“ï¼š</p><p>å‡è®¾æˆ‘ä»¬ RabbitMQ ä¸­æœ‰æ˜¯ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯ <code>node1,node2,node3</code>ã€‚å¦‚æœé˜Ÿåˆ— queue1 çš„è¿æ¥åˆ›å»ºå‘ç”Ÿåœ¨ node1 ä¸­ï¼Œé‚£ä¹ˆè¯¥é˜Ÿåˆ—çš„å…ƒæ•°æ®ä¼šè¢«åŒæ­¥åˆ°æ‰€æœ‰çš„èŠ‚ç‚¹ä¸­ï¼Œä½†æ˜¯ queue1 ä¸­çš„æ¶ˆæ¯ï¼Œåªä¼šåœ¨ node1 ä¸­ã€‚</p><ul><li>å¦‚æœä¸€ä¸ªæ¶ˆè´¹è€…é€šè¿‡ node2 è¿æ¥ï¼Œç„¶åæ¥æ¶ˆè´¹ queue1 ä¸­çš„æ¶ˆæ¯?</li></ul><p>RabbitMQ ä¼šä¸´æ—¶åœ¨ node1ã€node2 é—´è¿›è¡Œæ¶ˆæ¯ä¼ è¾“ï¼Œå› ä¸ºé owner èŠ‚ç‚¹é™¤äº†å­˜å‚¨å…ƒæ•°æ®ï¼Œè¿˜ä¼šå­˜å‚¨æŒ‡å‘ Queue çš„ä¸»èŠ‚ç‚¹(owner node)çš„æŒ‡é’ˆã€‚RabbitMQ ä¼šæ ¹æ®è¿™ä¸ªæŒ‡å‘ï¼ŒæŠŠ node1 ä¸­çš„æ¶ˆæ¯å®ä½“å–å‡ºå¹¶ç»è¿‡ node2 å‘é€ç»™ consumer ã€‚</p><ul><li>å¦‚æœä¸€ä¸ªç”Ÿäº§è€…é€šè¿‡ node2 è¿æ¥ï¼Œç„¶åæ¥å‘ queue1 ä¸­ç”Ÿäº§æ•°æ®?</li></ul><p>åŒç†ï¼ŒRabbitMQ ä¼šæ ¹æ® node2 ä¸­çš„ä¸»èŠ‚ç‚¹(owner node)çš„æŒ‡é’ˆï¼ŒæŠŠæ¶ˆæ¯è½¬å‘é€ç»™ owner èŠ‚ç‚¹ node1,æœ€åæ’å…¥çš„æ•°æ®è¿˜æ˜¯åœ¨ node1 ä¸­ã€‚</p><p><img src="https://boilingfrog.github.io//img/mq/mq-rabbitmq-cluster-data.png" alt="mq"></p><p>åŒæ—¶å¯¹äºé˜Ÿåˆ—çš„åˆ›å»ºï¼Œè¦å¹³å‡çš„è½åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¦‚æœåªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºé˜Ÿåˆ—ï¼Œæ‰€æœ‰çš„æ¶ˆè´¹ï¼Œæœ€ç»ˆéƒ½ä¼šè½åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä¼šäº§ç”Ÿç“¶é¢ˆã€‚</p><p>å­˜åœ¨çš„é—®é¢˜ï¼š</p><p>å¦‚æœ node1 èŠ‚ç‚¹æ•…éšœäº†ï¼Œé‚£ä¹ˆ node2 èŠ‚ç‚¹æ— æ³•å–å‡º node1 ä¸­è¿˜æœªæ¶ˆè´¹çš„æ¶ˆæ¯å®ä½“ã€‚</p><p>1ã€å¦‚æœåšäº†é˜Ÿåˆ—çš„æŒä¹…åŒ–ï¼Œæ¶ˆæ¯ä¸ä¼šè¢«ä¸¢å¤±ï¼Œç­‰åˆ° node1 æ¢å¤äº†ï¼Œå°±èƒ½æ¥ç€è¿›è¡Œæ¶ˆè´¹ï¼Œä½†æ˜¯åœ¨æ¢å¤ä¹‹å‰å…¶ä»–èŠ‚ç‚¹ä¸èƒ½åˆ›å»º node1 ä¸­å·²å°†åˆ›å»ºçš„é˜Ÿåˆ—ã€‚</p><p>2ã€å¦‚æœæ²¡æœ‰åšæŒä¹…åŒ–ï¼Œæ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œä½†æ˜¯ node1 ä¸­çš„é˜Ÿåˆ—ï¼Œå¯ä»¥åœ¨å…¶ä»–èŠ‚ç‚¹é‡æ–°åˆ›å»ºï¼Œä¸ç”¨ç­‰å¾… node1 çš„æ¢å¤ã€‚</p><p>æ™®é€šæ¨¡å¼ä¸æ”¯æŒæ¶ˆæ¯åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„å¤åˆ¶ï¼Œå½“ç„¶ RabbitMQ ä¸­ä¹Ÿæä¾›äº†æ”¯æŒå¤åˆ¶çš„æ¨¡å¼ï¼Œå°±æ˜¯é•œåƒæ¨¡å¼(å‚è§ä¸‹æ–‡)ã€‚</p><h5 id="é•œåƒæ¨¡å¼"><a href="#é•œåƒæ¨¡å¼" class="headerlink" title="é•œåƒæ¨¡å¼"></a>é•œåƒæ¨¡å¼<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E9%95%9C%E5%83%8F%E6%A8%A1%E5%BC%8F"></a></h5><p>é•œåƒé˜Ÿåˆ—ä¼šåœ¨èŠ‚ç‚¹ä¸­åŒæ­¥é˜Ÿåˆ—çš„æ•°æ®ï¼Œæœ€ç»ˆçš„é˜Ÿåˆ—æ•°æ®ä¼šå­˜åœ¨äºæ¯ä¸ªèŠ‚ç‚¹ä¸­ï¼Œè€Œä¸åƒæ™®é€šæ¨¡å¼ä¸­åªä¼šå­˜åœ¨äºåˆ›å»ºå®ƒçš„èŠ‚ç‚¹ä¸­ã€‚</p><p>ä¼˜ç‚¹å¾ˆæ˜æ˜¾ï¼Œå½“æœ‰ä¸»æœºå®•æœºçš„æ—¶å€™ï¼Œå› ä¸ºé˜Ÿåˆ—æ•°æ®ä¼šåŒæ­¥åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œé¿å…äº†æ™®é€šæ¨¡å¼ä¸­çš„å•ç‚¹æ•…éšœã€‚</p><p>ç¼ºç‚¹å°±æ˜¯æ€§èƒ½ä¸å¥½ï¼Œé›†ç¾¤å†…éƒ¨çš„åŒæ­¥é€šè®¯ä¼šå ç”¨å¤§é‡çš„ç½‘ç»œå¸¦å®½ï¼Œé€‚åˆä¸€äº›å¯é æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ã€‚</p><p>é’ˆå¯¹é•œåƒæ¨¡å¼ RabbitMQ ä¹Ÿæä¾›äº†å‡ ç§æ¨¡å¼ï¼Œæœ‰æ•ˆå€¼ä¸º <code>allï¼Œexactlyï¼Œnodes</code> é»˜è®¤ä¸º allã€‚</p><ul><li><p>all è¡¨ç¤ºé›†ç¾¤ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹è¿›è¡Œé•œåƒï¼›</p></li><li><p>exactly è¡¨ç¤ºæŒ‡å®šä¸ªæ•°çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œé•œåƒï¼ŒèŠ‚ç‚¹ä¸ªæ•°ç”±<code>ha-params</code>æŒ‡å®š;</p></li><li><p>nodes è¡¨ç¤ºåœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šè¿›è¡Œé•œåƒï¼ŒèŠ‚ç‚¹åç§°ç”±<code>ha-params</code>æŒ‡å®š;</p></li></ul><p>æ‰€ä»¥é’ˆå¯¹æ™®é€šé˜Ÿåˆ—å’Œé•œåƒé˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å…¶ä¸­å‡ ä¸ªé˜Ÿåˆ—ä½œä¸ºé•œåƒé˜Ÿåˆ—ï¼Œåœ¨æ€§èƒ½å’Œå¯é æ€§ä¹‹é—´æ‰¾åˆ°ä¸€ä¸ªå¹³è¡¡ã€‚</p><p>å…³äºé•œåƒæ¨¡å¼ä¸­æ¶ˆæ¯çš„å¤åˆ¶ï¼Œè¿™é‡Œä¹Ÿç”¨çš„å¾ˆå·§å¦™ï¼Œå€¼å¾—å€Ÿé‰´</p><p>1ã€master èŠ‚ç‚¹å‘ slave èŠ‚ç‚¹åŒæ­¥æ¶ˆæ¯æ˜¯é€šè¿‡ç»„æ’­ GM(Guaranteed Multicast) æ¥åŒæ­¥çš„ã€‚</p><p>2ã€æ‰€æœ‰çš„æ¶ˆæ¯ç»è¿‡ master èŠ‚ç‚¹ï¼Œmaster å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼ŒåŒæ—¶ä¹Ÿä¼šé€šè¿‡ GM å¹¿æ’­ç»™æ‰€æœ‰çš„ slaveï¼Œslaveæ”¶åˆ°æ¶ˆæ¯ä¹‹ååœ¨è¿›è¡Œæ•°æ®çš„åŒæ­¥æ“ä½œã€‚</p><p>3ã€GM å®ç°çš„æ˜¯ä¸€ç§å¯é çš„ç»„æ’­é€šä¿¡åè®®ï¼Œè¯¥åè®®èƒ½ä¿è¯ç»„æ’­æ¶ˆæ¯çš„åŸå­æ€§ã€‚å…·ä½“å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p><p>å®ƒçš„å®ç°å¤§è‡´ä¸º:å°†æ‰€æœ‰çš„èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå¾ªç¯é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šç›‘æ§ä½äºè‡ªå·±å·¦å³ä¸¤è¾¹çš„èŠ‚ç‚¹ï¼Œå½“æœ‰èŠ‚ç‚¹æ–°å¢æ—¶ï¼Œç›¸é‚»çš„èŠ‚ç‚¹ä¿è¯å½“å‰å¹¿æ’­çš„æ¶ˆæ¯ä¼šå¤åˆ¶åˆ°æ–°çš„èŠ‚ç‚¹ä¸Š å½“æœ‰èŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œç›¸é‚»çš„èŠ‚ç‚¹ä¼šæ¥ç®¡ä»¥ä¿è¯æœ¬æ¬¡å¹¿æ’­çš„æ¶ˆæ¯ä¼šå¤åˆ¶åˆ°æ‰€æœ‰çš„èŠ‚ç‚¹ã€‚</p><p>å› ä¸ºæ˜¯ä¸€ä¸ªå¾ªç¯é“¾è¡¨ï¼Œæ‰€ä»¥ master å‘å‡ºå»çš„æ¶ˆæ¯æœ€åä¹Ÿä¼šè¿”å›åˆ° master ä¸­ï¼Œmaster å¦‚æœæ”¶åˆ°äº†è‡ªå·±å‘å‡ºçš„æ“ä½œå‘½ä»¤ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç¡®å®šå‘½ä»¤å·²ç»åŒæ­¥åˆ°äº†æ‰€æœ‰çš„èŠ‚ç‚¹ã€‚</p><p><img src="https://boilingfrog.github.io//img/mq/mq-rabbitmq-cluster-mirror.png" alt="mq"></p><h4 id="federation"><a href="#federation" class="headerlink" title="federation"></a>federation<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#federation"></a></h4><p>federation æ’ä»¶çš„è®¾è®¡ç›®æ ‡æ˜¯ä½¿ RabbitMQ åœ¨ä¸åŒçš„ Broker èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ¶ˆæ¯ä¼ é€’è€Œæ— éœ€å»ºç«‹é›†ç¾¤ã€‚</p><p>çœ‹äº†å®šä¹‰è¿˜æ˜¯å¾ˆè¿·ç³Šï¼Œæ¥ä¸¾ä¸¾æ —å­å§</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª RabbitMQ çš„é›†ç¾¤ï¼Œåˆ†åˆ«éƒ¨ç½²åœ¨ä¸åŒçš„åŸå¸‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‡å®šåˆ†åˆ«æ˜¯åœ¨åŒ—äº¬ï¼Œä¸Šæµ·ï¼Œå¹¿å·ã€‚</p><p>![mq]<a href="https://boilingfrog.github.io/(/img/mq/mq-rabbitmq-federation.png)">https://boilingfrog.github.io/(/img/mq/mq-rabbitmq-federation.png)</a></p><p>å¦‚æœä¸€ä¸ªç°åœ¨æœ‰ä¸€ä¸ªä¸šåŠ¡ clientAï¼Œéƒ¨ç½²çš„æœºå™¨åœ¨åŒ—äº¬ï¼Œç„¶åè¿æ¥åˆ°åŒ—äº¬èŠ‚ç‚¹çš„ broker1 ã€‚ç„¶åç½‘ç»œè¿é€šæ€§ä¹Ÿå¾ˆå¥½ï¼Œå‘é€æ¶ˆæ¯åˆ° broker1 ä¸­çš„ exchangeA ä¸­ï¼Œæ¶ˆæ¯èƒ½å¤Ÿå¾ˆå¿«çš„å‘é€åˆ°ï¼Œå°±ç®—åœ¨å¼€å¯äº† <code>publisher confirm</code> æœºåˆ¶æˆ–è€…äº‹åŠ¡æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¿«é€Ÿç¡®è®¤ä¿¡æ¯ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p>å¦‚æœä¸€ä¸ªç°åœ¨æœ‰ä¸€ä¸ªä¸šåŠ¡ clientBï¼Œéƒ¨ç½²çš„æœºå™¨åœ¨ä¸Šæµ·ï¼Œç„¶åè¿æ¥åˆ°åŒ—äº¬èŠ‚ç‚¹çš„ broker1 ã€‚ç„¶åç½‘ç»œè¿é€šæ€§ä¸å¥½ï¼Œå‘é€æ¶ˆæ¯åˆ° broker1 ä¸­çš„ exchangeA ä¸­ï¼Œå› ä¸ºç½‘ç»œä¸å¥½ï¼Œæ‰€ä»¥æ¶ˆæ¯çš„ç¡®è®¤æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œè¿™å¯¹äºæˆ‘ä»¬æ— ç–‘ä½¿ç¾éš¾ï¼Œæ¶ˆæ¯é‡å¤§æƒ…å†µä¸‹ï¼Œå¿…ç„¶é€ æˆæ•°æ®çš„é˜»å¡ï¼Œåœ¨å¼€å¯äº† <code>publisher confirm</code> æœºåˆ¶æˆ–è€…äº‹åŠ¡æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æƒ…å†µå°†ä¼šæ›´ä¸¥é‡ã€‚</p><p>å½“ç„¶å¦‚æœæŠŠ clientB ï¼Œéƒ¨ç½²åœ¨åŒ—äº¬çš„æœºæˆ¿ä¸­ï¼Œè¿™ä¸ªé—®é¢˜å°±è§£å†³äº†ï¼Œä½†æ˜¯å¤šåœ°å®¹ç¾å°±ä¸èƒ½å®ç°äº†ã€‚</p><p>é’ˆå¯¹è¿™ç§æƒ…å†µå¦‚ä½•è§£å†³å‘¢ï¼Œè¿™æ—¶å€™ federation å°±ç™»åœºäº†ã€‚</p><p>æ¯”å¦‚ä½äºä¸Šæµ·çš„ä¸šåŠ¡ clientBï¼Œè¿æ¥åŒ—äº¬èŠ‚ç‚¹çš„ broker1ã€‚ç„¶åå‘é€æ¶ˆæ¯åˆ° broker1 ä¸­çš„ exchangeA ä¸­ã€‚è¿™æ—¶å€™æ˜¯å­˜åœ¨ç½‘ç»œè¿é€šæ€§çš„é—®é¢˜çš„ã€‚</p><ul><li><p>1ã€è®©ä¸Šæµ·çš„ä¸šåŠ¡ clientBï¼Œè¿æ¥ä¸Šæµ·çš„èŠ‚ç‚¹ broker2ï¼›</p></li><li><p>2ã€é€šè¿‡ Federation ï¼Œåœ¨åŒ—äº¬èŠ‚ç‚¹çš„ broker1 å’Œä¸Šæµ·èŠ‚ç‚¹çš„ broker2 ä¹‹é—´å»ºç«‹ä¸€æ¡å•å‘çš„ <code>Federation link</code>ï¼›</p></li><li><p>3ã€Federation æ’ä»¶ä¼šåœ¨ä¸Šæµ·èŠ‚ç‚¹çš„ broker2 ä¸­åˆ›å»ºä¸€ä¸ªåŒåçš„äº¤æ¢å™¨ exchangeA (å…·ä½“åå­—å¯é…ç½®ï¼Œé»˜è®¤åŒå), åŒæ—¶ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªå†…éƒ¨äº¤æ¢å™¨ï¼Œé€šè¿‡è·¯ç”±é”® rkA ,å°†è¿™ä¸¤ä¸ªäº¤æ¢å™¨è¿›è¡Œç»‘å®šï¼ŒåŒæ—¶ä¹Ÿä¼šåœ¨ broker2 ä¸­åˆ›å»ºä¸€ä¸ª</p><p>1ã€Federation æ’ä»¶ä¼šåœ¨ä¸Šæµ·èŠ‚ç‚¹çš„ broker2 ä¸­åˆ›å»ºä¸€ä¸ªåŒåçš„äº¤æ¢å™¨ exchangeA (å…·ä½“åå­—å¯é…ç½®ï¼Œé»˜è®¤åŒå)ï¼›</p><p>2ã€Federation æ’ä»¶ä¼šåœ¨ä¸Šæµ·èŠ‚ç‚¹çš„ broker2 ä¸­åˆ›å»ºä¸€ä¸ªå†…éƒ¨äº¤æ¢å™¨ï¼Œé€šè¿‡è·¯ç”±é”® rkA ,å°† exchangeA å’Œå†…éƒ¨äº¤æ¢å™¨è¿›è¡Œç»‘å®šï¼›</p><p>3ã€Federation æ’ä»¶ä¼šåœ¨ä¸Šæµ·èŠ‚ç‚¹çš„ broker2 ä¸­åˆ›å»ºé˜Ÿåˆ—ï¼Œå’Œå†…éƒ¨äº¤æ¢å™¨è¿›è¡Œç»‘å®šï¼ŒåŒæ—¶è¿™ä¸ªé˜Ÿåˆ—ä¼šå’ŒåŒ—äº¬èŠ‚ç‚¹çš„ broker1 ä¸­çš„ exchangeAï¼Œå»ºç«‹ä¸€æ¡ AMQP é“¾æ¥ï¼Œæ¥å®æ—¶çš„æ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯äº†ï¼›</p></li><li><p>4ã€ç»è¿‡ä¸Šé¢çš„æµç¨‹ï¼Œå°±ç›¸å½“äºåœ¨ä¸Šæµ·èŠ‚ç‚¹ broker2 ä¸­çš„ exchangeA å’ŒåŒ—äº¬èŠ‚ç‚¹ broker1 ä¸­çš„ exchangeA å»ºç«‹äº†<code>Federation link</code>ï¼›</p></li></ul><p>è¿™æ ·ä½äºä¸Šæµ·çš„ä¸šåŠ¡ clientB é“¾æ¥åˆ°ä¸Šæµ·çš„èŠ‚ç‚¹ broker2ï¼Œç„¶åå‘é€æ¶ˆæ¯åˆ°è¯¥èŠ‚ç‚¹ä¸­çš„ exchangeAï¼Œè¿™ä¸ªæ¶ˆæ¯ä¼šé€šè¿‡<code>Federation link</code>ï¼Œå‘é€åˆ°åŒ—äº¬èŠ‚ç‚¹ broker1 ä¸­çš„ exchangeAï¼Œæ‰€ä»¥å¯ä»¥å‡å°‘ç½‘ç»œè¿é€šæ€§çš„é—®é¢˜ã€‚</p><p><img src="https://boilingfrog.github.io//img/mq/mq-rabbitmq-federation-link.png" alt="mq"></p><h4 id="shovel"><a href="#shovel" class="headerlink" title="shovel"></a>shovel<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#shovel"></a></h4><p>è¿æ¥æ–¹å¼ä¸ federation çš„è¿æ¥æ–¹å¼ç±»ä¼¼ï¼Œä¸è¿‡ shovel å·¥ä½œæ›´ä½ä¸€å±‚ã€‚federation æ˜¯ä»ä¸€ä¸ªäº¤æ¢å™¨ä¸­è½¬å‘æ¶ˆæ¯åˆ°å¦ä¸€ä¸ªäº¤æ¢å™¨ä¸­ï¼Œè€Œ shovel åªæ˜¯ç®€å•çš„ä»æŸä¸ª broker ä¸­çš„é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ•°æ®ï¼Œç„¶åè½¬å‘æ¶ˆæ¯åˆ°å¦ä¸€ä¸ª broker ä¸Šçš„äº¤æ¢å™¨ä¸­ã€‚</p><p>shovel ä¸»è¦æ˜¯ï¼šä¿è¯å¯é è¿ç»­åœ°å°† message ä»æŸä¸ª broker ä¸Šçš„ queue ï¼ˆä½œä¸ºæºç«¯ï¼‰ä¸­å–å‡ºï¼Œå†å°†å…¶ publish åˆ°å¦å¤–ä¸€ä¸ª broker ä¸­çš„ç›¸åº” exchange ä¸Šï¼ˆä½œä¸ºç›®çš„ç«¯ï¼‰ã€‚</p><p>ä½œä¸ºæºçš„ queue å’Œä½œä¸ºç›®çš„çš„ exchange å¯ä»¥åŒæ—¶ä½äºä¸€ä¸ª broker ä¸Šï¼Œä¹Ÿå¯ä»¥ä½äºä¸åŒ broker ä¸Šã€‚Shovel è¡Œä¸ºå°±åƒä¼˜ç§€çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºèƒ½å¤Ÿè´Ÿè´£è¿æ¥æºå’Œç›®çš„åœ°ã€è´Ÿè´£æ¶ˆæ¯çš„è¯»å†™åŠè´Ÿè´£è¿æ¥å¤±è´¥é—®é¢˜çš„å¤„ç†ã€‚</p><p>Shovel çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºï¼š</p><p>1ã€æ¾è—•åˆï¼šShovel å¯ä»¥ç§»åŠ¨ä½äºä¸åŒç®¡ç†åŸŸä¸­çš„ Broker (æˆ–è€…é›†ç¾¤)ä¸Šçš„æ¶ˆæ¯ï¼Œè¿™äº› Broker (æˆ–è€…é›†ç¾¤ã€‰å¯ä»¥åŒ…å«ä¸åŒçš„ç”¨æˆ·å’Œ vhost ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„ RabbitMQ å’Œ Erlang ç‰ˆæœ¬ï¼›</p><p>2ã€æ”¯æŒå¹¿åŸŸç½‘ï¼šShovel æ’ä»¶åŒæ ·åŸºäº AMQP åè®® Broker ä¹‹é—´è¿›è¡Œé€šä¿¡ è¢«è®¾è®¡æˆå¯ä»¥å®¹å¿æ—¶æ–­æ—¶ç»­çš„è¿é€šæƒ…å½¢ äº•ä¸”èƒ½å¤Ÿä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼›</p><p>3ã€é«˜åº¦å®šåˆ¶ï¼šå½“ Shove æˆåŠŸè¿æ¥åï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œé…ç½®ä»¥æ‰§è¡Œç›¸å…³çš„ AMQP å‘½ä»¤ã€‚</p><p>ä½¿ç”¨ Shove è§£å†³æ¶ˆæ¯å †ç§¯</p><p>å¯¹äºæ¶ˆæ¯å †ç§¯ï¼Œå¦‚æœæ¶ˆæ¯å †ç§¯çš„æ•°é‡å·¨å¤§æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½å°†ä¸¥é‡æ”¶åˆ°å½±å“ï¼Œé€šå¸¸çš„åšæ³•æ˜¯å¢åŠ æ¶ˆè´¹è€…çš„æ•°é‡æˆ–è€…ä¼˜åŒ–æ¶ˆè´¹è€…æ¥å¤„ç†</p><p>å¦‚æœä¸€äº›æ¶ˆæ¯å †ç§¯åœºæ™¯ä¸èƒ½ç®€å•çš„å¢åŠ æ¶ˆè´¹è€…çš„æ•°é‡æ¥è§£å†³ï¼Œå°±åªèƒ½ä¼˜åŒ–æ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›äº†ï¼Œä½†æ˜¯ä¼˜åŒ–æ¯•ç«Ÿéœ€è¦æ—¶é—´ï¼Œè¿™æ—¶å€™å¯ä»¥é€šè¿‡ Shove è§£å†³</p><p>å¯ä»¥é€šè¿‡ Shove å°†é˜»å¡çš„æ¶ˆæ¯ï¼Œç§»äº¤ç»™å¦ä¸€ä¸ªå¤‡ä»½é˜Ÿåˆ—ï¼Œç­‰åˆ°æœ¬é˜Ÿåˆ—çš„æ¶ˆæ¯æ²¡æœ‰é˜»å¡äº†ï¼Œç„¶åå°†å¤‡ä»½é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯é‡æ–°â€™é“²â€™è¿‡æ¥</p><p><img src="https://boilingfrog.github.io//img/mq/mq-rabbitmq-cluster-shove.png" alt="mq"></p><h3 id="èŠ‚ç‚¹ç±»å‹"><a href="#èŠ‚ç‚¹ç±»å‹" class="headerlink" title="èŠ‚ç‚¹ç±»å‹"></a>èŠ‚ç‚¹ç±»å‹<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B"></a></h3><h4 id="RAM-node"><a href="#RAM-node" class="headerlink" title="RAM node"></a>RAM node<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#ram-node"></a></h4><p>å†…å­˜èŠ‚ç‚¹å°†æ‰€æœ‰çš„é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šã€ç”¨æˆ·ã€æƒé™å’Œ vhost çš„å…ƒæ•°æ®å®šä¹‰å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¥½å¤„æ˜¯å¯ä»¥ä½¿å¾—åƒäº¤æ¢æœºå’Œé˜Ÿåˆ—å£°æ˜ç­‰æ“ä½œæ›´åŠ çš„å¿«é€Ÿã€‚</p><h4 id="Disk-node"><a href="#Disk-node" class="headerlink" title="Disk node"></a>Disk node<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#disk-node"></a></h4><p>å…ƒæ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œå•èŠ‚ç‚¹ç³»ç»Ÿåªå…è®¸ç£ç›˜ç±»å‹çš„èŠ‚ç‚¹ï¼Œé˜²æ­¢é‡å¯RabbitMQçš„æ—¶å€™ï¼Œä¸¢å¤±ç³»ç»Ÿçš„é…ç½®ä¿¡æ¯</p><p>RabbitMQè¦æ±‚åœ¨é›†ç¾¤ä¸­è‡³å°‘æœ‰ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹ï¼Œæ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å¯ä»¥æ˜¯å†…å­˜èŠ‚ç‚¹ï¼Œå½“èŠ‚ç‚¹åŠ å…¥æˆ–è€…ç¦»å¼€é›†ç¾¤æ—¶ï¼Œå¿…é¡»è¦å°†è¯¥å˜æ›´é€šçŸ¥åˆ°è‡³å°‘ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹ã€‚</p><p>å¦‚æœé›†ç¾¤ä¸­å”¯ä¸€çš„ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹å´©æºƒçš„è¯ï¼Œé›†ç¾¤ä»ç„¶å¯ä»¥ä¿æŒè¿è¡Œï¼Œä½†æ˜¯æ— æ³•è¿›è¡Œå…¶ä»–æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ï¼Œç›´åˆ°èŠ‚ç‚¹æ¢å¤ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µå¯ä»¥è®¾ç½®ä¸¤ä¸ªç£ç›˜èŠ‚ç‚¹ã€è‡³å°‘ä¿è¯ä¸€ä¸ªæ˜¯å¯ç”¨çš„ï¼Œå°±èƒ½ä¿è¯å…ƒæ•°æ®çš„ä¿®æ”¹äº†ã€‚</p><p>çœ‹äº†å¾ˆå¤šæ–‡ç« ï¼Œæœ‰çš„åœ°æ–¹ä¼šè®¤ä¸ºæ‰€æœ‰æŒä¹…åŒ–çš„æ¶ˆæ¯éƒ½ä¼šå­˜å‚¨åˆ°ç£ç›˜èŠ‚ç‚¹ä¸­ï¼Œè¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚å¯¹äºå†…å­˜èŠ‚ç‚¹ï¼Œå¦‚æœæ¶ˆæ¯è¿›è¡Œäº†æŒä¹…åŒ–çš„æ“ä½œï¼ŒæŒä¹…åŒ–çš„æ¶ˆæ¯ä¼šå­˜å‚¨åœ¨è¯¥èŠ‚ç‚¹ä¸­çš„ç£ç›˜ä¸­ï¼Œè€Œä¸æ˜¯ç£ç›˜èŠ‚ç‚¹çš„ç£ç›˜ä¸­ã€‚</p><p>æ¥ä¸ªæ —å­ï¼š</p><p>è¿™é‡Œæ„å»ºäº†ä¸€ä¸ªæ™®é€šçš„ cluster é›†ç¾¤(è§ä¸‹æ–‡)ï¼Œé€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªå†…å­˜èŠ‚ç‚¹ï¼Œæ¨é€æ¶ˆæ¯åˆ°è¯¥èŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”æ¯æ¡æ¶ˆæ¯éƒ½é€‰æ‹©æŒä¹…åŒ–ï¼Œæ¥çœ‹ä¸‹ï¼Œè¿™ä¸ªèŠ‚ç‚¹çš„å†…å­˜å˜åŒ–</p><p>æ¥çœ‹ä¸‹æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼ŒèŠ‚ç‚¹ä¸­çš„å†…å­˜å ç”¨</p><p><img src="https://boilingfrog.github.io//img/mq/rabbitmq-cluster-data-empty.jpg" alt="mq"></p><p>è¿™é‡Œå‘<code>rabbitmqcluster1</code>æ¨é€äº† 397330 æ¡æ¶ˆæ¯ï¼Œå‘ç°ç£ç›˜å†…å­˜ä»åŸæ¥çš„ 6.1GiB å˜æˆäº† 3.9GiBï¼Œè€Œç£ç›˜èŠ‚ç‚¹çš„å†…å­˜æ²¡æœ‰å˜åŒ–</p><p><img src="https://boilingfrog.github.io//img/mq/rabbitmq-cluster-data.jpg" alt="mq"></p><p>å¯¹äºå†…å­˜èŠ‚ç‚¹ï¼Œå¦‚æœæ¶ˆæ¯è¿›è¡Œäº†æŒä¹…åŒ–çš„æ“ä½œï¼ŒæŒä¹…åŒ–çš„æ¶ˆæ¯ä¼šå­˜å‚¨åœ¨è¯¥èŠ‚ç‚¹ä¸­çš„ç£ç›˜ä¸­ï¼Œè€Œä¸æ˜¯ç£ç›˜èŠ‚ç‚¹çš„ç£ç›˜ä¸­ã€‚</p><h3 id="é›†ç¾¤çš„æ­å»º"><a href="#é›†ç¾¤çš„æ­å»º" class="headerlink" title="é›†ç¾¤çš„æ­å»º"></a>é›†ç¾¤çš„æ­å»º<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E9%9B%86%E7%BE%A4%E7%9A%84%E6%90%AD%E5%BB%BA"></a></h3><p>è¿™æ˜¯æ­å»ºä¸€ä¸ªæ™®é€šçš„ cluster æ¨¡å¼,ä½¿ç”¨ vagrant æ„å»ºä¸‰å° centos7 è™šæ‹Ÿæœºï¼Œ<a href="https://www.cnblogs.com/ricklz/p/14724934.html">vagrantæ„å»ºcentosè™šæ‹Ÿç¯å¢ƒ</a></p><h4 id="1ã€å±€åŸŸç½‘é…ç½®"><a href="#1ã€å±€åŸŸç½‘é…ç½®" class="headerlink" title="1ã€å±€åŸŸç½‘é…ç½®"></a>1ã€å±€åŸŸç½‘é…ç½®<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#1%E5%B1%80%E5%9F%9F%E7%BD%91%E9%85%8D%E7%BD%AE"></a></h4><p>é¦–å…ˆé…ç½® hostname</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">$ <span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> <span class="hljs-string">rabbitmqcluster1</span> <span class="hljs-built_in">--static</span><br></code></pre></td></tr></table></figure><p>é‡å¯å³å¯æŸ¥çœ‹æœ€æ–°çš„ hostname</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">$ hostnamectl</span><br><span class="hljs-attribute">   Static hostname</span><span class="hljs-punctuation">:</span> <span class="hljs-string">rabbitmqcluster1</span><br>         <span class="hljs-attribute">Icon name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">computer-vm</span><br>           <span class="hljs-attribute">Chassis</span><span class="hljs-punctuation">:</span> <span class="hljs-string">vm</span><br>        <span class="hljs-attribute">Machine ID</span><span class="hljs-punctuation">:</span> <span class="hljs-string">e147b422673549a3b4fda77127bd4bcd</span><br>           <span class="hljs-attribute">Boot ID</span><span class="hljs-punctuation">:</span> <span class="hljs-string">aa195e0427d74d079ea39f344719f59b</span><br>    <span class="hljs-attribute">Virtualization</span><span class="hljs-punctuation">:</span> <span class="hljs-string">oracle</span><br>  <span class="hljs-attribute">Operating System</span><span class="hljs-punctuation">:</span> <span class="hljs-string">CentOS Linux 7 (Core)</span><br>       <span class="hljs-attribute">CPE OS Name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">cpe:/o:centos:centos:7</span><br>            <span class="hljs-attribute">Kernel</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Linux 3.10.0-327.4.5.el7.x86_64</span><br>      <span class="hljs-attribute">Architecture</span><span class="hljs-punctuation">:</span> <span class="hljs-string">x86-64</span><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨ä¸‰ä¸ªèŠ‚ç‚¹çš„<code>/etc/hosts</code>ä¸‹è®¾ç½®ç›¸åŒçš„é…ç½®ä¿¡æ¯</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">192.168.56.111</span> rabbitmqcluster1<br><span class="hljs-number">192.168.56.112</span> rabbitmqcluster2<br><span class="hljs-number">192.168.56.113</span> rabbitmqcluster3<br></code></pre></td></tr></table></figure><h4 id="2ã€æ¯å°åŠå…¶ä¸­å®‰è£…-RabbitMQ"><a href="#2ã€æ¯å°åŠå…¶ä¸­å®‰è£…-RabbitMQ" class="headerlink" title="2ã€æ¯å°åŠå…¶ä¸­å®‰è£… RabbitMQ"></a>2ã€æ¯å°åŠå…¶ä¸­å®‰è£… RabbitMQ<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#2%E6%AF%8F%E5%8F%B0%E5%8F%8A%E5%85%B6%E4%B8%AD%E5%AE%89%E8%A3%85-rabbitmq"></a></h4><p>å…·ä½“çš„å®‰è£…è¿‡ç¨‹å¯å‚è§<a href="https://blog.csdn.net/weixin_40584261/article/details/106826044">Centos7å®‰è£…RabbitMQæœ€æ–°ç‰ˆ3.8.5ï¼Œå²ä¸Šæœ€ç®€å•å®ç”¨å®‰è£…æ­¥éª¤</a></p><h4 id="3ã€è®¾ç½®ä¸åŒèŠ‚ç‚¹é—´åŒä¸€è®¤è¯çš„Erlang-Cookie"><a href="#3ã€è®¾ç½®ä¸åŒèŠ‚ç‚¹é—´åŒä¸€è®¤è¯çš„Erlang-Cookie" class="headerlink" title="3ã€è®¾ç½®ä¸åŒèŠ‚ç‚¹é—´åŒä¸€è®¤è¯çš„Erlang Cookie"></a>3ã€è®¾ç½®ä¸åŒèŠ‚ç‚¹é—´åŒä¸€è®¤è¯çš„Erlang Cookie<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#3%E8%AE%BE%E7%BD%AE%E4%B8%8D%E5%90%8C%E8%8A%82%E7%82%B9%E9%97%B4%E5%90%8C%E4%B8%80%E8%AE%A4%E8%AF%81%E7%9A%84erlang-cookie"></a></h4><p>æ¯å°æœºå™¨ä¸­å®‰è£… RabbitMQ ,éƒ½ä¼šç”Ÿæˆå•ç‹¬çš„<code>Erlang Cookie</code>ã€‚<code>Erlang Cookie</code>æ˜¯ä¿è¯ä¸åŒèŠ‚ç‚¹å¯ä»¥ç›¸äº’é€šä¿¡çš„å¯†é’¥ï¼Œè¦ä¿è¯é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ç›¸äº’é€šä¿¡å¿…é¡»å…±äº«ç›¸åŒçš„<code>Erlang Cookie</code>ã€‚å…·ä½“çš„ç›®å½•å­˜æ”¾åœ¨<code>/var/lib/rabbitmq/.erlang.cookie</code>ã€‚</p><p>æ‰€ä»¥è¿™é‡ŒæŠŠ <code>rabbitmqcluster1</code> ä¸­çš„<code>Erlang Cookie</code>ï¼Œå¤åˆ¶åˆ°å…¶ä»–æœºå™¨ä¸­ï¼Œè¦†ç›–åŸæ¥çš„<code>Erlang Cookie</code>ã€‚</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>scp /var/lib/rabbitmq/.erlang.cookie <span class="hljs-number">192.168</span>.<span class="hljs-number">56.112</span><span class="hljs-symbol">:/var/lib/rabbitmq</span><br><span class="hljs-variable">$ </span>scp /var/lib/rabbitmq/.erlang.cookie <span class="hljs-number">192.168</span>.<span class="hljs-number">56.113</span><span class="hljs-symbol">:/var/lib/rabbitmq</span><br></code></pre></td></tr></table></figure><p>å¤åˆ¶<code>Erlang Cookie</code>ä¹‹åé‡å¯ rabbitmq</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ systemctl <span class="hljs-keyword">restart</span> rabbitmq-<span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure><h4 id="4ã€ä½¿ç”¨-detachedè¿è¡Œå„èŠ‚ç‚¹"><a href="#4ã€ä½¿ç”¨-detachedè¿è¡Œå„èŠ‚ç‚¹" class="headerlink" title="4ã€ä½¿ç”¨ -detachedè¿è¡Œå„èŠ‚ç‚¹"></a>4ã€ä½¿ç”¨ -detachedè¿è¡Œå„èŠ‚ç‚¹<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#4%E4%BD%BF%E7%94%A8--detached%E8%BF%90%E8%A1%8C%E5%90%84%E8%8A%82%E7%82%B9"></a></h4><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vbscript">rabbitmqctl <span class="hljs-keyword">stop</span><br>rabbitmq-<span class="hljs-built_in">server</span> -detached <br></code></pre></td></tr></table></figure><h4 id="5ã€å°†èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­"><a href="#5ã€å°†èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­" class="headerlink" title="5ã€å°†èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­"></a>5ã€å°†èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#5%E5%B0%86%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E5%88%B0%E9%9B%86%E7%BE%A4%E4%B8%AD"></a></h4><p>åœ¨ <code>rabbitmqcluster2</code> å’Œ <code>rabbitmqcluster3</code> ä¸­æ‰§è¡Œ</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$ </span>rabbitmqctl stop_app<br><span class="hljs-variable">$ </span>rabbitmqctl join_cluster rabbit<span class="hljs-variable">@rabbitmqcluster1</span><br><span class="hljs-variable">$ </span>rabbitmqctl start_app<br></code></pre></td></tr></table></figure><p>é»˜è®¤ rabbitmq å¯åŠ¨åæ˜¯ç£ç›˜èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°é›†ç¾¤å¯åŠ¨ä¹‹åï¼ŒèŠ‚ç‚¹ç±»å‹éƒ½æ˜¯ç£ç›˜ç±»å‹</p><p><img src="https://boilingfrog.github.io//img/mq/rabbitmq-cluster-disc.jpg" alt="mq"></p><p>ä¸€èˆ¬æ·»åŠ 1åˆ°2ä¸ªç£ç›˜èŠ‚ç‚¹ï¼Œåˆ«çš„èŠ‚ç‚¹èŠ‚ç‚¹ä¸ºå†…å­˜èŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬å°† <code>rabbitmqcluster3</code> è®¾ç½®æˆç£ç›˜èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹è®¾ç½®æˆå†…å­˜èŠ‚ç‚¹</p><p>ä¿®æ”¹ <code>rabbitmqcluster1</code> å’Œ <code>rabbitmqcluster2</code> èŠ‚ç‚¹ç±»å‹ä¸ºå†…å­˜èŠ‚ç‚¹</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$ </span>rabbitmqctl stop_app<br><span class="hljs-variable">$ </span>rabbitmqctl change_cluster_node_type ram<br><span class="hljs-variable">$ </span>rabbitmqctl start_app<br></code></pre></td></tr></table></figure><p><img src="https://boilingfrog.github.io//img/mq/rabbitmq-cluster-ram.jpg" alt="mq"></p><h4 id="6ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"><a href="#6ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€" class="headerlink" title="6ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"></a>6ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#6%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81"></a></h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$ </span>rabbitmqctl cluster_status<br></code></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ<a href="https://boilingfrog.github.io/2022/01/07/rabbitmq%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F/#%E5%8F%82%E8%80%83"></a></h3><p>ã€RabbitMQåˆ†å¸ƒå¼é›†ç¾¤æ¶æ„å’Œé«˜å¯ç”¨æ€§ï¼ˆHAï¼‰ã€‘<a href="http://chyufly.github.io/blog/2016/04/10/rabbitmq-cluster/">http://chyufly.github.io/blog/2016/04/10/rabbitmq-cluster/</a><br>ã€RabbitMQåˆ†å¸ƒå¼éƒ¨ç½²æ–¹æ¡ˆç®€ä»‹ã€‘<a href="https://www.jianshu.com/p/c7a1a63b745d">https://www.jianshu.com/p/c7a1a63b745d</a><br>ã€RabbitMQå®æˆ˜æŒ‡å—ã€‘<a href="https://book.douban.com/subject/27591386/">https://book.douban.com/subject/27591386/</a><br>ã€RabbitMQä¸¤ç§é›†ç¾¤æ¨¡å¼é…ç½®ç®¡ç†ã€‘<a href="https://blog.csdn.net/fgf00/article/details/79558498">https://blog.csdn.net/fgf00/article/details/79558498</a></p><hr>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Rabbitmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linux æŸ¥çœ‹ä¸»æœºæ˜¯å¦é‡å¯</title>
    <link href="/article/3eb81ee9.html"/>
    <url>/article/3eb81ee9.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />## äº†è§£ Linux é‡å¯æ—¥å¿—<p>&#x2F;var&#x2F;log ç›®å½•éšè—ç€ Linux æ—¥å¿—æœºåˆ¶çš„æ ¸å¿ƒä¿¡æ¯ï¼Œå®ƒæ˜¯è®°å½•ç³»ç»Ÿæ´»åŠ¨çš„å®è´µä»“åº“ã€‚ç„¶è€Œï¼Œä»…ä»…æœ‰æ—¥å¿—è¿˜ä¸å¤Ÿï¼ŒçœŸæ­£çš„éš¾é¢˜åœ¨äºï¼Œå¦‚ä½•ä»å¤§é‡æ•°æ®ä¸­æç‚¼å‡ºä¸ç³»ç»Ÿé‡å¯ç›¸å…³çš„å…³é”®ä¿¡æ¯ã€‚</p><p>åœ¨ &#x2F;var&#x2F;log ç›®å½•ä¸­ï¼Œå¯åˆ«é”™è¿‡é‚£å‡ ä¸ªè‡³å…³é‡è¦çš„å®¶ä¼™ï¼Œå¦‚ï¼šwtmp å’Œ btmpã€‚å®ƒä»¬ä¸ä»…æ˜¯äº›æ™®é€šçš„æ—¥å¿—ï¼Œæ›´æ˜¯äº†è§£ Linux ç³»ç»Ÿè¡Œä¸ºçš„é€”å¾„ã€‚å®ƒä»¬ç²¾ç»†åœ°è®°å½•ç€ Linux é‡å¯æ—¥å¿—ï¼Œå¹¶åŒæ—¶ä¼šæ•è·è¯¦ç»†çš„ç”¨æˆ·ç™»å½•ä¼šè¯ã€‚é€è¿‡è¿™äº›æ–‡ä»¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ·±å…¥æ¢ç©¶ç³»ç»Ÿçš„æ´»åŠ¨ï¼Œå®¡è§† Linux çš„é‡å¯å†å²ï¼Œä»¥ç¡®ä¿åœ¨å†³ç­–å’Œç³»ç»Ÿç›‘ç®¡æ—¶èƒ½åšåˆ°å¿ƒä¸­æœ‰æ•°ã€‚</p><h3 id="æ–¹æ³•-1ï¼šä½¿ç”¨-last-å‘½ä»¤æŸ¥çœ‹-Linux-é‡å¯è®°å½•"><a href="#æ–¹æ³•-1ï¼šä½¿ç”¨-last-å‘½ä»¤æŸ¥çœ‹-Linux-é‡å¯è®°å½•" class="headerlink" title="æ–¹æ³• 1ï¼šä½¿ç”¨ last å‘½ä»¤æŸ¥çœ‹ Linux é‡å¯è®°å½•"></a>æ–¹æ³• 1ï¼šä½¿ç”¨ last å‘½ä»¤æŸ¥çœ‹ Linux é‡å¯è®°å½•</h3><p>last å‘½ä»¤æ˜¯åœ¨ Linux ä¸­è·å–é‡å¯å†å²è®°å½•çš„ç‘å£«å†›åˆ€ï¼Œå®ƒèƒ½å¤Ÿè¯»å– &#x2F;var&#x2F;log&#x2F;wtmp æ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤ºæœ€åç™»å½•ç”¨æˆ·å’Œé‡å¯è®°å½•åˆ—è¡¨ã€‚</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">last</span> reboot<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/eee6a39e9866e3a36a37872721d3e723.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¯¥å‘½ä»¤æ˜¾ç¤ºäº†é‡å¯çš„æ—¶é—´é¡ºåºåˆ—è¡¨ï¼Œèƒ½å¤Ÿé€šè¿‡æ—¶é—´æˆ³åˆ†æå‡ºç³»ç»Ÿçš„æŒç»­è¿è¡Œæ—¶é—´ã€‚</p><p>å°½ç®¡åŸºç¡€çš„ last å‘½ä»¤æä¾›äº†ç³»ç»Ÿé‡å¯ä¿¡æ¯çš„å…¨é¢æ¦‚è§ˆï¼Œä½†æœ‰æ—¶æˆ‘ä»¬å¯èƒ½éœ€è¦æ›´åŠ è¯¦ç»†æˆ–ä»¥ä¸åŒæ ¼å¼å‘ˆç°çš„è¾“å‡ºï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ°è‡ªå®šä¹‰é€‰é¡¹äº†ã€‚åªæŸ¥çœ‹ç‰¹å®šæ•°é‡çš„æœ€è¿‘æ¡ç›®æ—¶ï¼Œä½¿ç”¨ <code>-n</code> é€‰é¡¹å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æŒ‡å®šè¾“å‡ºè¡Œæ•°ï¼Œè®©è¾“å‡ºä¼šå˜å¾—æ›´åŠ ç²¾ç®€å’Œä¸“æ³¨ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/bed0b9cba06803809e4d28889f1f67e5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯¹äºéœ€è¦è¯¦ç»†æ—¶é—´æˆ³çš„ç”¨æˆ·æ¥è¯´ï¼Œé€šè¿‡ <code>-F</code> é€‰é¡¹å¯ä»¥æ˜¾ç¤ºå®Œæ•´çš„æ—¥æœŸå’Œæ—¶é—´æ¥å¢å¼ºè¾“å‡ºï¼Œä»¥æä¾›æ¯æ¬¡é‡å¯å®ä¾‹çš„æ›´å…¨é¢è§†è§’ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">last</span> reboot -F<br></code></pre></td></tr></table></figure><p>é€šè¿‡æ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼Œå¯ä»¥è·å¾—ä¸€ä¸ªå¸¦æœ‰å®Œæ•´æ—¥æœŸå’Œæ—¶é—´æ ¼å¼çš„è¾“å‡ºï¼Œä»¥å‡†ç¡®åœ°è¾¨åˆ«æ¯æ¬¡ç³»ç»Ÿé‡å¯çš„å‡†ç¡®æ—¶åˆ»ã€‚</p><h2 id="æ–¹æ³•-2ï¼šä½¿ç”¨-uptime-å‘½ä»¤æŸ¥çœ‹-Linux-è¿è¡Œæ—¶é—´"><a href="#æ–¹æ³•-2ï¼šä½¿ç”¨-uptime-å‘½ä»¤æŸ¥çœ‹-Linux-è¿è¡Œæ—¶é—´" class="headerlink" title="æ–¹æ³• 2ï¼šä½¿ç”¨ uptime å‘½ä»¤æŸ¥çœ‹ Linux è¿è¡Œæ—¶é—´"></a>æ–¹æ³• 2ï¼šä½¿ç”¨ uptime å‘½ä»¤æŸ¥çœ‹ Linux è¿è¡Œæ—¶é—´</h2><p>è™½ç„¶ uptime å‘½ä»¤ç®€æ´æ˜äº†ï¼Œä½†ä¹Ÿèƒ½å¤Ÿæä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚å®ƒèƒ½å¤Ÿè¾“å‡ºè‡ªä¸Šæ¬¡é‡å¯ä»¥æ¥ Linux çš„æŒç»­è¿è¡Œæ—¶é—´ï¼Œä¸ºç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½è¯„ä¼°æä¾›äº†æ•°æ®ä¾æ®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">uptime</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/ed2c260fc3609d2aec5f097c69bbd012.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç³»ç»Ÿè‡ªä¸Šæ¬¡é‡å¯ä»¥æ¥å·²è¿ç»­è¿è¡Œäº† 7 å¤© 19 å°æ—¶ 24 åˆ†é’Ÿã€‚</p><h2 id="æ–¹æ³•-3ï¼šä½¿ç”¨-journalctl-å‘½ä»¤æŸ¥çœ‹-Linux-é‡å¯å†å²è®°å½•"><a href="#æ–¹æ³•-3ï¼šä½¿ç”¨-journalctl-å‘½ä»¤æŸ¥çœ‹-Linux-é‡å¯å†å²è®°å½•" class="headerlink" title="æ–¹æ³• 3ï¼šä½¿ç”¨ journalctl å‘½ä»¤æŸ¥çœ‹ Linux é‡å¯å†å²è®°å½•"></a>æ–¹æ³• 3ï¼šä½¿ç”¨ journalctl å‘½ä»¤æŸ¥çœ‹ Linux é‡å¯å†å²è®°å½•</h2><p>å¯¹äºä½¿ç”¨ systemd æœåŠ¡çš„ Linux å‘è¡Œç‰ˆæ¥è¯´ï¼Œjournalctl å‘½ä»¤æä¾›äº†è¯¦ç»†ä¸”ç»è¿‡ç­›é€‰çš„æ—¥å¿—è§†å›¾ï¼Œæ˜¯è·å– Linux é‡å¯å†å²è®°å½•çš„å¾—åŠ›å·¥å…·ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">sudo journalctl <span class="hljs-comment">--list-boots</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/d8d8718dcd06e7f24f05dc80d8866d93.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="æ–¹æ³•-4ï¼šä½¿ç”¨-who-b-å‘½ä»¤æŸ¥çœ‹-Linux-æœ€åå¯åŠ¨æ—¶é—´"><a href="#æ–¹æ³•-4ï¼šä½¿ç”¨-who-b-å‘½ä»¤æŸ¥çœ‹-Linux-æœ€åå¯åŠ¨æ—¶é—´" class="headerlink" title="æ–¹æ³• 4ï¼šä½¿ç”¨ who -b å‘½ä»¤æŸ¥çœ‹ Linux æœ€åå¯åŠ¨æ—¶é—´"></a>æ–¹æ³• 4ï¼šä½¿ç”¨ who -b å‘½ä»¤æŸ¥çœ‹ Linux æœ€åå¯åŠ¨æ—¶é—´</h2><p>å¦ä¸€ç§å¿«é€ŸæŸ¥çœ‹ Linux ç³»ç»Ÿï¼ˆæœ€åï¼‰é‡å¯æ—¶é—´çš„æ–¹æ³•æ˜¯ä½¿ç”¨å¸¦æœ‰ -b é€‰é¡¹çš„ who å‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">who</span> -b<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/5c5295dc191fdd45dbb5c49651d3239d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¸Šè¿°å‘½ä»¤å¯ä»¥è¾“å‡º Linux ç³»ç»Ÿçš„æœ€åå¯åŠ¨æˆ–é‡å¯æ—¶é—´ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>å®¹å™¨å¼‚å¸¸é€€å‡º</title>
    <link href="/article/cebefee3.html"/>
    <url>/article/cebefee3.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /># The node was low on resource: ephemeral-storage. Container kube-proxy was using 12Ki, which exceeds<p>å¯åŠ¨kubernetesæ—¶å€™ï¼Œå‘ç°kube-proxyæ— æ³•å¯åŠ¨ï¼ŒçŠ¶æ€æ˜¯Evictedã€‚æŸ¥çœ‹è¯¦æƒ…æ˜¯ï¼š</p><p>The node was low on resource: ephemeral-storage. Container kube-proxy was using 12Ki, which exceeds its request of 0ã€‚</p><p>ç”¨df -hæŸ¥çœ‹ç£ç›˜çš„ä½¿ç”¨ç©ºé—´ï¼Œå‘ç°æ ¹ç›®å½•å ç”¨85%ï¼Œåˆ é™¤äº†ä¸€äº›åï¼Œå‘ç°å¯ä»¥æ­£å¸¸å¯åŠ¨äº†ã€‚</p><p>åŸå› å¯èƒ½æ˜¯æ ¹ç›®å½•çš„ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œåˆ é™¤éƒ¨åˆ†ç©ºé—´å³å¯ã€‚</p><h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><blockquote><p>ç£ç›˜ä½¿ç”¨ç©ºé—´é«˜äº85%åï¼Œé›†ç¾¤ä¼šåœ¨è¯¥èŠ‚ç‚¹æ‰“ä¸Šæ±¡ç‚¹<code>node.kubernetes.io/disk-pressure:NoSchedule</code>,å¹¶è§¦å‘k8sèŠ‚ç‚¹é©±é€podç­–ç•¥ï¼Œpodè¢«é©±é€åï¼Œå½“å‰èŠ‚ç‚¹podå¤„äºåœæ­¢çŠ¶æ€ï¼ŒåŒæ—¶imageå¤„äºæœªä½¿ç”¨çŠ¶æ€ï¼Œå› æ­¤åˆ é™¤imageï¼Œå¯¼è‡´imageè¢«åˆ é™¤ã€‚å‚è€ƒå¦‚ä¸‹</p></blockquote><ul><li>é©±é€Nodeçº§åˆ«èµ„æº<ul><li>é…ç½®äº† imagefs é˜ˆå€¼æ—¶<ul><li>è¾¾åˆ° nodefs é˜ˆå€¼ï¼šåˆ é™¤å·²åœæ­¢çš„ Pod</li><li>è¾¾åˆ° imagefs é˜ˆå€¼ï¼šåˆ é™¤æœªä½¿ç”¨çš„é•œåƒ</li></ul></li><li>æœªé…ç½® imagefs é˜ˆå€¼æ—¶<ul><li>è¾¾åˆ° nodefsé˜ˆå€¼æ—¶ï¼ŒæŒ‰ç…§åˆ é™¤å·²åœæ­¢çš„ Pod å’Œåˆ é™¤æœªä½¿ç”¨é•œåƒçš„é¡ºåºæ¸…ç†èµ„æº</li></ul></li></ul></li><li>é©±é€ç”¨æˆ· Pod<ul><li>é©±é€é¡ºåºä¸ºï¼šBestEffortã€Burstableã€Guaranteed</li><li>é…ç½®äº† imagefs é˜ˆå€¼æ—¶<ul><li>è¾¾åˆ° nodefs é˜ˆå€¼ï¼ŒåŸºäº nodefs ç”¨é‡é©±é€ï¼ˆlocal volume + logsï¼‰</li><li>è¾¾åˆ° imagefs é˜ˆå€¼ï¼ŒåŸºäº imagefs ç”¨é‡é©±é€ï¼ˆå®¹å™¨å¯å†™å±‚ï¼‰</li></ul></li><li>æœªé…ç½® imagefs é˜ˆå€¼æ—¶<ul><li>è¾¾åˆ° nodefsé˜ˆå€¼æ—¶ï¼ŒæŒ‰ç…§æ€»ç£ç›˜ä½¿ç”¨é©±é€ï¼ˆlocal volume + logs + å®¹å™¨å¯å†™å±‚ï¼‰</li></ul></li></ul></li></ul><hr><ul><li><code>image-gc-high-threshold</code>ï¼šç£ç›˜ä½¿ç”¨ç‡ä¸Šé™ï¼Œæœ‰æ•ˆèŒƒå›´[0-100],é»˜è®¤<code>85</code></li><li><code>image-gc-low-threshold</code>ï¼šç£ç›˜ä½¿ç”¨ç‡ä¸‹é™ï¼Œæœ‰æ•ˆèŒƒå›´[0-100],é»˜è®¤<code>80</code></li><li><code>minimum-image-ttl-duration</code>ï¼šé•œåƒæœ€çŸ­åº”è¯¥ç”Ÿå­˜çš„å¹´é¾„ï¼Œé»˜è®¤ä¸º<code>2</code>åˆ†é’Ÿ</li></ul>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>spring Cloud gateway restè°ƒç”¨æŠ¥é”™</title>
    <link href="/article/ee343eb6.html"/>
    <url>/article/ee343eb6.html</url>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨spring cloud gatewayä¸­è¿›è¡Œä¸€äº›è¿œç¨‹æ¥å£çš„è°ƒç”¨ï¼Œæ¯”å¦‚ç½‘å…³çš„<a href="https://so.csdn.net/so/search?q=%E9%89%B4%E6%9D%83&spm=1001.2101.3001.7020">é‰´æƒ</a>ï¼Œéœ€è¦è°ƒç”¨rpcæ¥å£æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœç›´æ¥è°ƒç”¨feignæ¥å£ï¼Œä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.IllegalStateException</span>: <span class="hljs-built_in">block</span>()/<span class="hljs-built_in">blockFirst</span>()/<span class="hljs-built_in">blockLast</span>() are blocking, which is not supported <span class="hljs-keyword">in</span> thread reactor-http-nio-<span class="hljs-number">3</span>at reactor<span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.publisher</span><span class="hljs-selector-class">.BlockingSingleSubscriber</span><span class="hljs-selector-class">.blockingGet</span>(BlockingSingleSubscriber<span class="hljs-selector-class">.java</span>:<span class="hljs-number">83</span>)Suppressed: reactor<span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.publisher</span>.FluxOnAssembly<span class="hljs-variable">$OnAssemblyException</span>: <br></code></pre></td></tr></table></figure><h2 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h2><p>è¿™æ˜¯å› ä¸ºæ–°ç‰ˆçš„ gateway é‡‡ç”¨çš„æ˜¯éé˜»å¡å¼ç¼–ç¨‹ï¼Œä½†æ˜¯åœ¨è·å–æ³¨å†Œä¸­å¿ƒå®ä¾‹æ—¶ï¼Œè°ƒç”¨äº†block()æ–¹æ³•é˜»å¡å¼è·å–å®ä¾‹ï¼Œåªè¦ä½ æ•¢Â blockï¼Œå°±ä¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">throw <span class="hljs-keyword">new</span> <span class="hljs-constructor">IllegalStateException(<span class="hljs-string">&quot;block()/blockFirst()/blockLast() are blocking, which is not supported in thread &quot;</span> + Thread.<span class="hljs-params">currentThread</span>()</span>.get<span class="hljs-constructor">Name()</span>);<br></code></pre></td></tr></table></figure><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">public &lt;T&gt; ServiceInstance choose(<span class="hljs-built_in">String</span> serviceId, Request&lt;T&gt; request) &#123;        ReactiveLoadBalancer&lt;ServiceInstance&gt; loadBalancer = this.loadBalancerClientFactory.getInstance(serviceId);        <span class="hljs-keyword">if</span> (loadBalancer == <span class="hljs-literal">null</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            Response&lt;ServiceInstance&gt; loadBalancerResponse = (Response)Mono.<span class="hljs-keyword">from</span>(loadBalancer.choose(request)).block();            <span class="hljs-keyword">return</span> loadBalancerResponse == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : (ServiceInstance)loadBalancerResponse.getServer();        &#125;    &#125; final T blockingGet() &#123;<span class="hljs-keyword">if</span> (Schedulers.isInNonBlockingThread()) &#123;<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;block()/blockFirst()/blockLast() are blocking, which is not supported in thread &quot;</span> + Thread.currentThread().getName());&#125;<span class="hljs-keyword">if</span> (getCount() != <span class="hljs-number">0</span>) &#123;<span class="hljs-keyword">try</span> &#123;<span class="hljs-keyword">await</span>();&#125;<span class="hljs-keyword">catch</span> (InterruptedException ex) &#123;dispose();<span class="hljs-keyword">throw</span> Exceptions.propagate(ex);&#125;&#125; Throwable e = error;<span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;RuntimeException re = Exceptions.propagate(e);//this <span class="hljs-keyword">is</span> ok, <span class="hljs-keyword">as</span> re <span class="hljs-keyword">is</span> always a <span class="hljs-keyword">new</span> non-singleton instancere.addSuppressed(<span class="hljs-keyword">new</span> Exception(<span class="hljs-string">&quot;#block terminated with an error&quot;</span>));<span class="hljs-keyword">throw</span> re;&#125;<span class="hljs-keyword">return</span> value;&#125;<br></code></pre></td></tr></table></figure><h2 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h2><p>é—®é¢˜æ‰¾åˆ°äº†ï¼Œè§£å†³èµ·æ¥å°±ç®€å•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦é‡å†™è·å–å®ä¾‹çš„æ–¹æ³•å°±å¥½äº†ï¼Œä¸Šä»£ç </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript">    @&lt;!-- toc --&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;referrer&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;no-referrer&quot;</span> /&gt;</span></span><br><span class="hljs-title class_">Bean</span> <span class="hljs-keyword">public</span> <span class="hljs-title class_">BlockingLoadBalancerClient</span> <span class="hljs-title function_">blockingLoadBalancerClient</span>(<span class="hljs-params">ReactiveLoadBalancer.Factory &lt; ServiceInstance &gt; loadBalancerClientFactory, DiscoveryClient discoveryClient</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlockingLoadBalancerClient</span>(loadBalancerClientFactory) &#123;@<br>          <span class="hljs-title class_">Override</span> <span class="hljs-keyword">public</span> &lt; T &gt; <span class="hljs-title class_">ServiceInstance</span> <span class="hljs-title function_">choose</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> serviceId, Request &lt; T &gt; request</span>) &#123;<br>              <span class="hljs-title class_">List</span> &lt; <span class="hljs-title class_">ServiceInstance</span> &gt; instanceList = discoveryClient.<span class="hljs-title function_">getInstances</span>(serviceId);<br>              <span class="hljs-keyword">return</span> <span class="hljs-title function_">loadBalancerInstance</span>(instanceList);<br>          &#125;<br>      &#125;;<br>  &#125;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">ServiceInstance</span> <span class="hljs-title function_">loadBalancerInstance</span>(<span class="hljs-params">List &lt; ServiceInstance &gt; instanceList</span>) &#123;<br>          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">CollUtil</span>.<span class="hljs-title function_">isEmpty</span>(instanceList)) &#123;<br>              <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>          &#125;<br>          <span class="hljs-keyword">if</span> (instanceList.<span class="hljs-title function_">size</span>() == <span class="hljs-number">1</span>) &#123;<br>              <span class="hljs-keyword">return</span> instanceList.<span class="hljs-title function_">get</span>(<span class="hljs-number">0</span>);<br>          &#125; <span class="hljs-comment">// éšæœºè´Ÿè½½        int index = RandomUtil.randomInt(0, instanceList.size());        return instanceList.get(index);    &#125;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„è´Ÿè½½å‡è¡¡æ˜¯éšæœºè´Ÿè½½çš„ï¼Œå„ä½å¯ä»¥æ ¹æ®è‡ªå·±çš„æœºå™¨æ•°é‡ï¼Œè®¾ç½®ä¸åŒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆæˆ‘è¿™ç”Ÿäº§å…¶å®åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè´Ÿè½½ä¸è´Ÿè½½æ— æ‰€è°“ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringCloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DrissionPageå­¦ä¹ </title>
    <link href="/article/c8098d99.html"/>
    <url>/article/c8098d99.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /># DrissionPageå­¦ä¹ <p>å®˜ç½‘ï¼š<a href="http://drissionpage.cn/features/intimate/">http://drissionpage.cn/features/intimate/</a></p><p><a href="https://blog.csdn.net/weixin_43936332/article/details/135977426">è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼šDrissionPage</a></p><h2 id="1-DrissionPageäº‹ä»¶"><a href="#1-DrissionPageäº‹ä»¶" class="headerlink" title="1.DrissionPageäº‹ä»¶"></a>1.DrissionPageäº‹ä»¶</h2><h3 id="1-1å…ƒç´ å®šä½æŸ¥æ‰¾"><a href="#1-1å…ƒç´ å®šä½æŸ¥æ‰¾" class="headerlink" title="1.1å…ƒç´ å®šä½æŸ¥æ‰¾"></a>1.1å…ƒç´ å®šä½æŸ¥æ‰¾</h3><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs clean"># æ ¹æ®å±æ€§æŸ¥æ‰¾ï¼Œ@ åé¢å¯è·Ÿä»»æ„å±æ€§<br>page.ele(<span class="hljs-string">&#x27;@id:ele_id&#x27;</span>, timeout=<span class="hljs-number">2</span>)  # æŸ¥æ‰¾ id ä¸º ele_id çš„å…ƒç´ ï¼Œè®¾ç½®ç­‰å¾…æ—¶é—´<span class="hljs-number">2</span>ç§’  <br>page.eles(<span class="hljs-string">&#x27;@class&#x27;</span>)  # æŸ¥æ‰¾æ‰€æœ‰æ‹¥æœ‰ <span class="hljs-keyword">class</span> å±æ€§çš„å…ƒç´ <br>page.eles(<span class="hljs-string">&#x27;@class:class_name&#x27;</span>)  # æŸ¥æ‰¾æ‰€æœ‰ <span class="hljs-keyword">class</span> å«æœ‰ ele_class çš„å…ƒç´  <br>page.eles(<span class="hljs-string">&#x27;@class=class_name&#x27;</span>)  # æŸ¥æ‰¾æ‰€æœ‰ <span class="hljs-keyword">class</span> ç­‰äº ele_class çš„å…ƒç´  <br> <br># æ ¹æ® <span class="hljs-keyword">class</span> æˆ– id æŸ¥æ‰¾<br>page.ele(<span class="hljs-string">&#x27;#ele_id&#x27;</span>)  # ç­‰ä»·äº page.ele(<span class="hljs-string">&#x27;@id=ele_id&#x27;</span>)<br>page.ele(<span class="hljs-string">&#x27;#:ele_id&#x27;</span>)  # ç­‰ä»·äº page.ele(<span class="hljs-string">&#x27;@id:ele_id&#x27;</span>)<br>page.ele(<span class="hljs-string">&#x27;.ele_class&#x27;</span>)  # ç­‰ä»·äº page.ele(<span class="hljs-string">&#x27;@class=ele_class&#x27;</span>)<br>page.ele(<span class="hljs-string">&#x27;.:ele_class&#x27;</span>)  # ç­‰ä»·äº page.ele(<span class="hljs-string">&#x27;@class:ele_class&#x27;</span>)<br> <br># æ ¹æ® tag name æŸ¥æ‰¾<br>page.ele(<span class="hljs-string">&#x27;tag:li&#x27;</span>)  # æŸ¥æ‰¾ç¬¬ä¸€ä¸ª li å…ƒç´   <br>page.eles(<span class="hljs-string">&#x27;tag:li&#x27;</span>)  # æŸ¥æ‰¾æ‰€æœ‰ li å…ƒç´   <br> <br># æ ¹æ® tag name åŠå±æ€§æŸ¥æ‰¾<br>page.ele(<span class="hljs-string">&#x27;tag:div@class=div_class&#x27;</span>)  # æŸ¥æ‰¾ <span class="hljs-keyword">class</span> ä¸º div_class çš„ div å…ƒç´ <br>page.ele(<span class="hljs-string">&#x27;tag:div@class:ele_class&#x27;</span>) # æŸ¥æ‰¾ <span class="hljs-keyword">class</span> å«æœ‰ ele_class çš„ div å…ƒç´ <br>page.ele(<span class="hljs-string">&#x27;tag:div@class=ele_class&#x27;</span>) # æŸ¥æ‰¾ <span class="hljs-keyword">class</span> ç­‰äº ele_class çš„ div å…ƒç´ <br>page.ele(<span class="hljs-string">&#x27;tag:div@text():search_text&#x27;</span>) # æŸ¥æ‰¾æ–‡æœ¬å«æœ‰ search_text çš„ div å…ƒç´ <br>page.ele(<span class="hljs-string">&#x27;tag:div@text()=search_text&#x27;</span>) # æŸ¥æ‰¾æ–‡æœ¬ç­‰äº search_text çš„ div å…ƒç´ <br> <br># æ ¹æ®æ–‡æœ¬å†…å®¹æŸ¥æ‰¾<br>page.ele(<span class="hljs-string">&#x27;search text&#x27;</span>)  # æŸ¥æ‰¾åŒ…å«ä¼ å…¥æ–‡æœ¬çš„å…ƒç´   <br>page.eles(<span class="hljs-string">&#x27;text:search text&#x27;</span>)  # å¦‚æ–‡æœ¬ä»¥ @ã€tag:ã€css:ã€xpath:ã€text: å¼€å¤´ï¼Œåˆ™åº”åœ¨å‰åŠ ä¸Š text: é¿å…å†²çª  <br>page.eles(<span class="hljs-string">&#x27;text=search text&#x27;</span>)  # æ–‡æœ¬ç­‰äº search_text çš„å…ƒç´ <br> <br># æ ¹æ® xpath æˆ– css selector æŸ¥æ‰¾<br>page.eles(<span class="hljs-string">&#x27;xpath://div[@class=&quot;ele_class&quot;]&#x27;</span>)  <br>page.eles(<span class="hljs-string">&#x27;css:div.ele_class&#x27;</span>)  <br> <br># æ ¹æ® loc æŸ¥æ‰¾<br>loc1 = By.ID, <span class="hljs-string">&#x27;ele_id&#x27;</span><br>loc2 = By.XPATH, <span class="hljs-string">&#x27;//div[@class=&quot;ele_class&quot;]&#x27;</span><br>page.ele(loc1)<br>page.ele(loc2)<br> <br># æŸ¥æ‰¾ä¸‹çº§å…ƒç´ <br>element = page.ele(<span class="hljs-string">&#x27;@id:ele_id&#x27;</span>)<br>element.ele(<span class="hljs-string">&#x27;@class:class_name&#x27;</span>)  # åœ¨ element ä¸‹çº§æŸ¥æ‰¾ç¬¬ä¸€ä¸ª <span class="hljs-keyword">class</span> ä¸º ele_class çš„å…ƒç´ <br>element.eles(<span class="hljs-string">&#x27;tag:li&#x27;</span>)  # åœ¨ ele_id ä¸‹çº§æŸ¥æ‰¾æ‰€æœ‰liå…ƒç´ <br> <br># æ ¹æ®ä½ç½®æŸ¥æ‰¾<br>element.parent  # çˆ¶å…ƒç´   <br>element.next  # ä¸‹ä¸€ä¸ªå…„å¼Ÿå…ƒç´   <br>element.prev  # ä¸Šä¸€ä¸ªå…„å¼Ÿå…ƒç´   <br> <br># è·å– shadow-rootï¼ŒæŠŠå®ƒä½œä¸ºå…ƒç´ å¯¹å¾…ã€‚åªæ”¯æŒ open çš„ shadow-root<br>ele1 = element.shadow_root.ele(<span class="hljs-string">&#x27;tag:div&#x27;</span>)<br> <br># ä¸²è¿æŸ¥æ‰¾<br>page.ele(<span class="hljs-string">&#x27;@id:ele_id&#x27;</span>).ele(<span class="hljs-string">&#x27;tag:div&#x27;</span>).next.ele(<span class="hljs-string">&#x27;some text&#x27;</span>).eles(<span class="hljs-string">&#x27;tag:a&#x27;</span>)<br> <br># ç®€åŒ–å†™æ³•<br>eles = page(<span class="hljs-string">&#x27;@id:ele_id&#x27;</span>)(<span class="hljs-string">&#x27;tag:div&#x27;</span>).next(<span class="hljs-string">&#x27;some text&#x27;</span>).eles(<span class="hljs-string">&#x27;tag:a&#x27;</span>)<br>ele2 = ele1(<span class="hljs-string">&#x27;tag:li&#x27;</span>).next(<span class="hljs-string">&#x27;some text&#x27;</span>)<br><br></code></pre></td></tr></table></figure><h3 id="1-2å…ƒç´ æ“ä½œ"><a href="#1-2å…ƒç´ æ“ä½œ" class="headerlink" title="1.2å…ƒç´ æ“ä½œ"></a>1.2å…ƒç´ æ“ä½œ</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">element</span>.click(by_js)  <span class="hljs-comment"># ç‚¹å‡»å…ƒç´ ï¼Œå¯é€‰æ‹©æ˜¯å¦ç”¨ js æ–¹å¼ç‚¹å‡»</span><br><span class="hljs-keyword">element</span>.input(<span class="hljs-built_in">value</span>)  <span class="hljs-comment"># è¾“å…¥æ–‡æœ¬</span><br><span class="hljs-keyword">element</span>.run_script(js)  <span class="hljs-comment"># å¯¹å…ƒç´ è¿è¡Œ JavaScript è„šæœ¬</span><br><span class="hljs-keyword">element</span>.submit()  <span class="hljs-comment"># æäº¤</span><br><span class="hljs-keyword">element</span>.<span class="hljs-built_in">clear</span>()  <span class="hljs-comment"># æ¸…ç©ºå…ƒç´ </span><br><span class="hljs-keyword">element</span>.screenshot(path, filename)  <span class="hljs-comment"># å¯¹å…ƒç´ æˆªå›¾</span><br><span class="hljs-keyword">element</span>.select(<span class="hljs-keyword">text</span>)  <span class="hljs-comment"># æ ¹æ®æ–‡æœ¬é€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨</span><br><span class="hljs-keyword">element</span>.set_attr(attr, <span class="hljs-built_in">value</span>)  <span class="hljs-comment"># è®¾ç½®å…ƒç´ å±æ€§å€¼</span><br><span class="hljs-keyword">element</span>.remove_attr(attr)  <span class="hljs-comment"># åˆ é™¤å±æ€§</span><br><span class="hljs-keyword">element</span>.drag(x, y, speed, shake)  <span class="hljs-comment"># æ‹–åŠ¨å…ƒç´ ç›¸å¯¹è·ç¦»ï¼Œå¯è®¾ç½®é€Ÿåº¦å’Œæ˜¯å¦éšæœºæŠ–åŠ¨</span><br><span class="hljs-keyword">element</span>.drag_to(ele_or_loc, speed, shake)  <span class="hljs-comment"># æ‹–åŠ¨å…ƒç´ åˆ°å¦ä¸€ä¸ªå…ƒç´ æˆ–æŸä¸ªåæ ‡ï¼Œå¯è®¾ç½®é€Ÿåº¦å’Œæ˜¯å¦éšæœºæŠ–åŠ¨</span><br><span class="hljs-keyword">element</span>.hover()  <span class="hljs-comment"># åœ¨å…ƒç´ ä¸Šæ‚¬åœé¼ æ ‡</span><br></code></pre></td></tr></table></figure><h3 id="1-3è·å–å…ƒç´ å±æ€§"><a href="#1-3è·å–å…ƒç´ å±æ€§" class="headerlink" title="1.3è·å–å…ƒç´ å±æ€§"></a>1.3è·å–å…ƒç´ å±æ€§</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">element</span>.html  <span class="hljs-comment"># è¿”å›å…ƒç´  outerHTML</span><br><span class="hljs-keyword">element</span>.inner_html  <span class="hljs-comment"># è¿”å›å…ƒç´  innerHTML</span><br><span class="hljs-keyword">element</span>.tag  <span class="hljs-comment"># è¿”å›å…ƒç´  tag name</span><br><span class="hljs-keyword">element</span>.<span class="hljs-keyword">text</span>  <span class="hljs-comment"># è¿”å›å…ƒç´  innerText å€¼</span><br><span class="hljs-keyword">element</span>.comments  <span class="hljs-comment"># è¿”å›å…ƒç´ å†…æ³¨é‡Šåˆ—è¡¨</span><br><span class="hljs-keyword">element</span>.link  <span class="hljs-comment"># è¿”å›å…ƒç´  href æˆ– src ç»å¯¹ url</span><br><span class="hljs-keyword">element</span>.texts()  <span class="hljs-comment"># è¿”å›å…ƒç´ å†…æ‰€æœ‰ç›´æ¥å­èŠ‚ç‚¹çš„æ–‡æœ¬ï¼ŒåŒ…æ‹¬å…ƒç´ å’Œæ–‡æœ¬èŠ‚ç‚¹ï¼Œå¯æŒ‡å®šåªè¿”å›æ–‡æœ¬èŠ‚ç‚¹</span><br><span class="hljs-keyword">element</span>.attrs  <span class="hljs-comment"># è¿”å›å…ƒç´ æ‰€æœ‰å±æ€§çš„å­—å…¸</span><br><span class="hljs-keyword">element</span>.attr(attr)  <span class="hljs-comment"># è¿”å›å…ƒç´ æŒ‡å®šå±æ€§çš„å€¼</span><br><span class="hljs-keyword">element</span>.css_path  <span class="hljs-comment"># è¿”å›å…ƒç´ ç»å¯¹ css è·¯å¾„</span><br><span class="hljs-keyword">element</span>.xpath  <span class="hljs-comment"># è¿”å›å…ƒç´ ç»å¯¹ xpath è·¯å¾„</span><br><span class="hljs-keyword">element</span>.parent  <span class="hljs-comment"># è¿”å›å…ƒç´ çˆ¶å…ƒç´ </span><br><span class="hljs-keyword">element</span>.next  <span class="hljs-comment"># è¿”å›å…ƒç´ åä¸€ä¸ªå…„å¼Ÿå…ƒç´ </span><br><span class="hljs-keyword">element</span>.prev  <span class="hljs-comment"># è¿”å›å…ƒç´ å‰ä¸€ä¸ªå…„å¼Ÿå…ƒç´ </span><br><span class="hljs-keyword">element</span>.parents(<span class="hljs-built_in">num</span>)  <span class="hljs-comment"># è¿”å›ç¬¬ num çº§çˆ¶å…ƒç´ </span><br><span class="hljs-keyword">element</span>.nexts(<span class="hljs-built_in">num</span>, mode)  <span class="hljs-comment"># è¿”å›åé¢ç¬¬å‡ ä¸ªå…ƒç´ æˆ–èŠ‚ç‚¹</span><br><span class="hljs-keyword">element</span>.prevs(<span class="hljs-built_in">num</span>, mode)  <span class="hljs-comment"># è¿”å›å‰é¢ç¬¬å‡ ä¸ªå…ƒç´ æˆ–èŠ‚ç‚¹</span><br><span class="hljs-keyword">element</span>.ele(loc_or_str, timeout)  <span class="hljs-comment"># è¿”å›å½“å‰å…ƒç´ ä¸‹çº§ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å­å…ƒç´ ã€å±æ€§æˆ–èŠ‚ç‚¹æ–‡æœ¬</span><br><span class="hljs-keyword">element</span>.eles(loc_or_str, timeout)  <span class="hljs-comment"># è¿”å›å½“å‰å…ƒç´ ä¸‹çº§æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å­å…ƒç´ ã€å±æ€§æˆ–èŠ‚ç‚¹æ–‡æœ¬</span><br></code></pre></td></tr></table></figure><h2 id="2-DrissionPageåŸºæœ¬ä½¿ç”¨"><a href="#2-DrissionPageåŸºæœ¬ä½¿ç”¨" class="headerlink" title="2.DrissionPageåŸºæœ¬ä½¿ç”¨"></a>2.DrissionPageåŸºæœ¬ä½¿ç”¨</h2><h3 id="2-1æ§åˆ¶æµè§ˆå™¨ï¼Œå¯¼å…¥ChromiumPageï¼š"><a href="#2-1æ§åˆ¶æµè§ˆå™¨ï¼Œå¯¼å…¥ChromiumPageï¼š" class="headerlink" title="2.1æ§åˆ¶æµè§ˆå™¨ï¼Œå¯¼å…¥ChromiumPageï¼š"></a><strong>2.1æ§åˆ¶æµè§ˆå™¨ï¼Œå¯¼å…¥<code>ChromiumPage</code>ï¼š</strong></h3><blockquote><p>from DrissionPage import ChromiumPage</p></blockquote><h4 id="2-1-1-ç¤ºä¾‹ä»£ç 1ï¼š"><a href="#2-1-1-ç¤ºä¾‹ä»£ç 1ï¼š" class="headerlink" title="2.1.1 ç¤ºä¾‹ä»£ç 1ï¼š"></a>2.1.1 ç¤ºä¾‹ä»£ç 1ï¼š</h4><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nsis">from DrissionPage import ChromiumPage<br> <br><span class="hljs-comment"># åˆ›å»ºé¡µé¢å¯¹è±¡ï¼Œå¹¶å¯åŠ¨æˆ–æ¥ç®¡æµè§ˆå™¨</span><br><span class="hljs-keyword">page</span> = ChromiumPage()<br><span class="hljs-comment"># è·³è½¬åˆ°ç™»å½•é¡µé¢</span><br><span class="hljs-keyword">page</span>.get(<span class="hljs-string">&#x27;https://gitee.com/login&#x27;</span>)    <span class="hljs-comment"># get()æ–¹æ³•ç”¨äºè®¿é—®å‚æ•°ä¸­çš„ç½‘å€ã€‚å®ƒä¼šç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½ï¼Œå†ç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ã€‚</span><br> <br><span class="hljs-comment"># å®šä½åˆ°è´¦å·æ–‡æœ¬æ¡†</span><br>ele = <span class="hljs-keyword">page</span>.ele(<span class="hljs-string">&#x27;#user_login&#x27;</span>)    <span class="hljs-comment"># ele()æ–¹æ³•ç”¨äºæŸ¥æ‰¾å…ƒç´ ,&#x27;#user_login&#x27;æ˜¯å®šä½ç¬¦æ–‡æœ¬ï¼Œ#æ„æ€æ˜¯æŒ‰idå±æ€§æŸ¥æ‰¾å…ƒç´ ã€‚ele()å†…ç½®äº†ç­‰å¾…ï¼Œå¦‚æœå…ƒç´ æœªåŠ è½½ï¼Œå®ƒä¼šæ‰§è¡Œç­‰å¾…ï¼Œç›´åˆ°å…ƒç´ å‡ºç°æˆ–åˆ°è¾¾æ—¶é™ã€‚é»˜è®¤è¶…æ—¶æ—¶é—´ 10 ç§’ã€‚</span><br> <br><span class="hljs-comment"># è¾“å…¥å¯¹æ–‡æœ¬æ¡†è¾“å…¥è´¦å·</span><br>ele.input(<span class="hljs-string">&#x27;è´¦å·&#x27;</span>)<br><span class="hljs-comment"># å®šä½åˆ°å¯†ç æ–‡æœ¬æ¡†å¹¶è¾“å…¥å¯†ç </span><br><span class="hljs-keyword">page</span>.ele(<span class="hljs-string">&#x27;#user_password&#x27;</span>).input(<span class="hljs-string">&#x27;å¯†ç &#x27;</span>)<br><span class="hljs-comment"># ç‚¹å‡»ç™»å½•æŒ‰é’®</span><br><span class="hljs-keyword">page</span>.ele(<span class="hljs-string">&#x27;@value=ç™» å½•&#x27;</span>).click()    <span class="hljs-comment"># @è¡¨ç¤ºæŒ‰å±æ€§åæŸ¥æ‰¾</span><br><br></code></pre></td></tr></table></figure><h4 id="2-1-2ç¤ºä¾‹ä»£ç 2-Recorderæ˜¯è¿½åŠ å†™å…¥-ï¼š"><a href="#2-1-2ç¤ºä¾‹ä»£ç 2-Recorderæ˜¯è¿½åŠ å†™å…¥-ï¼š" class="headerlink" title="2.1.2ç¤ºä¾‹ä»£ç 2(Recorderæ˜¯è¿½åŠ å†™å…¥)ï¼š"></a>2.1.2ç¤ºä¾‹ä»£ç 2(Recorderæ˜¯è¿½åŠ å†™å…¥)ï¼š</h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">from</span> DrissionPage import ChromiumPage<br><span class="hljs-built_in">from</span> DataRecorder import Recorder  <span class="hljs-comment"># è¿™ä¸ªæ˜¯è¿½åŠ å†™å…¥</span><br><span class="hljs-built_in">from</span> <span class="hljs-built_in">time</span> import sleep<br> <br><span class="hljs-comment"># åˆ›å»ºé¡µé¢å¯¹è±¡</span><br> <br>page = ChromiumPage()<br> <br><span class="hljs-comment"># åˆ›å»ºè®°å½•å™¨å¯¹è±¡</span><br> <br>recorder = Recorder(<span class="hljs-string">&#x27;data.csv&#x27;</span>)<br>recorder.add_data((<span class="hljs-string">&quot;æ ‡é¢˜&quot;</span>, <span class="hljs-string">&quot;å¯¼æ¼”&quot;</span>, <span class="hljs-string">&quot;ä¸Šæ˜ æ—¶é—´&quot;</span>, <span class="hljs-string">&quot;è¯„åˆ†&quot;</span>))<br> <br><span class="hljs-comment"># è®¿é—®ç½‘é¡µ</span><br> <br>page.<span class="hljs-built_in">get</span>(<span class="hljs-string">&#x27;https://www.maoyan.com/board/4&#x27;</span>)<br> <br><span class="hljs-keyword">while</span> True:<br>    <span class="hljs-comment"># éå†é¡µé¢ä¸Šæ‰€æœ‰ dd å…ƒç´ </span><br>    <span class="hljs-keyword">for</span> mov <span class="hljs-keyword">in</span> page.eles(<span class="hljs-string">&#x27;t:dd&#x27;</span>):<br>        <span class="hljs-comment"># è·å–é¡»è¦çš„ä¿¡æ¯</span><br>        score = mov(<span class="hljs-string">&#x27;.score&#x27;</span>).<span class="hljs-keyword">text</span><br>        title = mov(<span class="hljs-string">&#x27;@data-act=boarditem-click&#x27;</span>).attr(<span class="hljs-string">&#x27;title&#x27;</span>)<br>        star = mov(<span class="hljs-string">&#x27;.star&#x27;</span>).<span class="hljs-keyword">text</span><br>        <span class="hljs-built_in">time</span> = mov(<span class="hljs-string">&#x27;.releasetime&#x27;</span>).<span class="hljs-keyword">text</span><br>        <span class="hljs-comment"># å†™å…¥åˆ°è®°å½•å™¨</span><br>        recorder.add_data((title, star, <span class="hljs-built_in">time</span>, score))<br>    sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-comment"># è·å–ä¸‹ä¸€é¡µæŒ‰é’®ï¼Œæœ‰å°±ç‚¹å‡»</span><br>    btn = page(<span class="hljs-string">&#x27;ä¸‹ä¸€é¡µ&#x27;</span>, timeout=<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">if</span> btn:<br>        btn.click()<br>        page.<span class="hljs-built_in">wait</span>.load_start()<br>    <span class="hljs-comment"># æ²¡æœ‰åˆ™é€€å‡ºç¨‹åº</span><br>    <span class="hljs-keyword">else</span>:<br>        break<br>recorder.record()<br><br></code></pre></td></tr></table></figure><h4 id="2-1-3-ç¤ºä¾‹ä»£ç 3"><a href="#2-1-3-ç¤ºä¾‹ä»£ç 3" class="headerlink" title="2.1.3 ç¤ºä¾‹ä»£ç 3"></a>2.1.3 ç¤ºä¾‹ä»£ç 3</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#æŠ“å–éœ‡å¤è¡Œå•†å“</span><br><span class="hljs-attribute">from</span> DrissionPage import  ChromiumPage<br><span class="hljs-attribute">import</span>  time<br><br><span class="hljs-attribute">page</span> = ChromiumPage()<br><span class="hljs-comment"># page = ChromiumPage()è¿™å¥æ„æ€æ˜¯æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œè¿™ä¸ªæµè§ˆå™¨æ˜¯å®‰è£…DrissionPageæ—¶è‡ªåŠ¨å®‰è£…çš„</span><br><br><span class="hljs-comment"># è·³è½¬åˆ°éœ‡å¤è¡Œé¡µé¢</span><br><span class="hljs-attribute">page</span>.get(&#x27;https://www.zkh.com/?utm_source=baidu&amp;utm_medium=CPT&#x27;)<br><span class="hljs-attribute">time</span>.sleep(<span class="hljs-number">1</span>)<br><span class="hljs-attribute">page</span>.ele(&#x27;xpath://*[@id=<span class="hljs-string">&quot;app&quot;</span>]/div/div/div[<span class="hljs-number">3</span>]/div/div[<span class="hljs-number">1</span>]/div[<span class="hljs-number">1</span>]/input&#x27;).input(<span class="hljs-string">&quot;å£ç½©&quot;</span>)<br><span class="hljs-attribute">time</span>.sleep(<span class="hljs-number">1</span>)<br><span class="hljs-attribute">page</span>.ele(&#x27;xpath://*[@id=<span class="hljs-string">&quot;app&quot;</span>]/div/div/div[<span class="hljs-number">3</span>]/div/div[<span class="hljs-number">1</span>]/button&#x27;).click()<br><span class="hljs-comment"># page.to_tab(page.latest_tab)  goods-title</span><br><br><span class="hljs-attribute">while</span> True:<br>    <span class="hljs-attribute">page</span>.wait.load_start()<br><br>    <span class="hljs-attribute">page</span>.scroll.to_location(<span class="hljs-number">0</span>,<span class="hljs-number">10000</span>) #æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®<br>    <span class="hljs-attribute">time</span>.sleep(<span class="hljs-number">0</span>.<span class="hljs-number">5</span>)<br>    <span class="hljs-attribute">page</span>.scroll.to_location(<span class="hljs-number">0</span>, <span class="hljs-number">10000</span>)<br>    <span class="hljs-attribute">time</span>.sleep(<span class="hljs-number">0</span>.<span class="hljs-number">5</span>)<br>    <span class="hljs-attribute">page</span>.scroll.to_location(<span class="hljs-number">0</span>, <span class="hljs-number">10000</span>)<br>    <span class="hljs-attribute">time</span>.sleep(<span class="hljs-number">0</span>.<span class="hljs-number">5</span>)<br>    <span class="hljs-attribute">divs</span>=page.eles(&#x27;xpath://div[@class=<span class="hljs-string">&quot;goods-name clamp2&quot;</span>]&#x27;)<br>    <span class="hljs-attribute">for</span> i in divs:<br>        <span class="hljs-attribute">title</span> = i.attr(&#x27;title&#x27;)<br>        <span class="hljs-attribute">print</span>(title)<br><br><br></code></pre></td></tr></table></figure><h3 id="2-2æ”¶å‘æ•°æ®åŒ…ï¼Œå¯¼å…¥SessionPageï¼š"><a href="#2-2æ”¶å‘æ•°æ®åŒ…ï¼Œå¯¼å…¥SessionPageï¼š" class="headerlink" title="2.2æ”¶å‘æ•°æ®åŒ…ï¼Œå¯¼å…¥SessionPageï¼š"></a>2.2æ”¶å‘æ•°æ®åŒ…ï¼Œå¯¼å…¥<code>SessionPage</code>ï¼š</h3><blockquote><p>from DrissionPage import SessionPage</p></blockquote><h4 id="2-2-1ç¤ºä¾‹ä»£ç ï¼š"><a href="#2-2-1ç¤ºä¾‹ä»£ç ï¼š" class="headerlink" title="2.2.1ç¤ºä¾‹ä»£ç ï¼š"></a>2.2.1ç¤ºä¾‹ä»£ç ï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> DrissionPage <span class="hljs-keyword">import</span> SessionPage<br> <br><span class="hljs-comment"># åˆ›å»ºé¡µé¢å¯¹è±¡</span><br>page = SessionPage()<br> <br><span class="hljs-comment"># çˆ¬å–å‰5é¡µ</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>):<br>    page.get(<span class="hljs-string">f&#x27;https://gitee.com/explore/all?page=<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>)<br>    <span class="hljs-comment"># è·å–æ‰€æœ‰å¼€æºåº“&lt;a&gt;å…ƒç´ åˆ—è¡¨</span><br>    links = page.eles(<span class="hljs-string">&#x27;.title project-namespace-path&#x27;</span>)    <span class="hljs-comment"># é¡µé¢å¯¹è±¡çš„eles()è·å–é¡µé¢ä¸­æ‰€æœ‰classå±æ€§ä¸º&#x27;title project-namespace-path&#x27;çš„å…ƒç´ å¯¹è±¡ï¼Œeles()æ–¹æ³•ç”¨äºæŸ¥æ‰¾å¤šä¸ªç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œè¿”å›ç”±å®ƒä»¬ç»„æˆçš„list</span><br>    <span class="hljs-comment"># éå†æ‰€æœ‰&lt;a&gt;å…ƒç´ </span><br>    <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> links:<br>        <span class="hljs-comment"># æ‰“å°é“¾æ¥ä¿¡æ¯</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;link.text&#125;</span>:<span class="hljs-subst">&#123;link.link&#125;</span>&quot;</span>)    <span class="hljs-comment"># .textè·å–å…ƒç´ çš„æ–‡æœ¬ï¼Œ.linkè·å–å…ƒç´ çš„hrefæˆ–srcå±æ€§</span><br></code></pre></td></tr></table></figure><h4 id="2-2-2ä¸‹è½½ç½‘é¡µ"><a href="#2-2-2ä¸‹è½½ç½‘é¡µ" class="headerlink" title="2.2.2ä¸‹è½½ç½‘é¡µ"></a>2.2.2ä¸‹è½½ç½‘é¡µ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> DrissionPage <span class="hljs-keyword">import</span> SessionPage<br> <br>url = <span class="hljs-string">&#x27;https://www.baidu.com/img/flexible/logo/pc/result.png&#x27;</span><br>save_path = <span class="hljs-string">r&#x27;images&#x27;</span>  <span class="hljs-comment"># ä¿å­˜çš„è·¯å¾„ï¼Œå½“å‰çš„é¡¹ç›®è·¯å¾„ï¼Œå¦‚ä¸ºç©ºåˆ™ä¿å­˜åœ¨ä¸pyåŒç›®å½•</span><br> <br>page = SessionPage()<br>page.download(url, save_path, <span class="hljs-string">&#x27;img&#x27;</span>)  <span class="hljs-comment"># æ”¯æŒé‡å‘½åï¼Œå¤„ç†æ–‡ä»¶åå†²çªï¼Œimgæ˜¯å›¾ç‰‡åå­—</span><br></code></pre></td></tr></table></figure><h2 id="3-è·å–æ–°çª—å£å¥æŸ„"><a href="#3-è·å–æ–°çª—å£å¥æŸ„" class="headerlink" title="3.è·å–æ–°çª—å£å¥æŸ„"></a>3.è·å–æ–°çª—å£å¥æŸ„</h2><h3 id="3-1-æ— éœ€åˆ‡å…¥åˆ‡å‡ºï¼Œé€»è¾‘æ¸…æ™°"><a href="#3-1-æ— éœ€åˆ‡å…¥åˆ‡å‡ºï¼Œé€»è¾‘æ¸…æ™°" class="headerlink" title="3.1.æ— éœ€åˆ‡å…¥åˆ‡å‡ºï¼Œé€»è¾‘æ¸…æ™°"></a>3.1.æ— éœ€åˆ‡å…¥åˆ‡å‡ºï¼Œé€»è¾‘æ¸…æ™°</h3><p>ä½¿ç”¨è¿‡ selenium çš„äººéƒ½çŸ¥é“ï¼Œselenium åŒä¸€æ—¶é—´åªèƒ½æ“ä½œä¸€ä¸ªæ ‡ç­¾é¡µæˆ–<code>&lt;iframe&gt;</code>å…ƒç´ ï¼Œè¦æ“ä½œå…¶å®ƒæ ‡ç­¾é¡µï¼Œæˆ–<code>&lt;iframe&gt;</code>å…ƒç´ ï¼Œéœ€è¦ç”¨<code>switch_to()</code> æ–¹æ³•åˆ‡æ¢ï¼Œæ“ä½œåè¿˜è¦åˆ‡æ¢å›æ¥ã€‚å¦‚æœæ˜¯å¤šçº§<code>&lt;iframe&gt;</code>ï¼Œè¿˜è¦é€çº§åˆ‡å…¥ï¼Œç›¸å½“éº»çƒ¦ã€‚</p><p>DrissionPage åˆ™æ— éœ€è¿™äº›éº»çƒ¦çš„æ“ä½œï¼Œå®ƒæŠŠæ¯ä¸ªæ ‡ç­¾é¡µå’Œ<code>&lt;iframe&gt;</code>éƒ½çœ‹ä½œç‹¬ç«‹çš„å¯¹è±¡ï¼Œå¯ä»¥åŒæ—¶å¹¶å‘æ“ä½œï¼Œè€Œä¸”å¯ä»¥ç›´æ¥è·¨å¤šå±‚<code>&lt;iframe&gt;</code>è·å–é‡Œé¢çš„å…ƒç´ ï¼Œç„¶åç›´æ¥å¤„ç†ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><p>å¯¹æ¯”ä¸€ä¸‹ï¼Œè·å– 2 å±‚<code>&lt;iframe&gt;</code>å†…ä¸€ä¸ª id ä¸º<code>&#39;div1&#39;</code>çš„å…ƒç´ ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-comment"># ä½¿ç”¨ selenium</span><br>driver.<span class="hljs-keyword">switch_to.frame(0)</span><br><span class="hljs-keyword"></span>driver.<span class="hljs-keyword">switch_to.frame(0)</span><br><span class="hljs-keyword"></span>ele = driver.find_element(<span class="hljs-keyword">By.ID, </span><span class="hljs-string">&#x27;div1&#x27;</span>)<br>driver.<span class="hljs-keyword">switch_to.default_content()</span><br><span class="hljs-keyword"></span><br><span class="hljs-comment"># ä½¿ç”¨ DrissionPage</span><br>ele = page(<span class="hljs-string">&#x27;#div1&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å¤šæ ‡ç­¾é¡µåŒæ—¶æ“ä½œï¼Œselenium æ— æ­¤åŠŸèƒ½ï¼š</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">tab1</span> = page.get_tab(1)<br><span class="hljs-keyword">tab2</span> = page.get_tab(2)<br><br><span class="hljs-keyword">tab1</span>.<span class="hljs-built_in">get</span>(&#x27;https:<span class="hljs-comment">//www.baidu.com&#x27;)</span><br><span class="hljs-keyword">tab2</span>.<span class="hljs-built_in">get</span>(&#x27;https:<span class="hljs-comment">//www.163.com&#x27;)</span><br></code></pre></td></tr></table></figure><h3 id="3-2-ç¤ºä¾‹ä»£ç 1"><a href="#3-2-ç¤ºä¾‹ä»£ç 1" class="headerlink" title="3.2 ç¤ºä¾‹ä»£ç 1"></a>3.2 ç¤ºä¾‹ä»£ç 1</h3><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-comment">#ç™»å½•ç™¾åº¦çˆ¬å–</span><br>from DrissionPage import  ChromiumPage<br>import  time<br><br><span class="hljs-keyword">page</span> = ChromiumPage()è¿™å¥æ„æ€æ˜¯æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œè¿™ä¸ªæµè§ˆå™¨æ˜¯å®‰è£…DrissionPageæ—¶è‡ªåŠ¨å®‰è£…çš„<br><br><span class="hljs-comment"># è·³è½¬ç™¾åº¦é¡µé¢</span><br><span class="hljs-keyword">page</span>.get(<span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span>)<br>time.<span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">page</span>.ele(<span class="hljs-string">&#x27;xpath://*[@id=&quot;kw&quot;]&#x27;</span>).input(<span class="hljs-string">&quot;å®¿èˆ&quot;</span>)<br>time.<span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">page</span>.ele(<span class="hljs-string">&#x27;xpath://*[@id=&quot;su&quot;]&#x27;</span>).click()<br>time.<span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">page</span>.ele(<span class="hljs-string">&#x27;xpath://*[@id=&quot;3&quot;]/div/div[1]/h3/a&#x27;</span>).click()<br><br><span class="hljs-comment">#åˆ‡æ¢åˆ°æ–°é¡µé¢</span><br>ab=<span class="hljs-keyword">page</span>.get_tab(<span class="hljs-keyword">page</span>.latest_tab) <span class="hljs-comment">#è·å–æ–°çª—å£é¡µé¢å¥æŸ„</span><br><span class="hljs-comment"># ç­‰å¾…é¡µé¢è·³è½¬</span><br><span class="hljs-keyword">page</span>.wait.load_start()<br><span class="hljs-comment"># ab = page.geqwt_tab(0) #è¿™æ ·ä¹Ÿå¯ä»¥è·å–æ–°æ¡†æ¡†é¡µé¢å¥æŸ„</span><br><br><span class="hljs-literal">print</span>(ab.title) <span class="hljs-comment">#è·å–é¡µé¢æ ‡é¢˜</span><br><span class="hljs-comment"># exit()</span><br><br><br><span class="hljs-comment">#åˆ‡æ¢åˆ°æ–°é¡µé¢</span><br><span class="hljs-comment"># ab=page.get_tab(1)</span><br><span class="hljs-comment"># page.get_tab(page.latest_tab)</span><br><span class="hljs-comment"># print(ab.title)</span><br><span class="hljs-comment"># page.get_tab(page.latest_tab)</span><br><span class="hljs-comment"># print(page.title)</span><br><span class="hljs-comment"># exit()</span><br><br>time.<span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#é€šè¿‡ç”¨æ–°çª—å£çš„å¥æŸ„æ¥è¿›è¡Œæ“ä½œ</span><br>ab.ele(<span class="hljs-string">&#x27;xpath:/html/body/div[1]/div[3]/form/div/input[4]&#x27;</span>).input(<span class="hljs-string">&quot;å®¶&quot;</span>)<br>ab.ele(<span class="hljs-string">&#x27;xpath:/html/body/div[1]/div[3]/form/div/span&#x27;</span>).click()<br><br>lis = ab.ele(<span class="hljs-string">&#x27;xpath:/html/body/div[2]/div[1]/div/div[2]/ul&#x27;</span>)<br><span class="hljs-comment"># lis = page.ele(&#x27;xpath://ul[@class=&quot;w4]&#x27;)</span><br><span class="hljs-comment"># print(lis)</span><br>lis1 = lis.eles(<span class="hljs-string">&#x27;tag:li&#x27;</span>)<br>for i in lis1:<br>    lis2 = i.eles(<span class="hljs-string">&#x27;tag:a&#x27;</span>)<br>    for j in lis2:<br>        href=j.attr(<span class="hljs-string">&#x27;href&#x27;</span>) <span class="hljs-comment">#è·å–hrefå±æ€§å€¼</span><br>        <span class="hljs-comment"># title=i.text </span><br>        title=j.attr(<span class="hljs-string">&#x27;title&#x27;</span>) <span class="hljs-comment">#è·å–titleå±æ€§å€¼</span><br>        <span class="hljs-literal">print</span>(href,title)<br>time.<span class="hljs-keyword">sleep</span>(<span class="hljs-number">4</span>)<br><span class="hljs-comment"># ab.close()  #å…³é—­å½“å‰é¡µé¢ ï¼ˆè¿™æ ·ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="hljs-keyword">page</span>.close_tabs(ab) <span class="hljs-comment">#å…³é—­å½“å‰é¡µé¢</span><br><br><span class="hljs-comment"># ac=page.get_tab(-1)</span><br>ac=<span class="hljs-keyword">page</span>.get_tab(<span class="hljs-keyword">page</span>.latest_tab) <span class="hljs-comment">#å°†å¥æŸ„è°ƒå›åŸæ¥çš„é¡µé¢ä¸­</span><br><span class="hljs-literal">print</span>(ac.title)<br>time.<span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>)<br><br>ac.ele(<span class="hljs-string">&#x27;xpath://*[@id=&quot;6&quot;]/div/div[1]/h3/a&#x27;</span>).click()<br><br>time.<span class="hljs-keyword">sleep</span>(<span class="hljs-number">2</span>)<br><span class="hljs-keyword">page</span>.<span class="hljs-keyword">quit</span>() <span class="hljs-comment">#é€€å‡ºæµè§ˆå™¨</span><br></code></pre></td></tr></table></figure><h2 id="4-ä¸seleniumå¯¹æ¯”"><a href="#4-ä¸seleniumå¯¹æ¯”" class="headerlink" title="4.ä¸seleniumå¯¹æ¯”"></a>4.ä¸seleniumå¯¹æ¯”</h2><p><a href="http://drissionpage.cn/features/features_demos/selenium/">ä¸seleniumå¯¹æ¯”</a></p><h3 id="4-1è·³è½¬åˆ°ä¸€ä¸ªæ ‡ç­¾é¡µ"><a href="#4-1è·³è½¬åˆ°ä¸€ä¸ªæ ‡ç­¾é¡µ" class="headerlink" title="4.1è·³è½¬åˆ°ä¸€ä¸ªæ ‡ç­¾é¡µ"></a>4.1è·³è½¬åˆ°ä¸€ä¸ªæ ‡ç­¾é¡µ</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># ä½¿ç”¨ seleniumï¼š</span><br><span class="hljs-attribute">driver</span>.switch_to.window(driver.window_handles[<span class="hljs-number">0</span>])<br><br><span class="hljs-comment"># ä½¿ç”¨ DrissionPageï¼š</span><br><span class="hljs-attribute">tab</span> = page.get_tab(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h3 id="4-2æŒ‰æ–‡æœ¬é€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨"><a href="#4-2æŒ‰æ–‡æœ¬é€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨" class="headerlink" title="4.2æŒ‰æ–‡æœ¬é€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨"></a>4.2æŒ‰æ–‡æœ¬é€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta"># ä½¿ç”¨ seleniumï¼š</span><br>from selenium.webdriver.support.<span class="hljs-keyword">select</span> import <span class="hljs-keyword">Select</span><br>select_element = <span class="hljs-keyword">Select</span>(element)<br>select_element.select_by_visible_text(<span class="hljs-string">&#x27;text&#x27;</span>)<br><br><span class="hljs-meta"># ä½¿ç”¨ DrissionPageï¼š</span><br>element.<span class="hljs-keyword">select</span>(<span class="hljs-string">&#x27;text&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="4-3æ‹–æ‹½ä¸€ä¸ªå…ƒç´ "><a href="#4-3æ‹–æ‹½ä¸€ä¸ªå…ƒç´ " class="headerlink" title="4.3æ‹–æ‹½ä¸€ä¸ªå…ƒç´ "></a>4.3æ‹–æ‹½ä¸€ä¸ªå…ƒç´ </h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># ä½¿ç”¨ seleniumï¼š<br>ActionChains(driver).drag_and_drop(ele1, ele2).<span class="hljs-keyword">perform</span>()<br><br># ä½¿ç”¨ DrissionPageï¼š<br>ele1.drag_to(ele2)<br></code></pre></td></tr></table></figure><h3 id="4-4æ»šåŠ¨çª—å£åˆ°åº•éƒ¨ï¼ˆä¿æŒæ°´å¹³æ»šåŠ¨æ¡ä¸å˜ï¼‰"><a href="#4-4æ»šåŠ¨çª—å£åˆ°åº•éƒ¨ï¼ˆä¿æŒæ°´å¹³æ»šåŠ¨æ¡ä¸å˜ï¼‰" class="headerlink" title="4.4æ»šåŠ¨çª—å£åˆ°åº•éƒ¨ï¼ˆä¿æŒæ°´å¹³æ»šåŠ¨æ¡ä¸å˜ï¼‰"></a>4.4æ»šåŠ¨çª—å£åˆ°åº•éƒ¨ï¼ˆä¿æŒæ°´å¹³æ»šåŠ¨æ¡ä¸å˜ï¼‰</h3><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-comment"># ä½¿ç”¨ seleniumï¼š</span><br>driver.execute_script(<span class="hljs-string">&quot;window.scrollTo(document.documentElement.scrollLeft, document.body.scrollHeight);&quot;</span>)<br><br><span class="hljs-comment"># ä½¿ç”¨ DrissionPageï¼š</span><br><span class="hljs-keyword">page</span>.scroll.to_bottom()<br></code></pre></td></tr></table></figure><h3 id="4-5è®¾ç½®-headless-æ¨¡å¼"><a href="#4-5è®¾ç½®-headless-æ¨¡å¼" class="headerlink" title="4.5è®¾ç½® headless æ¨¡å¼"></a>4.5è®¾ç½® headless æ¨¡å¼</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># ä½¿ç”¨ seleniumï¼š</span><br><span class="hljs-attribute">options</span> = webdriver.ChromeOptions()<br><span class="hljs-attribute">options</span>.add_argument(<span class="hljs-string">&quot;--headless&quot;</span>)<br><br><span class="hljs-comment"># ä½¿ç”¨ DrissionPageï¼š</span><br><span class="hljs-attribute">set_headless</span>(True)<br></code></pre></td></tr></table></figure><h3 id="4-6è·å–ä¼ªå…ƒç´ å†…å®¹"><a href="#4-6è·å–ä¼ªå…ƒç´ å†…å®¹" class="headerlink" title="4.6è·å–ä¼ªå…ƒç´ å†…å®¹"></a>4.6è·å–ä¼ªå…ƒç´ å†…å®¹</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># ä½¿ç”¨ seleniumï¼š</span><br><span class="hljs-built_in">text</span> = webdriver.execute_script(&#x27;<span class="hljs-literal">return</span> window.getComputedStyle(arguments[<span class="hljs-number">0</span>], <span class="hljs-string">&quot;::after&quot;</span>).getPropertyValue(<span class="hljs-string">&quot;content&quot;</span>);&#x27;, element)<br><br><span class="hljs-comment"># ä½¿ç”¨ DrissionPageï¼š</span><br><span class="hljs-built_in">text</span> = element.pseudo.<span class="hljs-keyword">after</span><br></code></pre></td></tr></table></figure><h3 id="4-7ç”¨-xpath-ç›´æ¥è·å–å±æ€§æˆ–æ–‡æœ¬èŠ‚ç‚¹ï¼ˆè¿”å›æ–‡æœ¬ï¼‰"><a href="#4-7ç”¨-xpath-ç›´æ¥è·å–å±æ€§æˆ–æ–‡æœ¬èŠ‚ç‚¹ï¼ˆè¿”å›æ–‡æœ¬ï¼‰" class="headerlink" title="4.7ç”¨ xpath ç›´æ¥è·å–å±æ€§æˆ–æ–‡æœ¬èŠ‚ç‚¹ï¼ˆè¿”å›æ–‡æœ¬ï¼‰"></a>4.7ç”¨ xpath ç›´æ¥è·å–å±æ€§æˆ–æ–‡æœ¬èŠ‚ç‚¹ï¼ˆè¿”å›æ–‡æœ¬ï¼‰</h3><figure class="highlight golo"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs golo"><span class="hljs-comment"># ä½¿ç”¨ seleniumï¼š</span><br>ç›¸å½“å¤æ‚<br><br><span class="hljs-comment"># ä½¿ç”¨ DrissionPageï¼š</span><br>class_name = element(&#x27;xpath://div[<span class="hljs-meta">@id</span>=<span class="hljs-string">&quot;div_id&quot;</span>]/<span class="hljs-meta">@class</span>&#x27;)<br>text = element(&#x27;xpath://div[<span class="hljs-meta">@id</span>=<span class="hljs-string">&quot;div_id&quot;</span>]/text()[<span class="hljs-number">2</span>]&#x27;)<br></code></pre></td></tr></table></figure><h2 id="5-æ¨¡å¼åˆ‡æ¢"><a href="#5-æ¨¡å¼åˆ‡æ¢" class="headerlink" title="5.æ¨¡å¼åˆ‡æ¢"></a>5.æ¨¡å¼åˆ‡æ¢</h2><p><a href="http://drissionpage.cn/features/features_demos/change_mode/">http://drissionpage.cn/features/features_demos&#x2F;change_mode&#x2F;</a></p><p><strong>ç”¨æµè§ˆå™¨ç™»å½•ç½‘ç«™ï¼Œç„¶ååˆ‡æ¢åˆ° requests è¯»å–ç½‘é¡µã€‚ä¸¤è€…ä¼šå…±äº«ç™»å½•ä¿¡æ¯ã€‚</strong></p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs nsis">from DrissionPage import WebPage<br>from time import <span class="hljs-keyword">sleep</span><br><br><span class="hljs-comment"># åˆ›å»ºé¡µé¢å¯¹è±¡ï¼Œé»˜è®¤ d æ¨¡å¼</span><br><span class="hljs-keyword">page</span> = WebPage()  <br><span class="hljs-comment"># è®¿é—®ä¸ªäººä¸­å¿ƒé¡µé¢ï¼ˆæœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼‰</span><br><span class="hljs-keyword">page</span>.get(<span class="hljs-string">&#x27;https://gitee.com/profile&#x27;</span>)  <br><br><span class="hljs-comment"># è¾“å…¥è´¦å·å¯†ç ç™»å½•</span><br><span class="hljs-keyword">page</span>.ele(<span class="hljs-string">&#x27;@id:user_login&#x27;</span>).input(<span class="hljs-string">&#x27;your_user_name&#x27;</span>)  <br><span class="hljs-keyword">page</span>.ele(<span class="hljs-string">&#x27;@id:user_password&#x27;</span>).input(<span class="hljs-string">&#x27;your_password\n&#x27;</span>)<br><span class="hljs-keyword">page</span>.wait.load_start()<br><br><span class="hljs-comment"># åˆ‡æ¢åˆ° s æ¨¡å¼</span><br><span class="hljs-keyword">page</span>.change_mode()  <br><span class="hljs-comment"># ç™»å½•å session æ¨¡å¼çš„è¾“å‡º</span><br><span class="hljs-literal">print</span>(<span class="hljs-string">&#x27;ç™»å½•åtitleï¼š&#x27;</span>, <span class="hljs-keyword">page</span>.title, <span class="hljs-string">&#x27;\n&#x27;</span>)  <br><br><span class="hljs-comment">#è¾“å‡ºï¼š</span><br>ç™»å½•åtitleï¼š ä¸ªäººèµ„æ–™ - ç äº‘ Gitee.com<br></code></pre></td></tr></table></figure><h4 id="è·å–ç™»å½•åçš„å…ƒç´ "><a href="#è·å–ç™»å½•åçš„å…ƒç´ " class="headerlink" title="è·å–ç™»å½•åçš„å…ƒç´ "></a>è·å–ç™»å½•åçš„å…ƒç´ </h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment"># æ¥ä¸Šæ®µä»£ç </span><br>foot = page.ele(<span class="hljs-string">&#x27;#footer-left&#x27;</span>)  <span class="hljs-comment"># ç”¨ id æŸ¥æ‰¾å…ƒç´ </span><br>first_col = foot.ele(<span class="hljs-string">&#x27;css:&gt;div&#x27;</span>)  <span class="hljs-comment"># ä½¿ç”¨ css selector åœ¨å…ƒç´ çš„ä¸‹çº§ä¸­æŸ¥æ‰¾å…ƒç´ ï¼ˆç¬¬ä¸€ä¸ªï¼‰</span><br>lnk = first_col.ele(<span class="hljs-string">&#x27;text:å‘½ä»¤å­¦&#x27;</span>)  <span class="hljs-comment"># ä½¿ç”¨æ–‡æœ¬å†…å®¹æŸ¥æ‰¾å…ƒç´ </span><br><span class="hljs-keyword">text</span> = lnk.<span class="hljs-keyword">text</span>  <span class="hljs-comment"># è·å–å…ƒç´ æ–‡æœ¬</span><br>href = lnk.attr(<span class="hljs-string">&#x27;href&#x27;</span>)  <span class="hljs-comment"># è·å–å…ƒç´ å±æ€§å€¼</span><br><br>print(<span class="hljs-keyword">text</span>, href, <span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><span class="hljs-comment"># ç®€æ´æ¨¡å¼ä¸²è”æŸ¥æ‰¾</span><br><span class="hljs-keyword">text</span> = page(<span class="hljs-string">&#x27;@id:footer-left&#x27;</span>)(<span class="hljs-string">&#x27;css:&gt;div&#x27;</span>)(<span class="hljs-string">&#x27;text:å‘½ä»¤å­¦&#x27;</span>).<span class="hljs-keyword">text</span><br>print(<span class="hljs-keyword">text</span>)<br><br><span class="hljs-comment">#è¾“å‡º</span><br>Git å‘½ä»¤å­¦ä¹  <span class="hljs-keyword">https</span>://oschina.gitee.io/learn-git-branching/<br><br>Git å‘½ä»¤å­¦ä¹ <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå®¹å™¨ä¸­çš„ç¨‹åºï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦å‰å°è¿è¡Œ</title>
    <link href="/article/a730ba11.html"/>
    <url>/article/a730ba11.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />#### [docker](https://so.csdn.net/so/search?q=docker&spm=1001.2101.3001.7020) å®¹å™¨é»˜è®¤ä¼šæŠŠå®¹å™¨å†…éƒ¨ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯`pid=1`çš„ç¨‹åºä½œä¸ºdocker[å®¹å™¨](https://so.csdn.net/so/search?q=%E5%AE%B9%E5%99%A8&spm=1001.2101.3001.7020)æ˜¯å¦æ­£åœ¨è¿è¡Œçš„ä¾æ®ï¼Œå¦‚æœdockerå®¹å™¨ä¸­ pid = 1 çš„è¿›ç¨‹æŒ‚äº†ï¼Œé‚£ä¹ˆdockerå®¹å™¨ä¾¿ä¼šç›´æ¥é€€å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´Dockerå®¹å™¨ä¸­å¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ï¼Œå¦åˆ™è®¤ä¸ºå®¹å™¨å·²ç»æŒ‚æ‰ã€‚<p>ä»£ç è¯­è¨€ï¼šjavascript</p><p>å¤åˆ¶</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">dockerå®¹å™¨ä¹‹åå°è¿è¡Œ æˆ‘ä»¬ docker <span class="hljs-built_in">run</span> å¯åŠ¨å®¹å™¨çš„æ—¶å€™ï¼Œå¸¸éœ€è¦å°†å…¶åœ¨åå°è¿è¡Œï¼Œé€šå¸¸æˆ‘ä»¬è®¾ç½®å‚æ•° -d å³å¯ã€‚ ä½†åå°è¿è¡Œï¼Œå…¶å®æ˜¯æœ‰å‰æçš„ï¼Œå¦‚æœæ²¡æœ‰å‰å°è¿›ç¨‹ï¼Œé‚£ä¹ˆå®é™…è¿è¡Œå®Œdocker <span class="hljs-built_in">run</span>å‘½ä»¤åï¼Œä¼šå¤„äºé€€å‡ºçŠ¶æ€ï¼Œå³exitedã€‚ ä¾‹å­ï¼šdocker <span class="hljs-built_in">run</span> -d <span class="hljs-comment">--name my-redis redis bash # æŒ‡å®šå‘½ä»¤æ˜¯bashï¼Œä½†æ˜¾ç„¶bashåœ¨å®¹å™¨èµ·æ¥åï¼Œå¾ˆå¿«å°±ä¼šç»“æŸï¼Œå¯¼è‡´æ²¡æœ‰å‰å°è¿›ç¨‹ï¼Œæ•…å®¹å™¨å¤„äºé€€å‡ºçŠ¶æ€</span><br></code></pre></td></tr></table></figure><h4 id="Dockerå®¹å™¨åå°è¿è¡Œï¼Œå¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ã€‚å®¹å™¨è¿è¡Œçš„å‘½ä»¤å¦‚æœä¸æ˜¯é‚£äº›ä¸€ç›´æŒ‚èµ·çš„å‘½ä»¤ï¼ˆæ¯”å¦‚è¿è¡Œpingï¼Œsleepï¼‰ï¼Œå°±æ˜¯ä¼šè‡ªåŠ¨é€€å‡ºçš„ã€‚-è€Œä¸Šé¢çš„ä»£ç ä¸­bashå°±æ˜¯éœ€è¦æ‰§è¡Œçš„æŒ‡å®šçš„å‘½ä»¤ã€‚"><a href="#Dockerå®¹å™¨åå°è¿è¡Œï¼Œå¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ã€‚å®¹å™¨è¿è¡Œçš„å‘½ä»¤å¦‚æœä¸æ˜¯é‚£äº›ä¸€ç›´æŒ‚èµ·çš„å‘½ä»¤ï¼ˆæ¯”å¦‚è¿è¡Œpingï¼Œsleepï¼‰ï¼Œå°±æ˜¯ä¼šè‡ªåŠ¨é€€å‡ºçš„ã€‚-è€Œä¸Šé¢çš„ä»£ç ä¸­bashå°±æ˜¯éœ€è¦æ‰§è¡Œçš„æŒ‡å®šçš„å‘½ä»¤ã€‚" class="headerlink" title="Dockerå®¹å™¨åå°è¿è¡Œï¼Œå¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ã€‚å®¹å™¨è¿è¡Œçš„å‘½ä»¤å¦‚æœä¸æ˜¯é‚£äº›ä¸€ç›´æŒ‚èµ·çš„å‘½ä»¤ï¼ˆæ¯”å¦‚è¿è¡Œpingï¼Œsleepï¼‰ï¼Œå°±æ˜¯ä¼šè‡ªåŠ¨é€€å‡ºçš„ã€‚ è€Œä¸Šé¢çš„ä»£ç ä¸­bashå°±æ˜¯éœ€è¦æ‰§è¡Œçš„æŒ‡å®šçš„å‘½ä»¤ã€‚"></a>Dockerå®¹å™¨åå°è¿è¡Œï¼Œå¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ã€‚å®¹å™¨è¿è¡Œçš„å‘½ä»¤å¦‚æœä¸æ˜¯é‚£äº›ä¸€ç›´æŒ‚èµ·çš„å‘½ä»¤ï¼ˆæ¯”å¦‚è¿è¡Œpingï¼Œsleepï¼‰ï¼Œå°±æ˜¯ä¼šè‡ªåŠ¨é€€å‡ºçš„ã€‚ è€Œä¸Šé¢çš„ä»£ç ä¸­bashå°±æ˜¯éœ€è¦æ‰§è¡Œçš„æŒ‡å®šçš„å‘½ä»¤ã€‚</h4><h4 id="å‘½ä»¤å¦‚æœæ‰§è¡Œå®Œæ¯•äº†ï¼Œæˆ–è€…å«æŒ‡å®šçš„åº”ç”¨ç»ˆç»“æ—¶ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨åœæ­¢ã€‚"><a href="#å‘½ä»¤å¦‚æœæ‰§è¡Œå®Œæ¯•äº†ï¼Œæˆ–è€…å«æŒ‡å®šçš„åº”ç”¨ç»ˆç»“æ—¶ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨åœæ­¢ã€‚" class="headerlink" title="å‘½ä»¤å¦‚æœæ‰§è¡Œå®Œæ¯•äº†ï¼Œæˆ–è€…å«æŒ‡å®šçš„åº”ç”¨ç»ˆç»“æ—¶ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨åœæ­¢ã€‚"></a>å‘½ä»¤å¦‚æœæ‰§è¡Œå®Œæ¯•äº†ï¼Œæˆ–è€…å«æŒ‡å®šçš„åº”ç”¨ç»ˆç»“æ—¶ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨åœæ­¢ã€‚</h4><h4 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a><strong>è§£å†³åŠæ³•</strong></h4><p>ç›®å‰äº†è§£çš„å¯ä»¥ä½¿ç”¨ä»¥ä¸‹3ç§æ–¹æ³•ï¼Œå…·ä½“ç”¨å“ªç§æ–¹æ³•ï¼Œä¾æ®å®é™…æƒ…å†µï¼Œç”Ÿäº§æƒ…å†µä¸‹ï¼Œé€šå¸¸ç”¨<code>docker-compose</code>ç»“åˆå…·ä½“<code>cmd</code>ä½œä¸º<a href="https://cloud.tencent.com/product/tke?from_column=20065&from=20065" title="å®¹å™¨">å®¹å™¨</a>åˆèµ·çš„å‘½ä»¤ã€‚</p><h5 id="1-æŒ‡å®šæŒ‚èµ·é˜»å¡å‘½ä»¤å¯åŠ¨å®¹å™¨"><a href="#1-æŒ‡å®šæŒ‚èµ·é˜»å¡å‘½ä»¤å¯åŠ¨å®¹å™¨" class="headerlink" title="1.æŒ‡å®šæŒ‚èµ·é˜»å¡å‘½ä»¤å¯åŠ¨å®¹å™¨"></a><strong>1.æŒ‡å®šæŒ‚èµ·é˜»å¡å‘½ä»¤å¯åŠ¨å®¹å™¨</strong></h5><p>ä»£ç è¯­è¨€ï¼šjavascript</p><p>å¤åˆ¶</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker <span class="hljs-built_in">run</span> -d <span class="hljs-comment">--name my-redis redis sleep 99999999999999</span><br></code></pre></td></tr></table></figure><p><a href="https://so.csdn.net/so/search?q=%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&spm=1001.2101.3001.7020">å‘½ä»¤æ‰§è¡Œ</a>åï¼Œé€šè¿‡**<code>docker ps -a | grep my-redis</code><strong>ï¼Œå¯ä»¥çœ‹åˆ°å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå³</strong><code>up</code>**ã€‚</p><h5 id="2-ä½¿ç”¨äº¤äº’ç•Œé¢åé€€å‡ºå®¹å™¨"><a href="#2-ä½¿ç”¨äº¤äº’ç•Œé¢åé€€å‡ºå®¹å™¨" class="headerlink" title="2.ä½¿ç”¨äº¤äº’ç•Œé¢åé€€å‡ºå®¹å™¨"></a><strong>2.ä½¿ç”¨äº¤äº’ç•Œé¢åé€€å‡ºå®¹å™¨</strong></h5><p>ä»£ç è¯­è¨€ï¼šjavascript</p><p>å¤åˆ¶</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-comment">--name my-redis redis bash</span><br></code></pre></td></tr></table></figure><p>ä¹‹åä¼šè¿›å…¥å®¹å™¨ï¼Œå¦‚æœæƒ³ä¿æŒå®¹å™¨åå°è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ **<code>Ctrl + p + q</code><strong>ï¼Œå†æ¬¡æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°å®¹å™¨å¤„äº</strong><code>up</code>**çŠ¶æ€ã€‚</p><h5 id="3-tdå‘½ä»¤ç»“åˆä½¿ç”¨"><a href="#3-tdå‘½ä»¤ç»“åˆä½¿ç”¨" class="headerlink" title="3.-tdå‘½ä»¤ç»“åˆä½¿ç”¨"></a><strong>3.-tdå‘½ä»¤ç»“åˆä½¿ç”¨</strong></h5><p>ä»£ç è¯­è¨€ï¼šjavascript</p><p>å¤åˆ¶</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker <span class="hljs-built_in">run</span> -itd <span class="hljs-comment">--name my-redis2 redis bash# -i ä¸æ˜¯å¿…éœ€ï¼ŒåŠ äº†ï¼Œå®¹å™¨èµ·æ¥åç»ˆç«¯è¿”å›å®¹å™¨ID</span><br></code></pre></td></tr></table></figure><p>åˆšä¹Ÿæåˆ°ï¼Œå°±æ˜¯<code>-d</code>è¿è¡Œå®¹å™¨æ—¶ï¼Œéœ€è¦æœ‰å‰å°è¿›ç¨‹ï¼Œ<code>-t</code>æä¾›ä¸€ä¸ªä¼ªç»ˆç«¯ï¼Œç±»ä¼¼å‰å°è¿›ç¨‹ï¼ŒæŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå®¹å™¨å¤„äº<code>**up**</code>çŠ¶æ€ã€‚</p><h5 id="è¡¥å……-è¿›å…¥å®¹å™¨çš„4ç§æ–¹æ³•"><a href="#è¡¥å……-è¿›å…¥å®¹å™¨çš„4ç§æ–¹æ³•" class="headerlink" title="è¡¥å……-è¿›å…¥å®¹å™¨çš„4ç§æ–¹æ³•"></a><strong>è¡¥å……-è¿›å…¥å®¹å™¨çš„4ç§æ–¹æ³•</strong></h5><p><a href="https://cloud.tencent.com/product/tke?from_column=20065&from=20065" title="docker">docker</a>æä¾›äº†å¤šç§è¿›å…¥å®¹å™¨çš„æ–¹æ³•ï¼Œè¿™é‡Œè¡¥å……4ç§å¸¸è§çš„æ–¹æ³•ï¼š</p><ul><li>ä½¿ç”¨docker attach</li><li>ä½¿ç”¨SSH</li><li>ä½¿ç”¨nsenter</li><li>ä½¿ç”¨exec</li></ul><p><strong>docker attach</strong></p><p>ä»£ç è¯­è¨€ï¼šjavascript</p><p>å¤åˆ¶</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">docker attach å®¹å™¨ID<span class="hljs-string">|å®¹å™¨name </span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è¯¥å‘½ä»¤æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å½“å¤šä¸ªçª—å£åŒæ—¶ä½¿ç”¨è¯¥å‘½ä»¤è¿›å…¥è¯¥å®¹å™¨æ—¶ï¼Œæ‰€æœ‰çš„çª—å£éƒ½ä¼šåŒæ­¥æ˜¾ç¤ºã€‚å¦‚æœæœ‰ä¸€ä¸ªçª—å£é˜»å¡äº†ï¼Œé‚£ä¹ˆå…¶ä»–çª—å£ä¹Ÿæ— æ³•å†è¿›è¡Œæ“ä½œï¼Œå»ºè®®å¼€å‘æ—¶ä½¿ç”¨ã€‚</p><p><strong>ssh</strong> åœ¨é•œåƒï¼ˆæˆ–å®¹å™¨ï¼‰ä¸­å®‰è£…SSH Serverï¼Œè¿™æ ·å°±èƒ½ä¿è¯å¤šäººè¿›å…¥ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå…·ä½“è§<a href="https://cloud.tencent.com/developer/tools/blog-entry?target=http://www.oschina.net/translate/why-you-dont-need-to-run-sshd-in-docker?cmp&source=article&objectId=2137830" title="ä¸ºä»€ä¹ˆä¸éœ€è¦åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ sshd">ä¸ºä»€ä¹ˆä¸éœ€è¦åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ sshd</a></p><p><strong>nsenter</strong> <a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://www.cnblogs.com/xhyan/p/6593075.html&source=article&objectId=2137830" title="nsenterä½¿ç”¨æ–¹æ³•">nsenterä½¿ç”¨æ–¹æ³•</a></p><p><strong>docker exec-æ¨èä½¿ç”¨</strong> é€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>å®¹å™¨name</code>æˆ–<code>å®¹å™¨ID</code>è¿›å…¥åˆ°å®¹å™¨ä¸­ï¼š</p><ul><li>å¦‚æœæˆ‘ä»¬åœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™æŒ‡å®š<code>-name</code>é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š<code>docker exec -it container_name bash</code></li><li>æ²¡æŒ‡å®šnameï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>docker ps</code>æŸ¥çœ‹å®¹å™¨çš„IDï¼Œä¹‹åå†é€šè¿‡<code>docker exec -it containerID bash</code>è¿›å…¥å®¹å™¨</li></ul>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Feign å’Œ RestTemplate</title>
    <link href="/article/356b653b.html"/>
    <url>/article/356b653b.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />Feign å’Œ RestTemplate æ˜¯ä¸¤ç§ç”¨äºåœ¨ Spring åº”ç”¨ä¸­è¿›è¡Œ HTTP è¯·æ±‚çš„å·¥å…·ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„ä»‹ç»å’Œä¸»è¦åŒºåˆ«ï¼š<h3 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h3><p>Feign æ˜¯ä¸€ç§å£°æ˜å¼çš„ HTTP å®¢æˆ·ç«¯ï¼Œç”± Netflix å¼€å‘ï¼Œé€šå¸¸ä¸ Spring Cloud ä¸€èµ·ä½¿ç”¨ã€‚å®ƒé€šè¿‡æ¥å£æ¥å®šä¹‰ HTTP è¯·æ±‚ï¼Œå¹¶åœ¨è¿è¡Œæ—¶ç”Ÿæˆå®ç°ç±»ã€‚ä½¿ç”¨ Feign å¯ä»¥å¤§å¤§å‡å°‘æ ·æ¿ä»£ç ï¼Œè®©ä»£ç æ›´ç®€æ´ã€‚</p><h4 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h4><ol><li><strong>å£°æ˜å¼ç¼–ç¨‹</strong>ï¼šé€šè¿‡æ³¨è§£å®šä¹‰ HTTP è¯·æ±‚ï¼Œä»£ç æ›´åŠ ç®€æ´ç›´è§‚ã€‚</li><li><strong>é›†æˆæ€§å¼º</strong>ï¼šä¸ Spring Cloudã€Eurekaã€Ribbon ç­‰ç»„ä»¶æ— ç¼é›†æˆã€‚</li><li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰ç¼–ç å™¨ã€è§£ç å™¨ã€é”™è¯¯å¤„ç†ç­‰ã€‚</li></ol><h4 id="ä½¿ç”¨ç¤ºä¾‹ï¼š"><a href="#ä½¿ç”¨ç¤ºä¾‹ï¼š" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹ï¼š"></a>ä½¿ç”¨ç¤ºä¾‹ï¼š</h4><p>java</p><p>å¤åˆ¶ä»£ç </p><p><code>@FeignClient(name = &quot;service-name&quot;) public interface MyFeignClient &#123;      @GetMapping(&quot;/endpoint&quot;)     String getData(); &#125;</code></p><h3 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h3><p>RestTemplate æ˜¯ Spring æä¾›çš„ä¸€ä¸ªåŒæ­¥ HTTP å®¢æˆ·ç«¯ï¼Œç”¨äºåœ¨ Java åº”ç”¨ä¸­å‘èµ· HTTP è¯·æ±‚ã€‚å®ƒåŠŸèƒ½å¼ºå¤§ä¸”çµæ´»ï¼Œå¯ä»¥é…ç½®å„ç§æ¶ˆæ¯è½¬æ¢å™¨å’Œé”™è¯¯å¤„ç†æœºåˆ¶ã€‚</p><h4 id="ä¼˜ç‚¹ï¼š-1"><a href="#ä¼˜ç‚¹ï¼š-1" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h4><ol><li><strong>çµæ´»æ€§é«˜</strong>ï¼šå¯ä»¥é…ç½®å„ç§è¯·æ±‚å¤´ã€å‚æ•°ã€æ¶ˆæ¯è½¬æ¢å™¨ç­‰ã€‚</li><li><strong>ç»†ç²’åº¦æ§åˆ¶</strong>ï¼šæä¾›äº†å¯¹ HTTP è¯·æ±‚çš„å…¨é¢æ§åˆ¶ã€‚</li><li><strong>å¹¿æ³›ä½¿ç”¨</strong>ï¼šé€‚ç”¨äºå„ç§ HTTP è¯·æ±‚åœºæ™¯ã€‚</li></ol><h4 id="ä½¿ç”¨ç¤ºä¾‹ï¼š-1"><a href="#ä½¿ç”¨ç¤ºä¾‹ï¼š-1" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹ï¼š"></a>ä½¿ç”¨ç¤ºä¾‹ï¼š</h4><p>java</p><p>å¤åˆ¶ä»£ç </p><p><code>RestTemplate restTemplate = new RestTemplate(); String url = &quot;http://service-name/endpoint&quot;; String response = restTemplate.getForObject(url, String.class);</code></p><h3 id="ä¸»è¦åŒºåˆ«"><a href="#ä¸»è¦åŒºåˆ«" class="headerlink" title="ä¸»è¦åŒºåˆ«"></a>ä¸»è¦åŒºåˆ«</h3><ol><li><strong>ç¼–ç¨‹æ–¹å¼</strong>ï¼šFeign é‡‡ç”¨å£°æ˜å¼ç¼–ç¨‹ï¼Œé€šè¿‡æ³¨è§£å®šä¹‰è¯·æ±‚ï¼›RestTemplate åˆ™æ˜¯ç¼–ç¨‹å¼çš„ï¼Œéœ€è¦æ‰‹åŠ¨æ„å»ºè¯·æ±‚ã€‚</li><li><strong>é›†æˆå’Œé…ç½®</strong>ï¼šFeign æ›´é€‚åˆä¸ Spring Cloud ç”Ÿæ€ç³»ç»Ÿé›†æˆï¼Œç‰¹åˆ«æ˜¯åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼›RestTemplate æ›´åŠ çµæ´»ï¼Œå¯ç”¨äºä»»ä½• Spring é¡¹ç›®ä¸­ã€‚</li><li><strong>ä»£ç ç®€æ´åº¦</strong>ï¼šFeign æ›´åŠ ç®€æ´ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘ï¼›RestTemplate æä¾›äº†æ›´é«˜çš„çµæ´»æ€§å’Œæ§åˆ¶èƒ½åŠ›ã€‚</li></ol><h3 id="é€‰æ‹©å»ºè®®"><a href="#é€‰æ‹©å»ºè®®" class="headerlink" title="é€‰æ‹©å»ºè®®"></a>é€‰æ‹©å»ºè®®</h3><ul><li>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Spring Cloud å¾®æœåŠ¡æ¶æ„ï¼Œå¹¶ä¸”å¸Œæœ›ç®€åŒ– HTTP å®¢æˆ·ç«¯ä»£ç ï¼Œå»ºè®®ä½¿ç”¨ Feignã€‚</li><li>å¦‚æœä½ éœ€è¦å¯¹ HTTP è¯·æ±‚è¿›è¡Œç»†ç²’åº¦æ§åˆ¶ï¼Œæˆ–è€…ä¸ä¾èµ– Spring Cloud ç”Ÿæ€ç³»ç»Ÿï¼ŒRestTemplate ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Ribbonå’ŒSpring Cloud Loadbalancer</title>
    <link href="/article/c1b21328.html"/>
    <url>/article/c1b21328.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />è½¬è½½äºï¼šhttps://www.modb.pro/db/380587<blockquote><p>2020å¹´ä»¥åéšç€Netflixçš„ç›¸å…³SpringCloudç»„ä»¶è¿›å…¥åœæ›´çŠ¶æ€ï¼ŒCloudå¸æ”¶å‰äººç»éªŒï¼Œè‡ªå·±åˆ›é€ äº†ä¸€å¥—ç›¸å…³ç»„ä»¶ï¼Œä»Šå¤©å°±è·Ÿå¤§å®¶æ­ç§˜ä¸€ä¸‹å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç»„ä»¶Ribbonå’ŒLoadBalancerã€‚</p></blockquote><h1 id="ç°çŠ¶å¤§PK"><a href="#ç°çŠ¶å¤§PK" class="headerlink" title="ç°çŠ¶å¤§PK"></a>ç°çŠ¶å¤§PK</h1><h2 id="Ribbonï¼š"><a href="#Ribbonï¼š" class="headerlink" title="Ribbonï¼š"></a>Ribbonï¼š</h2><blockquote><p>ç›®å‰å¤„äºåœæ›´ç»´æŠ¤é˜¶æ®µï¼Œç”±äºRibbonæ¯”è¾ƒä¼˜ç§€ï¼Œç”Ÿå‘½åŠ›é¡½å¼ºï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒè¿˜å¤„åœ¨å¤§è§„æ¨¡ä½¿ç”¨ä¸­ï¼ŒÂ æš‚æ—¶è¿˜æ²¡æœ‰å®Œå…¨è¢«æ›¿æ¢ï¼Œä½†æ˜¯åœ¨2020å¹´ä»¥åçš„cloudç‰ˆæœ¬ä¸­å·²ç»åˆ é™¤äº†Ribbonçš„ä¾èµ–ã€‚</p></blockquote><h2 id="LoadBalancerï¼š"><a href="#LoadBalancerï¼š" class="headerlink" title="LoadBalancerï¼š"></a>LoadBalancerï¼š</h2><ul><li><p>cloudæ­£åœ¨å¤§è§„æ¨¡å¼•å…¥LoadBalancerï¼Œè¿˜æœªå…¨éƒ¨å é¢†é«˜åœ°ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå†åŠ ä¸Šcloudçš„å¤§åŠ›æ‰¶æŒï¼Œæœªæ¥è¿Ÿæ—©æœ‰ä¸€å¤©LoadBalancerä¼šä¸€ç»Ÿæ±Ÿæ¹–ã€‚</p></li><li><p>è¿˜æ”¯æŒå“åº”å¼å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ï¼ŒSpring Cloud LoadBalancerç»“åˆSpring Web Fluxå®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡è°ƒç”¨ã€‚å³ï¼šWebClientã€‚</p></li></ul><p><img src="https://oss-emcsprod-public.modb.pro/wechatSpider/modb_20220322_c5564100-a9b5-11ec-8d1e-fa163eb4f6be.png"></p><h1 id="Ribbonç®€ä»‹-amp-å®æˆ˜"><a href="#Ribbonç®€ä»‹-amp-å®æˆ˜" class="headerlink" title="Ribbonç®€ä»‹&amp;å®æˆ˜"></a>Ribbonç®€ä»‹&amp;å®æˆ˜</h1><blockquote><p>Ribbonæ˜¯Netflixå‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨ã€‚Ribbonå®¢æˆ·ç«¯ç»„ä»¶æä¾›ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹ï¼Œå¦‚è¿æ¥è¶…æ—¶ï¼Œé‡è¯•ç­‰ã€‚ç®€å•è¯´ï¼Œå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºLoadBalancerï¼ˆç®€ç§°LBï¼‰åé¢æ‰€æœ‰çš„æœºå™¨ï¼ŒRibbonä¼šè‡ªåŠ¨çš„å¸®åŠ©ä½ åŸºäºæŸç§è§„åˆ™ï¼ˆå¦‚è½®è¯¢ï¼Œéšæœºç­‰ï¼‰å»è¿æ¥è¿™äº›æœºå™¨ï¼Œå¾ˆå®¹æ˜“ä½¿ç”¨Ribbonå®ç°è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</p></blockquote><h2 id="LBè´Ÿè½½å‡è¡¡æ˜¯ä»€ä¹ˆ"><a href="#LBè´Ÿè½½å‡è¡¡æ˜¯ä»€ä¹ˆ" class="headerlink" title="LBè´Ÿè½½å‡è¡¡æ˜¯ä»€ä¹ˆ"></a>LBè´Ÿè½½å‡è¡¡æ˜¯ä»€ä¹ˆ</h2><ul><li><p>æˆ‘ç»™å¤§å®¶è®²ä¸€ä¸‹ä»€ä¹ˆæ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ä»æ³¨å†Œä¸­å¿ƒæ‹¿åˆ°æœåŠ¡æä¾›è€…é›†ç¾¤ï¼Œè‡ªå·±å†³å®šä½¿ç”¨ä½•ç§ç®—æ³•æ‰¾åˆ°ç›®æ ‡æœåŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå³ä¸»åŠ¨æƒæŒæ¡åœ¨è‡ªå·±æ‰‹é‡Œ</p></li><li><p>ç›¸å¯¹å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯æ¶ˆè´¹è€…æŠŠè¯·æ±‚äº¤ç»™æœåŠ¡ç«¯ï¼Œç”±æœåŠ¡ç«¯æ¥è´Ÿè´£æ‰¾åˆ°ç›®æ ‡æœåŠ¡æä¾›è€…ï¼Œå³ä¸»åŠ¨æƒæŒæ¡åœ¨è¢«äººæ‰‹é‡Œã€‚</p></li><li><p>æˆ‘çœ‹å¤§å®¶è¿˜æœ‰ä¸€ç§åˆ†ç±»æ–¹å¼ï¼šé›†ä¸­å¼LBå’Œè¿›ç¨‹å†…LBï¼Œéƒ½æ˜¯ä¸€ä¸ªæ„æ€ã€‚</p></li></ul><h2 id="Ribbonå·¥ä½œæµç¨‹"><a href="#Ribbonå·¥ä½œæµç¨‹" class="headerlink" title="Ribbonå·¥ä½œæµç¨‹"></a>Ribbonå·¥ä½œæµç¨‹</h2><ol><li><p>ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åˆ—è¡¨</p></li><li><p>æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥ï¼Œæ‰¾åˆ°ç›®æ ‡æœåŠ¡æä¾›è€…</p></li><li><p>é€šè¿‡Feignæˆ–è€…OpenFeignï¼ŒWebå®¢æˆ·ç«¯è°ƒç”¨å·¥å…·å®Œæˆç”¨æˆ·è¯·æ±‚</p></li></ol><p>Â </p><h2 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡ç­–ç•¥</h2><ul><li><p><strong>RoundRobinRuleï¼š</strong>è½®è¯¢</p></li><li><p><strong>RandomRuleï¼š</strong>éšæœº</p></li><li><p><strong>RetryRuleï¼š</strong>å…ˆæŒ‰ç…§è½®è¯¢ç­–ç•¥è·å–æœåŠ¡ï¼Œå¦‚æœè·å–æœåŠ¡å¤±è´¥åˆ™åœ¨æŒ‡å®šæ—¶é—´å†…è¿›è¡Œé‡è¯•ï¼Œè·å–å¯ç”¨çš„æœåŠ¡</p></li><li><p><strong>WeightedResponseTimeRuleï¼š</strong>å¯¹è½®è¯¢çš„æ‰©å±•ï¼Œå“åº”é€Ÿåº¦è¶Šå¿«çš„å®ä¾‹é€‰æ‹©æƒé‡è¶Šå¤§ï¼Œè¶Šå®¹æ˜“è¢«é€‰æ‹©</p></li><li><p><strong>BestAvailableRuleï¼š</strong>ä¼šå…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„æœåŠ¡</p></li><li><p><strong>AvailabiliyFilteringRuleï¼š</strong>å…ˆè¿‡æ»¤æ‰æ•…éšœå®ä¾‹ï¼Œå†é€‰æ‹©å¹¶å‘è¾ƒå°çš„å®ä¾‹</p></li><li><p><strong>ZoneAvoidanceRuleï¼š</strong>é»˜è®¤è§„åˆ™ï¼Œå¤åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§é€‰æ‹©æœåŠ¡å™¨</p></li></ul><p><img src="https://oss-emcsprod-public.modb.pro/wechatSpider/modb_20220322_c5776ec0-a9b5-11ec-8d1e-fa163eb4f6be.png"></p><h2 id="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</h2><ol><li><h2 id="Ribbonå®˜æ–¹æ˜ç¡®è§„å®šï¼Œè‡ªåŠ¨ä»¥çš„é…ç½®ç±»ï¼Œä¸èƒ½æ”¾åœ¨-ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ï¼Œå¦åˆ™æˆ‘ä»¬å®šä¹‰çš„é…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«ï¼Œè¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„ã€‚"><a href="#Ribbonå®˜æ–¹æ˜ç¡®è§„å®šï¼Œè‡ªåŠ¨ä»¥çš„é…ç½®ç±»ï¼Œä¸èƒ½æ”¾åœ¨-ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ï¼Œå¦åˆ™æˆ‘ä»¬å®šä¹‰çš„é…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«ï¼Œè¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„ã€‚" class="headerlink" title="Ribbonå®˜æ–¹æ˜ç¡®è§„å®šï¼Œè‡ªåŠ¨ä»¥çš„é…ç½®ç±»ï¼Œä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ï¼Œå¦åˆ™æˆ‘ä»¬å®šä¹‰çš„é…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«ï¼Œè¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„ã€‚"></a>Ribbonå®˜æ–¹æ˜ç¡®è§„å®šï¼Œè‡ªåŠ¨ä»¥çš„é…ç½®ç±»ï¼Œä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ï¼Œå¦åˆ™æˆ‘ä»¬å®šä¹‰çš„é…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«ï¼Œè¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„ã€‚</h2></li><li><p>åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦targetIdç›¸åŒï¼Œæ‰€æœ‰è¯·æ±‚åº”è¯¥è½åˆ°åŒä¸€æœåŠ¡ä¸Šã€‚è¿™ä¸ªæ—¶å€™éšæœºå’Œè½®è¯¢éƒ½ä¸æ»¡è¶³ï¼Œæ‰€ä»¥å°±éœ€è¦è‡ªå®šä¹‰ä¸€è‡´æ€§hashç®—æ³•ã€‚</p></li><li><p>åœ¨æŸä¸€ä¸ªæœåŠ¡ä¸­ï¼Œå¦‚æœåªè°ƒç”¨ä¸€ä¸ªæœåŠ¡æä¾›æ–¹ï¼Œå¯ä»¥å†™åœ¨@ComponentScanæ‰€æ‰«æçš„åŒ…åŠå­åŒ…ä¸‹ã€‚å¦‚æœæ˜¯è°ƒç”¨å¤šä¸ªæœåŠ¡æä¾›æ–¹ï¼Œéœ€è¦ä¸åŒçš„ç­–ç•¥ï¼Œä¸”äº’ä¸å¹²æ‰°ã€‚å°±éœ€è¦éµå®ˆç¬¬ä¸€æ¡åŸåˆ™ã€‚</p></li><li><p>ä¸€èˆ¬bootå·¥ç¨‹é»˜è®¤é…ç½®äº†@ComponentScanæ‰€æ‰«æçš„åŒ…æ˜¯å¯åŠ¨ç±»Applicationæ‰€åœ¨åŒ…åŠå­åŒ…ï¼Œæ‰€ä»¥åœ¨æœ‰æ—¶å€™æˆ‘ä»¬ä¸é…ç½®è‡ªåŠ¨æ‰«æä¹Ÿèƒ½æ­£å¸¸è¿è¡Œçš„åŸå› ã€‚</p></li></ol><p><img src="https://oss-emcsprod-public.modb.pro/wechatSpider/modb_20220322_c5a391da-a9b5-11ec-8d1e-fa163eb4f6be.png"></p><ul><li><strong>è‡ªå®šä¹‰é…ç½®ç±»ï¼Œæ¯”å¦‚ä½¿ç”¨éšæœºæ›¿æ¢é»˜è®¤çš„è½®è¯¢</strong></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRule</span>&#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">IRule</span> <span class="hljs-title function_">myRule</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomRule</span>();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åœ¨å¯åŠ¨ç±»ä¸Šä½¿ç”¨@RibbonClientæ³¨è§£ï¼Œè®¾ç½®è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥ä½¿å…¶ç”Ÿæ•ˆï¼Œnameæ˜¯æœåŠ¡åï¼Œå³è°ƒç”¨å“ªä¸ªæœåŠ¡é›†ç¾¤çš„æ—¶å€™ä½¿ç”¨è‡ªå®šä¹‰è§„åˆ™ã€‚</strong></li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootApplication</span><br><span class="hljs-variable">@EnableEurekaClient</span><br><span class="hljs-variable">@RibbonClient</span>(name = <span class="hljs-string">&quot;cloud-payment-service&quot;</span>,configuration=MyRule.class)<br>public class Application8080 &#123;<br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) &#123;<br>        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(Application8080.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="LoadBalancerç®€ä»‹-amp-å®æˆ˜"><a href="#LoadBalancerç®€ä»‹-amp-å®æˆ˜" class="headerlink" title="LoadBalancerç®€ä»‹&amp;å®æˆ˜"></a>LoadBalancerç®€ä»‹&amp;å®æˆ˜</h1><h2 id="LoadBalancerçš„ä¼˜åŠ¿"><a href="#LoadBalancerçš„ä¼˜åŠ¿" class="headerlink" title="LoadBalancerçš„ä¼˜åŠ¿"></a>LoadBalancerçš„ä¼˜åŠ¿</h2><ul><li><p>è·ŸRibbonä¸€æ ·ä¹Ÿæ”¯æŒRestTemplateï¼Œä½¿ç”¨æ–¹æ³•ä¸€æ ·ï¼Œç”±äºcloudçš„å…¶ä»–ç»„ä»¶è¿˜åœ¨ä½¿ç”¨Ribbonï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨LoadBalancerçš„æ—¶å€™è¦å±è”½Ribbonã€‚</p></li><li><p>LoadBalancerè¿˜æ”¯æŒ<strong>å“åº”å¼ç¼–ç¨‹</strong>æ–¹å¼çš„<strong>å¼‚æ­¥è®¿é—®</strong>å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ï¼Œä¾èµ–Spring Web Fluxå®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡è°ƒç”¨ï¼Œåº•å±‚ä¾èµ–Nettyçš„<strong>AIO</strong>ã€‚</p></li></ul><h2 id="å¼•å…¥LoadBalancerä¾èµ–jaråŒ…"><a href="#å¼•å…¥LoadBalancerä¾èµ–jaråŒ…" class="headerlink" title="å¼•å…¥LoadBalancerä¾èµ–jaråŒ…"></a>å¼•å…¥LoadBalancerä¾èµ–jaråŒ…</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶application-ymlå±è”½Ribbonè´Ÿè½½å‡è¡¡"><a href="#é…ç½®æ–‡ä»¶application-ymlå±è”½Ribbonè´Ÿè½½å‡è¡¡" class="headerlink" title="é…ç½®æ–‡ä»¶application.ymlå±è”½Ribbonè´Ÿè½½å‡è¡¡"></a>é…ç½®æ–‡ä»¶application.ymlå±è”½Ribbonè´Ÿè½½å‡è¡¡</h2><blockquote><p>åœ¨Ribbonå’ŒLoadBalancerä¾èµ–éƒ½å¼•å…¥çš„æƒ…å†µï¼Œcloudé»˜è®¤ä¼˜å…ˆå¯ç”¨Ribbonï¼Œå½“æˆ‘ä»¬æƒ³ä½¿ç”¨LoadBalancerçš„æ—¶å€™å°±è¦å…ˆå±è”½åˆ°Ribbon</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">loadbalancer:</span><br>      <span class="hljs-attr">ribbon:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h2 id="ä¸šåŠ¡ç±»å’Œå¯åŠ¨ç±»éƒ½æ²¡æœ‰åŒºåˆ«ï¼Œè¿˜æ˜¯ä½¿ç”¨RestTemplateä½œä¸ºå®¢æˆ·ç«¯æ¥å®ŒæˆæœåŠ¡è°ƒç”¨ï¼Œæ­¤æ–¹å¼è·ŸRibbonåœ¨ç¼–ç æ–¹é¢æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚æ˜¯Ribbonè¿˜æ˜¯LoadBalancerï¼Œä¸»è¦ä½“ç°åœ¨jaråŒ…å¼•å…¥å’Œymlæ–‡ä»¶å…³é—­é»˜è®¤Ribbonã€‚"><a href="#ä¸šåŠ¡ç±»å’Œå¯åŠ¨ç±»éƒ½æ²¡æœ‰åŒºåˆ«ï¼Œè¿˜æ˜¯ä½¿ç”¨RestTemplateä½œä¸ºå®¢æˆ·ç«¯æ¥å®ŒæˆæœåŠ¡è°ƒç”¨ï¼Œæ­¤æ–¹å¼è·ŸRibbonåœ¨ç¼–ç æ–¹é¢æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚æ˜¯Ribbonè¿˜æ˜¯LoadBalancerï¼Œä¸»è¦ä½“ç°åœ¨jaråŒ…å¼•å…¥å’Œymlæ–‡ä»¶å…³é—­é»˜è®¤Ribbonã€‚" class="headerlink" title="ä¸šåŠ¡ç±»å’Œå¯åŠ¨ç±»éƒ½æ²¡æœ‰åŒºåˆ«ï¼Œè¿˜æ˜¯ä½¿ç”¨RestTemplateä½œä¸ºå®¢æˆ·ç«¯æ¥å®ŒæˆæœåŠ¡è°ƒç”¨ï¼Œæ­¤æ–¹å¼è·ŸRibbonåœ¨ç¼–ç æ–¹é¢æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚æ˜¯Ribbonè¿˜æ˜¯LoadBalancerï¼Œä¸»è¦ä½“ç°åœ¨jaråŒ…å¼•å…¥å’Œymlæ–‡ä»¶å…³é—­é»˜è®¤Ribbonã€‚"></a>ä¸šåŠ¡ç±»å’Œå¯åŠ¨ç±»éƒ½æ²¡æœ‰åŒºåˆ«ï¼Œè¿˜æ˜¯ä½¿ç”¨RestTemplateä½œä¸ºå®¢æˆ·ç«¯æ¥å®ŒæˆæœåŠ¡è°ƒç”¨ï¼Œæ­¤æ–¹å¼è·ŸRibbonåœ¨ç¼–ç æ–¹é¢æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚æ˜¯Ribbonè¿˜æ˜¯LoadBalancerï¼Œä¸»è¦ä½“ç°åœ¨jaråŒ…å¼•å…¥å’Œymlæ–‡ä»¶å…³é—­é»˜è®¤Ribbonã€‚</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//é…ç½®RestTemplate</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@LoadBalanced</span><br>    <span class="hljs-keyword">public</span> RestTemplate getRestTemplate()&#123;<br>        <span class="hljs-keyword">return</span> new RestTemplate();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-comment">//controlleréƒ¨åˆ†</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(<span class="hljs-string">&quot;/consumer&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerCtrol</span> &#123;<br>    <span class="hljs-keyword">private</span> static String PAYMENTURL = <span class="hljs-string">&quot;http://CLOUD-PAYMENT-SERVICE&quot;</span>;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/getPayment/&#123;id&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> MsgResponseBody getPaymet(<span class="hljs-meta">@PathVariable(<span class="hljs-string">&quot;id&quot;</span>)</span> <span class="hljs-built_in">Long</span> id)&#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;adada&quot;</span>);<br>        <span class="hljs-keyword">return</span> restTemplate.getForObject(PAYMENTURL+<span class="hljs-string">&quot;/payment/getPayment/&quot;</span>+id+<span class="hljs-string">&quot;?userName=123&quot;</span>, MsgResponseBody.<span class="hljs-keyword">class</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="WebClientæ–¹å¼å‘èµ·æœåŠ¡è°ƒç”¨"><a href="#WebClientæ–¹å¼å‘èµ·æœåŠ¡è°ƒç”¨" class="headerlink" title="WebClientæ–¹å¼å‘èµ·æœåŠ¡è°ƒç”¨"></a>WebClientæ–¹å¼å‘èµ·æœåŠ¡è°ƒç”¨</h2><h3 id="å¼•å…¥webfluxçš„ç›¸å…³ä¾èµ–"><a href="#å¼•å…¥webfluxçš„ç›¸å…³ä¾èµ–" class="headerlink" title="å¼•å…¥webfluxçš„ç›¸å…³ä¾èµ–"></a>å¼•å…¥webfluxçš„ç›¸å…³ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>     <span class="hljs-comment">&lt;!-- Spring Webfluxå“åº”å¼webç¼–ç¨‹--&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="é…ç½®ç±»ä¸­å£°æ˜è¦æ³¨å…¥çš„WebClient-Builderï¼Œæ˜¯WebClientçš„å†…éƒ¨ç±»ï¼Œä¹Ÿæ˜¯ç¼–ç¨‹çš„å…¥å£"><a href="#é…ç½®ç±»ä¸­å£°æ˜è¦æ³¨å…¥çš„WebClient-Builderï¼Œæ˜¯WebClientçš„å†…éƒ¨ç±»ï¼Œä¹Ÿæ˜¯ç¼–ç¨‹çš„å…¥å£" class="headerlink" title="é…ç½®ç±»ä¸­å£°æ˜è¦æ³¨å…¥çš„WebClient.Builderï¼Œæ˜¯WebClientçš„å†…éƒ¨ç±»ï¼Œä¹Ÿæ˜¯ç¼–ç¨‹çš„å…¥å£"></a>é…ç½®ç±»ä¸­å£°æ˜è¦æ³¨å…¥çš„WebClient.Builderï¼Œæ˜¯WebClientçš„å†…éƒ¨ç±»ï¼Œä¹Ÿæ˜¯ç¼–ç¨‹çš„å…¥å£</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//é…ç½®RestTemplate</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationConfig</span> &#123;<br> <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@LoadBalanced</span><br>    <span class="hljs-keyword">public</span> RestTemplate getRestTemplate()&#123;<br>        <span class="hljs-keyword">return</span> new RestTemplate();<br>    &#125;<br> <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@LoadBalanced</span><br>    <span class="hljs-keyword">public</span> WebClient.Builder builder() &#123;<br>        <span class="hljs-keyword">return</span> WebClient.builder();<br>    &#125;<br> <br>&#125;<br> <br><span class="hljs-comment">//controlleréƒ¨åˆ†</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(<span class="hljs-string">&quot;/consumer&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerCtrol</span> &#123;<br>    <span class="hljs-keyword">private</span> static String PAYMENTURL = <span class="hljs-string">&quot;http://CLOUD-PAYMENT-SERVICE&quot;</span>;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br> <br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/getPayment/&#123;id&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> MsgResponseBody getPaymet(<span class="hljs-meta">@PathVariable(<span class="hljs-string">&quot;id&quot;</span>)</span> <span class="hljs-built_in">Long</span> id)&#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;adada&quot;</span>);<br>        <span class="hljs-keyword">return</span> restTemplate.getForObject(PAYMENTURL+<span class="hljs-string">&quot;/payment/getPayment/&quot;</span>+id+<span class="hljs-string">&quot;?userName=123&quot;</span>, MsgResponseBody.<span class="hljs-keyword">class</span>);<br>    &#125;<br> <br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/getPayment/webClient/&#123;id&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;MsgResponseBody&gt; getPaymetByWebClient(<span class="hljs-meta">@PathVariable(<span class="hljs-string">&quot;id&quot;</span>)</span> <span class="hljs-built_in">Long</span> id) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;bbbbbbb&quot;</span>);<br>        <span class="hljs-comment">//return restTemplate.getForObject(PAYMENTURL + &quot;/payment/getPayment/&quot; + id + &quot;?userName=123&quot;, MsgResponseBody.class);</span><br>        <span class="hljs-keyword">return</span> clientBuilder.baseUrl(PAYMENTURL).build().<span class="hljs-keyword">get</span>().uri(<span class="hljs-string">&quot;/payment/getPayment/&quot;</span> + id + <span class="hljs-string">&quot;?userName=123&quot;</span>).retrieve().bodyToMono(MsgResponseBody.<span class="hljs-keyword">class</span>);<br>    &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é»˜è®¤è·ŸRibbonæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯è½®è¯¢ç­–ç•¥ï¼Œè‡ªå®šä¹‰é…ç½®ä½¿ç”¨çš„æ˜¯-LoadBalancerClientï¼Œç”¨æ³•è·ŸRibbonçš„-RibbonClientä¸€æ ·ã€‚"><a href="#é»˜è®¤è·ŸRibbonæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯è½®è¯¢ç­–ç•¥ï¼Œè‡ªå®šä¹‰é…ç½®ä½¿ç”¨çš„æ˜¯-LoadBalancerClientï¼Œç”¨æ³•è·ŸRibbonçš„-RibbonClientä¸€æ ·ã€‚" class="headerlink" title="é»˜è®¤è·ŸRibbonæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯è½®è¯¢ç­–ç•¥ï¼Œè‡ªå®šä¹‰é…ç½®ä½¿ç”¨çš„æ˜¯@LoadBalancerClientï¼Œç”¨æ³•è·ŸRibbonçš„@RibbonClientä¸€æ ·ã€‚"></a>é»˜è®¤è·ŸRibbonæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯è½®è¯¢ç­–ç•¥ï¼Œè‡ªå®šä¹‰é…ç½®ä½¿ç”¨çš„æ˜¯@LoadBalancerClientï¼Œç”¨æ³•è·ŸRibbonçš„@RibbonClientä¸€æ ·ã€‚</h3><p><img src="https://oss-emcsprod-public.modb.pro/wechatSpider/modb_20220322_c5d008aa-a9b5-11ec-8d1e-fa163eb4f6be.png"></p><p>åœ¨Springcloud alibabaçš„2.2.6ç‰ˆæœ¬å¯¹åº”çš„Spring-cloudç‰ˆæœ¬æ˜¯Hoxton.SR9ï¼Œè€Œspring-cloud-loadbalancer2.2.6ç‰ˆæœ¬è´Ÿè½½å‡è¡¡ç­–ç•¥ä»…æ”¯æŒè½®è¯¢ç­–ç•¥ã€‚</p><p><img src="https://oss-emcsprod-public.modb.pro/wechatSpider/modb_20220322_c5fc852e-a9b5-11ec-8d1e-fa163eb4f6be.png"></p><h3 id="Hoxton-SR10ç‰ˆæœ¬ä»¥åå¢åŠ äº†éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#Hoxton-SR10ç‰ˆæœ¬ä»¥åå¢åŠ äº†éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="Hoxton.SR10ç‰ˆæœ¬ä»¥åå¢åŠ äº†éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥"></a>Hoxton.SR10ç‰ˆæœ¬ä»¥åå¢åŠ äº†éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥</h3><p><img src="https://oss-emcsprod-public.modb.pro/wechatSpider/modb_20220322_c61d6b68-a9b5-11ec-8d1e-fa163eb4f6be.png">  </p><h3 id="åˆ‡æ¢éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ–°å»ºä¸¤ä¸ªModuleåˆ†åˆ«ç»‘å®š8004å’Œ8005ç«¯å£ï¼ŒæœåŠ¡åæ˜¯CLOUD-PAYMENT-SERVICE1ï¼Œä½¿ç”¨è½®è¯¢ç­–ç•¥ï¼Œä¸Šé¢è¯´äº†ï¼ŒMyLoadBalancerRandomConfigè¦æ”¾åœ¨-ComponentScanä¸èƒ½æ‰«æåˆ°çš„packageä¸­ã€‚"><a href="#åˆ‡æ¢éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ–°å»ºä¸¤ä¸ªModuleåˆ†åˆ«ç»‘å®š8004å’Œ8005ç«¯å£ï¼ŒæœåŠ¡åæ˜¯CLOUD-PAYMENT-SERVICE1ï¼Œä½¿ç”¨è½®è¯¢ç­–ç•¥ï¼Œä¸Šé¢è¯´äº†ï¼ŒMyLoadBalancerRandomConfigè¦æ”¾åœ¨-ComponentScanä¸èƒ½æ‰«æåˆ°çš„packageä¸­ã€‚" class="headerlink" title="åˆ‡æ¢éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ–°å»ºä¸¤ä¸ªModuleåˆ†åˆ«ç»‘å®š8004å’Œ8005ç«¯å£ï¼ŒæœåŠ¡åæ˜¯CLOUD-PAYMENT-SERVICE1ï¼Œä½¿ç”¨è½®è¯¢ç­–ç•¥ï¼Œä¸Šé¢è¯´äº†ï¼ŒMyLoadBalancerRandomConfigè¦æ”¾åœ¨@ComponentScanä¸èƒ½æ‰«æåˆ°çš„packageä¸­ã€‚"></a>åˆ‡æ¢éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ–°å»ºä¸¤ä¸ªModuleåˆ†åˆ«ç»‘å®š8004å’Œ8005ç«¯å£ï¼ŒæœåŠ¡åæ˜¯CLOUD-PAYMENT-SERVICE1ï¼Œä½¿ç”¨è½®è¯¢ç­–ç•¥ï¼Œä¸Šé¢è¯´äº†ï¼ŒMyLoadBalancerRandomConfigè¦æ”¾åœ¨@ComponentScanä¸èƒ½æ‰«æåˆ°çš„packageä¸­ã€‚</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">@<span class="hljs-keyword">Configuration</span><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> MyLoadBalancerRandomConfig &#123;<br> <br>    @Bean<br>    <span class="hljs-built_in">public</span> ReactorLoadBalancer&lt;ServiceInstance&gt; reactorServiceInstanceLoadBalancer(Environment environment,<br>                                                                                   LoadBalancerClientFactory loadBalancerClientFactory) &#123;<br>        String <span class="hljs-type">name</span> = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span> RandomLoadBalancer(<br>                loadBalancerClientFactory.getLazyProvider(<span class="hljs-type">name</span>, ServiceInstanceListSupplier.<span class="hljs-keyword">class</span>), <span class="hljs-type">name</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¯åŠ¨ç±»é…ç½®-LoadBalancerClientï¼Œé…ç½®åŸæ¥çš„8001å’Œ8002ï¼ŒCLOUD-PAYMENT-SERVICEæœåŠ¡ä½¿ç”¨éšæœºç­–ç•¥"><a href="#å¯åŠ¨ç±»é…ç½®-LoadBalancerClientï¼Œé…ç½®åŸæ¥çš„8001å’Œ8002ï¼ŒCLOUD-PAYMENT-SERVICEæœåŠ¡ä½¿ç”¨éšæœºç­–ç•¥" class="headerlink" title="å¯åŠ¨ç±»é…ç½®@LoadBalancerClientï¼Œé…ç½®åŸæ¥çš„8001å’Œ8002ï¼ŒCLOUD-PAYMENT-SERVICEæœåŠ¡ä½¿ç”¨éšæœºç­–ç•¥"></a>å¯åŠ¨ç±»é…ç½®@LoadBalancerClientï¼Œé…ç½®åŸæ¥çš„8001å’Œ8002ï¼ŒCLOUD-PAYMENT-SERVICEæœåŠ¡ä½¿ç”¨éšæœºç­–ç•¥</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootApplication</span><br><span class="hljs-variable">@EnableEurekaClient</span><br><span class="hljs-variable">@LoadBalancerClient</span>(value = <span class="hljs-string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>, configuration = MyLoadBalancerRandomConfig.class)<br>public class Application6060 &#123;<br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) &#123;<br>        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(Application6060.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="controllerç±»çš„ä¿®æ”¹ï¼ŒgetPaymentå¯¹åº”è½®è¯¢ï¼ŒgetPaymentWebClientå¯¹åº”éšæœº"><a href="#controllerç±»çš„ä¿®æ”¹ï¼ŒgetPaymentå¯¹åº”è½®è¯¢ï¼ŒgetPaymentWebClientå¯¹åº”éšæœº" class="headerlink" title="controllerç±»çš„ä¿®æ”¹ï¼ŒgetPaymentå¯¹åº”è½®è¯¢ï¼ŒgetPaymentWebClientå¯¹åº”éšæœº"></a>controllerç±»çš„ä¿®æ”¹ï¼ŒgetPaymentå¯¹åº”è½®è¯¢ï¼ŒgetPaymentWebClientå¯¹åº”éšæœº</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(<span class="hljs-string">&quot;/consumer&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerCtrol</span> &#123;<br>    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> String PAYMENTURL = <span class="hljs-string">&quot;https://CLOUD-PAYMENT-SERVICE&quot;</span>;<span class="hljs-comment">//éšæœº</span><br>    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> String PAYMENTURL2 = <span class="hljs-string">&quot;https://CLOUD-PAYMENT-SERVICE1&quot;</span>;<span class="hljs-comment">//è½®è¯¢</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> WebClient.Builder clientBuilder;<br> <br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/getPayment/&#123;id&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> MsgResponseBody getPaymet(<span class="hljs-meta">@PathVariable(<span class="hljs-string">&quot;id&quot;</span>)</span> <span class="hljs-built_in">Long</span> id) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;adada&quot;</span>);<br>        <span class="hljs-keyword">return</span> restTemplate.getForObject(PAYMENTURL2 + <span class="hljs-string">&quot;/payment/getPayment/&quot;</span> + id + <span class="hljs-string">&quot;?userName=123&quot;</span>, MsgResponseBody.<span class="hljs-keyword">class</span>);<br>    &#125;<br> <br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/getPayment/webClient/&#123;id&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;MsgResponseBody&gt; getPaymetByWebClient(<span class="hljs-meta">@PathVariable(<span class="hljs-string">&quot;id&quot;</span>)</span> <span class="hljs-built_in">Long</span> id) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;bbbbbbb&quot;</span>);<br>        <span class="hljs-comment">//return restTemplate.getForObject(PAYMENTURL + &quot;/payment/getPayment/&quot; + id + &quot;?userName=123&quot;, MsgResponseBody.class);</span><br>        <span class="hljs-keyword">return</span> clientBuilder.baseUrl(PAYMENTURL).build().<span class="hljs-keyword">get</span>().uri(<span class="hljs-string">&quot;/payment/getPayment/&quot;</span> + id + <span class="hljs-string">&quot;?userName=123&quot;</span>).retrieve().bodyToMono(MsgResponseBody.<span class="hljs-keyword">class</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>armbian å®šæ—¶ä»»åŠ¡</title>
    <link href="/article/74ef2116.html"/>
    <url>/article/74ef2116.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />äº”ä¸ª\*åˆ†åˆ«å¯¹åº” åˆ† æ—¶ æ—¥ æœˆ å‘¨<p>Â  Â  &#x2F;1æ˜¯æ¯1å°æ—¶å¯¹æ—¶1æ¬¡</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">sudo crontab -e<span class="hljs-emphasis">* *</span>/1 <span class="hljs-emphasis">* *</span> <span class="hljs-emphasis">* ntpdate ntp1.aliyun.com</span><br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/blog_migrate/a068b0b3cfe9d959ce0ce7e91d012dab.png"><a href="https://so.csdn.net/so/search?q=crontab&spm=1001.2101.3001.7020">crontab</a> -l</p><p>æŸ¥çœ‹<a href="https://so.csdn.net/so/search?q=%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1&spm=1001.2101.3001.7020">å®šæ—¶ä»»åŠ¡</a></p><p>systemctl <a href="https://so.csdn.net/so/search?q=enable&spm=1001.2101.3001.7020">enable</a> cron â€“now</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxè®¾ç½®httpä»£ç†</title>
    <link href="/article/117f87cd.html"/>
    <url>/article/117f87cd.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />æœåŠ¡å™¨æœ‰æ—¶ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæ˜¯ä¸å…è®¸å…¨ç½‘è”é€šï¼Œè¿™æ—¶éœ€è¦ä¸€ä¸ªç½‘ç»œä»£ç†è¿›è¡Œè®¿é—®ï¼Œæœ€è¿‘æˆ‘åœ¨éƒ¨ç½²ç¯å¢ƒæ—¶ï¼ŒæœåŠ¡å™¨åªèƒ½å†…ç½‘é—´è®¿é—®ï¼Œå¦‚æœæƒ³ä½¿ç”¨yumï¼Œ[wget](https://so.csdn.net/so/search?q=wget&spm=1001.2101.3001.7020)éƒ½ä¸è¡Œï¼Œååˆ†è‹¦æ¼ï¼Œåæ¥è¿ç»´æä¾›äº†ä¸€ä¸ªä»£ç†è§£å†³äº†è¯¥é—®é¢˜ã€‚è¿™é‡Œåˆ†ä¸ºä¸¤ç§æƒ…å†µè®¨è®ºï¼š<p><strong>ä¸´æ—¶ä½¿ç”¨</strong><br>åªæ˜¯ä¸´æ—¶ä½¿ç”¨ä¸€ä¸‹ï¼Œå®‰è£…ä¸€ä¸ªè½¯ä»¶ï¼Œåªéœ€è¿™æ ·</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">env http_proxy=http:<span class="hljs-regexp">//</span><span class="hljs-number">172.30</span>.<span class="hljs-number">1.145</span>:<span class="hljs-number">3128</span> Â https_proxy=http:<span class="hljs-regexp">//</span><span class="hljs-number">172.30</span>.<span class="hljs-number">1.145</span>:<span class="hljs-number">3128</span> Â  wget or yum<br></code></pre></td></tr></table></figure><p><strong>æ°¸ä¹…ä½¿ç”¨</strong><br>åœ¨&#x2F;etc&#x2F;profileæœ€ååŠ å…¥</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">export=http_proxy=http:<span class="hljs-regexp">//</span><span class="hljs-number">172.30</span>.<span class="hljs-number">1.145</span>:<span class="hljs-number">3128</span> Â https_proxy=http:<span class="hljs-regexp">//</span><span class="hljs-number">172.30</span>.<span class="hljs-number">1.145</span>:<span class="hljs-number">3128</span><span class="hljs-comment">#source ç”Ÿæ•ˆç¯å¢ƒå˜é‡#source /etc/profile</span><br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼šä¸ºä»€ä¹ˆè¯´æ˜¯httpä»£ç†ï¼Œå…¶å®è¿™ä¸ªè¿˜ä¸èƒ½è¯´æ˜¯å…¨ç§°èµ°ä»£ç†ï¼Œç½ªåå†™çš„åŒºåˆ«å°±æ˜¯ICMPåè®®è¿™ä¸ªè®¾ç½®å°±æ— æ•ˆï¼Œåªèƒ½è¯´æ˜¯90%çš„åº”ç”¨éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªè®¾ç½®æ¥å®ç°ä»£ç†è®¿é—®ï¼Œåªæœ‰ä¸ªåˆ«ä¸è¡Œï¼Œæ¯”å¦‚ä¸€äº›è½¯ä»¶æ ¹æœ¬ä¸èµ°httpåè®®çš„ï¼Œé‚£ä¹ˆæ­¤ç§æ–¹æ³•ç»å¯¹ä¸è¡Œï¼›ä¸‹é¢æ˜¯è®²è§£httpçš„ä»£ç†é…ç½®ï¼Œä»¥åä¼šè®²è§£å…¨å±€çº§åˆ«çš„ä»£ç†å®ç°ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ç½‘å…³ï¼Œé…ç½®ç½‘å…³ç»å¯¹èƒ½100%ï¼Œè¿™é‡Œä¸åšè®²è§£ã€‚å…¨å±€ä»£ç†é…ç½®ä¸»è¦åœ¨äºç¯å¢ƒå˜é‡çš„è®¾ç½®ã€‚</p><p>è¿˜æœ‰ç½‘ä¸Šå¾ˆå¤šéƒ½è¯´httpé…ç½®ä»£ç†ä¸æ”¯æŒsocksåè®®ï¼Œå…¶å®æ˜¯ä¸å¯¹çš„ã€‚æˆ‘æµ‹è¯•çš„ç»“æœå·²ç»æ”¯æŒäº†ã€‚</p><p>ä¸ªäººç†è§£ï¼šæˆ‘è°ˆä¸€ä¸‹è¿™ä¸ªhttp_proxyçš„è®¾ç½®ï¼Œé¦–å…ˆï¼Œè®¾ç½®äº†è¿™ä¸ªå˜é‡ä¸æ˜¯è¯´åªä¼šèµ°httpåè®®ï¼Œä¸Šé¢æˆ‘è¯´çš„åº”è¯¥æ˜¯æ™®é€šè®¤ä¸ºä¼šè¿™æ ·è¯´çš„è¯´æ³•ï¼Œæˆ‘åé¢è§‰å¾—ä¸Šé¢å·²ç»æ˜¯é”™è¯¯äº†ï¼Œæ¯”å¦‚curlï¼Œgitè¿™äº›è½¯ä»¶é»˜è®¤ä½¿ç”¨http_proxyè¿™ä¸ªç¯å¢ƒå˜é‡æ¥è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼Œæ‰€ä»¥åœ¨linuxä¸‹åªè¦è®¾ç½®äº†è¿™ä¸ªç¯å¢ƒå˜é‡å°±èƒ½è¢«è¿™äº›è½¯ä»¶è¯†åˆ«ï¼Œè€Œå¯¹äºä»£ç†æœåŠ¡å™¨ç”¨ä»€ä¹ˆåè®®éƒ½è¡Œï¼Œæ¯”å¦‚ä½¿ç”¨httpåè®®æˆ–è€…socksåè®®ç­‰ã€‚</p><p>é‚£ä¹ˆå¯¹äºä¸€äº›æ¯”å¦‚chromeå’Œyumè¿™äº›é’ˆå¯¹http_proxyå¯èƒ½ä¸ä¼šç”Ÿæ•ˆï¼Œæ¯”å¦‚chromeç”¨çš„æ˜¯server_proxyè¿™ä¸ªå˜é‡ï¼Œè€Œä¸”æ˜¯åœ¨å¯åŠ¨æ—¶è®¾ç½®æ‰ç”Ÿæ•ˆã€‚</p><p>ä¸‹é¢æ˜¯ä»£ç†å˜é‡çš„é…ç½®ï¼š</p><table><thead><tr><th>ç¯å¢ƒå˜é‡</th><th>æè¿°</th><th>å€¼ç¤ºä¾‹</th></tr></thead><tbody><tr><td>http_proxy</td><td>ä¸ºhttpå˜é‡è®¾ç½®ä»£ç†ï¼›é»˜è®¤ä¸å¡«å¼€å¤´ä»¥httpåè®®ä¼ è¾“</td><td>10.0.0.51:8080</td></tr><tr><td>https_proxy</td><td>ä¸ºhttpså˜é‡è®¾ç½®ä»£ç†ï¼›</td><td>åŒä¸Š</td></tr><tr><td>ftp_proxy</td><td>ä¸ºftpå˜é‡è®¾ç½®ä»£ç†ï¼›</td><td>åŒä¸Š</td></tr><tr><td>all_proxy</td><td>å…¨éƒ¨å˜é‡è®¾ç½®ä»£ç†ï¼Œè®¾ç½®äº†è¿™ä¸ªæ—¶å€™ä¸Šé¢çš„ä¸ç”¨è®¾ç½®</td><td>åŒä¸Š</td></tr><tr><td>no_proxy</td><td>æ— éœ€ä»£ç†çš„ä¸»æœºæˆ–åŸŸåï¼›</td><td></td></tr><tr><td>å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼›</td><td></td><td></td></tr><tr><td>å¤šä¸ªæ—¶ä½¿ç”¨â€œ,â€å·åˆ†éš”ï¼›</td><td>*.aiezu.com,10.*.*.*,192.168.*.*,</td><td></td></tr><tr><td>*.local,localhost,127.0.0.1</td><td></td><td></td></tr></tbody></table><p>é’ˆå¯¹ä¸Šé¢å˜é‡çš„è®¾ç½®æ–¹æ³•ï¼š</p><p>1ã€åœ¨&#x2F;etc&#x2F;profileæ–‡ä»¶</p><p>2ã€åœ¨~&#x2F;.bashrc</p><p>3ã€åœ¨~&#x2F;.zshrc</p><p>4ã€åœ¨&#x2F;etc&#x2F;profile.d&#x2F;æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶xxx.sh</p><p>å†™å…¥å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">proxy</span>=<span class="hljs-string">&quot;http://192.168.5.14:8118&quot;</span>export <span class="hljs-attribute">http_proxy</span>=<span class="hljs-variable">$proxyexport</span> <span class="hljs-attribute">https_proxy</span>=<span class="hljs-variable">$proxyexport</span> <span class="hljs-attribute">ftp_proxy</span>=<span class="hljs-variable">$proxyexport</span> <span class="hljs-attribute">no_proxy</span>=<span class="hljs-string">&quot;localhost, 127.0.0.1, ::1&quot;</span><br></code></pre></td></tr></table></figure><p>è€Œå¯¹äºè¦å–æ¶ˆè®¾ç½®å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å–æ¶ˆç¯å¢ƒå˜é‡çš„è®¾ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">unset</span> http_proxyunset https_proxyunset ftp_proxyunset no_proxy<br></code></pre></td></tr></table></figure><p>é’ˆå¯¹yumé…ç½®èµ°ä»£ç†ï¼š</p><p>ç»è¿‡æµ‹è¯•å…¶å®åªè¦è®¾ç½®ä¸Šé¢çš„å˜é‡ä¹‹åå·²ç»å¯ä»¥èµ°ä»£ç†äº†ï¼Œä½†å¦‚æœè¦å•ç‹¬è®¾ç½®ï¼Œå¯ä»¥è®¾ç½®å¦‚ä¸‹æ–‡ä»¶çš„å˜é‡ï¼š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">echo <span class="hljs-string">&quot;proxy=http://127.0.0.1:8080/&quot;</span> &gt;&gt; <span class="hljs-regexp">/etc/yum</span>.conf<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>maven æ¨é€snashortsåŒ…</title>
    <link href="/article/f48fc22b.html"/>
    <url>/article/f48fc22b.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><p>mvn deploy:deploy-file -DgroupId&#x3D;com.baidu.test -DartifactId&#x3D;hello-service-interface -Dversion&#x3D;1.0.0-SNAPSHOT -Dpackaging&#x3D;jar -Dfile&#x3D;C:\maven\apache-maven-3\repository\com\baidu\test\hello-service-interface\1.0.0-SNAPSHOT\hello-service-interface-1.0.0.jar -Durl&#x3D;<a href="https://test.nexus.com/repository/maven-snapshots">https://test.nexus.com/repository/maven-snapshots</a> -DrepositoryId&#x3D;nexus</p><p>å‰æ<br>æœ¬åœ°mavençš„settings.xmlå·²é…ç½®å¥½ç§æœåœ°å€ã€‚<br>æ³¨æ„serviceçš„idã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>maven</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redis6èŠ‚ç‚¹é›†ç¾¤downçš„æƒ…å†µ</title>
    <link href="/article/788c592a.html"/>
    <url>/article/788c592a.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><p>1.äº’ä¸ºä¸»ä»çš„ä¸¤ä¸ªèŠ‚ç‚¹æŒ‚æ‰ã€‚<br>2.åŠæ•°ä¸»èŠ‚ç‚¹åŒæ—¶æŒ‚æ‰</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redisä¸»ä»åˆ‡æ¢æ—¶é—´é…ç½®</title>
    <link href="/article/b2be028d.html"/>
    <url>/article/b2be028d.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />## redisé›†ç¾¤ä¸»ä»èŠ‚ç‚¹è‡ªåŠ¨åˆ‡æ¢<p>æœ€è¿‘åœ¨å°†redisä½œä¸ºæ•°æ®åº“ä½¿ç”¨ï¼ˆredisä¸­å­˜æ”¾å¤§é‡æ•°æ®ï¼‰çš„é¡¹ç›®ä¸­ï¼Œå¶ç„¶å‘ç°redisçš„ä¸»ä»èŠ‚ç‚¹å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯æ²¡æœ‰ä»»åŠ¡æŠ¥é”™ï¼Œredisé›†ç¾¤çš„å„èŠ‚ç‚¹ä¹Ÿæ²¡æœ‰failçŠ¶æ€ï¼Œå› æ­¤è®°å½•å­¦ä¹ ä¸€ä¸‹ï¼Œredisçš„æ·±å±‚æœºåˆ¶ã€‚</p><h3 id="ä¸ºä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h3><p>é¦–å…ˆredisæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€æœ‰çš„å‘½ä»¤å‘é€çš„redisä¼šè¿›å…¥ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¾æ¬¡æ‰§è¡Œã€‚</p><p>å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œæ‰§è¡Œflushallã€keysã€scanç­‰è€—æ—¶è¾ƒé•¿çš„å‘½ä»¤æ—¶ï¼Œå°±ä¼šç…§æˆredisèŠ‚ç‚¹é˜»å¡ã€‚</p><p>å…¶æ¬¡ï¼Œäº†è§£ä¸€ä¸‹redisçš„é›†ç¾¤èŠ‚ç‚¹æ£€æµ‹æœºåˆ¶ã€‚redisé›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ï¼Œæ¯éš”ä¸€æ–­æ—¶é—´ï¼Œå°±ä¼šå‘é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹å‘é€pingåŒ…ï¼Œä»¥æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦è¿˜æ´»ç€ã€‚</p><p>å¦‚æœæ­¤æ—¶ï¼ŒæŸä¸ªä¸»èŠ‚ç‚¹é˜»å¡äº†ï¼Œæ”¶åˆ°pongåŒ…çš„æ—¶é—´è¶…æ—¶ï¼Œå¤§äº cluster-node-timeoutï¼Œå°±ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸»ä»èŠ‚ç‚¹ã€‚</p><p>æ­¤æ—¶ï¼Œåœ¨redis-cliä¸­æŸ¥çœ‹cluster nodesï¼Œä¼šå‘ç°èŠ‚ç‚¹ä¼šçŸ­æš‚çš„å‡ºç°failçŠ¶æ€ã€‚</p><p>å½“ä¸»ä»èŠ‚ç‚¹åˆ‡æ¢å®Œæ¯•ï¼Œredisåˆä¼šé‡æ–°æ‰«æä¸€ä¸‹é›†ç¾¤ä¸­çš„æ‰€æœ‰redisèŠ‚ç‚¹ï¼Œå½“é˜»å¡çš„redisèŠ‚ç‚¹ï¼Œæ‰§è¡Œå®Œä¹‹åï¼Œåˆä¼šé‡æ–°å›åˆ°æ­£å¸¸çŠ¶æ€ã€‚</p><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p>äº†è§£äº†ä¸Šé¢è¯´çš„redisæœºåˆ¶ä¹‹åï¼Œå¦‚æœæƒ³è¦é¿å…redisèŠ‚ç‚¹è‡ªåŠ¨åˆ‡æ¢å°±å¾ˆç®€å•äº†ï¼Œåªéœ€è¦è°ƒå¤§redis.confä¸­çš„é…ç½®é¡¹cluster-node-timeoutï¼ˆé»˜è®¤15000 millisecï¼‰å³å¯ã€‚</p><h2 id="Redisçš„ä¸»ä»å¤åˆ¶"><a href="#Redisçš„ä¸»ä»å¤åˆ¶" class="headerlink" title="Redisçš„ä¸»ä»å¤åˆ¶"></a>Redisçš„ä¸»ä»å¤åˆ¶</h2><h3 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h3><p>ä¸»æœºæ•°æ®æ›´æ–°åæ ¹æ®é…ç½®å’Œç­–ç•¥ï¼Œè‡ªåŠ¨åŒæ­¥åˆ°ä»æœºçš„master&#x2F;slaveæœºåˆ¶ï¼ŒMasterä»¥å†™ä¸ºä¸»ï¼ŒSlaveä»¥è¯»ä¸ºä¸»ã€‚</p><h3 id="ä¸€ä¸»äºŒä»"><a href="#ä¸€ä¸»äºŒä»" class="headerlink" title="ä¸€ä¸»äºŒä»"></a>ä¸€ä¸»äºŒä»</h3><p><strong>ä¸€ä¸»äºŒä»åŸç†</strong></p><p>1ã€é…ä»(åº“)ä¸é…ä¸»(åº“)</p><p>2ã€é…ä»(åº“): slaveof ä¸»åº“IP ä¸»åº“ç«¯å£</p><p>3ã€ä¸»å†™ä»è¯»ã€è¯»å†™åˆ†ç¦»</p><p>4ã€ä»è¿å‰ååŒ</p><p>5ã€ä¸»æ–­ä»å¾…å‘½ã€ä»æ–­é‡æ–°è¿</p><h3 id="ä¸€ä¸»äºŒä»æ­å»º"><a href="#ä¸€ä¸»äºŒä»æ­å»º" class="headerlink" title="ä¸€ä¸»äºŒä»æ­å»º"></a>ä¸€ä¸»äºŒä»æ­å»º</h3><p><strong>1ã€ä¸€å°æœåŠ¡å™¨æ¨¡æ‹Ÿä¸‰å°ä¸»æœºï¼š</strong></p><ul><li>ç¬¬ä¸€æ­¥ï¼šå°†redis.conf æ‹·è´ä¸‰ä»½ï¼Œåå­—åˆ†åˆ«æ˜¯ï¼Œredis6379.confï¼Œredis6380.confï¼Œredis6381.conf</li><li>ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ä¸‰ä¸ªæ–‡ä»¶çš„portç«¯å£ï¼Œpidæ–‡ä»¶åï¼Œæ—¥å¿—æ–‡ä»¶åï¼Œrdbæ–‡ä»¶å</li></ul><p>å¦‚ï¼š</p><p><a href="https://www.jb51.net/database/313331pji.htm#">?</a></p><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div>1</div><div>2</div><div>3</div><div>4</div></td><td><div><div><code>port 6379</code></div><div><code>pidfile </code><code>/var/run/redis_6379</code><code>.pid</code></div><div><code>logfile â€œ6379.logâ€</code></div><div><code>dbfilename dump6379.rdb</code></div></div></td></tr></tbody></table><p><a href="javascript:;">ç™»å½•åå¤åˆ¶</a></p><ul><li>ç¬¬ä¸‰æ­¥ï¼šåˆ†åˆ«æ‰“å¼€ä¸‰ä¸ªçª—å£æ¨¡æ‹Ÿä¸‰å°æœåŠ¡å™¨ï¼Œå¼€å¯redisæœåŠ¡ã€‚</li></ul><p>2ã€æŸ¥è¯¢ä¸»ä»ä¿¡æ¯ï¼šinfo replication</p><p>3ã€å†™æ“ä½œ6379ï¼š</p><p>4ã€è®¾ç½®ä¸»ä»å…³ç³»ï¼š</p><p>åœ¨6380å’Œ6381ä¸»æœºä¸Šåˆ†åˆ«æ‰§è¡Œå‘½ä»¤ï¼šslaveof 127.0.0.1 6379</p><p>å¦ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯ä¿®æ”¹6380å’Œ6381çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨æœ€ååŠ ä¸Šï¼š</p><p>æ³¨æ„ï¼šå¦‚æœä¸»redisè®¾ç½®äº†å¯†ç ï¼Œä»åº“çš„redis.confä¸­è¿˜éœ€è¦è®¾ç½®masterauthä¸ºä¸»redisçš„å¯†ç ã€‚</p><p>5ã€å…¨é‡å¤åˆ¶ï¼šåœ¨6380å’Œ6381åˆ†åˆ«æ‰§è¡Œå‘½ä»¤get k1</p><p>6ã€å¢é‡å¤åˆ¶ï¼š6379æ‰§è¡Œå‘½ä»¤ï¼šset k2 v2ã€‚ç„¶å6380ç«¯å£å’Œ6381ç«¯å£ï¼Œåˆ†åˆ«æ‰§è¡Œå‘½ä»¤ï¼šget k2</p><p>7ã€ä¸»å†™ä»è¯»ã€è¯»å†™åˆ†ç¦»ï¼šåœ¨6380å’Œ6381ä¸Šæ‰§è¡Œå†™æ“ä½œset k3 v3</p><p>8ã€ä¸»æœºå®•æœºï¼š6379æ‰§è¡ŒæŒ‡ä»¤shutdownï¼Œå¹¶æŸ¥çœ‹6380å’Œ6381çš„redisä¿¡æ¯ ä»æœºåŸåœ°å¾…å‘½ã€‚</p><p>9ã€ä¸»æœºå®•æœºåæ¢å¤ï¼šé‡å¯6379ï¼Œå¹¶ä¸”æ‰§è¡Œå†™å‘½ä»¤set k4 v4ï¼›6380å’Œ6381ä¸Šåˆ†åˆ«æ‰§è¡Œget k4 ä¸»æœºé‡å¯åï¼Œä¸€åˆ‡æ­£å¸¸ã€‚</p><p>10ã€ä»æœºå®•æœºï¼š6380æ‰§è¡ŒæŒ‡ä»¤shutdownï¼Œå¹¶æŸ¥çœ‹6379å’Œ6381çš„redisä¿¡æ¯</p><p>11ã€ä»æœºå®•æœºåæ¢å¤ï¼šé‡å¯6380ï¼Œå¹¶æŸ¥çœ‹6380ã€6379å’Œ6381çš„redisä¿¡æ¯</p><p>æ³¨æ„ï¼šä»æœºè·Ÿmasteræ–­å¼€è”ç³»ï¼Œå¿…é¡»é‡æ–°è¿æ¥ï¼Œé™¤éå†™è¿›é…ç½®æ–‡ä»¶ã€‚</p><p>12ã€ä»æœºæ¢å¤è¿ä¸»æœºå‰ï¼Œä¸»æœºå†™æ“ä½œï¼š6379æ‰§è¡Œå†™å‘½ä»¤set k5 v5ï¼Œ6380å’Œ6381åˆ†åˆ«æ‰§è¡Œå‘½ä»¤get k5</p><p>13ã€ä»æœºæ¢å¤è¿æ¥ä¸»æœºï¼Œ6380æ‰§è¡Œå‘½ä»¤ï¼šslaveof 127.0.0.1 6379ï¼Œå¹¶ä¸”æ‰§è¡Œå‘½ä»¤ï¼šget k5</p><p>14ã€ä»æœºä¸Šä½ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼šä¸»æœºå®•æœºï¼Œ6379æ‰§è¡Œå‘½ä»¤ï¼šshutdown</li><li>ç¬¬äºŒæ­¥ï¼š6380æ–­å¼€ä¸»ä»å…³ç³»ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šSLAVEOF no one</li><li>ç¬¬ä¸‰æ­¥ï¼šé‡æ–°æ­å»ºä¸»ä»ï¼Œ6381æ‰§è¡Œå‘½ä»¤ï¼šinfo replicationï¼ŒSLAVEOF 127.0.0.1 6380</li><li>ç¬¬å››æ­¥ï¼šä¹‹å‰ä¸»æœºæ¢å¤ï¼Œé‡å¯6379çš„RedisæœåŠ¡ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤ï¼šinfo replication</li></ul><p>åœ¨6379ä¸»æœºå®•æœºåï¼Œ6380ä»æœºæ–­å¼€ä¸»ä»å…³ç³»ï¼Œ6381å¼€å§‹è¿˜åœ¨åŸåœ°å¾…å‘½ï¼›åæ¥6380ä»æœºä¸Šä½ï¼Œ6381æŠ•é 6380ï¼Œ6379ä¸»æœºå³ä½¿å›æ¥ä½†å®ƒå·²æ˜¯å­¤å¯¡è€äººï¼Œç©ºå¤´å¸ä»¤ã€‚</p><p>15ã€å¤©å ‚å˜åœ°ç‹±ï¼š6379æ‰§è¡Œå‘½ä»¤saveof 127.0.0.1 6381ï¼Œå¹¶åœ¨6379å’Œ6381æ‰§è¡Œinfo replication</p><p>ä¸€å°ä¸»æœºé…å¤šå°ä»æœºï¼Œä¸€å°ä»æœºå†é…å¤šå°ä»æœºï¼Œä»è€Œå®ç°äº†åºå¤§çš„é›†ç¾¤æ¶æ„ã€‚åŒæ—¶ä¹Ÿå‡è½»äº†ä¸€å°ä¸»æœºçš„å‹åŠ›ï¼Œç¼ºç‚¹æ˜¯å¢åŠ äº†æœåŠ¡å™¨é—´çš„å»¶è¿Ÿã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å½»åº•ææ‡‚Redisä¸»ä»å¤åˆ¶åŸç†åŠå®æˆ˜</title>
    <link href="/article/51e3a86c.html"/>
    <url>/article/51e3a86c.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />## ä¸»ä»å¤åˆ¶æ¦‚è¿°<p>ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave)ï¼›</p><p>æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯å°RedisæœåŠ¡å™¨éƒ½æ˜¯ä¸»èŠ‚ç‚¹ï¼Œä¸”ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹(æˆ–æ²¡æœ‰ä»èŠ‚ç‚¹)ï¼Œä½†ä¸€ä¸ªä»èŠ‚ç‚¹åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚</p><p>ç›®å‰å¾ˆå¤šä¸­å°ä¼ä¸šéƒ½æ²¡æœ‰ä½¿ç”¨åˆ° Redis çš„é›†ç¾¤ï¼Œä½†æ˜¯è‡³å°‘éƒ½åšäº†ä¸»ä»ã€‚æœ‰äº†ä¸»ä»ï¼Œå½“ master æŒ‚æ‰çš„æ—¶å€™ï¼Œè¿ç»´è®©ä»åº“è¿‡æ¥æ¥ç®¡ï¼ŒæœåŠ¡å°±å¯ä»¥ç»§ç»­ï¼Œå¦åˆ™ master éœ€è¦ç»è¿‡æ•°æ®æ¢å¤å’Œé‡å¯çš„è¿‡ç¨‹ï¼Œè¿™å°±å¯èƒ½ä¼šæ‹–å¾ˆé•¿çš„æ—¶é—´ï¼Œå½±å“çº¿ä¸Šä¸šåŠ¡çš„æŒç»­æœåŠ¡ã€‚</p><p>Redisä¸»ä»å¤åˆ¶æœåŠ¡å™¨æ¶æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/1446087-456af4793e1914ca?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Redisä¸»ä»å¤åˆ¶æ¶æ„å›¾"></p><h4 id="ä¸»ä»å¤åˆ¶çš„ä½œç”¨"><a href="#ä¸»ä»å¤åˆ¶çš„ä½œç”¨" class="headerlink" title="ä¸»ä»å¤åˆ¶çš„ä½œç”¨"></a>ä¸»ä»å¤åˆ¶çš„ä½œç”¨</h4><p>ä¸»ä»å¤åˆ¶çš„ä½œç”¨ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><strong>æ•°æ®å†—ä½™</strong>ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</li><li><strong>æ•…éšœæ¢å¤</strong>ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼ˆå³å†™Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯»Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä»èŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li><li><strong>é«˜å¯ç”¨åŸºçŸ³</strong>ï¼šä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€ã€‚</li></ul><h2 id="CAP-åŸç†"><a href="#CAP-åŸç†" class="headerlink" title="CAP åŸç†"></a>CAP åŸç†</h2><p>åœ¨äº†è§£ Redis çš„ä¸»ä»å¤åˆ¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ¥ç†è§£ä¸€ä¸‹ç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç†è®ºåŸºçŸ³â€”â€”CAP åŸç†ã€‚</p><p>CAP åŸç†å°±å¥½æ¯”åˆ†å¸ƒå¼é¢†åŸŸçš„ç‰›é¡¿å®šå¾‹ï¼Œå®ƒæ˜¯åˆ†å¸ƒå¼å­˜å‚¨çš„ç†è®ºåŸºçŸ³ã€‚è‡ªæ‰“ CAP çš„è®ºæ–‡å‘è¡¨ä¹‹åï¼Œåˆ†å¸ƒå¼å­˜å‚¨ä¸­é—´ä»¶çŠ¹å¦‚é›¨åæ˜¥ç¬‹èˆ¬ä¸€ä¸ªä¸€ä¸ªæ¶Œç°å‡ºæ¥ã€‚ç†è§£è¿™ä¸ªåŸç†å…¶å®å¾ˆç®€å•ï¼Œæœ¬èŠ‚æˆ‘ä»¬é¦–å…ˆå¯¹è¿™ä¸ªåŸç†è¿›è¡Œä¸€äº›ç®€å•çš„è®²è§£ã€‚</p><ul><li>C - Consistent ï¼Œ<strong>ä¸€è‡´æ€§</strong></li><li>A - Availability ï¼Œ<strong>å¯ç”¨æ€§</strong></li><li>P - Partition tolerance ï¼Œ<strong>åˆ†åŒºå®¹å¿æ€§</strong><br>åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹å¾€å¾€éƒ½æ˜¯åˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿›è¡Œç½‘ç»œéš”ç¦»å¼€çš„ï¼Œè¿™æ„å‘³ç€å¿…ç„¶ä¼šæœ‰ç½‘ç»œæ–­å¼€çš„é£é™©ï¼Œè¿™ä¸ªç½‘ç»œæ–­å¼€çš„åœºæ™¯çš„ä¸“ä¸šè¯æ±‡å«ç€ã€Œ<strong>ç½‘ç»œåˆ†åŒº</strong>ã€ã€‚</li></ul><p>åœ¨ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œä¸¤ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹ä¹‹é—´æ— æ³•è¿›è¡Œé€šä¿¡ï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œçš„ä¿®æ”¹æ“ä½œå°†æ— æ³•åŒæ­¥åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥æ•°æ®çš„ã€Œ<strong>ä¸€è‡´æ€§</strong>ã€å°†æ— æ³•æ»¡è¶³ï¼Œå› ä¸ºä¸¤ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ•°æ®ä¸å†ä¿æŒä¸€è‡´ã€‚é™¤éæˆ‘ä»¬ç‰ºç‰²ã€Œ<strong>å¯ç”¨æ€§</strong>ã€ï¼Œä¹Ÿå°±æ˜¯æš‚åœåˆ†å¸ƒå¼èŠ‚ç‚¹æœåŠ¡ï¼Œåœ¨ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œä¸å†æä¾›ä¿®æ”¹æ•°æ®çš„åŠŸèƒ½ï¼Œç›´åˆ°ç½‘ç»œçŠ¶å†µå®Œå…¨æ¢å¤æ­£å¸¸å†ç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><p>ä¸€å¥è¯æ¦‚æ‹¬ CAP åŸç†å°±æ˜¯â€”â€”<code>ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¸¤éš¾å…¨</code>ã€‚</p><h4 id="Redis-ä¸»ä»åŒæ­¥æœ€ç»ˆä¸€è‡´æ€§"><a href="#Redis-ä¸»ä»åŒæ­¥æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="Redis ä¸»ä»åŒæ­¥æœ€ç»ˆä¸€è‡´æ€§"></a>Redis ä¸»ä»åŒæ­¥æœ€ç»ˆä¸€è‡´æ€§</h4><p>Redis çš„ä¸»ä»æ•°æ®æ˜¯<code>å¼‚æ­¥</code>åŒæ­¥çš„ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼çš„ Redis ç³»ç»Ÿå¹¶ä¸æ»¡è¶³ã€Œ<strong>ä¸€è‡´æ€§</strong>ã€è¦æ±‚ã€‚å½“å®¢æˆ·ç«¯åœ¨ Redis çš„ä¸»èŠ‚ç‚¹ä¿®æ”¹äº†æ•°æ®åï¼Œç«‹å³è¿”å›ï¼Œå³ä½¿åœ¨ä¸»ä»ç½‘ç»œæ–­å¼€çš„æƒ…å†µä¸‹ï¼Œä¸»èŠ‚ç‚¹ä¾æ—§å¯ä»¥æ­£å¸¸å¯¹å¤–æä¾›ä¿®æ”¹æœåŠ¡ï¼Œæ‰€ä»¥ Redis æ»¡è¶³ã€Œ<strong>å¯ç”¨æ€§</strong>ã€ã€‚</p><p>Redis ä¿è¯ã€Œ<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ã€ï¼Œä»èŠ‚ç‚¹ä¼šåŠªåŠ›è¿½èµ¶ä¸»èŠ‚ç‚¹ï¼Œæœ€ç»ˆä»èŠ‚ç‚¹çš„çŠ¶æ€ä¼šå’Œä¸»èŠ‚ç‚¹çš„çŠ¶æ€å°†ä¿æŒä¸€è‡´ã€‚å¦‚æœç½‘ç»œæ–­å¼€äº†ï¼Œä¸»ä»èŠ‚ç‚¹çš„æ•°æ®å°†ä¼šå‡ºç°å¤§é‡ä¸ä¸€è‡´ï¼Œä¸€æ—¦ç½‘ç»œæ¢å¤ï¼Œä»èŠ‚ç‚¹ä¼šé‡‡ç”¨å¤šç§ç­–ç•¥åŠªåŠ›è¿½èµ¶ä¸Šè½åçš„æ•°æ®ï¼Œç»§ç»­å°½åŠ›ä¿æŒå’Œä¸»èŠ‚ç‚¹ä¸€è‡´ã€‚</p><h2 id="ä¸»ä»å¤åˆ¶çš„å®ç°åŸç†"><a href="#ä¸»ä»å¤åˆ¶çš„å®ç°åŸç†" class="headerlink" title="ä¸»ä»å¤åˆ¶çš„å®ç°åŸç†"></a>ä¸»ä»å¤åˆ¶çš„å®ç°åŸç†</h2><p>æ€»çš„æ¥è¯´ä¸»ä»å¤åˆ¶åŠŸèƒ½çš„è¯¦ç»†æ­¥éª¤å¯ä»¥åˆ†ä¸º7ä¸ªæ­¥éª¤ï¼š</p><ol><li>è®¾ç½®ä¸»èŠ‚ç‚¹çš„åœ°å€å’Œç«¯å£</li><li>å»ºç«‹å¥—æ¥å­—è¿æ¥</li><li>å‘é€PINGå‘½ä»¤</li><li>æƒé™éªŒè¯</li><li>åŒæ­¥</li><li>å‘½ä»¤ä¼ æ’­</li></ol><p>æ¥ä¸‹æ¥åˆ†åˆ«å™è¿°æ¯ä¸ªæ­¥éª¤ï¼Œæ•´ä¸ªæµç¨‹å›¾å¦‚ä¸‹ï¼š<br><img src="https://git.521566.xyz/https://upload-images.jianshu.io/upload_images/1446087-151d84ec0b9e63a1?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘åœ¨æœ¬åœ°æœºå¼€å¯ä¸¤ä¸ªRedisèŠ‚ç‚¹ï¼Œåˆ†åˆ«ç›‘å¬ï¼š<br>127.0.0.1 6379ï¼ˆä¸»ï¼‰<br>127.0.0.1 6380ï¼ˆä»ï¼‰<br><img src="https://upload-images.jianshu.io/upload_images/1446087-f91a4b1d26e29434.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="1-è®¾ç½®ä¸»æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£"><a href="#1-è®¾ç½®ä¸»æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£" class="headerlink" title="1. è®¾ç½®ä¸»æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£"></a>1. è®¾ç½®ä¸»æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£</h4><p>ç¬¬ä¸€æ­¥é¦–å…ˆæ˜¯åœ¨ä»æœåŠ¡å™¨è®¾ç½®éœ€è¦åŒæ­¥çš„ä¸»æœåŠ¡å™¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœºå™¨IP, ç«¯å£ã€‚<br>ä¸»ä»å¤åˆ¶çš„å¼€å¯ï¼Œå®Œå…¨æ˜¯åœ¨ä»èŠ‚ç‚¹å‘èµ·çš„ï¼›ä¸éœ€è¦æˆ‘ä»¬åœ¨ä¸»èŠ‚ç‚¹åšä»»ä½•äº‹æƒ…ã€‚</p><p>ä»èŠ‚ç‚¹å¼€å¯ä¸»ä»å¤åˆ¶ï¼Œæœ‰3ç§æ–¹å¼ï¼š</p><p>ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶</p><p>åœ¨ä»æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ï¼šslaveof masterip masterport</p><p>ï¼ˆ2ï¼‰å¯åŠ¨å‘½ä»¤</p><p>redis-serverå¯åŠ¨å‘½ä»¤ååŠ å…¥ â€“slaveof masterip masterport</p><p>ï¼ˆ3ï¼‰å®¢æˆ·ç«¯å‘½ä»¤</p><p>RedisæœåŠ¡å™¨å¯åŠ¨åï¼Œç›´æ¥é€šè¿‡å®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤ï¼šslaveof masterip masterportï¼Œåˆ™è¯¥Rediså®ä¾‹æˆä¸ºä»èŠ‚ç‚¹ã€‚</p><p>ä¸Šè¿°3ç§æ–¹å¼æ˜¯ç­‰æ•ˆçš„ï¼Œä¸‹é¢ä»¥å®¢æˆ·ç«¯å‘½ä»¤çš„æ–¹å¼ä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸‹å½“æ‰§è¡Œäº†slaveofåï¼ŒRedisä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹çš„å˜åŒ–ã€‚</p><p>å®Œæˆä¸Šé¢çš„é…ç½®åï¼Œ ä»æœåŠ¡å™¨ä¼šå°†ä¸»æœåŠ¡å™¨çš„ipåœ°å€å’Œç«¯å£å·ä¿å­˜åˆ°æœåŠ¡å™¨çŠ¶æ€çš„å±æ€§é‡Œé¢ã€‚å¯ä»¥Redisä½¿ç”¨<code>info Replication</code> å‘½ä»¤åˆ†åˆ«æŸ¥çœ‹ä»æœåŠ¡å™¨å’Œä¸»æœåŠ¡å™¨çš„ä¸»ä»ä¿¡æ¯</p><h4 id="2-å»ºç«‹å¥—æ¥å­—è¿æ¥"><a href="#2-å»ºç«‹å¥—æ¥å­—è¿æ¥" class="headerlink" title="2. å»ºç«‹å¥—æ¥å­—è¿æ¥"></a>2. å»ºç«‹å¥—æ¥å­—è¿æ¥</h4><p>åœ¨slaveofå‘½ä»¤æ‰§è¡Œä¹‹åï¼Œä»æœåŠ¡å™¨ä¼šæ ¹æ®è®¾ç½®çš„ipå’Œç«¯å£ï¼Œå‘ä¸»æœåŠ¡å™¨ç®€å†socketè¿æ¥ã€‚<br>åœ¨6380ä»æœåŠ¡å™¨é‡Œé¢æ‰§è¡Œå®Œ<code>slave of 127.0.0.1 6379</code> åæ„å‘³ç€ï¼Œä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘èµ·socketè¿æ¥<br>åœ¨æ‰§è¡Œinfo Replication å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°6380æœåŠ¡å™¨çš„è§’è‰²æ˜¯slaveäº†<br><img src="https://upload-images.jianshu.io/upload_images/1446087-c720e3b085b69053?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æˆ‘ä»¬åœ¨"><br>è€Œ6379 æœåŠ¡å™¨å·²ç»æˆä¸ºä¸»æœåŠ¡å™¨è§’è‰²ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1446087-0a2a2e70600d8be5?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="3-å‘é€PINGå‘½ä»¤"><a href="#3-å‘é€PINGå‘½ä»¤" class="headerlink" title="3. å‘é€PINGå‘½ä»¤"></a>3. å‘é€PINGå‘½ä»¤</h4><p>ä»èŠ‚ç‚¹æˆä¸ºä¸»èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¹‹åï¼Œå‘é€pingå‘½ä»¤è¿›è¡Œé¦–æ¬¡è¯·æ±‚ï¼Œç›®çš„æ˜¯ï¼š<strong>æ£€æŸ¥socketè¿æ¥æ˜¯å¦å¯ç”¨</strong>ï¼Œä»¥åŠä¸»èŠ‚ç‚¹å½“å‰æ˜¯å¦èƒ½å¤Ÿå¤„ç†è¯·æ±‚ã€‚</p><p>ä»èŠ‚ç‚¹å‘é€pingå‘½ä»¤åï¼Œå¯èƒ½å‡ºç°3ç§æƒ…å†µï¼š</p><p>ï¼ˆ1ï¼‰è¿”å›pongï¼šè¯´æ˜socketè¿æ¥æ­£å¸¸ï¼Œä¸”ä¸»èŠ‚ç‚¹å½“å‰å¯ä»¥å¤„ç†è¯·æ±‚ï¼Œå¤åˆ¶è¿‡ç¨‹ç»§ç»­ã€‚</p><p>ï¼ˆ2ï¼‰è¶…æ—¶ï¼šä¸€å®šæ—¶é—´åä»èŠ‚ç‚¹ä»æœªæ”¶åˆ°ä¸»èŠ‚ç‚¹çš„å›å¤ï¼Œè¯´æ˜socketè¿æ¥ä¸å¯ç”¨ï¼Œåˆ™ä»èŠ‚ç‚¹æ–­å¼€socketè¿æ¥ï¼Œå¹¶é‡è¿ã€‚</p><p>ï¼ˆ3ï¼‰è¿”å›pongä»¥å¤–çš„ç»“æœï¼šå¦‚æœä¸»èŠ‚ç‚¹è¿”å›å…¶ä»–ç»“æœï¼Œå¦‚æ­£åœ¨å¤„ç†è¶…æ—¶è¿è¡Œçš„è„šæœ¬ï¼Œè¯´æ˜ä¸»èŠ‚ç‚¹å½“å‰æ— æ³•å¤„ç†å‘½ä»¤ï¼Œåˆ™ä»èŠ‚ç‚¹æ–­å¼€socketè¿æ¥ï¼Œå¹¶é‡è¿ã€‚</p><p>ä¸»ä»å‘é€PINGå‘½ä»¤æµç¨‹å›¾å¦‚ä¸‹:<br><img src="https://upload-images.jianshu.io/upload_images/1446087-81d4122403b825e2?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="4-èº«ä»½éªŒè¯"><a href="#4-èº«ä»½éªŒè¯" class="headerlink" title="4. èº«ä»½éªŒè¯"></a>4. èº«ä»½éªŒè¯</h4><p>å¦‚æœä»èŠ‚ç‚¹ä¸­è®¾ç½®äº†masterauthé€‰é¡¹ï¼Œåˆ™ä»èŠ‚ç‚¹éœ€è¦å‘ä¸»èŠ‚ç‚¹è¿›è¡Œèº«ä»½éªŒè¯ï¼›æ²¡æœ‰è®¾ç½®è¯¥é€‰é¡¹ï¼Œåˆ™ä¸éœ€è¦éªŒè¯ã€‚ä»èŠ‚ç‚¹è¿›è¡Œèº«ä»½éªŒè¯æ˜¯é€šè¿‡å‘ä¸»èŠ‚ç‚¹å‘é€authå‘½ä»¤è¿›è¡Œçš„ï¼Œauthå‘½ä»¤çš„å‚æ•°å³ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„masterauthçš„å€¼ã€‚</p><p>å¦‚æœä¸»èŠ‚ç‚¹è®¾ç½®å¯†ç çš„çŠ¶æ€ï¼Œä¸ä»èŠ‚ç‚¹masterauthçš„çŠ¶æ€ä¸€è‡´ï¼ˆä¸€è‡´æ˜¯æŒ‡éƒ½å­˜åœ¨ï¼Œä¸”å¯†ç ç›¸åŒï¼Œæˆ–è€…éƒ½ä¸å­˜åœ¨ï¼‰ï¼Œåˆ™èº«ä»½éªŒè¯é€šè¿‡ï¼Œå¤åˆ¶è¿‡ç¨‹ç»§ç»­ï¼›å¦‚æœä¸ä¸€è‡´ï¼Œåˆ™ä»èŠ‚ç‚¹æ–­å¼€socketè¿æ¥ï¼Œå¹¶é‡è¿ã€‚</p><p>ä¸»ä»èº«ä»½éªŒè¯æµç¨‹å›¾å¦‚ä¸‹ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1446087-2d99b3e306347f81?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="5-åŒæ­¥"><a href="#5-åŒæ­¥" class="headerlink" title="5. åŒæ­¥"></a>5. åŒæ­¥</h4><p>åŒæ­¥å°±æ˜¯å°†ä»èŠ‚ç‚¹çš„æ•°æ®åº“çŠ¶æ€æ›´æ–°æˆä¸»èŠ‚ç‚¹å½“å‰çš„æ•°æ®åº“çŠ¶æ€ã€‚å…·ä½“æ‰§è¡Œçš„æ–¹å¼æ˜¯ï¼šä»èŠ‚ç‚¹å‘ä¸»èŠ‚ç‚¹å‘é€psyncå‘½ä»¤ï¼ˆRedis2.8ä»¥å‰æ˜¯syncå‘½ä»¤ï¼‰ï¼Œå¼€å§‹åŒæ­¥ã€‚<br>æ•°æ®åŒæ­¥é˜¶æ®µæ˜¯ä¸»ä»å¤åˆ¶æœ€æ ¸å¿ƒçš„é˜¶æ®µï¼Œæ ¹æ®ä¸»ä»èŠ‚ç‚¹å½“å‰çŠ¶æ€çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸º<code>å…¨é‡å¤åˆ¶</code>å’Œ<code>éƒ¨åˆ†å¤åˆ¶</code><br>ä¸‹é¢ä¼šæœ‰è¯¦ç»†ä»‹ç»å…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶å†…å®¹ï¼Œè¿™é‡Œæš‚ä¸è¯¦è¿°</p><h4 id="6-å‘½ä»¤ä¼ æ’­"><a href="#6-å‘½ä»¤ä¼ æ’­" class="headerlink" title="6. å‘½ä»¤ä¼ æ’­"></a>6. å‘½ä»¤ä¼ æ’­</h4><p>ç»è¿‡ä¸Šé¢åŒæ­¥æ“ä½œï¼Œæ­¤æ—¶ä¸»ä»çš„æ•°æ®åº“çŠ¶æ€å…¶å®å·²ç»ä¸€è‡´äº†ï¼Œä½†è¿™ç§ä¸€è‡´çš„çŠ¶æ€çš„å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ã€‚<br>åœ¨å®ŒæˆåŒæ­¥ä¹‹åï¼Œä¹Ÿè®¸ä¸»æœåŠ¡å™¨é©¬ä¸Šå°±æ¥å—åˆ°äº†æ–°çš„å†™å‘½ä»¤ï¼Œæ‰§è¡Œå®Œè¯¥å‘½ä»¤åï¼Œä¸»ä»çš„æ•°æ®åº“çŠ¶æ€åˆä¸ä¸€è‡´ã€‚</p><p>æ•°æ®åŒæ­¥é˜¶æ®µå®Œæˆåï¼Œä¸»ä»èŠ‚ç‚¹è¿›å…¥å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼›åœ¨è¿™ä¸ªé˜¶æ®µä¸»èŠ‚ç‚¹å°†è‡ªå·±æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹æ¥æ”¶å‘½ä»¤å¹¶æ‰§è¡Œï¼Œä»è€Œä¿è¯ä¸»ä»èŠ‚ç‚¹æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><p>å¦å¤–å‘½ä»¤è½¬æ’­æˆ‘ä»¬éœ€è¦å…³æ³¨ä¸¤ä¸ªç‚¹ï¼š <code>å»¶è¿Ÿä¸ä¸ä¸€è‡´</code> å’Œ <code>å¿ƒè·³æœºåˆ¶</code> æˆ‘ä»¬ä¸‹é¢ä»‹ç»ä¸€ä¸‹</p><p><strong>å»¶è¿Ÿä¸ä¸ä¸€è‡´</strong><br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‘½ä»¤ä¼ æ’­æ˜¯<strong>å¼‚æ­¥</strong>çš„è¿‡ç¨‹ï¼Œå³ä¸»èŠ‚ç‚¹å‘é€å†™å‘½ä»¤åå¹¶ä¸ä¼šç­‰å¾…ä»èŠ‚ç‚¹çš„å›å¤ï¼›å› æ­¤å®é™…ä¸Šä¸»ä»èŠ‚ç‚¹ä¹‹é—´å¾ˆéš¾ä¿æŒå®æ—¶çš„ä¸€è‡´æ€§ï¼Œå»¶è¿Ÿåœ¨æ‰€éš¾å…ã€‚æ•°æ®ä¸ä¸€è‡´çš„ç¨‹åº¦ï¼Œä¸ä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œçŠ¶å†µã€ä¸»èŠ‚ç‚¹å†™å‘½ä»¤çš„æ‰§è¡Œé¢‘ç‡ã€ä»¥åŠä¸»èŠ‚ç‚¹ä¸­çš„<code>repl-disable-tcp-nodelay</code>é…ç½®ç­‰æœ‰å…³ã€‚</p><p><code>repl-disable-tcp-nodelay</code> é…ç½®å¦‚ä¸‹ï¼š</p><ul><li>å‡å¦‚è®¾ç½®æˆyesï¼Œåˆ™redisä¼šåˆå¹¶å°çš„TCPåŒ…ä»è€ŒèŠ‚çœå¸¦å®½ï¼Œä½†ä¼šå¢åŠ åŒæ­¥å»¶è¿Ÿï¼ˆ40msï¼‰ï¼Œé€ æˆmasterä¸slaveæ•°æ®ä¸ä¸€è‡´</li><li>å‡å¦‚è®¾ç½®æˆnoï¼Œåˆ™redis masterä¼šç«‹å³å‘é€åŒæ­¥æ•°æ®ï¼Œæ²¡æœ‰å»¶è¿Ÿ</li></ul><p>æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ï¼š<code>å‰è€…å…³æ³¨æ€§èƒ½ï¼Œåè€…å…³æ³¨ä¸€è‡´æ€§</code></p><p>å…·ä½“å‘é€é¢‘ç‡ä¸Linuxå†…æ ¸çš„é…ç½®æœ‰å…³ï¼Œé»˜è®¤é…ç½®ä¸º40msã€‚å½“è®¾ç½®ä¸ºnoæ—¶ï¼ŒTCPä¼šç«‹é©¬å°†ä¸»èŠ‚ç‚¹çš„æ•°æ®å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œå¸¦å®½å¢åŠ ä½†å»¶è¿Ÿå˜å°ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰å½“åº”ç”¨å¯¹Redisæ•°æ®ä¸ä¸€è‡´çš„å®¹å¿åº¦è¾ƒé«˜ï¼Œä¸”ä¸»ä»èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œçŠ¶å†µä¸å¥½æ—¶ï¼Œæ‰ä¼šè®¾ç½®ä¸ºyesï¼›å¤šæ•°æƒ…å†µä½¿ç”¨é»˜è®¤å€¼no</p><p><strong>Redisæ˜¯å¦‚ä½•ä¿è¯ä¸»ä»æœåŠ¡å™¨ä¸€è‡´å¤„äºè¿æ¥çŠ¶æ€ä»¥åŠå‘½ä»¤æ˜¯å¦ä¸¢å¤±ï¼Ÿ</strong><br>ç­”ï¼šå‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä»æœåŠ¡å™¨ä¼šåˆ©ç”¨å¿ƒè·³æ£€æµ‹æœºåˆ¶å®šæ—¶çš„å‘ä¸»æœåŠ¡å‘é€æ¶ˆæ¯ã€‚<br>å¿ƒè·³æœºåˆ¶æˆ‘ä»¬ä¸‹é¢å†è¯¦ç»†è¯´ã€‚</p><h2 id="å…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶"><a href="#å…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶" class="headerlink" title="å…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶"></a>å…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶</h2><p>åœ¨Redis2.8ä»¥å‰ï¼Œä»èŠ‚ç‚¹å‘ä¸»èŠ‚ç‚¹å‘é€syncå‘½ä»¤è¯·æ±‚åŒæ­¥æ•°æ®ï¼Œæ­¤æ—¶çš„åŒæ­¥æ–¹å¼æ˜¯å…¨é‡å¤åˆ¶ï¼›åœ¨Redis2.8åŠä»¥åï¼Œä»èŠ‚ç‚¹å¯ä»¥å‘é€psyncå‘½ä»¤è¯·æ±‚åŒæ­¥æ•°æ®ï¼Œæ­¤æ—¶æ ¹æ®ä¸»ä»èŠ‚ç‚¹å½“å‰çŠ¶æ€çš„ä¸åŒï¼ŒåŒæ­¥æ–¹å¼å¯èƒ½æ˜¯å…¨é‡å¤åˆ¶æˆ–éƒ¨åˆ†å¤åˆ¶ã€‚åæ–‡ä»‹ç»ä»¥Redis2.8åŠä»¥åç‰ˆæœ¬ä¸ºä¾‹ã€‚</p><ol><li>å…¨é‡å¤åˆ¶ï¼šç”¨äºåˆæ¬¡å¤åˆ¶æˆ–å…¶ä»–æ— æ³•è¿›è¡Œéƒ¨åˆ†å¤åˆ¶çš„æƒ…å†µï¼Œå°†ä¸»èŠ‚ç‚¹ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªéå¸¸é‡å‹çš„æ“ä½œã€‚</li><li>éƒ¨åˆ†å¤åˆ¶ï¼šç”¨äºç½‘ç»œä¸­æ–­ç­‰æƒ…å†µåçš„å¤åˆ¶ï¼Œåªå°†ä¸­æ–­æœŸé—´ä¸»èŠ‚ç‚¹æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¸å…¨é‡å¤åˆ¶ç›¸æ¯”æ›´åŠ é«˜æ•ˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç½‘ç»œä¸­æ–­æ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´ä¸»èŠ‚ç‚¹æ²¡æœ‰èƒ½å¤Ÿå®Œæ•´åœ°ä¿å­˜ä¸­æ–­æœŸé—´æ‰§è¡Œçš„å†™å‘½ä»¤ï¼Œåˆ™æ— æ³•è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ï¼Œä»ä½¿ç”¨å…¨é‡å¤åˆ¶ã€‚</li></ol><h3 id="å…¨é‡å¤åˆ¶"><a href="#å…¨é‡å¤åˆ¶" class="headerlink" title="å…¨é‡å¤åˆ¶"></a>å…¨é‡å¤åˆ¶</h3><p>Redisé€šè¿‡psyncå‘½ä»¤è¿›è¡Œå…¨é‡å¤åˆ¶çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰ä»èŠ‚ç‚¹åˆ¤æ–­æ— æ³•è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ï¼Œå‘ä¸»èŠ‚ç‚¹å‘é€å…¨é‡å¤åˆ¶çš„è¯·æ±‚ï¼›æˆ–ä»èŠ‚ç‚¹å‘é€éƒ¨åˆ†å¤åˆ¶çš„è¯·æ±‚ï¼Œä½†ä¸»èŠ‚ç‚¹åˆ¤æ–­æ— æ³•è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ï¼›å…·ä½“åˆ¤æ–­è¿‡ç¨‹éœ€è¦åœ¨è®²è¿°äº†éƒ¨åˆ†å¤åˆ¶åŸç†åå†ä»‹ç»ã€‚</p><p>ï¼ˆ2ï¼‰ä¸»èŠ‚ç‚¹æ”¶åˆ°å…¨é‡å¤åˆ¶çš„å‘½ä»¤åï¼Œæ‰§è¡Œbgsaveï¼Œåœ¨åå°ç”ŸæˆRDBæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªç¼“å†²åŒºï¼ˆç§°ä¸ºå¤åˆ¶ç¼“å†²åŒºï¼‰è®°å½•ä»ç°åœ¨å¼€å§‹æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤</p><p>ï¼ˆ3ï¼‰ä¸»èŠ‚ç‚¹çš„bgsaveæ‰§è¡Œå®Œæˆåï¼Œå°†RDBæ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹ï¼›ä»èŠ‚ç‚¹é¦–å…ˆæ¸…é™¤è‡ªå·±çš„æ—§æ•°æ®ï¼Œç„¶åè½½å…¥æ¥æ”¶çš„RDBæ–‡ä»¶ï¼Œå°†æ•°æ®åº“çŠ¶æ€æ›´æ–°è‡³ä¸»èŠ‚ç‚¹æ‰§è¡Œbgsaveæ—¶çš„æ•°æ®åº“çŠ¶æ€</p><p>ï¼ˆ4ï¼‰ä¸»èŠ‚ç‚¹å°†å‰è¿°å¤åˆ¶ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹æ‰§è¡Œè¿™äº›å†™å‘½ä»¤ï¼Œå°†æ•°æ®åº“çŠ¶æ€æ›´æ–°è‡³ä¸»èŠ‚ç‚¹çš„æœ€æ–°çŠ¶æ€</p><p>ï¼ˆ5ï¼‰å¦‚æœä»èŠ‚ç‚¹å¼€å¯äº†AOFï¼Œåˆ™ä¼šè§¦å‘bgrewriteaofçš„æ‰§è¡Œï¼Œä»è€Œä¿è¯AOFæ–‡ä»¶æ›´æ–°è‡³ä¸»èŠ‚ç‚¹çš„æœ€æ–°çŠ¶æ€<br><img src="https://upload-images.jianshu.io/upload_images/1446087-4248ddd4cafb8afd?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Rediså…¨é‡å¤åˆ¶æµç¨‹"><br>é€šè¿‡å…¨é‡å¤åˆ¶çš„è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œå…¨é‡å¤åˆ¶æ˜¯éå¸¸é‡å‹çš„æ“ä½œï¼š</p><p>ï¼ˆ1ï¼‰ä¸»èŠ‚ç‚¹é€šè¿‡bgsaveå‘½ä»¤forkå­è¿›ç¨‹è¿›è¡ŒRDBæŒä¹…åŒ–ï¼Œè¯¥è¿‡ç¨‹æ˜¯éå¸¸æ¶ˆè€—CPUã€å†…å­˜(é¡µè¡¨å¤åˆ¶)ã€ç¡¬ç›˜IOçš„ï¼›å…³äºbgsaveçš„æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒæˆ‘å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š æ·±å…¥å‰–æRedisé«˜å¯ç”¨ç³»åˆ—ï¼šæŒä¹…åŒ– AOFå’ŒRDB</p><p>ï¼ˆ2ï¼‰ä¸»èŠ‚ç‚¹é€šè¿‡ç½‘ç»œå°†RDBæ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œå¯¹ä¸»ä»èŠ‚ç‚¹çš„å¸¦å®½éƒ½ä¼šå¸¦æ¥å¾ˆå¤§çš„æ¶ˆè€—</p><p>ï¼ˆ3ï¼‰ä»èŠ‚ç‚¹æ¸…ç©ºè€æ•°æ®ã€è½½å…¥æ–°RDBæ–‡ä»¶çš„è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œæ— æ³•å“åº”å®¢æˆ·ç«¯çš„å‘½ä»¤ï¼›å¦‚æœä»èŠ‚ç‚¹æ‰§è¡Œbgrewriteaofï¼Œä¹Ÿä¼šå¸¦æ¥é¢å¤–çš„æ¶ˆè€—</p><h3 id="éƒ¨åˆ†å¤åˆ¶"><a href="#éƒ¨åˆ†å¤åˆ¶" class="headerlink" title="éƒ¨åˆ†å¤åˆ¶"></a>éƒ¨åˆ†å¤åˆ¶</h3><p>ç”±äºå…¨é‡å¤åˆ¶åœ¨ä¸»èŠ‚ç‚¹æ•°æ®é‡è¾ƒå¤§æ—¶æ•ˆç‡å¤ªä½ï¼Œå› æ­¤Redis2.8å¼€å§‹æä¾›éƒ¨åˆ†å¤åˆ¶ï¼Œç”¨äºå¤„ç†ç½‘ç»œä¸­æ–­æ—¶çš„æ•°æ®åŒæ­¥ã€‚</p><p>éƒ¨åˆ†å¤åˆ¶çš„å®ç°ï¼Œä¾èµ–äºä¸‰ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p><ol><li>å¤åˆ¶åç§»é‡</li><li>å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</li><li>æœåŠ¡å™¨è¿è¡ŒID(runid)<br>ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«è®²è§£ä¸€ä¸‹è¿™ä¸‰ä¸ªæ¦‚å¿µï¼š</li></ol><h4 id="1-å¤åˆ¶åç§»é‡ï¼š"><a href="#1-å¤åˆ¶åç§»é‡ï¼š" class="headerlink" title="1. å¤åˆ¶åç§»é‡ï¼š"></a>1. å¤åˆ¶åç§»é‡ï¼š</h4><p>æ‰§è¡Œå¤åˆ¶çš„åŒæ–¹ï¼Œä¸»ä»èŠ‚ç‚¹ï¼Œåˆ†åˆ«ä¼šç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡offsetï¼š<br>ä¸»èŠ‚ç‚¹æ¯æ¬¡å‘ä»èŠ‚ç‚¹åŒæ­¥äº†Nå­—èŠ‚æ•°æ®åï¼Œå°†ä¿®æ”¹è‡ªå·±çš„å¤åˆ¶åç§»é‡offset+N<br>ä»èŠ‚ç‚¹æ¯æ¬¡ä»ä¸»èŠ‚ç‚¹åŒæ­¥äº†Nå­—èŠ‚æ•°æ®åï¼Œå°†ä¿®æ”¹è‡ªå·±çš„å¤åˆ¶åç§»é‡offset+N</p><p>offsetç”¨äºåˆ¤æ–­ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®åº“çŠ¶æ€æ˜¯å¦ä¸€è‡´ï¼š<br>å¦‚æœäºŒè€…offsetç›¸åŒï¼Œåˆ™ä¸€è‡´ï¼›<br>å¦‚æœoffsetä¸åŒï¼Œåˆ™ä¸ä¸€è‡´ï¼Œæ­¤æ—¶å¯ä»¥æ ¹æ®ä¸¤ä¸ªoffsetæ‰¾å‡ºä»èŠ‚ç‚¹ç¼ºå°‘çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä¸»èŠ‚ç‚¹çš„offsetæ˜¯1000ï¼Œè€Œä»èŠ‚ç‚¹çš„offsetæ˜¯500ï¼Œé‚£ä¹ˆéƒ¨åˆ†å¤åˆ¶å°±éœ€è¦å°†offsetä¸º501-1000çš„æ•°æ®ä¼ é€’ç»™ä»èŠ‚ç‚¹ã€‚è€Œoffsetä¸º501-1000çš„æ•°æ®å­˜å‚¨çš„ä½ç½®ï¼Œå°±æ˜¯ä¸‹é¢è¦ä»‹ç»çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€‚</p><h4 id="2-å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼š"><a href="#2-å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼š" class="headerlink" title="2. å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼š"></a>2. å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼š</h4><p>ä¸»èŠ‚ç‚¹å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª<strong>å›ºå®šé•¿åº¦çš„ã€å…ˆè¿›å…ˆå‡º(FIFO)é˜Ÿåˆ—</strong> ä½œä¸ºå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œå…¶é»˜è®¤å¤§å°ä¸º1MB<br>åœ¨ä¸»èŠ‚ç‚¹è¿›è¡Œå‘½ä»¤ä¼ æ’­æ—¶ï¼Œä¸ä»…ä¼šå°†å†™å‘½ä»¤åŒæ­¥åˆ°ä»èŠ‚ç‚¹ï¼Œè¿˜ä¼šå°†å†™å‘½ä»¤å†™å…¥å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€‚</p><p>ç”±äºå¤åˆ¶ç§¯å‹ç¼“å†²åŒºå®šé•¿ä¸”æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œæ‰€ä»¥å®ƒä¿å­˜çš„æ˜¯ä¸»èŠ‚ç‚¹æœ€è¿‘æ‰§è¡Œçš„å†™å‘½ä»¤ï¼›æ—¶é—´è¾ƒæ—©çš„å†™å‘½ä»¤ä¼šè¢«æŒ¤å‡ºç¼“å†²åŒºã€‚å› æ­¤ï¼Œ<strong>å½“ä¸»ä»èŠ‚ç‚¹offsetçš„å·®è·è¿‡å¤§è¶…è¿‡ç¼“å†²åŒºé•¿åº¦æ—¶ï¼Œå°†æ— æ³•æ‰§è¡Œéƒ¨åˆ†å¤åˆ¶ï¼Œåªèƒ½æ‰§è¡Œå…¨é‡å¤åˆ¶ã€‚</strong></p><p>ä¸ºäº†æé«˜ç½‘ç»œä¸­æ–­æ—¶<strong>éƒ¨åˆ†å¤åˆ¶</strong>æ‰§è¡Œçš„æ¦‚ç‡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å¢å¤§å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¤§å°(é€šè¿‡é…ç½®<code>repl-backlog-size</code>)ï¼›ä¾‹å¦‚å¦‚æœç½‘ç»œä¸­æ–­çš„å¹³å‡æ—¶é—´æ˜¯60sï¼Œè€Œä¸»èŠ‚ç‚¹å¹³å‡æ¯ç§’äº§ç”Ÿçš„å†™å‘½ä»¤(ç‰¹å®šåè®®æ ¼å¼)æ‰€å çš„å­—èŠ‚æ•°ä¸º100KBï¼Œåˆ™å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¹³å‡éœ€æ±‚ä¸º6MBï¼Œä¿é™©èµ·è§ï¼Œå¯ä»¥è®¾ç½®ä¸º12MBï¼Œæ¥ä¿è¯ç»å¤§å¤šæ•°æ–­çº¿æƒ…å†µéƒ½å¯ä»¥ä½¿ç”¨éƒ¨åˆ†å¤åˆ¶ã€‚</p><p>ä»èŠ‚ç‚¹å°†offsetå‘é€ç»™ä¸»èŠ‚ç‚¹åï¼Œä¸»èŠ‚ç‚¹æ ¹æ®offsetå’Œç¼“å†²åŒºå¤§å°å†³å®šèƒ½å¦æ‰§è¡Œéƒ¨åˆ†å¤åˆ¶ï¼š</p><ul><li>å¦‚æœoffsetåç§»é‡ä¹‹åçš„æ•°æ®ï¼Œä»ç„¶éƒ½åœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œï¼Œåˆ™æ‰§è¡Œ<strong>éƒ¨åˆ†å¤åˆ¶</strong>ï¼›</li><li>å¦‚æœoffsetåç§»é‡ä¹‹åçš„æ•°æ®å·²ä¸åœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸­ï¼ˆæ•°æ®å·²è¢«æŒ¤å‡ºï¼‰ï¼Œåˆ™æ‰§è¡Œ<strong>å…¨é‡å¤åˆ¶</strong>ã€‚</li></ul><p>å¤åˆ¶ç§¯å‹ç¼“å†²åŒºç¤ºæ„å›¾ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1446087-09c94ff5186a5b57?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="3-æœåŠ¡å™¨è¿è¡ŒID-runid-ï¼š"><a href="#3-æœåŠ¡å™¨è¿è¡ŒID-runid-ï¼š" class="headerlink" title="3. æœåŠ¡å™¨è¿è¡ŒID(runid)ï¼š"></a>3. æœåŠ¡å™¨è¿è¡ŒID(runid)ï¼š</h4><p>æ¯ä¸ªRedisèŠ‚ç‚¹ï¼Œéƒ½æœ‰å…¶è¿è¡ŒIDï¼Œè¿è¡ŒIDç”±èŠ‚ç‚¹åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œä¸»èŠ‚ç‚¹ä¼šå°†è‡ªå·±çš„è¿è¡ŒIDå‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹ä¼šå°†ä¸»èŠ‚ç‚¹çš„è¿è¡ŒIDå­˜èµ·æ¥ã€‚<br>ä»èŠ‚ç‚¹Redisæ–­å¼€é‡è¿çš„æ—¶å€™ï¼Œå°±æ˜¯æ ¹æ®è¿è¡ŒIDæ¥åˆ¤æ–­åŒæ­¥çš„è¿›åº¦ï¼š</p><ul><li>å¦‚æœä»èŠ‚ç‚¹ä¿å­˜çš„runidä¸ä¸»èŠ‚ç‚¹ç°åœ¨çš„runidç›¸åŒï¼Œè¯´æ˜ä¸»ä»èŠ‚ç‚¹ä¹‹å‰åŒæ­¥è¿‡ï¼Œä¸»èŠ‚ç‚¹ä¼šç»§ç»­å°è¯•ä½¿ç”¨éƒ¨åˆ†å¤åˆ¶(åˆ°åº•èƒ½ä¸èƒ½éƒ¨åˆ†å¤åˆ¶è¿˜è¦çœ‹offsetå’Œå¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„æƒ…å†µ)ï¼›</li><li>å¦‚æœä»èŠ‚ç‚¹ä¿å­˜çš„runidä¸ä¸»èŠ‚ç‚¹ç°åœ¨çš„runidä¸åŒï¼Œè¯´æ˜ä»èŠ‚ç‚¹åœ¨æ–­çº¿å‰åŒæ­¥çš„RedisèŠ‚ç‚¹å¹¶ä¸æ˜¯å½“å‰çš„ä¸»èŠ‚ç‚¹ï¼Œåªèƒ½è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚</li></ul><h3 id="psync-å‘½ä»¤çš„æ‰§è¡Œ"><a href="#psync-å‘½ä»¤çš„æ‰§è¡Œ" class="headerlink" title="psync å‘½ä»¤çš„æ‰§è¡Œ"></a>psync å‘½ä»¤çš„æ‰§è¡Œ</h3><p>åœ¨äº†è§£äº†å¤åˆ¶åç§»é‡ã€å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€èŠ‚ç‚¹è¿è¡Œidä¹‹åï¼Œæœ¬èŠ‚å°†ä»‹ç»psyncå‘½ä»¤çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œä»è€Œè¯´æ˜psyncå‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸»ä»èŠ‚ç‚¹æ˜¯å¦‚ä½•ç¡®å®šä½¿ç”¨å…¨é‡å¤åˆ¶è¿˜æ˜¯éƒ¨åˆ†å¤åˆ¶çš„ã€‚<br>psyncå‘½ä»¤æµç¨‹å›¾å¦‚ä¸‹ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1446087-50f80af53e5d7259?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>psyncå‘½ä»¤çš„å¤§ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœä»èŠ‚ç‚¹ä¹‹å‰æ²¡æœ‰å¤åˆ¶è¿‡ä»»ä½•ä¸»èŠ‚ç‚¹ï¼Œæˆ–è€…ä¹‹å‰æ‰§è¡Œè¿‡slaveof no oneå‘½ä»¤ï¼Œä»èŠ‚ç‚¹å°±ä¼šå‘ä¸»èŠ‚ç‚¹å‘é€<code>psync</code>å‘½ä»¤ï¼Œè¯·æ±‚ä¸»èŠ‚ç‚¹è¿›è¡Œæ•°æ®çš„å…¨é‡åŒæ­¥</li><li>å¦‚æœå‰é¢ä»èŠ‚ç‚¹å·²ç»åŒæ­¥è¿‡éƒ¨åˆ†æ•°æ®ï¼Œæ­¤æ—¶ä»èŠ‚ç‚¹å°±ä¼šå‘é€psync {runid} {offset}å‘½ä»¤ç»™ä¸»èŠ‚ç‚¹ï¼Œå…¶ä¸­runidæ˜¯ä¸Šä¸€æ¬¡ä¸»èŠ‚ç‚¹çš„è¿è¡ŒIDï¼Œoffsetæ˜¯å½“å‰ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡</li></ul><p>ä¸»èŠ‚ç‚¹æ”¶åˆ°psyncå‘½ä»¤åï¼Œä¼šå‡ºç°ä»¥ä¸‹ä¸‰ç§å¯èƒ½ï¼š</p><ul><li>ä¸»èŠ‚ç‚¹è¿”å› fullresync {runid} {offset}å›å¤ï¼Œè¡¨ç¤ºä¸»èŠ‚ç‚¹è¦æ±‚ä¸ä»èŠ‚ç‚¹è¿›è¡Œæ•°æ®çš„å®Œæ•´å…¨é‡å¤åˆ¶ï¼Œå…¶ä¸­runidè¡¨ç¤ºä¸»èŠ‚ç‚¹çš„è¿è¡ŒIDï¼Œoffsetè¡¨ç¤ºå½“å‰ä¸»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡</li><li>å¦‚æœä¸»æœåŠ¡å™¨è¿”å› +continueï¼Œè¡¨ç¤ºä¸»èŠ‚ç‚¹ä¸ä»èŠ‚ç‚¹ä¼šè¿›è¡Œéƒ¨åˆ†æ•°æ®çš„åŒæ­¥æ“ä½œï¼Œå°†ä»æœåŠ¡å™¨ç¼ºå¤±çš„æ•°æ®å¤åˆ¶è¿‡æ¥å³å¯</li><li>å¦‚æœä¸»æœåŠ¡å™¨è¿”å› -errï¼Œè¡¨ç¤ºä¸»æœåŠ¡å™¨çš„Redisç‰ˆæœ¬ä½äº2.8ï¼Œæ— æ³•è¯†åˆ«psyncå‘½ä»¤ï¼Œæ­¤æ—¶ä»æœåŠ¡å™¨ä¼šå‘ä¸»æœåŠ¡å™¨å‘é€syncå‘½ä»¤ï¼Œè¿›è¡Œå®Œæ•´çš„æ•°æ®å…¨é‡å¤åˆ¶</li></ul><h2 id="å¿ƒè·³æ£€æµ‹æœºåˆ¶"><a href="#å¿ƒè·³æ£€æµ‹æœºåˆ¶" class="headerlink" title="å¿ƒè·³æ£€æµ‹æœºåˆ¶"></a>å¿ƒè·³æ£€æµ‹æœºåˆ¶</h2><p>å¿ƒè·³æ£€æµ‹æœºåˆ¶çš„ä½œç”¨æœ‰ä¸‰ä¸ªï¼š</p><ol><li>æ£€æŸ¥ä¸»ä»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥çŠ¶æ€</li><li>è¾…åŠ©å®ç°min-slavesé€‰é¡¹</li><li>æ£€æµ‹å‘½ä»¤ä¸¢å¤±</li></ol><h4 id="æ£€æŸ¥ä¸»ä»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥çŠ¶æ€"><a href="#æ£€æŸ¥ä¸»ä»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥çŠ¶æ€" class="headerlink" title="æ£€æŸ¥ä¸»ä»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥çŠ¶æ€"></a>æ£€æŸ¥ä¸»ä»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥çŠ¶æ€</h4><p>ä¸»èŠ‚ç‚¹ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°æ‰€å±çš„ä»èŠ‚ç‚¹çš„è¿æ¥ä¿¡æ¯ï¼š</p><ul><li>state è¡¨ç¤ºä»èŠ‚ç‚¹çŠ¶æ€</li><li>offset è¡¨ç¤ºå¤åˆ¶åç§»é‡</li><li>lag è¡¨ç¤ºå»¶è¿Ÿå€¼ï¼ˆå‡ ç§’ä¹‹å‰æœ‰è¿‡å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼‰<br><img src="https://upload-images.jianshu.io/upload_images/1446087-9d6ee7dfbf773436.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li></ul><h4 id="è¾…åŠ©å®ç°min-slavesé€‰é¡¹"><a href="#è¾…åŠ©å®ç°min-slavesé€‰é¡¹" class="headerlink" title="è¾…åŠ©å®ç°min-slavesé€‰é¡¹"></a>è¾…åŠ©å®ç°min-slavesé€‰é¡¹</h4><p>Redis.confé…ç½®æ–‡ä»¶ä¸­æœ‰ä¸‹æ–¹ä¸¤ä¸ªå‚æ•°</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># æœªè¾¾åˆ°ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œå†™æ“ä½œå°±ä¸ä¼šè¢«æ‰§è¡Œ</span><br><span class="hljs-meta"># æœ€å°‘åŒ…å«çš„ä»æœåŠ¡å™¨</span><br><span class="hljs-meta"># min-slaves-to-write 3</span><br><span class="hljs-meta"># å»¶è¿Ÿå€¼</span><br><span class="hljs-meta"># min-slaves-max-lag 10</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå°†ä¸¤ä¸ªå‚æ•°çš„æ³¨é‡Šå–æ¶ˆï¼Œé‚£ä¹ˆå¦‚æœä»æœåŠ¡å™¨çš„æ•°é‡å°‘äº3ä¸ªï¼Œæˆ–è€…ä¸‰ä¸ªä»æœåŠ¡å™¨çš„å»¶è¿Ÿï¼ˆlagï¼‰å¤§äºç­‰äº10ç§’æ—¶ï¼Œä¸»æœåŠ¡å™¨éƒ½ä¼šæ‹’ç»æ‰§è¡Œå†™å‘½ä»¤ã€‚</p><h4 id="æ£€æµ‹å‘½ä»¤ä¸¢å¤±"><a href="#æ£€æµ‹å‘½ä»¤ä¸¢å¤±" class="headerlink" title="æ£€æµ‹å‘½ä»¤ä¸¢å¤±"></a>æ£€æµ‹å‘½ä»¤ä¸¢å¤±</h4><p>åœ¨ä»æœåŠ¡å™¨çš„è¿æ¥ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°å¤åˆ¶åç§»é‡ï¼Œå¦‚æœæ­¤æ—¶ä¸»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡ä¸ä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡ä¸ä¸€è‡´æ—¶ï¼Œä¸»æœåŠ¡å™¨ä¼šè¡¥å‘ç¼ºå¤±çš„æ•°æ®ã€‚</p><h2 id="å®è·µä¸­çš„é—®é¢˜"><a href="#å®è·µä¸­çš„é—®é¢˜" class="headerlink" title="å®è·µä¸­çš„é—®é¢˜"></a>å®è·µä¸­çš„é—®é¢˜</h2><h3 id="1-è¯»å†™åˆ†ç¦»åŠå…¶ä¸­çš„é—®é¢˜"><a href="#1-è¯»å†™åˆ†ç¦»åŠå…¶ä¸­çš„é—®é¢˜" class="headerlink" title="1.è¯»å†™åˆ†ç¦»åŠå…¶ä¸­çš„é—®é¢˜"></a>1.è¯»å†™åˆ†ç¦»åŠå…¶ä¸­çš„é—®é¢˜</h3><p>åœ¨ä¸»ä»å¤åˆ¶åŸºç¡€ä¸Šå®ç°çš„è¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥å®ç°Redisçš„è¯»è´Ÿè½½å‡è¡¡ï¼šç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼ˆå¤šä¸ªä»èŠ‚ç‚¹æ—¢å¯ä»¥æé«˜æ•°æ®å†—ä½™ç¨‹åº¦ï¼Œä¹Ÿå¯ä»¥æœ€å¤§åŒ–è¯»è´Ÿè½½èƒ½åŠ›ï¼‰ï¼›åœ¨è¯»è´Ÿè½½è¾ƒå¤§çš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚ä¸‹é¢ä»‹ç»åœ¨ä½¿ç”¨Redisè¯»å†™åˆ†ç¦»æ—¶ï¼Œéœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚</p><p><strong>1. å»¶è¿Ÿä¸ä¸ä¸€è‡´é—®é¢˜</strong><br>å‰é¢å·²ç»è®²åˆ°ï¼Œç”±äºä¸»ä»å¤åˆ¶çš„å‘½ä»¤ä¼ æ’­æ˜¯å¼‚æ­¥çš„ï¼Œå»¶è¿Ÿä¸æ•°æ®çš„ä¸ä¸€è‡´ä¸å¯é¿å…ã€‚å¦‚æœåº”ç”¨å¯¹æ•°æ®ä¸ä¸€è‡´çš„æ¥å—ç¨‹åº¦ç¨‹åº¦è¾ƒä½ï¼Œå¯èƒ½çš„ä¼˜åŒ–æªæ–½åŒ…æ‹¬ï¼šä¼˜åŒ–ä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œç¯å¢ƒï¼ˆå¦‚åœ¨åŒæœºæˆ¿éƒ¨ç½²ï¼‰ï¼›ç›‘æ§ä¸»ä»èŠ‚ç‚¹å»¶è¿Ÿï¼ˆé€šè¿‡offsetï¼‰åˆ¤æ–­ï¼Œå¦‚æœä»èŠ‚ç‚¹å»¶è¿Ÿè¿‡å¤§ï¼Œé€šçŸ¥åº”ç”¨ä¸å†é€šè¿‡è¯¥ä»èŠ‚ç‚¹è¯»å–æ•°æ®ï¼›ä½¿ç”¨é›†ç¾¤åŒæ—¶æ‰©å±•å†™è´Ÿè½½å’Œè¯»è´Ÿè½½ç­‰ã€‚</p><p>åœ¨å‘½ä»¤ä¼ æ’­é˜¶æ®µä»¥å¤–çš„å…¶ä»–æƒ…å†µä¸‹ï¼Œä»èŠ‚ç‚¹çš„æ•°æ®ä¸ä¸€è‡´å¯èƒ½æ›´åŠ ä¸¥é‡ï¼Œä¾‹å¦‚è¿æ¥åœ¨æ•°æ®åŒæ­¥é˜¶æ®µï¼Œæˆ–ä»èŠ‚ç‚¹å¤±å»ä¸ä¸»èŠ‚ç‚¹çš„è¿æ¥æ—¶ç­‰ã€‚ä»èŠ‚ç‚¹çš„slave-serve-stale-dataå‚æ•°ä¾¿ä¸æ­¤æœ‰å…³ï¼šå®ƒæ§åˆ¶è¿™ç§æƒ…å†µä¸‹ä»èŠ‚ç‚¹çš„è¡¨ç°ï¼›å¦‚æœä¸ºyesï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œåˆ™ä»èŠ‚ç‚¹ä»èƒ½å¤Ÿå“åº”å®¢æˆ·ç«¯çš„å‘½ä»¤ï¼Œå¦‚æœä¸ºnoï¼Œåˆ™ä»èŠ‚ç‚¹åªèƒ½å“åº”infoã€slaveofç­‰å°‘æ•°å‘½ä»¤ã€‚è¯¥å‚æ•°çš„è®¾ç½®ä¸åº”ç”¨å¯¹æ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚æœ‰å…³ï¼›å¦‚æœå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜ï¼Œåˆ™åº”è®¾ç½®ä¸ºnoã€‚</p><p><strong>2. æ•°æ®è¿‡æœŸé—®é¢˜</strong><br>åœ¨å•æœºç‰ˆRedisä¸­ï¼Œå­˜åœ¨ä¸¤ç§åˆ é™¤ç­–ç•¥ï¼š</p><p>æƒ°æ€§åˆ é™¤ï¼šæœåŠ¡å™¨ä¸ä¼šä¸»åŠ¨åˆ é™¤æ•°æ®ï¼Œåªæœ‰å½“å®¢æˆ·ç«¯æŸ¥è¯¢æŸä¸ªæ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨åˆ¤æ–­è¯¥æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤ã€‚<br>å®šæœŸåˆ é™¤ï¼šæœåŠ¡å™¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡åˆ é™¤è¿‡æœŸæ•°æ®ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å†…å­˜å’ŒCPUçš„æŠ˜ä¸­ï¼ˆåˆ é™¤ä¼šé‡Šæ”¾å†…å­˜ï¼Œä½†æ˜¯é¢‘ç¹çš„åˆ é™¤æ“ä½œå¯¹CPUä¸å‹å¥½ï¼‰ï¼Œè¯¥åˆ é™¤çš„é¢‘ç‡å’Œæ‰§è¡Œæ—¶é—´éƒ½å—åˆ°äº†é™åˆ¶ã€‚<br>åœ¨ä¸»ä»å¤åˆ¶åœºæ™¯ä¸‹ï¼Œä¸ºäº†ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä»èŠ‚ç‚¹ä¸ä¼šä¸»åŠ¨åˆ é™¤æ•°æ®ï¼Œè€Œæ˜¯ç”±ä¸»èŠ‚ç‚¹æ§åˆ¶ä»èŠ‚ç‚¹ä¸­è¿‡æœŸæ•°æ®çš„åˆ é™¤ã€‚ç”±äºä¸»èŠ‚ç‚¹çš„æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ç­–ç•¥ï¼Œéƒ½ä¸èƒ½ä¿è¯ä¸»èŠ‚ç‚¹åŠæ—¶å¯¹è¿‡æœŸæ•°æ®æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œå› æ­¤ï¼Œå½“å®¢æˆ·ç«¯é€šè¿‡Redisä»èŠ‚ç‚¹è¯»å–æ•°æ®æ—¶ï¼Œå¾ˆå®¹æ˜“è¯»å–åˆ°å·²ç»è¿‡æœŸçš„æ•°æ®ã€‚</p><p>Redis 3.2ä¸­ï¼Œä»èŠ‚ç‚¹åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå¢åŠ äº†å¯¹æ•°æ®æ˜¯å¦è¿‡æœŸçš„åˆ¤æ–­ï¼šå¦‚æœè¯¥æ•°æ®å·²è¿‡æœŸï¼Œåˆ™ä¸è¿”å›ç»™å®¢æˆ·ç«¯ï¼›å°†Rediså‡çº§åˆ°3.2å¯ä»¥è§£å†³æ•°æ®è¿‡æœŸé—®é¢˜ã€‚</p><p><strong>3. æ•…éšœåˆ‡æ¢é—®é¢˜</strong><br>åœ¨æ²¡æœ‰ä½¿ç”¨å“¨å…µçš„è¯»å†™åˆ†ç¦»åœºæ™¯ä¸‹ï¼Œåº”ç”¨é’ˆå¯¹è¯»å’Œå†™åˆ†åˆ«è¿æ¥ä¸åŒçš„RedisèŠ‚ç‚¹ï¼›å½“ä¸»èŠ‚ç‚¹æˆ–ä»èŠ‚ç‚¹å‡ºç°é—®é¢˜è€Œå‘ç”Ÿæ›´æ”¹æ—¶ï¼Œéœ€è¦åŠæ—¶ä¿®æ”¹åº”ç”¨ç¨‹åºè¯»å†™Redisæ•°æ®çš„è¿æ¥ï¼›è¿æ¥çš„åˆ‡æ¢å¯ä»¥æ‰‹åŠ¨è¿›è¡Œï¼Œæˆ–è€…è‡ªå·±å†™ç›‘æ§ç¨‹åºè¿›è¡Œåˆ‡æ¢ï¼Œä½†å‰è€…å“åº”æ…¢ã€å®¹æ˜“å‡ºé”™ï¼Œåè€…å®ç°å¤æ‚ï¼Œæˆæœ¬éƒ½ä¸ç®—ä½ã€‚</p><p><strong>4. æ€»ç»“</strong><br>åœ¨ä½¿ç”¨è¯»å†™åˆ†ç¦»ä¹‹å‰ï¼Œå¯ä»¥è€ƒè™‘å…¶ä»–æ–¹æ³•å¢åŠ Redisçš„è¯»è´Ÿè½½èƒ½åŠ›ï¼šå¦‚å°½é‡ä¼˜åŒ–ä¸»èŠ‚ç‚¹ï¼ˆå‡å°‘æ…¢æŸ¥è¯¢ã€å‡å°‘æŒä¹…åŒ–ç­‰å…¶ä»–æƒ…å†µå¸¦æ¥çš„é˜»å¡ç­‰ï¼‰æé«˜è´Ÿè½½èƒ½åŠ›ï¼›ä½¿ç”¨Redisé›†ç¾¤åŒæ—¶æé«˜è¯»è´Ÿè½½èƒ½åŠ›å’Œå†™è´Ÿè½½èƒ½åŠ›ç­‰ã€‚å¦‚æœä½¿ç”¨è¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ä½¿ç”¨å“¨å…µï¼Œä½¿ä¸»ä»èŠ‚ç‚¹çš„æ•…éšœåˆ‡æ¢å°½å¯èƒ½è‡ªåŠ¨åŒ–ï¼Œå¹¶å‡å°‘å¯¹åº”ç”¨ç¨‹åºçš„ä¾µå…¥ã€‚</p><h3 id="2-å¤åˆ¶è¶…æ—¶é—®é¢˜"><a href="#2-å¤åˆ¶è¶…æ—¶é—®é¢˜" class="headerlink" title="2. å¤åˆ¶è¶…æ—¶é—®é¢˜"></a>2. å¤åˆ¶è¶…æ—¶é—®é¢˜</h3><p>ä¸»ä»èŠ‚ç‚¹å¤åˆ¶è¶…æ—¶æ˜¯å¯¼è‡´å¤åˆ¶ä¸­æ–­çš„æœ€é‡è¦çš„åŸå› ä¹‹ä¸€ï¼Œæœ¬å°èŠ‚å•ç‹¬è¯´æ˜è¶…æ—¶é—®é¢˜ï¼Œä¸‹ä¸€å°èŠ‚è¯´æ˜å…¶ä»–ä¼šå¯¼è‡´å¤åˆ¶ä¸­æ–­çš„é—®é¢˜ã€‚</p><p>è¶…æ—¶åˆ¤æ–­æ„ä¹‰</p><p>åœ¨å¤åˆ¶è¿æ¥å»ºç«‹è¿‡ç¨‹ä¸­åŠä¹‹åï¼Œä¸»ä»èŠ‚ç‚¹éƒ½æœ‰æœºåˆ¶åˆ¤æ–­è¿æ¥æ˜¯å¦è¶…æ—¶ï¼Œå…¶æ„ä¹‰åœ¨äºï¼š</p><ol><li><p>å¦‚æœä¸»èŠ‚ç‚¹åˆ¤æ–­è¿æ¥è¶…æ—¶ï¼Œå…¶ä¼šé‡Šæ”¾ç›¸åº”ä»èŠ‚ç‚¹çš„è¿æ¥ï¼Œä»è€Œé‡Šæ”¾å„ç§èµ„æºï¼Œå¦åˆ™æ— æ•ˆçš„ä»èŠ‚ç‚¹ä»ä¼šå ç”¨ä¸»èŠ‚ç‚¹çš„å„ç§èµ„æºï¼ˆè¾“å‡ºç¼“å†²åŒºã€å¸¦å®½ã€è¿æ¥ç­‰ï¼‰ï¼›æ­¤å¤–è¿æ¥è¶…æ—¶çš„åˆ¤æ–­å¯ä»¥è®©ä¸»èŠ‚ç‚¹æ›´å‡†ç¡®çš„çŸ¥é“å½“å‰æœ‰æ•ˆä»èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œæœ‰åŠ©äºä¿è¯æ•°æ®å®‰å…¨ï¼ˆé…åˆå‰é¢è®²åˆ°çš„min-slaves-to-writeç­‰å‚æ•°ï¼‰ã€‚</p></li><li><p>å¦‚æœä»èŠ‚ç‚¹åˆ¤æ–­è¿æ¥è¶…æ—¶ï¼Œåˆ™å¯ä»¥åŠæ—¶é‡æ–°å»ºç«‹è¿æ¥ï¼Œé¿å…ä¸ä¸»èŠ‚ç‚¹æ•°æ®é•¿æœŸçš„ä¸ä¸€è‡´ã€‚</p></li></ol><p>åˆ¤æ–­æœºåˆ¶</p><p>ä¸»ä»å¤åˆ¶è¶…æ—¶åˆ¤æ–­çš„æ ¸å¿ƒï¼Œåœ¨äºrepl-timeoutå‚æ•°ï¼Œè¯¥å‚æ•°è§„å®šäº†è¶…æ—¶æ—¶é—´çš„é˜ˆå€¼ï¼ˆé»˜è®¤60sï¼‰ï¼Œå¯¹äºä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹åŒæ—¶æœ‰æ•ˆï¼›ä¸»ä»èŠ‚ç‚¹è§¦å‘è¶…æ—¶çš„æ¡ä»¶åˆ†åˆ«å¦‚ä¸‹ï¼š</p><ol><li><p>ä¸»èŠ‚ç‚¹ï¼šæ¯ç§’1æ¬¡è°ƒç”¨å¤åˆ¶å®šæ—¶å‡½æ•°replicationCron()ï¼Œåœ¨å…¶ä¸­åˆ¤æ–­å½“å‰æ—¶é—´è·ç¦»ä¸Šæ¬¡æ”¶åˆ°å„ä¸ªä»èŠ‚ç‚¹REPLCONF ACKçš„æ—¶é—´ï¼Œæ˜¯å¦è¶…è¿‡äº†repl-timeoutå€¼ï¼Œå¦‚æœè¶…è¿‡äº†åˆ™é‡Šæ”¾ç›¸åº”ä»èŠ‚ç‚¹çš„è¿æ¥ã€‚</p></li><li><p>ä»èŠ‚ç‚¹ï¼šä»èŠ‚ç‚¹å¯¹è¶…æ—¶çš„åˆ¤æ–­åŒæ ·æ˜¯åœ¨å¤åˆ¶å®šæ—¶å‡½æ•°ä¸­åˆ¤æ–­ï¼ŒåŸºæœ¬é€»è¾‘æ˜¯ï¼š</p><ul><li>å¦‚æœå½“å‰å¤„äºè¿æ¥å»ºç«‹é˜¶æ®µï¼Œä¸”è·ç¦»ä¸Šæ¬¡æ”¶åˆ°ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯çš„æ—¶é—´å·²è¶…è¿‡repl-timeoutï¼Œåˆ™é‡Šæ”¾ä¸ä¸»èŠ‚ç‚¹çš„è¿æ¥ï¼›</li><li>å¦‚æœå½“å‰å¤„äºæ•°æ®åŒæ­¥é˜¶æ®µï¼Œä¸”æ”¶åˆ°ä¸»èŠ‚ç‚¹çš„RDBæ–‡ä»¶çš„æ—¶é—´è¶…æ—¶ï¼Œåˆ™åœæ­¢æ•°æ®åŒæ­¥ï¼Œé‡Šæ”¾è¿æ¥ï¼›</li><li>å¦‚æœå½“å‰å¤„äºå‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä¸”è·ç¦»ä¸Šæ¬¡æ”¶åˆ°ä¸»èŠ‚ç‚¹çš„PINGå‘½ä»¤æˆ–æ•°æ®çš„æ—¶é—´å·²è¶…è¿‡repl-timeoutå€¼ï¼Œåˆ™é‡Šæ”¾ä¸ä¸»èŠ‚ç‚¹çš„è¿æ¥ã€‚</li></ul></li></ol><p><strong>éœ€è¦æ³¨æ„çš„å‘</strong></p><p>ä¸‹é¢ä»‹ç»ä¸å¤åˆ¶é˜¶æ®µè¿æ¥è¶…æ—¶æœ‰å…³çš„ä¸€äº›å®é™…é—®é¢˜ï¼š</p><ol><li><p>æ•°æ®åŒæ­¥é˜¶æ®µï¼šåœ¨ä¸»ä»èŠ‚ç‚¹è¿›è¡Œå…¨é‡å¤åˆ¶bgsaveæ—¶ï¼Œä¸»èŠ‚ç‚¹éœ€è¦é¦–å…ˆforkå­è¿›ç¨‹å°†å½“å‰æ•°æ®ä¿å­˜åˆ°RDBæ–‡ä»¶ä¸­ï¼Œç„¶åå†å°†RDBæ–‡ä»¶é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°ä»èŠ‚ç‚¹ã€‚å¦‚æœRDBæ–‡ä»¶è¿‡å¤§ï¼Œä¸»èŠ‚ç‚¹åœ¨forkå­è¿›ç¨‹+ä¿å­˜RDBæ–‡ä»¶æ—¶è€—æ—¶è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»èŠ‚ç‚¹é•¿æ—¶é—´æ”¶ä¸åˆ°æ•°æ®è€Œè§¦å‘è¶…æ—¶ï¼›æ­¤æ—¶ä»èŠ‚ç‚¹ä¼šé‡è¿ä¸»èŠ‚ç‚¹ï¼Œç„¶åå†æ¬¡å…¨é‡å¤åˆ¶ï¼Œå†æ¬¡è¶…æ—¶ï¼Œå†æ¬¡é‡è¿â€¦â€¦è¿™æ˜¯ä¸ªæ‚²ä¼¤çš„å¾ªç¯ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œé™¤äº†æ³¨æ„Rediså•æœºæ•°æ®é‡ä¸è¦è¿‡å¤§ï¼Œå¦ä¸€æ–¹é¢å°±æ˜¯é€‚å½“å¢å¤§repl-timeoutå€¼ï¼Œå…·ä½“çš„å¤§å°å¯ä»¥æ ¹æ®bgsaveè€—æ—¶æ¥è°ƒæ•´ã€‚</p></li><li><p>å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼šå¦‚å‰æ‰€è¿°ï¼Œåœ¨è¯¥é˜¶æ®µä¸»èŠ‚ç‚¹ä¼šå‘ä»èŠ‚ç‚¹å‘é€PINGå‘½ä»¤ï¼Œé¢‘ç‡ç”±repl-ping-slave-periodæ§åˆ¶ï¼›è¯¥å‚æ•°åº”æ˜æ˜¾å°äºrepl-timeoutå€¼(åè€…è‡³å°‘æ˜¯å‰è€…çš„å‡ å€)ã€‚å¦åˆ™ï¼Œå¦‚æœä¸¤ä¸ªå‚æ•°ç›¸ç­‰æˆ–æ¥è¿‘ï¼Œç½‘ç»œæŠ–åŠ¨å¯¼è‡´ä¸ªåˆ«PINGå‘½ä»¤ä¸¢å¤±ï¼Œæ­¤æ—¶æ°å·§ä¸»èŠ‚ç‚¹ä¹Ÿæ²¡æœ‰å‘ä»èŠ‚ç‚¹å‘é€æ•°æ®ï¼Œåˆ™ä»èŠ‚ç‚¹å¾ˆå®¹æ˜“åˆ¤æ–­è¶…æ—¶ã€‚</p></li><li><p>æ…¢æŸ¥è¯¢å¯¼è‡´çš„é˜»å¡ï¼šå¦‚æœä¸»èŠ‚ç‚¹æˆ–ä»èŠ‚ç‚¹æ‰§è¡Œäº†ä¸€äº›æ…¢æŸ¥è¯¢ï¼ˆå¦‚keys *æˆ–è€…å¯¹å¤§æ•°æ®çš„hgetallç­‰ï¼‰ï¼Œå¯¼è‡´æœåŠ¡å™¨é˜»å¡ï¼›é˜»å¡æœŸé—´æ— æ³•å“åº”å¤åˆ¶è¿æ¥ä¸­å¯¹æ–¹èŠ‚ç‚¹çš„è¯·æ±‚ï¼Œå¯èƒ½å¯¼è‡´å¤åˆ¶è¶…æ—¶ã€‚</p></li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Redis é«˜å¯ç”¨ç³»åˆ—çš„ç¬¬äºŒå¼¹ï¼šä¸»ä»å¤åˆ¶çš„æ ¸å¿ƒå†…å®¹å·²ç»è®²è§£å®Œæ¯•äº†ï¼Œå¸Œæœ›å¤§å®¶é˜…è¯»å®Œä¼šæœ‰ä¸€ç‚¹æ”¶è·ï¼Œå¦å¤–å¦‚æœå¤§å®¶è§‰å¾—çœ‹å®Œæ–‡ç« æœ‰å¸®åŠ©çš„è¯ï¼Œå¯ä»¥ç‚¹èµï¼Œæ”¶è—å¾®å¾®è¡¨ç¤ºä¸€ä¸‹æ”¯æŒï¼Œå¥½è®©æˆ‘èƒ½æœ‰åŠ¨åŠ›ç»§ç»­å†™æŠ€æœ¯æ–‡ç« ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>rabbitmqctl å‘½ä»¤æŒ‡å—</title>
    <link href="/article/f5d79d26.html"/>
    <url>/article/f5d79d26.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><h1 id="åç§°"><a href="#åç§°" class="headerlink" title="åç§°"></a>åç§°</h1><p>rabbitmqctl â€” ç”¨äºç®¡ç†ä¸­é—´ä»¶çš„å‘½ä»¤è¡Œå·¥å…·</p><h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><p>rabbitmqctl [-nÂ _node_] [-tÂ _timeout_] [-q] {<em>command</em>} [<em>command options</em>â€¦]</p><h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>RabbitMQæ˜¯AMQPçš„å®ç°, åè€…æ˜¯é«˜æ€§èƒ½ä¼ä¸šæ¶ˆæ¯é€šä¿¡çš„æ–°å…´æ ‡å‡†. RabbitMQ serveræ˜¯AMQP ä¸­é—´ä»¶å¥å£®çš„ï¼Œå¯æ‰©å±•çš„å®ç°.</p><p><strong>rabbitmqctl</strong>Â ç”¨æ¥ç®¡ç†RabbitMQä¸­é—´ä»¶çš„å‘½ä»¤è¡Œå·¥å…·.å®ƒé€šè¿‡è¿æ¥ä¸­é—´ä»¶èŠ‚ç‚¹æ¥æ‰§è¡Œæ‰€æœ‰æ“ä½œã€‚</p><p>å¦‚æœä¸­é—´ä»¶æ²¡æœ‰è¿è¡Œï¼Œå°†ä¼šæ˜¾ç¤ºè¯Šæ–­ä¿¡æ¯, ä¸èƒ½åˆ°è¾¾ï¼Œæˆ–å› ä¸åŒ¹é…Erlang cookieè€Œæ‹’ç»è¿æ¥.</p><h2 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h2><p>[-nÂ _node_]</p><p>é»˜è®¤èŠ‚ç‚¹æ˜¯â€rabbit@serverâ€,æ­¤å¤„çš„serveræ˜¯æœ¬åœ°ä¸»æœº. åœ¨ä¸€ä¸ªåä¸ºâ€server.example.comâ€çš„ä¸»æœºä¸Š, RabbitMQ Erlang node çš„èŠ‚ç‚¹åç§°é€šå¸¸æ˜¯rabbit@server (é™¤éRABBITMQ_NODENAMEåœ¨å¯åŠ¨æ—¶è®¾ç½®äº†éé»˜è®¤å€¼).Â <strong>hostname -s</strong>Â çš„è¾“å‡ºé€šå¸¸æ˜¯â€@â€ æ ‡å¿—åçš„ä¸œè¥¿.æŸ¥çœ‹rabbitmq-server(1)æ¥äº†è§£é…ç½®RabbitMQ brokerçš„ç»†èŠ‚.</p><p>[-q]</p><p>ä½¿ç”¨-qæ ‡å¿—æ¥å¯ç”¨å®é™(quiet)æ¨¡å¼ï¼Œè¿™ä¼šä¸€è‡´æ¶ˆæ¯è¾“å‡º.</p><p>[-tÂ _timeout_]</p><p>æ“ä½œè¶…æ—¶æ—¶é—´ï¼ˆç§’ä¸ºå•ä½ï¼‰. åªé€‚ç”¨äºâ€listâ€ å‘½ä»¤. é»˜è®¤æ˜¯æ— ç©·å¤§.</p><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><h3 id="åº”ç”¨ç¨‹åºå’Œé›†ç¾¤ç®¡ç†"><a href="#åº”ç”¨ç¨‹åºå’Œé›†ç¾¤ç®¡ç†" class="headerlink" title="åº”ç”¨ç¨‹åºå’Œé›†ç¾¤ç®¡ç†"></a>åº”ç”¨ç¨‹åºå’Œé›†ç¾¤ç®¡ç†</h3><h3 id="stop-pid-file"><a href="#stop-pid-file" class="headerlink" title="stopÂ [_pid_file_]"></a>stopÂ [_pid_file_]</h3><p>ç”¨äºåœæ­¢è¿è¡ŒRabbitMQçš„Erlang node.å¦‚æœæŒ‡å®šäº†pid_fileï¼Œè¿˜å°†ç­‰å¾…æŒ‡å®šçš„è¿‡ç¨‹ç»“æŸã€‚ä¾‹å¦‚ï¼š</p><p>rabbitmqctl stop</p><p>æ­¤å‘½ä»¤ä¼šç»ˆæ­¢RabbitMQ nodeçš„è¿è¡Œ.</p><p>stop_app</p><p>åœæ­¢RabbitMQ application,ä½†Erlang nodeä¼šç»§ç»­è¿è¡Œ.æ­¤å‘½ä»¤ä¸»è¦ç”¨äºä¼˜å…ˆæ‰§è¡Œå…¶å®ƒç®¡ç†æ“ä½œï¼ˆè¿™äº›ç®¡ç†æ“ä½œéœ€è¦å…ˆåœæ­¢RabbitMQ applicationï¼‰ï¼Œå¦‚.Â <a href="http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#reset"><strong>reset</strong></a>.ä¾‹å¦‚ï¼š</p><p>rabbitmqctl stop_app</p><p>start_app</p><p>å¯åŠ¨RabbitMQ application.</p><p>æ­¤å‘½ä»¤å…¸å‹ç”¨äºåœ¨æ‰§è¡Œäº†å…¶å®ƒç®¡ç†æ“ä½œä¹‹åï¼Œé‡æ–°å¯åŠ¨åœæ­¢çš„RabbitMQ applicationã€‚å¦‚<a href="http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#reset"><strong>reset</strong></a>.ä¾‹å¦‚ï¼š</p><p>rabbitmqctl start_app</p><p>æ­¤å‘½ä»¤æ¥æŒ‡å¯¼RabbitMQ nodeæ¥å¯åŠ¨RabbitMQ application.</p><p>wait {<em>pid_file</em>}</p><p>ç­‰å¾…RabbitMQ applicationå¯åŠ¨.æ­¤å‘½ä»¤ç”¨æ¥ç­‰å¾…RabbitMQ applicationæ¥å¯åŠ¨nodeã€‚å®ƒä¼šç­‰å¾…åˆ›å»ºpidæ–‡ä»¶ï¼Œç„¶åç­‰å¾…pidæ–‡ä»¶ä¸­çš„ç‰¹å®špidè¿‡ç¨‹å¯åŠ¨ï¼Œæœ€åç­‰å¾…RabbitMQÂ Â application æ¥å¯åŠ¨node.Â </p><p>pid fileæ˜¯é€šè¿‡<strong>rabbitmq-server</strong>Â è„šæœ¬æ¥åˆ›å»ºçš„.é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå­˜æ”¾äºMnesiaç›®å½•ä¸­. ä¿®æ”¹<strong>RABBITMQ_PID_FILE</strong>Â ç¯å¢ƒå˜é‡å¯ä»¥æ”¹å˜æ­¤ä½ç½®ã€‚å¦‚ï¼š</p><p>rabbitmqctl wait &#x2F;var&#x2F;run&#x2F;rabbitmq&#x2F;pid</p><p>æ­¤å‘½ä»¤ä¼šåœ¨RabbitMQ nodeå¯åŠ¨åè¿”å›.</p><p>reset</p><p>å°†RabbitMQ nodeè¿˜åŸåˆ°æœ€åˆçŠ¶æ€.åŒ…æ‹¬ä»æ‰€åœ¨ç¾¤é›†ä¸­åˆ é™¤æ­¤node,ä»ç®¡ç†æ•°æ®åº“ä¸­åˆ é™¤æ‰€æœ‰é…ç½®æ•°æ®ï¼Œå¦‚å·²é…ç½®çš„ç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœºï¼Œä»¥åŠåˆ é™¤æ‰€æœ‰æŒä¹…åŒ–æ¶ˆæ¯.</p><p>æ‰§è¡Œ<strong>resetå’Œ****force_resetä¹‹å‰ï¼Œå¿…é¡»åœæ­¢</strong>RabbitMQ application ,å¦‚ä½¿ç”¨<a href="http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#stop_app"><strong>stop_app</strong></a>.</p><p>ç¤ºä¾‹:</p><p>rabbitmqctl reset</p><p>æ­¤å‘½ä»¤ä¼šé‡è®¾RabbitMQã€€node.</p><p>force_reset</p><p>å¼ºåˆ¶RabbitMQ nodeè¿˜åŸåˆ°æœ€åˆçŠ¶æ€.</p><p>ä¸åŒäº<strong>reset</strong>Â ï¼ŒÂ <strong>force_reset</strong>Â å‘½ä»¤ä¼šæ— æ¡ä»¶åœ°é‡è®¾node,ä¸è®ºå½“å‰ç®¡ç†æ•°æ®åº“çš„çŠ¶æ€å’Œé›†ç¾¤é…ç½®æ˜¯ä»€ä¹ˆ. å®ƒåªèƒ½åœ¨æ•°æ®åº“æˆ–é›†ç¾¤é…ç½®å·²æŸåçš„æƒ…å†µä¸‹æ‰å¯ä½¿ç”¨ã€‚</p><p>æ‰§è¡Œ<strong>resetå’Œ****force_resetä¹‹å‰ï¼Œå¿…é¡»åœæ­¢</strong>RabbitMQ application ,å¦‚ä½¿ç”¨<a href="http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#stop_app"><strong>stop_app</strong></a>.</p><p>ç¤ºä¾‹:</p><p>rabbitmqctl force_reset</p><p>æ­¤å‘½ä»¤ä¼šé‡è®¾RabbitMQnode.</p><p>rotate_logs {<em>suffix</em>}</p><p>æŒ‡ç¤ºRabbitMQ nodeå¾ªç¯æ—¥å¿—æ–‡ä»¶.</p><p>RabbitMQ ä¸­é—´ä»¶ä¼šå°†åŸæ¥æ—¥å¿—æ–‡ä»¶ä¸­çš„å†…å®¹è¿½åŠ åˆ°åŸå§‹åç§°å’Œåè¾çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç„¶åå†å°†åŸå§‹æ—¥å¿—æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„æ—¥å¿—ä¸Šã€‚å®é™…ä¸Šï¼Œå½“å‰æ—¥å¿—å†…å®¹ä¼šç§»åˆ°ä»¥æ­¤åè¾ç»“å°¾çš„æ–‡ä»¶ä¸Šã€‚å½“ç›®æ ‡æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œå°†ä¼šè¿›è¡Œåˆ›å»ºã€‚å¦‚æœä¸æŒ‡å®šåè¾ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿå¾ªç¯ï¼Œæ—¥å¿—æ–‡ä»¶åªæ˜¯é‡æ–°æ‰“å¼€ã€‚ç¤ºä¾‹ï¼š</p><p>rabbitmqctl rotate_logs .1</p><p>æ­¤å‘½ä»¤æŒ‡ç¤ºRabbitMQ nodeå°†æ—¥å¿—æ–‡ä»¶çš„å†…å®¹è¿½åŠ åˆ°æ–°æ—¥å¿—æ–‡ä»¶ï¼ˆæ–‡ä»¶åç”±åŸæ—¥å¿—æ–‡ä»¶åå’Œ.1åè¾æ„æˆï¼‰ä¸­ã€‚å¦‚. <a href="mailto:&#114;&#97;&#x62;&#x62;&#x69;&#116;&#x40;&#109;&#x79;&#x6d;&#97;&#x63;&#104;&#x69;&#x6e;&#x65;&#46;&#108;&#x6f;&#x67;&#x2e;&#x31;">&#114;&#97;&#x62;&#x62;&#x69;&#116;&#x40;&#109;&#x79;&#x6d;&#97;&#x63;&#104;&#x69;&#x6e;&#x65;&#46;&#108;&#x6f;&#x67;&#x2e;&#x31;</a> å’Œ <a href="mailto:&#x72;&#x61;&#x62;&#x62;&#x69;&#116;&#x40;&#109;&#121;&#x6d;&#x61;&#x63;&#104;&#x69;&#110;&#x65;&#x2d;&#115;&#97;&#115;&#108;&#46;&#x6c;&#111;&#103;&#46;&#x31;">&#x72;&#x61;&#x62;&#x62;&#x69;&#116;&#x40;&#109;&#121;&#x6d;&#x61;&#x63;&#104;&#x69;&#110;&#x65;&#x2d;&#115;&#97;&#115;&#108;&#46;&#x6c;&#111;&#103;&#46;&#x31;</a>. æœ€å, æ—¥å¿—ä¼šåœ¨åŸå§‹ä½ç½®æ¢å¤åˆ°æ–°æ–‡ä»¶ä¸­.</p><h3 id="é›†ç¾¤ç®¡ç†"><a href="#é›†ç¾¤ç®¡ç†" class="headerlink" title="é›†ç¾¤ç®¡ç†"></a>é›†ç¾¤ç®¡ç†</h3><p>join_cluster {<em>clusternode</em>} [â€“ram]</p><p>clusternode</p><p>åŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹.</p><p>[â€“ram]</p><p>å¦‚æœè¿›è¡Œäº†è®¾ç½®ï¼ŒèŠ‚ç‚¹å°†ä»¥RAMèŠ‚ç‚¹èº«ä»½åŠ å…¥é›†ç¾¤.</p><p>æŒ‡å¯¼èŠ‚ç‚¹æˆä¸ºé›†ç¾¤ä¸­çš„ä¸€å‘˜. åœ¨åŠ å…¥é›†ç¾¤ä¹‹å‰ï¼ŒèŠ‚ç‚¹ä¼šé‡ç½®,å› æ­¤åœ¨ä½¿ç”¨æ­¤å‘½ä»¤æ—¶ï¼Œå¿…é¡»å°å¿ƒ. è¿™ä¸ªå‘½ä»¤è¦æˆåŠŸ,RabbitMQåº”ç”¨ç¨‹åºå¿…é¡»å…ˆåœæ­¢,å¦‚<a href="http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#stop_app"><strong>stop_app</strong></a>.</p><p>é›†ç¾¤èŠ‚ç‚¹å¯ä»¥æ˜¯ä¸¤ç§ç±»å‹: ç£ç›˜èŠ‚ç‚¹(Disc Node) æˆ– å†…å­˜èŠ‚ç‚¹(RAM Node).ç£ç›˜èŠ‚ç‚¹ä¼šåœ¨RAMå’Œç£ç›˜ä¸­å¤åˆ¶æ•°æ®, é€šè¿‡å†—ä½™å¯ä»¥é˜²æ­¢èŠ‚ç‚¹å¤±æ•ˆäº‹ä»¶ï¼Œå¹¶å¯ä»æ–­ç”µè¿™ç§å…¨å±€äº‹ä»¶ä¸­è¿›è¡Œæ¢å¤. RAMèŠ‚ç‚¹åªåœ¨RAMä¸­å¤åˆ¶æ•°æ®(é™¤äº†é˜Ÿåˆ—çš„å†…å®¹å¤–ï¼Œè¿˜ä¾èµ–äºé˜Ÿåˆ—æ˜¯å¦æ˜¯æŒä¹…åŒ–çš„æˆ–è€…å†…å®¹å¯¹äºå†…å­˜æ¥è¯´æ˜¯å¦è¿‡å¤§) ï¼Œå¹¶ä¸»è¦ç”¨äºå¯ä¼¸ç¼©æ€§. RAMèŠ‚ç‚¹åªæœ‰å½“ç®¡ç†èµ„æº(å¦‚ï¼Œå¢åŠ &#x2F;åˆ é™¤é˜Ÿåˆ—,äº¤æ¢æœº,æˆ–ç»‘å®š)çš„æ—¶å€™æ‰å…·æœ‰æ›´é«˜çš„æ€§èƒ½.ä¸€ä¸ªé›†ç¾¤å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹ï¼Œé€šå¸¸æ¥è¯´è¿˜ä¸æ­¢ä¸€ä¸ª.</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹æ˜¯ç£ç›˜èŠ‚ç‚¹.å¦‚æœä½ æƒ³è¦åˆ›å»ºå†…å­˜èŠ‚ç‚¹,éœ€è¦æä¾›<strong>--ram</strong>Â æ ‡å¿—.</p><p>åœ¨æ‰§è¡Œ<strong>cluster</strong>å‘½ä»¤ä¹‹å, æ— è®ºä½•æ—¶ï¼Œå½“å‰èŠ‚ç‚¹ä¸Šå¯åŠ¨çš„RabbitMQ åº”ç”¨ç¨‹åºåœ¨èŠ‚ç‚¹å®•æœºçš„æƒ…å†µä¸‹ï¼Œä¼šå°è¯•è¿æ¥é›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹ã€‚</p><p>è¦è„±ç¦»é›†ç¾¤, å¿…é¡»é‡è®¾(reset)èŠ‚ç‚¹. ä½ ä¹Ÿå¯ä»¥é€šè¿‡<strong>forget_cluster_node</strong>Â å‘½ä»¤æ¥è¿œç¨‹åˆ é™¤èŠ‚ç‚¹.</p><p>æ›´å¤šè¯¦æƒ…ï¼Œå‚è€ƒ<a href="http://www.rabbitmq.com/clustering.html">é›†ç¾¤æŒ‡å—</a>.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl join_cluster hare@elena â€“ram</p><p>æ­¤å‘½ä»¤ç”¨äºæŒ‡ç¤ºRabbitMQ nodeä»¥ramèŠ‚ç‚¹çš„å½¢å¼å°†Â <strong>hare@elena</strong>Â åŠ å…¥é›†ç¾¤.</p><p>cluster_status</p><p>æŒ‰èŠ‚ç‚¹ç±»å‹æ¥åˆ†ç»„å±•ç¤ºé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬å½“å‰è¿è¡Œçš„èŠ‚ç‚¹.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl cluster_status</p><p>æ­¤å‘½ä»¤ä¼šæ˜¾ç¤ºé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹.</p><p>change_cluster_node_type {disc | ram}</p><p>ä¿®æ”¹é›†ç¾¤èŠ‚ç‚¹çš„ç±»å‹. è¦æˆåŠŸæ‰§è¡Œæ­¤æ“ä½œï¼Œå¿…é¡»é¦–å…ˆåœæ­¢èŠ‚ç‚¹ï¼Œè¦å°†èŠ‚ç‚¹è½¬æ¢ä¸ºRAMèŠ‚ç‚¹ï¼Œåˆ™æ­¤èŠ‚ç‚¹ä¸èƒ½æ˜¯é›†ç¾¤ä¸­çš„å”¯ä¸€discèŠ‚ç‚¹ã€‚</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl change_cluster_node_type disc</p><p>æ­¤å‘½ä»¤ä¼šå°†ä¸€ä¸ªRAMèŠ‚ç‚¹è½¬æ¢ä¸ºdiscèŠ‚ç‚¹.</p><p>forget_cluster_node [â€“offline]</p><p>[â€“offline]</p><p>å…è®¸èŠ‚ç‚¹ä»è„±æœºèŠ‚ç‚¹ä¸­åˆ é™¤. è¿™åªåœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ½è„±æœºä¸”æœ€åä¸€ä¸ªæ‰çº¿èŠ‚ç‚¹ä¸èƒ½å†ä¸Šçº¿çš„æƒ…å†µä¸‹æœ‰ç”¨ï¼Œä»è€Œé˜²æ­¢æ•´ä¸ªé›†ç¾¤ä»å¯åŠ¨ã€‚å®ƒä¸èƒ½ä½¿ç”¨åœ¨å…¶å®ƒæƒ…å†µä¸‹ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´ä¸ä¸€è‡´ï¼</p><p>è¿œç¨‹åˆ é™¤ä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹.è¦åˆ é™¤çš„èŠ‚ç‚¹å¿…é¡»æ˜¯è„±æœºçš„, è€Œåœ¨åˆ é™¤èŠ‚ç‚¹æœŸé—´èŠ‚ç‚¹å¿…é¡»æ˜¯åœ¨çº¿çš„ï¼Œé™¤éä½¿ç”¨äº†<strong>--offline</strong>Â æ ‡å¿—.</p><p>å½“ä½¿ç”¨<strong>--offline</strong>Â æ ‡å¿—æ—¶ï¼Œrabbitmqctlä¸ä¼šå°è¯•æ­£å¸¸è¿æ¥èŠ‚ç‚¹;ç›¸åï¼Œå®ƒä¼šä¸´æ—¶æ”¹å˜èŠ‚ç‚¹ä»¥ä½œä¿®æ”¹.å¦‚æœèŠ‚ç‚¹ä¸èƒ½æ­£å¸¸å¯åŠ¨çš„è¯ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„.åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹å°†å˜æˆé›†ç¾¤å…ƒæ•°æ®çš„è§„èŒƒæºï¼ˆä¾‹å¦‚ï¼Œé˜Ÿåˆ—çš„å­˜åœ¨ï¼‰ï¼Œå³ä½¿å®ƒä¸æ˜¯ä»¥å‰çš„ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰å¯èƒ½ï¼Œä½ åº”è¯¥åœ¨æœ€æ–°çš„èŠ‚ç‚¹ä¸Šä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥å…³é—­ã€‚</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl -n hare@mcnulty forget_cluster_node rabbit@stringer</p><p>æ­¤å‘½ä»¤ä¼šä»èŠ‚ç‚¹<strong>hare@mcnultyä¸­åˆ é™¤****rabbit@stringerèŠ‚ç‚¹</strong>.</p><p>rename_cluster_node {oldnode1} {newnode1} [oldnode2] [newnode2 â€¦]</p><p>æ”¯æŒåœ¨æœ¬åœ°æ•°æ®åº“ä¸­é‡å‘½åé›†ç¾¤èŠ‚ç‚¹.</p><p>æ­¤å­å‘½ä»¤ä¼šä¿ƒä½¿rabbitmqctlä¸´æ—¶æ”¹å˜èŠ‚ç‚¹ä»¥ä½œå‡ºä¿®æ”¹. å› æ­¤æœ¬åœ°é›†ç¾¤å¿…é¡»æ˜¯åœæ­¢çš„ï¼Œå…¶å®ƒèŠ‚ç‚¹å¯ä»¥æ˜¯åœ¨çº¿æˆ–ç¦»çº¿çš„ï¼</p><p>è¿™ä¸ªå­å‘½ä»¤æ¥å¶æ•°ä¸ªå‚æ•°ï¼Œæˆå¯¹è¡¨ç¤ºèŠ‚ç‚¹çš„æ—§åç§°å’Œæ–°åç§°.ä½ å¿…é¡»æŒ‡å®šèŠ‚ç‚¹çš„æ—§åç§°å’Œæ–°åç§°ï¼Œå› ä¸ºå…¶å®ƒåœæ­¢çš„èŠ‚ç‚¹ä¹Ÿå¯èƒ½åœ¨åŒä¸€æ—¶é—´é‡å‘½å.</p><p>åŒæ—¶åœæ­¢æ‰€æœ‰èŠ‚ç‚¹æ¥é‡å‘½åä¹Ÿæ˜¯å¯ä»¥çš„(åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»ç»™å‡ºæ—§åç§°å’Œæ–°åç§°)æˆ–ä¸€æ¬¡åœæ­¢ä¸€ä¸ªèŠ‚ç‚¹æ¥é‡å‘½å(åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦è¢«å‘ŠçŸ¥å…¶åå¥æ˜¯å¦‚ä½•å˜åŒ–çš„).</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl rename_cluster_node rabbit@misshelpful rabbit@cordelia</p><p>æ­¤å‘½ä»¤æ¥å°†èŠ‚ç‚¹åç§°<strong>rabbit@misshelpful</strong>Â é‡å‘½åä¸º<strong>rabbit@cordelia</strong>.</p><p>update_cluster_nodes {clusternode}</p><p>clusternode</p><p>ç”¨äºå’¨è¯¢å…·æœ‰æœ€æ–°æ¶ˆæ¯çš„èŠ‚ç‚¹.</p><p>æŒ‡ç¤ºå·²é›†ç¾¤çš„èŠ‚ç‚¹é†’æ¥æ—¶è”ç³»<strong>clusternode</strong>.è¿™ä¸åŒäº<strong>join_cluster</strong>Â ï¼Œå› ä¸ºå®ƒä¸ä¼šåŠ å…¥ä»»ä½•é›†ç¾¤ - å®ƒä¼šæ£€æŸ¥èŠ‚ç‚¹å·²ç»ä»¥<strong>clusternode</strong>çš„å½¢å¼å­˜åœ¨äºé›†ç¾¤ä¸­äº†ï¼</p><p>éœ€è¦è¿™ä¸ªå‘½ä»¤çš„åŠ¨æœºæ˜¯å½“èŠ‚ç‚¹ç¦»çº¿æ—¶ï¼Œé›†ç¾¤å¯ä»¥å˜åŒ–.è€ƒè™‘è¿™æ ·çš„æƒ…å†µï¼ŒèŠ‚ç‚¹ï¼¡å’ŒèŠ‚ç‚¹ï¼¢éƒ½åœ¨é›†ç¾¤é‡Œè¾¹ï¼Œè¿™é‡ŒèŠ‚ç‚¹ï¼¡æ‰çº¿äº†ï¼Œï¼£åˆå’Œï¼¢é›†ç¾¤äº†ï¼Œç„¶åï¼¢åˆç¦»å¼€äº†é›†ç¾¤ï¼å½“ï¼¡é†’æ¥çš„æ—¶å€™ï¼Œå®ƒä¼šå°è¯•è”ç³»ï¼¢ï¼Œä½†è¿™ä¼šå¤±è´¥ï¼Œå› ä¸ºï¼¢å·²ç»ä¸åœ¨é›†ç¾¤ä¸­äº†.<strong>update_cluster_nodes -n A C</strong>Â å¯è§£å†³è¿™ç§åœºæ™¯ï¼</p><p>force_boot</p><p>ç¡®ä¿èŠ‚ç‚¹å°†åœ¨ä¸‹ä¸€æ¬¡å¯åŠ¨ï¼Œå³ä½¿å®ƒä¸æ˜¯æœ€åä¸€ä¸ªå…³é—­çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ å…³é—­æ•´ä¸ªRabbitMQ é›†ç¾¤æ—¶ï¼Œä½ é‡å¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åº”è¯¥æ˜¯æœ€åä¸€ä¸ªä¸‹çº¿çš„èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒå¯ä»¥çœ‹åˆ°å…¶å®ƒèŠ‚ç‚¹æ‰€çœ‹ä¸åˆ°çš„äº‹æƒ…. ä½†æœ‰æ—¶è¿™æ˜¯ä¸å¯èƒ½çš„:ä¾‹å¦‚ï¼Œå¦‚æœæ•´ä¸ªé›†ç¾¤æ˜¯å¤±å»äº†ç”µåŠ›è€Œæ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨æƒ³å®ƒä¸æ˜¯æœ€åä¸€ä¸ªå…³é—­çš„ï¼</p><p>åœ¨è¿™ç§èŠ‚ç‚¹æ‰çº¿æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥è°ƒç”¨<strong>rabbitmqctl force_boot</strong>Â ï¼è¿™å°±å‘Šè¯‰èŠ‚ç‚¹ä¸‹ä¸€æ¬¡æ— æ¡ä»¶çš„å¯åŠ¨èŠ‚ç‚¹.åœ¨æ­¤èŠ‚ç‚¹å…³é—­åï¼Œé›†ç¾¤çš„ä»»ä½•å˜åŒ–ï¼Œå®ƒéƒ½ä¼šä¸¢å¤±ï¼</p><p>å¦‚æœæœ€åä¸€ä¸ªæ‰çº¿çš„èŠ‚ç‚¹æ°¸ä¹…ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆä½ éœ€è¦ä¼˜å…ˆä½¿ç”¨<strong>rabbitmqctl forget_cluster_node â€“offline</strong>,Â å› ä¸ºå®ƒå¯ä»¥ç¡®ä¿åœ¨ä¸¢å¤±çš„èŠ‚ç‚¹ä¸ŠæŒæ¡çš„é•œåƒé˜Ÿåˆ—å¾—åˆ°æå‡ã€‚</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl force_boot</p><p>è¿™å¯ä»¥å¼ºåˆ¶èŠ‚ç‚¹ä¸‹æ¬¡å¯åŠ¨æ—¶ä¸ç”¨ç­‰å¾…å…¶å®ƒèŠ‚ç‚¹ï¼</p><p>sync_queue [-pÂ _vhost_] {queue}</p><p>queue</p><p>åŒæ­¥é˜Ÿåˆ—çš„åç§°</p><p>æŒ‡ç¤ºæœªåŒæ­¥slavesä¸Šçš„é•œåƒé˜Ÿåˆ—è‡ªè¡ŒåŒæ­¥.åŒæ­¥å‘ç”Ÿæ—¶ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡(æ‰€æœ‰å‡ºå…¥é˜Ÿåˆ—çš„å‘å¸ƒè€…å’Œæ¶ˆè´¹è€…éƒ½ä¼šé˜»å¡).æ­¤å‘½ä»¤æˆåŠŸæ‰§è¡Œåï¼Œé˜Ÿåˆ—å¿…é¡»æ˜¯é•œåƒçš„ï¼</p><p>æ³¨æ„ï¼ŒæœªåŒæ­¥é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯è¢«è€—å°½åï¼Œæœ€ç»ˆä¹Ÿä¼šå˜æˆåŒæ­¥. æ­¤å‘½ä»¤ä¸»è¦ç”¨äºæœªè€—å°½çš„é˜Ÿåˆ—ã€‚</p><p>cancel_sync_queue [-pÂ _vhost_] {queue}</p><p>queue</p><p>å–æ¶ˆåŒæ­¥çš„é˜Ÿåˆ—åç§°.</p><p>æŒ‡ç¤ºåŒæ­¥é•œåƒé˜Ÿåˆ—åœæ­¢åŒæ­¥.</p><p>purge_queue [-pÂ _vhost_] {queue}</p><p>queue</p><p>è¦æ¸…é™¤é˜Ÿåˆ—çš„åç§°.</p><p>æ¸…é™¤é˜Ÿåˆ—(åˆ é™¤å…¶ä¸­çš„æ‰€æœ‰æ¶ˆæ¯).</p><p>set_cluster_name {name}</p><p>è®¾ç½®é›†ç¾¤åç§°. é›†ç¾¤åç§°åœ¨clientè¿æ¥æ—¶ï¼Œä¼šé€šæŠ¥ç»™client,ä¹Ÿå¯ç”¨äºfederationå’Œshovelæ’ä»¶è®°å½•æ¶ˆæ¯çš„æ¥æºåœ°.Â ç¾¤é›†åç§°é»˜è®¤æ˜¯æ¥è‡ªåœ¨ç¾¤é›†ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸»æœºåï¼Œä½†å¯ä»¥æ”¹å˜ã€‚</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl set_cluster_name london</p><p>è®¾ç½®é›†ç¾¤åç§°ä¸ºâ€londonâ€.</p><h3 id="ç”¨æˆ·ç®¡ç†"><a href="#ç”¨æˆ·ç®¡ç†" class="headerlink" title="ç”¨æˆ·ç®¡ç†"></a>ç”¨æˆ·ç®¡ç†</h3><p>æ³¨æ„<strong>rabbitmqctl</strong>Â ç®¡ç†RabbitMQ å†…éƒ¨ç”¨æˆ·æ•°æ®åº“. ä»»ä½•æ¥è‡ªå…¶å®ƒè®¤è¯åç«¯çš„ç”¨æˆ·å¯¹äº<strong>rabbitmqctl</strong>æ¥è¯´æ˜¯ä¸å¯è§çš„.</p><p>add_user {<em>username</em>} {<em>password</em>}</p><p>username</p><p>è¦åˆ›å»ºçš„ç”¨æˆ·åç§°.</p><p>password</p><p>è®¾ç½®åˆ›å»ºç”¨æˆ·ç™»å½•brokerçš„å¯†ç .Â  Â  Â  Â </p><p>rabbitmqctl add_user tonyg changeit</p><p>æ­¤å‘½ä»¤ç”¨äºæŒ‡ç¤ºRabbitMQ broker åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰éç®¡ç†æƒé™çš„ç”¨æˆ·ï¼Œå…¶åç§°ä¸º<strong>tonygï¼Œ</strong>Â åˆå§‹å¯†ç ä¸º<strong>changeit</strong>.</p><p>delete_user {<em>username</em>}</p><p>username</p><p>è¦åˆ é™¤çš„ç”¨æˆ·åç§°.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl delete_user tonyg</p><p>æ­¤å‘½ä»¤ç”¨äºæŒ‡ç¤ºRabbitMQ brokeråˆ é™¤åä¸º<strong>tonygçš„ç”¨æˆ·</strong></p><p>change_password {<em>username</em>} {<em>newpassword</em>}</p><p>username</p><p>è¦ä¿®æ”¹å¯†ç çš„ç”¨æˆ·åç§°.</p><p>newpassword</p><p>ç”¨æˆ·çš„æ–°å¯†ç .</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl change_password tonyg newpass</p><p>æ­¤å‘½ä»¤ç”¨äºæŒ‡å®šRabbitMQ brokerå°†<strong>tonyg</strong>Â ç”¨æˆ·çš„å¯†ç ä¿®æ”¹ä¸º<strong>newpass</strong>.</p><p>clear_password {<em>username</em>}</p><p>username</p><p>è¦æ¸…é™¤å¯†ç çš„ç”¨æˆ·åç§°.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl clear_password tonyg</p><p>æ­¤å‘½ä»¤ä¼šæŒ‡ç¤ºRabbitMQ brokeræ¸…é™¤åä¸ºtonygçš„ç”¨æˆ·å¯†ç .ç°åœ¨ï¼Œæ­¤ç”¨æˆ·ä¸èƒ½ä½¿ç”¨å¯†ç ç™»å½•(ä½†å¯ä»¥é€šè¿‡SASL EXTERNALç™»å½•ï¼Œå¦‚æœé…ç½®äº†çš„è¯).</p><p>authenticate_user {<em>username</em>} {<em>password</em>}</p><p>username</p><p>ç”¨æˆ·çš„åç§°.</p><p>password</p><p>ç”¨æˆ·çš„å¯†ç .</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl authenticate_user tonyg verifyit</p><p>æ­¤å‘½ä»¤ä¼šæŒ‡ç¤ºRabbitMQ brokerä»¥åç§°ä¸ºtonygï¼ŒÂ å¯†ç ä¸ºverifyitæ¥è¿›è¡ŒéªŒè¯.</p><p>set_user_tags {<em>username</em>} {<em>tag</em>Â â€¦}</p><p>username</p><p>è¦è®¾ç½®tagçš„ç”¨æˆ·åç§°.</p><p>tag</p><p>ç”¨äºè®¾ç½®0ä¸ªï¼Œ1ä¸ªæˆ–å¤šä¸ªtags.ä»»ä½•ç°æœ‰çš„tagséƒ½å°†è¢«åˆ é™¤.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl set_user_tags tonyg administrator</p><p>æ­¤å‘½ä»¤æŒ‡ç¤ºRabbitMQ brokerç”¨äºç¡®ä¿<strong>tonyg</strong>Â æ˜¯administrator.å½“é€šè¿‡AMQPæ¥ç™»å½•æ—¶ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆæ•ˆæœ,ä½†ç”¨æˆ·é€šè¿‡å…¶å®ƒçš„é€”ç»æ¥ç™»å½•æ—¶ï¼Œå®ƒå¯ç”¨æ¥ç®¡ç†ç”¨æˆ·,è™šæ‹Ÿä¸»æœºå’Œæƒé™(å¦‚ä½¿ç”¨ç®¡ç†æ’ä»¶).</p><p>rabbitmqctl set_user_tags tonyg</p><p>æ­¤å‘½ä»¤ä¼šæŒ‡ç¤ºRabbitMQ brokeråˆ é™¤tonygä¸Šçš„ä»»ä½•ç°æœ‰çš„tag.</p><p>list_users</p><p>åˆ—å‡ºç”¨æˆ·. æ¯ä¸ªç»“æœè¡Œéƒ½åŒ…å«ç”¨æˆ·åï¼Œå…¶åç´§è·Ÿç”¨æˆ·çš„tags.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl list_users</p><p>æ­¤å‘½ä»¤æŒ‡ç¤ºRabbitMQ brokeråˆ—å‡ºæ‰€æœ‰ç”¨æˆ·.</p><h3 id="è®¿é—®æ§åˆ¶"><a href="#è®¿é—®æ§åˆ¶" class="headerlink" title="è®¿é—®æ§åˆ¶"></a>è®¿é—®æ§åˆ¶</h3><p>æ³¨æ„<strong>rabbitmqctl</strong>Â ä¼šç®¡ç†RabbitMQçš„å†…éƒ¨ç”¨æˆ·æ•°æ®åº“. æ— æƒé™çš„ç”¨æˆ·å°†ä¸èƒ½ä½¿ç”¨<strong>rabbitmqctl</strong>.</p><p>add_vhost {<em>vhost</em>}</p><p>vhost</p><p>è¦åˆ›å»ºè™šæ‹Ÿä¸»æœºåç§°.</p><p>åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿä¸»æœº.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl add_vhost test</p><p>æ­¤å‘½ä»¤æŒ‡ç¤ºRabbitMQ brokeræ¥åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºtestçš„è™šæ‹Ÿä¸»æœº.</p><p>delete_vhost {<em>vhost</em>}</p><p>vhost</p><p>è¦åˆ é™¤çš„è™šæ‹Ÿä¸»æœºçš„åç§°.</p><p>åˆ é™¤ä¸€ä¸ªè™šæ‹Ÿä¸»æœº.</p><p>åˆ é™¤ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ é™¤æ‰€æœ‰äº¤æ¢æœºï¼Œé˜Ÿåˆ—ï¼Œç»‘å®šï¼Œç”¨æˆ·æƒé™ï¼Œå‚æ•°å’Œç­–ç•¥.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl delete_vhost test</p><p>æ­¤å‘½ä»¤æŒ‡ç¤ºRabbitMQ brokeråˆ é™¤åä¸ºtestçš„è™šæ‹Ÿä¸»æœº.</p><p>list_vhosts [<em>vhostinfoitem</em>Â â€¦]</p><p>åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿä¸»æœº.</p><p><strong>vhostinfoitem</strong>Â å‚æ•°ç”¨äºæ ‡è¯†å“ªäº›è™šæ‹Ÿä¸»æœºåº”è¯¥åŒ…å«åœ¨ç»“æœé›†ä¸­.ç»“æœé›†ä¸­çš„åˆ—é¡ºåºä¼šåŒ¹é…å‚æ•°çš„é¡ºåº.<strong>vhostinfoitem</strong>Â å¯æ¥å—ä¸‹é¢çš„å€¼ï¼š</p><p>name</p><p>è™šæ‹Ÿä¸»æœºçš„åç§°.</p><p>tracing</p><p>æ˜¯å¦å¯¹è™šæ‹Ÿä¸»æœºå¯ç”¨è¿½è¸ª.</p><p>å¦‚æœæ²¡æœ‰æŒ‡å®š<strong>vhostinfoitem</strong>Â å‚æ•°ï¼Œé‚£ä¹ˆä¼šæ˜¾ç¤ºè™šæ‹Ÿä¸»æœºåç§°.</p><p>ä¾‹å¦‚ï¼š</p><p>rabbitmqctl list_vhosts name tracing</p><p>æ­¤å‘½ä»¤ç”¨äºæŒ‡ç¤ºRabbitMQ brokeræ˜¾ç¤ºæ‰€æœ‰è™šæ‹Ÿä¸»æœº.</p><p>set_permissions [-pÂ _vhost_] {<em>user</em>} {<em>conf</em>} {<em>write</em>} {<em>read</em>}</p><p>vhost</p><p>æˆäºˆç”¨æˆ·å¯è®¿é—®çš„è™šæ‹Ÿæœºåç§°ï¼Œé»˜è®¤æ˜¯**&#x2F;**.</p><p>user</p><p>å¯è®¿é—®æŒ‡å®šè™šæ‹Ÿä¸»æœºçš„ç”¨æˆ·åç§°.</p><p>conf</p><p>ä¸€ä¸ªç”¨äºåŒ¹é…ç”¨æˆ·åœ¨å“ªäº›èµ„æºåç§°ä¸Šæ‹¥æœ‰é…ç½®æƒé™çš„æ­£åˆ™è¡¨è¾¾å¼</p><p>write</p><p>ä¸€ä¸ªç”¨äºåŒ¹é…ç”¨æˆ·åœ¨å“ªäº›èµ„æºåç§°ä¸Šæ‹¥æœ‰å†™æƒé™çš„æ­£åˆ™è¡¨è¾¾å¼.</p><p>read</p><p>ä¸€ä¸ªç”¨äºåŒ¹é…ç”¨æˆ·åœ¨å“ªäº›èµ„æºåç§°ä¸Šæ‹¥æœ‰è¯»æƒé™çš„æ­£åˆ™è¡¨è¾¾å¼.</p><p>è®¾ç½®ç”¨æˆ·æƒé™.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl set_permissions -p &#x2F;myvhost tonyg â€œ^tonyg-.*â€œ â€œ.*â€œ â€œ.*â€œ</p><p>æ­¤å‘½ä»¤è¡¨ç¤ºRabbitMQ brokeræˆäºˆ<strong>tonyg</strong>Â ç”¨æˆ·å¯è®¿é—®Â <strong>&#x2F;myvhostè™šæ‹Ÿä¸»æœº</strong>,å¹¶åœ¨èµ„æºåç§°ä»¥â€tonyg-â€œå¼€å¤´çš„æ‰€æœ‰èµ„æºä¸Šéƒ½å…·æœ‰é…ç½®æƒé™ï¼Œå¹¶åœ¨æ‰€æœ‰èµ„æºä¸Šéƒ½æ‹¥æœ‰è¯»å†™æƒé™ã€‚</p><p>clear_permissions [-pÂ _vhost_] {<em>username</em>}</p><p>vhost</p><p>ç”¨äºè®¾ç½®ç¦æ­¢ç”¨æˆ·è®¿é—®çš„è™šæ‹Ÿä¸»æœºåç§°,é»˜è®¤ä¸º**&#x2F;**.</p><p>username</p><p>ç¦æ­¢è®¿é—®ç‰¹å®šè™šæ‹Ÿä¸»æœºçš„ç”¨æˆ·åç§°.</p><p>è®¾ç½®ç”¨æˆ·æƒé™.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl clear_permissions -p &#x2F;myvhost tonyg</p><p>æ­¤å‘½ä»¤ç”¨äºæŒ‡ç¤ºRabbitMQ brokerç¦æ­¢tonygÂ ç”¨æˆ·è®¿é—®&#x2F;myvhostè™šæ‹Ÿä¸»æœº.</p><p>list_permissions [-pÂ _vhost_]</p><p>vhost</p><p>ç”¨äºæŒ‡å®šè™šæ‹Ÿä¸»æœºåç§°ï¼Œå°†ä¼šåˆ—å‡ºæ‰€æœ‰å¯è®¿é—®æ­¤è™šæ‹Ÿä¸»æœºçš„æ‰€æœ‰ç”¨æˆ·åç§°å’Œæƒé™.é»˜è®¤ä¸º**&#x2F;**.</p><p>æ˜¾ç¤ºè™šæ‹Ÿæœºä¸Šæƒé™.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl list_permissions -p &#x2F;myvhost</p><p>æ­¤å‘½ä»¤æŒ‡ç¤ºRabbitMQ brokeråˆ—å‡ºæ‰€æœ‰å·²æˆæƒè®¿é—®**&#x2F;myvhost**Â è™šæ‹Ÿä¸»æœºçš„ç”¨æˆ·ï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ—å‡ºè¿™äº›ç”¨æˆ·èƒ½åœ¨è™šæ‹Ÿä¸»æœºèµ„æºå¯æ“ä½œçš„æƒé™.æ³¨æ„ï¼Œç©ºå­—ç¬¦ä¸²è¡¨ç¤ºæ²¡æœ‰ä»»ä½•æˆäºˆçš„æƒé™ã€‚</p><p>list_user_permissions {<em>username</em>}</p><p>username</p><p>è¦æ˜¾ç¤ºæƒé™çš„ç”¨æˆ·åç§°.</p><p>åˆ—å‡ºç”¨æˆ·æƒé™.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl list_user_permissions tonyg</p><p>æ­¤å‘½ä»¤æŒ‡ç¤ºRabbitMQ brokeråˆ—å‡ºtonygå¯æˆæƒè®¿é—®çš„æ‰€æœ‰è™šæ‹Ÿä¸»æœºåç§°ï¼Œä»¥åŠåœ¨è¿™äº›è™šæ‹Ÿä¸»æœºä¸Šçš„æ“ä½œ.</p><h3 id="å‚æ•°ç®¡ç†"><a href="#å‚æ•°ç®¡ç†" class="headerlink" title="å‚æ•°ç®¡ç†"></a>å‚æ•°ç®¡ç†</h3><p>RabbitMQçš„æŸäº›ç‰¹æ€§(å¦‚è”åˆæ’ä»¶)æ˜¯åŠ¨æ€æ§åˆ¶çš„. æ¯ä¸ªå‚æ•°éƒ½æ˜¯ä¸ç‰¹å®šè™šæ‹Ÿä¸»æœºç›¸å…³çš„ç»„ä»¶åç§°, nameå’Œvalueæ„æˆçš„. ç»„ä»¶åç§°å’Œnameéƒ½æ˜¯å­—ç¬¦ä¸²,å€¼æ˜¯Erlang term. å‚æ•°å¯è¢«è®¾ç½®ï¼Œæ¸…é™¤å’Œæ˜¾ç¤º.é€šå¸¸ä½ å¯ä»¥å‚è€ƒæ–‡æ¡£æ¥äº†è§£å¦‚ä½•è®¾ç½®å‚æ•°.</p><p>set_parameter [-pÂ _vhost_] {<em>component_name</em>} {<em>name</em>} {<em>value</em>}</p><p>è®¾ç½®ä¸€ä¸ªå‚æ•°.</p><p>component_name</p><p>è¦è®¾ç½®çš„ç»„ä»¶åç§°.</p><p>name</p><p>è¦è®¾ç½®çš„å‚æ•°åç§°.</p><p>value</p><p>è¦è®¾ç½®çš„å‚æ•°å€¼ï¼Œä½œä¸JSONé¡¹ã€‚åœ¨å¤šæ•°shellsä¸­ï¼Œä½ æ›´å–œæ¬¢å°†å…¶å¼•èµ·æ¥.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl set_parameter federation local_username â€˜â€œguestâ€â€˜</p><p>æ­¤å‘½ä»¤ç”¨äºåœ¨é»˜è®¤è™šæ‹Ÿä¸»æœºä¸Šè®¾ç½®<strong>federation</strong>Â ç»„ä»¶çš„<strong>local_username å‚æ•°å€¼</strong><strong>â€œguestâ€</strong>.</p><p>clear_parameter [-pÂ _vhost_] {<em>component_name</em>} {<em>key</em>}</p><p>æ¸…é™¤å‚æ•°.</p><p>component_name</p><p>è¦æ¸…é™¤å‚æ•°çš„ç»„ä»¶åç§°.</p><p>name</p><p>è¦æ¸…é™¤çš„å‚æ•°åç§°.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl clear_parameter federation local_username</p><p>æ­¤å‘½ä»¤ç”¨äºæ¸…é™¤é»˜è®¤è™šæ‹Ÿä¸»æœºä¸Šçš„<strong>federation</strong>Â ç»„ä»¶çš„<strong>local_username</strong>Â å‚æ•°å€¼.</p><p>list_parameters [-pÂ _vhost_]</p><p>åˆ—å‡ºè™šæ‹Ÿä¸»æœºä¸Šçš„æ‰€æœ‰å‚æ•°.</p><p>ç¤ºä¾‹:</p><p>rabbitmqctl list_parameters</p><p>æ­¤å‘½ä»¤ç”¨äºåˆ—å‡ºé»˜è®¤è™šæ‹Ÿä¸»æœºä¸Šçš„æ‰€æœ‰å‚æ•°.</p><h3 id="ç­–ç•¥ç®¡ç†"><a href="#ç­–ç•¥ç®¡ç†" class="headerlink" title="ç­–ç•¥ç®¡ç†"></a>ç­–ç•¥ç®¡ç†</h3><p>ç­–ç•¥ç”¨äºåœ¨é›†ç¾¤èŒƒå›´çš„åŸºç¡€ä¸Šç”¨äºæ§åˆ¶å’Œä¿®æ”¹é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„è¡Œä¸º.Â ç­–ç•¥åº”ç”¨äºè™šæ‹Ÿä¸»æœº,ç”±name, pattern, definitionæˆ–å¯é€‰çš„priorityç»„æˆ. ç­–ç•¥å¯è¢«è®¾ç½®ï¼Œæ¸…é™¤å’Œåˆ—ä¸¾.</p><p>set_policy [-pÂ _vhost_] [â€“priorityÂ _priority_] [â€“apply-toÂ _apply-to_] {<em>name</em>} {<em>pattern</em>} {<em>definition</em>}</p><p>è®¾ç½®ç­–ç•¥.</p><p>name</p><p>ç­–ç•¥åç§°.</p><p>pattern</p><p>æ­£åˆ™è¡¨è¾¾å¼, åŒ¹é…è¦åº”ç”¨çš„èµ„æº</p><p>definition</p><p>ç­–ç•¥çš„å®šä¹‰,JSONå½¢å¼ï¼åœ¨å¤§å¤šæ•°shellsä¸­ï¼Œä½ å¾ˆå¯èƒ½éœ€è¦å¼•ç”¨è¿™ä¸ª</p><p>priority</p><p>ç­–ç•¥çš„æ•´æ•°ä¼˜å…ˆçº§. æ•°å­—è¶Šé«˜åˆ™ä¼˜å…ˆçº§è¶Šé«˜.é»˜è®¤æ˜¯ï¼.</p><p>apply-to</p><p>ç­–ç•¥é€‚ç”¨çš„å¯¹è±¡ç±»å‹ï¼Œå…¶å€¼å¯ä¸º â€œqueuesâ€, â€œexchangesâ€ æˆ– â€œallâ€.é»˜è®¤æ˜¯â€allâ€.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl set_policy federate-me â€œ^amq.â€ â€˜{â€œfederation-upstream-setâ€:â€allâ€}â€™</p><p>æ­¤å‘½ä»¤åœ¨é»˜è®¤è™šæ‹Ÿä¸»æœºä¸Šè®¾ç½®ç­–ç•¥ä¸º<strong>federate-meï¼Œ</strong>è¿™æ ·å†…å»ºçš„äº¤æ¢å™¨å°†è¿›è¡Œè”åˆ.</p><p>clear_policy [-pÂ _vhost_] {<em>name</em>}</p><p>æ¸…é™¤ç­–ç•¥.</p><p>name</p><p>è¦æ¸…é™¤çš„ç­–ç•¥åç§°.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl clear_policy federate-me</p><p>æ­¤å‘½ä»¤æ¥æ¸…é™¤é»˜è®¤è™šæ‹Ÿä¸»æœºä¸Šçš„<strong>federate-me</strong>Â ç­–ç•¥.</p><p>list_policies [-pÂ _vhost_]</p><p>æ˜¾ç¤ºè™šæ‹Ÿä¸»æœºä¸Šçš„æ‰€æœ‰ç­–ç•¥.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl list_policies</p><p>æ­¤å‘½ä»¤ä¼šæ˜¾ç¤ºé»˜è®¤è™šæ‹Ÿä¸»æœºä¸Šçš„æ‰€æœ‰ç­–ç•¥.</p><h3 id="æœåŠ¡å™¨çŠ¶æ€"><a href="#æœåŠ¡å™¨çŠ¶æ€" class="headerlink" title="æœåŠ¡å™¨çŠ¶æ€"></a>æœåŠ¡å™¨çŠ¶æ€</h3><p>æœåŠ¡å™¨çŠ¶æ€æŸ¥è¯¢æŸ¥è¯¢æœåŠ¡å™¨è¿”å›ä¸€ä¸ªç»“æœä»¥åˆ¶è¡¨ç¬¦åˆ†éš”çš„åˆ—è¡¨. æŸäº›æŸ¥è¯¢(<strong>list_queues</strong>,Â <strong>list_exchanges</strong>,Â <strong>list_bindings</strong>, å’ŒÂ <strong>list_consumers</strong>) æ¥å—ä¸€ä¸ªå¯é€‰çš„<strong>vhost</strong>Â å‚æ•°. å¦‚æœè¿™ä¸ªå‚æ•°å‡ºç°äº†ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»æŒ‡å®šåœ¨æŸ¥è¯¢çš„åé¢.</p><p>list_queues, list_exchanges and list_bindings å‘½ä»¤æ¥å—ä¸€ä¸ªå¯é€‰çš„è™šæ‹Ÿä¸»æœºå‚æ•°ä»¥æ˜¾ç¤ºå…¶ç»“æœï¼é»˜è®¤å€¼ä¸ºâ€&#x2F;â€œ.</p><p>list_queues [-pÂ _vhost_] [<em>queueinfoitem</em>Â â€¦]</p><p>è¿”å›é˜Ÿåˆ—çš„è¯¦ç»†ä¿¡æ¯. å¦‚æœæ— -pæ ‡å¿—ï¼Œå°†æ˜¾ç¤ºï¼è™šæ‹Ÿä¸»æœºä¸Šçš„é˜Ÿåˆ—è¯¦æƒ…ï¼â€-pâ€ æ ‡å¿—å¯ç”¨æ¥è¦†ç›–æ­¤é»˜è®¤å€¼ï¼</p><p><strong>queueinfoitem</strong>Â å‚æ•°ç”¨äºæŒ‡ç¤ºå“ªäº›é˜Ÿåˆ—ä¿¡æ¯é¡¹ä¼šåŒ…å«åœ¨ç»“æœé›†ä¸­.ç»“æœé›†çš„åˆ—é¡ºåºå°†åŒ¹é…å‚æ•°çš„é¡ºåº.<strong>queueinfoitem</strong>Â å¯ä»¥æ˜¯ä¸‹é¢åˆ—è¡¨ä¸­çš„ä»»ä½•å€¼:</p><p>name</p><p>éASCIIå­—ç¬¦çš„é˜Ÿåˆ—åç§°.</p><p>durable</p><p>æœåŠ¡å™¨é‡å¯åï¼Œé˜Ÿåˆ—æ˜¯å¦èƒ½å¹¸å­˜.</p><p>auto_delete</p><p>ä¸å†ä½¿ç”¨æ—¶ï¼Œæ˜¯å¦éœ€è¦è‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—.</p><p>arguments</p><p>é˜Ÿåˆ—å‚æ•°.</p><p>policy</p><p>åº”ç”¨åˆ°é˜Ÿåˆ—ä¸Šçš„ç­–ç•¥åç§°.</p><p>pid</p><p>å…³è”é˜Ÿåˆ—çš„Erlangè¿›ç¨‹ID.</p><p>owner_pid</p><p>è¡¨ç¤ºé˜Ÿåˆ—ä¸“ç”¨æ‰€æœ‰è€…çš„ä»£è¡¨è¿æ¥çš„Erlangè¿›ç¨‹ID.å¦‚æœé˜Ÿåˆ—æ˜¯éä¸“ç”¨çš„ï¼Œæ­¤å€¼å°†ä¸ºç©ºï¼</p><p>exclusive</p><p>True:å¦‚æœé˜Ÿåˆ—æ˜¯ä¸“ç”¨çš„(å³æœ‰owner_pid), åä¹‹false</p><p>exclusive_consumer_pid</p><p>è¡¨ç¤ºæ­¤channelçš„ä¸“ç”¨æ¶ˆè´¹è€…è®¢é˜…åˆ°æ­¤é˜Ÿåˆ—çš„Erlangè¿›ç¨‹Id. å¦‚æœæ²¡æœ‰ä¸“ç”¨æ¶ˆè´¹è€…ï¼Œåˆ™ä¸ºç©ºï¼</p><p>exclusive_consumer_tag</p><p>ä¸“ç”¨æ¶ˆè´¹è€…è®¢é˜…åˆ°æ­¤é˜Ÿåˆ—çš„Consumer tag.å¦‚æœæ²¡æœ‰ä¸“ç”¨æ¶ˆè´¹è€…ï¼Œåˆ™ä¸ºç©º.</p><p>messages_ready</p><p>å‡†å¤‡åˆ†å‘ç»™å®¢æˆ·ç«¯çš„æ¶ˆæ¯æ•°ç›®.</p><p>messages_unacknowledged</p><p>åˆ†å‘åˆ°å®¢æˆ·ç«¯ä½†å°šæœªåº”ç­”çš„æ¶ˆæ¯æ•°ç›®.</p><p>messages</p><p>å‡†å¤‡åˆ†å‘å’Œæœªåº”ç­”æ¶ˆæ¯çš„æ€»å’Œ(é˜Ÿåˆ—æ·±åº¦).</p><p>messages_ready_ram</p><p>é©»ç•™åœ¨ramä¸­messages_readyçš„æ¶ˆæ¯æ•°ç›®.</p><p>messages_unacknowledged_ram</p><p>é©»ç•™åœ¨ramä¸­messages_unacknowledgedçš„æ¶ˆæ¯æ•°ç›®.</p><p>messages_ram</p><p>é©»ç•™åœ¨ramä¸­çš„æ¶ˆæ¯æ€»æ•°.</p><p>messages_persistent</p><p>é˜Ÿåˆ—ä¸­æŒä¹…åŒ–æ¶ˆæ¯çš„æ•°ç›®(å¯¹äºç¬æ—¶é˜Ÿåˆ—æ€»æ˜¯0).</p><p>message_bytes</p><p>é˜Ÿåˆ—ä¸­æ‰€æœ‰æ¶ˆæ¯ä½“çš„å¤§å°æ€»å’Œ.è¿™ä¸åŒ…æ‹¬æ¶ˆæ¯å±æ€§(åŒ…æ‹¬headers)Â æˆ–ä»»ä½•å¼€é”€(overhead)ã€‚</p><p>message_bytes_ready</p><p>ç±»ä¼¼äº<strong>message_bytes</strong>Â ï¼Œä½†åªç»Ÿè®¡å‡†å¤‡æŠ•é€’ç»™clientsçš„é‚£äº›æ¶ˆæ¯ï¼</p><p>message_bytes_unacknowledged</p><p>ç±»ä¼¼äº<strong>message_bytes</strong>Â ï¼Œä½†åªç»Ÿè®¡é‚£äº›å·²ç»æŠ•é€’ç»™clientsä½†è¿˜æœªåº”ç­”çš„æ¶ˆæ¯</p><p>message_bytes_ram</p><p>ç±»ä¼¼äº<strong>message_bytes</strong>Â ï¼Œä½†åªç»Ÿè®¡é‚£äº›åœ¨RAMä¸­çš„æ¶ˆæ¯</p><p>message_bytes_persistent</p><p>ç±»ä¼¼äº<strong>message_bytes</strong>Â ï¼Œä½†åªç»Ÿè®¡é‚£äº›æŒä¹…åŒ–çš„æ¶ˆæ¯</p><p>head_message_timestamp</p><p>å¦‚æœå­˜åœ¨ï¼Œåªæ˜¾ç¤ºé˜Ÿåˆ—ä¸­ç¬¬ï¼‘ä¸ªæ¶ˆæ¯çš„timestampå±æ€§. æ¶ˆæ¯çš„æ—¶é—´æˆ³åªå‡ºç°åœ¨åˆ†é¡µæƒ…å†µä¸‹ï¼</p><p>disk_reads</p><p>ä»é˜Ÿåˆ—å¯åŠ¨å¼€å¦‚ï¼Œå·²ä»ç£ç›˜ä¸Šè¯»å–è¯¥é˜Ÿåˆ—çš„æ¶ˆæ¯æ€»æ¬¡æ•°.</p><p>disk_writes</p><p>ä»é˜Ÿåˆ—å¯åŠ¨å¼€å§‹ï¼Œå·²å‘ç£ç›˜é˜Ÿåˆ—å†™æ¶ˆæ¯æ€»æ¬¡æ•°.</p><p>consumers</p><p>æ¶ˆè´¹è€…æ•°ç›®.</p><p>consumer_utilisation</p><p>æ—¶é—´åˆ†æ•°(0.0ä¸1.0ä¹‹é—´)ï¼Œé˜Ÿåˆ—å¯ç«‹å³å‘æ¶ˆè´¹è€…æŠ•é€’æ¶ˆæ¯. å®ƒå¯ä»¥å°äº1.0ï¼Œå¦‚æœæ¶ˆè´¹è€…å—é™äºç½‘ç»œå µå¡æˆ–é¢„æå–æ•°é‡.</p><p>memory</p><p>ä¸é˜Ÿåˆ—ç›¸å…³çš„Erlangè¿›ç¨‹æ¶ˆè€—çš„å†…å­˜å­—èŠ‚æ•°,åŒ…æ‹¬æ ˆ,å †ä»¥åŠå†…éƒ¨ç»“æ„.</p><p>slave_pids</p><p>å¦‚æœé˜Ÿåˆ—æ˜¯é•œåƒçš„ï¼Œè¿™é‡Œç»™å‡ºçš„æ˜¯å½“å‰slavesçš„IDs.</p><p>synchronised_slave_pids</p><p>å¦‚æœé˜Ÿåˆ—æ˜¯é•œåƒçš„ï¼Œå½“å‰slavesçš„IDsæ˜¯masteråŒæ­¥çš„- å³å®ƒä»¬å¯åœ¨æ— æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µä¸‹ï¼Œæ¥ç®¡master.</p><p>state</p><p>é˜Ÿåˆ—çŠ¶æ€.æ­£å¸¸æƒ…å†µä¸‹æ˜¯â€™runningâ€™, ä½†å¦‚æœé˜Ÿåˆ—æ­£åœ¨åŒæ­¥ä¹Ÿå¯èƒ½æ˜¯â€{syncing, MsgCount}â€. å¤„äºé›†ç¾¤ä¸‹çš„èŠ‚ç‚¹å¦‚æœæ‰çº¿äº†ï¼Œé˜Ÿåˆ—çŠ¶æ€äº¤æ˜¾ç¤ºâ€™downâ€™ (å¤§å¤šæ•°<strong>queueinfoitem</strong>s å°†ä¸å¯ç”¨).</p><p>å¦‚æœæ²¡æœ‰æŒ‡å®š<strong>queueinfoitem</strong>sï¼Œé‚£ä¹ˆå°†æ˜¾ç¤ºé˜Ÿåˆ—åç§°å’Œé˜Ÿåˆ—æ·±åº¦ï¼</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl list_queues -p &#x2F;myvhost messages consumers</p><p>æ­¤å‘½ä»¤æ˜¾ç¤ºäº†**&#x2F;myvhost**è™šæ‹Ÿä¸»æœºä¸­æ¯ä¸ªé˜Ÿåˆ—çš„æ·±åº¦å’Œæ¶ˆè´¹è€…æ•°ç›®.</p><p>list_exchanges [-pÂ _vhost_] [<em>exchangeinfoitem</em>Â â€¦]</p><p>è¿”å›äº¤æ¢å™¨ç»†èŠ‚.å¦‚æœæ²¡æœ‰æŒ‡å®šâ€-pâ€é€‰é¡¹ï¼Œå°†è¿”å›Â <strong>&#x2F;</strong>Â è™šæ‹Ÿä¸»æœºçš„ç»†èŠ‚. Â â€œ-pâ€ é€‰é¡¹å¯ç”¨æ¥è¦†ç›–é»˜è®¤è™šæ‹Ÿä¸»æœº.</p><p><strong>exchangeinfoitem</strong>Â å‚æ•°ç”¨æ¥è¡¨ç¤ºå“ªäº›äº¤æ¢å™¨ä¿¡æ¯è¦åŒ…å«åœ¨ç»“æœä¸­. ç»“æœé›†ä¸­åˆ—çš„é¡ºåºå°†ä¸å‚æ•°é¡ºåºä¿æŒä¸€è‡´.Â <strong>exchangeinfoitem</strong>Â å¯æ¥å—ä¸‹é¢çš„åˆ—è¡¨ä¸­ä»»ä½•å€¼ï¼š</p><p>name</p><p>äº¤æ¢å™¨åç§°.</p><p>type</p><p>äº¤æ¢å™¨ç±»å‹(å¦‚[<strong>direct</strong>,Â <strong>topic</strong>,Â <strong>headers</strong>,Â <strong>fanout</strong>]).</p><p>durable</p><p>å½“æœåŠ¡å™¨é‡å¯æ—¶ï¼Œäº¤æ¢å™¨æ˜¯å¦èƒ½å¤æ´».</p><p>auto_delete</p><p>å½“ä¸å†ä½¿ç”¨æ—¶ï¼Œäº¤æ¢å™¨æ˜¯å¦éœ€è¦è‡ªåŠ¨åˆ é™¤.</p><p>internal</p><p>äº¤æ¢å™¨æ˜¯å¦æ˜¯å†…éƒ¨çš„ï¼Œå³ä¸èƒ½ç”±clientç›´æ¥å‘å¸ƒ.</p><p>arguments</p><p>äº¤æ¢å™¨å‚æ•°</p><p>policy</p><p>åº”ç”¨åˆ°äº¤æ¢å™¨ä¸Šçš„ç­–ç•¥åç§°.</p><p>å¦‚æœæ²¡æœ‰æŒ‡å®š<strong>exchangeinfoitem</strong>sï¼Œé‚£ä¹ˆå°†ä¼šæ˜¾ç¤ºäº¤æ¢å™¨ç±»å‹å’Œç±»å‹</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl list_exchanges -p &#x2F;myvhost name type</p><p>æ­¤å‘½ä»¤ä¼šæ˜¾ç¤º**&#x2F;myvhost**ä¸­æ¯ä¸ªäº¤æ¢å™¨çš„åç§°å’Œç±»å‹.</p><p>list_bindings [-pÂ _vhost_] [<em>bindinginfoitem</em>Â â€¦]</p><p>è¿”å›ç»‘å®šç»†èŠ‚.é»˜è®¤æƒ…å†µä¸‹è¿”å›çš„æ˜¯Â <strong>&#x2F;</strong>Â è™šæ‹Ÿä¸»æœºä¸Šçš„ç»‘å®šè¯¦æƒ….å¯ä½¿ç”¨â€-pâ€ æ ‡è®°æ¥è¦†ç›–é»˜è®¤è™šæ‹Ÿä¸»æœº.</p><p><strong>bindinginfoitem</strong>Â å‚æ•°ç”¨æ¥è¡¨ç¤ºç»“æœä¸­åŒ…å«å“ªäº›ç»‘å®šä¿¡æ¯. ç»“æœé›†ä¸­åˆ—çš„é¡ºåºå°†åŒ¹é…å‚æ•°çš„é¡ºåº.<strong>bindinginfoitem</strong>å¯æ¥å—ä¸‹é¢åˆ—è¡¨çš„ä»»æ„å€¼:</p><p>source_name</p><p>ç»‘å®šä¸­æ¶ˆæ¯æ¥æºçš„åç§°.Â Cä¸­éASCIIè½¬ä¹‰å­—ç¬¦.</p><p>source_kind</p><p>ç»‘å®šä¸­æ¶ˆæ¯æ¥æºçš„ç±»åˆ«.å½“å‰æ€»æ˜¯exchange.Â Cä¸­éASCIIè½¬ä¹‰å­—ç¬¦.</p><p>destination_name</p><p>ç»‘å®šä¸­æ¶ˆæ¯ç›®çš„åœ°åç§°.Cä¸­éASCIIè½¬ä¹‰å­—ç¬¦.</p><p>destination_kind</p><p>ç»‘å®šä¸­æ¶ˆæ¯ç›®çš„åœ°çš„ç§ç±».Â Cä¸­éASCIIè½¬ä¹‰å­—ç¬¦.</p><p>routing_key</p><p>ç»‘å®šçš„è·¯ç”±é”®,Cä¸­éASCIIè½¬ä¹‰å­—ç¬¦.</p><p>arguments</p><p>ç»‘å®šå‚æ•°.</p><p>å¦‚æœæ²¡æœ‰æŒ‡å®š<strong>bindinginfoitem</strong>sï¼Œå°†ä¼šæ˜¾ç¤ºæ‰€æœ‰ä¸Šè¿°æ¡ç›®ï¼</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl list_bindings -p &#x2F;myvhost exchange_name queue_name</p><p>æ­¤å‘½ä»¤æ¥æ˜¾ç¤º**&#x2F;myvhost**è™šæ‹Ÿä¸»æœºä¸Šç»‘å®šçš„äº¤æ¢å™¨åç§°å’Œé˜Ÿåˆ—åç§°.</p><p>list_connections [<em>connectioninfoitem</em>Â â€¦]</p><p>è¿”å›TCP&#x2F;IPè¿æ¥ç»Ÿè®¡.</p><p><strong>connectioninfoitem</strong>Â å‚æ•°ç”¨æ¥è¡¨ç¤ºåœ¨ç»“æœä¸­åŒ…å«å“ªäº›è¿æ¥ä¿¡æ¯.Â ç»“æœé›†ä¸­åˆ—çš„é¡ºåºå°†åŒ¹é…å‚æ•°çš„é¡ºåº.Â  Â Â  Â Â  Â Â  Â Â  Â <strong>connectioninfoitem</strong>å¯æ¥å—ä¸‹é¢åˆ—è¡¨çš„ä»»æ„å€¼:</p><p>pid</p><p>ä¸è¿æ¥ç›¸å…³çš„Erlangè¿›ç¨‹ID.</p><p>name</p><p>è¿æ¥çš„å¯è¯»åç§°.</p><p>port</p><p>æœåŠ¡å™¨ç«¯å£.</p><p>host</p><p>è¿”å›åå‘DNSè·å–çš„æœåŠ¡å™¨ä¸»æœºåç§°ï¼Œæˆ– IPåœ°å€(åå‘DNSè§£æå¤±è´¥) æˆ–è€…æœªå¯ç”¨ï¼</p><p>peer_port</p><p>Peer ç«¯å£.</p><p>peer_host</p><p>ã€€ã€€ã€€è¿”å›åå‘DNSè·å–çš„Peerä¸»æœºåç§°ï¼Œæˆ– IPåœ°å€(åå‘DNSè§£æå¤±è´¥) æˆ–è€…æœªå¯ç”¨ï¼</p><p>ssl</p><p>ç”¨Booleanæ¥è¡¨ç¤ºè¿æ¥æ˜¯å¦æ˜¯SSLçš„.</p><p>ssl_protocol</p><p>SSL åè®®(å¦‚. tlsv1)</p><p>ssl_key_exchange</p><p>SSL key exchange ç®—æ³• (å¦‚ rsa)</p><p>ssl_cipher</p><p>SSL cipher ç®—æ³• (å¦‚aes_256_cbc)</p><p>ssl_hash</p><p>SSL hash å‡½æ•° (å¦‚ sha)</p><p>peer_cert_subject</p><p>peerçš„ SSL å®‰å…¨è¯ä¹¦çš„ä¸»ä½“, RFC4514å½¢å¼ï¼</p><p>peer_cert_issuer</p><p>peerçš„ SSLå®‰å…¨è¯ä¹¦çš„å‘è¡Œè€…, RFC4514 å½¢å¼.</p><p>peer_cert_validity</p><p>peerçš„SSLå®‰å…¨è¯ä¹¦çš„æœ‰æ•ˆæœŸ.</p><p>state</p><p>è¿æ¥çŠ¶æ€(å¯ä¸º[<strong>starting</strong>,Â <strong>tuning</strong>,Â <strong>opening</strong>,Â <strong>running</strong>,Â <strong>flow</strong>,Â <strong>blocking</strong>,Â <strong>blocked</strong>,Â <strong>closing</strong>,Â <strong>closed</strong>]å…¶ä¸­ä¸€ä¸ª).</p><p>channels</p><p>ä½¿ç”¨è¿æ¥çš„channelæ•°ã€‚</p><p>protocol</p><p>ä½¿ç”¨çš„AMQPåè®®ç‰ˆæœ¬(å½“å‰æ˜¯**{0,9,1}**Â æˆ–**{0,8,0}**). æ³¨æ„ï¼Œå¦‚æœclientè¯·æ±‚çš„æ˜¯AMQP 0-9 è¿æ¥, æˆ‘ä»¬ä¼šè§†ä¸ºAMQP 0-9-1.</p><p>auth_mechanism</p><p>ä½¿ç”¨çš„SASLè®¤è¯æœºåˆ¶,å¦‚<strong>PLAIN</strong>.</p><p>user</p><p>ä¸è¿æ¥ç›¸å…³çš„ç”¨æˆ·å</p><p>vhost</p><p>è™šæ‹Ÿä¸»æœºåç§°ï¼Œï¼£ä¸­éASCIIè½¬ä¹‰å­—ç¬¦.</p><p>timeout</p><p>è¿æ¥è¶…æ—¶ï¼åå•†çš„å¿ƒè·³é—´éš”,ç§’ä¸ºå•ä½.</p><p>frame_max</p><p>æœ€å¤§ frame å¤§å°(å­—èŠ‚).</p><p>channel_max</p><p>Â  Â  Â  Â  æ­¤è¿æ¥ä¸Šchannelçš„æœ€å¤§æ•°ç›®.</p><p>client_properties</p><p>è¿æ¥å»ºç«‹æœŸé—´ç”±clientå‘é€çš„ä¿¡æ¯å±æ€§.</p><p>recv_oct</p><p>Octetså·²æ”¶åˆ°.</p><p>recv_cnt</p><p>PacketsÂ å·²æ”¶åˆ°.</p><p>send_oct</p><p>Octets å‘é€.</p><p>send_cnt</p><p>Packets å‘é€.</p><p>send_pend</p><p>å‘é€é˜Ÿåˆ—å¤§å°.</p><p>connected_at</p><p>è¿æ¥å»ºç«‹çš„æ—¥æœŸå’Œæ—¶é—´,å½“ä½œtimestamp.</p><p>å¦‚æœæ²¡æœ‰<strong>connectioninfoitem</strong>sï¼Œ é‚£ä¹ˆä¼šæ˜¾ç¤ºuser, peer host, peer port,æµé‡æ§åˆ¶å’Œå†…å­˜å—çŠ¶æ€çš„æ—¶é—´</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl list_connections send_pend port</p><p>æ­¤å‘½ä»¤ä¼šæ˜¾ç¤ºå‘é€é˜Ÿåˆ—çš„å¤§å°ä»¥åŠç¬¬ä¸ªè¿æ¥çš„æœåŠ¡å™¨ç«¯å£ï¼</p><p>list_channels [<em>channelinfoitem</em>Â â€¦]</p><p>è¿”å›æ‰€æœ‰å½“å‰channelä¸Šçš„ä¿¡æ¯,é€»è¾‘å®¹å™¨æ‰§è¡Œå¤§éƒ¨åˆ† AMQPå‘½ä»¤.è¿™å°†åŒ…å«æœ€åˆAMQPè¿æ¥çš„éƒ¨åˆ†ï¼Œä»¥åŠä¸åŒæ’ä»¶å’Œå…¶å®ƒæ‰©å±•åˆ›å»ºçš„channels.</p><p><strong>channelinfoitem</strong>Â å‚æ•°ç”¨æ¥è¡¨ç¤ºåœ¨ç»“æœé›†ä¸­åŒ…å«å“ªäº›channelä¿¡æ¯ï¼ç»“æœé›†ä¸­åˆ—çš„é¡ºåºå°†åŒ¹é…å‚æ•°çš„é¡ºåº.Â <strong>channelinfoitem</strong>Â å¯æ¥å—ä¸‹é¢åˆ—è¡¨ä¸­çš„ä»»ä½•ä¸€ä¸ªå‚æ•°ï¼š</p><p>pid</p><p>ä¸è¿æ¥ç›¸å…³çš„Erlangè¿›ç¨‹ID.</p><p>connection</p><p>channelæ‰€å±çš„è¿æ¥Erlangè¿›ç¨‹ID.</p><p>name</p><p>channelçš„å¯è¯»åç§°.</p><p>number</p><p>channelçš„æ•°ç›®ï¼Œåœ¨ä¸€ä¸ªè¿æ¥ä¸­ï¼Œå®ƒæœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼</p><p>user</p><p>ä¸channelç›¸å…³çš„ç”¨æˆ·åç§°.</p><p>vhost</p><p>channelæ“ä½œçš„è™šæ‹Ÿä¸»æœº.</p><p>transactional</p><p>Trueï¼šå¦‚æœchannelå¤„äºäº‹åŠ¡æ¨¡å¼,å…¶å®ƒæƒ…å†µä¸ºfalse.</p><p>confirm</p><p>Trueï¼šå¦‚æœchannelæ˜¯ç¡®è®¤æ¨¡å¼ï¼Œå…¶å®ƒæƒ…å†µä¸ºfalse.</p><p>consumer_count</p><p>åœ¨channelä¸­æ¥æ”¶æ¶ˆæ¯çš„é€»è¾‘AMQPæ¶ˆè´¹è€…æ•°ç›®ï¼</p><p>messages_unacknowledged</p><p>åœ¨channelä¸­æ¶ˆæ¯å·²æŠ•é€’ä½†è¿˜æœªåº”ç­”çš„æ¶ˆæ¯æ•°ç›®ï¼</p><p>messages_uncommitted</p><p>åœ¨channelä¸­å·²æ”¶åˆ°æ¶ˆæ¯ä½†è¿˜æ²¡æœ‰æäº¤äº‹åŠ¡çš„æ¶ˆæ¯ä¸ªæ•°ï¼</p><p>acks_uncommitted</p><p>ç¡®è®¤æ”¶åˆ°ä¸€ä¸ªè¿˜æœªæäº¤çš„äº‹åŠ¡æ•°ã€‚</p><p>messages_unconfirmed</p><p>å°šæœªç¡®è®¤å·²å‘å¸ƒæ¶ˆæ¯çš„æ•°ç›®ã€‚åœ¨é€šé“ä¸åœ¨ç¡®è®¤æ¨¡å¼ä¸‹æ—¶ï¼Œè¿™å°†æ˜¯0ã€‚</p><p>prefetch_count</p><p>æ–°æ¶ˆè´¹è€…QoSé¢„æå–é™åˆ¶, 0è¡¨ç¤ºæ— ä¸Šé™.</p><p>global_prefetch_count</p><p>æ•´ä¸ªchannelã€€QoSé¢„æå–é™åˆ¶, 0è¡¨ç¤ºæ— ä¸Šé™.</p><p>å¦‚æœæ²¡æœ‰æŒ‡å®š<strong>channelinfoitem</strong>sï¼Œé‚£ä¹ˆå°†æ˜¾ç¤ºpid, user, consumer_count,messages_unacknowledgedï¼</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl list_channels connection messages_unacknowledged</p><p>æ­¤å‘½ä»¤ä¼šæ˜¾ç¤ºæ¯ä¸ªchannelä¸­è¿æ¥è¿›ç¨‹å’Œæœªåº”ç­”æ¶ˆæ¯çš„æ•°ç›®.</p><p>list_consumers [-pÂ _vhost_]</p><p>åˆ—ä¸¾æ¶ˆè´¹è€…, å³è®¢é˜…é˜Ÿåˆ—çš„æ¶ˆæ¯æµ. æ¯è¡Œå°†æ‰“å°å‡ºç”±åˆ¶è¡¨ç¬¦åˆ†éš”çš„å·²è®¢é˜…é˜Ÿåˆ—çš„åç§°ï¼Œåˆ›å»ºå¹¶ç®¡ç†è®¢é˜…çš„channelè¿›ç¨‹çš„æ ‡è¯†,channelä¸­è®¢é˜…çš„consumer tagå”¯ä¸€æ ‡è¯†ç¬¦, booleanå€¼è¡¨ç¤ºæŠ•é€’åˆ°æ­¤æ¶ˆè´¹è€…çš„æ¶ˆæ¯æ˜¯å¦éœ€è¦åº”ç­”,æ•´æ•°å€¼è¡¨ç¤ºè¡¨ç¤ºé¢„æå–é™åˆ¶(ä¸ºï¼è¡¨ç¤ºæ— é™åˆ¶), ä»¥åŠå…³äºæ­¤æ¶ˆè´¹è€…çš„ä»»ä½•å…¶å®ƒå‚æ•°ï¼</p><p>status</p><p>æ˜¾ç¤º broker çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚å½“å‰ErlangèŠ‚ç‚¹ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åº, RabbitMQ å’Œ Erlang çš„ç‰ˆæœ¬ä¿¡æ¯, OS åç§°, å†…å­˜å’Œæ–‡ä»¶æè¿°ç¬¦ç»Ÿè®¡ä¿¡æ¯. (æŸ¥çœ‹<strong>cluster_status</strong>Â å‘½ä»¤æ¥æ‰¾å‡ºé‚£äº›èŠ‚ç‚¹æ˜¯é›†ç¾¤åŒ–çš„ä»¥åŠæ­£åœ¨è¿è¡Œçš„.)</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl status</p><p>æ­¤å‘½ä»¤æ˜¾ç¤ºäº†RabbitMQ brokerçš„ç›¸å…³ä¿¡æ¯.</p><p>environment</p><p>æ˜¾ç¤ºæ¯ä¸ªè¿è¡Œç¨‹åºç¯å¢ƒä¸­æ¯ä¸ªå˜é‡çš„åç§°å’Œå€¼.</p><p>report</p><p>ä¸ºæ‰€æœ‰æœåŠ¡å™¨çŠ¶æ€ç”Ÿæˆä¸€ä¸ªæœåŠ¡å™¨çŠ¶æ€æŠ¥å‘Šï¼Œè¾“å‡ºåº”è¯¥é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl report &gt; server_report.txt</p><p>æ­¤å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡å™¨æŠ¥å‘Šï¼Œå¯å°†å®ƒé™„ç€åœ¨æ”¯æŒè¯·æ±‚çš„ç”µå­é‚®ä»¶ä¸­ï¼</p><p>eval {<em>expr</em>}</p><p>æ‰§è¡Œä»»æ„Erlangè¡¨è¾¾å¼.</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl eval â€˜node().â€™</p><p>æ­¤å‘½ä»¤ç”¨äºè¿”å›rabbitmqctlè¿æ¥çš„èŠ‚ç‚¹åç§°</p><h3 id="æ‚é¡¹"><a href="#æ‚é¡¹" class="headerlink" title="æ‚é¡¹"></a>æ‚é¡¹</h3><p>close_connection {<em>connectionpid</em>} {<em>explanation</em>}</p><p>connectionpid</p><p>è¦å…³é—­çš„ä¸è¿æ¥ç›¸å…³çš„Erlangè¿›ç¨‹ID.</p><p>explanation</p><p>è§£é‡Šå­—ç¬¦ä¸².</p><p>æŒ‡ç¤ºbrokerå…³é—­ä¸Erlangè¿›ç¨‹idç›¸å…³çš„è¿æ¥(å¯é€šè¿‡<a href="http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#list_connections"><strong>list_connections</strong></a>Â å‘½ä»¤æŸ¥çœ‹), é€šè¿‡ä¸ºè¿æ¥å®¢æˆ·ç«¯ä¼ é€’è§£é‡Šå­—ç¬¦ä¸²(ä½œä¸ºAMQPè¿æ¥å…³é—­åè®®çš„ä¸€éƒ¨åˆ†).</p><p>ä¾‹å¦‚:</p><p>rabbitmqctl close_connection â€œ<a href="mailto:&#x72;&#x61;&#x62;&#98;&#x69;&#x74;&#x40;&#116;&#x61;&#x6e;&#116;&#111;&#x2e;&#52;&#50;&#54;&#x32;&#x2e;&#48;">&#x72;&#x61;&#x62;&#98;&#x69;&#x74;&#x40;&#116;&#x61;&#x6e;&#116;&#111;&#x2e;&#52;&#50;&#54;&#x32;&#x2e;&#48;</a>â€œ â€œgo awayâ€</p><p>æ­¤å‘½ä»¤æŒ‡ç¤ºRabbitMQ brokerå…³é—­ä¸Erlang è¿›ç¨‹id<a href="mailto:&#114;&#x61;&#98;&#x62;&#x69;&#116;&#64;&#116;&#97;&#110;&#116;&#111;&#x2e;&#52;&#x32;&#54;&#50;&#46;&#x30;">&#114;&#x61;&#98;&#x62;&#x69;&#116;&#64;&#116;&#97;&#110;&#116;&#111;&#x2e;&#52;&#x32;&#54;&#50;&#46;&#x30;</a>ç›¸å…³è”çš„è¿æ¥, åŒæ—¶å‘å®¢æˆ·ç«¯ä¼ é€’go awayå­—ç¬¦ä¸².</p><p>trace_on [-pÂ _vhost_]</p><p>vhost</p><p>è¦å¼€å¯è¿½è¸ªçš„è™šæ‹Ÿä¸»æœºçš„åç§°.</p><p>å¼€å¯è¿½è¸ª.æ³¨æ„ï¼Œè¿½è¸ªçŠ¶æ€ä¸æ˜¯æŒä¹…åŒ–çš„; å¦‚æœæœåŠ¡å™¨é‡å¯ï¼Œè¿½è¸ªçŠ¶æ€å°†ä¼šä¸¢å¤±.</p><p>trace_off [-pÂ _vhost_]</p><p>vhost</p><p>è¦åœæ­¢è¿½è¸ªçš„è™šæ‹Ÿä¸»æœºåç§°.</p><p>åœæ­¢è¿½è¸ª.</p><p>set_vm_memory_high_watermark {<em>fraction</em>}</p><p>fraction</p><p>å½“ä¸€ä¸ªæµ®ç‚¹æ•°å¤§äºæˆ–ç­‰äº0æ—¶ï¼Œä¼šè§¦å‘æµé‡æ§åˆ¶æ–°å†…å­˜é˜ˆå€¼éƒ¨åˆ†ã€‚</p><p>set_vm_memory_high_watermark absolute {<em>memory_limit</em>}</p><p>memory_limit</p><p>æµç¨‹æ§åˆ¶è§¦å‘çš„æ–°å†…å­˜é™åˆ¶, ä»¥å­—èŠ‚æ¥è¡¨ç¤ºå¤§äºæˆ–ç­‰äºï¼çš„æ•´æ•°æˆ–ä»¥å­—ç¬¦ä¸²å’Œå†…å­˜å•ä½æ¥è¡¨ç¤º(å¦‚ 512Mæˆ–1G). å¯ç”¨çš„å•ä½æ˜¯: k, kiB: kibibytes (2^10 bytes) M, MiB: mebibytes (2^20) G, GiB: gibibytes (2^30) kB: kilobytes (10^3) MB: megabytes (10^6) GB: gigabytes (10^9)</p><p>set_disk_free_limit {<em>disk_limit</em>}</p><p>disk_limit</p><p>ä»¥æ•´æ•°æˆ–å­—ç¬¦ä¸²å•ä½çš„å¯ç”¨ç£ç›˜ä¸‹é™é™åˆ¶(æŸ¥çœ‹vm_memory_high_watermark), å¦‚ 512M or 1G. ä¸€æ—¦å¯ç”¨ç£ç›˜ç©ºé—´è¾¾åˆ°è¿™ä¸ªé™åˆ¶ï¼Œå°±ä¼šè®¾ç½®ç£ç›˜æŠ¥è­¦.</p><p>set_disk_free_limit mem_relative {<em>fraction</em>}</p><p>fraction</p><p>ç›¸å¯¹äºæ•´ä¸ªå¯ç”¨å†…å­˜çš„é™åˆ¶ï¼Œå…¶å€¼ä¸ºéè´Ÿæµ®ç‚¹æ•°. å½“å€¼å°äºï¼‘.ï¼æ—¶æ˜¯å¾ˆå±é™©çš„ï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨ï¼</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Rabbitmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>rabbitmqæ•°æ®å¤‡ä»½ä¸è¿˜åŸ</title>
    <link href="/article/1530782b.html"/>
    <url>/article/1530782b.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /><p><strong>æ­£æ–‡</strong></p><h2 id="ä¸€ã€åœºæ™¯"><a href="#ä¸€ã€åœºæ™¯" class="headerlink" title="ä¸€ã€åœºæ™¯"></a>ä¸€ã€åœºæ™¯</h2><p>ç°åœ¨æœ‰æœåŠ¡å™¨Aå’ŒæœåŠ¡å™¨B ï¼Œç”±äºä¸šåŠ¡éœ€è¦ï¼Œè¦æ±‚æŠŠæœåŠ¡å™¨Aä¸Šmqçš„æ•°æ®è¿ç§»åˆ°æœåŠ¡å™¨Bä¸Šï¼Œrabbitmqçš„æ•°æ®åŒ…æ‹¬å…ƒæ•°æ®ï¼ˆRabbitMQç”¨æˆ·ã€vhostã€é˜Ÿåˆ—ã€äº¤æ¢å’Œç»‘å®šï¼‰å’Œæ¶ˆæ¯æ•°æ®ï¼Œè€Œæ¶ˆæ¯æ•°æ®å­˜å‚¨åœ¨å•ç‹¬çš„æ¶ˆæ¯å­˜å‚¨åº“ä¸­ã€‚</p><p>A:192.168.2.58</p><p>B:192.168.1.60</p><h2 id="äºŒã€å…ƒæ•°æ®å¤‡ä»½å’Œè¿˜åŸ"><a href="#äºŒã€å…ƒæ•°æ®å¤‡ä»½å’Œè¿˜åŸ" class="headerlink" title="äºŒã€å…ƒæ•°æ®å¤‡ä»½å’Œè¿˜åŸ"></a>äºŒã€å…ƒæ•°æ®å¤‡ä»½å’Œè¿˜åŸ</h2><h3 id="1ã€æ“ä½œ"><a href="#1ã€æ“ä½œ" class="headerlink" title="1ã€æ“ä½œ"></a>1ã€æ“ä½œ</h3><p>åœ¨æœåŠ¡Bä¸Šæ­å»ºrabbitmqæœåŠ¡ï¼Œæ³¨æ„ï¼Œä¸»æœºåæœ€å¥½å’ŒAä¸Šçš„MQä¿æŒä¸€è‡´ã€‚é¿å…åé¢çš„æ•°æ®å­˜å‚¨èŠ‚ç‚¹åä¸ä¸€è‡´ï¼Œå¯¼è‡´å¯åŠ¨å¤±è´¥</p><p>å®‰è£…è¿‡ç¨‹è¯¦è§ï¼š</p><h3 id="2ã€å¯¼å‡ºæ•°æ®"><a href="#2ã€å¯¼å‡ºæ•°æ®" class="headerlink" title="2ã€å¯¼å‡ºæ•°æ®"></a>2ã€å¯¼å‡ºæ•°æ®</h3><p>ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•åˆ°AæœåŠ¡å™¨ä¸Šçš„ç®¡ç†åå°</p><p><a href="http://192.168.2.58:15672ï¼ŒæŒ‰å¦‚ä¸‹æ‰€ç¤ºæŠŠå¤‡ä»½çš„æ•°æ®ä¸‹è½½åˆ°æœ¬åœ°">http://192.168.2.58:15672ï¼ŒæŒ‰å¦‚ä¸‹æ‰€ç¤ºæŠŠå¤‡ä»½çš„æ•°æ®ä¸‹è½½åˆ°æœ¬åœ°</a></p><p><img src="https://img2018.cnblogs.com/blog/1291340/201906/1291340-20190618150136499-1626013564.png"></p><h3 id="3ã€å¯¼å…¥æ•°æ®"><a href="#3ã€å¯¼å…¥æ•°æ®" class="headerlink" title="3ã€å¯¼å…¥æ•°æ®"></a>3ã€å¯¼å…¥æ•°æ®</h3><p>ç™»å½•åˆ°BæœåŠ¡å™¨ä¸Šçš„MQç®¡ç†åå°</p><p><a href="http://192.168.1.60:15672,è¿›å…¥å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ä½ç½®ï¼Œå¯¼å…¥æ•°æ®ï¼Œå¤§æ¦‚10ç§’é’Ÿå·¦å³ã€‚">http://192.168.1.60:15672,è¿›å…¥å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ä½ç½®ï¼Œå¯¼å…¥æ•°æ®ï¼Œå¤§æ¦‚10ç§’é’Ÿå·¦å³ã€‚</a></p><p><img src="https://img2018.cnblogs.com/blog/1291340/201906/1291340-20190618150535198-1111324964.png"></p><h3 id="4ã€éªŒè¯æ•°æ®"><a href="#4ã€éªŒè¯æ•°æ®" class="headerlink" title="4ã€éªŒè¯æ•°æ®"></a>4ã€éªŒè¯æ•°æ®</h3><p>åˆ·æ–°é¡µé¢ï¼ŒæŸ¥çœ‹ç”¨æˆ·ã€é˜Ÿåˆ—ã€vhost ç­‰ä¿¡æ¯æ˜¯å¦å­˜åœ¨</p><p><img src="https://img2018.cnblogs.com/blog/1291340/201906/1291340-20190618150932480-1733657491.png"></p><h2 id="ä¸‰ã€æ¶ˆæ¯æ•°æ®å¤‡ä»½å’Œè¿˜åŸ"><a href="#ä¸‰ã€æ¶ˆæ¯æ•°æ®å¤‡ä»½å’Œè¿˜åŸ" class="headerlink" title="ä¸‰ã€æ¶ˆæ¯æ•°æ®å¤‡ä»½å’Œè¿˜åŸ"></a>ä¸‰ã€æ¶ˆæ¯æ•°æ®å¤‡ä»½å’Œè¿˜åŸ</h2><h3 id="1ã€ç¡®å®šæ•°æ®ç›®å½•"><a href="#1ã€ç¡®å®šæ•°æ®ç›®å½•" class="headerlink" title="1ã€ç¡®å®šæ•°æ®ç›®å½•"></a>1ã€ç¡®å®šæ•°æ®ç›®å½•</h3><p>ç™»å½•åˆ°AæœåŠ¡å™¨ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç¡®å®šæ¶ˆæ¯æ•°æ®å­˜å‚¨ç›®ï¼š</p><p>[root@rabbitmq-ipr-service-test opt]# rabbitmqctl eval â€˜rabbit_mnesia:dir().â€™<br>â€œ&#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;mnesia&#x2F;rabbit@rabbitmq-ipr-service-testâ€</p><h3 id="2ã€ä¸ºé¿å…æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€å…ˆåœæ‰æœåŠ¡"><a href="#2ã€ä¸ºé¿å…æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€å…ˆåœæ‰æœåŠ¡" class="headerlink" title="2ã€ä¸ºé¿å…æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€å…ˆåœæ‰æœåŠ¡"></a>2ã€ä¸ºé¿å…æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€å…ˆåœæ‰æœåŠ¡</h3><p>service rabbitmq-server stop</p><h3 id="3ã€å¤‡ä»½æ•°æ®ç›®å½•"><a href="#3ã€å¤‡ä»½æ•°æ®ç›®å½•" class="headerlink" title="3ã€å¤‡ä»½æ•°æ®ç›®å½•"></a>3ã€å¤‡ä»½æ•°æ®ç›®å½•</h3><p>tar  -zcvf <a href="mailto:&#114;&#x61;&#98;&#98;&#105;&#116;&#64;&#x72;&#x61;&#x62;&#x62;&#x69;&#116;&#109;&#113;&#45;&#105;&#x70;&#x72;&#x2d;&#115;&#x65;&#114;&#118;&#105;&#x63;&#x65;&#x2d;&#116;&#x65;&#115;&#116;&#x2e;&#x74;&#x61;&#114;&#46;&#103;&#x7a;">&#114;&#x61;&#98;&#98;&#105;&#116;&#64;&#x72;&#x61;&#x62;&#x62;&#x69;&#116;&#109;&#113;&#45;&#105;&#x70;&#x72;&#x2d;&#115;&#x65;&#114;&#118;&#105;&#x63;&#x65;&#x2d;&#116;&#x65;&#115;&#116;&#x2e;&#x74;&#x61;&#114;&#46;&#103;&#x7a;</a>  rabbit@rabbitmq-ipr-service-test</p><h3 id="4ã€è¿˜åŸæ•°æ®"><a href="#4ã€è¿˜åŸæ•°æ®" class="headerlink" title="4ã€è¿˜åŸæ•°æ®"></a>4ã€è¿˜åŸæ•°æ®</h3><p>ç™»å½•åˆ°BæœåŠ¡å™¨ä¸Šï¼Œ<strong>å…ˆå¤‡ä»½åŸæ¥çš„æ•°æ®ç›®å½•ï¼Œ</strong>ä¸Šä¼ åˆ°å¤‡ä»½æ•°æ®åˆ°å¯¹åº”ç›®å½•ï¼Œå¹¶è§£å‹</p><p>tar  -zxvf  <a href="mailto:&#114;&#x61;&#x62;&#98;&#x69;&#x74;&#64;&#x72;&#97;&#x62;&#98;&#105;&#x74;&#x6d;&#113;&#x2d;&#105;&#x70;&#114;&#45;&#115;&#101;&#114;&#118;&#105;&#99;&#101;&#45;&#116;&#x65;&#115;&#x74;&#x2e;&#116;&#x61;&#x72;&#46;&#103;&#122;">&#114;&#x61;&#x62;&#98;&#x69;&#x74;&#64;&#x72;&#97;&#x62;&#98;&#105;&#x74;&#x6d;&#113;&#x2d;&#105;&#x70;&#114;&#45;&#115;&#101;&#114;&#118;&#105;&#99;&#101;&#45;&#116;&#x65;&#115;&#x74;&#x2e;&#116;&#x61;&#x72;&#46;&#103;&#122;</a> </p><h3 id="5ã€ä¿®æ”¹æ•°æ®ç›®å½•æƒé™"><a href="#5ã€ä¿®æ”¹æ•°æ®ç›®å½•æƒé™" class="headerlink" title="5ã€ä¿®æ”¹æ•°æ®ç›®å½•æƒé™"></a>5ã€ä¿®æ”¹æ•°æ®ç›®å½•æƒé™</h3><p>chown  -R rabbitmq:rabbitmq  rabbit@rabbitmq-ipr-service-test</p><h3 id="6ã€å¯åŠ¨BæœåŠ¡å™¨ä¸ŠrabbitmqæœåŠ¡"><a href="#6ã€å¯åŠ¨BæœåŠ¡å™¨ä¸ŠrabbitmqæœåŠ¡" class="headerlink" title="6ã€å¯åŠ¨BæœåŠ¡å™¨ä¸ŠrabbitmqæœåŠ¡"></a>6ã€å¯åŠ¨BæœåŠ¡å™¨ä¸ŠrabbitmqæœåŠ¡</h3><p>service rabbitmq-server satrt</p><h3 id="7ã€éªŒè¯æ¶ˆæ¯æ•°æ®æ˜¯å¦è¿˜åŸæˆåŠŸ"><a href="#7ã€éªŒè¯æ¶ˆæ¯æ•°æ®æ˜¯å¦è¿˜åŸæˆåŠŸ" class="headerlink" title="7ã€éªŒè¯æ¶ˆæ¯æ•°æ®æ˜¯å¦è¿˜åŸæˆåŠŸ"></a>7ã€éªŒè¯æ¶ˆæ¯æ•°æ®æ˜¯å¦è¿˜åŸæˆåŠŸ</h3><p><img src="https://img2018.cnblogs.com/blog/1291340/201906/1291340-20190618154433737-1219710096.png"></p><h2 id="å››ã€æ³¨æ„"><a href="#å››ã€æ³¨æ„" class="headerlink" title="å››ã€æ³¨æ„"></a>å››ã€æ³¨æ„</h2><p>å†…éƒ¨èŠ‚ç‚¹æ•°æ®åº“åœ¨æŸäº›è®°å½•ä¸­å­˜å‚¨èŠ‚ç‚¹çš„åç§°ï¼Œå¦‚æœèŠ‚ç‚¹åç§°å‘ç”Ÿæ›´æ”¹ï¼Œåˆ™å¿…é¡»é¦–å…ˆä½¿ç”¨ä»¥ä¸‹rabbitmqctlå‘½ä»¤æ›´æ–°æ•°æ®åº“ä»¥ä¾¿æ›´æ”¹ï¼š</p><p>rabbitmqctl rename_cluster_node <oldnode> <newnode></p><p>å½“æ–°èŠ‚ç‚¹ä»¥å¤‡ä»½ç›®å½•å’ŒåŒ¹é…çš„èŠ‚ç‚¹åç§°å¯åŠ¨æ—¶ï¼Œå®ƒä¼šæ ¹æ®éœ€è¦æ‰§è¡Œå‡çº§æ­¥éª¤å¹¶ç»§ç»­å¼•å¯¼ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Rabbitmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sessionidæ€ä¹ˆç”Ÿæˆçš„</title>
    <link href="/article/f66f6b4.html"/>
    <url>/article/f66f6b4.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><p>æ˜¯ä¸€ä¸ªä¼šè¯çš„keyï¼Œæµè§ˆå™¨ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨ä¼šåœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆä¸€ä¸ªsessionï¼Œæœ‰ä¸€ä¸ªsessionidå’Œå®ƒå¯¹åº”ã€‚tomcatç”Ÿæˆçš„sessionidå«åšjsessionidã€‚</p><p>sessionåœ¨è®¿é—®tomcat<strong>æœåŠ¡å™¨</strong>HttpServletRequestçš„getSession(true)çš„æ—¶å€™<strong>åˆ›å»º</strong>ï¼Œtomcatçš„ManagerBaseç±»æä¾›åˆ›å»ºsessionidçš„æ–¹æ³•ï¼š<strong>éšæœºæ•°+æ—¶é—´+jvmid</strong>ï¼›</p><p>å­˜å‚¨åœ¨æœåŠ¡å™¨çš„å†…å­˜ä¸­ï¼Œtomcatçš„StandardManagerç±»å°†session<strong>å­˜å‚¨åœ¨å†…å­˜ä¸­</strong>ï¼Œä¹Ÿå¯ä»¥æŒä¹…åŒ–åˆ°fileï¼Œ<a href="https://cloud.tencent.com/solution/database?from_column=20065&from=20065">æ•°æ®åº“</a>ï¼Œmemcacheï¼Œredisç­‰ã€‚<strong>å®¢æˆ·ç«¯åªä¿å­˜sessionidåˆ°cookie</strong>ä¸­ï¼Œè€Œä¸ä¼šä¿å­˜sessionï¼Œsessioné”€æ¯åªèƒ½é€šè¿‡invalidateæˆ–è¶…æ—¶ï¼Œå…³æ‰æµè§ˆå™¨å¹¶ä¸ä¼šå…³é—­sessionã€‚</p><blockquote><p>é‚£ä¹ˆSessionåœ¨ä½•æ—¶åˆ›å»ºå‘¢ï¼Ÿå½“ç„¶è¿˜æ˜¯åœ¨æœåŠ¡å™¨ç«¯ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­åˆ›å»ºçš„ï¼Œä¸åŒè¯­è¨€å®ç°çš„åº”ç”¨ç¨‹åºæœ‰ä¸åŒåˆ›å»ºSessionçš„æ–¹æ³•ï¼Œè€Œåœ¨Javaä¸­æ˜¯é€šè¿‡è°ƒç”¨HttpServletRequestçš„getSessionæ–¹æ³•ï¼ˆä½¿ç”¨trueä½œä¸ºå‚æ•°ï¼‰åˆ›å»ºçš„ã€‚åœ¨åˆ›å»ºäº†Sessionçš„åŒæ—¶ï¼ŒæœåŠ¡å™¨ä¼šä¸ºè¯¥Sessionç”Ÿæˆå”¯ä¸€çš„SessionÂ idï¼Œè€Œè¿™ä¸ªSessionÂ idåœ¨éšåçš„è¯·æ±‚ä¸­ä¼šè¢«ç”¨æ¥é‡æ–°è·å¾—å·²ç»åˆ›å»ºçš„Sessionï¼›åœ¨Sessionè¢«åˆ›å»ºä¹‹åï¼Œå°±å¯ä»¥è°ƒç”¨Sessionç›¸å…³çš„æ–¹æ³•å¾€Sessionä¸­å¢åŠ å†…å®¹äº†ï¼Œè€Œè¿™äº›å†…å®¹åªä¼šä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œå‘åˆ°å®¢æˆ·ç«¯çš„åªæœ‰SessionÂ idï¼›å½“å®¢æˆ·ç«¯å†æ¬¡å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šå°†è¿™ä¸ªSessionÂ idå¸¦ä¸Šï¼ŒæœåŠ¡å™¨æ¥å—åˆ°è¯·æ±‚ä¹‹åå°±ä¼šä¾æ®SessionÂ idæ‰¾åˆ°ç›¸åº”çš„Sessionï¼Œä»è€Œå†æ¬¡ä½¿ç”¨ä¹‹ã€‚</p></blockquote><p><strong>åˆ›å»º</strong>ï¼šsessionidç¬¬ä¸€æ¬¡äº§ç”Ÿæ˜¯åœ¨ç›´åˆ°æŸserverç«¯ç¨‹åºè°ƒç”¨ HttpServletRequest.getSession(true)è¿™æ ·çš„è¯­å¥æ—¶æ‰è¢«åˆ›å»ºã€‚</p><p><strong>åˆ é™¤</strong>ï¼šè¶…æ—¶ï¼›ç¨‹åºè°ƒç”¨HttpSession.invalidate()ï¼›ç¨‹åºå…³é—­ï¼›</p><p><strong>sessionå­˜æ”¾åœ¨å“ªé‡Œ</strong>ï¼šæœåŠ¡å™¨ç«¯çš„å†…å­˜ä¸­ã€‚ä¸è¿‡sessionå¯ä»¥é€šè¿‡ç‰¹æ®Šçš„æ–¹å¼åšæŒä¹…åŒ–ç®¡ç†ï¼ˆmemcacheï¼Œredisï¼‰ã€‚</p><p><strong>sessionçš„idæ˜¯ä»å“ªé‡Œæ¥çš„</strong>ï¼ŒsessionIDæ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼šå½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚sessionå¯¹è±¡æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šä¸ºå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªsessionï¼Œå¹¶å°†é€šè¿‡ç‰¹æ®Šç®—æ³•ç®—å‡ºä¸€ä¸ªsessionçš„IDï¼Œç”¨æ¥æ ‡è¯†è¯¥sessionå¯¹è±¡</p><p><strong>sessionä¼šå› ä¸ºæµè§ˆå™¨çš„å…³é—­è€Œåˆ é™¤å—ï¼Ÿ</strong></p><p>ä¸ä¼šï¼Œsessionåªä¼šé€šè¿‡ä¸Šé¢æåˆ°çš„æ–¹å¼å»å…³é—­ã€‚</p><p><strong>ä¸‹é¢æ˜¯tomcatä¸­sessionçš„åˆ›å»ºï¼š</strong></p><blockquote><p>ManagerBaseæ˜¯æ‰€æœ‰sessionç®¡ç†å·¥å…·ç±»çš„åŸºç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€æœ‰å…·ä½“å®ç°sessionç®¡ç†åŠŸèƒ½çš„ç±»éƒ½è¦ç»§æ‰¿è¿™ä¸ªç±»ï¼Œè¯¥ç±»æœ‰ä¸€ä¸ªå—ä¿æŠ¤çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±æ˜¯åˆ›å»ºsessionIdå€¼çš„æ–¹æ³•ï¼š ï¼ˆ<strong>tomcatçš„sessionçš„idå€¼ç”Ÿæˆçš„æœºåˆ¶æ˜¯ä¸€ä¸ªéšæœºæ•°åŠ æ—¶é—´åŠ ä¸Šjvmçš„idå€¼ï¼Œjvmçš„idå€¼ä¼šæ ¹æ®æœåŠ¡å™¨çš„ç¡¬ä»¶ä¿¡æ¯è®¡ç®—å¾—æ¥ï¼Œå› æ­¤ä¸åŒjvmçš„idå€¼éƒ½æ˜¯å”¯ä¸€çš„</strong>ï¼‰ï¼Œ StandardManagerç±»æ˜¯tomcatå®¹å™¨é‡Œé»˜è®¤çš„sessionç®¡ç†å®ç°ç±»ï¼Œ <strong>å®ƒä¼šå°†sessionçš„ä¿¡æ¯å­˜å‚¨åˆ°webå®¹å™¨æ‰€åœ¨æœåŠ¡å™¨çš„å†…å­˜é‡Œ</strong>ã€‚ PersistentManagerBaseä¹Ÿæ˜¯ç»§æ‰¿ManagerBaseç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰æŒä¹…åŒ–å­˜å‚¨sessionä¿¡æ¯çš„åŸºç±»ï¼ŒPersistentManagerç»§æ‰¿äº†PersistentManagerBaseï¼Œä½†æ˜¯è¿™ä¸ªç±»åªæ˜¯å¤šäº†ä¸€ä¸ªé™æ€å˜é‡å’Œä¸€ä¸ªgetNameæ–¹æ³•ï¼Œç›®å‰çœ‹æ¥æ„ä¹‰ä¸å¤§ï¼Œ<strong>å¯¹äºæŒä¹…åŒ–å­˜å‚¨sessionï¼Œtomcatè¿˜æä¾›äº†StoreBaseçš„æŠ½è±¡ç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰æŒä¹…åŒ–å­˜å‚¨sessionçš„åŸºç±»ï¼Œå¦å¤–tomcatè¿˜ç»™å‡ºäº†</strong><a href="https://cloud.tencent.com/product/cfs?from_column=20065&from=20065"><strong>æ–‡ä»¶å­˜å‚¨</strong></a><strong>FileStoreå’Œ</strong><a href="https://cloud.tencent.com/product/cdcs?from_column=20065&from=20065"><strong>æ•°æ®å­˜å‚¨</strong></a><strong>JDBCStoreä¸¤ä¸ªå®ç°ã€‚</strong></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Netty-2 Java NIO</title>
    <link href="/article/f137bddf.html"/>
    <url>/article/f137bddf.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><h2 id="1-Channel"><a href="#1-Channel" class="headerlink" title="1. Channel"></a>1. Channel</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">NIOä¸­ä¸€ä¸ªè¿æ¥å°±æ˜¯ç”¨ä¸€ä¸ªChannelæ¥è¡¨ç¤ºã€‚ä»æ›´å¹¿æ³›çš„å±‚é¢æ¥è¯´ï¼Œä¸€ä¸ªé€šé“å¯ä»¥è¡¨ç¤ºä¸€ä¸ªåº•å±‚çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ä¾‹å¦‚ç¡¬ä»¶è®¾å¤‡ã€æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ç­‰ã€‚<span class="hljs-keyword">Java </span>NIOä¸­çš„é€šé“æ›´åŠ ç»†åŒ–ï¼Œä¾‹å¦‚ã€‚å¯¹åº”ä¸åŒçš„ç½‘ç»œä¼ è¾“åè®®ç±»å‹ï¼Œå†<span class="hljs-keyword">JAVAä¸­éƒ½ç”¨ä¸åŒçš„JAVA </span>NIO Channelå®ç°ã€‚<br></code></pre></td></tr></table></figure><h3 id="Channelç±»å‹ï¼š"><a href="#Channelç±»å‹ï¼š" class="headerlink" title="Channelç±»å‹ï¼š"></a>Channelç±»å‹ï¼š</h3><pre><code class="hljs">1.FileChannel : æ–‡ä»¶é€šé“ï¼Œç”¨äºæ–‡ä»¶çš„æ•°æ®è¯»å†™ï¼Œä¸é€‚åˆI/Oå¤šè·¯å¤ç”¨ã€‚2.SocketChannelï¼šå¥—æ¥å­—é€šé“ï¼Œç”¨äºSocketå¥—æ¥å­—TCPè¿æ¥çš„æ•°æ®è¯»å†™3.ServerSocketChannelï¼šæœåŠ¡å™¨åµŒå¥—å­—é€šé“ï¼Œå…è®¸æˆ‘ä»¬ç›‘å¬TCPçš„è¿æ¥è¯·æ±‚ï¼Œä¸ºæ¯ä¸ªç›‘å¬åˆ°çš„è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªSocketChannel4.DatagramChannelï¼šæ•°æ®æŠ¥é€šé“ï¼Œç”¨äºUDPåè®®çš„æ•°æ®è¯»å†™ã€‚</code></pre><h2 id="2-Buffer"><a href="#2-Buffer" class="headerlink" title="2. Buffer"></a>2. Buffer</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">NIOçš„<span class="hljs-built_in">Buffer</span>(ç¼“å†²åŒº) æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå†…å­˜å—ï¼Œæ—¢å¯ä»¥å†™å…¥æ•°æ®ä¹Ÿå¯ä»¥ä»ä¸­è¯»å–æ•°æ®ã€‚Bufferå†…éƒ¨æœ‰ä¸€ä¸ªbyte<span class="hljs-selector-attr">[]</span>æ•°ç»„å†…å­˜å—ï¼Œä½œä¸ºå†…å­˜ç¼“å†²åŒºã€‚ä¸ºäº†è®°å½•è¯»å†™çš„çŠ¶æ€å’Œä½ç½®Bufferç±»æä¾›äº†ä¸€äº›é‡è¦çš„å±æ€§ã€‚<span class="hljs-built_in">capacity</span>(å®¹é‡)ã€<span class="hljs-attribute">position</span>ï¼ˆè¯»å†™ä½ç½®ï¼‰ã€limitï¼ˆè¯»å†™çš„é™åˆ¶ï¼‰ã€<span class="hljs-selector-tag">mark</span>ï¼ˆæ ‡è®°ï¼‰<br>Bufferç±»æ˜¯ä¸€ä¸ªéçº¿ç¨‹å®‰å…¨çš„ç±»<br></code></pre></td></tr></table></figure><h4 id="Bufferç±»å‹ï¼š"><a href="#Bufferç±»å‹ï¼š" class="headerlink" title="Bufferç±»å‹ï¼š"></a>Bufferç±»å‹ï¼š</h4><pre><code class="hljs">ByteBufferCharBufferDoubleBufferFloatBufferIntBufferLongBufferShortBufferMappedByteBuffer</code></pre><h2 id="3-Selector"><a href="#3-Selector" class="headerlink" title="3. Selector"></a>3. Selector</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">é€‰æ‹©å™¨çš„ä½¿å‘½æ˜¯å®ŒæˆIOçš„å¤šè·¯å¤ç”¨ã€‚ä¸€ä¸ªé€šé“ä»£è¡¨ä¸€æ¡è¿æ¥é€šè·¯ï¼Œé€šè¿‡é€‰æ‹©å™¨å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªé€šé“çš„IOçŠ¶å†µã€‚<br></code></pre></td></tr></table></figure><h4 id="Selectorç›‘æ§çš„IOäº‹ä»¶ç±»å‹ï¼š"><a href="#Selectorç›‘æ§çš„IOäº‹ä»¶ç±»å‹ï¼š" class="headerlink" title="Selectorç›‘æ§çš„IOäº‹ä»¶ç±»å‹ï¼š"></a>Selectorç›‘æ§çš„IOäº‹ä»¶ç±»å‹ï¼š</h4><pre><code class="hljs">å¯è¯»ï¼šSelectionKey.OP_readå¯å†™ï¼šSelectionKey.OP_writeè¿æ¥ï¼šSelectionKey.OP_connectæ¥æ”¶ï¼šSelectionKey.OP_ACCEPT</code></pre>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Redisé›†ç¾¤å¦‚ä½•ä¿è¯é«˜å¯ç”¨</title>
    <link href="/article/da141ff0.html"/>
    <url>/article/da141ff0.html</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" />## 1ã€å‰è¨€<ol><li><p>Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¯ä»¥é€šè¿‡åœ¨å•æœºå¼€å¤šä¸ªRediså®ä¾‹ï¼Œé¿å…CPUå¤šæ ¸çš„æµªè´¹ï¼Œä½†æ˜¯å•æœºä»ç„¶å­˜åœ¨ç“¶é¢ˆã€‚</p></li><li><!-- toc --></li></ol><p> <strong>Redisé›†ç¾¤æ˜¯Redisçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œå½“ä¸€ä¸ªæœåŠ¡æŒ‚äº†å¯ä»¥å¿«é€Ÿçš„åˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªæœåŠ¡</strong>ï¼Œå½“é‡åˆ°å•æœºå†…å­˜ã€å¹¶å‘ç­‰ç“¶é¢ˆæ—¶ï¼Œå¸¸ä½¿ç”¨æ­¤æ–¹æ¡ˆã€‚</p><ol start="3"><li><p>é›†ç¾¤çš„éƒ¨ç½²æ–¹å¼ä¹Ÿå°±æ˜¯Redis clusterï¼Œ<strong>é‡‡ç”¨ä¸»ä»åŒæ­¥è¯»å†™åˆ†ç¦»</strong>ï¼Œç±»ä¼¼Mysqlçš„ä¸»ä»åŒæ­¥ï¼Œ<strong>Redis clusteræ”¯æ’‘ N ä¸ª Redis master nodeï¼Œæ¯ä¸ªmaster nodeéƒ½å¯ä»¥æŒ‚è½½å¤šä¸ª slave node</strong>ï¼Œè¿™æ ·æ•´ä¸ª Rediså°±å¯ä»¥æ¨ªå‘æ‰©å®¹äº†ã€‚</p></li><li><p>å¦‚æœè¦æ”¯æ’‘æ›´å¤§æ•°æ®é‡çš„ç¼“å­˜ï¼Œé‚£å°±æ¨ªå‘æ‰©å®¹æ›´å¤šçš„ master èŠ‚ç‚¹ï¼Œæ¯ä¸ª master èŠ‚ç‚¹å°±èƒ½å­˜æ”¾æ›´å¤šçš„æ•°æ®äº†ã€‚</p></li><li><p><strong>é›†ç¾¤ä¸­çš„èŠ‚ç‚¹åˆ†ä¸ºä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ï¼šåªæœ‰ä¸»èŠ‚ç‚¹è´Ÿè´£è¯»å†™è¯·æ±‚å’Œé›†ç¾¤ä¿¡æ¯çš„ç»´æŠ¤ï¼›ä»èŠ‚ç‚¹åªè¿›è¡Œä¸»èŠ‚ç‚¹æ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯çš„å¤åˆ¶ã€‚</strong></p></li></ol><h2 id="2ã€Redisä¸»ä»åŒæ­¥"><a href="#2ã€Redisä¸»ä»åŒæ­¥" class="headerlink" title="2ã€Redisä¸»ä»åŒæ­¥"></a>2ã€Redisä¸»ä»åŒæ­¥</h2><h3 id="2-1-ã€ä¸»ä»åŒæ­¥æ¶æ„"><a href="#2-1-ã€ä¸»ä»åŒæ­¥æ¶æ„" class="headerlink" title="2.1 ã€ä¸»ä»åŒæ­¥æ¶æ„"></a>2.1 ã€ä¸»ä»åŒæ­¥æ¶æ„</h3><ul><li><p>å•æœºçš„ redisï¼Œèƒ½å¤Ÿæ‰¿è½½çš„ QPS å¤§æ¦‚å°±åœ¨ä¸Šä¸‡åˆ°å‡ ä¸‡ä¸ç­‰ã€‚å¯¹äºç¼“å­˜æ¥è¯´ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨æ¥æ”¯æ’‘è¯»é«˜å¹¶å‘çš„ã€‚</p></li><li><p>å› æ­¤æ¶æ„åšæˆ**ä¸»ä»(master-slave)æ¶æ„ï¼Œä¸€ä¸»å¤šä»ï¼Œä¸»è´Ÿè´£å†™ï¼Œå¹¶ä¸”å°†æ•°æ®å¤åˆ¶åˆ°å…¶å®ƒçš„ slave èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»ã€‚**</p></li><li><p>æ‰€æœ‰çš„è¯»è¯·æ±‚å…¨éƒ¨èµ°ä»èŠ‚ç‚¹ã€‚è¿™æ ·å¯ä»¥è½»æ¾å®ç°æ°´å¹³æ‰©å®¹ï¼Œæ”¯æ’‘è¯»é«˜å¹¶å‘ã€‚</p></li></ul><p><img src="https://s2.51cto.com/images/blog/202109/01/e13b2cffbcae0c2b16b5249192241035.jpeg?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184" alt="ã€é¢è¯•ç³»åˆ—ã€‘Redisé›†ç¾¤å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ_å®¢æˆ·ç«¯">Redisä¸»ä»åŒæ­¥æ¶æ„</p><h3 id="2-2ã€æ•°æ®åŒæ­¥"><a href="#2-2ã€æ•°æ®åŒæ­¥" class="headerlink" title="2.2ã€æ•°æ®åŒæ­¥"></a>2.2ã€æ•°æ®åŒæ­¥</h3><ol><li>å¯åŠ¨ä¸€å°slave çš„æ—¶å€™ï¼Œä»–ä¼šå‘é€<code>psync</code>å‘½ä»¤ç»™master ï¼Œå¦‚æœæ˜¯è¿™ä¸ªslaveç¬¬ä¸€æ¬¡è¿æ¥åˆ°masterï¼Œä¼šè§¦å‘å…¨é‡å¤åˆ¶</li><li>masterå°±ä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œç”Ÿæˆ<strong>RDB</strong>å¿«ç…§ï¼Œå¹¶ä¸”æŠŠ<strong>æ–°çš„å†™è¯·æ±‚éƒ½ç¼“å­˜åœ¨å†…å­˜ä¸­</strong>ï¼Œ</li><li><strong>RDB</strong>æ–‡ä»¶ç”Ÿæˆåï¼Œmasterä¼šå°†è¿™ä¸ª<strong>RDB</strong>å‘é€ç»™slaveï¼Œ</li><li>slaveæ‹¿åˆ°ä¹‹åå†™è¿›æœ¬åœ°çš„ç£ç›˜ï¼Œç„¶ååŠ è½½è¿›å†…å­˜ï¼Œç„¶å<strong>masterä¼šæŠŠå†…å­˜é‡Œé¢ç¼“å­˜çš„é‚£äº›æ–°å‘½åéƒ½å‘ç»™slave</strong>ã€‚</li></ol><h3 id="å¢é‡å¤åˆ¶"><a href="#å¢é‡å¤åˆ¶" class="headerlink" title="å¢é‡å¤åˆ¶"></a>å¢é‡å¤åˆ¶</h3><ul><li><strong>å¦‚æœå…¨é‡å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œmaster-slave ç½‘ç»œè¿æ¥æ–­æ‰ï¼Œé‚£ä¹ˆ slave é‡æ–°è¿æ¥ master æ—¶ï¼Œä¼šè§¦å‘å¢é‡å¤åˆ¶ã€‚</strong></li><li><strong>master ç›´æ¥ä»è‡ªå·±çš„ backlog ä¸­è·å–éƒ¨åˆ†ä¸¢å¤±çš„æ•°æ®ï¼Œå‘é€ç»™ slave node</strong>ï¼Œé»˜è®¤ backlogå°±æ˜¯ 1MBã€‚</li><li>master å°±æ˜¯æ ¹æ® slave å‘é€çš„ <code>psync</code> ä¸­çš„<code>offset</code> æ¥ä» backlog ä¸­è·å–æ•°æ®çš„ã€‚</li></ul><p><img src="https://s2.51cto.com/images/blog/202109/01/bc5eec74b9c8d1e2fd09c0b9a6420884.jpeg?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184" alt="ã€é¢è¯•ç³»åˆ—ã€‘Redisé›†ç¾¤å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ_redis_02">RDBæŒä¹…åŒ–</p><blockquote><p>â€œ</p><p>æ³¨æ„ï¼šslave node å¦‚æœè·Ÿ master node æœ‰ç½‘ç»œæ•…éšœï¼Œæ–­å¼€äº†è¿æ¥ï¼Œ<strong>ä¼šè‡ªåŠ¨é‡è¿ï¼Œè¿æ¥ä¹‹å master node ä»…ä¼šå¤åˆ¶ç»™ slave éƒ¨åˆ†ç¼ºå°‘çš„æ•°æ®ã€‚</strong></p></blockquote><h2 id="3ã€å“¨å…µé›†ç¾¤"><a href="#3ã€å“¨å…µé›†ç¾¤" class="headerlink" title="3ã€å“¨å…µé›†ç¾¤"></a>3ã€å“¨å…µé›†ç¾¤</h2><h3 id="3-1ã€åŠŸèƒ½"><a href="#3-1ã€åŠŸèƒ½" class="headerlink" title="3.1ã€åŠŸèƒ½"></a>3.1ã€åŠŸèƒ½</h3><p>sentinelï¼Œä¸­æ–‡åæ˜¯å“¨å…µã€‚å“¨å…µæ˜¯ redis é›†ç¾¤æœºæ„ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œæœ¬èº«ä¹Ÿæ˜¯åˆ†å¸ƒå¼çš„ï¼Œä½œä¸ºä¸€ä¸ªå“¨å…µé›†ç¾¤å»è¿è¡Œï¼Œäº’ç›¸ååŒå·¥ä½œï¼Œä¸»è¦æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li><strong>é›†ç¾¤ç›‘æ§ï¼šè´Ÿè´£ç›‘æ§ redis master å’Œ slave è¿›ç¨‹æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</strong></li><li><strong>æ¶ˆæ¯é€šçŸ¥ï¼šå¦‚æœæŸä¸ª redis å®ä¾‹æœ‰æ•…éšœï¼Œé‚£ä¹ˆå“¨å…µè´Ÿè´£å‘é€æ¶ˆæ¯ä½œä¸ºæŠ¥è­¦é€šçŸ¥ç»™ç®¡ç†å‘˜ã€‚</strong></li><li><strong>æ•…éšœè½¬ç§»ï¼šå¦‚æœ master node æŒ‚æ‰äº†ï¼Œä¼šè‡ªåŠ¨è½¬ç§»åˆ° slave node ä¸Šã€‚</strong></li><li><strong>é…ç½®ä¸­å¿ƒï¼šå¦‚æœæ•…éšœè½¬ç§»å‘ç”Ÿäº†ï¼Œé€šçŸ¥ client å®¢æˆ·ç«¯æ–°çš„ master åœ°å€</strong></li></ul><h3 id="3-2ã€ç»å…¸å“¨å…µé›†ç¾¤"><a href="#3-2ã€ç»å…¸å“¨å…µé›†ç¾¤" class="headerlink" title="3.2ã€ç»å…¸å“¨å…µé›†ç¾¤"></a>3.2ã€ç»å…¸å“¨å…µé›†ç¾¤</h3><ol><li><strong>å“¨å…µå¿…é¡»ç”¨ä¸‰ä¸ªå®ä¾‹å»ä¿è¯è‡ªå·±çš„å¥å£®æ€§ï¼Œå“¨å…µ+ä¸»ä»çš„éƒ¨ç½²æ¶æ„å¹¶ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½†æ˜¯å¯ä»¥ä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨ã€‚</strong></li><li>ç»å…¸çš„å“¨å…µé›†ç¾¤å¦‚å›¾æ‰€ç¤ºï¼ŒM1æ‰€åœ¨çš„æœºå™¨æŒ‚äº†ï¼Œå“¨å…µè¿˜æœ‰ä¸¤ä¸ªï¼Œå¯ä»¥é€‰ä¸¾ä¸€ä¸ªå‡ºæ¥æ‰§è¡Œæ•…éšœè½¬ç§»ã€‚</li><li>ä½†æ˜¯å¦‚æœåªæœ‰ä¸¤ä¸ªå®ä¾‹å­˜åœ¨ï¼Œmasterå®•æœºäº†ï¼Œ s1å’Œs2ä¸¤ä¸ªå“¨å…µåªè¦æœ‰ä¸€ä¸ªè®¤ä¸ºä½ å®•æœºäº†å°±åˆ‡æ¢äº†ï¼Œå¹¶ä¸”ä¼šé€‰ä¸¾å‡ºä¸€ä¸ªå“¨å…µå»æ‰§è¡Œæ•…éšœ</li><li>å¦‚æœM1å®•æœºäº†ï¼ŒS1æ²¡æŒ‚é‚£å…¶å®æ˜¯OKçš„ï¼Œä½†æ˜¯æ•´ä¸ªæœºå™¨éƒ½æŒ‚äº†å‘¢ï¼Ÿå“¨å…µå°±åªå‰©ä¸‹å®ä¾‹S2ï¼Œæ²¡æœ‰å“¨å…µå»å…è®¸æ•…éšœè½¬ç§»äº†ï¼Œè™½ç„¶å¦å¤–ä¸€ä¸ªæœºå™¨ä¸Šè¿˜æœ‰R1ï¼Œä½†æ˜¯æ•…éšœè½¬ç§»æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œæ— æ³•ä¿è¯é›†ç¾¤é«˜å¯ç”¨ã€‚</li></ol><p><img src="https://s2.51cto.com/images/blog/202109/01/931168ce2d79466c95ccbe995eb6c702.jpeg?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184" alt="ã€é¢è¯•ç³»åˆ—ã€‘Redisé›†ç¾¤å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ_å®¢æˆ·ç«¯_03">ç»å…¸å“¨å…µé›†ç¾¤</p><h3 id="3-3ã€slave-gt-master-é€‰ä¸¾ç®—æ³•"><a href="#3-3ã€slave-gt-master-é€‰ä¸¾ç®—æ³•" class="headerlink" title="3.3ã€slave-&gt;master é€‰ä¸¾ç®—æ³•"></a>3.3ã€slave-&gt;master é€‰ä¸¾ç®—æ³•</h3><ol><li>å¦‚æœä¸€ä¸ªmasterè¢«è®¤ä¸ºå®•æœºäº†ï¼Œè€Œä¸”å¤§å¤šæ•°çš„å“¨å…µéƒ½å…è®¸ä¸»å¤‡åˆ‡æ¢ï¼Œé‚£ä¹ˆæŸä¸ªå“¨å…µå°±ä¼šæ‰§è¡Œä¸»å¤‡åˆ‡æ¢æ“ä½œï¼Œæ­¤æ—¶é¦–å…ˆè¦é€‰ä¸¾ä¸€ä¸ª slaveæ¥ï¼Œä¼šè€ƒè™‘ slave çš„ä¸€äº›ä¿¡æ¯ï¼š</li></ol><ul><li><strong>è·Ÿ master æ–­å¼€è¿æ¥çš„æ—¶é•¿</strong></li><li><strong>slave ä¼˜å…ˆçº§</strong></li><li><strong>å¤åˆ¶ offset</strong></li><li><strong>run id</strong></li></ul><ol start="2"><li><p>å¦‚æœä¸€ä¸ª <strong>slave è·Ÿ master æ–­å¼€è¿æ¥çš„æ—¶é—´å·²ç»è¶…è¿‡äº†</strong> <code>down-after-milliseconds</code> çš„ 10 å€ï¼Œå¤–åŠ  master å®•æœºçš„æ—¶é•¿ï¼Œé‚£ä¹ˆ slave å°±è¢«è®¤ä¸ºä¸é€‚åˆé€‰ä¸¾ä¸º masterã€‚</p></li><li><p>æ¥ä¸‹æ¥ä¼šå¯¹ slave è¿›è¡Œæ’åºï¼š</p></li></ol><ul><li>æŒ‰ç…§ slave ä¼˜å…ˆçº§è¿›è¡Œæ’åºï¼Œslave priority è¶Šä½ï¼Œä¼˜å…ˆçº§å°±è¶Šé«˜ã€‚</li><li>å¦‚æœ slave priority ç›¸åŒï¼Œé‚£ä¹ˆçœ‹ replica offsetï¼Œå“ªä¸ª slave å¤åˆ¶äº†è¶Šå¤šçš„æ•°æ®ï¼Œoffset è¶Šé åï¼Œä¼˜å…ˆçº§å°±è¶Šé«˜ã€‚</li><li>å¦‚æœä¸Šé¢ä¸¤ä¸ªæ¡ä»¶éƒ½ç›¸åŒï¼Œé‚£ä¹ˆé€‰æ‹©ä¸€ä¸ª run id æ¯”è¾ƒå°çš„é‚£ä¸ª slaveã€‚</li></ul><h2 id="4ã€é›†ç¾¤åˆ†åŒº"><a href="#4ã€é›†ç¾¤åˆ†åŒº" class="headerlink" title="4ã€é›†ç¾¤åˆ†åŒº"></a>4ã€é›†ç¾¤åˆ†åŒº</h2><h3 id="4-1ã€æ•°æ®åˆ†åŒº"><a href="#4-1ã€æ•°æ®åˆ†åŒº" class="headerlink" title="4.1ã€æ•°æ®åˆ†åŒº"></a>4.1ã€æ•°æ®åˆ†åŒº</h3><p>åˆ†å¸ƒå¼æ•°æ®åº“æŠŠæ•´ä¸ªæ•°æ®æŒ‰åˆ†åŒºè§„åˆ™æ˜ å°„åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œå³æŠŠ<strong>æ•°æ®åˆ’åˆ†åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£æ•´ä½“æ•°æ®çš„ä¸€ä¸ªå­é›†</strong>ã€‚æ¯”å¦‚æˆ‘ä»¬åº“æœ‰600æ¡ç”¨æˆ·æ•°æ®ï¼Œæœ‰3ä¸ªredisèŠ‚ç‚¹ï¼Œå°†600æ¡åˆ†æˆ3ä»½ï¼Œåˆ†åˆ«å­˜å…¥åˆ°3ä¸ªredisèŠ‚ç‚¹ã€‚</p><p><img src="https://s2.51cto.com/images/blog/202109/01/8b3522c958ab999603f5f5a3c6e70fdc.jpeg?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184" alt="ã€é¢è¯•ç³»åˆ—ã€‘Redisé›†ç¾¤å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ_ipåè®®_04"></p><h3 id="4-2ã€åˆ†åŒºè§„åˆ™ï¼š"><a href="#4-2ã€åˆ†åŒºè§„åˆ™ï¼š" class="headerlink" title="4.2ã€åˆ†åŒºè§„åˆ™ï¼š"></a>4.2ã€åˆ†åŒºè§„åˆ™ï¼š</h3><ol><li><p>å¸¸è§çš„åˆ†åŒºè§„åˆ™å“ˆå¸Œåˆ†åŒºå’Œé¡ºåºåˆ†åŒºï¼Œ<strong>redis</strong> <strong>é›†ç¾¤ä½¿ç”¨äº†å“ˆå¸Œåˆ†åŒº</strong>ï¼Œé¡ºåºåˆ†åŒºæš‚ç”¨ä¸åˆ°ï¼Œä¸åšå…·ä½“è¯´æ˜ï¼›</p></li><li><p><strong>å“ˆå¸Œåˆ†åŒºçš„åŸºæœ¬æ€è·¯æ˜¯ï¼šå¯¹æ•°æ®çš„ç‰¹å¾å€¼ï¼ˆå¦‚keyï¼‰è¿›è¡Œå“ˆå¸Œï¼Œç„¶åæ ¹æ®å“ˆå¸Œå€¼å†³å®šæ•°æ®è½åœ¨å“ªä¸ªèŠ‚ç‚¹ã€‚å¸¸è§çš„å“ˆå¸Œåˆ†åŒºåŒ…æ‹¬ï¼šå“ˆå¸Œå–ä½™åˆ†åŒºã€ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºã€å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºç­‰ã€‚</strong></p></li><li><p>è¡¡é‡æ•°æ®åˆ†åŒºæ–¹æ³•å¥½åçš„æ ‡å‡†æœ‰å¾ˆå¤šï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ªå› ç´ æ˜¯**(1)æ•°æ®åˆ†å¸ƒæ˜¯å¦å‡åŒ€(2)å¢åŠ æˆ–åˆ å‡èŠ‚ç‚¹å¯¹æ•°æ®åˆ†å¸ƒçš„å½±å“ã€‚**</p></li><li><p><strong>ç”±äºå“ˆå¸Œçš„éšæœºæ€§ï¼Œå“ˆå¸Œåˆ†åŒºåŸºæœ¬å¯ä»¥ä¿è¯æ•°æ®åˆ†å¸ƒå‡åŒ€ï¼›å› æ­¤åœ¨æ¯”è¾ƒå“ˆå¸Œåˆ†åŒºæ–¹æ¡ˆæ—¶ï¼Œé‡ç‚¹è¦çœ‹å¢å‡èŠ‚ç‚¹å¯¹æ•°æ®åˆ†å¸ƒçš„å½±å“ã€‚</strong></p></li></ol><h4 id="1ï¼‰ã€èŠ‚ç‚¹å–ä½™"><a href="#1ï¼‰ã€èŠ‚ç‚¹å–ä½™" class="headerlink" title="1ï¼‰ã€èŠ‚ç‚¹å–ä½™"></a>1ï¼‰ã€èŠ‚ç‚¹å–ä½™</h4><ul><li>å“ˆå¸Œå–ä½™åˆ†åŒºæ€è·¯éå¸¸ç®€å•ï¼š<strong>è®¡ç®—keyçš„hashå€¼ï¼Œç„¶åå¯¹èŠ‚ç‚¹æ•°é‡è¿›è¡Œå–ä½™ï¼Œä»è€Œå†³å®šæ•°æ®æ˜ å°„åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šã€‚è¯¥æ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œå½“æ–°å¢æˆ–åˆ å‡èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹æ•°é‡å‘ç”Ÿå˜åŒ–ï¼Œç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦é‡æ–°è®¡ç®—æ˜ å°„å…³ç³»ï¼Œå¼•å‘å¤§è§„æ¨¡æ•°æ®è¿ç§»ã€‚</strong></li></ul><h4 id="2ï¼‰ã€ä¸€è‡´æ€§å“ˆå¸Œ"><a href="#2ï¼‰ã€ä¸€è‡´æ€§å“ˆå¸Œ" class="headerlink" title="2ï¼‰ã€ä¸€è‡´æ€§å“ˆå¸Œ"></a>2ï¼‰ã€ä¸€è‡´æ€§å“ˆå¸Œ</h4><ul><li>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´<strong>ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒèŒƒå›´ä¸º0-2^32-1</strong>ï¼›</li><li>å¯¹äºæ¯ä¸ªæ•°æ®ï¼Œ<strong>æ ¹æ®keyè®¡ç®—hashå€¼ï¼Œç¡®å®šæ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œç„¶åä»æ­¤ä½ç½®æ²¿ç¯é¡ºæ—¶é’ˆè¡Œèµ°ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥æ˜ å°„åˆ°çš„æœåŠ¡å™¨ã€‚</strong></li></ul><p><img src="https://s2.51cto.com/images/blog/202109/01/b411bf2a9fa7e9e12fbf63ed42cfb8bf.jpeg?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184" alt="ã€é¢è¯•ç³»åˆ—ã€‘Redisé›†ç¾¤å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ_ä¸€è‡´æ€§å“ˆå¸Œ_05">ä¸€è‡´æ€§å“ˆå¸Œ</p><ul><li><p>ä¸å“ˆå¸Œå–ä½™åˆ†åŒºç›¸æ¯”ï¼Œ<strong>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºå°†å¢å‡èŠ‚ç‚¹çš„å½±å“é™åˆ¶åœ¨ç›¸é‚»èŠ‚ç‚¹</strong>ã€‚ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå¦‚æœåœ¨node1å’Œnode2ä¹‹é—´å¢åŠ node5ï¼Œåˆ™åªæœ‰node2ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®ä¼šè¿ç§»åˆ°node5ï¼›å¦‚æœå»æ‰node2ï¼Œåˆ™åŸnode2ä¸­çš„æ•°æ®åªä¼šè¿ç§»åˆ°node4ä¸­ï¼Œåªæœ‰node4ä¼šå—å½±å“ã€‚</p></li><li><p>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºçš„ä¸»è¦é—®é¢˜åœ¨äºï¼Œ**å½“èŠ‚ç‚¹æ•°é‡è¾ƒå°‘æ—¶ï¼Œå¢åŠ æˆ–åˆ å‡èŠ‚ç‚¹ï¼Œå¯¹å•ä¸ªèŠ‚ç‚¹çš„å½±å“å¯èƒ½å¾ˆå¤§ï¼Œé€ æˆæ•°æ®çš„ä¸¥é‡ä¸å¹³è¡¡ã€‚**è¿˜æ˜¯ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå¦‚æœå»æ‰node2ï¼Œnode4ä¸­çš„æ•°æ®ç”±æ€»æ•°æ®çš„1&#x2F;4å·¦å³å˜ä¸º1&#x2F;2å·¦å³ï¼Œä¸å…¶ä»–èŠ‚ç‚¹ç›¸æ¯”è´Ÿè½½è¿‡é«˜ã€‚</p></li></ul><h4 id="3ï¼‰ã€è™šæ‹Ÿæ§½åˆ†åŒº"><a href="#3ï¼‰ã€è™šæ‹Ÿæ§½åˆ†åŒº" class="headerlink" title="3ï¼‰ã€è™šæ‹Ÿæ§½åˆ†åŒº"></a>3ï¼‰ã€è™šæ‹Ÿæ§½åˆ†åŒº</h4><ul><li><p>è¯¥æ–¹æ¡ˆåœ¨ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºçš„åŸºç¡€ä¸Šï¼Œå¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹çš„æ¦‚å¿µã€‚Redisé›†ç¾¤ä½¿ç”¨çš„ä¾¿æ˜¯è¯¥æ–¹æ¡ˆï¼Œå…¶ä¸­çš„è™šæ‹ŸèŠ‚ç‚¹ç§°ä¸ºæ§½ï¼ˆslotï¼‰ã€‚</p></li><li><p>æ§½æ˜¯ä»‹äºæ•°æ®å’Œå®é™…èŠ‚ç‚¹ä¹‹é—´çš„è™šæ‹Ÿæ¦‚å¿µï¼›æ¯ä¸ªå®é™…èŠ‚ç‚¹åŒ…å«ä¸€å®šæ•°é‡çš„æ§½ï¼Œæ¯ä¸ªæ§½åŒ…å«å“ˆå¸Œå€¼åœ¨ä¸€å®šèŒƒå›´å†…çš„æ•°æ®ã€‚<strong>å¼•å…¥æ§½ä»¥åï¼Œæ•°æ®çš„æ˜ å°„å…³ç³»ç”±æ•°æ®hash-&gt;å®é™…èŠ‚ç‚¹ï¼Œå˜æˆäº†æ•°æ®hash-&gt;æ§½-&gt;å®é™…èŠ‚ç‚¹ã€‚</strong></p></li><li><p>åœ¨ä½¿ç”¨äº†æ§½çš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºä¸­ï¼Œ<strong>æ§½æ˜¯æ•°æ®ç®¡ç†å’Œè¿ç§»çš„åŸºæœ¬å•ä½ã€‚æ§½è§£è€¦äº†æ•°æ®å’Œå®é™…èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œå¢åŠ æˆ–åˆ é™¤èŠ‚ç‚¹å¯¹ç³»ç»Ÿçš„å½±å“å¾ˆå°</strong>ã€‚</p></li><li><p>ä»ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œç³»ç»Ÿä¸­æœ‰4ä¸ªå®é™…èŠ‚ç‚¹ï¼Œå‡è®¾ä¸ºå…¶åˆ†é…16ä¸ªæ§½(0-15)ï¼›æ§½0-3ä½äºnode1ï¼Œ4-7ä½äºnode2ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœæ­¤æ—¶åˆ é™¤node2ï¼Œåªéœ€è¦å°†æ§½4-7é‡æ–°åˆ†é…å³å¯ï¼Œä¾‹å¦‚æ§½4-5åˆ†é…ç»™node1ï¼Œæ§½6åˆ†é…ç»™node3ï¼Œæ§½7åˆ†é…ç»™node4ï¼›å¯ä»¥çœ‹å‡ºåˆ é™¤node2åï¼Œæ•°æ®åœ¨å…¶ä»–èŠ‚ç‚¹çš„åˆ†å¸ƒä»ç„¶è¾ƒä¸ºå‡è¡¡ã€‚</p></li><li><p>æ§½çš„æ•°é‡ä¸€èˆ¬è¿œå°äº2^32ï¼Œè¿œå¤§äºå®é™…èŠ‚ç‚¹çš„æ•°é‡ï¼›åœ¨<strong>Redisé›†ç¾¤ä¸­ï¼Œæ§½çš„æ•°é‡ä¸º16384ï¼Œ</strong></p></li><li><p><strong>æ‰€æœ‰çš„é”®æ ¹æ®å“ˆå¸Œå‡½æ•°<code>Hash()=(CRC16[key]&amp;16383)</code>æ˜ å°„åˆ°0ï¼16383æ§½å†…ï¼Œå…±16384ä¸ªæ§½ä½ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤éƒ¨åˆ†æ§½åŠæ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ®</strong></p></li></ul><p>ä¸‹é¢è¿™å¼ å›¾å¾ˆå¥½çš„æ€»ç»“äº†Redisé›†ç¾¤å°†æ•°æ®æ˜ å°„åˆ°å®é™…èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼š</p><p><img src="https://s2.51cto.com/images/blog/202109/01/e78ab259c387751e6b82b6eeae6fec12.jpeg?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184" alt="ã€é¢è¯•ç³»åˆ—ã€‘Redisé›†ç¾¤å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ_å®¢æˆ·ç«¯_06">æ•°æ®æ˜ å°„åˆ°å®é™…èŠ‚ç‚¹</p><p>ï¼ˆ1ï¼‰Rediså¯¹æ•°æ®çš„ç‰¹å¾å€¼ï¼ˆä¸€èˆ¬æ˜¯keyï¼‰è®¡ç®—å“ˆå¸Œå€¼ï¼Œä½¿ç”¨<strong>CRC16</strong>ç®—æ³•</p><p>ï¼ˆ2ï¼‰<strong>æ ¹æ®å“ˆå¸Œå€¼ï¼Œè®¡ç®—æ•°æ®å±äºå“ªä¸ªæ§½ã€‚</strong></p><p><strong>ï¼ˆ3ï¼‰æ ¹æ®æ§½ä¸èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ï¼Œè®¡ç®—æ•°æ®å±äºå“ªä¸ªèŠ‚ç‚¹ã€‚</strong></p><blockquote><p>â€œ</p><p><strong>redisç”¨è™šæ‹Ÿæ§½åˆ†åŒºå¥½å¤„ï¼šè§£è€¦æ•°æ®ä¸èŠ‚ç‚¹å…³ç³»ï¼ŒèŠ‚ç‚¹è‡ªèº«ç»´æŠ¤æ§½æ˜ å°„å…³ç³»ï¼Œåˆ†å¸ƒå¼å­˜å‚¨</strong></p></blockquote><h2 id="5ã€èŠ‚ç‚¹é€šä¿¡æœºåˆ¶"><a href="#5ã€èŠ‚ç‚¹é€šä¿¡æœºåˆ¶" class="headerlink" title="5ã€èŠ‚ç‚¹é€šä¿¡æœºåˆ¶"></a>5ã€èŠ‚ç‚¹é€šä¿¡æœºåˆ¶</h2><p>é›†ç¾¤è¦ä½œä¸ºä¸€ä¸ªæ•´ä½“å·¥ä½œï¼Œç¦»ä¸å¼€èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡</p><h3 id="5-1ã€ä¸¤ä¸ªç«¯å£"><a href="#5-1ã€ä¸¤ä¸ªç«¯å£" class="headerlink" title="5.1ã€ä¸¤ä¸ªç«¯å£"></a>5.1ã€ä¸¤ä¸ªç«¯å£</h3><p>åœ¨å“¨å…µç³»ç»Ÿä¸­ï¼ŒèŠ‚ç‚¹åˆ†ä¸ºæ•°æ®èŠ‚ç‚¹å’Œå“¨å…µèŠ‚ç‚¹ï¼šå‰è€…å­˜å‚¨æ•°æ®ï¼Œåè€…å®ç°é¢å¤–çš„æ§åˆ¶åŠŸèƒ½ã€‚åœ¨é›†ç¾¤ä¸­ï¼Œæ²¡æœ‰æ•°æ®èŠ‚ç‚¹ä¸éæ•°æ®èŠ‚ç‚¹ä¹‹åˆ†ï¼šæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å­˜å‚¨æ•°æ®ï¼Œä¹Ÿéƒ½å‚ä¸é›†ç¾¤çŠ¶æ€çš„ç»´æŠ¤ã€‚ä¸ºæ­¤ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œéƒ½æä¾›äº†ä¸¤ä¸ªTCPç«¯å£ï¼š</p><ul><li><p>æ™®é€šç«¯å£ï¼šå³æˆ‘ä»¬åœ¨å‰é¢æŒ‡å®šçš„ç«¯å£(7000ç­‰)ã€‚æ™®é€šç«¯å£ä¸»è¦ç”¨äºä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼ˆä¸å•æœºèŠ‚ç‚¹ç±»ä¼¼ï¼‰ï¼›ä½†åœ¨èŠ‚ç‚¹é—´æ•°æ®è¿ç§»æ—¶ä¹Ÿä¼šä½¿ç”¨ã€‚</p></li><li><p>é›†ç¾¤ç«¯å£ï¼šç«¯å£å·æ˜¯æ™®é€šç«¯å£+10000ï¼ˆ10000æ˜¯å›ºå®šå€¼ï¼Œæ— æ³•æ”¹å˜ï¼‰ï¼Œå¦‚7000èŠ‚ç‚¹çš„é›†ç¾¤ç«¯å£ä¸º17000ã€‚é›†ç¾¤ç«¯å£åªç”¨äºèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ï¼Œå¦‚æ­å»ºé›†ç¾¤ã€å¢å‡èŠ‚ç‚¹ã€æ•…éšœè½¬ç§»ç­‰æ“ä½œæ—¶èŠ‚ç‚¹é—´çš„é€šä¿¡ï¼›ä¸è¦ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥é›†ç¾¤æ¥å£ã€‚ä¸ºäº†ä¿è¯é›†ç¾¤å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œåœ¨é…ç½®é˜²ç«å¢™æ—¶ï¼Œè¦åŒæ—¶å¼€å¯æ™®é€šç«¯å£å’Œé›†ç¾¤ç«¯å£ã€‚</p></li></ul><h3 id="5-2ã€Gossipåè®®"><a href="#5-2ã€Gossipåè®®" class="headerlink" title="5.2ã€Gossipåè®®"></a>5.2ã€Gossipåè®®</h3><p>èŠ‚ç‚¹é—´é€šä¿¡ï¼ŒæŒ‰ç…§é€šä¿¡åè®®å¯ä»¥åˆ†ä¸ºå‡ ç§ç±»å‹ï¼šå•å¯¹å•ã€å¹¿æ’­ã€Gossipåè®®ç­‰ã€‚é‡ç‚¹æ˜¯å¹¿æ’­å’ŒGossipçš„å¯¹æ¯”ã€‚</p><ul><li><p>å¹¿æ’­æ˜¯æŒ‡å‘é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹å‘é€æ¶ˆæ¯ï¼›ä¼˜ç‚¹æ˜¯é›†ç¾¤çš„æ”¶æ•›é€Ÿåº¦å¿«(é›†ç¾¤æ”¶æ•›æ˜¯æŒ‡é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹è·å¾—çš„é›†ç¾¤ä¿¡æ¯æ˜¯ä¸€è‡´çš„)ï¼Œç¼ºç‚¹æ˜¯æ¯æ¡æ¶ˆæ¯éƒ½è¦å‘é€ç»™æ‰€æœ‰èŠ‚ç‚¹ï¼ŒCPUã€å¸¦å®½ç­‰æ¶ˆè€—è¾ƒå¤§ã€‚</p></li><li><p>**Gossipåè®®çš„ç‰¹ç‚¹æ˜¯ï¼šåœ¨èŠ‚ç‚¹æ•°é‡æœ‰é™çš„ç½‘ç»œä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½â€œéšæœºâ€çš„ä¸éƒ¨åˆ†èŠ‚ç‚¹é€šä¿¡ï¼ˆå¹¶ä¸æ˜¯çœŸæ­£çš„éšæœºï¼Œè€Œæ˜¯æ ¹æ®ç‰¹å®šçš„è§„åˆ™é€‰æ‹©é€šä¿¡çš„èŠ‚ç‚¹ï¼‰ï¼Œç»è¿‡ä¸€ç•ªæ‚ä¹±æ— ç« çš„é€šä¿¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€å¾ˆå¿«ä¼šè¾¾åˆ°ä¸€è‡´ã€‚**Gossipåè®®çš„ä¼˜ç‚¹æœ‰è´Ÿè½½(æ¯”å¹¿æ’­)ä½ã€å»ä¸­å¿ƒåŒ–ã€å®¹é”™æ€§é«˜(å› ä¸ºé€šä¿¡æœ‰å†—ä½™)ç­‰ï¼›ç¼ºç‚¹ä¸»è¦æ˜¯é›†ç¾¤çš„æ”¶æ•›é€Ÿåº¦æ…¢ã€‚</p></li></ul><h3 id="5-3ã€æ¶ˆæ¯ç±»å‹"><a href="#5-3ã€æ¶ˆæ¯ç±»å‹" class="headerlink" title="5.3ã€æ¶ˆæ¯ç±»å‹"></a>5.3ã€æ¶ˆæ¯ç±»å‹</h3><ol><li><p>é›†ç¾¤ä¸­çš„èŠ‚ç‚¹é‡‡ç”¨å›ºå®šé¢‘ç‡ï¼ˆæ¯ç§’10æ¬¡ï¼‰çš„å®šæ—¶ä»»åŠ¡è¿›è¡Œé€šä¿¡ç›¸å…³çš„å·¥ä½œï¼šåˆ¤æ–­æ˜¯å¦éœ€è¦å‘é€æ¶ˆæ¯åŠæ¶ˆæ¯ç±»å‹ã€ç¡®å®šæ¥æ”¶èŠ‚ç‚¹ã€å‘é€æ¶ˆæ¯ç­‰ã€‚å¦‚æœé›†ç¾¤çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚å¢å‡èŠ‚ç‚¹ã€æ§½çŠ¶æ€å˜æ›´ï¼Œé€šè¿‡èŠ‚ç‚¹é—´çš„é€šä¿¡ï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¼šå¾ˆå¿«å¾—çŸ¥æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼Œä½¿é›†ç¾¤æ”¶æ•›ã€‚</p></li><li><p>èŠ‚ç‚¹é—´å‘é€çš„æ¶ˆæ¯ä¸»è¦åˆ†ä¸º5ç§ï¼šmeetæ¶ˆæ¯ã€pingæ¶ˆæ¯ã€pongæ¶ˆæ¯ã€failæ¶ˆæ¯ã€publishæ¶ˆæ¯ã€‚ä¸åŒçš„æ¶ˆæ¯ç±»å‹ï¼Œé€šä¿¡åè®®ã€å‘é€çš„é¢‘ç‡å’Œæ—¶æœºã€æ¥æ”¶èŠ‚ç‚¹çš„é€‰æ‹©ç­‰æ˜¯ä¸åŒçš„ã€‚</p></li></ol><ul><li><p><strong>MEETæ¶ˆæ¯</strong>ï¼šåœ¨èŠ‚ç‚¹æ¡æ‰‹é˜¶æ®µï¼Œå½“èŠ‚ç‚¹æ”¶åˆ°å®¢æˆ·ç«¯çš„CLUSTER MEETå‘½ä»¤æ—¶ï¼Œä¼šå‘æ–°åŠ å…¥çš„èŠ‚ç‚¹å‘é€MEETæ¶ˆæ¯ï¼Œè¯·æ±‚æ–°èŠ‚ç‚¹åŠ å…¥åˆ°å½“å‰é›†ç¾¤ï¼›æ–°èŠ‚ç‚¹æ”¶åˆ°MEETæ¶ˆæ¯åä¼šå›å¤ä¸€ä¸ªPONGæ¶ˆæ¯ã€‚</p></li><li><p><strong>PINGæ¶ˆæ¯</strong>ï¼šé›†ç¾¤é‡Œæ¯ä¸ªèŠ‚ç‚¹æ¯ç§’é’Ÿä¼šé€‰æ‹©éƒ¨åˆ†èŠ‚ç‚¹å‘é€PINGæ¶ˆæ¯ï¼Œæ¥æ”¶è€…æ”¶åˆ°æ¶ˆæ¯åä¼šå›å¤ä¸€ä¸ªPONGæ¶ˆæ¯ã€‚PINGæ¶ˆæ¯çš„å†…å®¹æ˜¯è‡ªèº«èŠ‚ç‚¹å’Œéƒ¨åˆ†å…¶ä»–èŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ï¼›ä½œç”¨æ˜¯å½¼æ­¤äº¤æ¢ä¿¡æ¯ï¼Œä»¥åŠæ£€æµ‹èŠ‚ç‚¹æ˜¯å¦åœ¨çº¿ã€‚** **PINGæ¶ˆæ¯ä½¿ç”¨Gossipåè®®å‘é€ï¼Œ**æ¥æ”¶èŠ‚ç‚¹çš„é€‰æ‹©å…¼é¡¾äº†æ”¶æ•›é€Ÿåº¦å’Œå¸¦å®½æˆæœ¬ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š(1)éšæœºæ‰¾5ä¸ªèŠ‚ç‚¹ï¼Œåœ¨å…¶ä¸­é€‰æ‹©æœ€ä¹…æ²¡æœ‰é€šä¿¡çš„1ä¸ªèŠ‚ç‚¹(2)æ‰«æèŠ‚ç‚¹åˆ—è¡¨ï¼Œé€‰æ‹©æœ€è¿‘ä¸€æ¬¡æ”¶åˆ°PONGæ¶ˆæ¯æ—¶é—´å¤§äºcluster_node_timeout&#x2F;2çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œé˜²æ­¢è¿™äº›èŠ‚ç‚¹é•¿æ—¶é—´æœªæ›´æ–°ã€‚</p></li><li><p><strong>PONGæ¶ˆæ¯</strong>ï¼šPONGæ¶ˆæ¯å°è£…äº†è‡ªèº«çŠ¶æ€æ•°æ®ã€‚å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šç¬¬ä¸€ç§æ˜¯åœ¨æ¥åˆ°MEET&#x2F;PINGæ¶ˆæ¯åå›å¤çš„PONGæ¶ˆæ¯ï¼›ç¬¬äºŒç§æ˜¯æŒ‡èŠ‚ç‚¹å‘é›†ç¾¤å¹¿æ’­PONGæ¶ˆæ¯ï¼Œè¿™æ ·å…¶ä»–èŠ‚ç‚¹å¯ä»¥è·çŸ¥è¯¥èŠ‚ç‚¹çš„æœ€æ–°ä¿¡æ¯ï¼Œä¾‹å¦‚æ•…éšœæ¢å¤åæ–°çš„ä¸»èŠ‚ç‚¹ä¼šå¹¿æ’­PONGæ¶ˆæ¯ã€‚</p></li><li><p><strong>FAILæ¶ˆæ¯</strong>ï¼šå½“ä¸€ä¸ªä¸»èŠ‚ç‚¹åˆ¤æ–­å¦ä¸€ä¸ªä¸»èŠ‚ç‚¹è¿›å…¥FAILçŠ¶æ€æ—¶ï¼Œä¼šå‘é›†ç¾¤å¹¿æ’­è¿™ä¸€FAILæ¶ˆæ¯ï¼›æ¥æ”¶èŠ‚ç‚¹ä¼šå°†è¿™ä¸€FAILæ¶ˆæ¯ä¿å­˜èµ·æ¥ï¼Œä¾¿äºåç»­çš„åˆ¤æ–­ã€‚</p></li><li><p><strong>PUBLISHæ¶ˆæ¯</strong>ï¼šèŠ‚ç‚¹æ”¶åˆ°PUBLISHå‘½ä»¤åï¼Œä¼šå…ˆæ‰§è¡Œè¯¥å‘½ä»¤ï¼Œç„¶åå‘é›†ç¾¤å¹¿æ’­è¿™ä¸€æ¶ˆæ¯ï¼Œæ¥æ”¶èŠ‚ç‚¹ä¹Ÿä¼šæ‰§è¡Œè¯¥PUBLISHå‘½ä»¤ã€‚</p></li></ul><h2 id="6ã€å…¶ä»–"><a href="#6ã€å…¶ä»–" class="headerlink" title="6ã€å…¶ä»–"></a>6ã€å…¶ä»–</h2><h3 id="6-1ã€æ¶æ„ç»†èŠ‚"><a href="#6-1ã€æ¶æ„ç»†èŠ‚" class="headerlink" title="6.1ã€æ¶æ„ç»†èŠ‚"></a>6.1ã€æ¶æ„ç»†èŠ‚</h3><ol><li>æ‰€æœ‰çš„ redis èŠ‚ç‚¹å½¼æ­¤äº’è” (PING-PONG æœºåˆ¶)ï¼Œ<strong>å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚</strong></li><li>èŠ‚ç‚¹çš„ fail æ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæˆ–è€…æŸä¸ªèŠ‚ç‚¹ä¸»ä»å…¨æŒ‚æ—¶æ‰ç”Ÿæ•ˆã€‚</li><li><strong>å®¢æˆ·ç«¯ä¸ redis èŠ‚ç‚¹ç›´è¿</strong>ï¼Œä¸éœ€è¦ä¸­é—´ proxy å±‚ã€‚<strong>å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚</strong></li><li>redis-cluster æŠŠ<strong>æ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ° [0-16383]slot</strong> ä¸Šã€‚</li></ol><h3 id="6-2ã€é›†ç¾¤å®¹é”™"><a href="#6-2ã€é›†ç¾¤å®¹é”™" class="headerlink" title="6.2ã€é›†ç¾¤å®¹é”™"></a>6.2ã€é›†ç¾¤å®¹é”™</h3><ol><li>ä¸ºäº†å½“éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œcluster ä»èƒ½ä¿æŒå¯ç”¨ï¼Œ<strong>Redis é›†ç¾¤é‡‡ç”¨æ¯ä¸ªèŠ‚ç‚¹æ‹¥æœ‰ 1ï¼ˆä¸»æœåŠ¡è‡ªèº«ï¼‰åˆ° N ä¸ªå‰¯æœ¬çš„ä¸»ä»æ¨¡å‹ã€‚ç±»ä¼¼äº master&#x2F;slaveã€‚</strong></li><li>ä½†æ˜¯ <strong>redis cluster å´ä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œå› ä¸º cluster å†…éƒ¨ master å’Œ slave ä¹‹é—´æ˜¯é€šè¿‡å¼‚æ­¥å¤åˆ¶åšæ•°æ®åŒæ­¥çš„</strong>ï¼Œå¤åˆ¶è¿‡ç¨‹ä¸­å¯èƒ½ master æŒ‚äº†ï¼Œè¿™å°±å¯¼è‡´éƒ¨åˆ†æ•°æ®æ²¡æœ‰å®Œå…¨åŒæ­¥è‡³ slave ä¸Šï¼Œä¸è¿‡è¿™ç§å¯èƒ½æ€§è¿˜æ˜¯å¾ˆå°çš„ã€‚</li><li>é›†ç¾¤é€‰ä¸¾è¿‡ç¨‹æ˜¯é›†ç¾¤ä¸­æ‰€æœ‰ master å‚ä¸ï¼Œ<strong>å¦‚æœåŠæ•°ä»¥ä¸Š master èŠ‚ç‚¹ä¸å½“å‰ master èŠ‚ç‚¹é€šä¿¡è¶…æ—¶ï¼Œåˆ™é›†ç¾¤è®¤ä¸ºå½“å‰ master èŠ‚ç‚¹æŒ‚æ‰</strong></li><li>å½“é›†ç¾¤ä¸å¯ç”¨æ—¶, æ‰€æœ‰å¯¹é›†ç¾¤çš„æ“ä½œåšéƒ½å°†å¤±è´¥ã€‚ä»¥ä¸‹æ˜¯ä¼šå¯¼è‡´é›†ç¾¤ä¸å¯ç”¨çš„å…¶ä¸­ä¸¤ç§æƒ…å†µï¼š<ol><li><strong>é›†ç¾¤ä»»æ„ master æŒ‚æ‰ï¼Œå¹¶ä¸”å½“å‰ master æ²¡æœ‰ slaveï¼Œé›†ç¾¤ä¸å¯ç”¨</strong></li><li><strong>é›†ç¾¤è¶…è¿‡åŠæ•°ä»¥ä¸Š master æŒ‚æ‰ï¼Œæ— è®ºæ˜¯å¦æœ‰ slaveï¼Œé›†ç¾¤ä¸å¯ç”¨</strong></li></ol></li></ol><h3 id="6-3ã€é›†ç¾¤æ‰©å±•"><a href="#6-3ã€é›†ç¾¤æ‰©å±•" class="headerlink" title="6.3ã€é›†ç¾¤æ‰©å±•"></a>6.3ã€é›†ç¾¤æ‰©å±•</h3><blockquote><p>â€œ</p><p><strong>ä»¥å¾€çš„ä¸€è‡´æ€§å“ˆå¸Œæ–¹æ¡ˆï¼Œå¦‚æœæˆ‘ä»¬ç§»é™¤æˆ–è€…æ–°å¢èŠ‚ç‚¹æ—¶ï¼Œè™½ç„¶è¯´ä¸ä¼šå¯¼è‡´å…¨å±€ key çš„ rehashï¼Œä½†æ˜¯ä¹Ÿä¼šå½±å“åˆ°éƒ¨åˆ† key çš„å¤±æ•ˆ</strong>ã€‚Redis Cluster åœ¨å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§ä¸Šæ¯”è¾ƒé‡è§†ï¼Œ<strong>å¦‚æœé›†ç¾¤æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåœ¨ç»™è¯¥èŠ‚ç‚¹åˆ†é…æ§½æ—¶ï¼Œè¿™äº›æ§½æ‰€å±çš„æºèŠ‚ç‚¹å’Œè¯¥èŠ‚ç‚¹ä¼šè¿›è¡Œä¸€æ¬¡ key çš„è¿ç§»ï¼Œå¹¶ä¸”è¿ç§»è¿‡ç¨‹ä¸­ä¸é˜»å¡é›†ç¾¤æœåŠ¡ã€‚å¦‚æœç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒåŒç†ï¼Œæˆ‘ä»¬éœ€è¦å°†å¾…ç§»é™¤çš„èŠ‚ç‚¹çš„ key è¿ç§»åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚</strong></p></blockquote><p>é‚£é›†ç¾¤æ˜¯å¦‚ä½•åšåˆ° key è¿ç§»ä¸é˜»å¡é›†ç¾¤æœåŠ¡çš„å‘¢ï¼Ÿ</p><p>key è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠåˆ° CLUSTER SETSLOT slot8 <strong>MIGRATING node å‘½ä»¤</strong>å’Œ CLUSTER SETSLOT slot8 <strong>IMPORTING node å‘½ä»¤</strong>ï¼Œå‰è€…ç”¨äºå°†ç»™å®šèŠ‚ç‚¹ node ä¸­çš„æ§½ slot8 è¿ç§»å‡ºèŠ‚ç‚¹ï¼Œè€Œåè€…ç”¨äºå°†ç»™å®šæ§½ slot8 å¯¼å…¥åˆ°èŠ‚ç‚¹ node ï¼š</p><ol><li><p><strong>å¦‚æœä¸€ä¸ªæ§½è¢«è®¾ç½®ä¸º MIGRATING çŠ¶æ€æ—¶ï¼ŒåŸæœ¬æŒæœ‰è¯¥æ§½çš„èŠ‚ç‚¹ä¼šç»§ç»­æ¥å—å…³äºè¿™ä¸ªæ§½çš„å‘½ä»¤è¯·æ±‚ï¼Œä½†åªæœ‰å½“é”®å­˜åœ¨äºè¯¥èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹æ‰ä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚å¦‚æœå‘½ä»¤æ‰€ä½¿ç”¨çš„é”®ä¸å­˜åœ¨äºè¯¥èŠ‚ç‚¹ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å°†å‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ª ASK è½¬å‘ï¼ˆredirectionï¼‰é”™è¯¯ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯ï¼Œè¦å°†å‘½ä»¤è¯·æ±‚å‘é€åˆ°æ§½çš„è¿ç§»ç›®æ ‡èŠ‚ç‚¹</strong>ã€‚</p></li><li><p><strong>å¦‚æœä¸€ä¸ªæ§½è¢«è®¾ç½®ä¸º IMPORTING çŠ¶æ€æ—¶ï¼ŒèŠ‚ç‚¹ä»…åœ¨æ¥æ”¶åˆ° ASKING å‘½ä»¤ä¹‹åï¼Œæ‰ä¼šæ¥å—å…³äºè¿™ä¸ªæ§½çš„å‘½ä»¤è¯·æ±‚ã€‚å¦‚æœå®¢æˆ·ç«¯å‘èŠ‚ç‚¹å‘é€è¯¥æ§½çš„æ•°æ®è¯·æ±‚ï¼Œå‘½ä»¤ä¸ºé ASKING æ—¶ï¼Œé‚£ä¹ˆèŠ‚ç‚¹ä¼šä½¿ç”¨ MOVED è½¬å‘é”™è¯¯å°†å‘½ä»¤è¯·æ±‚è½¬å‘è‡³çœŸæ­£è´Ÿè´£å¤„ç†è¿™ä¸ªæ§½çš„èŠ‚ç‚¹ã€‚</strong></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CommandLineRunnerå’ŒApplicationRunner</title>
    <link href="/article/5d49a0d1.html"/>
    <url>/article/5d49a0d1.html</url>
    
    <content type="html"><![CDATA[<h4 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h4><!-- toc --><p>åœ¨Spring Bootåº”ç”¨ç¨‹åºä¸­ï¼ŒCommandLineRunnerå’ŒApplicationRunneræ˜¯ä¸¤ä¸ªé‡è¦çš„æ¥å£ï¼Œå®ƒä»¬å…è®¸æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨åæ‰§è¡Œä¸€äº›åˆå§‹åŒ–ä»»åŠ¡ã€‚æœ¬æ–‡å°†ä»‹ç»CommandLineRunnerå’ŒApplicationRunnerçš„åŒºåˆ«ï¼Œå¹¶æä¾›ä»£ç ç¤ºä¾‹å’Œä½¿ç”¨åœºæ™¯ï¼Œè®©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨è¿™ä¸¤ä¸ªæ¥å£ã€‚  </p><h3 id="CommandLineRunnerå’ŒApplicationRunnerçš„ç”¨æ³•"><a href="#CommandLineRunnerå’ŒApplicationRunnerçš„ç”¨æ³•" class="headerlink" title="CommandLineRunnerå’ŒApplicationRunnerçš„ç”¨æ³•"></a>CommandLineRunnerå’ŒApplicationRunnerçš„ç”¨æ³•</h3><ol><li>CommandLineRunneræ¥å£:<ul><li>æ–¹æ³•ç­¾å: <code>void run(String... args)</code></li><li>å‚æ•°ç±»å‹: å­—ç¬¦ä¸²æ•°ç»„ï¼Œè¡¨ç¤ºåº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ä¼ é€’çš„å‘½ä»¤è¡Œå‚æ•°</li><li>æ‰§è¡Œæ—¶æœº: åœ¨Springä¸Šä¸‹æ–‡å‡†å¤‡å¥½ä¹‹åï¼Œä½†åœ¨è°ƒç”¨ApplicationRunnerä¹‹å‰æ‰§è¡Œã€‚</li></ul></li><li>ApplicationRunneræ¥å£:<ul><li>æ–¹æ³•ç­¾å: <code>void run(ApplicationArguments args)</code></li><li>å‚æ•°ç±»å‹: ApplicationArgumentså¯¹è±¡ï¼Œæä¾›å¯¹åº”ç”¨ç¨‹åºå¯åŠ¨å‚æ•°çš„æ›´é«˜çº§åˆ«è®¿é—®</li><li>æ‰§è¡Œæ—¶æœº: åœ¨CommandLineRunnerä¹‹åæ‰§è¡Œã€‚</li></ul></li></ol><p>è¿™ä¸¤ä¸ªæ¥å£çš„ç›®çš„æ˜¯å…è®¸å¼€å‘äººå‘˜åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨å®Œæˆåæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰çš„ä»»åŠ¡ï¼Œä¾‹å¦‚åŠ è½½<a href="https://so.csdn.net/so/search?q=%E5%88%9D%E5%A7%8B%E5%8C%96&spm=1001.2101.3001.7020">åˆå§‹åŒ–</a>æ•°æ®ã€æ‰§è¡Œæ•°æ®è¿ç§»ã€å¯åŠ¨åå°ä»»åŠ¡ç­‰ï¼Œå®ƒä»¬éƒ½å®ç°äº†<code>org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean</code>æ³¨è§£ï¼Œè¿™æ„å‘³ç€åªæœ‰åœ¨æ²¡æœ‰å…¶ä»–ç±»å‹çš„<a href="https://so.csdn.net/so/search?q=Bean%E5%AE%9A%E4%B9%89&spm=1001.2101.3001.7020">Beanå®šä¹‰</a>çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šè‡ªåŠ¨é…ç½®å®ƒä»¬ã€‚</p><p><strong>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä½¿ç”¨<code>CommandLineRunner</code>å’Œ<code>ApplicationRunner</code>ï¼š</strong></p><ol><li><p>é€šè¿‡å®ç°æ¥å£å¹¶å°†å…¶ä½œä¸ºSpring Beanæ³¨å†Œï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªç±»å¹¶å®ç°<code>CommandLineRunner</code>æˆ–<code>ApplicationRunner</code>æ¥å£</li><li>å®ç°æ¥å£çš„<code>run</code>æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ç¼–å†™æ‚¨çš„è‡ªå®šä¹‰é€»è¾‘</li><li>å°†å®ç°ç±»æ ‡è®°ä¸º<code>@Component</code>æˆ–ä½¿ç”¨å…¶ä»–é€‚å½“çš„æ³¨è§£è¿›è¡Œæ³¨è§£ï¼Œä»¥ä¾¿ä½¿å…¶æˆä¸ºSpring Bean</li></ul><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">import</span> org.springframework.boot.ApplicationArguments;<br><span class="hljs-keyword">import</span> org.springframework.boot.ApplicationRunner;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplicationRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationRunner</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(ApplicationArguments args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// åœ¨è¿™é‡Œç¼–å†™æ‚¨çš„è‡ªå®šä¹‰é€»è¾‘</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡ä½¿ç”¨<code>SpringApplication</code>çš„<code>run</code>æ–¹æ³•å‚æ•°è¿›è¡Œæ³¨å†Œï¼š</p><ul><li>åœ¨<code>SpringApplication.run</code>æ–¹æ³•ä¸­ï¼Œå°†å®ç°äº†<code>CommandLineRunner</code>æˆ–<code>ApplicationRunner</code>æ¥å£çš„å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>run</code>æ–¹æ³•ã€‚</li></ul><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.CommandLineRunner;<br><span class="hljs-keyword">import</span> org.springframework.boot.ApplicationRunner;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">YourApplication</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CommandLineRunner</span>, <span class="hljs-title">ApplicationRunner</span> </span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(YourApplication.class, args);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// åœ¨è¿™é‡Œç¼–å†™æ‚¨çš„è‡ªå®šä¹‰é€»è¾‘</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(ApplicationArguments args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// åœ¨è¿™é‡Œç¼–å†™æ‚¨çš„è‡ªå®šä¹‰é€»è¾‘</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p>æ— è®ºæˆ‘ä»¬é€‰æ‹©å“ªç§æ–¹å¼ï¼Œä¸€æ—¦åº”ç”¨ç¨‹åºå¯åŠ¨å®Œæˆï¼Œ<code>run</code>æ–¹æ³•å°†è¢«è°ƒç”¨ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­ç¼–å†™æˆ‘ä»¬çš„è‡ªå®šä¹‰é€»è¾‘ã€‚å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚é€‰æ‹©ä½¿ç”¨<code>CommandLineRunner</code>æˆ–<code>ApplicationRunner</code>æ¥å£ã€‚</p><h3 id="CommandLineRunnerå’ŒApplicationRunnerçš„åŒºåˆ«"><a href="#CommandLineRunnerå’ŒApplicationRunnerçš„åŒºåˆ«" class="headerlink" title="CommandLineRunnerå’ŒApplicationRunnerçš„åŒºåˆ«"></a>CommandLineRunnerå’ŒApplicationRunnerçš„åŒºåˆ«</h3><h4 id="å‚æ•°ä¸åŒ"><a href="#å‚æ•°ä¸åŒ" class="headerlink" title="å‚æ•°ä¸åŒ"></a>å‚æ•°ä¸åŒ</h4><p>ä»ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°CommandLineRunnerå’ŒApplicationRunnerçš„ä¸€ä¸ªä¸»è¦çš„ä¸åŒå°±æ˜¯å®ƒä»¬çš„runæ–¹æ³•çš„å‚æ•°ç±»å‹ä¸åŒã€‚CommandLineRunnerçš„runæ–¹æ³•æ¥æ”¶ä¸€ä¸ªStringæ•°ç»„ï¼Œå®ƒæ˜¯ç›´æ¥ä»å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ï¼Œæ¯”å¦‚<code>java -jar myapp.jar arg1 arg2</code>ï¼Œé‚£ä¹ˆarg1å’Œarg2å°±ä¼šè¢«ä¼ å…¥åˆ°runæ–¹æ³•ä¸­ã€‚è€ŒApplicationRunnerçš„runæ–¹æ³•æ¥æ”¶ä¸€ä¸ªApplicationArgumentså¯¹è±¡ï¼Œå®ƒä¸ä»…åŒ…å«äº†å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ï¼Œè¿˜åŒ…å«äº†å…¶ä»–çš„åº”ç”¨ç¨‹åºå‚æ•°ï¼Œæ¯”å¦‚<code>--spring.profiles.active=dev</code>ï¼Œè¿™äº›å‚æ•°å¯ä»¥é€šè¿‡ApplicationArgumentsçš„æ–¹æ³•æ¥è·å–ï¼Œæ¯”å¦‚<code>args.getOptionNames()</code>ï¼Œ<code>args.getNonOptionArgs()</code>ç­‰ã€‚</p><h4 id="æ‰§è¡Œé¡ºåºä¸åŒ"><a href="#æ‰§è¡Œé¡ºåºä¸åŒ" class="headerlink" title="æ‰§è¡Œé¡ºåºä¸åŒ"></a>æ‰§è¡Œé¡ºåºä¸åŒ</h4><p>å¦å¤–ä¸€ä¸ªä¸åŒå°±æ˜¯CommandLineRunnerå’ŒApplicationRunnerçš„æ‰§è¡Œé¡ºåºä¸åŒã€‚å¦‚æœæˆ‘ä»¬åœ¨åŒä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­åŒæ—¶å®šä¹‰äº†å¤šä¸ªCommandLineRunnerå’ŒApplicationRunnerï¼Œé‚£ä¹ˆå®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯æ€æ ·çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œé¦–å…ˆæ‰§è¡Œæ‰€æœ‰çš„CommandLineRunnerï¼Œç„¶åæ‰§è¡Œæ‰€æœ‰çš„ApplicationRunnerï¼Œè€Œä¸”å®ƒä»¬éƒ½æ˜¯æŒ‰ç…§ä¼˜å…ˆçº§çš„é¡ºåºæ‰§è¡Œçš„ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡@Orderæ³¨è§£æ¥æŒ‡å®šå®ƒä»¬çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">// ä¼˜å…ˆçº§ä¸º1çš„CommandLineRunner</span><br><span class="hljs-variable">@Component</span><br><span class="hljs-variable">@Order</span>(<span class="hljs-number">1</span>)<br>public class FirstCommandLineRunner implements CommandLineRunner &#123;<br>    <span class="hljs-comment">// çœç•¥runæ–¹æ³•</span><br>&#125;<br><br><span class="hljs-comment">// ä¼˜å…ˆçº§ä¸º2çš„CommandLineRunner</span><br><span class="hljs-variable">@Component</span><br><span class="hljs-variable">@Order</span>(<span class="hljs-number">2</span>)<br>public class SecondCommandLineRunner implements CommandLineRunner &#123;<br>    <span class="hljs-comment">// çœç•¥runæ–¹æ³•</span><br>&#125;<br><br><span class="hljs-comment">// ä¼˜å…ˆçº§ä¸º1çš„ApplicationRunner</span><br><span class="hljs-variable">@Component</span><br><span class="hljs-variable">@Order</span>(<span class="hljs-number">1</span>)<br>public class FirstApplicationRunner implements ApplicationRunner &#123;<br>    <span class="hljs-comment">// çœç•¥runæ–¹æ³•</span><br>&#125;<br><br><span class="hljs-comment">// ä¼˜å…ˆçº§ä¸º2çš„ApplicationRunner</span><br><span class="hljs-variable">@Component</span><br><span class="hljs-variable">@Order</span>(<span class="hljs-number">2</span>)<br>public class SecondApplicationRunner implements ApplicationRunner &#123;<br>    <span class="hljs-comment">// çœç•¥runæ–¹æ³•</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªCommandLineRunnerå’Œä¸¤ä¸ªApplicationRunnerï¼Œå¹¶ä¸”åˆ†åˆ«æŒ‡å®šäº†å®ƒä»¬çš„ä¼˜å…ˆçº§ã€‚é‚£ä¹ˆå®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š</p><ul><li>FirstCommandLineRunner</li><li>SecondCommandLineRunner</li><li>FirstApplicationRunner</li><li>SecondApplicationRunner</li></ul><h3 id="CommandLineRunnerå’ŒApplicationRunnerçš„ä½¿ç”¨åœºæ™¯"><a href="#CommandLineRunnerå’ŒApplicationRunnerçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="CommandLineRunnerå’ŒApplicationRunnerçš„ä½¿ç”¨åœºæ™¯"></a>CommandLineRunnerå’ŒApplicationRunnerçš„ä½¿ç”¨åœºæ™¯</h3><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨CommandLineRunnerå’ŒApplicationRunnerå‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œå®ƒä»¬éƒ½å¯ä»¥ç”¨æ¥åœ¨Springå®¹å™¨å¯åŠ¨åæ‰§è¡Œä¸€äº›åˆå§‹åŒ–çš„ä»»åŠ¡ï¼Œæ¯”å¦‚åŠ è½½é…ç½®ï¼Œåˆå§‹åŒ–æ•°æ®ï¼Œè¿è¡Œæµ‹è¯•ç­‰ã€‚ä½†æ˜¯ï¼Œæ ¹æ®å®ƒä»¬çš„ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚æ¥é€‰æ‹©åˆé€‚çš„æ¥å£ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¯èƒ½çš„ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨Springå®¹å™¨å¯åŠ¨åæ‰§è¡Œä¸€äº›ç®€å•çš„ä»»åŠ¡ï¼Œè€Œä¸”ä¸éœ€è¦è·å–ä»»ä½•çš„åº”ç”¨ç¨‹åºå‚æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨CommandLineRunnerï¼Œå®ƒçš„ç”¨æ³•æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦å®ç°ä¸€ä¸ªæ¥å£ï¼Œç„¶åå†™å¥½runæ–¹æ³•å³å¯ã€‚</li><li>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨Springå®¹å™¨å¯åŠ¨åæ‰§è¡Œä¸€äº›å¤æ‚çš„ä»»åŠ¡ï¼Œè€Œä¸”éœ€è¦è·å–ä¸€äº›åº”ç”¨ç¨‹åºå‚æ•°ï¼Œæ¯”å¦‚Springçš„é…ç½®å‚æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ApplicationRunnerï¼Œå®ƒçš„ç”¨æ³•æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥é€šè¿‡ApplicationArgumentså¯¹è±¡æ¥è·å–å„ç§å‚æ•°ï¼Œç„¶åæ ¹æ®å‚æ•°æ¥æ‰§è¡Œä¸åŒçš„é€»è¾‘ã€‚</li><li>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨Springå®¹å™¨å¯åŠ¨åæ‰§è¡Œä¸€äº›å’Œå‘½ä»¤è¡Œç›¸å…³çš„ä»»åŠ¡ï¼Œæ¯”å¦‚è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œæ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨CommandLineRunnerï¼Œå®ƒå¯ä»¥ç›´æ¥è·å–å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ï¼Œç„¶åæ ¹æ®å‚æ•°æ¥æ‰§è¡Œä¸åŒçš„å‘½ä»¤ã€‚</li><li>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨Springå®¹å™¨å¯åŠ¨åæ‰§è¡Œä¸€äº›å’Œåº”ç”¨ç¨‹åºç›¸å…³çš„ä»»åŠ¡ï¼Œæ¯”å¦‚å¯åŠ¨å…¶ä»–çš„ç»„ä»¶ï¼Œè°ƒç”¨å…¶ä»–çš„æœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ApplicationRunnerï¼Œå®ƒå¯ä»¥è·å–åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ï¼Œç„¶åæ ¹æ®ä¸Šä¸‹æ–‡æ¥æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚</li></ul><h4 id="å®æ“â€”è·å–SpringBootå¯åŠ¨åå®¹å™¨é‡Œé¢æ‰€æœ‰çš„Bean"><a href="#å®æ“â€”è·å–SpringBootå¯åŠ¨åå®¹å™¨é‡Œé¢æ‰€æœ‰çš„Bean" class="headerlink" title="å®æ“â€”è·å–SpringBootå¯åŠ¨åå®¹å™¨é‡Œé¢æ‰€æœ‰çš„Bean"></a>å®æ“â€”è·å–SpringBootå¯åŠ¨åå®¹å™¨é‡Œé¢æ‰€æœ‰çš„Bean</h4><p>Spring Boot åœ¨å†…éƒ¨åŠ è½½äº†å¤§é‡çš„ beanï¼Œä»¥æœ€å°çš„é…ç½®è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ æˆ‘ä»¬æƒ³è¦æ‰¾å‡ºæ‰€æœ‰è¿™äº› <strong>SpringBoot åŠ è½½çš„ Bean</strong> åŠå…¶ç±»ç±»å‹ä¿¡æ¯ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸Šé¢è¯´çš„æ–¹æ³•</p><p><strong>ä½¿ç”¨<code>ApplicationContext</code>è·å–æ‰€æœ‰å·²åŠ è½½çš„ bean</strong></p><p>1ï¼‰ä½¿ç”¨<code>ApplicationContext.getBeanDefinitionNames()</code>æŸ¥æ‰¾æ‰€æœ‰å·²åŠ è½½ bean çš„åç§°</p><p>2ï¼‰ä½¿ç”¨<code>ApplicationContext.getBean(beanName)</code>è·å–åŒ…å«å…¶è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯çš„ beanã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@SpringBootApplication</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringBootWebApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpringBootServletInitializer</span> <span class="hljs-title">implements</span> <span class="hljs-title">CommandLineRunner</span> </span>&#123;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-type">SpringApplicationBuilder</span> configure(<span class="hljs-type">SpringApplicationBuilder</span> application) &#123;<br><span class="hljs-keyword">return</span> application.sources(<span class="hljs-type">SpringBootWebApplication</span>.<span class="hljs-keyword">class</span>);<br>&#125;<br><br>public static void main(<span class="hljs-type">String</span>[] args) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> &#123;<br><span class="hljs-type">SpringApplication</span>.run(<span class="hljs-type">SpringBootWebApplication</span>.<span class="hljs-keyword">class</span>, args);<br>&#125;<br><br><span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ApplicationContext</span> appContext;<br><br><span class="hljs-meta">@Override</span><br>    public void run(<span class="hljs-type">String</span>... args) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> <br>&#123;<br>        <span class="hljs-type">String</span>[] beans = appContext.getBeanDefinitionNames();<br>        <span class="hljs-type">Arrays</span>.sort(beans);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> bean : beans) <br>        &#123;<br>            <span class="hljs-type">System</span>.out.println(bean + <span class="hljs-string">&quot; of Type :: &quot;</span> + appContext.getBean(bean).getClass());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs stylus">....<br>basicErrorController of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.autoconfigure</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.BasicErrorController</span><br>beanNameHandlerMapping of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.handler</span><span class="hljs-selector-class">.BeanNameUrlHandlerMapping</span><br>beanNameViewResolver of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.view</span><span class="hljs-selector-class">.BeanNameViewResolver</span><br>characterEncodingFilter of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.filter</span><span class="hljs-selector-class">.OrderedCharacterEncodingFilter</span><br>conventionErrorViewResolver of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.autoconfigure</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.DefaultErrorViewResolver</span><br>defaultServletHandlerMapping of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.annotation</span>.WebMvcConfigurationSupport<span class="hljs-variable">$EmptyHandlerMapping</span><br>defaultViewResolver of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.view</span><span class="hljs-selector-class">.InternalResourceViewResolver</span><br>dispatcherServlet of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.DispatcherServlet</span><br>dispatcherServletRegistration of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.ServletRegistrationBean</span><br>duplicateServerPropertiesDetector of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.autoconfigure</span><span class="hljs-selector-class">.web</span>.ServerPropertiesAutoConfiguration<span class="hljs-variable">$DuplicateServerPropertiesDetector</span><br>embeddedServletContainerCustomizerBeanPostProcessor of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.context</span><span class="hljs-selector-class">.embedded</span><span class="hljs-selector-class">.EmbeddedServletContainerCustomizerBeanPostProcessor</span><br>error of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.autoconfigure</span><span class="hljs-selector-class">.web</span>.ErrorMvcAutoConfiguration<span class="hljs-variable">$SpelView</span><br>errorAttributes of Type :: class org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.autoconfigure</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.DefaultErrorAttributes</span><br><br>...<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Netty-1 IOç½‘ç»œæ¨¡å‹</title>
    <link href="/article/cc431be0.html"/>
    <url>/article/cc431be0.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><h2 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h2><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">Linux</span> å†…æ ¸ä¼šå°†æ‰€æœ‰å¤–éƒ¨è®¾å¤‡éƒ½çœ‹åšä¸€ä¸ªæ–‡ä»¶æ¥æ“ä½œï¼Œå¯¹ä¸€ä¸ªæ–‡ä»¶çš„è¯»å†™æ“ä½œä¼šè°ƒç”¨å†…æ ¸æä¾›çš„ç³»ç»Ÿå‘½ä»¤ï¼Œè¿”å›ä¸€ä¸ª<span class="hljs-variable">file</span> <span class="hljs-variable">descriptor</span> ï¼ˆ<span class="hljs-variable">fd</span><span class="hljs-operator">,</span> æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚äºŒé˜Ÿä¸€ä¸ª<span class="hljs-variable">socket</span>çš„è¯»å†™ä¹Ÿä¼šæœ‰ç›¸åº”çš„æè¿°ç¬¦ï¼Œæˆä¸º<span class="hljs-variable">socketfd</span>ï¼Œæè¿°ç¬¦å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå®ƒæŒ‡å‘å†…æ ¸ä¸­çš„ä¸€ä¸ªæœºæ„æï¼ˆæ–‡ä»¶è·¯å¾„ï¼Œæ•°æ®åŒºç­‰ä¸€äº›å±æ€§ï¼‰ã€‚<br>æ ¹æ®<span class="hljs-variable">UNIX</span>ç½‘ç»œç¼–ç¨‹å¯¹<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>æ¨¡å‹çš„åˆ†ç±»ï¼Œ<span class="hljs-variable">UNIX</span>æä¾›äº†<span class="hljs-number">5</span>ç§<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>æ¨¡å‹<br></code></pre></td></tr></table></figure><h2 id="ä¸»ä½“å†…å®¹"><a href="#ä¸»ä½“å†…å®¹" class="headerlink" title="ä¸»ä½“å†…å®¹"></a>ä¸»ä½“å†…å®¹</h2><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-number">1.</span>åŒæ­¥é˜»å¡<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>æ¨¡å‹ï¼ˆ<span class="hljs-variable">BIO</span>ï¼‰ï¼š<br>ä¼ ç»Ÿçš„<span class="hljs-variable">BIO</span>æ¨¡å‹ï¼Œ é€šå¸¸ç”±ä¸€ä¸ªç‹¬ç«‹çš„<span class="hljs-variable">Acceptor</span>çº¿ç¨‹è´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯çš„é“¾æ¥ï¼Œå¡”åŸºæ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ä¹‹åä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹è¿›è¡Œé“¾è·¯å¤„ç†ï¼Œå¤„ç†å®Œä¹‹åï¼Œé€šè¿‡è¾“å‡ºæµè¿”å›åº”ç­”ç»™å®¢æˆ·ç«¯ï¼Œçº¿ç¨‹é”€æ¯ã€‚<br>è¯¥æ¨¡å‹æœ€å¤§çš„é—®é¢˜å°±æ˜¯å½“å®¢æˆ·ç«¯å¹¶å‘è®¿é—®é‡å¢åŠ åï¼ŒæœåŠ¡ç«¯çš„çº¿ç¨‹ä¸ªæ•°å’Œå®¢æˆ·ç«¯å¹¶å‘è®¿é—®æ•°æˆ<span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">1</span>çš„æ­£æ¯”å…³ç³»ã€‚å¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹è€—å°½ã€‚<br><br><span class="hljs-number">2.</span>åŒæ­¥éé˜»å¡<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>æ¨¡å‹<span class="hljs-punctuation">(</span><span class="hljs-variable">NIO</span><span class="hljs-punctuation">)</span><br>æ­¤å¤„çš„<span class="hljs-variable">NIO</span>å¹¶é<span class="hljs-variable">java</span>çš„<span class="hljs-variable">nio</span>æ¡†æ¶ï¼Œ<span class="hljs-variable">socket</span>é“¾æ¥é»˜è®¤æ˜¯é˜»å¡æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å°†<span class="hljs-variable">socket</span>å˜æˆä¸ºéé˜»å¡çš„æ¨¡å¼ã€‚<br>è¿™ç§æ¨¡å¼ä¸‹ï¼Œå½“ç”¨æˆ·çº¿ç¨‹å‘èµ·<span class="hljs-variable">IO</span>æ“ä½œæ—¶ï¼Œå†…æ ¸ç¼“å†²åŒºæ²¡æœ‰æ•°æ®çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿè°ƒç”¨ä¼šç«‹å³è¿”å›<span class="hljs-variable">EWOULDBLOCK</span>å¤±è´¥ï¼Œç”¨æˆ·çº¿ç¨‹éœ€è¦ä¸€ç›´è½®è®­å‘èµ·<span class="hljs-variable">IO</span>æ“ä½œï¼Œå½“æœ‰æ•°æ®æ—¶ï¼Œç”¨æˆ·çº¿ç¨‹è¿›è¡Œ<span class="hljs-variable">IO</span>è°ƒç”¨æ­¤æ—¶ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚<br><br><span class="hljs-number">3.</span><span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>å¤šè·¯å¤ç”¨<br>é€šè¿‡<span class="hljs-variable">select</span><span class="hljs-operator">/</span><span class="hljs-variable">epoll</span>ç³»ç»Ÿè°ƒç”¨ï¼Œä¸€ä¸ªè¿›ç¨‹<span class="hljs-punctuation">(</span><span class="hljs-variable">Selector</span><span class="hljs-punctuation">)</span>å¯ä»¥ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆ<span class="hljs-variable">channel</span>ï¼‰ï¼ˆ<span class="hljs-variable">fd</span>ï¼‰<span class="hljs-operator">,</span>ä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼Œå†…æ ¸èƒ½å¤Ÿå°†å°±ç»ªçš„çŠ¶æ€è¿”å›ç»™åº”ç”¨ç³»ç»Ÿï¼ˆ<span class="hljs-variable">SelectionKey</span>ï¼‰ã€‚ç”¨æˆ·çº¿ç¨‹æ ¹æ®å°±ç»ªçŠ¶æ€å‘èµ·<span class="hljs-variable">IO</span>è°ƒç”¨ã€‚<br><span class="hljs-number">4.</span>ä¿¡å·é©±åŠ¨<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>æ¨¡å‹ï¼ˆæœªç†è§£ï¼‰<br>ä¿¡å·é©±åŠ¨çš„ <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span> æ¨¡å‹æ˜¯ä¸€ç§å¼‚æ­¥ <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span> æ¨¡å‹ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºåœ¨ç­‰å¾… <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span> æ“ä½œå®Œæˆæ—¶ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚åœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œå½“åº”ç”¨ç¨‹åºå‘èµ·ä¸€ä¸ª <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span> æ“ä½œæ—¶ï¼Œå®ƒå¹¶ä¸ä¼šä¸€ç›´ç­‰å¾…æ“ä½œå®Œæˆã€‚ç›¸åï¼Œå®ƒä¼šæ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†ç¨‹åºï¼Œè¯¥å¤„ç†ç¨‹åºåœ¨ <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span> æ“ä½œå®Œæˆæ—¶è¢«è°ƒç”¨ã€‚è¿™æ„å‘³ç€ï¼Œå½“ <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span> æ“ä½œå®Œæˆæ—¶ï¼Œå†…æ ¸ä¼šå‘é€ä¸€ä¸ªä¿¡å·å‘ŠçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è·å– <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span> æ“ä½œçš„ç»“æœã€‚ä¿¡å·é©±åŠ¨çš„ <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span> æ¨¡å‹é€‚ç”¨äºå¤§é‡çš„ <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span> æ“ä½œï¼Œå› ä¸ºå®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ª <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span> æ“ä½œï¼Œè€Œä¸å¿…ç­‰å¾…ä¸€ä¸ªæ“ä½œå®Œæˆåæ‰å¼€å§‹ä¸‹ä¸€ä¸ªæ“ä½œã€‚<br><span class="hljs-number">5.</span>å¼‚æ­¥<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>æ¨¡å‹ï¼ˆæœªç†è§£ï¼‰<br>åº”ç”¨ç¨‹åºé€šè¿‡å¼‚æ­¥è°ƒç”¨å‘èµ· <span class="hljs-variable">IO</span> æ“ä½œï¼Œå¹¶åœ¨æ“ä½œå®Œæˆæ—¶é€šè¿‡å›è°ƒå‡½æ•°å¾—åˆ°ç»“æœã€‚æ— éœ€é¢å¤–åˆ›å»ºä¿¡å·å¤„ç†å‡½æ•°æˆ–çº¿ç¨‹<span class="hljs-operator">/</span>è¿›ç¨‹ï¼Œå› æ­¤å¯ä»¥å¤§å¤§é™ä½ç³»ç»Ÿçš„èµ„æºæ¶ˆè€—å’Œå¤æ‚åº¦ï¼Œå¹¶ä¸”åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¯ä»¥æ›´åŠ æœ‰æ•ˆåœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºä¿è¯ç¨‹åºçš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚<br><br>ä»<span class="hljs-variable">IO</span>æ‰§è¡Œçš„è¿‡ç¨‹ä¸­çœ‹ï¼Œä¿¡å·é©±åŠ¨çš„ <span class="hljs-variable">IO</span> æ¨¡å‹åªæœ‰å‰åŠéƒ¨åˆ†å®ç°äº†å¼‚æ­¥ï¼Œè€Œå¼‚æ­¥<span class="hljs-variable">IO</span>æ¨¡å‹åˆ™åœ¨æ•´ä¸ª<span class="hljs-variable">IO</span>æ“ä½œè¿‡ç¨‹ä¸­éƒ½æ˜¯å¼‚æ­¥çš„ã€‚æ‰€ä»¥ï¼Œç›¸å¯¹äºä¿¡å·é©±åŠ¨çš„ <span class="hljs-variable">IO</span> æ¨¡å‹ï¼Œå¼‚æ­¥ <span class="hljs-variable">IO</span> æ¨¡å‹åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼˜åŠ¿è¾ƒå¤§ï¼Œå¯ä»¥æ›´å¥½åœ°é€‚åº”é«˜å¹¶å‘ã€é«˜è´Ÿè½½çš„åº”ç”¨ç¨‹åºéœ€æ±‚ã€‚<br></code></pre></td></tr></table></figure><h2 id="æ‰©å±•å†…å®¹"><a href="#æ‰©å±•å†…å®¹" class="headerlink" title="æ‰©å±•å†…å®¹"></a>æ‰©å±•å†…å®¹</h2><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-number">1.</span> <span class="hljs-variable">JAVA</span> <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>æ¼”è¿›å†å²<br>ï¼ˆ<span class="hljs-number">1</span>ï¼‰<span class="hljs-variable">jdk1</span><span class="hljs-number">.4</span>ä¹‹å‰ é‡‡ç”¨<span class="hljs-variable">BIO</span>æ¨¡å¼<br>ï¼ˆ<span class="hljs-number">2</span>ï¼‰<span class="hljs-variable">jdk1</span><span class="hljs-number">.4</span>     å‘å¸ƒåŸºäº<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>å¤šè·¯å¤ç”¨çš„<span class="hljs-variable">NIO</span><br>ï¼ˆ<span class="hljs-number">3</span>ï¼‰<span class="hljs-variable">jdk1</span><span class="hljs-number">.7</span>     å‘å¸ƒ<span class="hljs-variable">NIO2</span><span class="hljs-number">.0</span>ï¼Œæ”¯æŒ<span class="hljs-variable">AIO</span>ï¼ˆå¼‚æ­¥<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>æ“ä½œï¼‰<span class="hljs-operator">,</span><span class="hljs-variable">Netty</span>å¹¶æ²¡æœ‰ä½¿ç”¨<span class="hljs-variable">AIO</span><br><span class="hljs-number">2.</span> ç”¨æˆ·çº¿ç¨‹å’Œç³»ç»Ÿå†…æ ¸çš„äº¤äº’<br>ç”¨æˆ·ç¨‹åºä¸ç›´æ¥å’Œå†…æ ¸äº¤äº’ï¼Œè€Œæ˜¯é€šè¿‡ç¼“å†²åŒºæ¥è¿›è¡Œäº¤äº’ï¼Œæµç¨‹å¦‚ä¸‹ï¼š<br>ï¼ˆ<span class="hljs-number">1</span>ï¼‰ç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸Šåˆ°è¾¾ç½‘å¡ï¼Œå½“æ‰€ç­‰å¾…çš„æ•°æ®åˆ°è¾¾æ—¶ï¼Œä»–è¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºã€‚è¿™ä¸ªå·¥ä½œç”±æ“ä½œç³»ç»Ÿè‡ªåŠ¨å®Œæˆã€‚<br>ï¼ˆ<span class="hljs-number">2</span>ï¼‰å°±æ˜¯æŠŠå†…æ ¸ç¼“å†²åŒºçš„æ•°æ®å¤åˆ¶åˆ°è¿›ç¨‹ç¼“å†²åŒºã€‚<span class="hljs-variable">JAVA</span> ä¸¾ä¾‹<br><br>å®¢æˆ·ç«¯è¯·æ±‚ï¼š<span class="hljs-variable">Linux</span>é€šè¿‡ç½‘å¡è¯»å–å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°æ®ï¼Œå°†æ•°æ®è¯»å–åˆ°å†…æ ¸ç¼“å†²åŒºã€‚<br>è·å–è¯·æ±‚æ•°æ®ï¼š<span class="hljs-variable">JAVA</span>æœåŠ¡å™¨é€šè¿‡<span class="hljs-variable">read</span>ç³»ç»Ÿè°ƒç”¨ï¼Œä»<span class="hljs-variable">linux</span>å†…æ ¸ç¼“å†²åŒºè¯»å–æ•°æ®ï¼Œå†é€å…¥<span class="hljs-variable">JAVA</span>è¿›ç¨‹ç¼“å†²åŒºã€‚<br>æœåŠ¡ç«¯ä¸šåŠ¡å¤„ç†ï¼š<span class="hljs-variable">JAVA</span>æœåŠ¡å™¨åœ¨è‡ªå·±çš„ç”¨æˆ·ç©ºé—´ä¸­å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚<br>æœåŠ¡ç«¯è¿”å›æ•°æ®ï¼š<span class="hljs-variable">JAVA</span>æœåŠ¡å™¨å®Œæˆå¤„ç†åï¼Œæ„å»ºå¥½çš„å“åº”æ•°æ®ï¼Œè®²è¿™äº›æ•°æ®é€šè¿‡<span class="hljs-variable">write</span>æ“ä½œç”¨æˆ·ç¼“å†²åŒºå†™å…¥å†…æ ¸ç¼“å†²åŒºï¼Œ<br>å‘é€ç»™å®¢æˆ·ç«¯ï¼š<span class="hljs-variable">LInux</span>å†…æ ¸é€šè¿‡ç½‘ç»œ<span class="hljs-variable">IO</span><span class="hljs-operator">,</span>å°†å†…æ ¸ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œç½‘å¡é€šè¿‡åº•å±‚ç½‘ç»œåè®®ï¼Œå°†æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ã€‚<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Netty</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤šçº¿ç¨‹</title>
    <link href="/article/5729df21.html"/>
    <url>/article/5729df21.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><h2 id="çº¿ç¨‹çŠ¶æ€"><a href="#çº¿ç¨‹çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çŠ¶æ€"></a>çº¿ç¨‹çŠ¶æ€</h2><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">åœ¨Javaä¸­ï¼Œçº¿ç¨‹çš„çŠ¶æ€åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼Œä»¥åŠå¯¹åº”çš„çŠ¶æ€ç ï¼š<br><br>1. <span class="hljs-strong">**NEWï¼ˆæ–°å»ºï¼‰**</span>ï¼šçº¿ç¨‹è¢«åˆ›å»ºï¼Œä½†å°šæœªå¯åŠ¨ã€‚çŠ¶æ€ç ï¼š1<br><span class="hljs-code">    </span><br>2. <span class="hljs-strong">**RUNNABLEï¼ˆå¯è¿è¡Œï¼‰**</span>ï¼šçº¿ç¨‹æ­£åœ¨Javaè™šæ‹Ÿæœºä¸­æ‰§è¡Œï¼Œå¯èƒ½æ­£åœ¨ç­‰å¾…CPUæ—¶é—´ç‰‡ã€‚çŠ¶æ€ç ï¼š2<br><span class="hljs-code">    </span><br>3. <span class="hljs-strong">**BLOCKEDï¼ˆé˜»å¡ï¼‰**</span>ï¼šçº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–ä¸€ä¸ªé”ï¼Œä»¥ä¾¿è¿›å…¥åŒæ­¥å—/æ–¹æ³•ã€‚çŠ¶æ€ç ï¼š3<br><span class="hljs-code">    </span><br>4. <span class="hljs-strong">**WAITINGï¼ˆç­‰å¾…ï¼‰**</span>ï¼šçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šæ“ä½œï¼ˆæ— è¶…æ—¶ï¼‰ã€‚çŠ¶æ€ç ï¼š4<br><span class="hljs-code">    </span><br>5. <span class="hljs-strong">**TIMED_WAITINGï¼ˆè¶…æ—¶ç­‰å¾…ï¼‰**</span>ï¼šçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šæ“ä½œï¼ˆæœ‰è¶…æ—¶ï¼‰ã€‚çŠ¶æ€ç ï¼š5<br><span class="hljs-code">    </span><br>6. <span class="hljs-strong">**TERMINATEDï¼ˆç»ˆæ­¢ï¼‰**</span>ï¼šçº¿ç¨‹å·²å®Œæˆæ‰§è¡Œæˆ–å› å¼‚å¸¸é€€å‡ºã€‚çŠ¶æ€ç ï¼š6<br><span class="hljs-code">    </span><br><br>è¿™äº›çŠ¶æ€ç æ˜¯åœ¨Javaçº¿ç¨‹çŠ¶æ€æšä¸¾ç±»<span class="hljs-code">`java.lang.Thread.State`</span>ä¸­å®šä¹‰çš„ã€‚<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—-åè¯è§£é‡Š</title>
    <link href="/article/c78c5ef.html"/>
    <url>/article/c78c5ef.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><p>ç‚¹å¯¹ç‚¹ï¼š1:1<br>å‘å¸ƒè®¢é˜…ï¼š1:n</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">AMQ:</span><br><span class="hljs-number">1</span>:<span class="hljs-number">1</span> å‘å¸ƒæ¶ˆæ¯åˆ°queue<br><span class="hljs-number">1</span>:n å‘å¸ƒæ¶ˆæ¯åˆ°topic<br><span class="hljs-symbol">RABBIT:</span>ï¼ˆ<span class="hljs-keyword">PUSH</span>ï¼‰<br>ï¼ˆé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…è½®è®­æ¶ˆè´¹ï¼Œä¸æ˜¯éƒ½æ¶ˆè´¹ï¼‰<br><span class="hljs-number">1</span>:<span class="hljs-number">1</span> exchangeåªç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…<br><span class="hljs-number">1</span>:n exchangeç»‘å®šå¤šä¸ªé˜Ÿåˆ—<br>KAFKAï¼ˆPULLï¼‰<br><span class="hljs-number">1</span>:<span class="hljs-number">1</span> å‘å¸ƒåˆ°topicï¼Œæ¶ˆè´¹è€…ç»„åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ‹‰å–<br><span class="hljs-number">1</span>:n å‘å¸ƒåˆ°topic,å¤šä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„éƒ½å¯ä»¥æ¶ˆè´¹ç›¸åŒæ¶ˆæ¯ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ‰€æ¶ˆè´¹ã€‚<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ¶ˆæ¯é˜Ÿåˆ—ã€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®ˆæŠ¤çº¿ç¨‹</title>
    <link href="/article/6137330d.html"/>
    <url>/article/6137330d.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><p>åœ¨è¿™ç¯‡ç®€çŸ­çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®²è§£ä¸‹ Java ä¸­çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œçœ‹çœ‹å®ƒä»¬å¯ä»¥åšä»€ä¹ˆã€‚æˆ‘ä»¬è¿˜å°†è§£é‡Šå®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹ä¹‹é—´çš„åŒºåˆ«ã€‚</p><h2 id="å®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹çš„åŒºåˆ«"><a href="#å®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹çš„åŒºåˆ«"></a>å®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹çš„åŒºåˆ«</h2><p><a href="https://www.twle.cn/l/yufei/java/java-basic-index.html">Java</a> æä¾›äº†ä¸¤ç§ç±»å‹çš„çº¿ç¨‹ï¼š<strong>å®ˆæŠ¤çº¿ç¨‹</strong> å’Œ <strong>ç”¨æˆ·çº¿ç¨‹</strong></p><ul><li><strong>ç”¨æˆ·çº¿ç¨‹</strong> æ˜¯é«˜ä¼˜å…ˆçº§çº¿ç¨‹ã€‚JVM ä¼šåœ¨ç»ˆæ­¢ä¹‹å‰ç­‰å¾…ä»»ä½•ç”¨æˆ·çº¿ç¨‹å®Œæˆå…¶ä»»åŠ¡ã€‚</li><li><strong>ç”¨æˆ·çº¿ç¨‹</strong> æ˜¯ä½ä¼˜å…ˆçº§çº¿ç¨‹ã€‚å…¶å”¯ä¸€ä½œç”¨æ˜¯ä¸ºç”¨æˆ·çº¿ç¨‹æä¾›æœåŠ¡ã€‚</li></ul><p>ç”±äºå®ˆæŠ¤çº¿ç¨‹çš„ä½œç”¨æ˜¯ä¸ºç”¨æˆ·çº¿ç¨‹æä¾›æœåŠ¡ï¼Œå¹¶ä¸”ä»…åœ¨ç”¨æˆ·çº¿ç¨‹è¿è¡Œæ—¶æ‰éœ€è¦ï¼Œå› æ­¤ä¸€æ—¦æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹å®Œæˆæ‰§è¡Œï¼ŒJVM å°±ä¼šç»ˆæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ <strong>å®ˆæŠ¤çº¿ç¨‹ä¸ä¼šé˜»æ­¢ JVM é€€å‡º</strong>ã€‚</p><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆé€šå¸¸å­˜åœ¨äºå®ˆæŠ¤çº¿ç¨‹ä¸­çš„æ— é™å¾ªç¯ä¸ä¼šå¯¼è‡´é—®é¢˜ï¼Œå› ä¸ºä»»ä½•ä»£ç ï¼ˆåŒ…æ‹¬ finally å— ï¼‰éƒ½ä¸ä¼šåœ¨æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹å®Œæˆæ‰§è¡Œåæ‰§è¡Œã€‚</p><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¹¶ä¸æ¨è <strong>åœ¨å®ˆæŠ¤çº¿ç¨‹ä¸­æ‰§è¡Œ I&#x2F;O ä»»åŠ¡</strong> ã€‚å› ä¸ºå¯èƒ½å¯¼è‡´æ— æ³•æ­£ç¡®å…³é—­èµ„æºã€‚</p><p>ä½†æ˜¯ï¼Œå®ˆæŠ¤çº¿ç¨‹å¹¶ä¸æ˜¯ 100% ä¸èƒ½é˜»æ­¢ JVM é€€å‡ºçš„ã€‚å®ˆæŠ¤çº¿ç¨‹ä¸­è®¾è®¡ä¸è‰¯çš„ä»£ç å¯èƒ½ä¼šé˜»æ­¢ JVM é€€å‡ºã€‚ä¾‹å¦‚ï¼Œåœ¨æ­£åœ¨è¿è¡Œçš„å®ˆæŠ¤çº¿ç¨‹ä¸Šè°ƒç”¨<code>Thread.join()</code> å¯ä»¥é˜»æ­¢åº”ç”¨ç¨‹åºçš„å…³é—­ã€‚</p><h2 id="å®ˆæŠ¤çº¿ç¨‹èƒ½ç”¨æ¥åšä»€ä¹ˆï¼Ÿ"><a href="#å®ˆæŠ¤çº¿ç¨‹èƒ½ç”¨æ¥åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹èƒ½ç”¨æ¥åšä»€ä¹ˆï¼Ÿ"></a>å®ˆæŠ¤çº¿ç¨‹èƒ½ç”¨æ¥åšä»€ä¹ˆï¼Ÿ</h2><p>å¸¸è§çš„åšæ³•ï¼Œå°±æ˜¯å°†å®ˆæŠ¤çº¿ç¨‹ç”¨äºåå°æ”¯æŒä»»åŠ¡ï¼Œæ¯”å¦‚åƒåœ¾å›æ”¶ã€é‡Šæ”¾æœªä½¿ç”¨å¯¹è±¡çš„å†…å­˜ã€ä»ç¼“å­˜ä¸­åˆ é™¤ä¸éœ€è¦çš„æ¡ç›®ã€‚</p><p>å’¦ï¼ŒæŒ‰ç…§è¿™ä¸ªè§£é‡Šï¼Œé‚£ä¹ˆå¤§å¤šæ•° JVM çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚</p><h2 id="å¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹-ï¼Ÿ"><a href="#å¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹-ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹ ï¼Ÿ"></a>å¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹ ï¼Ÿ</h2><p>å®ˆæŠ¤çº¿ç¨‹ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå› æ­¤å®ƒçš„åˆ›å»ºå’Œå¯åŠ¨å…¶å®å’Œæ™®é€šçº¿ç¨‹æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>è¦å°†æ™®é€šçº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œæ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦è°ƒç”¨ <code>Thread.setDaemon()</code> æ–¹æ³•å³å¯ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼Œå‡è®¾æˆ‘ä»¬ç»§æ‰¿ <code>Thread</code> ç±»åˆ›å»ºäº†ä¸€ä¸ªæ–°ç±» <code>NewThread</code> ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºè¿™ä¸ªç±»çš„å®ä¾‹å¹¶è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹</p><p>NewThread daemonThread = new NewThread();<br>daemonThread.setDaemon(true);<br>daemonThread.start();</p><p>åœ¨ Java è¯­è¨€ä¸­ï¼Œçº¿ç¨‹çš„çŠ¶æ€æ˜¯è‡ªåŠ¨ç»§æ‰¿çš„ã€‚ä»»ä½•çº¿ç¨‹éƒ½ä¼šç»§æ‰¿åˆ›å»ºå®ƒçš„çº¿ç¨‹çš„å®ˆæŠ¤ç¨‹åºçŠ¶æ€ã€‚æ€ä¹ˆç†è§£å‘¢ï¼Ÿ</p><ol><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹æ˜¯æ™®é€šçº¿ç¨‹ï¼ˆ ç”¨æˆ·çº¿ç¨‹ï¼‰ ï¼Œé‚£ä¹ˆå®ƒåˆ›å»ºçš„å­çº¿ç¨‹é»˜è®¤ä¹Ÿæ˜¯æ™®é€šçº¿ç¨‹ï¼ˆ ç”¨æˆ·çº¿ç¨‹ ï¼‰ã€‚</li><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œé‚£ä¹ˆå®ƒåˆ›å»ºçš„å­çº¿ç¨‹é»˜è®¤ä¹Ÿæ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚</li></ol><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ¼”å‡ºï¼š ç”±äºä¸»çº¿ç¨‹æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œå› æ­¤åœ¨ <code>main()</code> æ–¹æ³•å†…åˆ›å»ºçš„ä»»ä½•çº¿ç¨‹é»˜è®¤ä¸ºç”¨æˆ·çº¿ç¨‹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯è°ƒç”¨ <code>setDaemon()</code> æ–¹æ³•çš„æ—¶æœºï¼Œè¯¥æ–¹æ³•åªèƒ½åœ¨åˆ›å»º Thread å¯¹è±¡å¹¶ä¸”åœ¨å¯åŠ¨çº¿ç¨‹å‰è°ƒç”¨ã€‚åœ¨çº¿ç¨‹è¿è¡Œæ—¶å°è¯•è°ƒç”¨ <code>setDaemon()</code> å°†æŠ›å‡º IllegalThreadStateException å¼‚å¸¸ã€‚</p><p>@Test(expected = IllegalThreadStateException.class)<br>public void whenSetDaemonWhileRunning_thenIllegalThreadStateException() {<br>    NewThread daemonThread = new NewThread();<br>    daemonThread.start();<br>    daemonThread.setDaemon(true);<br>}</p><h2 id="å¦‚ä½•æ£€æŸ¥ä¸€ä¸ªçº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹è¿˜æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Ÿ"><a href="#å¦‚ä½•æ£€æŸ¥ä¸€ä¸ªçº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹è¿˜æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ£€æŸ¥ä¸€ä¸ªçº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹è¿˜æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Ÿ"></a>å¦‚ä½•æ£€æŸ¥ä¸€ä¸ªçº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹è¿˜æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Ÿ</h2><p>æ£€æŸ¥ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå¯ä»¥ç®€å•åœ°è°ƒç”¨æ–¹æ³• <code>isDaemon()</code> ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º</p><p>@Test<br>public void whenCallIsDaemon_thenCorrect() {<br>    NewThread daemonThread = new NewThread();<br>    NewThread userThread = new NewThread();<br>    daemonThread.setDaemon(true);<br>    daemonThread.start();<br>    userThread.start();</p><pre><code class="hljs">assertTrue(daemonThread.isDaemon());assertFalse(userThread.isDaemon());</code></pre><p>}</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>å®ˆæŠ¤çº¿ç¨‹çš„æ¦‚å¿µæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å½»åº•ææ‡‚Log4Jã€Log4J2ã€LogBackï¼ŒSLF4J</title>
    <link href="/article/bb8feff0.html"/>
    <url>/article/bb8feff0.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><blockquote><p>æœ€è¿‘ç³»ç»Ÿè¢«æ‰«å‡ºæ¥è¿˜åœ¨ä½¿ç”¨è€æ—§çš„log4jï¼Œéœ€è¦å‡çº§åˆ°æœ€æ–°çš„log4jã€‚ä½†æ˜¯åœ¨å‡çº§çš„å‘ç°ï¼ŒJavaç›¸å…³çš„æ—¥å¿—å¤„ç†åº“æœ‰log4j, log4j2,slf4jå’Œlogbackï¼Œåˆä¸€çœ‹ç¡®å®æœ‰ç‚¹å¤´å¤§ï¼Œé‚£ä¹ˆåŒºåˆ«æ˜¯å•¥å‘¢ï¼Ÿä¹‹å‰ä¹Ÿå¤§æ¦‚çŸ¥é“ä¸€äº›ï¼ŒæŸ¥æ‰¾äº†å¤§é‡ç›¸å…³èµ„æ–™ï¼Œè¿™é‡Œå¥½å¥½æ€»ç»“ä¸€ä¸‹ï¼Œç›¸ä¿¡ä½ è¯»å®Œå°±ä¼šç†Ÿç»ƒæŒæ¡</p></blockquote><h3 id="Log4Jã€Log4J2å’ŒLogBackçš„å†å²æ•…äº‹"><a href="#Log4Jã€Log4J2å’ŒLogBackçš„å†å²æ•…äº‹" class="headerlink" title="Log4Jã€Log4J2å’ŒLogBackçš„å†å²æ•…äº‹"></a>Log4Jã€Log4J2å’ŒLogBackçš„å†å²æ•…äº‹</h3><p>ä½¿ç”¨è¿‡Log4Jå’ŒLogBackçš„åŒå­¦è‚¯å®šèƒ½å‘ç°ï¼Œè¿™ä¸¤ä¸ªæ¡†æ¶çš„è®¾è®¡ç†å¿µæä¸ºç›¸ä¼¼ï¼Œä½¿ç”¨æ–¹æ³•ä¹Ÿå¦‚å‡ºä¸€è¾™ã€‚å…¶å®è¿™ä¸ªä¸¤ä¸ªæ¡†æ¶çš„ä½œè€…éƒ½æ˜¯ä¸€ä¸ªäººï¼ŒCeki GÃ¼lcÃ¼ï¼Œä¿„ç½—æ–¯ç¨‹åºå‘˜ã€‚</p><p>Log4J æœ€åˆæ˜¯åŸºäºJavaå¼€å‘çš„æ—¥å¿—æ¡†æ¶ï¼Œå‘å±•ä¸€æ®µæ—¶é—´åï¼Œä½œè€…Ceki GÃ¼lcÃ¼å°†Log4jæçŒ®ç»™äº†Apacheè½¯ä»¶åŸºé‡‘ä¼šï¼Œä½¿ä¹‹æˆä¸ºäº†Apacheæ—¥å¿—æœåŠ¡çš„ä¸€ä¸ªå­é¡¹ç›®ã€‚ åˆç”±äºLog4Jå‡ºè‰²çš„è¡¨ç°ï¼Œåç»­åˆè¢«å­µåŒ–å‡ºäº†æ”¯æŒC, C++, C#, Perl, Python, Rubyç­‰è¯­è¨€çš„å­æ¡†æ¶ã€‚</p><p>ç„¶è€Œï¼Œä¼Ÿå¤§çš„ç¨‹åºå‘˜å¥½åƒéƒ½æ¯”è¾ƒæœ‰ä¸ªæ€§ã€‚Ceki GÃ¼lcÃ¼ç”±äºä¸æ»¡Apacheå¯¹Log4Jçš„ç®¡ç†ï¼Œå†³å®šä¸å†å‚åŠ Log4Jçš„å¼€å‘ç»´æŠ¤ã€‚â€œå‡ºèµ°â€åçš„Ceki GÃ¼lcÃ¼å¦èµ·ç‚‰ç¶ï¼Œå¼€å‘å‡ºäº†LogBackè¿™ä¸ªæ¡†æ¶ï¼ˆSLF4Jæ˜¯å’ŒLogBackä¸€èµ·å¼€å‘å‡ºæ¥çš„ï¼‰ã€‚LogBackæ”¹è¿›äº†å¾ˆå¤šLog4Jçš„ç¼ºç‚¹ï¼Œåœ¨æ€§èƒ½ä¸Šæœ‰äº†å¾ˆå¤§çš„æå‡ï¼ŒåŒæ—¶ä½¿ç”¨æ–¹å¼å‡ ä¹å’ŒLog4Jä¸€æ ·ï¼Œè®¸å¤šç”¨æˆ·å¼€å§‹æ…¢æ…¢å¼€å§‹ä½¿ç”¨LogBackã€‚</p><p>ç”±äºå—åˆ°LogBackçš„å†²å‡»ï¼ŒLog4Jå¼€å§‹å¼å¾®ã€‚ç»ˆäºï¼Œ2015å¹´9æœˆï¼ŒApacheè½¯ä»¶åŸºé‡‘ä¸šå®£å¸ƒï¼ŒLog4jä¸åœ¨ç»´æŠ¤ï¼Œå»ºè®®æ‰€æœ‰ç›¸å…³é¡¹ç›®å‡çº§åˆ°Log4j2ã€‚Log4J2æ˜¯Apacheå¼€å‘çš„ä¸€ä¸ªæ–°çš„æ—¥å¿—æ¡†æ¶ï¼Œæ”¹è¿›äº†å¾ˆå¤šLog4Jçš„ç¼ºç‚¹ï¼ŒåŒæ—¶ä¹Ÿå€Ÿé‰´äº†LogBackï¼Œå·ç§°åœ¨æ€§èƒ½ä¸Šä¹Ÿæ˜¯å®ŒèƒœLogBackã€‚æ€§èƒ½è¿™å—åé¢æˆ‘ä¼šä»”ç»†åˆ†æã€‚</p><h3 id="é‚£slf4jå’Œè¿™äº›æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#é‚£slf4jå’Œè¿™äº›æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="é‚£slf4jå’Œè¿™äº›æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>é‚£slf4jå’Œè¿™äº›æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3><p>SLF4Jçš„å…¨ç§°æ˜¯Simple Logging Facade for Javaï¼Œslf4jæ˜¯<strong>é—¨é¢æ¨¡å¼</strong>çš„å…¸å‹åº”ç”¨ï¼Œå› æ­¤åœ¨è®²slf4jå‰ï¼Œéœ€è¦ç®€å•ä»‹ç»ä¸‹é—¨é¢æ¨¡å¼ã€‚</p><h3 id="çœ‹çœ‹é—¨é¢æ¨¡å¼å†è¯´"><a href="#çœ‹çœ‹é—¨é¢æ¨¡å¼å†è¯´" class="headerlink" title="çœ‹çœ‹é—¨é¢æ¨¡å¼å†è¯´"></a>çœ‹çœ‹é—¨é¢æ¨¡å¼å†è¯´</h3><p>ä¸‹é¢æ˜¯é—¨é¢æ¨¡å¼çš„ä¸€ä¸ªå…¸å‹è°ƒç”¨è¿‡ç¨‹ï¼Œ<strong>å…¶æ ¸å¿ƒä¸ºå¤–éƒ¨ä¸ä¸€ä¸ªå­ç³»ç»Ÿçš„é€šä¿¡å¿…é¡»é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¤–è§‚å¯¹è±¡è¿›è¡Œï¼Œä½¿å¾—å­ç³»ç»Ÿæ›´æ˜“äºä½¿ç”¨ã€‚</strong> ä¸‹å›¾ä¸­å®¢æˆ·ç«¯ä¸éœ€è¦ç›´æ¥è°ƒç”¨å‡ ä¸ªå­ç³»ç»Ÿï¼Œåªéœ€è¦ä¸ç»Ÿä¸€çš„é—¨é¢è¿›è¡Œé€šä¿¡å³å¯ã€‚</p><p><img src="https://pic4.zhimg.com/80/v2-d85852b61e7828e9a42ce18516ea263f_720w.webp"></p><p>mJDusF</p><p>é—¨é¢æ¨¡å¼çš„æ ¸å¿ƒä¸ºFacadeå³é—¨é¢å¯¹è±¡ï¼Œæ ¸å¿ƒä¸ºå‡ ä¸ªç‚¹ï¼š</p><ul><li>çŸ¥é“æ‰€æœ‰å­è§’è‰²çš„åŠŸèƒ½å’Œè´£ä»»ã€‚</li><li>å°†å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚å§”æ´¾åˆ°å­ç³»ç»Ÿä¸­ï¼Œæ²¡æœ‰å®é™…ä¸šåŠ¡é€»è¾‘ã€‚</li><li>ä¸å‚ä¸å­ç³»ç»Ÿå†…ä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨slf4j-ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨slf4j-ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨slf4j ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨slf4j ï¼Ÿ</h3><p>å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å¦‚æœéœ€è¦ç”¨ä¸Šé¢å‡ ä¸ªæ—¥å¿—æ¡†æ¶æ¥æ‰“å°æ—¥å¿—ï¼Œä¸€èˆ¬æ€ä¹ˆåšï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs abnf">// ä½¿ç”¨log4jï¼Œéœ€è¦log4j.jar<br>import org.apache.log4j.Logger<span class="hljs-comment">;</span><br>Logger logger_log4j <span class="hljs-operator">=</span> Logger.getLogger(Test.class)<span class="hljs-comment">;</span><br>logger_log4j.info(<span class="hljs-string">&quot;Hello World!&quot;</span>)<span class="hljs-comment">;</span><br><br>// ä½¿ç”¨log4j2ï¼Œéœ€è¦log4j-api.jarã€log4j-core.jar<br>import org.apache.logging.log4j.LogManager<span class="hljs-comment">;</span><br>import org.apache.logging.log4j.Logger<span class="hljs-comment">;</span><br>Logger logger_log4j2 <span class="hljs-operator">=</span> LogManager.getLogger(Test.class)<span class="hljs-comment">;</span><br>logger_log4j2.info(<span class="hljs-string">&quot;Hello World!&quot;</span>)<span class="hljs-comment">;</span><br><br>// logbackï¼Œéœ€è¦logback-classic.jarã€logback-core.jar<br>import ch.qos.logback.classic.Logger<span class="hljs-comment">;</span><br>import ch.qos.logback.classic.LoggerContext<span class="hljs-comment">;</span><br>Logger logger_logback <span class="hljs-operator">=</span> new LoggerContext().getLogger(Test.class)<span class="hljs-comment">;</span><br>logger_logback.info(<span class="hljs-string">&quot;Hello World!&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢ä¸éš¾çœ‹å‡ºï¼Œä½¿ç”¨ä¸åŒçš„æ—¥å¿—æ¡†æ¶ï¼Œå°±è¦å¼•å…¥ä¸åŒçš„jaråŒ…ï¼Œä½¿ç”¨ä¸åŒçš„ä»£ç è·å–Loggerã€‚å¦‚æœé¡¹ç›®å‡çº§éœ€è¦æ›´æ¢ä¸åŒçš„æ¡†æ¶ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹æ‰€æœ‰çš„åœ°æ–¹æ¥è·å–æ–°çš„Loggerï¼Œè¿™å°†ä¼šäº§ç”Ÿå·¨å¤§çš„å·¥ä½œé‡ã€‚</p><p>åŸºäºæ­¤ï¼Œ<strong>æˆ‘ä»¬éœ€è¦ä¸€ç§æ¥å£æ¥å°†ä¸åŒçš„æ—¥å¿—æ¡†æ¶çš„ä½¿ç”¨ç»Ÿä¸€èµ·æ¥ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦ä½¿ç”¨slf4jçš„åŸå› ã€‚</strong></p><p><strong>SLF4Jï¼Œå³ç®€å•æ—¥å¿—é—¨é¢ï¼ˆSimple Logging Facade for Javaï¼‰ï¼Œä¸æ˜¯å…·ä½“çš„æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼Œå®ƒåªæœåŠ¡äºå„ç§å„æ ·çš„æ—¥å¿—ç³»ç»Ÿã€‚æŒ‰ç…§å®˜æ–¹çš„è¯´æ³•ï¼ŒSLF4Jæ˜¯ä¸€ä¸ªç”¨äºæ—¥å¿—ç³»ç»Ÿçš„ç®€å•Facadeï¼Œå…è®¸æœ€ç»ˆç”¨æˆ·åœ¨éƒ¨ç½²å…¶åº”ç”¨æ—¶ä½¿ç”¨å…¶æ‰€å¸Œæœ›çš„æ—¥å¿—ç³»ç»Ÿã€‚</strong></p><blockquote><p>æ³¨æ„ï¼šç±»ä¼¼çš„æ—¥å¿—é—¨é¢è¿˜æœ‰Jakarta Common loggingï¼ˆJCLï¼‰ï¼Œä¸»è¦åŒºåˆ«åœ¨äºï¼ŒSLF4Jæ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„æ—¥å¿—æ¡†æ¶ï¼Œå®ƒæ›´åŠ çµæ´»ï¼Œæ€§èƒ½æ›´å¥½ï¼Œæ”¯æŒæ›´å¤šçš„æ—¥å¿—å®ç°ï¼Œè€Œä¸”JCLåŸºäºclassLoaderåœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½æ—¥å¿—æ¡†æ¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¾ˆå¤šæ„æƒ³ä¸åˆ°çš„å®‰å…¨é—®é¢˜ï¼Œå…³äºè¿™ä¸ªé—®é¢˜å¯ä»¥å‚è€ƒè®¨è®º<a href="https://link.zhihu.com/?target=https://stackoverflow.com/questions/3222895/what-is-the-issue-with-the-runtime-discovery-algorithm-of-apache-commons-logging">https://stackoverflow.com/questions/3222895/what-is-the-issue-with-the-runtime-discovery-algorithm-of-apache-commons-logging</a></p></blockquote><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“JCLå’ŒSLF4Jéƒ½æ˜¯æ—¥å¿—é—¨é¢ï¼ˆFacadeï¼‰ï¼Œè€ŒLog4Jã€Log4J2å’ŒLogBackéƒ½æ˜¯å­ç³»ç»Ÿè§’è‰²ï¼ˆSunSystemï¼‰ï¼Œä¹Ÿå°±æ˜¯å…·ä½“çš„æ—¥å¿—å®ç°æ¡†æ¶ã€‚ä»–ä»¬çš„å…³ç³»å¦‚ä¸‹ï¼ŒJULæ˜¯JDKæœ¬èº«æä¾›çš„ä¸€ç§å®ç°ã€‚</p><p>![](data:image&#x2F;svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1276' height='486'></svg>)</p><p>aMexDT</p><p>ä½¿ç”¨æ—¥å¿—é—¨é¢å¼•å…¥æ—¥å¿—ç»„ä»¶çš„æœ€å¤§ä¼˜åŠ¿æ˜¯ï¼š<strong>å°†ç³»ç»Ÿå’Œå…·ä½“çš„æ—¥å¿—å®ç°æ¡†æ¶è§£è€¦åˆã€‚</strong></p><h3 id="slf4jæ€ä¹ˆå’Œæ—¥å¿—æ¡†æ¶ç»“åˆä½¿ç”¨ï¼Ÿ"><a href="#slf4jæ€ä¹ˆå’Œæ—¥å¿—æ¡†æ¶ç»“åˆä½¿ç”¨ï¼Ÿ" class="headerlink" title="slf4jæ€ä¹ˆå’Œæ—¥å¿—æ¡†æ¶ç»“åˆä½¿ç”¨ï¼Ÿ"></a>slf4jæ€ä¹ˆå’Œæ—¥å¿—æ¡†æ¶ç»“åˆä½¿ç”¨ï¼Ÿ</h3><p>ä½¿ç”¨slf4jåï¼Œå½“æˆ‘ä»¬åœ¨æ‰“å°æ—¥å¿—æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">import org.slf4j.Logger<span class="hljs-comment">;</span><br>import org.slf4j.LoggerFactory<span class="hljs-comment">;</span><br>Logger logger <span class="hljs-operator">=</span> LoggerFactory.getLogger(Test.class)<span class="hljs-comment">;</span><br>logger.info(<span class="hljs-string">&quot;Hello World!&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿™åˆå¼•å…¥äº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œslf4jå¦‚ä½•å†³å®šä½¿ç”¨å“ªä¸ªæ¡†æ¶æ—¥å¿—å‘¢ï¼Œå¹¶ä¸”å¼•å…¥å“ªäº›jaråŒ…å‘¢ï¼Ÿå®˜æ–¹ä¸ºæˆ‘ä»¬å‡†å¤‡äº†ä¸‹é¢çš„ç»„åˆä¾èµ–ç»“æ„å›¾ï¼š</p><p>![](data:image&#x2F;svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='3106' height='1730'></svg>)</p><p>hBZadd</p><p>æ€»ç»“æ¥è¯´ï¼Œå°±æ˜¯ä¸€ä¸‹å‡ ç§ï¼š</p><ul><li><strong>slf4j + logback</strong>ï¼š slf4j-api.jar + logback-classic.jar + logback-core.jar</li><li><strong>slf4j + log4j</strong>ï¼š slf4j-api.jar + slf4j-log412.jar + log4j.jar</li><li><strong>slf4j + jul</strong>ï¼š slf4j-api.jar + slf4j-jdk14.jar</li><li><strong>ä¹Ÿå¯ä»¥åªç”¨slf4jæ— æ—¥å¿—å®ç°</strong>ï¼šslf4j-api.jar + slf4j-nop.jar</li></ul><p>æ³¨æ„åˆ°è¿™é‡Œæ²¡æœ‰log4j2ä¾èµ–jarçš„å…³ç³»ï¼Œå’Œlog4j2é…åˆéœ€è¦å¯¼å…¥log4j2çš„log4j-api.jarã€log4j-core.jarå’Œæ¡¥æ¥åŒ…log4j-slf4j-impl.jarã€‚</p><blockquote><p>æ‰€è°“çš„æ¡¥æ¥åŒ…ï¼Œå°±æ˜¯å®ç°StaticLoggerBinderç±»ï¼Œç”¨æ¥è¿æ¥slf4jå’Œæ—¥å¿—æ¡†æ¶ã€‚å› ä¸ºlog4jå’Œlog4j2åˆšå¼€å§‹æ²¡æœ‰StaticLoggerBinderè¿™ä¸ªç±»ï¼Œä¸ºäº†ä¸æ”¹å˜ç¨‹åºç»“æ„ï¼Œåªèƒ½é‡æ–°å†™ä¸€ä¸ªæ–°çš„jaræ¥å®ç°StaticLoggerBinderã€‚è€Œlogbackå‡ºç°slf4jä¹‹åï¼Œäºæ˜¯åœ¨logbackæœ¬èº«çš„jarä¸­å®ç°äº†StaticLoggerBinderï¼Œæ‰€ä»¥å°±ä¸éœ€è¦æ¡¥æ¥åŒ…ã€‚</p></blockquote><h3 id="ç°åœ¨ä¸ºä»€ä¹ˆæ¨èLog4j2ï¼Ÿ"><a href="#ç°åœ¨ä¸ºä»€ä¹ˆæ¨èLog4j2ï¼Ÿ" class="headerlink" title="ç°åœ¨ä¸ºä»€ä¹ˆæ¨èLog4j2ï¼Ÿ"></a>ç°åœ¨ä¸ºä»€ä¹ˆæ¨èLog4j2ï¼Ÿ</h3><p>Apache Log4j 2 æ˜¯ Log4j(1) çš„å‡çº§ç‰ˆï¼Œæ¯”å®ƒçš„ç¥–å…ˆ Log4j 1.xå’Œlogback æœ‰äº†å¾ˆå¤§çš„æ”¹è¿›ã€‚é™¤äº†å†…éƒ¨è®¾è®¡çš„è°ƒæ•´å¤–ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹çš„å¤§å‡çº§ï¼š</p><ul><li>æ›´ç®€åŒ–çš„é…ç½®</li><li>æ›´å¼ºå¤§çš„å‚æ•°æ ¼å¼åŒ–</li><li>æœ€å¤¸å¼ çš„å¼‚æ­¥æ€§èƒ½</li></ul><p>Log4j2 ä¸­ï¼Œåˆ†ä¸º API(log4j-apiï¼‰å’Œå®ç° (log4j-core) ä¸¤ä¸ªæ¨¡å—ã€‚API å’Œ slf4j æ˜¯ä¸€ä¸ªç±»å‹ï¼Œå±äºæ—¥å¿—æŠ½è±¡ &#x2F; é—¨é¢ï¼Œè€Œå®ç°éƒ¨åˆ†ï¼Œæ‰æ˜¯ Log4j 2 çš„æ ¸å¿ƒã€‚ <em>org.apache.logging.log4j Â» log4j-api</em> org.apache.logging.log4j Â» log4j-core</p><p>log4j2 åœ¨ç›®å‰ JAVA ä¸­çš„æ—¥å¿—æ¡†æ¶é‡Œï¼Œå¼‚æ­¥æ—¥å¿—çš„æ€§èƒ½æ˜¯æœ€é«˜çš„ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„å¯¹æ¯”å›¾ï¼š</p><p>![](data:image&#x2F;svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1472' height='780'></svg>)</p><p>qjzLPK</p><p>log4j2é‡‡ç”¨äº†å­—ç¬¦ä¸²å¤ç”¨ç­‰æ‰‹æ®µæ¥å®ç°é›¶GCæ¨¡å¼è¿è¡Œï¼Œå¦å¤–æä¾›äº†MemoryMappedFileAppenderå®ç°äº†æé«˜çš„IOæ€§èƒ½ï¼Œè€Œä¸”APIç›¸æ¯”slf4jï¼Œæœ‰æ›´ä¸°å¯Œçš„å‚æ•°æ ¼å¼åŒ–åŠŸèƒ½ã€‚</p><h3 id="æ€ä¹ˆä½¿ç”¨Log4j2ï¼Ÿ"><a href="#æ€ä¹ˆä½¿ç”¨Log4j2ï¼Ÿ" class="headerlink" title="æ€ä¹ˆä½¿ç”¨Log4j2ï¼Ÿ"></a>æ€ä¹ˆä½¿ç”¨Log4j2ï¼Ÿ</h3><p>è¯´äº†åŠå¤©ï¼Œé‚£æ€ä¹ˆå»ä½¿ç”¨Log4j2å‘¢ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»”ç»†ä»‹ç»ä¸€ä¸‹ã€‚</p><h3 id="å¸¸è§„ä½¿ç”¨æ­¥éª¤"><a href="#å¸¸è§„ä½¿ç”¨æ­¥éª¤" class="headerlink" title="å¸¸è§„ä½¿ç”¨æ­¥éª¤"></a>å¸¸è§„ä½¿ç”¨æ­¥éª¤</h3><p>ä¸‹é¢ä»¥Mavené…ç½®ä¸ºä¾‹è¿›è¡Œä»‹ç»ã€‚</p><ol><li>é¦–å…ˆéœ€è¦åŠ å…¥log4jçš„ä¾èµ–ï¼Œ<strong>æ³¨æ„2.17.1ä»¥ä¸‹çš„ç‰ˆæœ¬ä¼šæœ‰è¿œç¨‹ä»£ç æ‰§è¡Œçš„å®‰å…¨æ¼æ´ï¼Œå…·ä½“å‚è€ƒApacheå®˜æ–¹æ–‡æ¡£ï¼ˆ<a href="https://link.zhihu.com/?target=https://logging.apache.org/log4j/2.x/security.html">https://logging.apache.org/log4j/2.x/security.html</a>ï¼‰ã€‚æ¨èä½¿ç”¨æœ€æ–°çš„ç‰ˆæœ¬ã€‚</strong></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ol><li>é…ç½®å¥½log4j2.xmlé…ç½®æ–‡ä»¶ï¼Œå¹¶æ”¾åˆ°é¡¹ç›®çš„classpathé‡Œé¢ï¼Œä¸€èˆ¬ä¼šæ”¾åˆ°resourcesç›®å½•é‡Œé¢ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå‚è€ƒçš„é…ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨propertiesæ–‡ä»¶å’Œyamlæ–‡ä»¶æ¥è¿›è¡Œé…ç½®ã€‚</li></ol><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Appenders</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Console</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;%d</span></span></span><span class="hljs-template-variable">&#123;HH:mm:ss.SSS&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> [%t] %-5level %logger</span></span></span><span class="hljs-template-variable">&#123;36&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> - %msg%n&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Console</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Appenders</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Loggers</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.malaoshi&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;debug&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;error&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Loggers</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Configuration</span>&gt;</span></span><br></code></pre></td></tr></table></figure><ol><li>åœ¨ç¨‹åºä¸­æ‰“å°logã€‚ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æ¥æ‰“å°logå³å¯ã€‚</li></ol><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs smali">import org.apache.logging.log4j.<span class="hljs-class">LogManager;</span><br>import org.apache.logging.log4j.<span class="hljs-class">Logger;</span><br><span class="hljs-keyword"></span><br><span class="hljs-keyword">public</span> class HelloWorld &#123;<br><br>   <span class="hljs-keyword"> private</span><span class="hljs-keyword"> static</span><span class="hljs-keyword"> final</span> Logger logger = LogManager.getLogger(HelloWorld.class);<br><br>   <span class="hljs-keyword"> public</span><span class="hljs-keyword"> static</span> void main(String[] args) &#123;<br><br>        logger.debug(<span class="hljs-string">&quot;Hello from Log4j 2&quot;</span>);<br><br>        // in old days, we need to<span class="hljs-built_in"> check </span>the log level to increase performance<br>        /*if (logger.isDebugEnabled()) &#123;<br>            logger.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, getNumber());<br>        &#125;*/<br><br>        // with Java 8, we can do this, no need to<span class="hljs-built_in"> check </span>the log level<br>        logger.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, () -&gt; getNumber());<br><br>    &#125;<br><br>   <span class="hljs-keyword"> static</span><span class="hljs-built_in"> int </span>getNumber() &#123;<br>       <span class="hljs-built_in"> return </span>5;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">19</span>:<span class="hljs-number">12</span>:<span class="hljs-number">25.337</span> <span class="hljs-selector-attr">[main]</span> DEBUG com<span class="hljs-selector-class">.malaoshi</span><span class="hljs-selector-class">.HelloWorld</span> - Hello from Log4j <span class="hljs-number">2</span><br><span class="hljs-number">19</span>:<span class="hljs-number">12</span>:<span class="hljs-number">25.340</span> <span class="hljs-selector-attr">[main]</span> DEBUG com<span class="hljs-selector-class">.malaoshi</span><span class="hljs-selector-class">.HelloWorld</span> - <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶è¯¦è§£"><a href="#é…ç½®æ–‡ä»¶è¯¦è§£" class="headerlink" title="é…ç½®æ–‡ä»¶è¯¦è§£"></a>é…ç½®æ–‡ä»¶è¯¦è§£</h3><p>é¦–å…ˆç»™å¤§å®¶çœ‹ä¸€ä¸ªæ¯”è¾ƒå…¨é¢çš„é…ç½®æ–‡ä»¶ï¼Œå¯èƒ½çœ‹èµ·æ¥æ¯”è¾ƒå¤´å¤§ï¼Œä¸æ€¥æˆ‘åé¢ä¼šä¸€ç‚¹ç‚¹ä»”ç»†åˆ†æã€‚</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="language-xml"> <span class="hljs-comment">&lt;!--æ—¥å¿—çº§åˆ«ä»¥åŠä¼˜å…ˆçº§æ’åº: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span></span><br><span class="language-xml"> <span class="hljs-comment">&lt;!--Configurationåé¢çš„statusï¼Œè¿™ä¸ªç”¨äºè®¾ç½®log4j2è‡ªèº«å†…éƒ¨çš„ä¿¡æ¯è¾“å‡ºï¼Œå¯ä»¥ä¸è®¾ç½®ï¼Œå½“è®¾ç½®æˆtraceæ—¶ï¼Œä½ ä¼šçœ‹åˆ°log4j2å†…éƒ¨å„ç§è¯¦ç»†è¾“å‡º--&gt;</span></span><br><span class="language-xml"> <span class="hljs-comment">&lt;!--monitorIntervalï¼šLog4jèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹ä¿®æ”¹é…ç½® æ–‡ä»¶å’Œé‡æ–°é…ç½®æœ¬èº«ï¼Œè®¾ç½®é—´éš”ç§’æ•°--&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&quot;WARN&quot;</span> <span class="hljs-attr">monitorInterval</span>=<span class="hljs-string">&quot;30&quot;</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-comment">&lt;!--å…ˆå®šä¹‰æ‰€æœ‰çš„appender--&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">appenders</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-comment">&lt;!--è¿™ä¸ªè¾“å‡ºæ§åˆ¶å°çš„é…ç½®--&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;<span class="hljs-name">console</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Console&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-comment">&lt;!--è¾“å‡ºæ—¥å¿—çš„æ ¼å¼--&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d</span></span></span><span class="hljs-template-variable">&#123;HH:mm:ss:SSS&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">] [%p] - %l - %m%n&quot;</span>/&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;/<span class="hljs-name">console</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-comment">&lt;!--æ–‡ä»¶ä¼šæ‰“å°å‡ºæ‰€æœ‰ä¿¡æ¯ï¼Œè¿™ä¸ªlogæ¯æ¬¡è¿è¡Œç¨‹åºä¼šè‡ªåŠ¨æ¸…ç©ºï¼Œç”±appendå±æ€§å†³å®šï¼Œè¿™ä¸ªä¹ŸæŒºæœ‰ç”¨çš„ï¼Œé€‚åˆä¸´æ—¶æµ‹è¯•ç”¨--&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">File</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;log&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;log/test.log&quot;</span> <span class="hljs-attr">append</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;%d</span></span></span><span class="hljs-template-variable">&#123;HH:mm:ss.SSS&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> %-5level %class</span></span></span><span class="hljs-template-variable">&#123;36&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> %L %M - %msg%xEx%n&quot;</span>/&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-comment">&lt;!-- è¿™ä¸ªä¼šæ‰“å°å‡ºæ‰€æœ‰çš„infoåŠä»¥ä¸‹çº§åˆ«çš„ä¿¡æ¯ï¼Œæ¯æ¬¡å¤§å°è¶…è¿‡sizeï¼Œåˆ™è¿™sizeå¤§å°çš„æ—¥å¿—ä¼šè‡ªåŠ¨å­˜å…¥æŒ‰å¹´ä»½-æœˆä»½å»ºç«‹çš„æ–‡ä»¶å¤¹ä¸‹é¢å¹¶è¿›è¡Œå‹ç¼©ï¼Œä½œä¸ºå­˜æ¡£--&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RollingFileInfo&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;sys:user.home&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/logs/info.log&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">                      <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;sys:user.home&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/logs/$$</span></span></span><span class="hljs-template-variable">&#123;date:yyyy-MM&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/info-%d</span></span></span><span class="hljs-template-variable">&#123;yyyy-MM-dd&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">-%i.log&quot;</span>&gt;</span></span><br><span class="language-xml">             <span class="hljs-comment">&lt;!--æ§åˆ¶å°åªè¾“å‡ºlevelåŠä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼ˆonMatchï¼‰ï¼Œå…¶ä»–çš„ç›´æ¥æ‹’ç»ï¼ˆonMismatchï¼‰--&gt;</span>        </span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span> <span class="hljs-attr">onMatch</span>=<span class="hljs-string">&quot;ACCEPT&quot;</span> <span class="hljs-attr">onMismatch</span>=<span class="hljs-string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d</span></span></span><span class="hljs-template-variable">&#123;HH:mm:ss:SSS&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">] [%p] - %l - %m%n&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span></span><br><span class="language-xml">                 <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="language-xml">                 <span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;100 MB&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RollingFileWarn&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;sys:user.home&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/logs/warn.log&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">                      <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;sys:user.home&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/logs/$$</span></span></span><span class="hljs-template-variable">&#123;date:yyyy-MM&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/warn-%d</span></span></span><span class="hljs-template-variable">&#123;yyyy-MM-dd&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">-%i.log&quot;</span>&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;warn&quot;</span> <span class="hljs-attr">onMatch</span>=<span class="hljs-string">&quot;ACCEPT&quot;</span> <span class="hljs-attr">onMismatch</span>=<span class="hljs-string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d</span></span></span><span class="hljs-template-variable">&#123;HH:mm:ss:SSS&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">] [%p] - %l - %m%n&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span></span><br><span class="language-xml">                 <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="language-xml">                 <span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;100 MB&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-comment">&lt;!-- DefaultRolloverStrategyå±æ€§å¦‚ä¸è®¾ç½®ï¼Œåˆ™é»˜è®¤ä¸ºæœ€å¤šåŒä¸€æ–‡ä»¶å¤¹ä¸‹7ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œè®¾ç½®äº†20 --&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span> <span class="hljs-attr">max</span>=<span class="hljs-string">&quot;20&quot;</span>/&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RollingFileError&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;sys:user.home&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/logs/error.log&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">                      <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;sys:user.home&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/logs/$$</span></span></span><span class="hljs-template-variable">&#123;date:yyyy-MM&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/error-%d</span></span></span><span class="hljs-template-variable">&#123;yyyy-MM-dd&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">-%i.log&quot;</span>&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;error&quot;</span> <span class="hljs-attr">onMatch</span>=<span class="hljs-string">&quot;ACCEPT&quot;</span> <span class="hljs-attr">onMismatch</span>=<span class="hljs-string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d</span></span></span><span class="hljs-template-variable">&#123;HH:mm:ss:SSS&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">] [%p] - %l - %m%n&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span></span><br><span class="language-xml">                 <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="language-xml">                 <span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;100 MB&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">appenders</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-comment">&lt;!--ç„¶åå®šä¹‰loggerï¼Œåªæœ‰å®šä¹‰äº†loggerå¹¶å¼•å…¥çš„appenderï¼Œappenderæ‰ä¼šç”Ÿæ•ˆ--&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">loggers</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-comment">&lt;!--è¿‡æ»¤æ‰springå’Œmybatisçš„ä¸€äº›æ— ç”¨çš„DEBUGä¿¡æ¯--&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.springframework&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.mybatis&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;all&quot;</span>&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;RollingFileInfo&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;RollingFileWarn&quot;</span>/&gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;RollingFileError&quot;</span>/&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">loggers</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>ä¸‹é¢ä¸ºå¤§å®¶ä»”ç»†è§£æè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œ</p><p><strong>1. æ ¹èŠ‚ç‚¹</strong></p><blockquote><p>Configurationæœ‰ä¸¤ä¸ªå±æ€§:statuså’Œmonitorinterval,æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹:Appenderså’ŒLoggers(è¡¨æ˜å¯ä»¥å®šä¹‰å¤šä¸ªAppenderå’ŒLogger)ã€‚</p></blockquote><ul><li>statusç”¨æ¥æŒ‡å®šlog4jæœ¬èº«çš„æ‰“å°æ—¥å¿—çš„çº§åˆ«.</li><li>monitorintervalç”¨äºæŒ‡å®šlog4jè‡ªåŠ¨é‡æ–°é…ç½®çš„ç›‘æµ‹é—´éš”æ—¶é—´ï¼Œå•ä½æ˜¯s,æœ€å°æ˜¯5s.</li></ul><p><strong>2. AppendersèŠ‚ç‚¹</strong></p><blockquote><p>AppendersèŠ‚ç‚¹ï¼Œå¸¸è§çš„å­èŠ‚ç‚¹æœ‰ï¼šConsoleã€RollingFileã€Fileã€‚</p></blockquote><p><strong>ConsoleèŠ‚ç‚¹</strong>ç”¨æ¥å®šä¹‰è¾“å‡ºåˆ°æ§åˆ¶å°çš„Appenderã€‚</p><ul><li>nameï¼šæŒ‡å®šAppenderçš„åå­—ã€‚</li><li>targetï¼šSYSTEM_OUT æˆ– SYSTEM_ERRï¼Œä¸€èˆ¬åªè®¾ç½®é»˜è®¤ï¼šSYSTEM_OUTã€‚</li><li>PatternLayoutï¼šè¾“å‡ºæ ¼å¼ï¼Œä¸è®¾ç½®é»˜è®¤ä¸º:%m%nã€‚</li></ul><p><strong>FileèŠ‚ç‚¹</strong>ç”¨æ¥å®šä¹‰è¾“å‡ºåˆ°æŒ‡å®šä½ç½®çš„æ–‡ä»¶çš„Appenderã€‚</p><ul><li>nameï¼šæŒ‡å®šAppenderçš„åå­—ã€‚</li><li>fileNameï¼šæŒ‡å®šè¾“å‡ºæ—¥å¿—çš„ç›®çš„æ–‡ä»¶å¸¦å…¨è·¯å¾„çš„æ–‡ä»¶åã€‚</li><li>PatternLayoutï¼šè¾“å‡ºæ ¼å¼ï¼Œä¸è®¾ç½®é»˜è®¤ä¸º:%m%nã€‚</li></ul><p><strong>RollingFileèŠ‚ç‚¹</strong>ç”¨æ¥å®šä¹‰è¶…è¿‡æŒ‡å®šå¤§å°è‡ªåŠ¨åˆ é™¤æ—§çš„åˆ›å»ºæ–°çš„çš„Appenderã€‚</p><ul><li><p>nameï¼šæŒ‡å®šAppenderçš„åå­—ã€‚</p></li><li><p>fileNameï¼šæŒ‡å®šè¾“å‡ºæ—¥å¿—çš„ç›®çš„æ–‡ä»¶å¸¦å…¨è·¯å¾„çš„æ–‡ä»¶åã€‚</p></li><li><p>PatternLayoutï¼šè¾“å‡ºæ ¼å¼ï¼Œä¸è®¾ç½®é»˜è®¤ä¸º:%m%nã€‚</p></li><li><p>filePatternï¼šæŒ‡å®šæ–°å»ºæ—¥å¿—æ–‡ä»¶çš„åç§°æ ¼å¼ã€‚</p></li><li><p>Policiesæ˜¯æŒ‡å®šæ»šåŠ¨æ—¥å¿—çš„ç­–ç•¥ï¼Œå°±æ˜¯ä»€ä¹ˆæ—¶å€™è¿›è¡Œæ–°å»ºæ—¥å¿—æ–‡ä»¶è¾“å‡ºæ—¥å¿—ã€‚<br>TimeBasedTriggeringPolicyï¼šPolicieså­èŠ‚ç‚¹ï¼ŒåŸºäºæ—¶é—´çš„æ»šåŠ¨ç­–ç•¥ï¼Œintervalå±æ€§ç”¨æ¥æŒ‡å®šå¤šä¹…æ»šåŠ¨ä¸€æ¬¡ï¼Œé»˜è®¤æ˜¯1 hourã€‚modulate&#x3D;trueç”¨æ¥è°ƒæ•´æ—¶é—´ï¼šæ¯”å¦‚ç°åœ¨æ˜¯æ—©ä¸Š3amï¼Œintervalæ˜¯4ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡æ»šåŠ¨æ˜¯åœ¨4amï¼Œæ¥ç€æ˜¯8amï¼Œ12amâ€¦è€Œä¸æ˜¯7amã€‚ SizeBasedTriggeringPolicyï¼šPolicieså­èŠ‚ç‚¹ï¼ŒåŸºäºæŒ‡å®šæ–‡ä»¶å¤§å°çš„æ»šåŠ¨ç­–ç•¥ï¼Œsizeå±æ€§ç”¨æ¥å®šä¹‰æ¯ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°ã€‚  </p></li><li><p>DefaultRolloverStrategyï¼šç”¨æ¥æŒ‡å®šåŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹æœ€å¤šæœ‰å‡ ä¸ªæ—¥å¿—æ–‡ä»¶æ—¶å¼€å§‹åˆ é™¤æœ€æ—§çš„ï¼Œåˆ›å»ºæ–°çš„(é€šè¿‡maxå±æ€§)ã€‚</p></li></ul><p><strong>3. Loggers</strong></p><p>LoggersèŠ‚ç‚¹ï¼Œå¸¸è§å­èŠ‚ç‚¹æœ‰ï¼šRootå’ŒLoggerã€‚</p><p><strong>RootèŠ‚ç‚¹</strong>ç”¨æ¥æŒ‡å®šé¡¹ç›®çš„æ ¹æ—¥å¿—ï¼Œå¦‚æœæ²¡æœ‰å•ç‹¬æŒ‡å®šLoggerï¼Œé‚£ä¹ˆå°±ä¼šé»˜è®¤ä½¿ç”¨è¯¥Rootæ—¥å¿—è¾“å‡º</p><ul><li>levelï¼šæ—¥å¿—è¾“å‡ºçº§åˆ«ï¼Œå…±æœ‰8ä¸ªçº§åˆ«ï¼ŒæŒ‰ç…§ä»ä½åˆ°é«˜ä¸ºï¼šAll &lt; Trace &lt; Debug &lt; Info &lt; Warn &lt; Error &lt; Fatal &lt; OFFã€‚</li><li>AppenderRefï¼šRootçš„å­èŠ‚ç‚¹ï¼Œç”¨æ¥æŒ‡å®šè¯¥æ—¥å¿—è¾“å‡ºåˆ°å“ªä¸ªAppenderã€‚</li></ul><p><strong>LoggerèŠ‚ç‚¹</strong>ç”¨æ¥å•ç‹¬æŒ‡å®šæ—¥å¿—çš„å½¢å¼ï¼Œæ¯”å¦‚è¦ä¸ºæŒ‡å®šåŒ…ä¸‹çš„classæŒ‡å®šä¸åŒçš„æ—¥å¿—çº§åˆ«ç­‰ã€‚</p><ul><li>levelï¼šæ—¥å¿—è¾“å‡ºçº§åˆ«ï¼Œå…±æœ‰8ä¸ªçº§åˆ«ï¼ŒæŒ‰ç…§ä»ä½åˆ°é«˜ä¸ºï¼šAll &lt; Trace &lt; Debug &lt; Info &lt; Warn &lt; Error &lt; Fatal &lt; OFFã€‚</li><li>nameï¼šç”¨æ¥æŒ‡å®šè¯¥Loggeræ‰€é€‚ç”¨çš„ç±»æˆ–è€…ç±»æ‰€åœ¨çš„åŒ…å…¨è·¯å¾„,ç»§æ‰¿è‡ªRootèŠ‚ç‚¹ã€‚</li><li>AppenderRefï¼šLoggerçš„å­èŠ‚ç‚¹ï¼Œç”¨æ¥æŒ‡å®šè¯¥æ—¥å¿—è¾“å‡ºåˆ°å“ªä¸ªAppenderï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå°±ä¼šé»˜è®¤ç»§æ‰¿è‡ªRoot.å¦‚æœæŒ‡å®šäº†ï¼Œé‚£ä¹ˆä¼šåœ¨æŒ‡å®šçš„è¿™ä¸ªAppenderå’ŒRootçš„Appenderä¸­éƒ½ä¼šè¾“å‡ºï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥è®¾ç½®Loggerçš„additivity&#x3D;â€falseâ€åªåœ¨è‡ªå®šä¹‰çš„Appenderä¸­è¿›è¡Œè¾“å‡ºã€‚</li></ul><p><strong>4. æ—¥å¿—Level</strong></p><p>å…±æœ‰8ä¸ªçº§åˆ«ï¼ŒæŒ‰ç…§ä»ä½åˆ°é«˜ä¸ºï¼šAll &lt; Trace &lt; Debug &lt; Info &lt; Warn &lt; Error &lt; Fatal &lt; OFFã€‚</p><ul><li>All:æœ€ä½ç­‰çº§çš„ï¼Œç”¨äºæ‰“å¼€æ‰€æœ‰æ—¥å¿—è®°å½•ã€‚</li><li>Trace:æ˜¯è¿½è¸ªï¼Œå°±æ˜¯ç¨‹åºæ¨è¿›ä»¥ä¸‹ï¼Œä½ å°±å¯ä»¥å†™ä¸ªtraceè¾“å‡ºï¼Œæ‰€ä»¥traceåº”è¯¥ä¼šç‰¹åˆ«å¤šï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æœ€ä½æ—¥å¿—çº§åˆ«ä¸è®©ä»–è¾“å‡ºã€‚</li><li>Debug:æŒ‡å‡ºç»†ç²’åº¦ä¿¡æ¯äº‹ä»¶å¯¹è°ƒè¯•åº”ç”¨ç¨‹åºæ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</li><li>Info:æ¶ˆæ¯åœ¨ç²—ç²’åº¦çº§åˆ«ä¸Šçªå‡ºå¼ºè°ƒåº”ç”¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ã€‚</li><li>Warn:è¾“å‡ºè­¦å‘ŠåŠwarnä»¥ä¸‹çº§åˆ«çš„æ—¥å¿—ã€‚</li><li>Error:è¾“å‡ºé”™è¯¯ä¿¡æ¯æ—¥å¿—ã€‚</li><li>Fatal:è¾“å‡ºæ¯ä¸ªä¸¥é‡çš„é”™è¯¯äº‹ä»¶å°†ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºçš„é€€å‡ºçš„æ—¥å¿—ã€‚</li><li>OFF:æœ€é«˜ç­‰çº§çš„ï¼Œç”¨äºå…³é—­æ‰€æœ‰æ—¥å¿—è®°å½•ã€‚</li></ul><p>ç¨‹åºä¼šæ‰“å°é«˜äºæˆ–ç­‰äºæ‰€è®¾ç½®çº§åˆ«çš„æ—¥å¿—ï¼Œè®¾ç½®çš„æ—¥å¿—ç­‰çº§è¶Šé«˜ï¼Œæ‰“å°å‡ºæ¥çš„æ—¥å¿—å°±è¶Šå°‘ã€‚</p><h3 id="å‚è€ƒèŒƒä¾‹"><a href="#å‚è€ƒèŒƒä¾‹" class="headerlink" title="å‚è€ƒèŒƒä¾‹"></a>å‚è€ƒèŒƒä¾‹</h3><p>è¿™éƒ¨åˆ†ç»™å¤§å®¶æä¾›å‡ ä¸ªå¸¸ç”¨çš„é…ç½®ï¼Œç›´æ¥æ”¾åˆ°é¡¹ç›®é‡Œé¢æ”¹ä¸€ä¸‹åŒ…åå°±å¯ä»¥ç”¨ã€‚</p><p><strong>1. è¾“å‡ºæ—¥å¿—åˆ°Console</strong></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Appenders</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Console</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;%d</span></span></span><span class="hljs-template-variable">&#123;HH:mm:ss.SSS&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> [%t] %-5level %logger</span></span></span><span class="hljs-template-variable">&#123;36&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> - %msg%n&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Console</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Appenders</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Loggers</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-comment">&lt;!-- avoid duplicated logs with additivity=false --&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.mkyong&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;debug&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;error&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Loggers</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Configuration</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p><strong>2. è¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶</strong></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Appenders</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Console</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;%d</span></span></span><span class="hljs-template-variable">&#123;HH:mm:ss.SSS&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> [%t] %-5level %logger</span></span></span><span class="hljs-template-variable">&#123;36&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> - %msg%n&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Console</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">File</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LogToFile&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;logs/app.log&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d %p %c</span><span class="hljs-template-variable">&#123;1.&#125;</span><span class="language-xml"> [%t] %m%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">PatternLayout</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Appenders</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Loggers</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.malaoshi&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;debug&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;LogToFile&quot;</span>/&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.springframework.boot&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;error&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;error&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;LogToFile&quot;</span>/&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Loggers</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Configuration</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p><strong>3. è¾“å‡ºåˆ°æ–‡ä»¶å¹¶æ»šåŠ¨ç”Ÿæˆæ–°çš„æ—¥å¿—æ–‡ä»¶</strong></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Appenders</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Console</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;%d</span></span></span><span class="hljs-template-variable">&#123;HH:mm:ss.SSS&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> [%t] %-5level %logger</span></span></span><span class="hljs-template-variable">&#123;36&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> - %msg%n&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Console</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LogToRollingFile&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;logs/app.log&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">                    <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;logs/$$</span></span></span><span class="hljs-template-variable">&#123;date:yyyy-MM&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/app-%d</span></span></span><span class="hljs-template-variable">&#123;MM-dd-yyyy&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">-%i.log.gz&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d %p %c</span><span class="hljs-template-variable">&#123;1.&#125;</span><span class="language-xml"> [%t] %m%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">PatternLayout</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span> /&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;10 MB&quot;</span>/&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Appenders</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Loggers</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-comment">&lt;!-- avoid duplicated logs with additivity=false --&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.malaoshi&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;debug&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;LogToRollingFile&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;error&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;LogToConsole&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Loggers</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Configuration</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯æ‰€æœ‰çš„å†…å®¹ï¼Œçœ‹å®Œä¸‹æ¥å°±ä¼šææ¸…æ¥šå„ç§logæ¡†æ¶çš„å…³ç³»ï¼Œä»¥åŠå¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿™äº›logæ¡†æ¶ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>log4j</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AMQPå’ŒJMSçš„åŒºåˆ«</title>
    <link href="/article/59afdada.html"/>
    <url>/article/59afdada.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><p><strong>1. é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®:</strong></p><p>å®ƒæ˜¯ä¸€ç§ç”¨äºåº”ç”¨ç¨‹åºä¹‹é—´é€šä¿¡çš„åè®®ã€‚å®ƒæ˜¯ä¸€ç§è½»é‡çº§åè®®ï¼Œæ”¯æŒåº”ç”¨ç¨‹åºè¿›è¡Œæ•°æ®ä¼ è¾“ã€‚è¯¥åè®®å…·æœ‰å¯æ‰©å±•æ€§å’Œæ¨¡å—åŒ–çš„ç‰¹ç‚¹ã€‚</p><p><strong>2. Javaæ¶ˆæ¯æœåŠ¡(JMS):</strong></p><p>å®ƒæ˜¯ä¸€ç§æ”¯æŒç½‘ç»œä¸­è®¡ç®—æœºé€šä¿¡çš„åº”ç”¨ç¨‹åºæ¥å£(API)ã€‚å®ƒæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„APIï¼Œç”¨äºæ¥æ”¶é€šä¿¡è¿‡ç¨‹ä¸­ç”Ÿæˆçš„æ¶ˆæ¯ã€‚</p><p>AMQPå’ŒJMSçš„åŒºåˆ«:</p><table><thead><tr><th>æ¯”è¾ƒåŸºç¡€</th><th>AMQP</th><th>JMS</th></tr></thead><tbody><tr><td>ç¼©å†™</td><td>é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®(Advanced Message Queuing Protocol)ã€‚</td><td>Javaæ¶ˆæ¯æœåŠ¡(<a href="https://geek-docs.com/java/java-top-tutorials/1001100_java_index.html" title="Java æ•™ç¨‹">Java</a> Message Service)ã€‚</td></tr><tr><td>å¼€å‘å•†</td><td>å®ƒç”±æ‘©æ ¹å¤§é€šå¼€å‘ã€‚</td><td>å®ƒæ˜¯ç”±å¤ªé˜³å¾®ç³»ç»Ÿå…¬å¸å¼€å‘çš„ã€‚</td></tr><tr><td>å·¥ä½œæ–¹å¼</td><td>æ‰€æœ‰å…¼å®¹AMQPçš„å®¢æˆ·ç«¯éƒ½å¯ä»¥ç›¸äº’é€šä¿¡ã€‚</td><td>åº”ç”¨ç¨‹åºåº”è¯¥ä½¿ç”¨JMS APIè¿›è¡Œé€šä¿¡ã€‚</td></tr><tr><td>æ¶ˆæ¯æ¨¡å‹ä½¿ç”¨</td><td>å®ƒä½¿ç”¨Direct, Fanout, Topicå’Œheaderã€‚</td><td>å®ƒä½¿ç”¨å‘å¸ƒ&#x2F;è®¢é˜…å’ŒP2P(ç‚¹å¯¹ç‚¹)ã€‚</td></tr><tr><td>æŠ½è±¡</td><td>amqpæ˜¯ä¸€ç§åè®®ã€‚</td><td>JMSæ˜¯ä¸€ä¸ªæ ‡å‡†APIã€‚</td></tr><tr><td>æ•°æ®ç±»å‹</td><td>amqpä½¿ç”¨çš„æ•°æ®ç±»å‹åªä½¿ç”¨å¹¶æ”¯æŒäºŒè¿›åˆ¶æ•°æ®ç±»å‹ã€‚</td><td>JMSæ”¯æŒäº”ç§æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«ä¸ºMapMessageã€ObjectMessageã€Text messageã€StreamMessageå’ŒBytesMessageã€‚</td></tr><tr><td>å®‰å…¨</td><td>SASL (Simple Authentication and Security Layer)æ”¯æŒå®‰å…¨ã€‚</td><td>æ²¡æœ‰æä¾›å®‰å…¨æ€§ï¼Œå®ƒä¾èµ–äºJMSæä¾›ç¨‹åºã€‚</td></tr><tr><td>æ•°æ®æµ</td><td>ç”±ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œç„¶åå°†æ¶ˆæ¯æ’é˜Ÿã€‚</td><td>å®ƒç”±ç”Ÿäº§è€…ç®¡ç†ï¼Œå¹¶ç›´æ¥å‘é€åˆ°ä¸»é¢˜ã€‚</td></tr><tr><td>æŠ€æœ¯çµæ´»æ€§</td><td>å®ƒåœ¨è®¸å¤šæŠ€æœ¯ä¸Šéƒ½æ˜¯çµæ´»çš„ã€‚</td><td>å®ƒä¸æ˜¯ä¸“é—¨ä¸ºJavaå¼€å‘çš„æŠ€æœ¯çµæ´»æ€§ã€‚</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>activemq</tag>
      
      <tag>Rabbitmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>rabbitmqåè¯è§£é‡Š</title>
    <link href="/article/7ee41741.html"/>
    <url>/article/7ee41741.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li>Broker:     å¯ä»¥ç†è§£ä¸ºæ¯ä¸ªæœåŠ¡èŠ‚ç‚¹è´Ÿè´£æ¥å—æ¶ˆæ¯ï¼Œä¼ é€’æ¶ˆæ¯</li><li>Vhost:       rabbitmqç”¨æ¥å®ç°å¤šç§Ÿæˆ·çš„ä¸€ç§æ–¹å¼ï¼Œä¸€ä¸ªbrokerä¸‹å¯ä»¥æœ‰å¤šä¸ªvhostï¼Œæ¯ä¸ªvhostç›¸å½“äºä¸€ä¸ªè™šæ‹Ÿçš„æœåŠ¡èŠ‚ç‚¹</li><li>Exchange:   æ¥å—ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®Bindingè§„åˆ™å°†æ¶ˆæ¯è·¯ç”±ç»™æœåŠ¡å™¨ä¸­çš„é˜Ÿåˆ—ã€‚ExchangeTypeå†³å®šäº†Exchangeè·¯ç”±æ¶ˆæ¯çš„è¡Œä¸ºã€‚<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">RabbitMQ å¸¸ç”¨çš„ Exchange <span class="hljs-keyword">Type</span> <span class="hljs-type">æœ‰ </span>fanoutã€directã€topicã€headers è¿™å››ç§ï¼ˆAMQPè§„èŒƒé‡Œè¿˜æåˆ°ä¸¤ç§ Exchange <span class="hljs-keyword">Type</span>ï¼Œåˆ†åˆ«ä¸º system ä¸è‡ªå®šä¹‰ï¼Œè¿™é‡Œä¸äºˆä»¥æè¿°<br></code></pre></td></tr></table></figure></li><li>Queue: è´Ÿè´£å­˜å‚¨æ¶ˆæ¯ï¼Œä¸€ä¸ªExchangeå¯ä»¥ç»‘å®šå¤šä¸ªQueue</li><li>RoutingKey:     ç”Ÿäº§è€…é€šè¿‡RoutingKeyå°†Queueå’ŒExchangeç»‘å®šåœ¨ä¸€èµ·</li><li>BingdingKey:    æ ¹æ®Bingdingkeyå’ŒExchangeType ç»„åˆè§„åˆ™åŒ¹é…RoutingKeyï¼Œå°†ç¬¦åˆè§„åˆ™çš„æ¶ˆæ¯è½¬å‘åˆ°é˜Ÿåˆ—ä¸­ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Rabbitmq</tag>
      
      <tag>excalidraw</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>replicaof  å’Œ slaveofåŒºåˆ«</title>
    <link href="/article/939d7320.html"/>
    <url>/article/939d7320.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /><h3 id="SLAVEOF-å‘½ä»¤"><a href="#SLAVEOF-å‘½ä»¤" class="headerlink" title="SLAVEOF å‘½ä»¤"></a>SLAVEOF å‘½ä»¤</h3><ul><li><code>SLAVEOF</code> æ˜¯æ—©æœŸç‰ˆæœ¬çš„ Redis ä¸­ä½¿ç”¨çš„å‘½ä»¤ï¼Œç”¨äºè®¾ç½®å½“å‰æ•°æ®åº“æœåŠ¡å™¨ä¸ºå¦ä¸€ä¸ªæœåŠ¡å™¨çš„ä»å±æœåŠ¡å™¨ã€‚</li><li>é€šè¿‡æ‰§è¡Œ <code>SLAVEOF host port</code> å‘½ä»¤ï¼Œå¯ä»¥å°†å½“å‰æœåŠ¡å™¨è®¾ç½®ä¸ºæŒ‡å®šåœ°å€å’Œç«¯å£ä¸ŠæœåŠ¡å™¨çš„ä»å±æœåŠ¡å™¨ã€‚</li><li>å¦‚æœæƒ³è¦å–æ¶ˆä»å±çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ <code>SLAVEOF NO ONE</code> å‘½ä»¤ã€‚</li></ul><h3 id="REPLICAOF-å‘½ä»¤"><a href="#REPLICAOF-å‘½ä»¤" class="headerlink" title="REPLICAOF å‘½ä»¤"></a>REPLICAOF å‘½ä»¤</h3><ul><li><code>REPLICAOF</code> å‘½ä»¤åœ¨ Redis 5.0 ç‰ˆæœ¬ä¸­å¼•å…¥ï¼Œä½œä¸º <code>SLAVEOF</code> å‘½ä»¤çš„ä¸€ä¸ªåˆ«åï¼Œç”¨äºå¼ºè°ƒ Redis çš„å¤åˆ¶åŠŸèƒ½æ›´å€¾å‘äºæ•°æ®çš„é«˜å¯ç”¨æ€§å’Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸»ä»å¤åˆ¶çš„ç®€å•å…³ç³»ã€‚</li><li><code>REPLICAOF</code> å‘½ä»¤çš„ç”¨æ³•ä¸ <code>SLAVEOF</code> å®Œå…¨ç›¸åŒã€‚ä½¿ç”¨ <code>REPLICAOF host port</code> å¯ä»¥è®¾ç½®ä»å±å…³ç³»ï¼Œä½¿ç”¨ <code>REPLICAOF NO ONE</code> å¯ä»¥å–æ¶ˆä»å±å…³ç³»ã€‚</li><li>å¼•å…¥ <code>REPLICAOF</code> çš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†æ›´å‡†ç¡®åœ°æè¿° Redis åœ¨å¤åˆ¶å’Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è§’è‰²ï¼Œé¿å…â€œä¸»ä»â€è¿™ç§å¯èƒ½å…·æœ‰æ•æ„Ÿå«ä¹‰çš„æœ¯è¯­ã€‚</li></ul><h3 id="åŒºåˆ«å’Œé€‰æ‹©"><a href="#åŒºåˆ«å’Œé€‰æ‹©" class="headerlink" title="åŒºåˆ«å’Œé€‰æ‹©"></a>åŒºåˆ«å’Œé€‰æ‹©</h3><ul><li>åŠŸèƒ½ä¸Šï¼Œ<code>REPLICAOF</code> å’Œ <code>SLAVEOF</code> ä¹‹é—´æ²¡æœ‰å·®å¼‚ï¼Œä¸¤è€…éƒ½å¯ä»¥ç”¨æ¥è®¾ç½® Redis çš„å¤åˆ¶åŠŸèƒ½ã€‚</li><li>ä»å‘½åä¸Šè®²ï¼Œ<code>REPLICAOF</code> æ›´èƒ½åæ˜  Redis åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è§’è‰²ï¼Œè€Œ <code>SLAVEOF</code> åˆ™æ›´å¤šåœ°ä½“ç°äº†ä¼ ç»Ÿçš„ä¸»ä»å¤åˆ¶å…³ç³»ã€‚</li><li>å¯¹äºæ–°é¡¹ç›®æˆ–è€…ä½¿ç”¨ Redis 5.0 åŠä»¥ä¸Šç‰ˆæœ¬çš„ç”¨æˆ·ï¼Œæ¨èä½¿ç”¨ <code>REPLICAOF</code></li></ul>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>try-with-resourcesä½¿ç”¨æŒ‡å—</title>
    <link href="/article/9148af35.html"/>
    <url>/article/9148af35.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>Java 7 ä¸­å¼•å…¥çš„å¯¹èµ„æºÂ <em>try-with-resources</em>Â çš„æ”¯æŒå…è®¸æˆ‘ä»¬å£°æ˜è¦åœ¨Â <em>try</em>Â å—ä¸­ä½¿ç”¨çš„èµ„æºï¼Œå¹¶ä¿è¯èµ„æºå°†åœ¨è¯¥å—æ‰§è¡Œåå…³é—­ã€‚</p><p>å£°æ˜çš„èµ„æºéœ€è¦å®ç°_è‡ªåŠ¨å…³é—­æ¥å£_ã€‚</p><h2 id="2-ä½¿ç”¨-èµ„æºTryä»£ç å—"><a href="#2-ä½¿ç”¨-èµ„æºTryä»£ç å—" class="headerlink" title="2. ä½¿ç”¨_èµ„æºTryä»£ç å—_"></a>2. ä½¿ç”¨_èµ„æºTryä»£ç å—_</h2><p>ç®€è€Œè¨€ä¹‹ï¼Œè¦è‡ªåŠ¨å…³é—­ï¼Œå¿…é¡»åœ¨Â <em>try</em>Â ä¸­å£°æ˜å’Œåˆå§‹åŒ–èµ„æºï¼š</p><p>try (PrintWriter writer &#x3D; new PrintWriter(new File(â€œtest.txtâ€))) {<br>    writer.println(â€œHello Worldâ€);<br>}</p><h2 id="3-ç”¨-èµ„æºçš„try-æ›¿æ¢-try-finally"><a href="#3-ç”¨-èµ„æºçš„try-æ›¿æ¢-try-finally" class="headerlink" title="3. ç”¨_èµ„æºçš„try_æ›¿æ¢_try-_finally"></a>3. ç”¨_èµ„æºçš„try_æ›¿æ¢_try-_finally</h2><p>ä½¿ç”¨æ–°çš„â€œtry_èµ„æº_â€åŠŸèƒ½çš„ç®€å•è€Œæ˜æ˜¾çš„æ–¹æ³•æ˜¯æ›¿æ¢ä¼ ç»Ÿçš„_å†—é•¿çš„â€œtry-catch-finally_â€å—ã€‚</p><p>è®©æˆ‘ä»¬æ¯”è¾ƒä»¥ä¸‹ä»£ç ç¤ºä¾‹ã€‚</p><p>ç¬¬ä¸€ä¸ªæ˜¯å…¸å‹çš„try-_catch-finally_å—ï¼š</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>Scanner scanner &#x3D; null;<br>try {<br>    scanner = new Scanner(new File(â€œtest.txtâ€));<br>    while (scanner.hasNext()) {<br>        System.out.println(scanner.nextLine());<br>    }<br>} catch (FileNotFoundException e) {<br>    e.printStackTrace();<br>} finally {<br>    if (scanner !&#x3D; null) {<br>        scanner.close();<br>    }<br>}</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>è¿™æ˜¯ä½¿ç”¨_èµ„æºtry_çš„æ–°çš„è¶…çº§ç®€æ´è§£å†³æ–¹æ¡ˆï¼š</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>try (Scanner scanner &#x3D; new Scanner(new File(â€œtest.txtâ€))) {<br>    while (scanner.hasNext()) {<br>        System.out.println(scanner.nextLine());<br>    }<br>} catch (FileNotFoundException fnfe) {<br>    fnfe.printStackTrace();<br>}</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>ä¸‹é¢æ˜¯è¿›ä¸€æ­¥æ¢ç´¢_æ‰«æç¨‹åº_ç±»çš„ä½ç½®ã€‚</p><h2 id="4-ä½¿ç”¨-å¤šä¸ªèµ„æºt-ry-with-resources-å—"><a href="#4-ä½¿ç”¨-å¤šä¸ªèµ„æºt-ry-with-resources-å—" class="headerlink" title="4.Â ä½¿ç”¨_å¤šä¸ªèµ„æºt_ry-with-resourcesÂ å—"></a>4.Â <em>ä½¿ç”¨_å¤šä¸ªèµ„æºt_ry-with-resources</em>Â å—</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨Â <em>try-with-resources</em>Â å—ä¸­å£°æ˜å¤šä¸ªèµ„æºï¼Œæ–¹æ³•æ˜¯ç”¨åˆ†å·åˆ†éš”å®ƒä»¬ï¼š</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>try (Scanner scanner &#x3D; new Scanner(new File(â€œtestRead.txtâ€));<br>    PrintWriter writer = new PrintWriter(new File(â€œtestWrite.txtâ€))) {<br>    while (scanner.hasNext()) {<br>    writer.print(scanner.nextLine());<br>    }<br>}</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><h2 id="5-å…·æœ‰è‡ªåŠ¨å…³é—­åŠŸèƒ½çš„-è‡ªå®šä¹‰èµ„æº"><a href="#5-å…·æœ‰è‡ªåŠ¨å…³é—­åŠŸèƒ½çš„-è‡ªå®šä¹‰èµ„æº" class="headerlink" title="5.Â _å…·æœ‰è‡ªåŠ¨å…³é—­åŠŸèƒ½çš„_è‡ªå®šä¹‰èµ„æº"></a>5.Â _å…·æœ‰è‡ªåŠ¨å…³é—­åŠŸèƒ½çš„_è‡ªå®šä¹‰èµ„æº</h2><p>è‹¥è¦æ„é€ å°†ç”±Â <em>try-with-resources</em>Â å—æ­£ç¡®å¤„ç†çš„è‡ªå®šä¹‰èµ„æºï¼Œè¯¥ç±»åº”å®ç° Closeable æˆ–Â <em>AutoCloseable</em>Â æ¥å£å¹¶é‡å†™Â <em>close</em>Â æ–¹æ³•ï¼š</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>public class MyResource implements AutoCloseable {<br>    @Override<br>    public void close() throws Exception {<br>        System.out.println(â€œClosed MyResourceâ€);<br>    }<br>}</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><h2 id="6-èµ„æºå…³é—­é¡ºåº"><a href="#6-èµ„æºå…³é—­é¡ºåº" class="headerlink" title="6. èµ„æºå…³é—­é¡ºåº"></a>6. èµ„æºå…³é—­é¡ºåº</h2><p>é¦–å…ˆå®šä¹‰&#x2F;è·å–çš„èµ„æºå°†æœ€åå…³é—­ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ­¤è¡Œä¸ºçš„ç¤ºä¾‹ï¼š</p><p>èµ„æº 1ï¼š</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>public class AutoCloseableResourcesFirst implements AutoCloseable {</p><pre><code class="hljs">public AutoCloseableResourcesFirst() &#123;    System.out.println(&quot;Constructor -&gt; AutoCloseableResources\_First&quot;);&#125;public void doSomething() &#123;    System.out.println(&quot;Something -&gt; AutoCloseableResources\_First&quot;);&#125;@Overridepublic void close() throws Exception &#123;    System.out.println(&quot;Closed AutoCloseableResources\_First&quot;);&#125;</code></pre><p>}</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>èµ„æº 2ï¼š</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>public class AutoCloseableResourcesSecond implements AutoCloseable {</p><pre><code class="hljs">public AutoCloseableResourcesSecond() &#123;    System.out.println(&quot;Constructor -&gt; AutoCloseableResources\_Second&quot;);&#125;public void doSomething() &#123;    System.out.println(&quot;Something -&gt; AutoCloseableResources\_Second&quot;);&#125;@Overridepublic void close() throws Exception &#123;    System.out.println(&quot;Closed AutoCloseableResources\_Second&quot;);&#125;</code></pre><p>}</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>ä½¿ç”¨ï¼š</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>private void orderOfClosingResources() throws Exception {<br>    try (AutoCloseableResourcesFirst af &#x3D; new AutoCloseableResourcesFirst();<br>        AutoCloseableResourcesSecond as = new AutoCloseableResourcesSecond()) {</p><pre><code class="hljs">    af.doSomething();    as.doSomething();&#125;</code></pre><p>}</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>è¾“å‡ºï¼š</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>Constructor -&gt; AutoCloseableResources_First<br>Constructor -&gt; AutoCloseableResources_Second<br>Something-&gt; AutoCloseableResources_First<br>Something-&gt; AutoCloseableResources_Second<br>Closed AutoCloseableResources_Second<br>Closed AutoCloseableResources_First</p><p><a href="javascript:void(0);" title="å¤åˆ¶ä»£ç "><img src="//assets.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><h2 id="7-catch-å’Œ-finally"><a href="#7-catch-å’Œ-finally" class="headerlink" title="7.catch__å’Œ_finally_"></a>7.<em>catch__å’Œ_finally</em>_</h2><p>_tryèµ„æº_å—ä»ç„¶å¯ä»¥å…·æœ‰_catch_å’Œ_finally_å—ï¼Œå…¶å·¥ä½œæ–¹å¼ä¸ä¼ ç»Ÿçš„_try_å—ç›¸åŒã€‚</p><h2 id="8-Java-9-â€“-æœ‰æ•ˆçš„finallyå˜é‡"><a href="#8-Java-9-â€“-æœ‰æ•ˆçš„finallyå˜é‡" class="headerlink" title="8. Java 9 â€“ æœ‰æ•ˆçš„finallyå˜é‡"></a>8. Java 9 â€“ æœ‰æ•ˆçš„finallyå˜é‡</h2><p>åœ¨Java 9ä¹‹å‰ï¼Œæˆ‘ä»¬åªèƒ½åœ¨_try-with-resources_å—ä¸­ä½¿ç”¨æ–°å˜é‡ï¼š</p><p>try (Scanner scanner &#x3D; new Scanner(new File(â€œtestRead.txtâ€));<br>    PrintWriter writer = new PrintWriter(new File(â€œtestWrite.txtâ€))) {<br>    &#x2F;&#x2F; omitted<br>}</p><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œè¿™åœ¨å£°æ˜å¤šä¸ªèµ„æºæ—¶å°¤å…¶å†—é•¿ã€‚ä» Java 9 å¼€å§‹ï¼Œä½œä¸ºÂ <a href="https://openjdk.java.net/jeps/213">JEP 213</a>Â çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨_èµ„æºtry_å—ä¸­ä½¿ç”¨finallyç”šè‡³æœ‰æ•ˆçš„_finally_å˜é‡ï¼š</p><p>final Scanner scanner &#x3D; new Scanner(new File(â€œtestRead.txtâ€));<br>PrintWriter writer = new PrintWriter(new File(â€œtestWrite.txtâ€))<br>try (scanner;writer) {<br>    &#x2F;&#x2F; omitted<br>}</p><p>ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœå˜é‡åœ¨ç¬¬ä¸€æ¬¡èµ‹å€¼åæ²¡æœ‰æ›´æ”¹ï¼Œå³ä½¿å®ƒæ²¡æœ‰æ˜ç¡®æ ‡è®°ä¸º finalï¼Œå®ƒå®é™…ä¸Šæ˜¯Â _final_ã€‚</p><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œ<em>scanner</em>Â å˜é‡è¢«æ˜¾å¼å£°æ˜ä¸ºÂ _final_ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å…¶ä¸Â <em>try-with-resources</em>Â å—ä¸€èµ·ä½¿ç”¨ã€‚å°½ç®¡_ç¼–å†™å™¨_å˜é‡ä¸æ˜¯_æ˜¾å¼ final_ï¼Œä½†å®ƒåœ¨ç¬¬ä¸€æ¬¡èµ‹å€¼åä¸ä¼šæ›´æ”¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨_ç¼–å†™å™¨_å˜é‡ã€‚</p><h2 id="9-ç»“è®º"><a href="#9-ç»“è®º" class="headerlink" title="9. ç»“è®º"></a>9. ç»“è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨ try-with-resources ä»¥åŠå¦‚ä½•ç”¨ try-with-resources æ›¿æ¢Â _try_ã€_catch_ï¼Œ_finally_ã€‚</p><p>æˆ‘ä»¬è¿˜ç ”ç©¶äº†ä½¿ç”¨Â <em>AutoCloseable</em>Â æ„å»ºè‡ªå®šä¹‰èµ„æºä»¥åŠèµ„æºçš„å…³é—­é¡ºåºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>@ControllerAdvice çš„ä»‹ç»åŠä¸‰ç§ç”¨æ³•(è½¬è½½)</title>
    <link href="/article/ce91021a.html"/>
    <url>/article/ce91021a.html</url>
    
    <content type="html"><![CDATA[<h1 id="ControllerAdvice-çš„ä»‹ç»åŠä¸‰ç§ç”¨æ³•-è½¬è½½"><a href="#ControllerAdvice-çš„ä»‹ç»åŠä¸‰ç§ç”¨æ³•-è½¬è½½" class="headerlink" title="@ControllerAdvice çš„ä»‹ç»åŠä¸‰ç§ç”¨æ³•(è½¬è½½)"></a>@ControllerAdvice çš„ä»‹ç»åŠä¸‰ç§ç”¨æ³•(è½¬è½½)</h1><!-- toc --><h2 id="æµ…æ-ControllerAdvice"><a href="#æµ…æ-ControllerAdvice" class="headerlink" title="æµ…æ@ControllerAdvice"></a>æµ…æ@<a href="https://so.csdn.net/so/search?q=ControllerAdvice&spm=1001.2101.3001.7020">ControllerAdvice</a></h2><blockquote><p>é¦–å…ˆï¼ŒControllerAdviceæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªComponentï¼Œå› æ­¤ä¹Ÿä¼šè¢«å½“æˆç»„ä»¶æ‰«æï¼Œä¸€è§†åŒä»ï¼Œæ‰«æ‰«æ‰«ã€‚</p></blockquote><p><img src="https://img-blog.csdnimg.cn/c0c5578f8dc645b9ac88025f56cd5f5f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç„¶åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ­¤ç±»çš„æ³¨é‡Šï¼š</p><ul><li><p>è¿™ä¸ªç±»æ˜¯ä¸ºé‚£äº›å£°æ˜äº†ï¼ˆ@<a href="https://so.csdn.net/so/search?q=ExceptionHandler&spm=1001.2101.3001.7020">ExceptionHandler</a>ã€@InitBinder æˆ– @ModelAttributeæ³¨è§£ä¿®é¥°çš„ï¼‰æ–¹æ³•çš„ç±»è€Œæä¾›çš„ä¸“ä¸šåŒ–çš„@Component , ä»¥ä¾›å¤šä¸ª Controllerç±»æ‰€å…±äº«ã€‚</p></li><li><p>è¯´ç™½äº†ï¼Œå°±æ˜¯aopæ€æƒ³çš„ä¸€ç§å®ç°ï¼Œä½ å‘Šè¯‰æˆ‘éœ€è¦æ‹¦æˆªè§„åˆ™ï¼Œæˆ‘å¸®ä½ æŠŠä»–ä»¬æ‹¦ä¸‹æ¥ï¼Œå…·ä½“ä½ æƒ³åšæ›´ç»†è‡´çš„æ‹¦æˆªç­›é€‰å’Œæ‹¦æˆªä¹‹åçš„å¤„ç†ï¼Œä½ è‡ªå·±é€šè¿‡@ExceptionHandlerã€@InitBinder æˆ– @<a href="https://so.csdn.net/so/search?q=ModelAttribute&spm=1001.2101.3001.7020">ModelAttribute</a>è¿™ä¸‰ä¸ªæ³¨è§£ä»¥åŠè¢«å…¶æ³¨è§£çš„æ–¹æ³•æ¥è‡ªå®šä¹‰ã€‚</p></li></ul><p><img src="https://img-blog.csdnimg.cn/94d060b22a424217aa6497c462193315.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>åˆå®šä¹‰æ‹¦æˆªè§„åˆ™ï¼š</strong></p><p>ControllerAdvice æä¾›äº†å¤šç§æŒ‡å®šAdviceè§„åˆ™çš„å®šä¹‰æ–¹å¼ï¼Œé»˜è®¤ä»€ä¹ˆéƒ½ä¸å†™ï¼Œåˆ™æ˜¯Adviceæ‰€æœ‰Controllerï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹åˆ—çš„æ–¹å¼æŒ‡å®šè§„åˆ™ï¼š</p><ol><li>æ¯”å¦‚å¯¹äº String[] value() default {} , å†™æˆ@ControllerAdvice(â€œorg.my.pkgâ€) æˆ–è€… @ControllerAdvice(basePackages&#x3D;â€œorg.my.pkgâ€), åˆ™åŒ¹é…org.my.pkgåŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰Controller</li><li>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨æ•°ç»„çš„å½¢å¼æŒ‡å®šï¼Œå¦‚ï¼š@ControllerAdvice(basePackages&#x3D;{â€œorg.my.pkgâ€, â€œorg.my.other.pkgâ€})</li><li>ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šæ³¨è§£æ¥åŒ¹é…ï¼Œæ¯”å¦‚æˆ‘è‡ªå®šäº†ä¸€ä¸ª @CustomAnnotation æ³¨è§£ï¼Œæˆ‘æƒ³åŒ¹é…æ‰€æœ‰è¢«è¿™ä¸ªæ³¨è§£ä¿®é¥°çš„ Controller, å¯ä»¥è¿™ä¹ˆå†™ï¼š@ControllerAdviceï¼ˆannotations&#x3D;{CustomAnnotation.class})</li></ol><p>è¿˜æœ‰å¾ˆå¤šç”¨æ³•ï¼Œè¿™é‡Œå°±ä¸å…¨éƒ¨ç½—åˆ—äº†ã€‚</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Target</span>(ElementType.TYPE)<br><span class="hljs-keyword">@Retention</span>(RetentionPolicy.RUNTIME)<br><span class="hljs-keyword">@Documented</span><br><span class="hljs-keyword">@Component</span><br>public <span class="hljs-keyword">@interface</span> ControllerAdvice &#123;<br><br><span class="hljs-keyword">@AliasFor</span>(<span class="hljs-string">&quot;basePackages&quot;</span>)<br>String[] value() default &#123;&#125;;<br><br><span class="hljs-keyword">@AliasFor</span>(<span class="hljs-string">&quot;value&quot;</span>)<br>String[] basePackages() default &#123;&#125;;<br><br>Class&lt;?&gt;<span class="hljs-selector-attr">[]</span> <span class="hljs-built_in">basePackageClasses</span>() default &#123;&#125;;<br><br>Class&lt;?&gt;<span class="hljs-selector-attr">[]</span> <span class="hljs-built_in">assignableTypes</span>() default &#123;&#125;;<br><br>Class&lt;? extends Annotation&gt;<span class="hljs-selector-attr">[]</span> <span class="hljs-built_in">annotations</span>() default &#123;&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-å¤„ç†å…¨å±€å¼‚å¸¸"><a href="#1-å¤„ç†å…¨å±€å¼‚å¸¸" class="headerlink" title="1.å¤„ç†å…¨å±€å¼‚å¸¸"></a>1.å¤„ç†å…¨å±€å¼‚å¸¸</h3><blockquote><p>@ControllerAdvice é…åˆ <code>@ExceptionHandler</code> å®ç°å…¨å±€å¼‚å¸¸å¤„ç†</p></blockquote><p><strong>ç”¨äºåœ¨ç‰¹å®šçš„å¤„ç†å™¨ç±»ã€æ–¹æ³•ä¸­å¤„ç†å¼‚å¸¸çš„æ³¨è§£</strong></p><p><img src="https://img-blog.csdnimg.cn/a09b3552dda24d3e9fb1287ac4a99472.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><p>æ¥æ”¶<code>Throwable</code>ç±»ä½œä¸ºå‚æ•°ï¼Œæˆ‘ä»¬çŸ¥é“Throwableæ˜¯æ‰€æœ‰å¼‚å¸¸çš„çˆ¶ç±»ï¼Œæ‰€ä»¥è¯´ï¼Œå¯ä»¥è‡ªè¡Œ<strong>æŒ‡å®š</strong>æ‰€æœ‰å¼‚å¸¸</p></li><li><p>æ¯”å¦‚åœ¨æ–¹æ³•ä¸ŠåŠ ï¼š<code>@ExceptionHandler(IllegalArgumentException.class)</code>ï¼Œåˆ™è¡¨æ˜æ­¤æ–¹æ³•å¤„ç†<code>IllegalArgumentException</code> ç±»å‹çš„å¼‚å¸¸ï¼Œå¦‚æœå‚æ•°ä¸ºç©ºï¼Œå°†é»˜è®¤ä¸ºæ–¹æ³•å‚æ•°åˆ—è¡¨ä¸­åˆ—å‡ºçš„<strong>ä»»ä½•</strong>å¼‚å¸¸ï¼ˆæ–¹æ³•æŠ›å‡ºä»€ä¹ˆå¼‚å¸¸éƒ½æ¥å¾—ä½ï¼‰ã€‚</p></li></ul><p>ä¸‹é¢çš„ä¾‹å­ï¼šå¤„ç†æ‰€æœ‰<code>IllegalArgumentException</code>å¼‚å¸¸ï¼ŒåŸŸä¸­åŠ å…¥é”™è¯¯ä¿¡æ¯errorMessage å¹¶è¿”å›é”™è¯¯é¡µé¢error</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> &#123;<br>    <span class="hljs-meta">@ExceptionHandler(IllegalArgumentException.class)</span><br>    <span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title function_">handleException</span><span class="hljs-params">(IllegalArgumentException e)</span>&#123;<br>        <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">modelAndView</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>(<span class="hljs-string">&quot;error&quot;</span>);<br>        modelAndView.addObject(<span class="hljs-string">&quot;errorMessage&quot;</span>, <span class="hljs-string">&quot;å‚æ•°ä¸ç¬¦åˆè§„èŒƒ!&quot;</span>);<br>        <span class="hljs-keyword">return</span> modelAndView;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="2-é¢„è®¾å…¨å±€æ•°æ®"><a href="#2-é¢„è®¾å…¨å±€æ•°æ®" class="headerlink" title="2.é¢„è®¾å…¨å±€æ•°æ®"></a>2.é¢„è®¾å…¨å±€æ•°æ®</h3><p><code>@ControllerAdvice</code> é…åˆ <code>@ModelAttribute</code> é¢„è®¾å…¨å±€æ•°æ®</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ <code>ModelAttribute</code>æ³¨è§£ç±»çš„æºç </p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Annotation that binds a method parameter or method return value</span><br><span class="hljs-comment"> * to a named model attribute, exposed to a web view. Supported</span><br><span class="hljs-comment"> * for controller classes with &#123;@link RequestMapping @RequestMapping&#125;</span><br><span class="hljs-comment"> * methods.</span><br><span class="hljs-comment"> * æ­¤æ³¨è§£ç”¨äºç»‘å®šä¸€ä¸ªæ–¹æ³•å‚æ•°æˆ–è€…è¿”å›å€¼åˆ°ä¸€ä¸ªè¢«å‘½åçš„modelå±æ€§ä¸­ï¼Œæš´éœ²ç»™webè§†å›¾ã€‚æ”¯æŒåœ¨</span><br><span class="hljs-comment"> * åœ¨Controllerç±»ä¸­æ³¨æœ‰@RequestMappingçš„æ–¹æ³•ä½¿ç”¨ï¼ˆè¿™é‡Œæœ‰ç‚¹æ‹—å£ï¼Œä¸è¿‡ç»“åˆä¸‹é¢çš„ä½¿ç”¨ä»‹ç»</span><br><span class="hljs-comment"> * ä½ å°±ä¼šæ˜ç™½çš„)</span><br><span class="hljs-comment"> */</span><br><span class="hljs-variable">@Target</span>(&#123;ElementType.PARAMETER, ElementType.METHOD&#125;)<br><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<br><span class="hljs-variable">@Documented</span><br>public <span class="hljs-variable">@interface</span> ModelAttribute &#123;<br><br><span class="hljs-variable">@AliasFor</span>(<span class="hljs-string">&quot;name&quot;</span>)<br>String <span class="hljs-built_in">value</span>() default <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-variable">@AliasFor</span>(<span class="hljs-string">&quot;value&quot;</span>)<br>String <span class="hljs-built_in">name</span>() default <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">binding</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-selector-tag">true</span>;<br><br>&#125;<br><br><br></code></pre></td></tr></table></figure><blockquote><p>å®é™…ä¸Šè¿™ä¸ªæ³¨è§£çš„ä½œç”¨å°±æ˜¯ï¼Œå…è®¸ä½ å¾€ <code>Model</code> ä¸­æ³¨å…¥å…¨å±€å±æ€§ï¼ˆå¯ä»¥ä¾›æ‰€æœ‰Controllerä¸­æ³¨æœ‰<code>@Request Mapping</code>çš„æ–¹æ³•ä½¿ç”¨ï¼‰ï¼Œ<code>value</code> å’Œ <code>name</code> ç”¨äºæŒ‡å®šå±æ€§çš„ key ï¼Œ<code>binding</code> è¡¨ç¤ºæ˜¯å¦ç»‘å®šï¼Œé»˜è®¤ä¸º trueã€‚</p></blockquote><p>å…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><p><strong>å…¨å±€å‚æ•°ç»‘å®š</strong></p><ul><li>æ–¹å¼ä¸€ï¼š</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyGlobalHandler</span> &#123;<br>    <span class="hljs-meta">@ModelAttribute</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">presetParam</span>(<span class="hljs-params">Model model</span>)&#123;<br>        model.<span class="hljs-title function_">addAttribute</span>(<span class="hljs-string">&quot;globalAttr&quot;</span>,<span class="hljs-string">&quot;this is a global attribute&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>è¿™ç§æ–¹å¼æ¯”è¾ƒçµæ´»ï¼Œéœ€è¦ä»€ä¹ˆè‡ªå·±åŠ å°±è¡Œäº†ï¼ŒåŠ å¤šå°‘å±æ€§è‡ªå·±æ§åˆ¶</p></blockquote><ul><li>æ–¹å¼äºŒï¼š</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs livescript">@ControllerAdvice<br>public <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyGlobalHandler</span> &#123;<br><br>    @ModelAttribute()<br>    public <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; presetParam()&#123;<br>        <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; <span class="hljs-keyword">map</span> = <span class="hljs-keyword">new</span> HashMap&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt;();<br>        <span class="hljs-keyword">map</span>.put(<span class="hljs-string">&quot;key1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);<br>        <span class="hljs-keyword">map</span>.put(<span class="hljs-string">&quot;key2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);<br>        <span class="hljs-keyword">map</span>.put(<span class="hljs-string">&quot;key3&quot;</span>, <span class="hljs-string">&quot;value3&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">map</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼å¯¹äºåŠ å•ä¸ªå±æ€§æ¯”è¾ƒæ–¹ä¾¿ã€‚é»˜è®¤ä¼šæŠŠè¿”å›å€¼ï¼ˆå¦‚ä¸Šé¢çš„mapï¼‰ä½œä¸ºå±æ€§çš„valueï¼Œè€Œå¯¹äºkeyæœ‰ä¸¤ç§æŒ‡å®šæ–¹å¼ï¼š</p><ol><li>å½“ <code>@ModelAttribute()</code> ä¸ä¼ ä»»ä½•å‚æ•°çš„æ—¶å€™ï¼Œé»˜è®¤ä¼šæŠŠè¿”å›å€¼çš„å­—ç¬¦ä¸²å€¼ä½œä¸ºkeyï¼Œå¦‚ä¸Šä¾‹çš„ key åˆ™æ˜¯ â€mapâ€ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸æ”¯æŒå­—ç¬¦ä¸²çš„è¿”å›å€¼ä½œä¸ºkeyï¼‰ã€‚</li><li>å½“ <code>@ModelAttribute(&quot;myMap&quot;)</code> ä¼ å‚æ•°çš„æ—¶å€™ï¼Œåˆ™ä»¥å‚æ•°å€¼ä½œä¸ºkeyï¼Œè¿™é‡Œ key åˆ™æ˜¯ â€myMapâ€œã€‚</li></ol><p><strong>å…¨å±€å‚æ•°ä½¿ç”¨</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdviceController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;methodOne&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">methodOne</span>(<span class="hljs-params">Model model</span>)&#123; <br>        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; modelMap = model.<span class="hljs-title function_">asMap</span>();<br>        <span class="hljs-keyword">return</span> (<span class="hljs-title class_">String</span>)modelMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;globalAttr&quot;</span>);<br>    &#125;<br><br>  <br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;methodTwo&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">methodTwo</span>(<span class="hljs-params"><span class="hljs-meta">@ModelAttribute</span>(<span class="hljs-string">&quot;globalAttr&quot;</span>) <span class="hljs-built_in">String</span> globalAttr</span>)&#123;<br>        <span class="hljs-keyword">return</span> globalAttr;<br>    &#125;<br><br><br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;methodThree&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">methodThree</span>(<span class="hljs-params">ModelMap modelMap</span>) &#123;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-title class_">String</span>) modelMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;globalAttr&quot;</span>);<br>    &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸‰ç§æ–¹å¼å¤§åŒå°å¼‚ï¼Œå…¶å®éƒ½æ˜¯éƒ½æ˜¯ä»Model ä¸­å­˜å‚¨å±æ€§çš„ Mapé‡Œå–æ•°æ®ã€‚</p><h3 id="3-è¯·æ±‚å‚æ•°é¢„å¤„ç†"><a href="#3-è¯·æ±‚å‚æ•°é¢„å¤„ç†" class="headerlink" title="3.è¯·æ±‚å‚æ•°é¢„å¤„ç†"></a>3.è¯·æ±‚å‚æ•°é¢„å¤„ç†</h3><blockquote><p><code>@ControllerAdvice</code> é…åˆ <code>@InitBinder</code> å®ç°å¯¹è¯·æ±‚å‚æ•°çš„é¢„å¤„ç†</p></blockquote><p>å†æ¬¡ä¹‹å‰æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹@IniiBinderï¼Œå…ˆçœ‹ä¸€ä¸‹æºç ï¼Œæˆ‘ä¼šæå–ä¸€äº›é‡è¦çš„æ³¨é‡Šè¿›è¡Œæµ…æ</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Annotation that identifies methods which initialize the</span><br><span class="hljs-comment"> * &#123;@link org.springframework.web.bind.WebDataBinder&#125; which</span><br><span class="hljs-comment"> * will be used for populating command and form object arguments</span><br><span class="hljs-comment"> * of annotated handler methods.</span><br><span class="hljs-comment"> * ç²—ç•¥ç¿»è¯‘ï¼šæ­¤æ³¨è§£ç”¨äºæ ‡è®°é‚£äº› (åˆå§‹åŒ–[ç”¨äºç»„è£…å‘½ä»¤å’Œè¡¨å•å¯¹è±¡å‚æ•°çš„]WebDataBinder)çš„æ–¹æ³•ã€‚</span><br><span class="hljs-comment"> * åŸè°…æˆ‘çš„è‹±è¯­æ°´å¹³ï¼Œç¿»è¯‘èµ·æ¥å¤ªæ‹—å£äº†ï¼Œä»å¥å¤ªå¤šå°±ç”¨â€˜()ã€[]â€™åˆ†å‰²ä¸€ä¸‹ä¾¿äºé˜…è¯»</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Init-binder methods must not have a return value; they are usually</span><br><span class="hljs-comment"> * declared as &#123;@code void&#125;.</span><br><span class="hljs-comment"> * ç²—ç•¥ç¿»è¯‘ï¼šåˆå§‹åŒ–ç»‘å®šçš„æ–¹æ³•ç¦æ­¢æœ‰è¿”å›å€¼ï¼Œä»–ä»¬é€šå¸¸å£°æ˜ä¸º &#x27;void&#x27;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;Typical arguments are &#123;@link org.springframework.web.bind.WebDataBinder&#125;</span><br><span class="hljs-comment"> * in combination with &#123;@link org.springframework.web.context.request.WebRequest&#125;</span><br><span class="hljs-comment"> * or &#123;@link java.util.Locale&#125;, allowing to register context-specific editors.</span><br><span class="hljs-comment"> * ç²—ç•¥ç¿»è¯‘ï¼šå…¸å‹çš„å‚æ•°æ˜¯`WebDataBinder`ï¼Œç»“åˆ`WebRequest`æˆ–`Locale`ä½¿ç”¨ï¼Œå…è®¸æ³¨å†Œç‰¹å®šäºä¸Šä¸‹æ–‡çš„ç¼–è¾‘å™¨ã€‚</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * æ€»ç»“å¦‚ä¸‹ï¼š</span><br><span class="hljs-comment"> *  1. @InitBinder æ ‡è¯†çš„æ–¹æ³•çš„å‚æ•°é€šå¸¸æ˜¯ WebDataBinderã€‚</span><br><span class="hljs-comment"> *  2. @InitBinder æ ‡è¯†çš„æ–¹æ³•,å¯ä»¥å¯¹ WebDataBinder è¿›è¡Œåˆå§‹åŒ–ã€‚WebDataBinder æ˜¯ DataBinder çš„ä¸€ä¸ªå­ç±»,ç”¨äºå®Œæˆç”±è¡¨å•å­—æ®µåˆ° JavaBean å±æ€§çš„ç»‘å®šã€‚</span><br><span class="hljs-comment"> *  3. @InitBinder æ ‡è¯†çš„æ–¹æ³•ä¸èƒ½æœ‰è¿”å›å€¼,å¿…é¡»å£°æ˜ä¸ºvoidã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-variable">@Target</span>(&#123;ElementType.METHOD&#125;)<br><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<br><span class="hljs-variable">@Documented</span><br>public <span class="hljs-variable">@interface</span> InitBinder &#123;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * The names of command/form attributes and/or request parameters</span><br><span class="hljs-comment"> * that this init-binder method is supposed to apply to.</span><br><span class="hljs-comment"> * &lt;p&gt;Default is to apply to all command/form attributes and all request parameters</span><br><span class="hljs-comment"> * processed by the annotated handler class. Specifying model attribute names or</span><br><span class="hljs-comment"> * request parameter names here restricts the init-binder method to those specific</span><br><span class="hljs-comment"> * attributes/parameters, with different init-binder methods typically applying to</span><br><span class="hljs-comment"> * different groups of attributes or parameters.</span><br><span class="hljs-comment"> * ç²—ç•¥ç¿»è¯‘ï¼šæ­¤init-binderæ–¹æ³•åº”è¯¥åº”ç”¨äºçš„å‘½ä»¤/è¡¨å•å±æ€§å’Œ/æˆ–è¯·æ±‚å‚æ•°çš„åç§°ã€‚é»˜è®¤æ˜¯åº”ç”¨äºæ‰€æœ‰å‘½   * ä»¤/è¡¨å•å±æ€§å’Œæ‰€æœ‰ç”±å¸¦æ³¨é‡Šçš„å¤„ç†ç±»å¤„ç†çš„è¯·æ±‚å‚æ•°ã€‚è¿™é‡ŒæŒ‡å®šæ¨¡å‹å±æ€§åæˆ–è¯·æ±‚å‚æ•°åå°†init-binder * æ–¹æ³•é™åˆ¶ä¸ºé‚£äº›ç‰¹å®šçš„å±æ€§/å‚æ•°ï¼Œä¸åŒçš„init-binderæ–¹æ³•é€šå¸¸åº”ç”¨äºä¸åŒçš„å±æ€§æˆ–å‚æ•°ç»„ã€‚</span><br><span class="hljs-comment"> * æˆ‘è‡³å·±éƒ½ç†è§£ä¸å¤ªç†è§£è¿™è¯´çš„æ˜¯å•¥å‘€ï¼Œæˆ‘ä»¬è¿˜æ˜¯çœ‹ä¾‹å­å§</span><br><span class="hljs-comment"> */</span><br><span class="hljs-selector-tag">String</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">value</span>() <span class="hljs-selector-tag">default</span> &#123;&#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“ç”¨é€”ï¼Œå…¶å®è¿™äº›ç”¨é€”åœ¨ Controlleré‡Œä¹Ÿå¯ä»¥å®šä¹‰ï¼Œä½†æ˜¯ä½œç”¨èŒƒå›´å°±åªé™å½“å‰Controllerï¼Œå› æ­¤ä¸‹é¢çš„ä¾‹å­æˆ‘ä»¬å°†ç»“åˆ ControllerAdvice ä½œå…¨å±€å¤„ç†ã€‚</p><ul><li>å‚æ•°å¤„ç†</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyGlobalHandler</span> &#123;<br><br>    <span class="hljs-meta">@InitBinder</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">processParam</span>(<span class="hljs-params">WebDataBinder dataBinder</span>)&#123;<br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¾®è°ƒç¼–è¾‘å™¨</span><br><span class="hljs-comment">         * å‚æ•°&#123;boolean emptyAsNull&#125;: æ˜¯å¦æŠŠç©ºå­—ç¬¦ä¸²(&quot;&quot;)è§†ä¸º null</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-title class_">StringTrimmerEditor</span> trimmerEditor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringTrimmerEditor</span>(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * æ³¨å†Œè‡ªå®šä¹‰ç¼–è¾‘å™¨</span><br><span class="hljs-comment">         * æ¥å—ä¸¤ä¸ªå‚æ•°&#123;Class&lt;?&gt; requiredType, PropertyEditor propertyEditor&#125;</span><br><span class="hljs-comment">         * requiredTypeï¼šæ‰€éœ€å¤„ç†çš„ç±»å‹</span><br><span class="hljs-comment">         * propertyEditorï¼šå±æ€§ç¼–è¾‘å™¨ï¼ŒStringTrimmerEditorå°±æ˜¯ propertyEditorçš„ä¸€ä¸ªå­ç±»</span><br><span class="hljs-comment">         */</span><br>        dataBinder.<span class="hljs-title function_">registerCustomEditor</span>(<span class="hljs-title class_">String</span>.<span class="hljs-property">class</span>, trimmerEditor);<br>        <br>        <span class="hljs-comment">//åŒä¸Šï¼Œè¿™é‡Œå°±ä¸å†ä¸€æ­¥ä¸€æ­¥è®²è§£äº†</span><br>        binder.<span class="hljs-title function_">registerCustomEditor</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-property">class</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomDateEditor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>), <span class="hljs-literal">false</span>));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™æ ·ä¹‹åå‘¢ï¼Œå°±å¯ä»¥å®ç°å…¨å±€çš„å®ç°å¯¹ Controller ä¸­RequestMappingæ ‡è¯†çš„æ–¹æ³•ä¸­çš„æ‰€æœ‰ String å’ŒDateç±»å‹çš„å‚æ•°éƒ½ä¼šè¢«ä½œç›¸åº”çš„å¤„ç†ã€‚</p><blockquote><p>Controller:</p></blockquote><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs livescript">@RestController<br>public <span class="hljs-keyword">class</span> <span class="hljs-title class_">BinderTestController</span> &#123;<br><br>    @GetMapping(<span class="hljs-string">&quot;processParam&quot;</span>)<br>    public <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt; test(<span class="hljs-built_in">String</span> str, <span class="hljs-built_in">Date</span> date) throws Exception &#123;<br>        <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt; <span class="hljs-keyword">map</span> = <span class="hljs-keyword">new</span> HashMap&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt;();<br>        <span class="hljs-keyword">map</span>.put(<span class="hljs-string">&quot;str&quot;</span>, str);<br>        <span class="hljs-keyword">map</span>.put(<span class="hljs-string">&quot;data&quot;</span>, date);<br>        <span class="hljs-keyword">return</span>  <span class="hljs-keyword">map</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•ç»“æœï¼š</p></blockquote><p><img src="https://img-blog.csdnimg.cn/8197da8981a9408a8b398264b2f00683.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œstr å’Œ date è¿™ä¸¤ä¸ªå‚æ•°åœ¨è¿›å…¥ Controller çš„testçš„æ–¹æ³•ä¹‹å‰å·²ç»è¢«å¤„ç†äº†ï¼Œstr è¢«å»æ‰äº†ä¸¤è¾¹çš„ç©ºæ ¼(%20 åœ¨Http url ä¸­æ˜¯ç©ºæ ¼çš„æ„æ€)ï¼ŒStringç±»å‹çš„ 1997-1-10è¢«è½¬æ¢æˆäº†Dateç±»å‹ã€‚</p><ul><li>å‚æ•°ç»‘å®š</li></ul><p>å‚æ•°ç»‘å®šå¯ä»¥è§£å†³ç‰¹å®šé—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æˆ‘ä»¬é¢ä¸´çš„é—®é¢˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-comment">// omitted getters and setters.</span><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Double</span> price;<br>    <span class="hljs-comment">// omitted getters and setters.</span><br>&#125;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BinderTestController</span> &#123;<br><br>    <span class="hljs-meta">@PostMapping(<span class="hljs-string">&quot;bindParam&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> void test(Person person, Book book) throws Exception &#123;<br>        System.<span class="hljs-keyword">out</span>.println(person);<br>        System.<span class="hljs-keyword">out</span>.println(book);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå‘ç° Personç±»å’Œ Book ç±»éƒ½æœ‰ nameå±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºå…ˆé—®é¢˜ï¼Œå®ƒå¯æ²¡æœ‰é‚£ä¹ˆåªèƒ½åŒºåˆ†å“ªä¸ªnameæ˜¯å“ªä¸ªç±»çš„ã€‚å› æ­¤ @InitBinderå°±æ´¾ä¸Šç”¨åœºäº†ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyGlobalHandler</span> </span>&#123;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">     * @InitBinder(&quot;person&quot;) å¯¹åº”æ‰¾åˆ°@RequstMappingæ ‡è¯†çš„æ–¹æ³•å‚æ•°ä¸­</span><br><span class="hljs-comment">     * æ‰¾å‚æ•°åä¸ºpersonçš„å‚æ•°ã€‚</span><br><span class="hljs-comment">     * åœ¨è¿›è¡Œå‚æ•°ç»‘å®šçš„æ—¶å€™ï¼Œä»¥â€˜p.â€™å¼€å¤´çš„éƒ½ç»‘å®šåˆ°åä¸ºpersonçš„å‚æ•°ä¸­ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@InitBinder</span>(<span class="hljs-string">&quot;person&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BindPerson</span><span class="hljs-params">(WebDataBinder dataBinder)</span></span>&#123;<br>        dataBinder.setFieldDefaultPrefix(<span class="hljs-string">&quot;p.&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@InitBinder</span>(<span class="hljs-string">&quot;book&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BindBook</span><span class="hljs-params">(WebDataBinder dataBinder)</span></span>&#123;<br>        dataBinder.setFieldDefaultPrefix(<span class="hljs-string">&quot;b.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å› æ­¤ï¼Œä¼ å…¥çš„åŒåä¿¡æ¯å°±èƒ½å¯¹åº”ç»‘å®šåˆ°ç›¸åº”çš„å®ä½“ç±»ä¸­ï¼š</p><p>p.name -&gt; Person.name b.name -&gt; Book.name</p><p>è¿˜æœ‰ä¸€ç‚¹æ³¨æ„çš„æ˜¯å¦‚æœ @InitBinder(â€œvalueâ€) ä¸­çš„ value å€¼å’Œ Controller ä¸­ @RequestMapping() æ ‡è¯†çš„æ–¹æ³•çš„å‚æ•°åä¸åŒ¹é…ï¼Œåˆ™å°±ä¼šäº§ç”Ÿç»‘å®šå¤±è´¥çš„åæœ,å¦‚ï¼š</p><p>@InitBinder(â€œpâ€)ã€@InitBinder(â€œbâ€)</p><p>public void test(Person person, Book book)</p><p>ä¸Šè¿°æƒ…å†µå°±ä¼šå‡ºç°ç»‘å®šå¤±è´¥ï¼Œæœ‰ä¸¤ç§è§£å†³åŠæ³•</p><p>ç¬¬ä¸€ç§ï¼šç»Ÿä¸€åç§°ï¼Œè¦ä¹ˆå…¨å«pï¼Œè¦ä¹ˆå…¨å«personï¼Œåªè¦ç›¸åŒå°±è¡Œã€‚</p><p>ç¬¬äºŒç§ï¼šæ–¹æ³•å‚æ•°åŠ  @ModelAttributeï¼Œæœ‰ç‚¹ç±»ä¼¼@RequestParam</p><p>@InitBinder(â€œpâ€)ã€@InitBinder(â€œbâ€)</p><p>public void test(@ModelAttribute(â€œpâ€) Person person, @ModelAttribute(â€œbâ€) Book book)</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springä¸­çš„spring.factoriesæ–‡ä»¶ç”¨æ³•(Springå¦‚ä½•åŠ è½½ç¬¬ä¸‰æ–¹Bean)</title>
    <link href="/article/3a6476bb.html"/>
    <url>/article/3a6476bb.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><h1 id="Springä¸­çš„spring-factoriesæ–‡ä»¶ç”¨æ³•-Springå¦‚ä½•åŠ è½½ç¬¬ä¸‰æ–¹Bean"><a href="#Springä¸­çš„spring-factoriesæ–‡ä»¶ç”¨æ³•-Springå¦‚ä½•åŠ è½½ç¬¬ä¸‰æ–¹Bean" class="headerlink" title="Springä¸­çš„spring.factoriesæ–‡ä»¶ç”¨æ³•(Springå¦‚ä½•åŠ è½½ç¬¬ä¸‰æ–¹Bean)"></a>Springä¸­çš„spring.factoriesæ–‡ä»¶ç”¨æ³•(Springå¦‚ä½•åŠ è½½ç¬¬ä¸‰æ–¹Bean)</h1><h2 id="Springçš„spring-factoriesæ–‡ä»¶ç”¨æ³•"><a href="#Springçš„spring-factoriesæ–‡ä»¶ç”¨æ³•" class="headerlink" title="Springçš„spring.factoriesæ–‡ä»¶ç”¨æ³•"></a>Springçš„spring.factoriesæ–‡ä»¶ç”¨æ³•</h2><p>åœ¨springBootä¸­ï¼Œå®ƒè‡ªåŠ¨æ‰«æåŒ…çš„æ—¶å€™ï¼Œåªä¼šæ‰«æè‡ªå·±æ¨¡å—ä¸‹çš„ç±»ã€‚</p><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>å¦‚æœæˆ‘ä»¬ä¸æƒ³è¢«Springå®¹å™¨ç®¡ç†çš„Beançš„è·¯å¾„ä¸‹ä¸å†SpringBootçš„åŒ…æ‰«æè·¯å¾„ä¸‹ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿå¦‚ä½•åŠ è½½åˆ«çš„ç¬¬ä¸‰æ–¹Beanå‘¢ï¼Ÿ</p><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œå¦å¤–åˆ›å»ºä¸€ä¸ªä¸å¯åŠ¨ç±»ä¸åœ¨ä¸€ä¸ªçº§åˆ«çš„ç›®å½•ã€‚</p><p><strong>ç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯ä½¿ç”¨åœ¨å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š@Importæ³¨è§£ã€‚</strong></p><p>@Import(value &#x3D; {Test.class})</p><p><strong>ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯åˆ›å»ºspring.factoriesæ–‡ä»¶</strong></p><p>ç°åœ¨æˆ‘ä»¬å°†å…¶æ”¹é€ ä¸€ä¸‹ï¼Œé‡‡ç”¨spring.factoriesçš„æ–¹å¼å»åŠ è½½Testç±»ï¼Œåœ¨resourcesç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªMETA-INFçš„ç›®å½•ï¼Œç„¶åå†æ–°å»ºä¸€ä¸ªspring.factoriesæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºï¼š</p><p>ä¸‹é¢ç¬¬äºŒæ¡å°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„ç±»çš„è·¯å¾„ã€‚</p><p>org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;&#x2F;<br>com.huawei.it.config.Test</p><p>ç„¶ååœ¨springBootä¸­çš„å¯åŠ¨ç±»ä¸­å°†@Importæ³¨é‡Šæ‰ï¼Œå¯åŠ¨ä¸€ä¸‹ï¼Œåœ¨æ§åˆ¶å°ä¸Šå°±ä¼šå‘ç°ï¼Œæˆ‘ä»¬è‡ªå·±çš„é…ç½®ç±»å·²ç»åŠ è½½åˆ°Springå®¹å™¨ä¸­å»äº†ï¼Œæ‰€ä»¥Springå¯ä»¥åŠ è½½ä¸€ä¸ªå·¥ç¨‹ä¸‹çš„ä»»æ„ä¸€ä¸‹å·¥ç¨‹ç±»äº†ã€‚</p><p>åº”ç”¨</p><p>ä¸‹é¢å°±æ˜¯æˆ‘åœ¨Nacosæºç ä¸­çœ‹åˆ°çš„ï¼Œå¯ä»¥çœ‹åˆ°spring.factoriesæ–‡ä»¶ä¸­å†…å®¹ï¼Œä¸æˆ‘ä»¬è‡ªå·±ç±»åŠ è½½åˆ°Springå®¹å™¨ä¸­æ˜¯ä¸€æ ·çš„é“ç†ã€‚</p><p><img src="http://static.codebaoku.com/pics/97/6e/976efb625c23672b1b419bda66f5a3d8.jpg"></p><h2 id="SpringBootçš„æ‰©å±•æœºåˆ¶ä¹‹Spring-Factories"><a href="#SpringBootçš„æ‰©å±•æœºåˆ¶ä¹‹Spring-Factories" class="headerlink" title="SpringBootçš„æ‰©å±•æœºåˆ¶ä¹‹Spring Factories"></a>SpringBootçš„æ‰©å±•æœºåˆ¶ä¹‹Spring Factories</h2><p>å†™åœ¨å‰é¢ï¼šSpring Bootä¸­æœ‰ä¸€ç§éå¸¸è§£è€¦çš„æ‰©å±•æœºåˆ¶ï¼šSpring Factoriesã€‚è¿™ç§æ‰©å±•æœºåˆ¶å®é™…ä¸Šæ˜¯ä»¿ç…§Javaä¸­çš„SPIæ‰©å±•æœºåˆ¶æ¥å®ç°çš„ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-SPIæœºåˆ¶"><a href="#ä»€ä¹ˆæ˜¯-SPIæœºåˆ¶" class="headerlink" title="ä»€ä¹ˆæ˜¯ SPIæœºåˆ¶"></a>ä»€ä¹ˆæ˜¯ SPIæœºåˆ¶</h3><p>SPIçš„å…¨åä¸ºService Provider Interface.å¤§å¤šæ•°å¼€å‘äººå‘˜å¯èƒ½ä¸ç†Ÿæ‚‰ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯é’ˆå¯¹å‚å•†æˆ–è€…æ’ä»¶çš„ã€‚åœ¨java.util.ServiceLoaderçš„æ–‡æ¡£é‡Œæœ‰æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ã€‚</p><p>ç®€å•çš„æ€»ç»“ä¸‹java SPIæœºåˆ¶çš„æ€æƒ³ã€‚æˆ‘ä»¬ç³»ç»Ÿé‡ŒæŠ½è±¡çš„å„ä¸ªæ¨¡å—ï¼Œå¾€å¾€æœ‰å¾ˆå¤šä¸åŒçš„å®ç°æ–¹æ¡ˆï¼Œæ¯”å¦‚æ—¥å¿—æ¨¡å—çš„æ–¹æ¡ˆï¼Œxmlè§£ææ¨¡å—ã€jdbcæ¨¡å—çš„æ–¹æ¡ˆç­‰ã€‚é¢å‘çš„å¯¹è±¡çš„è®¾è®¡é‡Œï¼Œæˆ‘ä»¬ä¸€èˆ¬æ¨èæ¨¡å—ä¹‹é—´åŸºäºæ¥å£ç¼–ç¨‹ï¼Œæ¨¡å—ä¹‹é—´ä¸å¯¹å®ç°ç±»è¿›è¡Œç¡¬ç¼–ç ã€‚ä¸€æ—¦ä»£ç é‡Œæ¶‰åŠå…·ä½“çš„å®ç°ç±»ï¼Œå°±è¿åäº†å¯æ‹”æ’çš„åŸåˆ™ï¼Œå¦‚æœéœ€è¦æ›¿æ¢ä¸€ç§å®ç°ï¼Œå°±éœ€è¦ä¿®æ”¹ä»£ç ã€‚ä¸ºäº†å®ç°åœ¨æ¨¡å—è£…é…çš„æ—¶å€™èƒ½ä¸åœ¨ç¨‹åºé‡ŒåŠ¨æ€æŒ‡æ˜ï¼Œè¿™å°±éœ€è¦ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶ã€‚</p><p>java SPIå°±æ˜¯æä¾›è¿™æ ·çš„ä¸€ä¸ªæœºåˆ¶ï¼šä¸ºæŸä¸ªæ¥å£å¯»æ‰¾æœåŠ¡å®ç°çš„æœºåˆ¶ã€‚æœ‰ç‚¹ç±»ä¼¼IOCçš„æ€æƒ³ï¼Œå°±æ˜¯å°†è£…é…çš„æ§åˆ¶æƒç§»åˆ°ç¨‹åºä¹‹å¤–ï¼Œåœ¨æ¨¡å—åŒ–è®¾è®¡ä¸­è¿™ä¸ªæœºåˆ¶å°¤å…¶é‡è¦ã€‚</p><h3 id="Spring-Bootä¸­çš„SPIæœºåˆ¶"><a href="#Spring-Bootä¸­çš„SPIæœºåˆ¶" class="headerlink" title="Spring Bootä¸­çš„SPIæœºåˆ¶"></a>Spring Bootä¸­çš„SPIæœºåˆ¶</h3><p>åœ¨Springä¸­ä¹Ÿæœ‰ä¸€ç§ç±»ä¼¼ä¸Java SPIçš„åŠ è½½æœºåˆ¶ã€‚å®ƒåœ¨META-INF&#x2F;spring.factoriesæ–‡ä»¶ä¸­é…ç½®æ¥å£çš„å®ç°ç±»åç§°ï¼Œç„¶ååœ¨ç¨‹åºä¸­è¯»å–è¿™äº›é…ç½®æ–‡ä»¶å¹¶å®ä¾‹åŒ–ã€‚</p><p>è¿™ç§è‡ªå®šä¹‰çš„SPIæœºåˆ¶æ˜¯Spring Boot Starterå®ç°çš„åŸºç¡€ã€‚</p><p><img src="http://static.codebaoku.com/pics/a9/ec/a9ec44cb943700b06a9262946e9dea16.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><h3 id="Spring-Factorieså®ç°åŸç†æ˜¯ä»€ä¹ˆ"><a href="#Spring-Factorieså®ç°åŸç†æ˜¯ä»€ä¹ˆ" class="headerlink" title="Spring Factorieså®ç°åŸç†æ˜¯ä»€ä¹ˆ"></a>Spring Factorieså®ç°åŸç†æ˜¯ä»€ä¹ˆ</h3><p>spring-coreåŒ…é‡Œå®šä¹‰äº†SpringFactoriesLoaderç±»ï¼Œè¿™ä¸ªç±»å®ç°äº†æ£€ç´¢META-INF&#x2F;spring.factoriesæ–‡ä»¶ï¼Œå¹¶è·å–æŒ‡å®šæ¥å£çš„é…ç½®çš„åŠŸèƒ½ã€‚åœ¨è¿™ä¸ªç±»ä¸­å®šä¹‰äº†ä¸¤ä¸ªå¯¹å¤–çš„æ–¹æ³•ï¼š</p><p><strong>loadFactories</strong> æ ¹æ®æ¥å£ç±»è·å–å…¶å®ç°ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯å¯¹è±¡åˆ—è¡¨ã€‚</p><p><strong>loadFactoryNames</strong> æ ¹æ®æ¥å£è·å–å…¶æ¥å£ç±»çš„åç§°ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ç±»åçš„åˆ—è¡¨ã€‚</p><p>ä¸Šé¢çš„ä¸¤ä¸ªæ–¹æ³•çš„å…³é”®éƒ½æ˜¯ä»æŒ‡å®šçš„ClassLoaderä¸­è·å–<strong>spring.factories</strong>æ–‡ä»¶ï¼Œå¹¶è§£æå¾—åˆ°ç±»ååˆ—è¡¨ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹â†“</p><p>public static List<String> loadFactoryNames(Class&lt;?&gt; factoryClass, ClassLoader classLoader) {<br>  String factoryClassName &#x3D; factoryClass.getName();<br>  try {<br>      Enumeration<URL> urls &#x3D; (classLoader !&#x3D; null ? classLoader.getResources(FACTORIES_RESOURCE_LOCATION) :<br>              ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));<br>      List<String> result &#x3D; new ArrayList<String>();<br>      while (urls.hasMoreElements()) {<br>          URL url &#x3D; urls.nextElement();<br>          Properties properties &#x3D; PropertiesLoaderUtils.loadProperties(new UrlResource(url));<br>          String factoryClassNames &#x3D; properties.getProperty(factoryClassName);<br>          result.addAll(Arrays.asList(StringUtils.commaDelimitedListToStringArray(factoryClassNames)));<br>      }<br>      return result;<br>  }<br>  catch (IOException ex) {<br>      throw new IllegalArgumentException(â€œUnable to load [â€œ + factoryClass.getName() +<br>              â€œ] factories from location [â€œ + FACTORIES_RESOURCE_LOCATION + â€œ]â€œ, ex);<br>  }<br>}</p><p>ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼šéå†æ•´ä¸ªClassLoaderä¸­æ‰€æœ‰jaråŒ…ä¸‹çš„spring.factoriesæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±çš„jarä¸­é…ç½®spring.factoriesæ–‡ä»¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶å®ƒåœ°æ–¹çš„é…ç½®ï¼Œä¹Ÿä¸ä¼šè¢«åˆ«äººçš„é…ç½®è¦†ç›–ã€‚</p><p>spring.factoriesçš„æ˜¯é€šè¿‡Propertiesè§£æå¾—åˆ°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å†™æ–‡ä»¶ä¸­çš„å†…å®¹éƒ½æ˜¯å®‰è£…ä¸‹é¢è¿™ç§æ–¹å¼é…ç½®çš„ï¼š</p><blockquote><p>com.xxx.interface&#x3D;com.xxx.classname</p></blockquote><p>å¦‚æœä¸€ä¸ªæ¥å£å¸Œæœ›é…ç½®å¤šä¸ªå®ç°ç±»ï¼Œå¯ä»¥ä½¿ç”¨â€™,â€™è¿›è¡Œåˆ†å‰²ã€‚</p><h3 id="Spring-Factoriesåœ¨Spring-Bootä¸­çš„åº”ç”¨"><a href="#Spring-Factoriesåœ¨Spring-Bootä¸­çš„åº”ç”¨" class="headerlink" title="Spring Factoriesåœ¨Spring Bootä¸­çš„åº”ç”¨"></a>Spring Factoriesåœ¨Spring Bootä¸­çš„åº”ç”¨</h3><p>åœ¨Spring Bootçš„å¾ˆå¤šåŒ…ä¸­éƒ½èƒ½å¤Ÿæ‰¾åˆ°spring.factoriesæ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»¥spring-bootåŒ…ä¸ºä¾‹è¿›è¡Œä»‹ç»</p><p><img src="http://static.codebaoku.com/pics/50/b7/50b74d796aece01582e75f41f6f16a75.jpg"></p><p>åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å®ç°ä¸€äº›SDKæˆ–è€…Spring Boot Starterç»™è¢«äººä½¿ç”¨æ—¶ï¼Œ æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Factoriesæœºåˆ¶ã€‚Factoriesæœºåˆ¶å¯ä»¥è®©SDKæˆ–è€…Starterçš„ä½¿ç”¨åªéœ€è¦å¾ˆå°‘æˆ–è€…ä¸éœ€è¦è¿›è¡Œé…ç½®ï¼Œåªéœ€è¦åœ¨æœåŠ¡ä¸­å¼•å…¥æˆ‘ä»¬çš„jaråŒ…å³å¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…¨å›½ç”µä¿¡å…‰çŒ«æŠ“åŒ…è·å–è¶…çº§å¯†ç æ•™ç¨‹äº²æµ‹å¯ç”¨</title>
    <link href="/article/fbe35e53.html"/>
    <url>/article/fbe35e53.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><p>å…¨å›½ç”µä¿¡å…‰çŒ«æŠ“åŒ…è·å–è¶…çº§å¯†ç æ•™ç¨‹äº²æµ‹å¯ç”¨<br><a href="https://www.xgiu.com/content/uploadfile/202203/41d51647948525.jpg"><img src="//www.xgiu.com/content/uploadfile/202203/41d51647948525.jpg" alt="627334_d19de945_6340_2334_241@1440x647.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"></a>  </p><p>æœ€è¿‘çœ‹äº†ä¸ªå…¶ä»–è®ºå›çš„å¸–å­ï¼Œç”¨é»„é¸ŸæŠ“åŒ…å¯ä»¥ç ´è§£å‡ºç”µä¿¡å…‰çŒ«è¶…çº§å¯†ç ï¼Œæˆ‘è¯•äº†ï¼ŒçœŸçš„å¯ä»¥ï¼Œå‰ææ˜¯å…‰çŒ«å¿…é¡»å’Œå°ç¿¼ç®¡å®¶appç»‘å®šï¼Œ<br><a href="https://www.xgiu.com/content/uploadfile/202203/0e7e1647948692.jpg"><img src="//www.xgiu.com/content/uploadfile/202203/0e7e1647948692.jpg" alt="21799_2020450img_20220314_202014.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"></a><br>1. ä¸‹è½½å°ç¿¼ç®¡å®¶å¹¶é€šè¿‡WiFiæˆ–å…¶ä»–ç»‘å®šä½ çš„å…‰çŒ«ã€‚<br>2. ä¸‹è½½æŠ“åŒ…è½¯ä»¶å¦‚HttpCanaryï¼Œæ‰“å¼€ç‚¹å·¦ä¸Šè§’åœ¨ç›®æ ‡åº”ç”¨ä¸­é€‰æ‹©å°ç¿¼ç®¡å®¶ï¼Œè¿”å›ä¸»ç•Œé¢å³ä¸‹è§’å¼€å§‹æŠ“åŒ…ã€‚<br>3.æ‰“å¼€å°ç¿¼ç®¡å®¶ï¼Œä¾æ¬¡ç‚¹å‡»ï¼šç½‘ç»œ-ç½‘å…³è®¾ç½®-æŒ‡ç¤ºç¯(å¼€å¯æˆ–å…³é—­éƒ½å¯ä»¥)ã€‚<br>4.å›åˆ°æŠ“åŒ…è½¯ä»¶åœæ­¢æŠ“åŒ…ï¼Œç„¶åé•¿æŒ‰å¸¦æœ‰å¦‚å›¾ä¸­å­—ç¬¦çš„ï¼Œå¼¹å‡ºæ¥çš„å¯¹è¯æ¡†é€‰ç¼–è¾‘é‡å‘ã€‚<br><a href="https://www.xgiu.com/content/uploadfile/202203/acf61647948525.jpg"><img src="//www.xgiu.com/content/uploadfile/202203/acf61647948525.jpg" alt="627334_3243c942_6340_8637_181@1438x1228.png.m.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"></a>  </p><p><a href="https://www.xgiu.com/content/uploadfile/202203/166a1647948525.jpg"><img src="//www.xgiu.com/content/uploadfile/202203/166a1647948525.jpg" alt="627334_13b7f42d_6340_8626_752@1418x1284.jpeg.m.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"></a>  </p><p>é€‰æ‹©åœ¨çº¿ç¼–è¾‘ï¼Œåˆ é™¤åŸæ¥çš„ç²˜è´´å†…å®¹ï¼š  </p><ol><li>{ â€œParamsâ€: [], â€œMethodNameâ€: â€œGetTAPasswdâ€, â€œRPCMethodâ€: â€œCallMethodâ€, â€œObjectPathâ€: â€œ&#x2F;com&#x2F;ctc&#x2F;igd1&#x2F;Telecom&#x2F;Systemâ€, â€œInterfaceNameâ€: â€œcom.ctc.igd1.SysCmdâ€, â€œServiceNameâ€: â€œcom.ctc.igd1â€ }</li></ol><p>ç„¶åå³ä¸Šè§’ä¿å­˜ï¼Œå†å³ä¸Šè§’å‘é€ï¼Œä¹‹åä¼šæœ‰ä¸‹å›¾<br><a href="https://www.xgiu.com/content/uploadfile/202203/412a1647948525.jpg"><img src="//www.xgiu.com/content/uploadfile/202203/412a1647948525.jpg" alt="627334_5f6ebe17_6340_8631_703@1438x1230.png.m.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"></a>  </p><p>å•å‡»æ‰“å¼€ï¼Œå“åº”-é¢„è§ˆ  </p><p><a href="https://www.xgiu.com/content/uploadfile/202203/8ed71647948525.jpg"><img src="//www.xgiu.com/content/uploadfile/202203/8ed71647948525.jpg" alt="627334_c39db45c_6340_864_411@1440x3120.jpeg.m.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"></a><br>çº¢çº¿éƒ¨åˆ†å°±æ˜¯è¶…çº§å¯†ç ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…‰çŒ«</tag>
      
      <tag>ç»„æ’­</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>activemq é›†ç¾¤æ¶ˆæ¯æ¥å—ä¸åˆ°</title>
    <link href="/article/cf510801.html"/>
    <url>/article/cf510801.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><p>å…¬å¸æœ‰ä¸€å¥—å…¬å…±çš„Activemqç¯å¢ƒä¾›ä¸šåŠ¡ç³»ç»Ÿä½¿ç”¨ï¼Œç”±äºä¿¡åˆ›ï¼Œæ–°æ­å»ºäº†ä¸€å¥—6èŠ‚ç‚¹ï¼ˆä¸‰ä¸»ä¸‰ä»ï¼‰é›†ç¾¤ç¯å¢ƒï¼Œä¸šåŠ¡ç³»ç»Ÿæ¥å…¥æ—¶ååº”æ¶ˆæ¯æ¥å—ä¸åˆ°ã€‚</p><p>é€šè¿‡æŸ¥çœ‹activemqæ—¥å¿—å‘ç°æœ‰å¤§é‡è¿æ¥æŠ¥é”™ï¼Œå»æ’æŸ¥æ–‡ä»¶å‘ç°activemq.xmlçš„brokerName é…ç½®é‡å¤ã€‚</p><p>é…ç½®æ–‡ä»¶ä¿®æ”¹åé‡å¯ï¼Œå‘ç°é”™è¯¯æ¶ˆå¤±ï¼Œè‡ªæµ‹æ—¶æ­£å¸¸ç”Ÿäº§å’Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä½†ä¸šåŠ¡ç³»ç»Ÿåé¦ˆä¾ç„¶æœ‰æ¶ˆæ¯æ¶ˆè´¹ä¸åˆ°ã€‚</p><p>é€šè¿‡å¯¹æ¯”æ–°è€ç¯å¢ƒçš„é…ç½®æ–‡ä»¶æ²¡æœ‰å‘ç°å¼‚å¸¸é—®é¢˜ï¼Œæµ‹è¯•è¿æ¥è€é›†ç¾¤æ—¶å‘ç°åªæœ‰ä¸»èŠ‚ç‚¹èƒ½æ¥å—æ¶ˆæ¯ï¼Œå’Œè®¿é—®æ§åˆ¶å°ç«¯å£ï¼Œä»èŠ‚ç‚¹å‡ä¸ºä¸»ä¹‹åæ‰èƒ½è®¿é—®ã€‚ä½†æ˜¯æ–°é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½æ¥å—æ¶ˆæ¯å’Œè®¿é—®ï¼Œæ‰€ä»¥è¿˜æ˜¯æ€€ç–‘é…ç½®æ–‡ä»¶é—®é¢˜ã€‚å¯¹äº†ä¸€å¤©ä¹Ÿæ²¡å‘ç°ã€‚</p><p>ç¬¬äºŒå¤©é€šè¿‡å¯¹æ¯”æ–°è€é›†ç¾¤activemqçš„å¯åŠ¨æ—¥å¿—å‘ç°ï¼Œè€é›†ç¾¤çš„ä»èŠ‚ç‚¹å¯åŠ¨æ—¥å¿—è¦å°‘äºæ–°æœºå™¨ï¼Œé€šè¿‡å¯¹æ¯”å‘ç°</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">Database</span> /ope/activemq/data/kahadb/<span class="hljs-keyword">lock</span> <span class="hljs-keyword">is</span> locked <span class="hljs-keyword">by</span> another <span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure><p>æ–°é›†ç¾¤çš„ä»èŠ‚ç‚¹æ²¡æœ‰è¿™æ¡æ—¥å¿—ç›´æ¥å»è¿æ¥å…¶ä»–ä¸»èŠ‚ç‚¹æœåŠ¡å™¨äº†<br>å¿½ç„¶æƒ³åˆ°ï¼Œé›†ç¾¤æ˜¯åŸºäºkahadbå…±äº«å­˜å‚¨å®ç°çš„é›†ç¾¤ï¼Œåº”è¯¥æ˜¯ç”¨çš„åŒä¸€ä»½å­˜å‚¨ï¼Œå› ä¸ºæ˜¯éƒ¨ç½²åœ¨å®¹å™¨äº‘ä¸Šçš„ï¼Œå¯¹æ¯”å‘ç°ï¼Œä¸»å’Œä»çš„æŒ‚è½½ç›®å½•ä¸ä¸€æ ·ã€‚ä¿®æ”¹ä¸€è‡´åé›†ç¾¤æ­£å¸¸ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>activemq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•æ’­æ”¾ç»„æ’­æº</title>
    <link href="/article/8bf2eb81.html"/>
    <url>/article/8bf2eb81.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><p>1.ç®¡ç†å‘˜ç™»å½•å…‰çŒ«åå°<br><a href="https://zhuanlan.zhihu.com/p/621493289?utm_id=0&amp;wd=&amp;eqid=84726864000020470000000564800ebd">https://zhuanlan.zhihu.com/p/621493289?utm_id=0&amp;wd=&amp;eqid=84726864000020470000000564800ebd</a><br>2.å°†IPTVå’ŒLANç«¯å£ç”¨vlanç»‘å®šåœ¨ä¸€èµ·<br><a href="https://www.right.com.cn/forum/forum.php?mod=viewthread&amp;tid=8271973&amp;highlight=%E6%B5%8E%E5%8D%97%E8%81%94%E9%80%9A">https://www.right.com.cn/forum/forum.php?mod=viewthread&amp;tid=8271973&amp;highlight=%E6%B5%8E%E5%8D%97%E8%81%94%E9%80%9A</a></p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…‰çŒ«</tag>
      
      <tag>ç»„æ’­</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‰ç«¯åŸ‹ç‚¹å®ç°æ–¹å¼</title>
    <link href="/article/92939f72.html"/>
    <url>/article/92939f72.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><h2 id="1-ä¸ºä»€ä¹ˆä½¿ç”¨å‰ç«¯åŸ‹ç‚¹ï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆä½¿ç”¨å‰ç«¯åŸ‹ç‚¹ï¼Ÿ" class="headerlink" title="1.ä¸ºä»€ä¹ˆä½¿ç”¨å‰ç«¯åŸ‹ç‚¹ï¼Ÿ"></a>1.ä¸ºä»€ä¹ˆä½¿ç”¨å‰ç«¯åŸ‹ç‚¹ï¼Ÿ</h2><p>ä¸»è¦æ˜¯ä¸ºäº†æ”¶é›†äº§å“æ•°æ®ï¼Œå®ƒçš„ç›®çš„æ˜¯ä¸ŠæŠ¥ç›¸å…³è¡Œä¸ºæ•°æ®ï¼Œç›¸å…³äººå‘˜ä»¥æ•°æ®ä¸ºä¾æ®æ¥åˆ†æäº§å“åœ¨ç”¨æˆ·ç«¯çš„ä½¿ç”¨æƒ…å†µï¼Œæ ¹æ®åˆ†æå‡ºæ¥çš„ç»“æœè¾…åŠ©äº§å“ä¼˜åŒ–ã€è¿­ä»£ã€ä»¥åŠæ–°éœ€æ±‚çš„å¼€å‘ã€‚</p><h2 id="2-ç›®å‰é¡¹ç›®åŸ‹ç‚¹æ–¹é¢å­˜åœ¨çš„ç—›ç‚¹ï¼Ÿ"><a href="#2-ç›®å‰é¡¹ç›®åŸ‹ç‚¹æ–¹é¢å­˜åœ¨çš„ç—›ç‚¹ï¼Ÿ" class="headerlink" title="2.ç›®å‰é¡¹ç›®åŸ‹ç‚¹æ–¹é¢å­˜åœ¨çš„ç—›ç‚¹ï¼Ÿ"></a>2.ç›®å‰é¡¹ç›®åŸ‹ç‚¹æ–¹é¢å­˜åœ¨çš„ç—›ç‚¹ï¼Ÿ</h2><p>1.é€»è¾‘å¤ç”¨é—®é¢˜ï¼šç‰¹åˆ«æ˜¯æ›å…‰ç›¸å…³çš„ç‚¹éœ€è¦åœ¨ä¸šåŠ¡ä»£ç é‡Œé¢åšé¢å¤–çš„å¤„ç†ï¼Œæ‰€ä»¥é€»è¾‘å¤ç”¨å¾ˆå›°éš¾ï¼Œå¯¹ç°æœ‰ä»£ç çš„ä¾µå…¥ä¹Ÿå¾ˆä¸¥é‡ï¼›</p><p>2.åŸ‹ç‚¹åœ¨å¤šä¸ªé¡¹ç›®ä¸­åˆ†æ•£å­˜åœ¨ï¼Œç»´æŠ¤ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚</p><h2 id="3-å‰ç«¯åŸ‹ç‚¹æ–¹æ¡ˆ"><a href="#3-å‰ç«¯åŸ‹ç‚¹æ–¹æ¡ˆ" class="headerlink" title="3.å‰ç«¯åŸ‹ç‚¹æ–¹æ¡ˆ"></a>3.å‰ç«¯åŸ‹ç‚¹æ–¹æ¡ˆ</h2><p>ç›®å‰ä¸»è¦æœ‰ 3 ç§æ–¹æ¡ˆï¼š</p><p>1.æ‰‹åŠ¨ä»£ç åŸ‹ç‚¹ï¼šç”¨æˆ·è§¦å‘æŸä¸ªåŠ¨ä½œåæ‰‹åŠ¨ä¸ŠæŠ¥æ•°æ® ä¼˜ç‚¹ï¼šæ˜¯æœ€å‡†ç¡®çš„ï¼Œå¯ä»¥æ»¡è¶³å¾ˆå¤šå®šåˆ¶åŒ–çš„éœ€æ±‚ã€‚ ç¼ºç‚¹ï¼šåŸ‹ç‚¹é€»è¾‘ä¸ä¸šåŠ¡ä»£ç è€¦åˆåˆ°ä¸€èµ·ï¼Œä¸åˆ©äºä»£ç ç»´æŠ¤å’Œå¤ç”¨ã€‚</p><p>2.å¯è§†åŒ–åŸ‹ç‚¹ï¼šé€šè¿‡å¯è§†åŒ–å·¥å…·é…ç½®é‡‡é›†èŠ‚ç‚¹ï¼ŒæŒ‡å®šè‡ªå·±æƒ³è¦ç›‘æµ‹çš„å…ƒç´ å’Œå±æ€§ã€‚æ ¸å¿ƒæ˜¯æŸ¥æ‰¾ dom ç„¶åç»‘å®šäº‹ä»¶ï¼Œä¸šç•Œæ¯”è¾ƒæœ‰åçš„æ˜¯ Mixpanelã€GrowingIOã€ç¥ç­– ä¼˜ç‚¹ï¼šå¯ä»¥åšåˆ°æŒ‰éœ€é…ç½®ï¼Œåˆä¸ä¼šåƒå…¨åŸ‹ç‚¹é‚£æ ·äº§ç”Ÿå¤§é‡çš„æ— ç”¨æ•°æ®ã€‚ ç¼ºç‚¹ï¼šæ¯”è¾ƒéš¾åŠ è½½ä¸€äº›è¿è¡Œæ—¶å‚æ•°ï¼›é¡µé¢ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå¯èƒ½å°±éœ€è¦è¿›è¡Œéƒ¨åˆ†é‡æ–°é…ç½®ã€‚</p><p>3.æ— åŸ‹ç‚¹ï¼šä¹Ÿå«â€œå…¨åŸ‹ç‚¹â€ï¼Œå‰ç«¯è‡ªåŠ¨é‡‡é›†å…¨éƒ¨äº‹ä»¶å¹¶ä¸ŠæŠ¥åŸ‹ç‚¹æ•°æ®ï¼Œåœ¨åç«¯æ•°æ®è®¡ç®—æ—¶è¿‡æ»¤å‡ºæœ‰ç”¨æ•°æ® ä¼˜ç‚¹ï¼šæ”¶é›†ç”¨æˆ·çš„æ‰€æœ‰ç«¯ä¸Šè¡Œä¸ºï¼Œå¾ˆå…¨é¢ã€‚ ç¼ºç‚¹ï¼šæ— æ•ˆçš„æ•°æ®å¾ˆå¤šã€ä¸ŠæŠ¥æ•°æ®é‡å¤§ã€‚</p><h2 id="4-åŸ‹ç‚¹æ–¹å¼"><a href="#4-åŸ‹ç‚¹æ–¹å¼" class="headerlink" title="4.åŸ‹ç‚¹æ–¹å¼"></a>4.åŸ‹ç‚¹æ–¹å¼</h2><p>æŒ‰ç…§è·å–æ•°æ®çš„æ–¹å¼ä¸€èˆ¬åˆ†ä¸ºä¸‰ç±»ï¼š</p><p>é¡µé¢åŸ‹ç‚¹ï¼šç»Ÿè®¡ç”¨æˆ·è¿›å…¥æˆ–ç¦»å¼€é¡µé¢çš„å„ç§ç»´åº¦ä¿¡æ¯ï¼Œå¦‚é¡µé¢æµè§ˆæ¬¡æ•°ï¼ˆPVï¼‰ã€æµè§ˆé¡µé¢äººæ•°ï¼ˆUVï¼‰ã€é¡µé¢åœç•™æ—¶é—´ã€æµè§ˆå™¨ä¿¡æ¯ç­‰ã€‚</p><p>ç‚¹å‡»åŸ‹ç‚¹ï¼šç»Ÿè®¡ç”¨æˆ·åœ¨åº”ç”¨å†…çš„æ¯ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶ï¼Œå¦‚æŠ¥ä»·åˆ—è¡¨çš„æµè§ˆæ¬¡æ•°ã€å†æ¬¡è¯¢ä»·çš„æ¬¡æ•°ç­‰ã€‚</p><p>æ›å…‰åŸ‹ç‚¹ï¼šç»Ÿè®¡å…·ä½“åŒºåŸŸæ˜¯å¦è¢«ç”¨æˆ·æµè§ˆåˆ°ï¼Œå¦‚æ´»åŠ¨çš„å¼•æµå…¥å£çš„æ˜¾ç¤ºã€æŠ•æ”¾å¹¿å‘Šçš„æ˜¾ç¤ºç­‰</p><h2 id="5-åŸ‹ç‚¹æ–¹æ¡ˆ"><a href="#5-åŸ‹ç‚¹æ–¹æ¡ˆ" class="headerlink" title="5.åŸ‹ç‚¹æ–¹æ¡ˆ"></a>5.åŸ‹ç‚¹æ–¹æ¡ˆ</h2><p>ç›®å‰æˆ‘ä»¬é¡¹ç›®ä¸­åŸ‹ç‚¹éœ€æ±‚ä¸»è¦æœ‰ï¼Œç‚¹å‡»åŸ‹ç‚¹ï¼ˆdomç‚¹å‡»ï¼‰ã€é¡µé¢åŸ‹ç‚¹ï¼ˆä¸»è¦æ˜¯pvï¼‰ã€‚å†æ ¹æ®æˆ‘ä»¬ç›®å‰é€‰ç”¨çš„vueæŠ€æœ¯æ ˆï¼Œæ‰€ä»¥è€ƒè™‘äº†ä»¥ä¸‹ä¸¤ç§å®ç°æ–¹å¼ï¼šç»„ä»¶æ–¹å¼æˆ–è€…æŒ‡ä»¤æ–¹å¼</p><p>ç‚¹å‡»åŸ‹ç‚¹å¼€å§‹çš„æ˜¯æƒ³æä¾›ä¸€ä¸ªç»„ä»¶ï¼ŒåŒ…è£¹éœ€è¦è¿›è¡Œç‚¹å‡»åŸ‹ç‚¹çš„ dom å…ƒç´ ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç»„ä»¶ï¼Œç„¶åç»™å­å…ƒç´ ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œå½“ç”¨æˆ·è§¦å‘äº‹ä»¶æ—¶è¿›è¡ŒåŸ‹ç‚¹ç›¸å…³å¤„ç†ã€‚</p><p>ä½†æ˜¯è¿™æ ·å°±å¿…é¡»ç»‘å®šç‚¹å‡»äº‹ä»¶åˆ° dom ä¸Šï¼Œä½†æ˜¯åˆä¸æƒ³åœ¨æ–‡æ¡£ç»“æ„ä¸­å¼•å…¥é¢å¤–çš„ dom å…ƒç´ ï¼Œå› ä¸ºè¿™ä¼šå¢åŠ  dom ç»“æ„å±‚çº§ï¼Œå±‚çº§ä¼šå˜å¾—æ›´å¤æ‚ã€‚</p><p>æ‰€ä»¥æœ€ç»ˆé‡‡ç”¨äº†è‡ªå®šä¹‰æŒ‡ä»¤çš„æ–¹å¼ã€‚</p><h2 id="6-é¡¹ç›®åŸ‹ç‚¹å®ç°"><a href="#6-é¡¹ç›®åŸ‹ç‚¹å®ç°" class="headerlink" title="6. é¡¹ç›®åŸ‹ç‚¹å®ç°"></a>6. é¡¹ç›®åŸ‹ç‚¹å®ç°</h2><p>ä½¿ç”¨ç­–ç•¥æ¨¡å¼åˆ†åˆ«å¤„ç†åŸ‹ç‚¹éœ€æ±‚ï¼š</p><p>vbnet</p><p>å¤åˆ¶ä»£ç </p><p><code>/**  * @description: åŸ‹ç‚¹æ–¹å¼ï¼šç‚¹å‡»åŸ‹ç‚¹ã€é¡µé¢PV  * @param &#123;key&#125; åŸ‹ç‚¹keyå€¼  * @return &#123;el&#125; ç‚¹å‡»åŸ‹ç‚¹è¢«ç»‘å®šçš„å…ƒç´   */ const handler = &#123;   click (key, el) &#123;     el.addEventListener(&#39;click&#39;, () =&gt; &#123;       appPointBatchInsert(key)     &#125;)   &#125;,   pv (key) &#123;     appPointBatchInsert(key)   &#125; &#125;</code></p><p>è‡ªå®šä¹‰åŸ‹ç‚¹æŒ‡ä»¤</p><p>typescript</p><p>å¤åˆ¶ä»£ç </p><p><code>const Point = &#123;&#125; Point.install = Vue =&gt; &#123;   Vue.directive(&#39;point&#39;, &#123;     inserted (el, binding) &#123;       const data = binding.value       if (data) &#123;         const &#123; key, type &#125; = data         handler[type](key, el)       &#125; else &#123;         throw new Error(&#39;è¯·è¡¥å……æ­£ç¡®çš„åŸ‹ç‚¹å‚æ•°&#39;)       &#125;     &#125;   &#125;, false) &#125; export default Point</code></p><p>ä½¿ç”¨ç¤ºä¾‹</p><p>main.js</p><p>å¤åˆ¶ä»£ç </p><p><code>import point from &#39;@/utils/directive/point.js&#39; Vue.use(point)</code></p><p>xml</p><p>å¤åˆ¶ä»£ç </p><p><code>&lt;!-- ç‚¹å‡»åŸ‹ç‚¹ --&gt; &lt;el-button v-point=&quot;&#123;key: &#39;additionalInquiryClickKey&#39;, type: &#39;click&#39;&#125;&quot;&gt;è¿½åŠ &lt;/el-button&gt; &lt;!-- é¡µé¢pvåŸ‹ç‚¹: sectionä¸ºé¡µé¢æ ¹å…ƒç´  --&gt; &lt;section class=&quot;additional-inquiry&quot; v-point=&quot;&#123;key: &#39;additionalInquiryKey&#39;, type: &#39;pv&#39;&#125;&quot;&gt; ...</code></p><h2 id="7ã€ä¹‹åæ‹“å±•æ–¹å‘"><a href="#7ã€ä¹‹åæ‹“å±•æ–¹å‘" class="headerlink" title="7ã€ä¹‹åæ‹“å±•æ–¹å‘"></a>7ã€ä¹‹åæ‹“å±•æ–¹å‘</h2><p>æ›å…‰åŸ‹ç‚¹ï¼ˆå¯èƒ½äº§å“éœ€æ±‚æ–¹å‘ï¼Ÿï¼Ÿï¼‰ æ€è·¯ï¼šå½“æŒ‡ä»¤ç¬¬ä¸€ç»‘å®šåœ¨å…ƒç´ ä¸Šæ—¶ç›‘å¬ç›®æ ‡å…ƒç´ ï¼Œå½“æŒ‡ä»¤ä»å…ƒç´ ä¸Šè§£ç»‘æ—¶åœæ­¢ç›‘å¬ç›®æ ‡å…ƒç´ ã€‚</p><p>javascript</p><p>å¤åˆ¶ä»£ç </p><p><code>const options = &#123;     root: null, //é»˜è®¤æµè§ˆå™¨è§†çª—     threshold: 1 //å…ƒç´ å®Œå…¨å‡ºç°åœ¨æµè§ˆå™¨è§†çª—å†…æ‰æ‰§è¡Œcallbackå‡½æ•°ã€‚ &#125; const callback =(entries, observer) =&gt; &#123;   entries.forEach(entry =&gt; &#123;&#125;) &#125; const observer = new IntersectionObserver(callback, options) const addListenner = (ele, binding) =&gt; &#123;  observer.observe(ele) &#125; const removeListener = (ele) =&gt; &#123;   observer.unobserve(ele) &#125; //è‡ªå®šä¹‰æ›å…‰æŒ‡ä»¤ Vue.directive(&#39;point&#39;, &#123;   bind: addListenner,   unbind: removeListener &#125;)</code></p><p>æ³¨æ„ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªlistå°†å·²ç»ä¸ŠæŠ¥è¿‡çš„åŸ‹ç‚¹ä¿¡æ¯è®°å½•ä¸‹æ¥ï¼Œé˜²æ­¢é‡å¤æ›å…‰ã€‚</p><p>scss</p><p>å¤åˆ¶ä»£ç </p><p><code>let pointList = []; //è®°å½•å·²ç»ä¸ŠæŠ¥è¿‡çš„åŸ‹ç‚¹ä¿¡æ¯ const addListenner = (ele, binding) =&gt; &#123;  if(pointList.indexOf(binding.value) !== -1) return  observer.observe(ele) &#125;</code></p><p>æˆ‘ä»¬å°†è¦ä¸ŠæŠ¥çš„ä¿¡æ¯ç»‘å®šåœ¨ç›®æ ‡å…ƒç´ çš„ â€˜point-dataâ€™ å±æ€§ä¸­ï¼Œå½“ç›®æ ‡å…ƒç´ å‡ºç°åœ¨è§†çª—å†…æ—¶ï¼Œå¹¶åœç•™ 5 ç§’ä»¥ä¸Š(æˆ–è€…è§„å®šè®°å½•ç§’æ•°æ—¶)æ—¶ï¼Œä¸ŠæŠ¥åŸ‹ç‚¹ä¿¡æ¯ã€‚</p><p>javascript</p><p>å¤åˆ¶ä»£ç </p><p><code>let timer = &#123;&#125; //å¢åŠ å®šæ—¶å™¨å¯¹è±¡ const callback = entries =&gt; &#123;   entries.forEach(entry =&gt; &#123;     let pointData = null     try &#123;       pointData = JSON.parse(entry.target.getAttribute(&#39;point-data&#39;))     &#125; catch (e) &#123;       pointData = null       console.error(&#39;åŸ‹ç‚¹æ•°æ®æ ¼å¼å¼‚å¸¸&#39;, e)     &#125;     //æ²¡æœ‰åŸ‹ç‚¹æ•°æ®å–æ¶ˆä¸ŠæŠ¥     if (!pointData) &#123;       observer.unobserve(entry.target)       return     &#125;     if (entry.isIntersecting) &#123;       timer[pointData.id] = setTimeout(function() &#123;         //ä¸ŠæŠ¥åŸ‹ç‚¹ä¿¡æ¯         sendUtm(pointData).then(res =&gt; &#123;           if (res.success) &#123;             //ä¸ŠæŠ¥æˆåŠŸåå–æ¶ˆç›‘å¬             observer.unobserve(entry.target)             visuallyList.push(pointData.id)             timer[pointData.id] = null           &#125;         &#125;)       &#125;, 5000)   &#125; else &#123;     if (timer[pointData.id]) &#123;       clearTimeout(timer[pointData.id])       timer[pointData.id] = null     &#125;   &#125;   &#125;) &#125;</code></p><p>åœ¨ä»£ç ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨æŒ‡ä»¤å®ç°æ›å…‰åŸ‹ç‚¹äº†ï¼š</p><p>ruby</p><p>å¤åˆ¶ä»£ç </p><p><code>&lt;div v-point=&quot;pointData.id&quot; :point-data=&quot;JSON.stringify(pointData)&quot;&gt;&lt;/div&gt;</code></p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mavenä¾èµ–çŸ¥è¯†ç‚¹</title>
    <link href="/article/9957a42b.html"/>
    <url>/article/9957a42b.html</url>
    
    <content type="html"><![CDATA[<h1 id="Mavenä¾èµ–ç®¡ç†é¡¹ç›®æ„å»ºå·¥å…·"><a href="#Mavenä¾èµ–ç®¡ç†é¡¹ç›®æ„å»ºå·¥å…·" class="headerlink" title="Mavenä¾èµ–ç®¡ç†é¡¹ç›®æ„å»ºå·¥å…·"></a>Mavenä¾èµ–ç®¡ç†é¡¹ç›®æ„å»ºå·¥å…·</h1><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><p>[TOC]</p><h2 id="ä¸€ã€Mavenç®€ä»‹"><a href="#ä¸€ã€Mavenç®€ä»‹" class="headerlink" title="ä¸€ã€Mavenç®€ä»‹"></a>ä¸€ã€Mavenç®€ä»‹</h2><h3 id="1ã€ä¸ºä»€ä¹ˆå­¦ä¹ Maven"><a href="#1ã€ä¸ºä»€ä¹ˆå­¦ä¹ Maven" class="headerlink" title="1ã€ä¸ºä»€ä¹ˆå­¦ä¹ Maven"></a>1ã€ä¸ºä»€ä¹ˆå­¦ä¹ Maven</h3><h4 id="1-1ã€Mavenæ˜¯ä¸€ä¸ªä¾èµ–ç®¡ç†å·¥å…·"><a href="#1-1ã€Mavenæ˜¯ä¸€ä¸ªä¾èµ–ç®¡ç†å·¥å…·" class="headerlink" title="1.1ã€Mavenæ˜¯ä¸€ä¸ªä¾èµ–ç®¡ç†å·¥å…·"></a>1.1ã€Mavenæ˜¯ä¸€ä¸ªä¾èµ–ç®¡ç†å·¥å…·</h4><p>â‘ jar åŒ…çš„è§„æ¨¡</p><p>éšç€æˆ‘ä»¬ä½¿ç”¨è¶Šæ¥è¶Šå¤šçš„æ¡†æ¶ï¼Œæˆ–è€…æ¡†æ¶å°è£…ç¨‹åº¦è¶Šæ¥è¶Šé«˜ï¼Œé¡¹ç›®ä¸­ä½¿ç”¨çš„jaråŒ…ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚é¡¹ç›®ä¸­ï¼Œä¸€ä¸ªæ¨¡å—é‡Œé¢ç”¨åˆ°ä¸Šç™¾ä¸ªjaråŒ…æ˜¯éå¸¸æ­£å¸¸çš„ã€‚</p><p>æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬åªç”¨åˆ° SpringBootã€SpringCloud æ¡†æ¶ä¸­çš„ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li><p>Nacos æœåŠ¡æ³¨å†Œå‘ç°</p></li><li><p>Web æ¡†æ¶ç¯å¢ƒ</p></li><li><p>è§†å›¾æ¨¡æ¿æŠ€æœ¯ Thymeleaf</p></li></ul><p>æœ€ç»ˆå´å¯¼å…¥äº† 106 ä¸ª jar åŒ…ï¼š</p><blockquote><p>org.springframework.security:spring-security-rsa:jar:1.0.9.RELEASE:compile</p></blockquote><blockquote><p>com.netflix.ribbon: ribbon:jar:2.3.0:compile</p></blockquote><blockquote><p>org.springframework.boot:spring-boot-starter-thymeleaf:jar:2.3.6.RELEASE:compile</p></blockquote><blockquote><p>commons-configuration:commons-configuration:jar:1.8:compile</p></blockquote><blockquote><p>org.apache.logging.log4j:log4j-api:jar:2.13.3:compile</p></blockquote><blockquote><p>org.springframework:spring-beans:jar:5.2.11.RELEASE:compile</p></blockquote><blockquote><p>org.springframework.cloud:spring-cloud-starter-netflix-ribbon:jar:2.2.6.RELEASE:compile</p></blockquote><blockquote><p>org.apache.tomcat.embed:tomcat-embed-websocket:jar:9.0.39:compile</p></blockquote><blockquote><p>com.alibaba.cloud:spring-cloud-alibaba-commons:jar:2.2.6.RELEASE:compile</p></blockquote><blockquote><p>org.bouncycastle:bcprov-jdk15on:jar:1.64:compile</p></blockquote><blockquote><p>org.springframework.security:spring-security-crypto:jar:5.3.5.RELEASE:compile</p></blockquote><blockquote><p>org.apache.httpcomponents:httpasyncclient:jar:4.1.4:compile</p></blockquote><blockquote><p>com.google.j2objc:j2objc-annotations:jar:1.3:compile</p></blockquote><blockquote><p>com.fasterxml.jackson.core:jackson-databind:jar:2.11.3:compile</p></blockquote><blockquote><p>io.reactivex:rxjava:jar:1.3.8:compile</p></blockquote><blockquote><p>ch.qos.logback:logback-classic:jar:1.2.3:compile</p></blockquote><blockquote><p>org.springframework:spring-web:jar:5.2.11.RELEASE:compile</p></blockquote><blockquote><p>io.reactivex:rxnetty-servo:jar:0.4.9:runtime</p></blockquote><blockquote><p>org.springframework:spring-core:jar:5.2.11.RELEASE:compile</p></blockquote><blockquote><p>io.github.openfeign.form:feign-form-spring:jar:3.8.0:compile</p></blockquote><blockquote><p>io.github.openfeign.form:feign-form:jar:3.8.0:compile</p></blockquote><blockquote><p>com.netflix.ribbon:ribbon-loadbalancer:jar:2.3.0:compile</p></blockquote><blockquote><p>org.apache.httpcomponents:httpcore:jar:4.4.13:compile</p></blockquote><blockquote><p>org.thymeleaf.extras:thymeleaf-extras-java8time:jar:3.0.4.RELEASE:compile</p></blockquote><blockquote><p>org.slf4j:jul-to-slf4j:jar:1.7.30:compile</p></blockquote><blockquote><p>com.atguigu.demo:demo09-base-entity:jar:1.0-SNAPSHOT:compile</p></blockquote><blockquote><p>org.yaml:snakeyaml:jar:1.26:compile</p></blockquote><blockquote><p>org.springframework.boot:spring-boot-starter-logging:jar:2.3.6.RELEASE:compile</p></blockquote><blockquote><p>io.reactivex:rxnetty-contexts:jar:0.4.9:runtime</p></blockquote><blockquote><p>org.apache.httpcomponents:httpclient:jar:4.5.13:compile</p></blockquote><blockquote><p>io.github.openfeign:feign-core:jar:10.10.1:compile</p></blockquote><blockquote><p>org.springframework.boot:spring-boot-starter-aop:jar:2.3.6.RELEASE:compile</p></blockquote><blockquote><p>org.hdrhistogram:HdrHistogram:jar:2.1.9:compile</p></blockquote><blockquote><p>org.springframework:spring-context:jar:5.2.11.RELEASE:compile</p></blockquote><blockquote><p>commons-lang:commons-lang:jar:2.6:compile</p></blockquote><blockquote><p>io.prometheus:simpleclient:jar:0.5.0:compile</p></blockquote><blockquote><p>ch.qos.logback:logback-core:jar:1.2.3:compile</p></blockquote><blockquote><p>org.springframework:spring-webmvc:jar:5.2.11.RELEASE:compile</p></blockquote><blockquote><p>com.sun.jersey:jersey-core:jar:1.19.1:runtime</p></blockquote><blockquote><p>javax.ws.rs:jsr311-api:jar:1.1.1:runtime</p></blockquote><blockquote><p>javax.inject:javax.inject:jar:1:runtime</p></blockquote><blockquote><p>org.springframework.cloud:spring-cloud-openfeign-core:jar:2.2.6.RELEASE:compile</p></blockquote><blockquote><p>com.netflix.ribbon:ribbon-core:jar:2.3.0:compile</p></blockquote><blockquote><p>com.netflix.hystrix:hystrix-core:jar:1.5.18:compile</p></blockquote><blockquote><p>com.netflix.ribbon:ribbon-transport:jar:2.3.0:runtime</p></blockquote><blockquote><p>org.springframework.boot:spring-boot-starter-json:jar:2.3.6.RELEASE:compile</p></blockquote><blockquote><p>org.springframework.cloud:spring-cloud-starter-openfeign:jar:2.2.6.RELEASE:compile</p></blockquote><blockquote><p>com.fasterxml.jackson.module:jackson-module-parameter-names:jar:2.11.3:compile</p></blockquote><blockquote><p>com.sun.jersey.contribs:jersey-apache-client4:jar:1.19.1:runtime</p></blockquote><blockquote><p>io.github.openfeign:feign-hystrix:jar:10.10.1:compile</p></blockquote><blockquote><p>io.github.openfeign:feign-slf4j:jar:10.10.1:compile</p></blockquote><blockquote><p>com.alibaba.nacos:nacos-client:jar:1.4.2:compile</p></blockquote><blockquote><p>org.apache.httpcomponents:httpcore-nio:jar:4.4.13:compile</p></blockquote><blockquote><p>com.sun.jersey:jersey-client:jar:1.19.1:runtime</p></blockquote><blockquote><p>org.springframework.cloud:spring-cloud-context:jar:2.2.6.RELEASE:compile</p></blockquote><blockquote><p>org.glassfish:jakarta.el:jar:3.0.3:compile</p></blockquote><blockquote><p>org.apache.logging.log4j:log4j-to-slf4j:jar:2.13.3:compile</p></blockquote><blockquote><p>com.fasterxml.jackson.datatype:jackson-datatype-jsr310:jar:2.11.3:compile</p></blockquote><blockquote><p>org.springframework.cloud:spring-cloud-commons:jar:2.2.6.RELEASE:compile</p></blockquote><blockquote><p>org.aspectj:aspectjweaver:jar:1.9.6:compile</p></blockquote><blockquote><p>com.alibaba.cloud:spring-cloud-starter-alibaba-nacos-discovery:jar:2.2.6.RELEASE:compile</p></blockquote><blockquote><p>com.google.guava:listenablefuture:jar:9999.0-empty-to-avoid-conflict-with-guava:compile</p></blockquote><blockquote><p>com.alibaba.spring:spring-context-support:jar:1.0.10:compile</p></blockquote><blockquote><p>jakarta.annotation:jakarta.annotation-api:jar:1.3.5:compile</p></blockquote><blockquote><p>org.bouncycastle:bcpkix-jdk15on:jar:1.64:compile</p></blockquote><blockquote><p>com.netflix.netflix-commons:netflix-commons-util:jar:0.3.0:runtime</p></blockquote><blockquote><p>com.fasterxml.jackson.core:jackson-annotations:jar:2.11.3:compile</p></blockquote><blockquote><p>com.google.guava:guava:jar:29.0-jre:compile</p></blockquote><blockquote><p>com.google.guava:failureaccess:jar:1.0.1:compile</p></blockquote><blockquote><p>org.springframework.boot:spring-boot:jar:2.3.6.RELEASE:compile</p></blockquote><blockquote><p>com.fasterxml.jackson.datatype:jackson-datatype-jdk8:jar:2.11.3:compile</p></blockquote><blockquote><p>com.atguigu.demo:demo08-base-api:jar:1.0-SNAPSHOT:compile</p></blockquote><blockquote><p>org.springframework.cloud:spring-cloud-starter-netflix-archaius:jar:2.2.6.RELEASE:compile</p></blockquote><blockquote><p>org.springframework.boot:spring-boot-autoconfigure:jar:2.3.6.RELEASE:compile</p></blockquote><blockquote><p>org.slf4j:slf4j-api:jar:1.7.30:compile</p></blockquote><blockquote><p>commons-io:commons-io:jar:2.7:compile</p></blockquote><blockquote><p>org.springframework.cloud:spring-cloud-starter:jar:2.2.6.RELEASE:compile</p></blockquote><blockquote><p>org.apache.tomcat.embed:tomcat-embed-core:jar:9.0.39:compile</p></blockquote><blockquote><p>io.reactivex:rxnetty:jar:0.4.9:runtime</p></blockquote><blockquote><p>com.fasterxml.jackson.core:jackson-core:jar:2.11.3:compile</p></blockquote><blockquote><p>com.google.code.findbugs:jsr305:jar:3.0.2:compile</p></blockquote><blockquote><p>com.netflix.archaius:archaius-core:jar:0.7.6:compile</p></blockquote><blockquote><p>org.springframework.boot:spring-boot-starter-web:jar:2.3.6.RELEASE:compile</p></blockquote><blockquote><p>commons-codec:commons-codec:jar:1.14:compile</p></blockquote><blockquote><p>com.netflix.servo:servo-core:jar:0.12.21:runtime</p></blockquote><blockquote><p>com.google.errorprone:error_prone_annotations:jar:2.3.4:compile</p></blockquote><blockquote><p>org.attoparser:attoparser:jar:2.0.5.RELEASE:compile</p></blockquote><blockquote><p>com.atguigu.demo:demo10-base-util:jar:1.0-SNAPSHOT:compile</p></blockquote><blockquote><p>org.checkerframework:checker-qual:jar:2.11.1:compile</p></blockquote><blockquote><p>org.thymeleaf:thymeleaf-spring5:jar:3.0.11.RELEASE:compile</p></blockquote><blockquote><p>commons-fileupload:commons-fileupload:jar:1.4:compile</p></blockquote><blockquote><p>com.netflix.ribbon:ribbon-httpclient:jar:2.3.0:compile</p></blockquote><blockquote><p>com.netflix.netflix-commons:netflix-statistics:jar:0.1.1:runtime</p></blockquote><blockquote><p>org.unbescape:unbescape:jar:1.1.6.RELEASE:compile</p></blockquote><blockquote><p>org.springframework:spring-jcl:jar:5.2.11.RELEASE:compile</p></blockquote><blockquote><p>com.alibaba.nacos:nacos-common:jar:1.4.2:compile</p></blockquote><blockquote><p>commons-collections:commons-collections:jar:3.2.2:runtime</p></blockquote><blockquote><p>javax.persistence:persistence-api:jar:1.0:compile</p></blockquote><blockquote><p>com.alibaba.nacos:nacos-api:jar:1.4.2:compile</p></blockquote><blockquote><p>org.thymeleaf:thymeleaf:jar:3.0.11.RELEASE:compile</p></blockquote><blockquote><p>org.springframework:spring-aop:jar:5.2.11.RELEASE:compile</p></blockquote><blockquote><p>org.springframework.boot:spring-boot-starter:jar:2.3.6.RELEASE:compile</p></blockquote><blockquote><p>org.springframework.boot:spring-boot-starter-tomcat:jar:2.3.6.RELEASE:compile</p></blockquote><blockquote><p>org.springframework.cloud:spring-cloud-netflix-ribbon:jar:2.2.6.RELEASE:compile</p></blockquote><blockquote><p>org.springframework:spring-expression:jar:5.2.11.RELEASE:compile</p></blockquote><blockquote><p>org.springframework.cloud:spring-cloud-netflix-archaius:jar:2.2.6.RELEASE:compile</p></blockquote><p>è€Œå¦‚æœä½¿ç”¨ Maven æ¥å¼•å…¥è¿™äº› jar åŒ…åªéœ€è¦é…ç½®ä¸‰ä¸ªã€<strong>ä¾èµ–</strong>ã€ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-comment">&lt;!-- Nacos æœåŠ¡æ³¨å†Œå‘ç°å¯åŠ¨å™¨ --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <br><br><span class="hljs-comment">&lt;!-- webå¯åŠ¨å™¨ä¾èµ– --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <br><br><span class="hljs-comment">&lt;!-- è§†å›¾æ¨¡æ¿æŠ€æœ¯ thymeleaf --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>â‘¡jaråŒ…çš„æ¥æºé—®é¢˜</p><ul><li><p>è¿™ä¸ªjaråŒ…æ‰€å±æŠ€æœ¯çš„å®˜ç½‘ã€‚å®˜ç½‘é€šå¸¸æ˜¯è‹±æ–‡ç•Œé¢ï¼Œç½‘ç«™çš„ç»“æ„åˆä¸å°½ç›¸åŒï¼Œç”šè‡³æ‰¾åˆ°ä¸‹è½½é“¾æ¥è¿˜å‘ç°éœ€è¦é€šè¿‡ç‰¹æ®Šçš„å·¥å…·ä¸‹è½½ã€‚</p></li><li><p>ç¬¬ä¸‰æ–¹ç½‘ç«™æä¾›ä¸‹è½½ã€‚é—®é¢˜æ˜¯ä¸è§„èŒƒï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šå‡ºç°å„ç§é—®é¢˜ã€‚</p></li></ul><p>Â  - jaråŒ…çš„åç§°</p><p>Â  - jaråŒ…çš„ç‰ˆæœ¬</p><p>Â  - jaråŒ…å†…çš„å…·ä½“ç»†èŠ‚</p><ul><li>è€Œä½¿ç”¨ Maven åï¼Œä¾èµ–å¯¹åº”çš„ jar åŒ…èƒ½å¤Ÿ<strong>è‡ªåŠ¨ä¸‹è½½</strong>ï¼Œæ–¹ä¾¿ã€å¿«æ·åˆè§„èŒƒã€‚</li></ul><p>â‘¢jaråŒ…çš„å¯¼å…¥é—®é¢˜</p><p>åœ¨webå·¥ç¨‹ä¸­ï¼ŒjaråŒ…å¿…é¡»å­˜æ”¾åœ¨æŒ‡å®šä½ç½®ï¼š</p><p><img src="/image/image-20231021101825708.png" alt="image-20231021101825708"></p><p>åœ¨ä½¿ç”¨Mavenä¹‹åï¼Œé€šè¿‡é…ç½®ä¾èµ–(jaråŒ…)çš„åæ ‡ï¼ŒæŸ¥æ‰¾æœ¬åœ°ä»“åº“ä¸­ç›¸åº”jaråŒ…ï¼Œè‹¥æœ¬åœ°ä»“åº“æ²¡æœ‰ï¼Œåˆ™ç»Ÿä¸€ä»é•œåƒç½‘ç«™æˆ–ä¸­å¤®ä»“åº“ä¸­ä¸‹è½½ï¼š</p><p><img src="/image/image-20231021102831531.png" alt="image-20231021102831531"></p><p>â‘£jaråŒ…ä¹‹é—´çš„ä¾èµ–</p><p>æ¡†æ¶ä¸­ä½¿ç”¨çš„ jar åŒ…ï¼Œä¸ä»…æ•°é‡åºå¤§ï¼Œè€Œä¸”å½¼æ­¤ä¹‹é—´å­˜åœ¨é”™ç»¼å¤æ‚çš„ä¾èµ–å…³ç³»ã€‚ä¾èµ–å…³ç³»çš„å¤æ‚ç¨‹åº¦ï¼Œå·²ç»ä¸Šå‡åˆ°äº†å®Œå…¨ä¸èƒ½é äººåŠ›æ‰‹åŠ¨è§£å†³çš„ç¨‹åº¦ã€‚å¦å¤–ï¼Œjar åŒ…ä¹‹é—´æœ‰å¯èƒ½äº§ç”Ÿå†²çªã€‚è¿›ä¸€æ­¥å¢åŠ äº†æˆ‘ä»¬åœ¨ jar åŒ…ä½¿ç”¨è¿‡ç¨‹ä¸­çš„éš¾åº¦ã€‚</p><p>ä¸‹é¢æ˜¯å‰é¢ä¾‹å­ä¸­ jar åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼š</p><p><img src="/image/img006.ab4f2e31.png" alt="images"></p><p>è€Œå®é™…ä¸Š jar åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»æ˜¯æ™®éå­˜åœ¨çš„ï¼Œå¦‚æœè¦ç”±ç¨‹åºå‘˜æ‰‹åŠ¨æ¢³ç†æ— ç–‘ä¼šå¢åŠ æé«˜çš„å­¦ä¹ æˆæœ¬ï¼Œè€Œè¿™äº›å·¥ä½œåˆå¯¹å®ç°ä¸šåŠ¡åŠŸèƒ½æ¯«æ— å¸®åŠ©ã€‚</p><p>è€Œä½¿ç”¨ Maven åˆ™å‡ ä¹ä¸éœ€è¦ç®¡ç†è¿™äº›å…³ç³»ï¼Œæä¸ªåˆ«çš„åœ°æ–¹è°ƒæ•´ä¸€ä¸‹å³å¯ï¼Œæå¤§çš„å‡è½»äº†æˆ‘ä»¬çš„å·¥ä½œé‡ã€‚</p><h4 id="1-2ã€Mavenæ˜¯ä¸€ä¸ªæ„å»ºå·¥å…·"><a href="#1-2ã€Mavenæ˜¯ä¸€ä¸ªæ„å»ºå·¥å…·" class="headerlink" title="1.2ã€Mavenæ˜¯ä¸€ä¸ªæ„å»ºå·¥å…·"></a>1.2ã€Mavenæ˜¯ä¸€ä¸ªæ„å»ºå·¥å…·</h4><p>â‘ ä½ æ²¡æœ‰æ³¨æ„è¿‡çš„æ„å»º</p><p>ä½ å¯ä»¥ä¸ä½¿ç”¨ Mavenï¼Œä½†æ˜¯æ„å»ºå¿…é¡»è¦åšã€‚å½“æˆ‘ä»¬ä½¿ç”¨ IDEA è¿›è¡Œå¼€å‘æ—¶ï¼Œæ„å»ºæ˜¯ IDEA æ›¿æˆ‘ä»¬åšçš„ã€‚</p><p><img src="/image/image-20231021103758624.png" alt="image-20231021103758624"></p><p>â‘¡è„±ç¦» IDE ç¯å¢ƒä»éœ€æ„å»º</p><p><img src="/image/image.png" alt="img"></p><h4 id="1-3ã€ç»“è®º"><a href="#1-3ã€ç»“è®º" class="headerlink" title="1.3ã€ç»“è®º"></a>1.3ã€ç»“è®º</h4><ul><li><p><strong>ç®¡ç†è§„æ¨¡åºå¤§çš„ jar åŒ…ï¼Œéœ€è¦ä¸“é—¨å·¥å…·ã€‚</strong></p></li><li><p><strong>è„±ç¦» IDE ç¯å¢ƒæ‰§è¡Œæ„å»ºæ“ä½œï¼Œéœ€è¦ä¸“é—¨å·¥å…·ã€‚</strong></p></li></ul><h3 id="2-Mavenä»‹ç»"><a href="#2-Mavenä»‹ç»" class="headerlink" title="2. Mavenä»‹ç»"></a>2. Mavenä»‹ç»</h3><p><a href="https://maven.apache.org/what-is-maven.html">https://maven.apache.org/what-is-maven.html</a></p><p>Maven æ˜¯ä¸€æ¬¾ä¸º Java é¡¹ç›®ç®¡ç†æ„å»ºã€ä¾èµ–ç®¡ç†çš„å·¥å…·ï¼ˆè½¯ä»¶ï¼‰ï¼Œä½¿ç”¨ Maven å¯ä»¥è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•ã€æ‰“åŒ…å’Œå‘å¸ƒé¡¹ç›®ï¼Œå¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡å’Œè´¨é‡ã€‚</p><p>Mavenå°±æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼ŒæŒæ¡å®‰è£…ã€é…ç½®ã€ä»¥åŠåŸºæœ¬åŠŸèƒ½ <strong>ï¼ˆé¡¹ç›®æ„å»ºã€ä¾èµ–ç®¡ç†ï¼‰</strong> çš„ç†è§£å’Œä½¿ç”¨å³å¯ï¼</p><ol><li><strong>ä¾èµ–ç®¡ç†ï¼š</strong></li></ol><p>Â  Â Maven å¯ä»¥ç®¡ç†é¡¹ç›®çš„ä¾èµ–ï¼ŒåŒ…æ‹¬è‡ªåŠ¨ä¸‹è½½æ‰€éœ€ä¾èµ–åº“ã€è‡ªåŠ¨ä¸‹è½½ä¾èµ–éœ€è¦çš„ä¾èµ–å¹¶ä¸”ä¿è¯ç‰ˆæœ¬æ²¡æœ‰å†²çªã€ä¾èµ–ç‰ˆæœ¬ç®¡ç†ç­‰ã€‚é€šè¿‡ Mavenï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°ç»´æŠ¤é¡¹ç›®æ‰€ä¾èµ–çš„å¤–éƒ¨åº“ï¼Œé¿å…ç‰ˆæœ¬å†²çªå’Œè½¬æ¢é”™è¯¯ç­‰ï¼Œè€Œæˆ‘ä»¬ä»…ä»…éœ€è¦ç¼–å†™é…ç½®å³å¯ã€‚</p><ol start="2"><li><strong>æ„å»ºç®¡ç†ï¼š</strong></li></ol><p>Â  Â é¡¹ç›®æ„å»ºæ˜¯æŒ‡å°†æºä»£ç ã€é…ç½®æ–‡ä»¶ã€èµ„æºæ–‡ä»¶ç­‰è½¬åŒ–ä¸ºèƒ½å¤Ÿè¿è¡Œæˆ–éƒ¨ç½²çš„åº”ç”¨ç¨‹åºæˆ–åº“çš„è¿‡ç¨‹</p><p>Â  Â Maven å¯ä»¥ç®¡ç†é¡¹ç›®çš„ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²ç­‰æ„å»ºè¿‡ç¨‹ã€‚é€šè¿‡å®ç°æ ‡å‡†çš„æ„å»ºç”Ÿå‘½å‘¨æœŸï¼ŒMaven å¯ä»¥ç¡®ä¿æ¯ä¸€ä¸ªæ„å»ºè¿‡ç¨‹éƒ½éµå¾ªåŒæ ·çš„è§„åˆ™å’Œæœ€ä½³å®è·µã€‚åŒæ—¶ï¼ŒMaven çš„æ’ä»¶æœºåˆ¶ä¹Ÿä½¿å¾—å¼€å‘è€…å¯ä»¥å¯¹æ„å»ºè¿‡ç¨‹è¿›è¡Œæ‰©å±•å’Œå®šåˆ¶ã€‚ä¸»åŠ¨è§¦å‘æ„å»ºï¼Œåªéœ€è¦ç®€å•çš„å‘½ä»¤æ“ä½œå³å¯ã€‚</p><p>Â  Â <img src="/image/image_OSOE45UACw.png"></p><p><strong>åœºæ™¯1ï¼š</strong> ä¾‹å¦‚æˆ‘ä»¬é¡¹ç›®éœ€è¦ç¬¬ä¸‰æ–¹ä¾èµ–å¦‚ï¼šDruidè¿æ¥æ± ã€MySQLæ•°æ®åº“é©±åŠ¨å’ŒJackson JSONç­‰å¤„ç†ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†æƒ³è¦çš„ä¾èµ–é¡¹çš„ä¿¡æ¯ç¼–å†™åˆ°Mavenå·¥ç¨‹çš„é…ç½®æ–‡ä»¶ï¼ŒMavenå°±ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å¤åˆ¶è¿™äº›ä¾èµ–é¡¹åˆ°é¡¹ç›®ä¸­ï¼Œæ— éœ€è‡ªå·±å¯¼å…¥jaråŒ…ï¼Œç®¡ç†jar!</p><p><strong>åœºæ™¯2ï¼š</strong> é¡¹ç›®å®Œæˆå¼€å‘ï¼Œæˆ‘ä»¬æƒ³è¦æ‰“æˆwaréƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸­ï¼Œä½¿ç”¨mavençš„æ„å»ºå‘½ä»¤å¯ä»¥å¿«é€Ÿæ‰“åŒ…ï¼èŠ‚çœå¤§é‡æ—¶é—´ï¼</p><h3 id="3-Mavenè½¯ä»¶å·¥ä½œåŸç†æ¨¡å‹å›¾ï¼ˆäº†è§£ï¼‰"><a href="#3-Mavenè½¯ä»¶å·¥ä½œåŸç†æ¨¡å‹å›¾ï¼ˆäº†è§£ï¼‰" class="headerlink" title="3. Mavenè½¯ä»¶å·¥ä½œåŸç†æ¨¡å‹å›¾ï¼ˆäº†è§£ï¼‰"></a>3. Mavenè½¯ä»¶å·¥ä½œåŸç†æ¨¡å‹å›¾ï¼ˆäº†è§£ï¼‰</h3><p><img src="/image/image_6AVFQbaXLj.png"></p><h2 id="äºŒã€Mavenå®‰è£…å’Œé…ç½®"><a href="#äºŒã€Mavenå®‰è£…å’Œé…ç½®" class="headerlink" title="äºŒã€Mavenå®‰è£…å’Œé…ç½®"></a>äºŒã€Mavenå®‰è£…å’Œé…ç½®</h2><h3 id="1-Mavenå®‰è£…"><a href="#1-Mavenå®‰è£…" class="headerlink" title="1. Mavenå®‰è£…"></a>1. Mavenå®‰è£…</h3><p><a href="https://maven.apache.org/docs/history.html">https://maven.apache.org/docs/history.html</a></p><p>å„ä¸ªå·¥å…·é€‰ç”¨ç‰ˆæœ¬ï¼š</p><p>| å·¥å…· Â | ç‰ˆæœ¬ Â  |</p><p>| â€”â€“ | â€”â€” |</p><p>| Maven | 3.8.8 Â |</p><p>| JDK Â  | 17 Â  Â  |</p><p>| IDEA Â | 2022.2 |</p><p><strong>å®‰è£…æ¡ä»¶ï¼š</strong> mavenéœ€è¦æœ¬æœºå®‰è£…javaç¯å¢ƒã€å¿…éœ€åŒ…å«java_homeç¯å¢ƒå˜é‡ï¼</p><p><strong>è½¯ä»¶å®‰è£…ï¼š</strong> å³é”®è§£å‹å³å¯ï¼ˆç»¿è‰²å…å®‰è£…ï¼‰</p><p><strong>è½¯ä»¶ç»“æ„ï¼š</strong></p><p><img src="/image/image-20231021110800113.png" alt="image-20231021110800113"></p><p><strong>bin</strong>ï¼šå«æœ‰Mavençš„è¿è¡Œè„šæœ¬</p><p>bootï¼šå«æœ‰plexus-classworldsç±»åŠ è½½å™¨æ¡†æ¶</p><p><strong>conf</strong>ï¼šå«æœ‰Mavençš„æ ¸å¿ƒé…ç½®æ–‡ä»¶</p><p>libï¼šå«æœ‰Mavenè¿è¡Œæ—¶æ‰€éœ€è¦çš„Javaç±»åº“</p><p>LICENSEã€NOTICEã€README.txtï¼šé’ˆå¯¹Mavenç‰ˆæœ¬ï¼Œç¬¬ä¸‰æ–¹è½¯ä»¶ç­‰ç®€è¦ä»‹ç»</p><h3 id="2-Mavenç¯å¢ƒé…ç½®"><a href="#2-Mavenç¯å¢ƒé…ç½®" class="headerlink" title="2. Mavenç¯å¢ƒé…ç½®"></a>2. Mavenç¯å¢ƒé…ç½®</h3><ol><li>Â é…ç½®MAVEN_HOME</li></ol><p>Â  Â  <img src="/image/image-20231021110938230.png" alt="image-20231021110938230"></p><ol start="2"><li>Â é…ç½®Path</li></ol><p>Â  Â  <img src="/image/image_xNL5Fg_ucf.png"></p><ol start="3"><li>Â å‘½ä»¤æµ‹è¯•ï¼ˆcmdçª—å£ï¼‰</li></ol><p>Â  Â  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>Â  Â  mvn -v<br><br>Â  Â  <span class="hljs-comment"># è¾“å‡ºç‰ˆæœ¬ä¿¡æ¯å³å¯ï¼Œå¦‚æœé”™è¯¯ï¼Œè¯·ä»”ç»†æ£€æŸ¥ç¯å¢ƒå˜é‡å³å¯ï¼</span><br><br></code></pre></td></tr></table></figure></p><h3 id="3-MavenåŠŸèƒ½é…ç½®"><a href="#3-MavenåŠŸèƒ½é…ç½®" class="headerlink" title="3. MavenåŠŸèƒ½é…ç½®"></a>3. MavenåŠŸèƒ½é…ç½®</h3><blockquote><p>æˆ‘ä»¬éœ€è¦éœ€æ”¹<strong>maven&#x2F;conf&#x2F;settings.xml</strong>é…ç½®æ–‡ä»¶ï¼Œæ¥ä¿®æ”¹mavençš„ä¸€äº›é»˜è®¤é…ç½®ã€‚æˆ‘ä»¬ä¸»è¦ä¼‘è¦ä¿®æ”¹çš„æœ‰ä¸‰ä¸ªé…ç½®ï¼š</p></blockquote><blockquote></blockquote><blockquote><p>1.ä¾èµ–æœ¬åœ°ç¼“å­˜ä½ç½®ï¼ˆæœ¬åœ°ä»“åº“ä½ç½®ï¼‰</p></blockquote><blockquote></blockquote><blockquote><p>2.mavenä¸‹è½½é•œåƒ</p></blockquote><blockquote></blockquote><blockquote><p>3.mavené€‰ç”¨ç¼–è¯‘é¡¹ç›®çš„jdkç‰ˆæœ¬</p></blockquote><ol><li>Â é…ç½®æœ¬åœ°ä»“åº“åœ°å€</li></ol><p>Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  Â  <span class="hljs-comment">&lt;!-- localRepository</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â  Â  Â | The path to the local repository maven will use to store artifacts.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â  Â  Â |</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â  Â  Â | Default: $&#123;user.home&#125;/.m2/repository</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â  Â  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â  Â  --&gt;</span><br><br>Â  Â  Â <span class="hljs-comment">&lt;!-- conf/settings.xml 55è¡Œ --&gt;</span><br><br>Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">localRepository</span>&gt;</span>D:\maven-repository<span class="hljs-tag">&lt;/<span class="hljs-name">localRepository</span>&gt;</span><br><br></code></pre></td></tr></table></figure></p><ol start="2"><li>Â é…ç½®å›½å†…é˜¿é‡Œé•œåƒ</li></ol><p>Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  <span class="hljs-comment">&lt;!--åœ¨mirrorsèŠ‚ç‚¹(æ ‡ç­¾)ä¸‹æ·»åŠ ä¸­å¤®ä»“åº“é•œåƒ 160è¡Œé™„è¿‘--&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>alimaven<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>aliyun maven<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br><br></code></pre></td></tr></table></figure></p><ol start="3"><li>Â é…ç½®jdk17ç‰ˆæœ¬é¡¹ç›®æ„å»º</li></ol><p>Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  <span class="hljs-comment">&lt;!--åœ¨profilesèŠ‚ç‚¹(æ ‡ç­¾)ä¸‹æ·»åŠ jdkç¼–è¯‘ç‰ˆæœ¬ 268è¡Œé™„è¿‘--&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>jdk-17<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">activeByDefault</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">activeByDefault</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">jdk</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">jdk</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.compilerVersion</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.compilerVersion</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br><br></code></pre></td></tr></table></figure></p><h3 id="4-IDEAé…ç½®æœ¬åœ°Mavenè½¯ä»¶"><a href="#4-IDEAé…ç½®æœ¬åœ°Mavenè½¯ä»¶" class="headerlink" title="4. IDEAé…ç½®æœ¬åœ°Mavenè½¯ä»¶"></a>4. IDEAé…ç½®æœ¬åœ°Mavenè½¯ä»¶</h3><blockquote><p>æˆ‘ä»¬éœ€è¦å°†é…ç½®å¥½çš„mavenè½¯ä»¶ï¼Œé…ç½®åˆ°ideaå¼€å‘å·¥å…·ä¸­å³å¯ï¼ æ³¨æ„ï¼šideaå·¥å…·é»˜è®¤è‡ªå¸¦mavené…ç½®è½¯ä»¶ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰ä¿®æ”¹é…ç½®ï¼Œå»ºè®®æ›¿æ¢æˆæœ¬åœ°é…ç½®å¥½çš„mavenï¼</p></blockquote><p>é€‰æ‹©æœ¬åœ°mavenè½¯ä»¶</p><p><img src="/image/image-20231021112046512.png" alt="image-20231021112046512"></p><p><strong>æ³¨æ„</strong>ï¼š</p><p>1ã€å¦‚æœæœ¬åœ°ä»“åº“åœ°å€ä¸å˜åŒ–ï¼Œåªæœ‰ä¸€ä¸ªåŸå› ï¼Œå°±æ˜¯maven&#x2F;conf&#x2F;settings.xmlé…ç½®æ–‡ä»¶ç¼–å†™é”™è¯¯ï¼ä»”ç»†æ£€æŸ¥å³å¯ï¼</p><p>2ã€ä¸€å®šä¿è¯User settings fileå¯¹åº”ä¹‹å‰ä¿®æ”¹çš„settings.xmlçš„è·¯å¾„ï¼Œè‹¥ ä¸ä¸€è‡´ï¼Œé€‰ä¸­Overrideå¤é€‰æ¡†ï¼Œæ‰‹åŠ¨é€‰æ‹©é…ç½®æ–‡ä»¶</p><h2 id="ä¸‰ã€åŸºäºIDEAåˆ›å»ºMavenå·¥ç¨‹"><a href="#ä¸‰ã€åŸºäºIDEAåˆ›å»ºMavenå·¥ç¨‹" class="headerlink" title="ä¸‰ã€åŸºäºIDEAåˆ›å»ºMavenå·¥ç¨‹"></a>ä¸‰ã€åŸºäºIDEAåˆ›å»ºMavenå·¥ç¨‹</h2><h3 id="1-æ¦‚å¿µæ¢³ç†Mavenå·¥ç¨‹çš„GAVP"><a href="#1-æ¦‚å¿µæ¢³ç†Mavenå·¥ç¨‹çš„GAVP" class="headerlink" title="1. æ¦‚å¿µæ¢³ç†Mavenå·¥ç¨‹çš„GAVP"></a>1. æ¦‚å¿µæ¢³ç†Mavenå·¥ç¨‹çš„GAVP</h3><p>Mavenå·¥ç¨‹ç›¸å¯¹ä¹‹å‰çš„é¡¹ç›®ï¼Œå¤šå‡ºä¸€ç»„gavpå±æ€§ï¼Œgavéœ€è¦æˆ‘ä»¬åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™æŒ‡å®šï¼Œpæœ‰é»˜è®¤å€¼ï¼Œæˆ‘ä»¬å…ˆè¡Œäº†è§£ä¸‹è¿™ç»„å±æ€§çš„å«ä¹‰ï¼š</p><p>Maven ä¸­çš„ GAVP æ˜¯æŒ‡ GroupIdã€ArtifactIdã€Versionã€Packaging ç­‰å››ä¸ªå±æ€§çš„ç¼©å†™ï¼Œå…¶ä¸­å‰ä¸‰ä¸ªæ˜¯å¿…è¦çš„ï¼Œè€Œ Packaging å±æ€§ä¸ºå¯é€‰é¡¹ã€‚è¿™å››ä¸ªå±æ€§ä¸»è¦ä¸ºæ¯ä¸ªé¡¹ç›®åœ¨mavenä»“åº“ä¸­åšä¸€ä¸ªæ ‡è¯†ï¼Œç±»ä¼¼äººçš„å§“-åï¼æœ‰äº†å…·ä½“æ ‡è¯†ï¼Œæ–¹ä¾¿åæœŸé¡¹ç›®ä¹‹é—´ç›¸äº’å¼•ç”¨ä¾èµ–ç­‰ï¼</p><p>GAVéµå¾ªä¸€ä¸‹è§„åˆ™ï¼š</p><p>â€‹ Â  1ï¼‰ <strong>GroupID æ ¼å¼</strong>ï¼šcom.{å…¬å¸&#x2F;BU }.ä¸šåŠ¡çº¿.[å­ä¸šåŠ¡çº¿]ï¼Œæœ€å¤š 4 çº§ã€‚</p><p>â€‹ Â  Â  Â  è¯´æ˜ï¼š{å…¬å¸&#x2F;BU} ä¾‹å¦‚ï¼šalibaba&#x2F;taobao&#x2F;tmall&#x2F;aliexpress ç­‰ BU ä¸€çº§ï¼›å­ä¸šåŠ¡çº¿å¯é€‰ã€‚</p><p>â€‹ Â  Â  Â  æ­£ä¾‹ï¼šcom.taobao.tddl æˆ– com.alibaba.sourcing.multilang</p><p>â€‹ Â  2ï¼‰ <strong>ArtifactID æ ¼å¼</strong>ï¼šäº§å“çº¿å-æ¨¡å—åã€‚è¯­ä¹‰ä¸é‡å¤ä¸é—æ¼ï¼Œå…ˆåˆ°ä»“åº“ä¸­å¿ƒå»æŸ¥è¯ä¸€ä¸‹ã€‚</p><p>â€‹ Â  Â  Â  æ­£ä¾‹ï¼štc-client &#x2F; uic-api &#x2F; tair-tool &#x2F; bookstore</p><p>â€‹ Â  3ï¼‰ <strong>Versionç‰ˆæœ¬å·æ ¼å¼æ¨è</strong>ï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·</p><p>â€‹ Â  Â  Â  1ï¼‰ ä¸»ç‰ˆæœ¬å·ï¼šå½“åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼Œæˆ–è€…å¢åŠ äº†èƒ½æ”¹å˜äº§å“æ–¹å‘çš„æ–°åŠŸèƒ½ã€‚</p><p>â€‹ Â  Â  Â  2ï¼‰ æ¬¡ç‰ˆæœ¬å·ï¼šå½“åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ï¼ˆæ–°å¢ç±»ã€æ¥å£ç­‰ï¼‰ã€‚</p><p>â€‹ Â  Â  Â  3ï¼‰ ä¿®è®¢å·ï¼šä¿®å¤ bugï¼Œæ²¡æœ‰ä¿®æ”¹æ–¹æ³•ç­¾åçš„åŠŸèƒ½åŠ å¼ºï¼Œä¿æŒ API å…¼å®¹æ€§ã€‚</p><p>â€‹ Â  Â  Â  ä¾‹å¦‚ï¼š åˆå§‹â†’1.0.0 Â ä¿®æ”¹bug â†’ 1.0.1 Â åŠŸèƒ½è°ƒæ•´ â†’ 1.1.1ç­‰</p><p><strong>Packagingå®šä¹‰è§„åˆ™ï¼š</strong></p><p>â€‹ Â  æŒ‡ç¤ºå°†é¡¹ç›®æ‰“åŒ…ä¸ºä»€ä¹ˆç±»å‹çš„æ–‡ä»¶ï¼Œideaæ ¹æ®packagingå€¼ï¼Œè¯†åˆ«mavené¡¹ç›®ç±»å‹ï¼</p><p>â€‹ Â  packaging å±æ€§ä¸º jarï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œä»£è¡¨æ™®é€šçš„Javaå·¥ç¨‹ï¼Œæ‰“åŒ…ä»¥åæ˜¯.jarç»“å°¾çš„æ–‡ä»¶ã€‚</p><p>â€‹ Â  packaging å±æ€§ä¸º warï¼Œä»£è¡¨Javaçš„webå·¥ç¨‹ï¼Œæ‰“åŒ…ä»¥å.warç»“å°¾çš„æ–‡ä»¶ã€‚</p><p>â€‹ Â  packaging å±æ€§ä¸º pomï¼Œä»£è¡¨ä¸ä¼šæ‰“åŒ…ï¼Œç”¨æ¥åšç»§æ‰¿çš„çˆ¶å·¥ç¨‹ã€‚</p><h3 id="2-Ideaæ„å»ºMaven-Java-SEå·¥ç¨‹"><a href="#2-Ideaæ„å»ºMaven-Java-SEå·¥ç¨‹" class="headerlink" title="2. Ideaæ„å»ºMaven Java SEå·¥ç¨‹"></a>2. Ideaæ„å»ºMaven Java SEå·¥ç¨‹</h3><p>æ³¨æ„ï¼šæ­¤å¤„çœç•¥äº†versionï¼Œç›´æ¥ç»™äº†ä¸€ä¸ªé»˜è®¤å€¼ï¼š<strong>1.0-SNAPSHOT</strong></p><p>è‡ªå·±åæœŸå¯ä»¥åœ¨é¡¹ç›®ä¸­éšæ„ä¿®æ”¹ï¼</p><p><img src="/image/image-20231021143559114.png" alt="image-20231021143559114"></p><p>åˆ›å»ºå·¥ç¨‹ä¹‹åï¼Œè‹¥ç¬¬ä¸€æ¬¡ä½¿ç”¨mavenï¼Œæˆ–è€…ä½¿ç”¨çš„æ˜¯æ–°çš„<strong>æœ¬åœ°ä»“åº“</strong>ï¼Œideaå³ä¸‹è§’ä¼šå‡ºç°ä»¥ä¸‹è¿›åº¦æ¡ï¼Œè¡¨ç¤ºmavenæ­£åœ¨ä¸‹è½½ç›¸å…³æ’ä»¶ï¼Œç­‰å¾…ä¸‹è½½å®Œæ¯•ï¼Œè¿›åº¦æ¡æ¶ˆå¤±å³å¯</p><p><img src="/image/image-20231021145024505.png" alt="image-20231021145024505"></p><p>éªŒè¯mavenå·¥ç¨‹æ˜¯å¦åˆ›å»ºæˆåŠŸï¼Œå½“åˆ›å»ºå®Œæ¯•mavenå·¥ç¨‹ä¹‹åï¼Œideaä¸­ä¼šè‡ªåŠ¨æ‰“å¼€Mavenè§†å›¾ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/image/image-20231021145713433.png" alt="image-20231021145713433"></p><h3 id="3-Ideaæ„å»ºMaven-Java-Webå·¥ç¨‹"><a href="#3-Ideaæ„å»ºMaven-Java-Webå·¥ç¨‹" class="headerlink" title="3. Ideaæ„å»ºMaven Java Webå·¥ç¨‹"></a>3. Ideaæ„å»ºMaven Java Webå·¥ç¨‹</h3><ol><li>Â æ‰‹åŠ¨åˆ›å»º</li></ol><p>Â  Â  1. åˆ›å»ºä¸€ä¸ªmavençš„javaseå·¥ç¨‹</p><p>Â  Â  Â  Â <img src="/image/image-20231021150134082.png" alt="image-20231021150134082"></p><p>Â  Â  2. ä¿®æ”¹pom.xmlæ–‡ä»¶æ‰“åŒ…æ–¹å¼</p><p>Â  Â  Â  Â ä¿®æ”¹ä½ç½®ï¼šé¡¹ç›®ä¸‹&#x2F;pom.xml</p><p>Â  Â  Â  Â <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven_web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â <span class="hljs-comment">&lt;!-- æ–°å¢ä¸€åˆ—æ‰“åŒ…æ–¹å¼packaging --&gt;</span><br><br>Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br></code></pre></td></tr></table></figure></p><p>Â  Â  3. è®¾ç½®<strong>webèµ„æºè·¯å¾„</strong>å’Œ<strong>web.xmlè·¯å¾„</strong></p><p>Â  Â  Â  Â ç‚¹å‡»Fileâ€“&gt;Project Structure</p><p>Â  Â  Â  Â <img src="/image/image-20231021151040531.png" alt="image-20231021151040531"></p><p>Â  Â  Â  Â <img src="/image/image-20231021151627161.png" alt="image-20231021151627161"></p><p>Â  Â  Â  Â <img src="/image/image-20231021151753318.png" alt="image-20231021151753318"></p><p>Â  Â  4. åˆ·æ–°å’Œæ ¡éªŒ</p><p>Â  Â  Â  Â <img src="/image/image-20231021152310802.png" alt="image-20231021152310802"></p><p>Â  Â  Â  Â <img src="/image/image-20231021151921943.png" alt="image-20231021151921943"></p><ol start="2"><li>Â æ’ä»¶åˆ›å»º</li></ol><p>Â  Â  1. Â å®‰è£…æ’ä»¶JBLJavaToWeb</p><p>Â  Â  Â  Â  file &#x2F; settings &#x2F; plugins &#x2F; marketplace</p><p>Â  Â  Â  Â  <img src="/image/image_cHUU_rABB6.png"></p><p>Â  Â  2. Â åˆ›å»ºä¸€ä¸ªjavasemavenå·¥ç¨‹</p><p>Â  Â  3. Â å³é”®ã€ä½¿ç”¨æ’ä»¶å¿«é€Ÿè¡¥å…¨webé¡¹ç›®</p><p>Â  Â  Â  Â  <img src="/image/image_ZAPkM7VLgJ.png"></p><h3 id="4-Mavenå·¥ç¨‹é¡¹ç›®ç»“æ„è¯´æ˜"><a href="#4-Mavenå·¥ç¨‹é¡¹ç›®ç»“æ„è¯´æ˜" class="headerlink" title="4. Mavenå·¥ç¨‹é¡¹ç›®ç»“æ„è¯´æ˜"></a>4. Mavenå·¥ç¨‹é¡¹ç›®ç»“æ„è¯´æ˜</h3><p>Maven æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ„å»ºå·¥å…·ï¼Œå®ƒæä¾›ä¸€ç§æ ‡å‡†åŒ–çš„é¡¹ç›®ç»“æ„ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´å®¹æ˜“åœ°ç®¡ç†é¡¹ç›®çš„ä¾èµ–ã€æ„å»ºã€æµ‹è¯•å’Œå‘å¸ƒç­‰ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯ Maven Web ç¨‹åºçš„æ–‡ä»¶ç»“æ„åŠæ¯ä¸ªæ–‡ä»¶çš„ä½œç”¨ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>|-- pom.xml Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  # Maven é¡¹ç›®ç®¡ç†æ–‡ä»¶<br><br>|-- src<br><br>Â  Â  |-- main Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â # é¡¹ç›®ä¸»è¦ä»£ç <br><br>Â  Â  | Â  |-- java Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â # Java æºä»£ç ç›®å½•<br><br>Â  Â  | Â  | Â  `-- com/example/myapp Â  Â  Â  Â  # å¼€å‘è€…ä»£ç ä¸»ç›®å½•<br><br>Â  Â  | Â  | Â  Â  Â  |-- controller Â  Â  Â  Â  Â  Â # å­˜æ”¾ Controller å±‚ä»£ç çš„ç›®å½•<br><br>Â  Â  | Â  | Â  Â  Â  |-- service Â  Â  Â  Â  Â  Â  Â  # å­˜æ”¾ Service å±‚ä»£ç çš„ç›®å½•<br><br>Â  Â  | Â  | Â  Â  Â  |-- dao Â  Â  Â  Â  Â  Â  Â  Â  Â  # å­˜æ”¾ DAO å±‚ä»£ç çš„ç›®å½•<br><br>Â  Â  | Â  | Â  Â  Â  `-- model Â  Â  Â  Â  Â  Â  Â  Â  # å­˜æ”¾æ•°æ®æ¨¡å‹çš„ç›®å½•<br><br>Â  Â  | Â  |-- resources Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  # èµ„æºç›®å½•ï¼Œå­˜æ”¾é…ç½®æ–‡ä»¶ã€é™æ€èµ„æºç­‰<br><br>Â  Â  | Â  | Â  |-- log4j.properties Â  Â  Â  Â  Â # æ—¥å¿—é…ç½®æ–‡ä»¶<br><br>Â  Â  | Â  | Â  |-- spring-mybatis.xml Â  Â  Â  Â # Spring Mybatis é…ç½®æ–‡ä»¶<br><br>Â  Â  | Â  | Â  `-- static Â  Â  Â  Â  Â  Â  Â  Â  Â  Â # å­˜æ”¾é™æ€èµ„æºçš„ç›®å½•<br><br>Â  Â  | Â  | Â  Â  Â  |-- css Â  Â  Â  Â  Â  Â  Â  Â  Â  # å­˜æ”¾ CSS æ–‡ä»¶çš„ç›®å½•<br><br>Â  Â  | Â  | Â  Â  Â  |-- js Â  Â  Â  Â  Â  Â  Â  Â  Â  Â # å­˜æ”¾ JavaScript æ–‡ä»¶çš„ç›®å½•<br><br>Â  Â  | Â  | Â  Â  Â  `-- images Â  Â  Â  Â  Â  Â  Â  Â # å­˜æ”¾å›¾ç‰‡èµ„æºçš„ç›®å½•<br><br>Â  Â  | Â  `-- webapp Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â # å­˜æ”¾ WEB ç›¸å…³é…ç½®å’Œèµ„æº<br><br>Â  Â  | Â  Â  Â  |-- WEB-INF Â  Â  Â  Â  Â  Â  Â  Â  Â  # å­˜æ”¾ WEB åº”ç”¨é…ç½®æ–‡ä»¶<br><br>Â  Â  | Â  Â  Â  | Â  |-- web.xml Â  Â  Â  Â  Â  Â  Â  # Web åº”ç”¨çš„éƒ¨ç½²æè¿°æ–‡ä»¶<br><br>Â  Â  | Â  Â  Â  | Â  `-- classes Â  Â  Â  Â  Â  Â  Â  # å­˜æ”¾ç¼–è¯‘åçš„ class æ–‡ä»¶<br><br>Â  Â  | Â  Â  Â  `-- index.html Â  Â  Â  Â  Â  Â  Â  Â # Web åº”ç”¨å…¥å£é¡µé¢<br><br>Â  Â  `-- test Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â # é¡¹ç›®æµ‹è¯•ä»£ç <br><br>Â  Â  Â  Â  |-- java Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â # å•å…ƒæµ‹è¯•ç›®å½•<br><br>Â  Â  Â  Â  `-- resources Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  # æµ‹è¯•èµ„æºç›®å½•<br><br></code></pre></td></tr></table></figure><ul><li><p>Â  pom.xmlï¼šMaven é¡¹ç›®ç®¡ç†æ–‡ä»¶ï¼Œç”¨äºæè¿°é¡¹ç›®çš„ä¾èµ–å’Œæ„å»ºé…ç½®ç­‰ä¿¡æ¯ã€‚</p></li><li><p>Â  src&#x2F;main&#x2F;javaï¼šå­˜æ”¾é¡¹ç›®çš„ Java æºä»£ç ã€‚</p></li><li><p>Â  src&#x2F;main&#x2F;resourcesï¼šå­˜æ”¾é¡¹ç›®çš„èµ„æºæ–‡ä»¶ï¼Œå¦‚é…ç½®æ–‡ä»¶ã€é™æ€èµ„æºç­‰ã€‚</p></li><li><p>Â  src&#x2F;main&#x2F;webapp&#x2F;WEB-INFï¼šå­˜æ”¾ Web åº”ç”¨çš„é…ç½®æ–‡ä»¶ã€‚</p></li><li><p>Â  src&#x2F;main&#x2F;webapp&#x2F;index.jspï¼šWeb åº”ç”¨çš„å…¥å£é¡µé¢ã€‚</p></li><li><p>Â  src&#x2F;test&#x2F;javaï¼šå­˜æ”¾é¡¹ç›®çš„æµ‹è¯•ä»£ç ã€‚</p></li><li><p>Â  src&#x2F;test&#x2F;resourcesï¼šå­˜æ”¾æµ‹è¯•ç›¸å…³çš„èµ„æºæ–‡ä»¶ï¼Œå¦‚æµ‹è¯•é…ç½®æ–‡ä»¶ç­‰ã€‚</p></li></ul><h2 id="å››ã€åŸºäºIDEAè¿›è¡ŒMavenå·¥ç¨‹æ„å»º"><a href="#å››ã€åŸºäºIDEAè¿›è¡ŒMavenå·¥ç¨‹æ„å»º" class="headerlink" title="å››ã€åŸºäºIDEAè¿›è¡ŒMavenå·¥ç¨‹æ„å»º"></a>å››ã€åŸºäºIDEAè¿›è¡ŒMavenå·¥ç¨‹æ„å»º</h2><h3 id="1-æ„å»ºæ¦‚å¿µå’Œæ„å»ºè¿‡ç¨‹"><a href="#1-æ„å»ºæ¦‚å¿µå’Œæ„å»ºè¿‡ç¨‹" class="headerlink" title="1. æ„å»ºæ¦‚å¿µå’Œæ„å»ºè¿‡ç¨‹"></a>1. æ„å»ºæ¦‚å¿µå’Œæ„å»ºè¿‡ç¨‹</h3><p>é¡¹ç›®æ„å»ºæ˜¯æŒ‡å°†æºä»£ç ã€ä¾èµ–åº“å’Œèµ„æºæ–‡ä»¶ç­‰è½¬æ¢æˆå¯æ‰§è¡Œæˆ–å¯éƒ¨ç½²çš„åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åŒ…æ‹¬ç¼–è¯‘æºä»£ç ã€é“¾æ¥ä¾èµ–åº“ã€æ‰“åŒ…å’Œéƒ¨ç½²ç­‰å¤šä¸ªæ­¥éª¤ã€‚</p><p>é¡¹ç›®æ„å»ºæ˜¯è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­è‡³å…³é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒèƒ½å¤Ÿå¤§å¤§æé«˜è½¯ä»¶å¼€å‘æ•ˆç‡ï¼Œä½¿å¾—å¼€å‘äººå‘˜èƒ½å¤Ÿæ›´åŠ ä¸“æ³¨äºåº”ç”¨ç¨‹åºçš„å¼€å‘å’Œç»´æŠ¤ï¼Œè€Œä¸å¿…å…³å¿ƒåº”ç”¨ç¨‹åºçš„æ„å»ºç»†èŠ‚ã€‚</p><p>åŒæ—¶ï¼Œé¡¹ç›®æ„å»ºè¿˜èƒ½å¤Ÿå°†å¤šä¸ªå¼€å‘äººå‘˜çš„ä»£ç æ±‡åˆåˆ°ä¸€èµ·ï¼Œå¹¶èƒ½å¤Ÿè‡ªåŠ¨åŒ–é¡¹ç›®çš„æ„å»ºå’Œéƒ¨ç½²ï¼Œå¤§å¤§é™ä½äº†é¡¹ç›®çš„å‡ºé”™é£é™©å’Œæé«˜å¼€å‘æ•ˆç‡ã€‚å¸¸è§çš„æ„å»ºå·¥å…·åŒ…æ‹¬ Mavenã€Gradleã€Ant ç­‰ã€‚</p><p><img src="/image/image_REm5kk7DnX.png"></p><h3 id="2-å‘½ä»¤æ–¹å¼é¡¹ç›®æ„å»º"><a href="#2-å‘½ä»¤æ–¹å¼é¡¹ç›®æ„å»º" class="headerlink" title="2. å‘½ä»¤æ–¹å¼é¡¹ç›®æ„å»º"></a>2. å‘½ä»¤æ–¹å¼é¡¹ç›®æ„å»º</h3><p>| å‘½ä»¤ Â  Â  Â  Â | æè¿° Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â |</p><p>| â€”â€”â€”â€“ | â€”â€”â€”â€”â€”â€”â€”â€”â€” |</p><p>| mvn compile | ç¼–è¯‘é¡¹ç›®ï¼Œç”Ÿæˆtargetæ–‡ä»¶ Â  Â |</p><p>| mvn package | æ‰“åŒ…é¡¹ç›®ï¼Œç”Ÿæˆjaræˆ–waræ–‡ä»¶ Â |</p><p>| mvn clean Â  | æ¸…ç†ç¼–è¯‘æˆ–æ‰“åŒ…åçš„é¡¹ç›®ç»“æ„ Â |</p><p>| mvn install | æ‰“åŒ…åä¸Šä¼ åˆ°mavenæœ¬åœ°ä»“åº“ Â  |</p><p>| mvn deploy Â | åªæ‰“åŒ…ï¼Œä¸Šä¼ åˆ°mavenç§æœä»“åº“ |</p><p>| mvn site Â  Â | ç”Ÿæˆç«™ç‚¹ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â |</p><p>| mvn test Â  Â | æ‰§è¡Œæµ‹è¯•æºç  Â  Â  Â  Â  Â  Â  Â  Â |</p><p>waråŒ…æ‰“åŒ…æ’ä»¶å’Œjdkç‰ˆæœ¬ä¸åŒ¹é…ï¼špom.xml æ·»åŠ ä»¥ä¸‹ä»£ç å³å¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><br>Â  Â  <span class="hljs-comment">&lt;!-- jdk17 å’Œ waråŒ…ç‰ˆæœ¬æ’ä»¶ä¸åŒ¹é… --&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-war-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>å‘½ä»¤è§¦å‘ç»ƒä¹ ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>mvn å‘½ä»¤ å‘½ä»¤<br><br>  <br><br><span class="hljs-comment">#æ¸…ç†</span><br><br>mvn clean<br><br><span class="hljs-comment">#æ¸…ç†ï¼Œå¹¶é‡æ–°æ‰“åŒ…</span><br><br>mvn clean package<br><br><span class="hljs-comment">#æ‰§è¡Œæµ‹è¯•ä»£ç </span><br><br>mvn <span class="hljs-built_in">test</span><br><br></code></pre></td></tr></table></figure><h3 id="3-å¯è§†åŒ–æ–¹å¼é¡¹ç›®æ„å»º"><a href="#3-å¯è§†åŒ–æ–¹å¼é¡¹ç›®æ„å»º" class="headerlink" title="3. å¯è§†åŒ–æ–¹å¼é¡¹ç›®æ„å»º"></a>3. å¯è§†åŒ–æ–¹å¼é¡¹ç›®æ„å»º</h3><p><img src="/image/image-20231021153444864.png" alt="image-20231021153444864"></p><p>æ³¨æ„ï¼šæ‰“åŒ…ï¼ˆpackageï¼‰å’Œå®‰è£…ï¼ˆinstallï¼‰çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p><p>æ‰“åŒ…æ˜¯å°†å·¥ç¨‹æ‰“æˆjaræˆ–waræ–‡ä»¶ï¼Œä¿å­˜åœ¨targetç›®å½•ä¸‹</p><p>å®‰è£…æ˜¯å°†å½“å‰å·¥ç¨‹æ‰€ç”Ÿæˆçš„jaræˆ–waræ–‡ä»¶ï¼Œå®‰è£…åˆ°æœ¬åœ°ä»“åº“ï¼Œä¼šæŒ‰ç…§åæ ‡ä¿å­˜åˆ°æŒ‡å®šä½ç½®</p><h3 id="4-æ„å»ºæ’ä»¶ã€å‘½ä»¤ã€ç”Ÿå‘½å‘¨æœŸå‘½ä»¤ä¹‹é—´å…³ç³»"><a href="#4-æ„å»ºæ’ä»¶ã€å‘½ä»¤ã€ç”Ÿå‘½å‘¨æœŸå‘½ä»¤ä¹‹é—´å…³ç³»" class="headerlink" title="4. æ„å»ºæ’ä»¶ã€å‘½ä»¤ã€ç”Ÿå‘½å‘¨æœŸå‘½ä»¤ä¹‹é—´å…³ç³»"></a>4. æ„å»ºæ’ä»¶ã€å‘½ä»¤ã€ç”Ÿå‘½å‘¨æœŸå‘½ä»¤ä¹‹é—´å…³ç³»</h3><ul><li>Â  <strong>æ„å»ºç”Ÿå‘½å‘¨æœŸ</strong></li></ul><p>Â  Â  æˆ‘ä»¬å‘ç°ä¸€ä¸ªæƒ…å†µï¼å½“æˆ‘ä»¬æ‰§è¡Œpackageå‘½ä»¤ä¹Ÿä¼šè‡ªåŠ¨æ‰§è¡Œcompileå‘½ä»¤ï¼</p><p>Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  [INFO] --------------------------------[ jar ]---------------------------------<br><br>Â  Â  [INFO]<br><br>Â  Â  [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ mybatis-base-curd ---<br><br>Â  Â  [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ mybatis-base-curd ---<br><br>Â  Â  [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ mybatis-base-curd ---<br><br>Â  Â  [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ mybatis-base-curd ---<br><br>Â  Â  [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ mybatis-base-curd ---<br><br>Â  Â  [INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ mybatis-base-curd ---<br><br>Â  Â  [INFO] Building jar: D:\javaprojects\backend-engineering\part03-mybatis\mybatis-base-curd\target\mybatis-base-curd-1.0-SNAPSHOT.jar<br><br>Â  Â  [INFO] ------------------------------------------------------------------------<br><br>Â  Â  [INFO] BUILD SUCCESS<br><br>Â  Â  [INFO] ------------------------------------------------------------------------<br><br>Â  Â  [INFO] Total time: Â 5.013 s<br><br>Â  Â  [INFO] Finished at: 2023-06-05T10:03:47+08:00<br><br>Â  Â  [INFO] ------------------------------------------------------------------------<br><br></code></pre></td></tr></table></figure></p><p>Â  Â  è¿™ç§è¡Œä¸ºå°±æ˜¯å› ä¸ºæ„å»ºç”Ÿå‘½å‘¨æœŸäº§ç”Ÿçš„ï¼æ„å»ºç”Ÿå‘½å‘¨æœŸå¯ä»¥ç†è§£æˆæ˜¯ä¸€ç»„å›ºå®šæ„å»ºå‘½ä»¤çš„æœ‰åºé›†åˆï¼Œè§¦å‘å‘¨æœŸåçš„å‘½ä»¤ï¼Œä¼šè‡ªåŠ¨è§¦å‘å‘¨æœŸå‰çš„å‘½ä»¤ï¼ï¼ï¼</p><p>Â  Â  <strong>æ„å»ºå‘¨æœŸä½œç”¨ï¼šä¼šç®€åŒ–æ„å»ºè¿‡ç¨‹</strong></p><p>Â  Â  ä¾‹å¦‚ï¼šé¡¹ç›®æ‰“åŒ… Â  mvn clean packageå³å¯ã€‚&amp;#x20;</p><p>Â  Â  ä¸»è¦ä¸¤ä¸ªæ„å»ºç”Ÿå‘½å‘¨æœŸï¼š</p><p>Â  Â  - Â  æ¸…ç†å‘¨æœŸï¼šä¸»è¦æ˜¯å¯¹é¡¹ç›®ç¼–è¯‘ç”Ÿæˆæ–‡ä»¶è¿›è¡Œæ¸…ç†</p><p>Â  Â  Â  Â  åŒ…å«å‘½ä»¤ï¼šclean&amp;#x20;</p><ul><li>Â  é»˜è®¤å‘¨æœŸï¼šå®šä¹‰äº†çœŸæ­£æ„ä»¶æ—¶æ‰€éœ€è¦æ‰§è¡Œçš„æ‰€æœ‰æ­¥éª¤ï¼Œå®ƒæ˜¯ç”Ÿå‘½å‘¨æœŸä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†</li></ul><p>Â  Â  Â  Â  åŒ…å«å‘½ä»¤ï¼šcompile - Â test - package - install - deploy</p><ul><li>Â  <strong>æ’ä»¶ã€å‘½ä»¤ã€å‘¨æœŸä¸‰è€…å…³ç³»ï¼ˆäº†è§£ï¼‰</strong></li></ul><p>Â  Â  å‘¨æœŸâ†’åŒ…å«è‹¥å¹²å‘½ä»¤â†’åŒ…å«è‹¥å¹²æ’ä»¶</p><p>Â  Â  ä½¿ç”¨å‘¨æœŸå‘½ä»¤æ„å»ºï¼Œç®€åŒ–æ„å»ºè¿‡ç¨‹ï¼</p><p>Â  Â  æœ€ç»ˆè¿›è¡Œæ„å»ºçš„æ˜¯æ’ä»¶ï¼</p><h2 id="äº”ã€åŸºäºIDEA-è¿›è¡ŒMavenä¾èµ–ç®¡ç†"><a href="#äº”ã€åŸºäºIDEA-è¿›è¡ŒMavenä¾èµ–ç®¡ç†" class="headerlink" title="äº”ã€åŸºäºIDEA è¿›è¡ŒMavenä¾èµ–ç®¡ç†"></a>äº”ã€åŸºäºIDEA è¿›è¡ŒMavenä¾èµ–ç®¡ç†</h2><h3 id="1-ä¾èµ–ç®¡ç†æ¦‚å¿µ"><a href="#1-ä¾èµ–ç®¡ç†æ¦‚å¿µ" class="headerlink" title="1. ä¾èµ–ç®¡ç†æ¦‚å¿µ"></a>1. ä¾èµ–ç®¡ç†æ¦‚å¿µ</h3><p>Maven ä¾èµ–ç®¡ç†æ˜¯ Maven è½¯ä»¶ä¸­æœ€é‡è¦çš„åŠŸèƒ½ä¹‹ä¸€ã€‚Maven çš„ä¾èµ–ç®¡ç†èƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜è‡ªåŠ¨è§£å†³è½¯ä»¶åŒ…ä¾èµ–é—®é¢˜ï¼Œä½¿å¾—å¼€å‘äººå‘˜èƒ½å¤Ÿè½»æ¾åœ°å°†å…¶ä»–å¼€å‘äººå‘˜å¼€å‘çš„æ¨¡å—æˆ–ç¬¬ä¸‰æ–¹æ¡†æ¶é›†æˆåˆ°è‡ªå·±çš„åº”ç”¨ç¨‹åºæˆ–æ¨¡å—ä¸­ï¼Œé¿å…å‡ºç°ç‰ˆæœ¬å†²çªå’Œä¾èµ–ç¼ºå¤±ç­‰é—®é¢˜ã€‚</p><p>æˆ‘ä»¬é€šè¿‡å®šä¹‰ POM æ–‡ä»¶ï¼ŒMaven èƒ½å¤Ÿè‡ªåŠ¨è§£æé¡¹ç›®çš„ä¾èµ–å…³ç³»ï¼Œå¹¶é€šè¿‡ Maven <strong>ä»“åº“è‡ªåŠ¨</strong>ä¸‹è½½å’Œç®¡ç†ä¾èµ–ï¼Œä»è€Œé¿å…äº†æ‰‹åŠ¨ä¸‹è½½å’Œç®¡ç†ä¾èµ–çš„ç¹çå·¥ä½œå’Œå¯èƒ½å¼•å‘çš„ç‰ˆæœ¬å†²çªé—®é¢˜ã€‚</p><p>æ€»ä¹‹ï¼ŒMaven çš„ä¾èµ–ç®¡ç†æ˜¯ Maven è½¯ä»¶çš„ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œä½¿å¾—è½¯ä»¶åŒ…ä¾èµ–çš„ç®¡ç†å’Œä½¿ç”¨æ›´åŠ æ™ºèƒ½å’Œæ–¹ä¾¿ï¼Œç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ä¸­çš„å·¥ä½œï¼Œå¹¶æé«˜äº†è½¯ä»¶è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="2-Mavenå·¥ç¨‹æ ¸å¿ƒä¿¡æ¯é…ç½®å’Œè§£è¯»ï¼ˆGAVPï¼‰"><a href="#2-Mavenå·¥ç¨‹æ ¸å¿ƒä¿¡æ¯é…ç½®å’Œè§£è¯»ï¼ˆGAVPï¼‰" class="headerlink" title="2. Mavenå·¥ç¨‹æ ¸å¿ƒä¿¡æ¯é…ç½®å’Œè§£è¯»ï¼ˆGAVPï¼‰"></a>2. Mavenå·¥ç¨‹æ ¸å¿ƒä¿¡æ¯é…ç½®å’Œè§£è¯»ï¼ˆGAVPï¼‰</h3><p>ä½ç½®ï¼špom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-comment">&lt;!-- æ¨¡å‹ç‰ˆæœ¬ --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- å…¬å¸æˆ–è€…ç»„ç»‡çš„å”¯ä¸€æ ‡å¿—ï¼Œå¹¶ä¸”é…ç½®æ—¶ç”Ÿæˆçš„è·¯å¾„ä¹Ÿæ˜¯ç”±æ­¤ç”Ÿæˆï¼Œ å¦‚com.companyname.project-groupï¼Œmavenä¼šå°†è¯¥é¡¹ç›®æ‰“æˆçš„jaråŒ…æ”¾æœ¬åœ°è·¯å¾„ï¼š/com/companyname/project-group --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.companyname.project-group<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- é¡¹ç›®çš„å”¯ä¸€IDï¼Œä¸€ä¸ªgroupIdä¸‹é¢å¯èƒ½å¤šä¸ªé¡¹ç›®ï¼Œå°±æ˜¯é artifactIdæ¥åŒºåˆ†çš„ --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>project<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- ç‰ˆæœ¬å· --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>  <br><br><span class="hljs-comment">&lt;!--æ‰“åŒ…æ–¹å¼</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â  é»˜è®¤ï¼šjar</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â  jaræŒ‡çš„æ˜¯æ™®é€šçš„javaé¡¹ç›®æ‰“åŒ…æ–¹å¼ï¼ é¡¹ç›®æ‰“æˆjaråŒ…ï¼</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â  waræŒ‡çš„æ˜¯webé¡¹ç›®æ‰“åŒ…æ–¹å¼ï¼é¡¹ç›®æ‰“æˆwaråŒ…ï¼</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â  pomä¸ä¼šè®²é¡¹ç›®æ‰“åŒ…ï¼è¿™ä¸ªé¡¹ç›®ä½œä¸ºçˆ¶å·¥ç¨‹ï¼Œè¢«å…¶ä»–å·¥ç¨‹èšåˆæˆ–è€…ç»§æ‰¿ï¼åé¢ä¼šè®²è§£ä¸¤ä¸ªæ¦‚å¿µ</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">--&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar/pom/war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h3 id="3-Mavenå·¥ç¨‹ä¾èµ–ç®¡ç†é…ç½®"><a href="#3-Mavenå·¥ç¨‹ä¾èµ–ç®¡ç†é…ç½®" class="headerlink" title="3. Mavenå·¥ç¨‹ä¾èµ–ç®¡ç†é…ç½®"></a>3. Mavenå·¥ç¨‹ä¾èµ–ç®¡ç†é…ç½®</h3><p>ä½ç½®ï¼špom.xml</p><p>ä¾èµ–ç®¡ç†å’Œä¾èµ–æ·»åŠ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â é€šè¿‡ç¼–å†™ä¾èµ–jaråŒ…çš„gavå¿…è¦å±æ€§ï¼Œå¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–ï¼</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â scopeå±æ€§æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥æŒ‡å®šä¾èµ–ç”Ÿæ•ˆèŒƒå›´ï¼</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â ä¾èµ–ä¿¡æ¯æŸ¥è¯¢æ–¹å¼ï¼š</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â  Â  1. mavenä»“åº“ä¿¡æ¯å®˜ç½‘ https://mvnrepository.com/</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â  Â  Â  2. mavensearchæ’ä»¶æœç´¢</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Â --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>Â  Â  <span class="hljs-comment">&lt;!-- å¼•å…¥å…·ä½“çš„ä¾èµ–åŒ… --&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- ä¾èµ–èŒƒå›´ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>ä¾èµ–ç‰ˆæœ¬ç»Ÿä¸€æå–å’Œç»´æŠ¤</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-comment">&lt;!--å£°æ˜ç‰ˆæœ¬--&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><br>Â  <span class="hljs-comment">&lt;!--å‘½åéšä¾¿,å†…éƒ¨åˆ¶å®šç‰ˆæœ¬å·å³å¯ï¼--&gt;</span><br><br>Â  <span class="hljs-tag">&lt;<span class="hljs-name">junit.version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">junit.version</span>&gt;</span><br><br>Â  <span class="hljs-comment">&lt;!-- ä¹Ÿå¯ä»¥é€šè¿‡ mavenè§„å®šçš„å›ºå®šçš„keyï¼Œé…ç½®mavençš„å‚æ•°ï¼å¦‚ä¸‹é…ç½®ç¼–ç æ ¼å¼ï¼--&gt;</span><br><br>Â  <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br><br>Â  <span class="hljs-tag">&lt;<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>  <br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  <span class="hljs-comment">&lt;!--å¼•ç”¨propertieså£°æ˜ç‰ˆæœ¬ --&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><font color="#ff0000"><font color="#ff0000">### 4. ä¾èµ–èŒƒå›´</font></font></p><p>é€šè¿‡è®¾ç½®åæ ‡çš„ä¾èµ–èŒƒå›´(scope)ï¼Œå¯ä»¥è®¾ç½® å¯¹åº”jaråŒ…çš„ä½œç”¨èŒƒå›´ï¼šç¼–è¯‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€è¿è¡Œç¯å¢ƒ</p><p>| ä¾èµ–èŒƒå›´ Â  Â  | æè¿° Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |</p><p>| â€”â€”â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |</p><p>| <strong>compile</strong> Â | ç¼–è¯‘ä¾èµ–èŒƒå›´ï¼Œscope å…ƒç´ çš„ç¼ºçœå€¼ã€‚ä½¿ç”¨æ­¤ä¾èµ–èŒƒå›´çš„ Maven ä¾èµ–ï¼Œå¯¹äºä¸‰ç§ classpath å‡æœ‰æ•ˆï¼Œå³è¯¥ Maven ä¾èµ–åœ¨ä¸Šè¿°ä¸‰ç§ classpath å‡ä¼šè¢«å¼•å…¥ã€‚ä¾‹å¦‚ï¼Œlog4j åœ¨ç¼–è¯‘ã€æµ‹è¯•ã€è¿è¡Œè¿‡ç¨‹éƒ½æ˜¯å¿…é¡»çš„ã€‚ |</p><p>| <strong>test</strong> Â  Â  | æµ‹è¯•ä¾èµ–èŒƒå›´ã€‚ä½¿ç”¨æ­¤ä¾èµ–èŒƒå›´çš„ Maven ä¾èµ–ï¼Œåªå¯¹æµ‹è¯• classpath æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼ŒJunit ä¾èµ–åªæœ‰åœ¨æµ‹è¯•é˜¶æ®µæ‰éœ€è¦ã€‚ |</p><p>| <strong>provided</strong> | å·²æä¾›ä¾èµ–èŒƒå›´ã€‚ä½¿ç”¨æ­¤ä¾èµ–èŒƒå›´çš„ Maven ä¾èµ–ï¼Œåªå¯¹ç¼–è¯‘ classpath å’Œæµ‹è¯• classpath æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œservlet-api ä¾èµ–å¯¹äºç¼–è¯‘ã€æµ‹è¯•é˜¶æ®µè€Œè¨€æ˜¯éœ€è¦çš„ï¼Œä½†æ˜¯è¿è¡Œé˜¶æ®µï¼Œç”±äºå¤–éƒ¨å®¹å™¨å·²ç»æä¾›ï¼Œæ•…ä¸éœ€è¦ Maven é‡å¤å¼•å…¥è¯¥ä¾èµ–ã€‚ |</p><p>| runtime Â  Â  Â | è¿è¡Œæ—¶ä¾èµ–èŒƒå›´ã€‚ä½¿ç”¨æ­¤ä¾èµ–èŒƒå›´çš„ Maven ä¾èµ–ï¼Œåªå¯¹æµ‹è¯• classpathã€è¿è¡Œ classpath æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼ŒJDBC é©±åŠ¨å®ç°ä¾èµ–ï¼Œå…¶åœ¨ç¼–è¯‘æ—¶åªéœ€ JDK æä¾›çš„ JDBC æ¥å£å³å¯ï¼Œåªæœ‰æµ‹è¯•ã€è¿è¡Œé˜¶æ®µæ‰éœ€è¦å®ç°äº† JDBC æ¥å£çš„é©±åŠ¨ã€‚ |</p><p>| system Â  Â  Â  | ç³»ç»Ÿä¾èµ–èŒƒå›´ï¼Œå…¶æ•ˆæœä¸ provided çš„ä¾èµ–èŒƒå›´ä¸€è‡´ã€‚å…¶ç”¨äºæ·»åŠ é Maven ä»“åº“çš„æœ¬åœ°ä¾èµ–ï¼Œé€šè¿‡ä¾èµ–å…ƒç´  dependency ä¸­çš„ systemPath å…ƒç´ æŒ‡å®šæœ¬åœ°ä¾èµ–çš„è·¯å¾„ã€‚é‰´äºä½¿ç”¨å…¶ä¼šå¯¼è‡´é¡¹ç›®çš„å¯ç§»æ¤æ€§é™ä½ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚ |</p><p>| import Â  Â  Â  | å¯¼å…¥ä¾èµ–èŒƒå›´ï¼Œè¯¥ä¾èµ–èŒƒå›´åªèƒ½ä¸ dependencyManagement å…ƒç´ é…åˆä½¿ç”¨ï¼Œå…¶åŠŸèƒ½æ˜¯å°†ç›®æ ‡ pom.xml æ–‡ä»¶ä¸­ dependencyManagement çš„é…ç½®å¯¼å…¥åˆå¹¶åˆ°å½“å‰ pom.xml çš„ dependencyManagement ä¸­ã€‚ |</p><h3 id="5-Mavenå·¥ç¨‹ä¾èµ–ä¸‹è½½å¤±è´¥é”™è¯¯è§£å†³ï¼ˆé‡ç‚¹ï¼‰"><a href="#5-Mavenå·¥ç¨‹ä¾èµ–ä¸‹è½½å¤±è´¥é”™è¯¯è§£å†³ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="5. Mavenå·¥ç¨‹ä¾èµ–ä¸‹è½½å¤±è´¥é”™è¯¯è§£å†³ï¼ˆé‡ç‚¹ï¼‰"></a>5. Mavenå·¥ç¨‹ä¾èµ–ä¸‹è½½å¤±è´¥é”™è¯¯è§£å†³ï¼ˆé‡ç‚¹ï¼‰</h3><p>åœ¨ä½¿ç”¨ Maven æ„å»ºé¡¹ç›®æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿä¾èµ–é¡¹ä¸‹è½½é”™è¯¯çš„æƒ…å†µï¼Œä¸»è¦åŸå› æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li><p>Â ä¸‹è½½ä¾èµ–æ—¶å‡ºç°ç½‘ç»œæ•…éšœæˆ–ä»“åº“æœåŠ¡å™¨å®•æœºç­‰åŸå› ï¼Œå¯¼è‡´æ— æ³•è¿æ¥è‡³ Maven ä»“åº“ï¼Œä»è€Œæ— æ³•ä¸‹è½½ä¾èµ–ã€‚</p></li><li><p>Â ä¾èµ–é¡¹çš„ç‰ˆæœ¬å·æˆ–é…ç½®æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·é”™è¯¯ï¼Œæˆ–è€…ä¾èµ–é¡¹æ²¡æœ‰æ­£ç¡®å®šä¹‰ï¼Œå¯¼è‡´ Maven ä¸‹è½½çš„ä¾èµ–é¡¹ä¸å®é™…éœ€è¦çš„ä¸ä¸€è‡´ï¼Œä»è€Œå¼•å‘é”™è¯¯ã€‚</p></li><li><p>Â æœ¬åœ° Maven ä»“åº“æˆ–ç¼“å­˜è¢«æ±¡æŸ“æˆ–æŸåï¼Œå¯¼è‡´ Maven æ— æ³•æ­£ç¡®åœ°ä½¿ç”¨ç°æœ‰çš„ä¾èµ–é¡¹ã€‚</p></li></ol><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p>Â æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œ Maven ä»“åº“æœåŠ¡å™¨çŠ¶æ€ã€‚</p></li><li><p>Â ç¡®ä¿ä¾èµ–é¡¹çš„ç‰ˆæœ¬å·ä¸é¡¹ç›®å¯¹åº”çš„ç‰ˆæœ¬å·åŒ¹é…ï¼Œå¹¶æ£€æŸ¥ POM æ–‡ä»¶ä¸­çš„ä¾èµ–é¡¹æ˜¯å¦æ­£ç¡®ã€‚</p></li><li><p>Â æ¸…é™¤æœ¬åœ° Maven ä»“åº“ç¼“å­˜ï¼ˆlastUpdated æ–‡ä»¶ï¼‰ï¼Œå› ä¸ºåªè¦å­˜åœ¨lastupdatedç¼“å­˜æ–‡ä»¶ï¼Œåˆ·æ–°ä¹Ÿä¸ä¼šé‡æ–°ä¸‹è½½ã€‚æœ¬åœ°ä»“åº“ä¸­ï¼Œæ ¹æ®ä¾èµ–çš„gavå±æ€§ä¾æ¬¡å‘ä¸‹æŸ¥æ‰¾æ–‡ä»¶å¤¹ï¼Œæœ€ç»ˆåˆ é™¤å†…éƒ¨çš„æ–‡ä»¶ï¼Œåˆ·æ–°é‡æ–°ä¸‹è½½å³å¯ï¼</p></li></ol><p>Â  Â  ä¾‹å¦‚ï¼š pom.xmlä¾èµ–</p><p>Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure></p><p>Â  Â  æ–‡ä»¶ï¼š</p><p>Â  Â  <img src="/image/image_m3iQtBLARz.png"></p><ol start="4"><li>æˆ–è€…å¯ä»¥å°†æ¸…é™¤<strong>lastUpdatedæ–‡ä»¶</strong>çš„æ“ä½œå†™åœ¨ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ä¸­ï¼Œæ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶â€clearLastUpdated.batâ€ï¼Œåå­—ä»»æ„ï¼Œä½†æ˜¯åç¼€å¿…é¡»æ˜¯batï¼Œå°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åˆ°æ–‡ä»¶ä¸­</li></ol><p>Â  Â <figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs bat"><br>Â  Â <span class="hljs-built_in">cls</span><br><br>Â  Â @<span class="hljs-built_in">ECHO</span> OFF<br><br>Â  Â <span class="hljs-built_in">SET</span> CLEAR_PATH=D:<br><br>Â  Â <span class="hljs-built_in">SET</span> CLEAR_DIR=D:\maven-repository(æœ¬åœ°ä»“åº“è·¯å¾„)<br><br>Â  Â <span class="hljs-built_in">color</span> <span class="hljs-number">0</span>a<br><br>Â  Â <span class="hljs-built_in">TITLE</span> ClearLastUpdated <span class="hljs-keyword">For</span> Windows<br><br>Â  Â <span class="hljs-keyword">GOTO</span> MENU<br><br>Â  Â :MENU<br><br>Â  Â <span class="hljs-built_in">CLS</span><br><br>Â  Â <span class="hljs-built_in">ECHO</span>.<br><br>Â  Â <span class="hljs-built_in">ECHO</span>. * * * * Â ClearLastUpdated <span class="hljs-keyword">For</span> Windows Â * * * *<br><br>Â  Â <span class="hljs-built_in">ECHO</span>. * *<br><br>Â  Â <span class="hljs-built_in">ECHO</span>. * <span class="hljs-number">1</span> æ¸…ç†*.lastUpdated *<br><br>Â  Â <span class="hljs-built_in">ECHO</span>. * *<br><br>Â  Â <span class="hljs-built_in">ECHO</span>. * <span class="hljs-number">2</span> æŸ¥çœ‹*.lastUpdated *<br><br>Â  Â <span class="hljs-built_in">ECHO</span>. * *<br><br>Â  Â <span class="hljs-built_in">ECHO</span>. * <span class="hljs-number">3</span> é€€ å‡º *<br><br>Â  Â <span class="hljs-built_in">ECHO</span>. * *<br><br>Â  Â <span class="hljs-built_in">ECHO</span>. * * * * * * * * * * * * * * * * * * * * * * * *<br><br>Â  Â <span class="hljs-built_in">ECHO</span>.<br><br>Â  Â <span class="hljs-built_in">ECHO</span>.è¯·è¾“å…¥é€‰æ‹©é¡¹ç›®çš„åºå·ï¼š<br><br>Â  Â <span class="hljs-built_in">set</span> /p ID=<br><br>Â  Â <span class="hljs-keyword">IF</span> &quot;<span class="hljs-variable">%id%</span>&quot;==&quot;<span class="hljs-number">1</span>&quot; <span class="hljs-keyword">GOTO</span> cmd1<br><br>Â  Â <span class="hljs-keyword">IF</span> &quot;<span class="hljs-variable">%id%</span>&quot;==&quot;<span class="hljs-number">2</span>&quot; <span class="hljs-keyword">GOTO</span> cmd2<br><br>Â  Â <span class="hljs-keyword">IF</span> &quot;<span class="hljs-variable">%id%</span>&quot;==&quot;<span class="hljs-number">3</span>&quot; <span class="hljs-keyword">EXIT</span><br><br>Â  Â <span class="hljs-built_in">PAUSE</span><br><br>Â  Â :cmd1<br><br>Â  Â <span class="hljs-built_in">ECHO</span>. å¼€å§‹æ¸…ç†<br><br>Â  Â <span class="hljs-variable">%CLEAR_PATH%</span><br><br>Â  Â <span class="hljs-built_in">cd</span> <span class="hljs-variable">%CLEAR_DIR%</span><br><br>Â  Â <span class="hljs-keyword">for</span> /r <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (*.lastUpdated) <span class="hljs-keyword">do</span> <span class="hljs-built_in">del</span> <span class="hljs-variable">%%i</span><br><br>Â  Â <span class="hljs-built_in">ECHO</span>.OK<br><br>Â  Â <span class="hljs-built_in">PAUSE</span><br><br>Â  Â <span class="hljs-keyword">GOTO</span> MENU<br><br>Â  Â :cmd2<br><br>Â  Â <span class="hljs-built_in">ECHO</span>. æŸ¥çœ‹*.lastUpdatedæ–‡ä»¶<br><br>Â  Â <span class="hljs-variable">%CLEAR_PATH%</span><br><br>Â  Â <span class="hljs-built_in">cd</span> <span class="hljs-variable">%CLEAR_DIR%</span><br><br>Â  Â <span class="hljs-keyword">for</span> /r <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (*.lastUpdated) <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">%%i</span><br><br>Â  Â <span class="hljs-built_in">ECHO</span>.OK<br><br>Â  Â <span class="hljs-built_in">PAUSE</span><br><br>Â  Â <span class="hljs-keyword">GOTO</span> MENU<br><br></code></pre></td></tr></table></figure></p><p>Â  Â <img src="/image/image-20231021161615994.png" alt="image-20231021161615994"></p><h3 id="6-Mavenå·¥ç¨‹Buildæ„å»ºé…ç½®"><a href="#6-Mavenå·¥ç¨‹Buildæ„å»ºé…ç½®" class="headerlink" title="6. Mavenå·¥ç¨‹Buildæ„å»ºé…ç½®"></a>6. Mavenå·¥ç¨‹Buildæ„å»ºé…ç½®</h3><p>é¡¹ç›®æ„å»ºæ˜¯æŒ‡å°†æºä»£ç ã€ä¾èµ–åº“å’Œèµ„æºæ–‡ä»¶ç­‰è½¬æ¢æˆå¯æ‰§è¡Œæˆ–å¯éƒ¨ç½²çš„åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åŒ…æ‹¬ç¼–è¯‘æºä»£ç ã€é“¾æ¥ä¾èµ–åº“ã€æ‰“åŒ…å’Œéƒ¨ç½²ç­‰å¤šä¸ªæ­¥éª¤ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ„å»ºä¸éœ€è¦é¢å¤–é…ç½®ï¼Œéƒ½æœ‰å¯¹åº”çš„ç¼ºçœé…ç½®ã€‚å½“ç„¶äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨pom.xmlå®šåˆ¶ä¸€äº›é…ç½®ï¼Œæ¥ä¿®æ”¹é»˜è®¤æ„å»ºçš„è¡Œä¸ºå’Œäº§ç‰©ï¼</p><p>ä¾‹å¦‚ï¼š</p><ol><li><p>Â æŒ‡å®šæ„å»ºæ‰“åŒ…æ–‡ä»¶çš„åç§°ï¼Œéé»˜è®¤åç§°</p></li><li><p>Â åˆ¶å®šæ„å»ºæ‰“åŒ…æ—¶ï¼ŒæŒ‡å®šåŒ…å«æ–‡ä»¶æ ¼å¼å’Œæ’é™¤æ–‡ä»¶</p></li><li><p>Â æ‰“åŒ…æ’ä»¶ç‰ˆæœ¬è¿‡ä½ï¼Œé…ç½®æ›´é«˜ç‰ˆæœ¬æ’ä»¶</p></li></ol><p>æ„å»ºé…ç½®æ˜¯åœ¨pom.xml &#x2F; buildæ ‡ç­¾ä¸­æŒ‡å®šï¼</p><p><strong>æŒ‡å®šæ‰“åŒ…å‘½å</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-comment">&lt;!-- é»˜è®¤çš„æ‰“åŒ…åç§°ï¼šartifactid+verson.æ‰“åŒ…æ–¹å¼ --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><br>Â  <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>å®šä¹‰æ‰“åŒ…åç§°<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span> Â <br><br></code></pre></td></tr></table></figure><p><strong>æŒ‡å®šæ‰“åŒ…æ–‡ä»¶</strong></p><p>å¦‚æœåœ¨javaæ–‡ä»¶å¤¹ä¸­æ·»åŠ javaç±»ï¼Œä¼šè‡ªåŠ¨æ‰“åŒ…ç¼–è¯‘åˆ°classesæ–‡ä»¶å¤¹ä¸‹ï¼</p><p>ä½†æ˜¯åœ¨javaæ–‡ä»¶å¤¹ä¸­æ·»åŠ xmlæ–‡ä»¶ï¼Œé»˜è®¤ä¸ä¼šè¢«æ‰“åŒ…ï¼</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§mavenå·¥ç¨‹ç»“æ„æ”¾ç½®çš„æ–‡ä»¶ä¼šé»˜è®¤è¢«ç¼–è¯‘å’Œæ‰“åŒ…ï¼</p><p>é™¤æ­¤ä¹‹å¤–ã€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨resourcesæ ‡ç­¾ï¼ŒæŒ‡å®šè¦æ‰“åŒ…èµ„æºçš„æ–‡ä»¶å¤¹è¦æŠŠå“ªäº›é™æ€èµ„æºæ‰“åŒ…åˆ° classesæ ¹ç›®å½•ä¸‹ï¼</p><p>åº”ç”¨åœºæ™¯ï¼šmybatisä¸­æœ‰æ—¶ä¼šå°†ç”¨äºç¼–å†™SQLè¯­å¥çš„æ˜ å°„æ–‡ä»¶å’Œmapperæ¥å£éƒ½å†™åœ¨src&#x2F;main&#x2F;javaä¸‹çš„æŸä¸ªåŒ…ä¸­ï¼Œæ­¤æ—¶æ˜ å°„æ–‡ä»¶å°±ä¸ä¼šè¢«æ‰“åŒ…ï¼Œå¦‚ä½•è§£å†³</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><br>Â  Â  <span class="hljs-comment">&lt;!--è®¾ç½®è¦æ‰“åŒ…çš„èµ„æºä½ç½®--&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-comment">&lt;!--è®¾ç½®èµ„æºæ‰€åœ¨ç›®å½•--&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">&lt;!--è®¾ç½®åŒ…å«çš„èµ„æºç±»å‹--&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><strong>é…ç½®ä¾èµ–æ’ä»¶</strong></p><p>dependenciesæ ‡ç­¾ä¸‹å¼•å…¥å¼€å‘éœ€è¦çš„jaråŒ…ï¼æˆ‘ä»¬å¯ä»¥åœ¨build&#x2F;plugins&#x2F;pluginæ ‡ç­¾å¼•å…¥æ’ä»¶ï¼</p><p>å¸¸ç”¨çš„æ’ä»¶ï¼šä¿®æ”¹jdkç‰ˆæœ¬ã€tomcatæ’ä»¶ã€mybatisåˆ†é¡µæ’ä»¶ã€mybatisé€†å‘å·¥ç¨‹æ’ä»¶ç­‰ç­‰ï¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><br>Â  <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-comment">&lt;!-- javaç¼–è¯‘æ’ä»¶ï¼Œé…jdkçš„ç¼–è¯‘ç‰ˆæœ¬ --&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-comment">&lt;!-- tomcatæ’ä»¶ --&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>8090<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">uriEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">uriEncoding</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">server</span>&gt;</span>tomcat7<span class="hljs-tag">&lt;/<span class="hljs-name">server</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><font color="#ff0000">## å…­ã€Mavenä¾èµ–ä¼ é€’å’Œä¾èµ–å†²çª</font></p><h3 id="1-Mavenä¾èµ–ä¼ é€’ç‰¹æ€§"><a href="#1-Mavenä¾èµ–ä¼ é€’ç‰¹æ€§" class="headerlink" title="1. Mavenä¾èµ–ä¼ é€’ç‰¹æ€§"></a>1. Mavenä¾èµ–ä¼ é€’ç‰¹æ€§</h3><p><strong>æ¦‚å¿µ</strong></p><p>å‡å¦‚æœ‰Mavené¡¹ç›®Aï¼Œé¡¹ç›®Bä¾èµ–Aï¼Œé¡¹ç›®Cä¾èµ–Bã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¯´ Cä¾èµ–Aã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¾èµ–çš„å…³ç³»ä¸ºï¼šCâ€”&gt;Bâ€”&gt;Aï¼Œ é‚£ä¹ˆæˆ‘ä»¬æ‰§è¡Œé¡¹ç›®Cæ—¶ï¼Œä¼šè‡ªåŠ¨æŠŠBã€Aéƒ½ä¸‹è½½å¯¼å…¥åˆ°Cé¡¹ç›®çš„jaråŒ…æ–‡ä»¶å¤¹ä¸­ï¼Œè¿™å°±æ˜¯ä¾èµ–çš„ä¼ é€’æ€§ã€‚</p><p><strong>ä½œç”¨</strong></p><ul><li><p>Â  ç®€åŒ–ä¾èµ–å¯¼å…¥è¿‡ç¨‹</p></li><li><p>Â  ç¡®ä¿ä¾èµ–ç‰ˆæœ¬æ­£ç¡®</p></li></ul><p><strong>ä¼ é€’çš„åŸåˆ™</strong></p><p>åœ¨ A ä¾èµ– Bï¼ŒB ä¾èµ– C çš„å‰æä¸‹ï¼ŒC æ˜¯å¦èƒ½å¤Ÿä¼ é€’åˆ° Aï¼Œå–å†³äº B ä¾èµ– C æ—¶ä½¿ç”¨çš„ä¾èµ–èŒƒå›´ä»¥åŠé…ç½®</p><ul><li><p>B ä¾èµ– C æ—¶ä½¿ç”¨ compile èŒƒå›´ï¼šå¯ä»¥ä¼ é€’</p></li><li><p>B ä¾èµ– C æ—¶ä½¿ç”¨ test æˆ– provided èŒƒå›´ï¼šä¸èƒ½ä¼ é€’ï¼Œæ‰€ä»¥éœ€è¦è¿™æ ·çš„ jar åŒ…æ—¶ï¼Œå°±å¿…é¡»åœ¨éœ€è¦çš„åœ°æ–¹æ˜ç¡®é…ç½®ä¾èµ–æ‰å¯ä»¥ã€‚</p></li><li><p>B ä¾èµ– C æ—¶ï¼Œè‹¥é…ç½®äº†ä»¥ä¸‹æ ‡ç­¾ï¼Œåˆ™ä¸èƒ½ä¼ é€’</p></li></ul><p>Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.15<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><br>Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure></p><p><strong>ä¾èµ–ä¼ é€’ç»ˆæ­¢</strong></p><ul><li><p>Â  écompileèŒƒå›´è¿›è¡Œä¾èµ–ä¼ é€’</p></li><li><p>Â  ä½¿ç”¨optionalé…ç½®ç»ˆæ­¢ä¼ é€’</p></li><li><p>Â  ä¾èµ–å†²çªï¼ˆä¼ é€’çš„ä¾èµ–å·²ç»å­˜åœ¨ï¼‰</p></li></ul><p><strong>æ¡ˆä¾‹ï¼šå¯¼å…¥jacksonä¾èµ–</strong></p><p>åˆ†æï¼šjacksonéœ€è¦ä¸‰ä¸ªä¾èµ–</p><p><img src="/image/image_9ViibmeAvU.png"></p><p>ä¾èµ–ä¼ é€’å…³ç³»ï¼šdata-bindä¸­ï¼Œä¾èµ–å…¶ä»–ä¸¤ä¸ªä¾èµ–</p><p><img src="/image/image_Wl0Lsj_BLk.png"></p><p>æœ€ä½³å¯¼å…¥ï¼šç›´æ¥å¯ä»¥å¯¼å…¥data-bindï¼Œè‡ªåŠ¨ä¾èµ–ä¼ é€’éœ€è¦çš„ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.10.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <br><br></code></pre></td></tr></table></figure><h3 id="2-Mavenä¾èµ–å†²çªç‰¹æ€§"><a href="#2-Mavenä¾èµ–å†²çªç‰¹æ€§" class="headerlink" title="2. Mavenä¾èµ–å†²çªç‰¹æ€§"></a>2. Mavenä¾èµ–å†²çªç‰¹æ€§</h3><p>å½“ç›´æ¥å¼•ç”¨æˆ–è€…é—´æ¥å¼•ç”¨å‡ºç°äº†ç›¸åŒçš„jaråŒ…! è¿™æ—¶å‘¢ï¼Œä¸€ä¸ªé¡¹ç›®å°±ä¼šå‡ºç°ç›¸åŒçš„é‡å¤jaråŒ…ï¼Œè¿™å°±ç®—ä½œå†²çªï¼ä¾èµ–å†²çªé¿å…å‡ºç°é‡å¤ä¾èµ–ï¼Œå¹¶ä¸”ç»ˆæ­¢ä¾èµ–ä¼ é€’ï¼</p><p><img src="/image/image_km7_szBRUw.png"></p><p>mavenè‡ªåŠ¨è§£å†³ä¾èµ–å†²çªé—®é¢˜èƒ½åŠ›ï¼Œä¼šæŒ‰ç…§è‡ªå·±çš„åŸåˆ™ï¼Œè¿›è¡Œé‡å¤ä¾èµ–é€‰æ‹©ã€‚åŒæ—¶ä¹Ÿæä¾›äº†æ‰‹åŠ¨è§£å†³çš„å†²çªçš„æ–¹å¼ï¼Œä¸è¿‡ä¸æ¨èï¼</p><p><strong>è§£å†³ä¾èµ–å†²çªï¼ˆå¦‚ä½•é€‰æ‹©é‡å¤ä¾èµ–ï¼‰æ–¹å¼ï¼š</strong></p><ol><li>Â è‡ªåŠ¨é€‰æ‹©åŸåˆ™</li></ol><p>Â  Â  - Â  çŸ­è·¯ä¼˜å…ˆåŸåˆ™ï¼ˆç¬¬ä¸€åŸåˆ™ï¼‰</p><p>Â  Â  Â  Â  Aâ€”&gt;Bâ€”&gt;Câ€”&gt;Dâ€”&gt;Eâ€”&gt;X(version 0.0.1)</p><p>Â  Â  Â  Â  Aâ€”&gt;Fâ€”&gt;X(version 0.0.2)</p><p>Â  Â  Â  Â  åˆ™Aä¾èµ–äºX(version 0.0.2)ã€‚</p><p>Â  Â  - Â  ä¾èµ–è·¯å¾„é•¿åº¦ç›¸åŒæƒ…å†µä¸‹ï¼Œåˆ™â€œå…ˆå£°æ˜ä¼˜å…ˆâ€ï¼ˆç¬¬äºŒåŸåˆ™ï¼‰</p><p>Â  Â  Â  Â  Aâ€”&gt;Eâ€”&gt;X(version 0.0.1)</p><p>Â  Â  Â  Â  Aâ€”&gt;Fâ€”&gt;X(version 0.0.2)</p><p>Â  Â  Â  Â  åœ¨&lt;depencies&gt;&lt;&#x2F;depencies&gt;ä¸­ï¼Œå…ˆå£°æ˜çš„ï¼Œè·¯å¾„ç›¸åŒï¼Œä¼šä¼˜å…ˆé€‰æ‹©ï¼</p><ol start="2"><li>Â æ‰‹åŠ¨æ’é™¤</li></ol><p>Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pro01-maven-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-comment">&lt;!-- ä½¿ç”¨excludesæ ‡ç­¾é…ç½®ä¾èµ–çš„æ’é™¤ Â --&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- åœ¨excludeæ ‡ç­¾ä¸­é…ç½®ä¸€ä¸ªå…·ä½“çš„æ’é™¤ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- æŒ‡å®šè¦æ’é™¤çš„ä¾èµ–çš„åæ ‡ï¼ˆä¸éœ€è¦å†™versionï¼‰ --&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure></p><ol start="3"><li>Â å°æ¡ˆä¾‹</li></ol><p>Â  Â  ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><p>Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  å‰æï¼š<br><br>Â  Â  Â  Â A 1.1 -&gt; B 1.1 -&gt; C 1.1<br><br>Â  Â  Â  Â F 2.2 -&gt; B 2.2<br><br>Â  Â  pomå£°æ˜ï¼š<br><br>Â  Â  Â  Â F 2.2<br><br>Â  Â  Â  Â A 1.1<br><br></code></pre></td></tr></table></figure></p><p>Â  Â  è¯·é—®æœ€ç»ˆä¼šå¯¼å…¥å“ªäº›ä¾èµ–å’Œå¯¹åº”ç‰ˆæœ¬ï¼Ÿ</p><h2 id="ä¸ƒã€Mavenå·¥ç¨‹ç»§æ‰¿å’Œèšåˆå…³ç³»"><a href="#ä¸ƒã€Mavenå·¥ç¨‹ç»§æ‰¿å’Œèšåˆå…³ç³»" class="headerlink" title="ä¸ƒã€Mavenå·¥ç¨‹ç»§æ‰¿å’Œèšåˆå…³ç³»"></a>ä¸ƒã€Mavenå·¥ç¨‹ç»§æ‰¿å’Œèšåˆå…³ç³»</h2><h3 id="1-Mavenå·¥ç¨‹ç»§æ‰¿å…³ç³»"><a href="#1-Mavenå·¥ç¨‹ç»§æ‰¿å…³ç³»" class="headerlink" title="1. Mavenå·¥ç¨‹ç»§æ‰¿å…³ç³»"></a>1. Mavenå·¥ç¨‹ç»§æ‰¿å…³ç³»</h3><ol><li>Â ç»§æ‰¿æ¦‚å¿µ</li></ol><p>Â  Â  Maven ç»§æ‰¿æ˜¯æŒ‡åœ¨ Maven çš„é¡¹ç›®ä¸­ï¼Œè®©ä¸€ä¸ªé¡¹ç›®ä»å¦ä¸€ä¸ªé¡¹ç›®ä¸­ç»§æ‰¿é…ç½®ä¿¡æ¯çš„æœºåˆ¶ã€‚ç»§æ‰¿å¯ä»¥è®©æˆ‘ä»¬åœ¨å¤šä¸ªé¡¹ç›®ä¸­å…±äº«åŒä¸€é…ç½®ä¿¡æ¯ï¼Œç®€åŒ–é¡¹ç›®çš„ç®¡ç†å’Œç»´æŠ¤å·¥ä½œã€‚</p><ol start="2"><li>Â ç»§æ‰¿ä½œç”¨</li></ol><p>Â  Â  åœ¨çˆ¶å·¥ç¨‹ä¸­ç»Ÿä¸€ç®¡ç†é¡¹ç›®ä¸­çš„ä¾èµ–ä¿¡æ¯ã€‚</p><p>Â  Â  å®ƒçš„èƒŒæ™¯æ˜¯ï¼š</p><p>Â  Â  - Â  å¯¹ä¸€ä¸ªæ¯”è¾ƒå¤§å‹çš„é¡¹ç›®è¿›è¡Œäº†æ¨¡å—æ‹†åˆ†ã€‚</p><p>Â  Â  - Â  ä¸€ä¸ª project ä¸‹é¢ï¼Œåˆ›å»ºäº†å¾ˆå¤šä¸ª moduleã€‚</p><p>Â  Â  - Â  æ¯ä¸€ä¸ª module éƒ½éœ€è¦é…ç½®è‡ªå·±çš„ä¾èµ–ä¿¡æ¯ã€‚</p><p>Â  Â  å®ƒèƒŒåçš„éœ€æ±‚æ˜¯ï¼š</p><p>Â  Â  - Â  åœ¨æ¯ä¸€ä¸ª module ä¸­å„è‡ªç»´æŠ¤å„è‡ªçš„ä¾èµ–ä¿¡æ¯å¾ˆå®¹æ˜“å‘ç”Ÿå‡ºå…¥ï¼Œä¸æ˜“ç»Ÿä¸€ç®¡ç†ã€‚</p><p>Â  Â  - Â  ä½¿ç”¨åŒä¸€ä¸ªæ¡†æ¶å†…çš„ä¸åŒ jar åŒ…ï¼Œå®ƒä»¬åº”è¯¥æ˜¯åŒä¸€ä¸ªç‰ˆæœ¬ï¼Œæ‰€ä»¥æ•´ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨çš„æ¡†æ¶ç‰ˆæœ¬éœ€è¦ç»Ÿä¸€ã€‚</p><p>Â  Â  - Â  ä½¿ç”¨æ¡†æ¶æ—¶æ‰€éœ€è¦çš„ jar åŒ…ç»„åˆï¼ˆæˆ–è€…è¯´ä¾èµ–ä¿¡æ¯ç»„åˆï¼‰éœ€è¦ç»è¿‡é•¿æœŸæ‘¸ç´¢å’Œåå¤è°ƒè¯•ï¼Œæœ€ç»ˆç¡®å®šä¸€ä¸ªå¯ç”¨ç»„åˆã€‚è¿™ä¸ªè€—è´¹å¾ˆå¤§ç²¾åŠ›æ€»ç»“å‡ºæ¥çš„æ–¹æ¡ˆä¸åº”è¯¥åœ¨æ–°çš„é¡¹ç›®ä¸­é‡æ–°æ‘¸ç´¢ã€‚</p><p>Â  Â  Â  Â  é€šè¿‡åœ¨çˆ¶å·¥ç¨‹ä¸­ä¸ºæ•´ä¸ªé¡¹ç›®ç»´æŠ¤ä¾èµ–ä¿¡æ¯çš„ç»„åˆæ—¢ä¿è¯äº†æ•´ä¸ªé¡¹ç›®ä½¿ç”¨è§„èŒƒã€å‡†ç¡®çš„ jar åŒ…ï¼›åˆèƒ½å¤Ÿå°†ä»¥å¾€çš„ç»éªŒæ²‰æ·€ä¸‹æ¥ï¼ŒèŠ‚çº¦æ—¶é—´å’Œç²¾åŠ›ã€‚</p><ol start="3"><li>Â ç»§æ‰¿è¯­æ³•</li></ol><p>Â  Â  - Â  çˆ¶å·¥ç¨‹</p><p>Â  Â  Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pro03-maven-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- å½“å‰å·¥ç¨‹ä½œä¸ºçˆ¶å·¥ç¨‹ï¼Œå®ƒè¦å»ç®¡ç†å­å·¥ç¨‹ï¼Œæ‰€ä»¥æ‰“åŒ…æ–¹å¼å¿…é¡»æ˜¯ pom --&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br></code></pre></td></tr></table></figure></p><p>Â  Â  - Â  å­å·¥ç¨‹</p><p>Â  Â  Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- ä½¿ç”¨parentæ ‡ç­¾æŒ‡å®šå½“å‰å·¥ç¨‹çš„çˆ¶å·¥ç¨‹ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- çˆ¶å·¥ç¨‹çš„åæ ‡ --&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pro03-maven-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- å­å·¥ç¨‹çš„åæ ‡ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- å¦‚æœå­å·¥ç¨‹åæ ‡ä¸­çš„groupIdå’Œversionä¸çˆ¶å·¥ç¨‹ä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- &lt;groupId&gt;com.atguigu.maven&lt;/groupId&gt; --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pro04-maven-module<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; --&gt;</span><br><br></code></pre></td></tr></table></figure></p><ol start="4"><li>Â çˆ¶å·¥ç¨‹ä¾èµ–ç»Ÿä¸€ç®¡ç†</li></ol><p>Â  Â  - Â  çˆ¶å·¥ç¨‹å£°æ˜ç‰ˆæœ¬</p><p>Â  Â  Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- ä½¿ç”¨dependencyManagementæ ‡ç­¾é…ç½®å¯¹ä¾èµ–çš„ç®¡ç† --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- è¢«ç®¡ç†çš„ä¾èµ–å¹¶æ²¡æœ‰çœŸæ­£è¢«å¼•å…¥åˆ°å·¥ç¨‹ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-beans<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-expression<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br><br></code></pre></td></tr></table></figure></p><p>Â  Â  - Â  å­å·¥ç¨‹å¼•ç”¨ç‰ˆæœ¬</p><p>Â  Â  Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- å­å·¥ç¨‹å¼•ç”¨çˆ¶å·¥ç¨‹ä¸­çš„ä¾èµ–ä¿¡æ¯æ—¶ï¼Œå¯ä»¥æŠŠç‰ˆæœ¬å·å»æ‰ã€‚ Â --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- æŠŠç‰ˆæœ¬å·å»æ‰å°±è¡¨ç¤ºå­å·¥ç¨‹ä¸­è¿™ä¸ªä¾èµ–çš„ç‰ˆæœ¬ç”±çˆ¶å·¥ç¨‹å†³å®šã€‚ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- å…·ä½“æ¥è¯´æ˜¯ç”±çˆ¶å·¥ç¨‹çš„dependencyManagementæ¥å†³å®šã€‚ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-beans<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-expression<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br></code></pre></td></tr></table></figure></p><h3 id="2-Mavenå·¥ç¨‹èšåˆå…³ç³»"><a href="#2-Mavenå·¥ç¨‹èšåˆå…³ç³»" class="headerlink" title="2. Mavenå·¥ç¨‹èšåˆå…³ç³»"></a>2. Mavenå·¥ç¨‹èšåˆå…³ç³»</h3><ol><li>Â èšåˆæ¦‚å¿µ</li></ol><p>Â  Â  Maven èšåˆæ˜¯æŒ‡å°†å¤šä¸ªé¡¹ç›®ç»„ç»‡åˆ°ä¸€ä¸ªçˆ¶çº§é¡¹ç›®ä¸­ï¼Œä»¥ä¾¿ä¸€èµ·æ„å»ºå’Œç®¡ç†çš„æœºåˆ¶ã€‚èšåˆå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç®¡ç†ä¸€ç»„ç›¸å…³çš„å­é¡¹ç›®ï¼ŒåŒæ—¶ç®€åŒ–å®ƒä»¬çš„æ„å»ºå’Œéƒ¨ç½²è¿‡ç¨‹ã€‚</p><ol start="2"><li>Â èšåˆä½œç”¨</li></ol><p>Â  Â  1. Â ç®¡ç†å¤šä¸ªå­é¡¹ç›®ï¼šé€šè¿‡èšåˆï¼Œå¯ä»¥å°†å¤šä¸ªå­é¡¹ç›®ç»„ç»‡åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿ç®¡ç†å’Œç»´æŠ¤ã€‚</p><p>Â  Â  2. Â æ„å»ºå’Œå‘å¸ƒä¸€ç»„ç›¸å…³çš„é¡¹ç›®ï¼šé€šè¿‡èšåˆï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå‘½ä»¤ä¸­æ„å»ºå’Œå‘å¸ƒå¤šä¸ªç›¸å…³çš„é¡¹ç›®ï¼Œç®€åŒ–äº†éƒ¨ç½²å’Œç»´æŠ¤å·¥ä½œã€‚</p><p>Â  Â  3. Â ä¼˜åŒ–æ„å»ºé¡ºåºï¼šé€šè¿‡èšåˆï¼Œå¯ä»¥å¯¹å¤šä¸ªé¡¹ç›®è¿›è¡Œé¡ºåºæ§åˆ¶ï¼Œé¿å…å‡ºç°æ„å»ºä¾èµ–æ··ä¹±å¯¼è‡´æ„å»ºå¤±è´¥çš„æƒ…å†µã€‚</p><p>Â  Â  4. Â ç»Ÿä¸€ç®¡ç†ä¾èµ–é¡¹ï¼šé€šè¿‡èšåˆï¼Œå¯ä»¥åœ¨çˆ¶é¡¹ç›®ä¸­ç®¡ç†å…¬å…±ä¾èµ–é¡¹å’Œæ’ä»¶ï¼Œé¿å…é‡å¤å®šä¹‰ã€‚</p><ol start="3"><li>Â èšåˆè¯­æ³•</li></ol><p>Â  Â  çˆ¶é¡¹ç›®ä¸­åŒ…å«çš„å­é¡¹ç›®åˆ—è¡¨ã€‚</p><p>Â  Â  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>parent-project<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>child-project1<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>child-project2<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><br>Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure></p><ol start="4"><li>Â èšåˆæ¼”ç¤º</li></ol><p>Â  Â  é€šè¿‡è§¦å‘çˆ¶å·¥ç¨‹æ„å»ºå‘½ä»¤ã€å¼•å‘æ‰€æœ‰å­æ¨¡å—æ„å»ºï¼äº§ç”Ÿååº”å †ï¼</p><h2 id="å…«ã€Mavenç§æœ"><a href="#å…«ã€Mavenç§æœ" class="headerlink" title="å…«ã€Mavenç§æœ"></a>å…«ã€Mavenç§æœ</h2><h3 id="1-Mavenç§æœç®€ä»‹"><a href="#1-Mavenç§æœç®€ä»‹" class="headerlink" title="1. Mavenç§æœç®€ä»‹"></a>1. Mavenç§æœç®€ä»‹</h3><p>â‘ ç§æœç®€ä»‹</p><p>Maven ç§æœæ˜¯ä¸€ç§ç‰¹æ®Šçš„Mavenè¿œç¨‹ä»“åº“ï¼Œå®ƒæ˜¯æ¶è®¾åœ¨å±€åŸŸç½‘å†…çš„ä»“åº“æœåŠ¡ï¼Œç”¨æ¥ä»£ç†ä½äºå¤–éƒ¨çš„è¿œç¨‹ä»“åº“ï¼ˆä¸­å¤®ä»“åº“ã€å…¶ä»–è¿œç¨‹å…¬å…±ä»“åº“ï¼‰ã€‚</p><blockquote><p>å½“ç„¶ä¹Ÿå¹¶ä¸æ˜¯è¯´ç§æœåªèƒ½å»ºç«‹åœ¨å±€åŸŸç½‘ï¼Œä¹Ÿæœ‰å¾ˆå¤šå…¬å¸ä¼šç›´æ¥æŠŠç§æœéƒ¨ç½²åˆ°å…¬ç½‘ï¼Œå…·ä½“è¿˜æ˜¯å¾—çœ‹å…¬å¸ä¸šåŠ¡çš„æ€§è´¨æ˜¯å¦æ˜¯ä¿å¯†çš„ç­‰ç­‰ï¼Œå› ä¸ºå±€åŸŸç½‘çš„è¯åªèƒ½åœ¨å…¬å¸ç”¨ï¼Œéƒ¨ç½²åˆ°å…¬ç½‘çš„è¯å‘˜å·¥åœ¨å®¶é‡Œä¹Ÿå¯ä»¥åŠå…¬ä½¿ç”¨ã€‚</p></blockquote><p>å»ºç«‹äº† Maven ç§æœåï¼Œå½“å±€åŸŸç½‘å†…çš„ç”¨æˆ·éœ€è¦æŸä¸ªæ„ä»¶æ—¶ï¼Œä¼šæŒ‰ç…§å¦‚ä¸‹é¡ºåºè¿›è¡Œè¯·æ±‚å’Œä¸‹è½½ã€‚</p><p>è¯·æ±‚æœ¬åœ°ä»“åº“ï¼Œè‹¥æœ¬åœ°ä»“åº“ä¸å­˜åœ¨æ‰€éœ€æ„ä»¶ï¼Œåˆ™è·³è½¬åˆ°ç¬¬ 2 æ­¥ï¼›</p><p>è¯·æ±‚ Maven ç§æœï¼Œå°†æ‰€éœ€æ„ä»¶ä¸‹è½½åˆ°æœ¬åœ°ä»“åº“ï¼Œè‹¥ç§æœä¸­ä¸å­˜åœ¨æ‰€éœ€æ„ä»¶ï¼Œåˆ™è·³è½¬åˆ°ç¬¬ 3 æ­¥ã€‚</p><p>è¯·æ±‚å¤–éƒ¨çš„è¿œç¨‹ä»“åº“ï¼Œå°†æ‰€éœ€æ„ä»¶ä¸‹è½½å¹¶ç¼“å­˜åˆ° Maven ç§æœï¼Œè‹¥å¤–éƒ¨è¿œç¨‹ä»“åº“ä¸å­˜åœ¨æ‰€éœ€æ„ä»¶ï¼Œåˆ™ Maven ç›´æ¥æŠ¥é”™ã€‚</p><p>æ­¤å¤–ï¼Œä¸€äº›æ— æ³•ä»å¤–éƒ¨ä»“åº“ä¸‹è½½åˆ°çš„æ„ä»¶ï¼Œä¹Ÿèƒ½ä»æœ¬åœ°ä¸Šä¼ åˆ°ç§æœä¾›å…¶ä»–äººä½¿ç”¨ã€‚</p><p><img src="/image/image-20231021164631791.png" alt="image-20231021164631791"></p><p>â‘¡Mavenç§æœçš„ä¼˜åŠ¿</p><ol><li>èŠ‚çœå¤–ç½‘å¸¦å®½</li></ol><p>Â  Â æ¶ˆé™¤å¯¹å¤–éƒ¨è¿œç¨‹ä»“åº“çš„å¤§é‡é‡å¤è¯·æ±‚ï¼ˆä¼šæ¶ˆè€—å¾ˆå¤§é‡çš„å¸¦å®½ï¼‰ï¼Œé™ä½å¤–ç½‘å¸¦å®½å‹åŠ›ã€‚</p><ol start="2"><li>ä¸‹è½½é€Ÿåº¦æ›´å¿«</li></ol><p>Â  Â Mavenç§æœä½äºå±€åŸŸç½‘å†…ï¼Œä»ç§æœä¸‹è½½æ„å»ºæ›´å¿«æ›´ç¨³å®šã€‚</p><ol start="3"><li>ä¾¿äºéƒ¨ç½²ç¬¬ä¸‰æ–¹æ„ä»¶</li></ol><p>Â  Â æœ‰äº›æ„ä»¶æ— æ³•ä»ä»»ä½•ä¸€ä¸ªè¿œç¨‹ä»“åº“ä¸­è·å¾—ï¼ˆå¦‚ï¼šå…¬å¸æˆ–ç»„ç»‡å†…éƒ¨çš„ç§æœ‰æ„ä»¶ã€Oracleçš„JDBCé©±åŠ¨ç­‰ï¼‰ï¼Œå»ºç«‹ç§æœä¹‹åï¼Œå°±å¯ä»¥å°†è¿™äº›æ„ä»¶éƒ¨ç½²åˆ°ç§æœä¸­ï¼Œä¾›å†…éƒ¨Mavené¡¹ç›®ä½¿ç”¨ã€‚</p><ol start="4"><li>æé«˜é¡¹ç›®çš„ç¨³å®šæ€§ï¼Œå¢å¼ºå¯¹é¡¹ç›®çš„æ§åˆ¶</li></ol><p>Â  Â å¦‚æœä¸å»ºç«‹ç§æœï¼Œé‚£ä¹ˆMavené¡¹ç›®çš„æ„ä»¶å°±é«˜åº¦ä¾èµ–å¤–éƒ¨çš„è¿œç¨‹ä»“åº“ï¼Œè‹¥å¤–éƒ¨ç½‘ç»œä¸ç¨³å®šï¼Œåˆ™é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ä¹Ÿä¼šå˜å¾—ä¸ç¨³å®šã€‚å»ºç«‹ç§æœåï¼Œå³ä½¿å¤–éƒ¨ç½‘ç»œçŠ¶å†µä¸ä½³ç”šè‡³ä¸­æ–­ï¼Œåªè¦ç§æœä¸­å·²ç»ç¼“å­˜äº†æ‰€éœ€çš„æ„ä»¶ï¼ŒMavenä¹Ÿèƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚ç§æœè½¯ä»¶ï¼ˆå¦‚ï¼šNexusï¼‰æä¾›äº†å¾ˆå¤šæ§åˆ¶åŠŸèƒ½ï¼ˆå¦‚ï¼šæƒé™ç®¡ç†ã€RELEASE&#x2F;SNAPSHOTç‰ˆæœ¬æ§åˆ¶ç­‰ï¼‰ï¼Œå¯ä»¥å¯¹ä»“åº“è¿›è¡Œä¸€äº›æ›´åŠ é«˜çº§çš„æ§åˆ¶ã€‚</p><ol start="5"><li>é™ä½ä¸­å¤®ä»“åº“å¾—è´Ÿè·å‹åŠ›</li></ol><p>Â  Â ç”±äºç§æœä¼šç¼“å­˜ä¸­å¤®ä»“åº“å¾—æ„ä»¶ï¼Œé¿å…äº†å¾ˆå¤šå¯¹ä¸­å¤®ä»“åº“çš„é‡å¤ä¸‹è½½ï¼Œé™ä½äº†ä¸­å¤®ä»“åº“çš„è´Ÿè·ã€‚</p><p>â‘¢å¸¸è§çš„Mavenç§æœäº§å“</p><ol><li><p>Apacheçš„Archiva</p></li><li><p>JFrogçš„Artifactory</p></li><li><p>Sonatypeçš„Nexusï¼ˆ[ËˆneksÉ™s]ï¼‰ï¼ˆå½“å‰æœ€æµè¡Œã€ä½¿ç”¨æœ€å¹¿æ³›ï¼‰</p></li></ol><h3 id="2-Nexusä¸‹è½½å®‰è£…"><a href="#2-Nexusä¸‹è½½å®‰è£…" class="headerlink" title="2. Nexusä¸‹è½½å®‰è£…"></a>2. Nexusä¸‹è½½å®‰è£…</h3><p>ä¸‹è½½åœ°å€ï¼š<a href="https://help.sonatype.com/repomanager3/product-information/download">https://help.sonatype.com/repomanager3/product-information/download</a></p><p>è§£å‹ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€CMDï¼Œè¿›å…¥binç›®å½•ä¸‹ï¼Œæ‰§è¡Œ.&#x2F;nexus &#x2F;runå‘½ä»¤å¯åŠ¨</p><p>è®¿é—® Nexus é¦–é¡µ</p><p>é¦–é¡µåœ°å€ï¼š<a href="http://localhost:8081/%EF%BC%8C8081%E4%B8%BA%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3%E5%8F%B7">http://localhost:8081/ï¼Œ8081ä¸ºé»˜è®¤ç«¯å£å·</a></p><p><img src="/image/img001.612496a3.png" alt="images"></p><h3 id="3-åˆå§‹è®¾ç½®"><a href="#3-åˆå§‹è®¾ç½®" class="headerlink" title="3. åˆå§‹è®¾ç½®"></a>3. åˆå§‹è®¾ç½®</h3><p><img src="/image/img002.e1ac8197.png" alt="images"></p><p><img src="/image/image-20231031171116756.png" alt="image-20231031171116756"></p><p>è¿™é‡Œå‚è€ƒæç¤ºï¼š</p><ul><li><p>ç”¨æˆ·åï¼šadmin</p></li><li><p>å¯†ç ï¼šæŸ¥çœ‹ <strong>E:\Server\nexus-3.61.0-02-win64\sonatype-work\nexus3\admin.password</strong> æ–‡ä»¶</p></li></ul><p><img src="/image/image-20231031171242874.png" alt="image-20231031171242874"></p><p>ç»§ç»­æ‰§è¡Œåˆå§‹åŒ–ï¼š</p><p><img src="/image/img005.4b81e5ab.png" alt="images"></p><p><img src="/image/img006.43ebb0ac.png" alt="images"></p><p>åŒ¿åç™»å½•ï¼Œå¯ç”¨è¿˜æ˜¯ç¦ç”¨ï¼Ÿç”±äºå¯ç”¨åŒ¿åç™»å½•åï¼Œåç»­æ“ä½œæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºç¦ç”¨åŒ¿åç™»å½•çš„æ“ä½œï¼š</p><p><img src="/image/image-20231031171607378.png" alt="image-20231031171607378"></p><p>åˆå§‹åŒ–å®Œæ¯•ï¼š</p><p><img src="/image/image-20231031171708085.png" alt="image-20231031171708085"></p><h3 id="4-Nexusä¸Šçš„å„ç§ä»“åº“"><a href="#4-Nexusä¸Šçš„å„ç§ä»“åº“" class="headerlink" title="4. Nexusä¸Šçš„å„ç§ä»“åº“"></a>4. Nexusä¸Šçš„å„ç§ä»“åº“</h3><p><img src="/image/img009.7f737ed7.png" alt="images"></p><p>| ä»“åº“ç±»å‹ | è¯´æ˜ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |</p><p>| â€”â€”â€“ | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- |</p><p>| proxy Â  Â | æŸä¸ªè¿œç¨‹ä»“åº“çš„ä»£ç† Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |</p><p>| group Â  Â | å­˜æ”¾ï¼šé€šè¿‡ Nexus è·å–çš„ç¬¬ä¸‰æ–¹ jar åŒ… Â  Â  Â  Â  Â  |</p><p>| hosted Â  | å­˜æ”¾ï¼šæœ¬å›¢é˜Ÿå…¶ä»–å¼€å‘äººå‘˜éƒ¨ç½²åˆ° Nexus çš„ jar åŒ… |</p><p>| ä»“åº“åç§° Â  Â  Â  Â | è¯´æ˜ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |</p><p>| â€”â€”â€”â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |</p><p>| maven-central Â  | Nexus å¯¹ Maven ä¸­å¤®ä»“åº“çš„ä»£ç† Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â |</p><p>| maven-public Â  Â | Nexus é»˜è®¤åˆ›å»ºï¼Œä¾›å¼€å‘äººå‘˜ä¸‹è½½ä½¿ç”¨çš„ç»„ä»“åº“ Â  Â  Â  Â  Â  Â  Â  Â  Â  |</p><p>| maven-releases Â | Nexus é»˜è®¤åˆ›å»ºï¼Œä¾›å¼€å‘äººå‘˜éƒ¨ç½²è‡ªå·± jar åŒ…çš„å®¿ä¸»ä»“åº“ è¦æ±‚ releases ç‰ˆæœ¬ |</p><p>| maven-snapshots | Nexus é»˜è®¤åˆ›å»ºï¼Œä¾›å¼€å‘äººå‘˜éƒ¨ç½²è‡ªå·± jar åŒ…çš„å®¿ä¸»ä»“åº“ è¦æ±‚ snapshots ç‰ˆæœ¬ |</p><p>åˆå§‹çŠ¶æ€ä¸‹ï¼Œè¿™å‡ ä¸ªä»“åº“éƒ½æ²¡æœ‰å†…å®¹ï¼š</p><p><img src="/image/img010.e3573d0b.png" alt="images"></p><h3 id="5-é€šè¿‡-Nexus-ä¸‹è½½-jar-åŒ…"><a href="#5-é€šè¿‡-Nexus-ä¸‹è½½-jar-åŒ…" class="headerlink" title="5. é€šè¿‡ Nexus ä¸‹è½½ jar åŒ…"></a>5. é€šè¿‡ Nexus ä¸‹è½½ jar åŒ…</h3><p>ä¿®æ”¹æœ¬åœ°mavençš„æ ¸å¿ƒé…ç½®æ–‡ä»¶settings.xmlï¼Œè®¾ç½®æ–°çš„æœ¬åœ°ä»“åº“åœ°å€</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-comment">&lt;!-- é…ç½®ä¸€ä¸ªæ–°çš„ Maven æœ¬åœ°ä»“åº“ --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">localRepository</span>&gt;</span>D:/maven-repository-new<span class="hljs-tag">&lt;/<span class="hljs-name">localRepository</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>æŠŠæˆ‘ä»¬åŸæ¥é…ç½®é˜¿é‡Œäº‘ä»“åº“åœ°å€çš„ mirror æ ‡ç­¾æ”¹æˆä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>nexus-mine<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Nexus mine<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://localhost:8081/repository/maven-public/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ url æ ‡ç­¾æ˜¯è¿™ä¹ˆæ¥çš„ï¼š</p><p><img src="/image/img012.5a3b1f11.png" alt="images"></p><p><img src="/image/image-20231031172137288.png" alt="image-20231031172137288"></p><p>æŠŠä¸Šå›¾ä¸­çœ‹åˆ°çš„åœ°å€å¤åˆ¶å‡ºæ¥å³å¯ã€‚å¦‚æœæˆ‘ä»¬åœ¨å‰é¢å…è®¸äº†åŒ¿åè®¿é—®ï¼Œåˆ°è¿™é‡Œå°±å¤Ÿäº†ã€‚ä½†å¦‚æœæˆ‘ä»¬ç¦ç”¨äº†åŒ¿åè®¿é—®ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è¿˜è¦ç»§ç»­é…ç½® settings.xmlï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">server</span>&gt;</span><br><br>Â  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>nexus-mine<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br><br>Â  <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br><br>Â  <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">server</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦<strong>æ ¼å¤–æ³¨æ„</strong>ï¼šserver æ ‡ç­¾å†…çš„ id æ ‡ç­¾å€¼å¿…é¡»å’Œ mirror æ ‡ç­¾ä¸­çš„ id å€¼ä¸€æ ·ã€‚</p><p>æ‰¾ä¸€ä¸ªç”¨åˆ°æ¡†æ¶çš„ Maven å·¥ç¨‹ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br>mvn clean compile<br><br></code></pre></td></tr></table></figure><p>ä¸‹è½½è¿‡ç¨‹æ—¥å¿—ï¼š</p><blockquote><p>Downloading from nexus-mine: <a href="http://localhost:8081/repository/maven-public/com/jayway/jsonpath/json-path/2.4.0/json-path-2.4.0.pom">http://localhost:8081/repository/maven-public/com/jayway/jsonpath/json-path/2.4.0/json-path-2.4.0.pom</a></p></blockquote><blockquote><p>Downloaded from nexus-mine: <a href="http://localhost:8081/repository/maven-public/com/jayway/jsonpath/json-path/2.4.0/json-path-2.4.0.pom">http://localhost:8081/repository/maven-public/com/jayway/jsonpath/json-path/2.4.0/json-path-2.4.0.pom</a> (2.6 kB at 110 kB&#x2F;s)</p></blockquote><blockquote><p>Downloading from nexus-mine: <a href="http://localhost:8081/repository/maven-public/net/minidev/json-smart/2.3/json-smart-2.3.pom">http://localhost:8081/repository/maven-public/net/minidev/json-smart/2.3/json-smart-2.3.pom</a></p></blockquote><blockquote><p>Downloaded from nexus-mine: <a href="http://localhost:8081/repository/maven-public/net/minidev/json-smart/2.3/json-smart-2.3.pom">http://localhost:8081/repository/maven-public/net/minidev/json-smart/2.3/json-smart-2.3.pom</a> (9.0 kB at 376 kB&#x2F;s)</p></blockquote><blockquote><p>Downloading from nexus-mine: <a href="http://localhost:8081/repository/maven-public/net/minidev/minidev-parent/2.3/minidev-parent-2.3.pom">http://localhost:8081/repository/maven-public/net/minidev/minidev-parent/2.3/minidev-parent-2.3.pom</a></p></blockquote><blockquote><p>Downloaded from nexus-mine: <a href="http://localhost:8081/repository/maven-public/net/minidev/minidev-parent/2.3/minidev-parent-2.3.pom">http://localhost:8081/repository/maven-public/net/minidev/minidev-parent/2.3/minidev-parent-2.3.pom</a> (8.5 kB at 404 kB&#x2F;s)</p></blockquote><blockquote><p>Downloading from nexus-mine: <a href="http://localhost:8081/repository/maven-public/net/minidev/accessors-smart/1.2/accessors-smart-1.2.pom">http://localhost:8081/repository/maven-public/net/minidev/accessors-smart/1.2/accessors-smart-1.2.pom</a></p></blockquote><blockquote><p>Downloaded from nexus-mine: <a href="http://localhost:8081/repository/maven-public/net/minidev/accessors-smart/1.2/accessors-smart-1.2.pom">http://localhost:8081/repository/maven-public/net/minidev/accessors-smart/1.2/accessors-smart-1.2.pom</a> (12 kB at 463 kB&#x2F;s)</p></blockquote><p>ä¸‹è½½åï¼ŒNexus æœåŠ¡å™¨ä¸Šå°±æœ‰äº† jar åŒ…ï¼š</p><p><img src="/image/img014.cc0e87c3.png" alt="images"></p><p>è‹¥ä¸‹è½½é€Ÿåº¦å¤ªæ…¢ï¼Œå¯ä»¥è®¾ç½®ç§æœä¸­ä¸­å¤®ä»“åº“çš„åœ°å€ä¸ºé˜¿é‡Œäº‘ä»“åº“åœ°å€</p><p><img src="/image/image-20231031175035345.png" alt="image-20231031175035345"></p><p>ä¿®æ”¹ä¸ºï¼š<a href="http://maven.aliyun.com/nexus/content/groups/public/">http://maven.aliyun.com/nexus/content/groups/public/</a></p><p><img src="/image/image-20231031175134745.png" alt="image-20231031175134745"></p><h3 id="6-å°†-jar-åŒ…éƒ¨ç½²åˆ°-Nexus"><a href="#6-å°†-jar-åŒ…éƒ¨ç½²åˆ°-Nexus" class="headerlink" title="6. å°† jar åŒ…éƒ¨ç½²åˆ° Nexus"></a>6. å°† jar åŒ…éƒ¨ç½²åˆ° Nexus</h3><p>mavenå·¥ç¨‹ä¸­é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">distributionManagement</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">snapshotRepository</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>nexus-mine<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Nexus Snapshot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://localhost:8081/repository/maven-snapshots/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">snapshotRepository</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">distributionManagement</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¿™é‡Œ snapshotRepository çš„ id æ ‡ç­¾å¿…é¡»å’Œ settings.xml ä¸­æŒ‡å®šçš„ mirror æ ‡ç­¾çš„ id å±æ€§ä¸€è‡´ã€‚</p><p>æ‰§è¡Œéƒ¨ç½²å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br>mvn deploy<br><br></code></pre></td></tr></table></figure><blockquote><p>Uploading to nexus-mine: <a href="http://localhost:8081/repository/maven-snapshots/com/atguigu/demo/demo07-redis-data-provider/1.0-SNAPSHOT/maven-metadata.xml">http://localhost:8081/repository/maven-snapshots/com/atguigu/demo/demo07-redis-data-provider/1.0-SNAPSHOT/maven-metadata.xml</a></p></blockquote><blockquote><p>Uploaded to nexus-mine: <a href="http://localhost:8081/repository/maven-snapshots/com/atguigu/demo/demo07-redis-data-provider/1.0-SNAPSHOT/maven-metadata.xml">http://localhost:8081/repository/maven-snapshots/com/atguigu/demo/demo07-redis-data-provider/1.0-SNAPSHOT/maven-metadata.xml</a> (786 B at 19 kB&#x2F;s)</p></blockquote><blockquote><p>Uploading to nexus-mine: <a href="http://localhost:8081/repository/maven-snapshots/com/atguigu/demo/demo07-redis-data-provider/maven-metadata.xml">http://localhost:8081/repository/maven-snapshots/com/atguigu/demo/demo07-redis-data-provider/maven-metadata.xml</a></p></blockquote><blockquote><p>Uploaded to nexus-mine: <a href="http://localhost:8081/repository/maven-snapshots/com/atguigu/demo/demo07-redis-data-provider/maven-metadata.xml">http://localhost:8081/repository/maven-snapshots/com/atguigu/demo/demo07-redis-data-provider/maven-metadata.xml</a> (300 B at 6.5 kB&#x2F;s)</p></blockquote><blockquote><p>[INFO] â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p></blockquote><blockquote><p>[INFO] Reactor Summary:</p></blockquote><blockquote><p>[INFO]</p></blockquote><blockquote><p>[INFO] demo-imperial-court-ms-show 1.0-SNAPSHOT â€¦â€¦â€¦.. SUCCESS [ 1.875 s]</p></blockquote><blockquote><p>[INFO] demo09-base-entity â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ SUCCESS [ 21.883 s]</p></blockquote><blockquote><p>[INFO] demo10-base-util â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦.. SUCCESS [ 0.324 s]</p></blockquote><blockquote><p>[INFO] demo08-base-api â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ SUCCESS [ 1.171 s]</p></blockquote><blockquote><p>[INFO] demo01-imperial-court-gateway â€¦â€¦â€¦â€¦â€¦â€¦â€¦. SUCCESS [ 0.403 s]</p></blockquote><blockquote><p>[INFO] demo02-user-auth-center â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦. SUCCESS [ 2.932 s]</p></blockquote><blockquote><p>[INFO] demo03-emp-manager-center â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦.. SUCCESS [ 0.312 s]</p></blockquote><blockquote><p>[INFO] demo04-memorials-manager-center â€¦â€¦â€¦â€¦â€¦â€¦.. SUCCESS [ 0.362 s]</p></blockquote><blockquote><p>[INFO] demo05-working-manager-center â€¦â€¦â€¦â€¦â€¦â€¦â€¦. SUCCESS [ 0.371 s]</p></blockquote><blockquote><p>[INFO] demo06-mysql-data-provider â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦. SUCCESS [ 6.779 s]</p></blockquote><blockquote><p>[INFO] demo07-redis-data-provider 1.0-SNAPSHOT â€¦â€¦â€¦â€¦ SUCCESS [ 0.273 s]</p></blockquote><p><img src="/image/img015.b413af9d.png" alt="images"></p><h3 id="7-å¼•ç”¨åˆ«äººéƒ¨ç½²çš„-jar-åŒ…"><a href="#7-å¼•ç”¨åˆ«äººéƒ¨ç½²çš„-jar-åŒ…" class="headerlink" title="7. å¼•ç”¨åˆ«äººéƒ¨ç½²çš„ jar åŒ…"></a>7. å¼•ç”¨åˆ«äººéƒ¨ç½²çš„ jar åŒ…</h3><p>mavenå·¥ç¨‹ä¸­é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>nexus-mine<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>nexus-mine<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://localhost:8081/repository/maven-snapshots/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">releases</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">releases</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h2 id="ä¹ã€Mavenç»¼åˆæ¡ˆä¾‹"><a href="#ä¹ã€Mavenç»¼åˆæ¡ˆä¾‹" class="headerlink" title="ä¹ã€Mavenç»¼åˆæ¡ˆä¾‹"></a>ä¹ã€Mavenç»¼åˆæ¡ˆä¾‹</h2><h3 id="1-é¡¹ç›®éœ€æ±‚å’Œç»“æ„åˆ†æ"><a href="#1-é¡¹ç›®éœ€æ±‚å’Œç»“æ„åˆ†æ" class="headerlink" title="1. é¡¹ç›®éœ€æ±‚å’Œç»“æ„åˆ†æ"></a>1. é¡¹ç›®éœ€æ±‚å’Œç»“æ„åˆ†æ</h3><p><img src="/image/image123.png" alt="img"></p><p>éœ€æ±‚æ¡ˆä¾‹ï¼šæ­å»ºä¸€ä¸ªç”µå•†å¹³å°é¡¹ç›®ï¼Œè¯¥å¹³å°åŒ…æ‹¬ç”¨æˆ·æœåŠ¡ã€è®¢å•æœåŠ¡ã€é€šç”¨å·¥å…·æ¨¡å—ç­‰ã€‚</p><p>é¡¹ç›®æ¶æ„ï¼š</p><ol><li>ç”¨æˆ·æœåŠ¡ï¼šè´Ÿè´£å¤„ç†ç”¨æˆ·ç›¸å…³çš„é€»è¾‘ï¼Œä¾‹å¦‚ç”¨æˆ·ä¿¡æ¯çš„ç®¡ç†ã€ç”¨æˆ·æ³¨å†Œã€ç™»å½•ç­‰ã€‚</li></ol><p>Â  Â - spring-context 6.0.6</p><p>Â  Â - spring-core 6.0.6</p><p>Â  Â - spring-beans 6.0.6</p><p>Â  Â - common-service</p><ol start="2"><li>è®¢å•æœåŠ¡ï¼šè´Ÿè´£å¤„ç†è®¢å•ç›¸å…³çš„é€»è¾‘ï¼Œä¾‹å¦‚è®¢å•çš„åˆ›å»ºã€è®¢å•æ”¯ä»˜ã€é€€è´§ã€è®¢å•æŸ¥çœ‹ç­‰ã€‚</li></ol><p>Â  Â - spring-context 6.0.6</p><p>Â  Â - spring-core 6.0.6</p><p>Â  Â - spring-beans 6.0.6</p><p>Â  Â - spring-security 6.0.6</p><p>Â  Â - common-service</p><ol start="3"><li>é€šç”¨æ¨¡å—ï¼šè´Ÿè´£å­˜å‚¨å…¶ä»–æœåŠ¡éœ€è¦é€šç”¨å·¥å…·ç±»ï¼Œå…¶ä»–æœåŠ¡ä¾èµ–æ­¤æ¨¡å—ã€‚</li></ol><p>Â  Â - commons-io 2.11.0</p><p>Â  Â - junit 5.9.2</p><h3 id="2-é¡¹ç›®æ­å»ºå’Œç»Ÿä¸€æ„å»º"><a href="#2-é¡¹ç›®æ­å»ºå’Œç»Ÿä¸€æ„å»º" class="headerlink" title="2. é¡¹ç›®æ­å»ºå’Œç»Ÿä¸€æ„å»º"></a>2. é¡¹ç›®æ­å»ºå’Œç»Ÿä¸€æ„å»º</h3><h4 id="â‘ çˆ¶æ¨¡å—-micro-shop"><a href="#â‘ çˆ¶æ¨¡å—-micro-shop" class="headerlink" title="â‘ çˆ¶æ¨¡å— (micro-shop)"></a>â‘ çˆ¶æ¨¡å— (micro-shop)</h4><p>åˆ›å»ºå·¥ç¨‹ï¼š</p><p><img src="/image/image-20231023112630117.png" alt="image-20231023112630117"></p><p>pom.xmlé…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">Â  Â  Â  Â  Â <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">Â  Â  Â  Â  Â <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>micro-shop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  <span class="hljs-comment">&lt;!--çŸ¥è¯†ç‚¹ï¼šçˆ¶å·¥ç¨‹çš„æ‰“åŒ…æ–¹å¼ä¸ºpom--&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">spring.version</span>&gt;</span>6.0.6<span class="hljs-tag">&lt;/<span class="hljs-name">spring.version</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">jackson.version</span>&gt;</span>2.15.0<span class="hljs-tag">&lt;/<span class="hljs-name">jackson.version</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">commons.version</span>&gt;</span>2.11.0<span class="hljs-tag">&lt;/<span class="hljs-name">commons.version</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">junit.version</span>&gt;</span>5.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">junit.version</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-comment">&lt;!-- ä¾èµ–ç®¡ç† --&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- spring-contextä¼šä¾èµ–ä¼ é€’core/beans --&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- jackson-databindä¼šä¾èµ–ä¼ é€’core/annotations --&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- commons-io --&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;commons.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-api --&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-jupiter-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-comment">&lt;!-- ç»Ÿä¸€æ›´æ–°å­å·¥ç¨‹æ‰“åŒ…æ’ä»¶--&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- jdk17 å’Œ waråŒ…ç‰ˆæœ¬æ’ä»¶ä¸åŒ¹é… --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-war-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br>  <br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>å¯é€‰æ“ä½œï¼šåˆ é™¤srcç›®å½•</p><h4 id="â‘¡é€šç”¨æ¨¡å—-common-service"><a href="#â‘¡é€šç”¨æ¨¡å—-common-service" class="headerlink" title="â‘¡é€šç”¨æ¨¡å— (common-service)"></a>â‘¡é€šç”¨æ¨¡å— (common-service)</h4><p>åˆ›å»ºå·¥ç¨‹ï¼š</p><p><img src="/image/image-20231023114531521.png" alt="image-20231023114531521"></p><p><img src="/image/image-20231023114649705.png" alt="image-20231023114649705"></p><p>pom.xmlé…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">Â  Â  Â  Â  Â <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">Â  Â  Â  Â  Â <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>micro-shop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>common-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  <span class="hljs-comment">&lt;!--çŸ¥è¯†ç‚¹ï¼šæ‰“åŒ…æ–¹å¼é»˜è®¤å°±æ˜¯jarï¼Œå› æ­¤å¯ä»¥çœç•¥--&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- é…ç½®spring-contextï¼Œç»§æ‰¿çˆ¶å·¥ç¨‹ç‰ˆæœ¬ï¼Œè‡ªåŠ¨ä¼ é€’ core / beans --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- é…ç½®jackson-databindï¼Œç»§æ‰¿çˆ¶å·¥ç¨‹ç‰ˆæœ¬ï¼Œè‡ªåŠ¨ä¼ é€’ core / annotations --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- é…ç½®commons-ioï¼Œç»§æ‰¿çˆ¶å·¥ç¨‹ç‰ˆæœ¬ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- é…ç½®junitï¼Œç»§æ‰¿çˆ¶å·¥ç¨‹ç‰ˆæœ¬ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-jupiter-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>  <br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h4 id="â‘¢ç”¨æˆ·æ¨¡å—-user-service"><a href="#â‘¢ç”¨æˆ·æ¨¡å—-user-service" class="headerlink" title="â‘¢ç”¨æˆ·æ¨¡å— (user-service)"></a>â‘¢ç”¨æˆ·æ¨¡å— (user-service)</h4><p>åˆ›å»ºå·¥ç¨‹ï¼š</p><p><img src="/image/image-20231023115404302.png" alt="image-20231023115404302"></p><p><img src="/image/image-20231023115707282.png" alt="image-20231023115707282"></p><p>pom.xmlé…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">Â  Â  Â  Â  Â <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">Â  Â  Â  Â  Â <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>micro-shop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>user-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  <span class="hljs-comment">&lt;!-- webå·¥ç¨‹æ‰“åŒ…æ–¹å¼ä¸ºwar --&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- é…ç½®common-serviceï¼Œæ‰€éœ€ä¾èµ–ä¼šä¼ é€’åˆ°å½“å‰å·¥ç¨‹ï¼ˆä»…é™compileèŒƒå›´ï¼‰ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>common-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>  <br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>ä¾èµ–ä¼ é€’ç»“æœï¼š</p><p><img src="/image/image-20231023120621402.png" alt="image-20231023120621402"></p><h4 id="â‘£è®¢å•æ¨¡å—-order-service"><a href="#â‘£è®¢å•æ¨¡å—-order-service" class="headerlink" title="â‘£è®¢å•æ¨¡å— (order-service)"></a>â‘£è®¢å•æ¨¡å— (order-service)</h4><p>åˆ›å»ºå·¥ç¨‹ï¼Œå¹¶ä½¿ç”¨æ’ä»¶è½¬ä¸ºwebå·¥ç¨‹ï¼š</p><p><img src="/image/image-20231023120733029.png" alt="image-20231023120733029"></p><p>pom.xmlé…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">Â  Â  Â  Â  Â <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">Â  Â  Â  Â  Â <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>micro-shop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>order-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  <span class="hljs-comment">&lt;!-- webå·¥ç¨‹æ‰“åŒ…æ–¹å¼ä¸ºwar --&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>  <br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-comment">&lt;!-- é…ç½®common-serviceï¼Œæ‰€éœ€ä¾èµ–ä¼šä¼ é€’åˆ°å½“å‰å·¥ç¨‹ï¼ˆä»…é™compileèŒƒå›´ï¼‰ --&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>common-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>Â  Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>  <br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼ŒæŸ¥çœ‹çˆ¶å·¥ç¨‹çš„pom.xmlï¼Œä¼šå‘ç°å…¶ä¸­å·²ç»è‡ªåŠ¨èšåˆäº†å­å·¥ç¨‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>common-service<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>user-service<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><br>Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>order-service<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>Mavenå¼•ç”¨ä¾èµ–é»˜è®¤ä¸ºjarï¼Œå¦‚æœå¼•å…¥pomç±»å‹çš„ä¾èµ–éœ€è¦æ˜¾ç¤ºæŒ‡å®š<type>pom<type></p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>maven</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>rabbitmq èŠ‚ç‚¹é‡æ–°åŠ å…¥é›†ç¾¤</title>
    <link href="/article/1b5d87d5.html"/>
    <url>/article/1b5d87d5.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li>èŠ‚ç‚¹æ¸…é™¤rabbitmqé…ç½®ï¼ˆè¸¢å‡ºçš„èŠ‚ç‚¹æ“ä½œï¼‰</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">åœæ­¢rabbitmq-serverçš„æœåŠ¡<br>systemctl stop rabbitmq-server<br>rm -rf <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/rabbitmq/</span>* <span class="hljs-regexp">/var/</span>log/*<br></code></pre></td></tr></table></figure><ul><li>æ‹·è´æ­£å¸¸èŠ‚ç‚¹ ï¼ˆä»æ­£å¸¸èŠ‚ç‚¹æ‹·è´åˆ°éœ€è¦è¸¢å‡ºçš„èŠ‚ç‚¹æ“ä½œï¼‰</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/rabbitmq/</span>.erlang.cookie æƒé™<span class="hljs-number">400</span><br>æƒé™ rabbitmq rabbitmq<br></code></pre></td></tr></table></figure><ul><li>åœ¨é›†ç¾¤æ­£å¸¸èŠ‚ç‚¹å°†æ•…éšœèŠ‚ç‚¹è¸¢å‡ºï¼ˆè¸¢å‡ºçš„èŠ‚ç‚¹æ“ä½œï¼‰</li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">åœ¨æ–°çš„rabbitmqé›†ç¾¤ä¸»èŠ‚ç‚¹è¸¢å‡º<span class="hljs-symbol">rabbit@</span>controller7325èŠ‚ç‚¹<br>rabbitmqctl  -n <span class="hljs-symbol">rabbit@</span>controller7326  forget_cluster_node <span class="hljs-symbol">rabbit@</span>controller7325<br></code></pre></td></tr></table></figure><ul><li>é‡æ–°åŠ å…¥åˆ°é›†ç¾¤å†…ï¼ˆè¸¢å‡ºçš„èŠ‚ç‚¹æ“ä½œï¼‰</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">systemctl  <span class="hljs-keyword">start</span> rabbitmq-<span class="hljs-keyword">server</span><br>rabbitmqctl stop_app<br>rabbitmqctl <span class="hljs-keyword">reset</span><br>rabbitmqctl join_cluster &quot;rabbit@controller7326&quot;<br>rabbitmqctl start_app<br></code></pre></td></tr></table></figure><ul><li>å®Œæˆåé‡æ–°æ£€æŸ¥rabbitmqé›†ç¾¤çŠ¶æ€</li></ul><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">rabbitmqctl cluster_status</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Rabbitmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>tonyenc phpè§£å¯†</title>
    <link href="/article/2c3e9697.html"/>
    <url>/article/2c3e9697.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /># è§£å¯†<p>æ‹¿åˆ°æ–‡ä»¶å¾ˆæ™•ï¼Œéƒ½æ˜¯ä¹±ç ï¼Œåº”è¯¥ä¸æ˜¯å¸¸è§„çš„æ··æ·†ï¼Œå¤§æ¦‚ç‡æ˜¯é€šè¿‡soæ¥è§£å¯†ï¼Œå…ˆæ‰¾åˆ°phpç›®å½•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@acmepbx:<span class="hljs-regexp">/opt/</span>bin]<span class="hljs-comment">#find / -name php.ini</span><br><span class="hljs-regexp">/opt/</span>php<span class="hljs-regexp">/etc/</span>php.ini<br></code></pre></td></tr></table></figure><p>Shell</p><p>æ‰¾åˆ°æ‰©å±•é…ç½®ç›®å½•  </p><p>tonyenc.iniè¿™ä¸ªæ–‡ä»¶å¾ˆå¯ç–‘<br>å†…å®¹ä¸º</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">extension</span><span class="hljs-operator">=</span>tonyenc.so<br></code></pre></td></tr></table></figure><p>Shell</p><p><a href="https://www.darkin.cn/usr/uploads/2023/04/163031832.png"></a><br>ç½‘ä¸Šæœäº†ä¸€ä¸‹è¿™ä¸ªsoçš„æ–‡ä»¶åï¼Œç›´æ¥æœåˆ°äº†åŠ å¯†é¡¹ç›®<br><a href="https://github.com/lihancong/tonyenc">https://github.com/lihancong/tonyenc</a><br><a href="https://www.darkin.cn/usr/uploads/2023/04/293100129.png"></a><br>è¿™ä¸ªå¯†é’¥å¾ˆå…³é”®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨idaè¿›è¡ŒæŸ¥æ‰¾<br><a href="https://www.darkin.cn/usr/uploads/2023/04/141066593.png"></a><br>åœ¨è§£å¯†ä¹‹å‰æˆ‘ä»¬éœ€è¦ç¡®è®¤githubè¿™ä¸ªé¡¹ç›®å’Œç›®æ ‡soçš„é€»è¾‘æ˜¯å¦ç›¸åŒï¼Œç›´æ¥æŠŠæ­£ç¡®çš„keyä¿®æ”¹ï¼Œæ ¹æ®æ–‡æ¡£åœ¨Linuxä¸‹ç¼–è¯‘æ›¿æ¢åŸæœ‰çš„soï¼Œæ‰“å¼€ç½‘é¡µæµ‹è¯•ä»£ç æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œæˆ–è€…å¯ä»¥è°ƒç”¨encæ–¹æ³•åŠ å¯†åŒä¸€ä¸ªæ–‡ä»¶æµ‹è¯•ã€‚<br>ç»è¿‡æµ‹è¯•ï¼Œæˆ‘ç¼–è¯‘çš„soå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œè¿™æ ·çš„è¯ç›´æ¥ç”¨githubçš„è§£å¯†æ–¹æ³•å§<br>è§£å¯†é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å•ç‹¬å†™ä¸ªç¨‹åºè§£å¯†<br><a href="https://www.darkin.cn/usr/uploads/2023/04/3039153348.png"></a><br><a href="https://www.darkin.cn/usr/uploads/2023/04/3764255853.png"></a><br>å®Œæ•´ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-type">char</span> tonyenc_header[] = &#123;<br>        <span class="hljs-number">0x16</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x6f</span>, <span class="hljs-number">0x4f</span>,<br>        <span class="hljs-number">0x68</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x36</span>,<br>        <span class="hljs-number">0x91</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x88</span>,<br>&#125;;<br><span class="hljs-type">char</span> tonyenc_key[] = &#123;<br>        <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x00</span>,<br>        <span class="hljs-number">0x58</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x6f</span>, <span class="hljs-number">0x93</span>,<br>        <span class="hljs-number">0x3e</span>, <span class="hljs-number">0x2e</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0xfa</span>,<br>        <span class="hljs-number">0xa6</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0xf3</span>, <span class="hljs-number">0xb6</span>,<br>&#125;;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">write_change_policy</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* filename, <span class="hljs-type">char</span>* buf_policy)</span></span><br><span class="hljs-function"></span>&#123;<br>    FILE* fp = <span class="hljs-literal">NULL</span>;<br>    fp = <span class="hljs-built_in">fopen</span>(filename, <span class="hljs-string">&quot;w+&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!fp) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">fwrite</span>(buf_policy, <span class="hljs-number">1</span>, <span class="hljs-built_in">strlen</span>(buf_policy), fp) &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>        <span class="hljs-built_in">fclose</span>(fp);<br>    &#125;<br>    <span class="hljs-built_in">fclose</span>(fp);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">tonyenc_decode</span><span class="hljs-params">(<span class="hljs-type">char</span>* data, <span class="hljs-type">size_t</span> len)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">size_t</span> i, p = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; ++i) &#123;<br>        <span class="hljs-keyword">if</span> (i &amp; <span class="hljs-number">1</span>) &#123;<br>            p += tonyenc_key[p] + i;<br>            p %= <span class="hljs-built_in">sizeof</span>(tonyenc_key);<br>            <span class="hljs-type">char</span> t = tonyenc_key[p];<br>            data[i] = ~data[i] ^ t;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">tonyenc_ext_fopen</span><span class="hljs-params">(FILE* fp, <span class="hljs-keyword">struct</span> stat* stat_buf,<span class="hljs-type">char</span>* outname)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span>* p_data;<br>    <span class="hljs-type">size_t</span> data_len;<br>    <span class="hljs-type">size_t</span> write_len;<br>    data_len = stat_buf-&gt;st_size - <span class="hljs-built_in">sizeof</span>(tonyenc_header);<br>    p_data = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(data_len);<br>    <span class="hljs-built_in">fseek</span>(fp, <span class="hljs-built_in">sizeof</span>(tonyenc_header), SEEK_SET);<br>    <span class="hljs-built_in">fread</span>(p_data, data_len, <span class="hljs-number">1</span>, fp);<br>    <span class="hljs-built_in">fclose</span>(fp);<br>    <span class="hljs-built_in">tonyenc_decode</span>(p_data, data_len);<br>    <span class="hljs-built_in">write_change_policy</span>(outname, p_data);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc,<span class="hljs-type">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">stat</span> stat_buf;<br>    <span class="hljs-type">int</span> data_len;<br>    <span class="hljs-type">char</span>* filename;<br>    FILE* fp;<br>    filename = argv[<span class="hljs-number">1</span>];<br>    <span class="hljs-comment">//printf(argv[1]);</span><br>    fp = <span class="hljs-built_in">fopen</span>(filename, <span class="hljs-string">&quot;rb&quot;</span>);<br>    <span class="hljs-built_in">fstat</span>(<span class="hljs-built_in">fileno</span>(fp), &amp;stat_buf);<br>    data_len = stat_buf.st_size;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;data_lenth:%d&quot;</span>, data_len);<br>    <span class="hljs-built_in">tonyenc_ext_fopen</span>(fp, &amp;stat_buf, <span class="hljs-built_in">strcat</span>(filename , <span class="hljs-string">&quot;.dec&quot;</span>));<br><br>&#125;<br></code></pre></td></tr></table></figure><p>C</p><p>æˆåŠŸè§£å¯†:<br><a href="https://www.darkin.cn/usr/uploads/2023/04/1202843109.png"></a><br>å†™äº†ä¸ªpythonæ‰¹é‡è°ƒç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> codecs<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> frida<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">findfile</span>(<span class="hljs-params">target_dir, target_suffix=<span class="hljs-string">&quot;php&quot;</span></span>):<br>    find_res = []<br>    target_suffix_dot = <span class="hljs-string">&quot;.&quot;</span> + target_suffix<br>    walk_generator = os.walk(target_dir)<br>    <span class="hljs-keyword">for</span> root_path, dirs, files <span class="hljs-keyword">in</span> walk_generator:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(files) &lt; <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:<br>            file_name, suffix_name = os.path.splitext(file)<br>            <span class="hljs-keyword">if</span> target_suffix==<span class="hljs-string">&quot;all&quot;</span>:<br>                find_res.append(os.path.join(root_path, file))<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">if</span> suffix_name == target_suffix_dot:<br>                    find_res.append(os.path.join(root_path, file))<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(find_res))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_hex</span>(<span class="hljs-params">filename</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        file_hex = f.read().<span class="hljs-built_in">hex</span>()<br>    f.close()<br>    <span class="hljs-keyword">return</span> file_hex<br><br>rlist=[]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getfile</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> findfile(<span class="hljs-string">r&quot;J:\phpstudy_pro\WWW&quot;</span>):<br>        <span class="hljs-keyword">if</span> read_hex(i)[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>]==<span class="hljs-string">&quot;16886f&quot;</span>:<br>            rlist.append(i)<br>getfile()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rlist:<br>    <span class="hljs-built_in">print</span>(i)<br>    os.system(<span class="hljs-string">&quot;dec.exe %s&quot;</span>%i)<br></code></pre></td></tr></table></figure><p>Python</p><p>å…¨è§£å¼€åç ´è§£æˆæƒéªŒè¯å°±å¾ˆç®€å•äº†<br><a href="https://www.darkin.cn/usr/uploads/2023/04/712484247.png"></a></p><h1 id="é‡æ–°åŠ å¯†"><a href="#é‡æ–°åŠ å¯†" class="headerlink" title="é‡æ–°åŠ å¯†"></a>é‡æ–°åŠ å¯†</h1><p><a href="https://windows.php.net/downloads/releases/archives/">https://windows.php.net/downloads/releases/archives/</a><br><a href="https://www.darkin.cn/usr/uploads/2023/04/1180440772.png"></a></p><blockquote><p>è½¬è½½<a href="https://www.leolei.cn/archives/20.html">https://www.leolei.cn/archives/20.html</a></p></blockquote><p>è¯´æ˜ï¼š7.2ä½¿ç”¨VC15ç¼–è¯‘ï¼Œæœ¬æ–‡ä»¥PHP7.0.26ä¸¾ä¾‹ ä½¿ç”¨Visual Studio 2017</p><p>éœ€è¦ä» å®˜ç½‘ ä¸‹è½½ PHP7.0.26 çš„æºä»£ç åŒ…å’Œå·²ç¼–è¯‘çš„ PHP ç¨‹åºï¼Œå†åˆ†åˆ«è§£å‹ï¼Œå¾—åˆ°ä¸¤ä¸ªç›®å½•(å‡è®¾åœ¨ C ç›˜)ï¼š</p><p>C:\php-7.0.26-src</p><p>C:\php-7.0.26-nts-Win32-VC14-x64</p><p>å¦‚ä½•ç¼–è¯‘</p><p>1ï¼‰æ‹¿åˆ°è¦ç¼–è¯‘çš„ä»£ç ï¼Œåœ¨ VS 2017 èœå•ä¸­é€‰æ‹©ã€Œæ–‡ä»¶ã€-ã€Œæ–°å»ºã€-ã€Œä»ç°æœ‰ä»£ç åˆ›å»ºé¡¹ç›®ã€ï¼Œç„¶ååœ¨å¼¹å‡ºçª—å£ä¸­é€‰æ‹©ä½ è¦ç¼–è¯‘çš„ä»£ç ï¼Œç±»å‹é€‰æ‹©ã€ŒåŠ¨æ€åº“(dll)ã€ã€‚</p><p>2ï¼‰æ­¤æ—¶ VS 2017 æ‰“å¼€äº†é¡¹ç›®ï¼ŒæŠŠå·¥å…·æ ä¸­çš„ã€ŒDebugã€æ”¹ä¸ºã€ŒReleaseã€ï¼Œã€Œx86ã€æ”¹ä¸ºã€Œx64ã€ï¼Œåœ¨èœå•ä¸­é€‰æ‹©ã€Œé¡¹ç›®ã€-ã€Œå±æ€§ã€ã€‚ç„¶ååœ¨å¼¹å‡ºçª—å£çš„å·¦ä¾§ã€Œå¸¸è§„ã€æ ç›®ä¸‹ï¼Œã€Œé…ç½®ç±»å‹ã€é€‰æ‹©ä¸ºã€ŒåŠ¨æ€åº“(.dll)ã€ï¼š</p><p>3ï¼‰ç„¶ååœ¨å·¦ä¾§ã€ŒC&#x2F;C++ã€-ã€Œå¸¸è§„ã€æ ç›®ä¸‹ï¼Œã€Œé™„åŠ åŒ…å«ç›®å½•ã€ä¸­ï¼ŒåŠ å…¥ï¼š</p><p>C:\php-7.0.26-src<br>C:\php-7.0.26-src\main<br>C:\php-7.0.26-src\TSRM<br>C:\php-7.0.26-src\Zend</p><p>4ï¼‰æ¥ç€åœ¨å·¦ä¾§ã€ŒC&#x2F;C++ã€-ã€Œé¢„å¤„ç†å™¨ã€æ ç›®ä¸‹ï¼Œã€Œé¢„å¤„ç†å™¨å®šä¹‰ã€ä¸­ï¼ŒåŠ å…¥ï¼š</p><p>ZEND_DEBUG&#x3D;0<br>PHP_EXTENSION<br>PHP_WIN32<br>ZEND_WIN32<br>HAVE_XXX&#x3D;1<br>COMPILE_DL_XXX<br>ZTS</p><p>æ³¨æ„ï¼Œè¦æŠŠä¸Šé¢çš„ XXX æ”¹ä¸ºå¤§å†™çš„æ‰©å±•å (å¦‚æ‰©å±•å« tonyenc å°±æŠŠ XXX æ”¹æˆ TONYENC)ï¼Œå¦åˆ™ PHP å°†æ— æ³•è¯†åˆ«æ‰©å±•ã€‚ZTSç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨å¼€å¯çº¿ç¨‹å®‰å…¨ï¼ˆå¦‚æœå»æ‰å°±æ˜¯ä¸å¼€å¯ï¼‰ã€‚æ³¨æ„ï¼Œçº¿ç¨‹å®‰å…¨çš„å¼€å¯ä¸å¦ï¼Œå–å†³äºå‰é¢ä¸‹è½½åˆ°çš„ C:\php-7.0.26-nts-Win32-VC14-x64ï¼Œå®ƒå¦‚æœå¯ç”¨äº†çº¿ç¨‹å®‰å…¨ç¼–è¯‘ï¼Œè¿™é‡Œå°±å¼€å¯çº¿ç¨‹å®‰å…¨ã€‚</p><p>5ï¼‰åœ¨å·¦ä¾§ã€Œé“¾æ¥å™¨ã€-ã€Œè¾“å…¥ã€æ ç›®ä¸‹ï¼Œã€Œé™„åŠ ä¾èµ–é¡¹ã€ä¸­ï¼ŒåŠ å…¥ï¼šC:\php-7.0.26-nts-Win32-VC14-x64\dev\php7.libï¼Œå³å‰é¢ä¸‹è½½å¾—åˆ°çš„å·²ç¼–è¯‘çš„ PHP ç¨‹åºã€‚</p><p>6ï¼‰ç‚¹ç¡®å®šï¼Œç„¶åèœå•ä¸­é€‰æ‹©ã€Œç”Ÿæˆã€-ã€Œç”Ÿæˆè§£å†³æ–¹æ¡ˆã€ï¼Œæ­å–œä½ ï¼Œç¼–è¯‘å™¨æŠ¥é”™ï¼šæ— æ³•æ‰“å¼€åŒ…æ‹¬æ–‡ä»¶ ..&#x2F;main&#x2F;config.w32.hï¼Œè¿™æ—¶æŠŠ C:\php-7.0.26-src\win32\build\config.w32.h.in å¤åˆ¶åˆ° C:\php-7.0.26-src\main\config.w32.h (æ³¨æ„æ²¡æœ‰äº†åé¢çš„ in)ï¼Œç„¶ååœ¨ config.w32.h ä¸­åŠ å…¥ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> PHP_COMPILER_ID <span class="hljs-string">&quot;VC14&quot;</span></span><br></code></pre></td></tr></table></figure><p>Dos</p><p>è¿™å°†æŒ‡æ˜è¿è¡Œåº“æ˜¯ VC14ï¼Œä¸å‰é¢ä¸‹è½½åˆ°çš„å·²ç¼–è¯‘ PHP ç¨‹åºåŒ¹é…ï¼Œé‡æ–°ç”Ÿæˆä¸‹è§£å†³æ–¹æ¡ˆï¼Œè¿™æ ·å°±èƒ½æˆåŠŸç¼–è¯‘äº†ï¼</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JAVA è¿›è¡ŒAESåŠ å¯†</title>
    <link href="/article/a4d9967a.html"/>
    <url>/article/a4d9967a.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br></pre></td><td class="code"><pre><code class="hljs r">`private` `static` `final` `String SYMBOLS =` `&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;``;` `// æ•°å­—å’Œ26ä¸ªå­—æ¯ç»„æˆ`<br><br>`private` `static` `final` `Random RANDOM =` `new` `SecureRandom();`<br><br>`/**`<br><br>Â `* è·å–é•¿åº¦ä¸º 6 çš„éšæœºå­—æ¯+æ•°å­—`<br><br>Â `* @return éšæœºæ•°å­—`<br><br>Â `*/`<br><br>`public` `static` `String getRandomNumber() &#123;`<br><br>Â Â Â Â `char``[] nonceChars =` `new` `char``[``<span class="hljs-number">16</span>``<span class="hljs-punctuation">]</span>;`Â  `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŒ‡å®šé•¿åº¦ä¸º<span class="hljs-number">6</span>ä½<span class="hljs-operator">/</span>è‡ªå·±å¯ä»¥è¦æ±‚è®¾ç½®`<br><br>Â Â Â Â `<span class="hljs-keyword">for</span>` `<span class="hljs-punctuation">(</span>``int` `index <span class="hljs-operator">=</span>` `0``; index <span class="hljs-operator">&lt;</span> nonceChars.length; <span class="hljs-operator">+</span><span class="hljs-operator">+</span>index<span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â `nonceChars<span class="hljs-punctuation">[</span>index<span class="hljs-punctuation">]</span> <span class="hljs-operator">=</span> SYMBOLS.charAt<span class="hljs-punctuation">(</span>RANDOM.nextInt<span class="hljs-punctuation">(</span>SYMBOLS.length<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â `<span class="hljs-built_in">return</span>` `new` `String<span class="hljs-punctuation">(</span>nonceChars<span class="hljs-punctuation">)</span>;`<br><br>`<span class="hljs-punctuation">&#125;</span>`<br><br>`import` `org.apache.commons.lang3.RandomStringUtils;`<br><br>`import` `org.apache.commons.lang3.StringUtils;`<br><br>`import` `org.slf4j.Logger;`<br><br>`import` `org.slf4j.LoggerFactory;`<br><br>`import` `org.springframework.util.Base64Utils;`<br><br>`import` `javax.crypto.Cipher;`<br><br>`import` `javax.crypto.spec.IvParameterSpec;`<br><br>`import` `javax.crypto.spec.SecretKeySpec;`<br><br>`<span class="hljs-operator">/</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>`<br><br>Â `<span class="hljs-operator">*</span> AESåŠ å¯†å·¥å…·ç±»`<br><br>Â `<span class="hljs-operator">*</span>`<br><br>Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span>author ACGkaka`<br><br>Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span>since <span class="hljs-number">2021</span><span class="hljs-operator">-</span><span class="hljs-number">06</span><span class="hljs-operator">-</span><span class="hljs-number">18</span> <span class="hljs-number">19</span><span class="hljs-operator">:</span><span class="hljs-number">11</span><span class="hljs-operator">:</span><span class="hljs-number">03</span>`<br><br>Â `<span class="hljs-operator">*</span><span class="hljs-operator">/</span>`<br><br>`public` `<span class="hljs-built_in">class</span>` `AESUtil <span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> æ—¥å¿—ç›¸å…³`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span><span class="hljs-operator">/</span>`<br><br>Â Â Â Â `private` `static` `final` `Logger LOGGER <span class="hljs-operator">=</span> LoggerFactory.getLogger<span class="hljs-punctuation">(</span>AESUtil.``<span class="hljs-built_in">class</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> ç¼–ç `<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span><span class="hljs-operator">/</span>`<br><br>Â Â Â Â `private` `static` `final` `String ENCODING <span class="hljs-operator">=</span>` `<span class="hljs-string">&quot;UTF-8&quot;</span>``;`<br><br>Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> ç®—æ³•å®šä¹‰`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span><span class="hljs-operator">/</span>`<br><br>Â Â Â Â `private` `static` `final` `String AES_ALGORITHM <span class="hljs-operator">=</span>` `<span class="hljs-string">&quot;AES&quot;</span>``;`<br><br>Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> æŒ‡å®šå¡«å……æ–¹å¼`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span><span class="hljs-operator">/</span>`<br><br>Â Â Â Â `private` `static` `final` `String CIPHER_PADDING <span class="hljs-operator">=</span>` `<span class="hljs-string">&quot;AES/ECB/PKCS5Padding&quot;</span>``;`<br><br>Â Â Â Â `private` `static` `final` `String CIPHER_CBC_PADDING <span class="hljs-operator">=</span>` `<span class="hljs-string">&quot;AES/CBC/PKCS5Padding&quot;</span>``;`<br><br>Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> åç§»é‡<span class="hljs-punctuation">(</span>CBCä¸­ä½¿ç”¨ï¼Œå¢å¼ºåŠ å¯†ç®—æ³•å¼ºåº¦<span class="hljs-punctuation">)</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span><span class="hljs-operator">/</span>`<br><br>Â Â Â Â `private` `static` `final` `String IV_SEED <span class="hljs-operator">=</span>` `<span class="hljs-string">&quot;1234567812345678&quot;</span>``;`<br><br>Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> AESåŠ å¯†`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span>param content å¾…åŠ å¯†å†…å®¹`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span>param aesKeyÂ  å¯†ç `<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span><span class="hljs-built_in">return</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span><span class="hljs-operator">/</span>`<br><br>Â Â Â Â `public` `static` `String encrypt<span class="hljs-punctuation">(</span>String content<span class="hljs-punctuation">,</span> String aesKey<span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-keyword">if</span>``<span class="hljs-punctuation">(</span>StringUtils.isBlank<span class="hljs-punctuation">(</span>content<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES encrypt: the content is null!&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `null``;`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ¤æ–­ç§˜é’¥æ˜¯å¦ä¸º<span class="hljs-number">16</span>ä½`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-keyword">if</span>``<span class="hljs-punctuation">(</span>StringUtils.isNotBlank<span class="hljs-punctuation">(</span>aesKey<span class="hljs-punctuation">)</span> <span class="hljs-operator">&amp;&amp;</span> aesKey.length<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">==</span>` `16``<span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `try` `<span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>å¯¹å¯†ç è¿›è¡Œç¼–ç `<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `byte``<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> bytes <span class="hljs-operator">=</span> aesKey.getBytes<span class="hljs-punctuation">(</span>ENCODING<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>è®¾ç½®åŠ å¯†ç®—æ³•ï¼Œç”Ÿæˆç§˜é’¥`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `SecretKeySpec skeySpec <span class="hljs-operator">=</span>` `new` `SecretKeySpec<span class="hljs-punctuation">(</span>bytes<span class="hljs-punctuation">,</span> AES_ALGORITHM<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-string">&quot;ç®—æ³•/æ¨¡å¼/è¡¥ç æ–¹å¼&quot;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `Cipher cipher <span class="hljs-operator">=</span> Cipher.getInstance<span class="hljs-punctuation">(</span>CIPHER_PADDING<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>é€‰æ‹©åŠ å¯†`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `cipher.init<span class="hljs-punctuation">(</span>Cipher.ENCRYPT_MODE<span class="hljs-punctuation">,</span> skeySpec<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ ¹æ®å¾…åŠ å¯†å†…å®¹ç”Ÿæˆå­—èŠ‚æ•°ç»„`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `byte``<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> encrypted <span class="hljs-operator">=</span> cipher.doFinal<span class="hljs-punctuation">(</span>content.getBytes<span class="hljs-punctuation">(</span>ENCODING<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>è¿”å›base64å­—ç¬¦ä¸²`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `Base64Utils.encodeToString<span class="hljs-punctuation">(</span>encrypted<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>` `catch` `<span class="hljs-punctuation">(</span>Exception e<span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES encrypt exception:&quot;</span>` `<span class="hljs-operator">+</span> e.getMessage<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `throw` `new` `RuntimeException<span class="hljs-punctuation">(</span>e<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>``<span class="hljs-keyword">else</span>` `<span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES encrypt: the aesKey is null or error!&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `null``;`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> è§£å¯†`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span>param content å¾…è§£å¯†å†…å®¹`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span>param aesKeyÂ  å¯†ç `<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span><span class="hljs-built_in">return</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span><span class="hljs-operator">/</span>`<br><br>Â Â Â Â `public` `static` `String decrypt<span class="hljs-punctuation">(</span>String content<span class="hljs-punctuation">,</span> String aesKey<span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-keyword">if</span>``<span class="hljs-punctuation">(</span>StringUtils.isBlank<span class="hljs-punctuation">(</span>content<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES decrypt: the content is null!&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `null``;`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ¤æ–­ç§˜é’¥æ˜¯å¦ä¸º<span class="hljs-number">16</span>ä½`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-keyword">if</span>``<span class="hljs-punctuation">(</span>StringUtils.isNotBlank<span class="hljs-punctuation">(</span>aesKey<span class="hljs-punctuation">)</span> <span class="hljs-operator">&amp;&amp;</span> aesKey.length<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">==</span>` `16``<span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `try` `<span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>å¯¹å¯†ç è¿›è¡Œç¼–ç `<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `byte``<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> bytes <span class="hljs-operator">=</span> aesKey.getBytes<span class="hljs-punctuation">(</span>ENCODING<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>è®¾ç½®è§£å¯†ç®—æ³•ï¼Œç”Ÿæˆç§˜é’¥`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `SecretKeySpec skeySpec <span class="hljs-operator">=</span>` `new` `SecretKeySpec<span class="hljs-punctuation">(</span>bytes<span class="hljs-punctuation">,</span> AES_ALGORITHM<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-string">&quot;ç®—æ³•/æ¨¡å¼/è¡¥ç æ–¹å¼&quot;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `Cipher cipher <span class="hljs-operator">=</span> Cipher.getInstance<span class="hljs-punctuation">(</span>CIPHER_PADDING<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>é€‰æ‹©è§£å¯†`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `cipher.init<span class="hljs-punctuation">(</span>Cipher.DECRYPT_MODE<span class="hljs-punctuation">,</span> skeySpec<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>å…ˆè¿›è¡ŒBase64è§£ç `<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `byte``<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> decodeBase64 <span class="hljs-operator">=</span> Base64Utils.decodeFromString<span class="hljs-punctuation">(</span>content<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ ¹æ®å¾…è§£å¯†å†…å®¹è¿›è¡Œè§£å¯†`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `byte``<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> decrypted <span class="hljs-operator">=</span> cipher.doFinal<span class="hljs-punctuation">(</span>decodeBase64<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>å°†å­—èŠ‚æ•°ç»„è½¬æˆå­—ç¬¦ä¸²`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `new` `String<span class="hljs-punctuation">(</span>decrypted<span class="hljs-punctuation">,</span> ENCODING<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>` `catch` `<span class="hljs-punctuation">(</span>Exception e<span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES decrypt exception:&quot;</span>` `<span class="hljs-operator">+</span> e.getMessage<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `throw` `new` `RuntimeException<span class="hljs-punctuation">(</span>e<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>``<span class="hljs-keyword">else</span>` `<span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES decrypt: the aesKey is null or error!&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `null``;`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> AES_CBCåŠ å¯†`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span>param content å¾…åŠ å¯†å†…å®¹`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span>param aesKeyÂ  å¯†ç `<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span><span class="hljs-built_in">return</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span><span class="hljs-operator">/</span>`<br><br>Â Â Â Â `public` `static` `String encryptCBC<span class="hljs-punctuation">(</span>String content<span class="hljs-punctuation">,</span> String aesKey<span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-keyword">if</span>``<span class="hljs-punctuation">(</span>StringUtils.isBlank<span class="hljs-punctuation">(</span>content<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES_CBC encrypt: the content is null!&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `null``;`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ¤æ–­ç§˜é’¥æ˜¯å¦ä¸º<span class="hljs-number">16</span>ä½`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-keyword">if</span>``<span class="hljs-punctuation">(</span>StringUtils.isNotBlank<span class="hljs-punctuation">(</span>aesKey<span class="hljs-punctuation">)</span> <span class="hljs-operator">&amp;&amp;</span> aesKey.length<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">==</span>` `16``<span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `try` `<span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>å¯¹å¯†ç è¿›è¡Œç¼–ç `<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `byte``<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> bytes <span class="hljs-operator">=</span> aesKey.getBytes<span class="hljs-punctuation">(</span>ENCODING<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>è®¾ç½®åŠ å¯†ç®—æ³•ï¼Œç”Ÿæˆç§˜é’¥`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `SecretKeySpec skeySpec <span class="hljs-operator">=</span>` `new` `SecretKeySpec<span class="hljs-punctuation">(</span>bytes<span class="hljs-punctuation">,</span> AES_ALGORITHM<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-string">&quot;ç®—æ³•/æ¨¡å¼/è¡¥ç æ–¹å¼&quot;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `Cipher cipher <span class="hljs-operator">=</span> Cipher.getInstance<span class="hljs-punctuation">(</span>CIPHER_CBC_PADDING<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>åç§»`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `IvParameterSpec iv <span class="hljs-operator">=</span>` `new` `IvParameterSpec<span class="hljs-punctuation">(</span>IV_SEED.getBytes<span class="hljs-punctuation">(</span>ENCODING<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>é€‰æ‹©åŠ å¯†`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `cipher.init<span class="hljs-punctuation">(</span>Cipher.ENCRYPT_MODE<span class="hljs-punctuation">,</span> skeySpec<span class="hljs-punctuation">,</span> iv<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ ¹æ®å¾…åŠ å¯†å†…å®¹ç”Ÿæˆå­—èŠ‚æ•°ç»„`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `byte``<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> encrypted <span class="hljs-operator">=</span> cipher.doFinal<span class="hljs-punctuation">(</span>content.getBytes<span class="hljs-punctuation">(</span>ENCODING<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>è¿”å›base64å­—ç¬¦ä¸²`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `Base64Utils.encodeToString<span class="hljs-punctuation">(</span>encrypted<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>` `catch` `<span class="hljs-punctuation">(</span>Exception e<span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES_CBC encrypt exception:&quot;</span>` `<span class="hljs-operator">+</span> e.getMessage<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `throw` `new` `RuntimeException<span class="hljs-punctuation">(</span>e<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>``<span class="hljs-keyword">else</span>` `<span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES_CBC encrypt: the aesKey is null or error!&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `null``;`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> AES_CBCè§£å¯†`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span>param content å¾…è§£å¯†å†…å®¹`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span>param aesKeyÂ  å¯†ç `<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span> <span class="hljs-operator">@</span><span class="hljs-built_in">return</span>`<br><br>Â Â Â Â Â `<span class="hljs-operator">*</span><span class="hljs-operator">/</span>`<br><br>Â Â Â Â `public` `static` `String decryptCBC<span class="hljs-punctuation">(</span>String content<span class="hljs-punctuation">,</span> String aesKey<span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-keyword">if</span>``<span class="hljs-punctuation">(</span>StringUtils.isBlank<span class="hljs-punctuation">(</span>content<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES_CBC decrypt: the content is null!&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `null``;`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ¤æ–­ç§˜é’¥æ˜¯å¦ä¸º<span class="hljs-number">16</span>ä½`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-keyword">if</span>``<span class="hljs-punctuation">(</span>StringUtils.isNotBlank<span class="hljs-punctuation">(</span>aesKey<span class="hljs-punctuation">)</span> <span class="hljs-operator">&amp;&amp;</span> aesKey.length<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">==</span>` `16``<span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `try` `<span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>å¯¹å¯†ç è¿›è¡Œç¼–ç `<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `byte``<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> bytes <span class="hljs-operator">=</span> aesKey.getBytes<span class="hljs-punctuation">(</span>ENCODING<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>è®¾ç½®è§£å¯†ç®—æ³•ï¼Œç”Ÿæˆç§˜é’¥`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `SecretKeySpec skeySpec <span class="hljs-operator">=</span>` `new` `SecretKeySpec<span class="hljs-punctuation">(</span>bytes<span class="hljs-punctuation">,</span> AES_ALGORITHM<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>åç§»`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `IvParameterSpec iv <span class="hljs-operator">=</span>` `new` `IvParameterSpec<span class="hljs-punctuation">(</span>IV_SEED.getBytes<span class="hljs-punctuation">(</span>ENCODING<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-string">&quot;ç®—æ³•/æ¨¡å¼/è¡¥ç æ–¹å¼&quot;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `Cipher cipher <span class="hljs-operator">=</span> Cipher.getInstance<span class="hljs-punctuation">(</span>CIPHER_CBC_PADDING<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>é€‰æ‹©è§£å¯†`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `cipher.init<span class="hljs-punctuation">(</span>Cipher.DECRYPT_MODE<span class="hljs-punctuation">,</span> skeySpec<span class="hljs-punctuation">,</span> iv<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>å…ˆè¿›è¡ŒBase64è§£ç `<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `byte``<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> decodeBase64 <span class="hljs-operator">=</span> Base64Utils.decodeFromString<span class="hljs-punctuation">(</span>content<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ ¹æ®å¾…è§£å¯†å†…å®¹è¿›è¡Œè§£å¯†`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `byte``<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> decrypted <span class="hljs-operator">=</span> cipher.doFinal<span class="hljs-punctuation">(</span>decodeBase64<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span>å°†å­—èŠ‚æ•°ç»„è½¬æˆå­—ç¬¦ä¸²`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `new` `String<span class="hljs-punctuation">(</span>decrypted<span class="hljs-punctuation">,</span> ENCODING<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>` `catch` `<span class="hljs-punctuation">(</span>Exception e<span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES_CBC decrypt exception:&quot;</span>` `<span class="hljs-operator">+</span> e.getMessage<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `throw` `new` `RuntimeException<span class="hljs-punctuation">(</span>e<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>``<span class="hljs-keyword">else</span>` `<span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `LOGGER.info<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;AES_CBC decrypt: the aesKey is null or error!&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â Â Â Â Â `<span class="hljs-built_in">return</span>` `null``;`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>Â Â Â Â `public` `static` `void` `main<span class="hljs-punctuation">(</span>String<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> args<span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span>`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span> AESæ”¯æŒä¸‰ç§é•¿åº¦çš„å¯†é’¥ï¼š<span class="hljs-number">128</span>ä½ã€<span class="hljs-number">192</span>ä½ã€<span class="hljs-number">256</span>ä½ã€‚`<br><br>Â Â Â Â Â Â Â Â `<span class="hljs-operator">/</span><span class="hljs-operator">/</span> ä»£ç ä¸­è¿™ç§å°±æ˜¯<span class="hljs-number">128</span>ä½çš„åŠ å¯†å¯†é’¥ï¼Œ<span class="hljs-number">16</span>å­—èŠ‚ <span class="hljs-operator">*</span> <span class="hljs-number">8</span>ä½<span class="hljs-operator">/</span>å­—èŠ‚ <span class="hljs-operator">=</span> <span class="hljs-number">128</span>ä½ã€‚`<br><br>Â Â Â Â Â Â Â Â `String random <span class="hljs-operator">=</span> RandomStringUtils.random<span class="hljs-punctuation">(</span>``16``<span class="hljs-punctuation">,</span>` `<span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz1234567890&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;éšæœºkey:&quot;</span>` `<span class="hljs-operator">+</span> random<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;---------åŠ å¯†---------&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `String aesResult <span class="hljs-operator">=</span> encrypt<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;æµ‹è¯•AESåŠ å¯†12&quot;</span>``<span class="hljs-punctuation">,</span> random<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;aesåŠ å¯†ç»“æœ:&quot;</span>` `<span class="hljs-operator">+</span> aesResult<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;---------è§£å¯†---------&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `String decrypt <span class="hljs-operator">=</span> decrypt<span class="hljs-punctuation">(</span>aesResult<span class="hljs-punctuation">,</span> random<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;aesè§£å¯†ç»“æœ:&quot;</span>` `<span class="hljs-operator">+</span> decrypt<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;--------AES_CBCåŠ å¯†è§£å¯†---------&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `String cbcResult <span class="hljs-operator">=</span> encryptCBC<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;æµ‹è¯•AESåŠ å¯†12456&quot;</span>``<span class="hljs-punctuation">,</span> random<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;aes_cbcåŠ å¯†ç»“æœ:&quot;</span>` `<span class="hljs-operator">+</span> cbcResult<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;---------è§£å¯†CBC---------&quot;</span>``<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `String cbcDecrypt <span class="hljs-operator">=</span> decryptCBC<span class="hljs-punctuation">(</span>cbcResult<span class="hljs-punctuation">,</span> random<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span>``<span class="hljs-string">&quot;aesè§£å¯†ç»“æœ:&quot;</span>` `<span class="hljs-operator">+</span> cbcDecrypt<span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â Â Â Â Â `System.out.println<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span>;`<br><br>Â Â Â Â `<span class="hljs-punctuation">&#125;</span>`<br><br>`<span class="hljs-punctuation">&#125;</span>`<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVA</tag>
      
      <tag>AES</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java å®ç°b2a_hexï¼Œa2b_hex</title>
    <link href="/article/d9c680b0.html"/>
    <url>/article/d9c680b0.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-number">1.</span> <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">byte</span>[] <span class="hljs-built_in">hexStringToByteArray</span>(<span class="hljs-type">String</span> s) &#123;<br>    <br><span class="hljs-number">2.</span> Â  Â  Â  Â  <span class="hljs-type">int</span> len = s.<span class="hljs-built_in">length</span>();<br>    <br><span class="hljs-number">3.</span> Â  Â  Â  Â  <span class="hljs-type">byte</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-type">byte</span>[len / <span class="hljs-number">2</span>];<br>    <br><span class="hljs-number">4.</span> Â  Â  Â  Â  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; len; i += <span class="hljs-number">2</span>) &#123;<br>    <br><span class="hljs-number">5.</span> Â  Â  Â  Â  Â  Â  data[i / <span class="hljs-number">2</span>] = (<span class="hljs-type">byte</span>) ((Character.<span class="hljs-built_in">digit</span>(s.<span class="hljs-built_in">charAt</span>(i), <span class="hljs-number">16</span>) &lt;&lt; <span class="hljs-number">4</span>)<br>    <br><span class="hljs-number">6.</span> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â + Character.<span class="hljs-built_in">digit</span>(s.<span class="hljs-built_in">charAt</span>(i+<span class="hljs-number">1</span>), <span class="hljs-number">16</span>));<br>    <br><span class="hljs-number">7.</span> Â  Â  Â  Â  &#125;<br>    <br><span class="hljs-number">8.</span> Â  Â  Â  Â  <span class="hljs-keyword">return</span> data;<br>    <br><span class="hljs-number">9.</span> Â  Â  &#125;<br>    <br><span class="hljs-number">10.</span> Â  Â  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-type">String</span> <span class="hljs-title">byteToHexString</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] bytes)</span> </span>&#123;<br>    <br><span class="hljs-number">11.</span> Â  Â  Â  Â  StringBuffer sb = <span class="hljs-keyword">new</span> <span class="hljs-built_in">StringBuffer</span>(bytes.length);<br>    <br><span class="hljs-number">12.</span> Â  Â  Â  Â  <span class="hljs-type">String</span> sTemp;<br>    <br><span class="hljs-number">13.</span> Â  Â  Â  Â  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; bytes.length; i++) &#123;<br>    <br><span class="hljs-number">14.</span> Â  Â  Â  Â  Â  Â  sTemp = Integer.<span class="hljs-built_in">toHexString</span>(<span class="hljs-number">0xFF</span> &amp; bytes[i]);<br>    <br><span class="hljs-number">15.</span> Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">if</span> (sTemp.<span class="hljs-built_in">length</span>() &lt; <span class="hljs-number">2</span>)<br>    <br><span class="hljs-number">16.</span> Â  Â  Â  Â  Â  Â  Â  Â  sb.<span class="hljs-built_in">append</span>(<span class="hljs-number">0</span>);<br>    <br><span class="hljs-number">17.</span> Â  Â  Â  Â  Â  Â  sb.<span class="hljs-built_in">append</span>(sTemp);<br>    <br><span class="hljs-number">18.</span> Â  Â  Â  Â  &#125;<br>    <br><span class="hljs-number">19.</span> Â  Â  Â  Â  <span class="hljs-keyword">return</span> sb.<span class="hljs-built_in">toString</span>();<br>    <br><span class="hljs-number">20.</span> Â  Â  &#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>rediså‘½ä»¤</title>
    <link href="/article/d43a4e4c.html"/>
    <url>/article/d43a4e4c.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><ol><li>ä½¿ç”¨redis-cli -c å‚æ•°ä»ä»»æ„èŠ‚ç‚¹ç™»å½•çš„ï¼Œä¸ç®¡æ•°æ®å†å“ªä¸ªèŠ‚ç‚¹ä¸Šï¼Œget è¯»å–æ•°æ®æ—¶éƒ½ä¼šé‡å®šå‘åˆ°æ•°æ®æ‰€åœ¨masterèŠ‚ç‚¹ä¸Šè¯»å–ã€‚</li><li>CLUSTER HELP æŸ¥çœ‹CLUSTERå…·ä½“å‘½ä»¤</li><li>CLUSTER KEYSLOT DEMO è®¡ç®—DEMOçš„keyçš„hashå€¼</li><li>redis-cli â€“cluster create 192.168.1.2:7001 192.168.1.2:7002 192.168.1.3:7003 192.168.1.3:7004 192.168.1.4:7005 192.168.1.4:7006 â€“cluster-replicas 1 åˆ›å»ºé›†ç¾¤</li></ol>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kafkaä¸»é¢˜ï¼Œåˆ†åŒºï¼Œå‰¯æœ¬ä»‹ç»</title>
    <link href="/article/4961b213.html"/>
    <url>/article/4961b213.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>ä»Šå¤©åˆ†äº«ä¸€ä¸‹kafkaçš„ä¸»é¢˜(topic)ï¼Œåˆ†åŒº(partition)å’Œå‰¯æœ¬(replication)ï¼Œä¸»é¢˜æ˜¯Kafkaä¸­å¾ˆé‡è¦çš„éƒ¨åˆ†ï¼Œæ¶ˆæ¯çš„ç”Ÿäº§å’Œæ¶ˆè´¹éƒ½è¦ä»¥ä¸»é¢˜ä¸ºåŸºç¡€ï¼Œä¸€ä¸ªä¸»é¢˜å¯ä»¥å¯¹åº”å¤šä¸ªåˆ†åŒºï¼Œä¸€ä¸ªåˆ†åŒºå±äºæŸä¸ªä¸»é¢˜ï¼Œä¸€ä¸ªåˆ†åŒºåˆå¯ä»¥å¯¹åº”å¤šä¸ªå‰¯æœ¬ï¼Œå‰¯æœ¬åˆ†ä¸ºleaderå’Œfollowerã€‚</p><p>å‰¯æœ¬çš„ä½œç”¨æ˜¯ä¿è¯æ•°æ®çš„é«˜å¯ç”¨ï¼Œä¸€ä¸ªå‰¯æœ¬åœ¨ä¸€ä¸ªbrokerèŠ‚ç‚¹ä¸Šï¼Œbrokerå°±æ˜¯ä¸€ä¸ªå°æœºå™¨æˆ–è€…ä¸€ä¸ªkafkaå®ä¾‹ï¼Œå½“æŸä¸ªå‰¯æœ¬å‡ºç°æ•…éšœåï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–å‰¯æœ¬çš„æ•°æ®ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œé‚£ä¹ˆå°±æ— æ³•ä¿è¯é«˜å¯ç”¨ã€‚</p><p>ä¸»é¢˜ï¼Œåˆ†åŒºå®é™…ä¸Šåªæ˜¯é€»è¾‘æ¦‚å¿µï¼ŒçœŸæ­£æ¶ˆæ¯å­˜å‚¨çš„åœ°æ–¹æ˜¯å‰¯æœ¬çš„æ—¥å¿—æ–‡ä»¶ä¸Šï¼Œæ‰€ä»¥ä¸»é¢˜åˆ†åŒºçš„ä½œç”¨æ˜¯åœ¨é€»è¾‘ä¸Šæ›´åŠ è§„èŒƒçš„ç®¡ç†æ—¥å¿—æ–‡ä»¶ã€‚</p><p>ä¸»é¢˜ï¼Œåˆ†åŒºï¼Œå‰¯æœ¬å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c6752e3eeb73469d876a6f5a10ac2154~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp"></p><h2 id="åˆ›å»ºä¸»é¢˜åˆ†åŒº"><a href="#åˆ›å»ºä¸»é¢˜åˆ†åŒº" class="headerlink" title="åˆ›å»ºä¸»é¢˜åˆ†åŒº"></a>åˆ›å»ºä¸»é¢˜åˆ†åŒº</h2><p>å¯ä»¥ä½¿ç”¨kafka-topics.shåˆ›å»ºtopicï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Kafka AdminClientåˆ›å»ºï¼Œå½“æˆ‘ä»¬å¾€Kafkaå‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¦‚æœæŒ‡å®šçš„topicä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»ºä¸€ä¸ªåˆ†åŒºæ•°ä¸º1çš„topicï¼Œä¸è¿‡è¿™æ ·åšå¹¶ä¸åˆé€‚ï¼Œæˆ‘ä»¬åº”è¯¥è§„åˆ’å¥½ä¸»é¢˜çš„åˆ†åŒºï¼Œå‰¯æœ¬ï¼Œç„¶ååœ¨åˆ›å»ºtopicï¼Œè¿™æ ·å¯¹ç®¡ç†topicæ›´åŠ å¥½ã€‚</p><p>kafka brokerç«¯é»˜è®¤è®¾ç½®äº†<code>allow.auto.create.topics=true</code>ï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨åˆ›å»ºtopicï¼Œä¸ºäº†æ›´åŠ è§„èŒƒå’Œåˆç†ç®¡ç†topicï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è®¾ç½®ä¸ºfalseï¼Œå½“ç„¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸­æˆ‘ä»¬è‚¯å®šä¼šè¿›è¡Œæ‰‹åŠ¨åˆ›å»ºtopicï¼Œä½†æ˜¯ä»¥é˜²ä¸ç¡®å®šå› ç´ ï¼Œå°†å…¶è®¾ç½®ä¸ºfalseæ›´ä¿é™©ä¸€äº›ã€‚</p><h4 id="ä½¿ç”¨kafka-topics-shåˆ›å»ºä¸»é¢˜"><a href="#ä½¿ç”¨kafka-topics-shåˆ›å»ºä¸»é¢˜" class="headerlink" title="ä½¿ç”¨kafka-topics.shåˆ›å»ºä¸»é¢˜"></a>ä½¿ç”¨kafka-topics.shåˆ›å»ºä¸»é¢˜</h4><p>css</p><p>å¤åˆ¶ä»£ç </p><p><code>bin/kafka-topics.shÂ --createÂ --bootstrap-serverÂ 127.0.0.1:9092Â --replication-factorÂ 1Â --partitionsÂ 2Â --topicÂ pig</code></p><h4 id="ä½¿ç”¨Kafka-AdminClient"><a href="#ä½¿ç”¨Kafka-AdminClient" class="headerlink" title="ä½¿ç”¨Kafka AdminClient"></a>ä½¿ç”¨Kafka AdminClient</h4><p>åˆ›å»ºtopicåå­—ä¸ºpigï¼Œåˆ†åŒºæ•°ä¸º1ï¼Œå‰¯æœ¬æ•°ä¸º1çš„åˆ†åŒºã€‚</p><p>ini</p><p>å¤åˆ¶ä»£ç </p><p><code>PropertiesÂ propertiesÂ =Â newÂ Properties(); properties.setProperty(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG,Â &quot;127.0.0.1:9092&quot;); AdminClientÂ adminClientÂ =Â AdminClient.create(properties); //åˆ›å»ºtopic NewTopicÂ newTopicÂ =Â newÂ NewTopic(&quot;pig&quot;,Â 4,Â (short)Â 2); CreateTopicsResultÂ resultÂ =Â adminClient.createTopics(Collections.singleton(newTopic));</code></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯å•æœºkafkaï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªbrokerï¼Œå¦‚æœå‰¯æœ¬è®¾ç½®å¤§äº1ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºä¸€ä¸ªå‰¯æœ¬å¯¹åº”ä¸€ä¸ªbrokerã€‚</p><p>åˆ›å»ºäº†ä¸»é¢˜åˆ†åŒºåï¼Œä¼šåœ¨é…ç½®æˆ‘ä»¬é…ç½®çš„æ—¥å¿—ç›®å½•(<code>log.dirs</code>)ä¸‹ç”Ÿæˆå¯¹åº”çš„åˆ†åŒºå‰¯æœ¬æ–‡ä»¶å¤¹ã€‚</p><h2 id="åˆ†åŒºï¼Œå‰¯æœ¬è¯¦è§£"><a href="#åˆ†åŒºï¼Œå‰¯æœ¬è¯¦è§£" class="headerlink" title="åˆ†åŒºï¼Œå‰¯æœ¬è¯¦è§£"></a>åˆ†åŒºï¼Œå‰¯æœ¬è¯¦è§£</h2><p>ä¸Šé¢åˆ›å»ºäº†åˆ†åŒºæ•°ä¸º4ï¼Œå‰¯æœ¬ä¸º2çš„topicï¼Œä½¿ç”¨å‘½ä»¤ <code>bin/kafka-topics.sh --describe --topic musk --bootstrap-server 127.0.0.1:9092</code>æŸ¥çœ‹åˆ†åŒºæƒ…å†µã€‚</p><p>å¦‚ä¸‹åä¸º<code>musk</code>çš„topicï¼Œåˆ†åŒºæ•°(PartitionCount)ä¸º4ï¼Œå‰¯æœ¬æ•°(ReplicationFactor)ä¸º2ï¼Œæœ‰ä¸‰ä¸ª<code>broker</code>ï¼Œkafkaä¼šå°†å‰¯æœ¬åˆç†çš„åˆ’åˆ†åˆ°ä¸åŒçš„æœºå™¨ä¸Šã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf03894c3a534c4e86aa163fbaf04dab~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp"></p><p>é‡Œé¢çš„æ•°å­—0ï¼Œ1ï¼Œ2ä»£è¡¨brokerçš„å”¯ä¸€æ ‡è¯†ï¼Œå› ä¸ºåœ¨é…ç½®kafkaé›†ç¾¤çš„æ—¶å€™ï¼Œä¸‰å°æœºå™¨çš„broker.idåˆ†åˆ«ä¸º0ï¼Œ1ï¼Œ2ã€‚</p><p>å¯çŸ¥åˆ†åŒº0çš„å‰¯æœ¬Leaderåœ¨<code>æœºå™¨2</code>ä¸Šï¼Œå‰¯æœ¬followeråœ¨<code>æœºå™¨1</code>ä¸Šé¢ï¼Œ<code>æœºå™¨0</code>ä¸Šä¸å­˜åœ¨åˆ†åŒº0çš„å‰¯æœ¬,åˆ†åŒº1çš„å‰¯æœ¬Leaderåœ¨<code>æœºå™¨1</code>ä¸Šï¼Œå‰¯æœ¬followeråœ¨<code>æœºå™¨0</code>ä¸Šé¢ï¼Œ<code>æœºå™¨2</code>ä¸Šä¸å­˜åœ¨åˆ†åŒº1çš„å‰¯æœ¬ï¼Œåˆ†åŒº2å’Œåˆ†åŒº3ä»¥æ­¤ç±»æ¨ã€‚</p><blockquote><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºkafkaè¦åˆ›å»º4ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸¤ä¸ªå‰¯æœ¬ï¼Œæ‰€ä»¥å°±å­˜åœ¨8ä¸ªå‰¯æœ¬ï¼Œ8ä¸ªå‰¯æœ¬è¦å¹³å‡åˆ†é…åˆ°3å°æœºå™¨ä¸Šä¸Šï¼Œæ‰€ä»¥å°±æŒ‰ç…§<code>3:3:2</code>çš„æ¯”ä¾‹åˆ†é…å‰¯æœ¬ï¼Œæ˜¯æŒ‰ç…§å¹³å‡åˆ†é…çš„æ–¹å¼è¿›è¡Œåˆ†é…çš„ã€‚</p></blockquote><p>ä¸‹é¢æˆ‘ä»¬åˆ›å»ºåˆ†åŒºæ•°ä¸º4ï¼Œå‰¯æœ¬ä¸º3çš„åˆ†åŒºï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a65744507af548628fee9e2f1857210b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp"></p><p>å¯ä»¥çœ‹å‡ºï¼Œå‰¯æœ¬å¹³å‡åˆ†é…åˆ°äº†0ï¼Œ1ï¼Œ2ä¸‰å°æœºå™¨ä¸Šï¼Œæ¯ä¸ªåˆ†åŒºæœ‰3ä¸ªå‰¯æœ¬ï¼Œæ‰€ä»¥4ä¸ªåˆ†åŒºæœ‰ä¸€å…±æœ‰12ä¸ªå‰¯æœ¬ã€‚</p><p>å¯ä»¥çœ‹å‡ºæ˜¯4ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒº3ä¸ªå‰¯æœ¬ï¼Œæ‰€ä»¥å°±æœ‰12ä¸ªå‰¯æœ¬ï¼Œ12ä¸ªå‰¯æœ¬åˆ†é…åˆ°3å°æœºå™¨ä¸Šé¢ï¼Œæ‰€ä»¥æ¯”ä¾‹æ˜¯<code>4:4:4</code>ã€‚</p><h2 id="ARï¼ŒISRï¼ŒOSR"><a href="#ARï¼ŒISRï¼ŒOSR" class="headerlink" title="ARï¼ŒISRï¼ŒOSR"></a>ARï¼ŒISRï¼ŒOSR</h2><p>AR é›†åˆï¼ˆAssigned Replica setï¼‰ï¼šAR é›†åˆæ˜¯æŒ‡å·²ç»è¢«åˆ†é…åˆ°çš„åˆ†åŒºå‰¯æœ¬é›†åˆã€‚åœ¨ Kafka é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªåˆ†åŒºéƒ½æœ‰è‹¥å¹²ä¸ªå‰¯æœ¬ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ leader å‰¯æœ¬ï¼Œè´Ÿè´£å¤„ç†è¯»å†™è¯·æ±‚ï¼Œå…¶ä»–çš„æ˜¯ follower å‰¯æœ¬ï¼Œç”¨äºå¤‡ä»½æ•°æ®å’Œæé«˜å¯ç”¨æ€§ã€‚AR é›†åˆå°±æ˜¯æ‰€æœ‰è¢«åˆ†é…åˆ°çš„å‰¯æœ¬çš„é›†åˆï¼ŒåŒ…æ‹¬ leader å’Œ follower å‰¯æœ¬ã€‚</p><p>ISR é›†åˆï¼ˆIn-Sync Replica setï¼‰ï¼šISR é›†åˆæ˜¯æŒ‡å½“å‰å¤„äºåŒæ­¥çŠ¶æ€çš„å‰¯æœ¬é›†åˆã€‚ISR é›†åˆæ˜¯ AR é›†åˆçš„å­é›†ï¼Œå³ ISR é›†åˆä¸­çš„å‰¯æœ¬ä¸ leader å‰¯æœ¬ä¿æŒåŒæ­¥ã€‚å¦‚æœä¸€ä¸ª follower å‰¯æœ¬ä¸ leader å‰¯æœ¬å¤±å»åŒæ­¥ï¼Œé‚£ä¹ˆå®ƒå°†ä» ISR é›†åˆä¸­ç§»é™¤ã€‚</p><p>OSR é›†åˆï¼ˆOut-of-Sync Replica setï¼‰ï¼šOSR é›†åˆæ˜¯æŒ‡å½“å‰å¤„äºä¸åŒæ­¥çŠ¶æ€çš„å‰¯æœ¬é›†åˆã€‚OSR é›†åˆæ˜¯ AR é›†åˆçš„å¦ä¸€ä¸ªå­é›†ï¼Œå³ OSR é›†åˆä¸­çš„å‰¯æœ¬ä¸ leader å‰¯æœ¬å¤±å»åŒæ­¥ã€‚è¿™äº›å‰¯æœ¬å¯èƒ½æ­£åœ¨è¿½èµ¶ leaderï¼Œæˆ–è€…å‘ç”Ÿäº†æŸäº›é”™è¯¯å¯¼è‡´ä¸ leader å¤±å»åŒæ­¥ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœ ISR é›†åˆç¼©å°åˆ°äº†ä¸€ä¸ªä¸å¯æ¥å—çš„ç¨‹åº¦ï¼Œå°±éœ€è¦å°† OSR é›†åˆä¸­çš„å‰¯æœ¬åŠ å…¥ ISR é›†åˆä¸­ï¼Œä»¥ä¿è¯å¯ç”¨æ€§ã€‚</p><blockquote><p>ä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™é‡Œï¼Œæ„Ÿè°¢ä½ çš„è§‚çœ‹ï¼Œæˆ‘ä»¬ä¸‹æœŸè§ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kafka</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>springmvc çš„ä½œç”¨ ä¸Šä¼ å›¾ç‰‡ç«‹å³æ˜¾ç¤º</title>
    <link href="/article/3ba10fab.html"/>
    <url>/article/3ba10fab.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><p>è½¬è½½è‡ªï¼š<a href="https://blog.csdn.net/weixin/_42950079/article/details/88813630">https://blog.csdn.net/weixin\_42950079/article/details/88813630</a></p><p>æˆ‘ä»¬éƒ½çŸ¥é“webé¡¹ç›®éœ€è¦éƒ¨ç½²åˆ°tomcatæœåŠ¡å™¨ä¸­è¿è¡Œ</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬åˆæ˜¯å¦‚ä½•é€šè¿‡tomcatæ¥è®¿é—®å­˜æ”¾åœ¨æœ¬åœ°ç£ç›˜ä¸­çš„å›¾ç‰‡å‘¢ï¼Ÿï¼Œé€šè¿‡tomcatè®¿é—®æœ¬åœ°å›¾ç‰‡ï¼Œéœ€è¦é…ç½®è™šæ‹Ÿè·¯å¾„ï¼Œä¸‹é¢ä»‹ç»ä¸¤ç§é…ç½®è™šæ‹Ÿè·¯å¾„çš„æ–¹å¼ï¼š</p><p>1ã€ä½¿ç”¨ IDEA è®¾ç½® è™šæ‹Ÿè·¯å¾„<br>2ã€åœ¨ Tomcat ä¸­è®¾ç½® è™šæ‹Ÿè·¯å¾„<br>å¦‚æœä¸é…ç½®è™šæ‹Ÿè·¯å¾„ï¼Œæˆ‘ä»¬ä½¿ç”¨Spring MVCä¸Šä¼ çš„å›¾ç‰‡å°±æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œæˆ‘åœ¨å­¦ä¹ ä½¿ç”¨Spring MVCä¸Šä¼ å›¾ç‰‡æ—¶å°±é‡åˆ°è¿‡è¿™æ ·çš„é—®é¢˜ï¼Œå›¾ç‰‡ä¸Šä¼ æˆåŠŸäº†ï¼Œä½†æ— æ³•è®©å›¾ç‰‡åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤º</p><h1 id="ç¬¬ä¸€ç§ï¼šä½¿ç”¨-IDEA-è®¾ç½®-è™šæ‹Ÿè·¯å¾„"><a href="#ç¬¬ä¸€ç§ï¼šä½¿ç”¨-IDEA-è®¾ç½®-è™šæ‹Ÿè·¯å¾„" class="headerlink" title="ç¬¬ä¸€ç§ï¼šä½¿ç”¨ IDEA è®¾ç½® è™šæ‹Ÿè·¯å¾„"></a>ç¬¬ä¸€ç§ï¼šä½¿ç”¨ IDEA è®¾ç½® è™šæ‹Ÿè·¯å¾„</h1><p>1ã€å…ˆåˆ›å»ºä¸€ä¸ªSpring MVCé¡¹ç›®ï¼Œå°†é¡¹ç›®éƒ¨ç½²åˆ°tomcatä¸­</p><p>2ã€ åœ¨Output directoryç›®å½•ä¸‹åˆ›å»º image æ–‡ä»¶å¤¹ï¼Œç”¨æ¥ä¿å­˜ä¸Šä¼ çš„å›¾ç‰‡ï¼Œåœ¨ç¼–å†™æ–‡ä»¶ä¸Šä¼ ä»£ç æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡request.getServletContext().getRealPath(â€œ&#x2F;image&#x2F;â€œ); è·å–åˆ°è¯¥ç›®å½•ï¼Œç„¶åæŒ‡å®šå›¾ç‰‡ä¸Šä¼ åˆ°è¯¥ç›®å½•ä¸­</p><p>request.getServletContext().getRealPath(â€œâ€); æ–¹æ³•ç”¨äºè·å–Output directoryç›®å½•çš„è·¯å¾„</p><p>å¦‚æœæŒ‡å®šå…¶å®ƒç›®å½•ä¿å­˜ä¸Šä¼ çš„å›¾ç‰‡ï¼Œæ¯”å¦‚åœ¨WEB-INFç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªimageæ–‡ä»¶å¤¹æ¥ä¿å­˜ä¸Šä¼ çš„å›¾ç‰‡ï¼Œå°±ä¸èƒ½é€šè¿‡String path&#x3D;request.getServletContext().getRealPath(â€œ&#x2F;image&#x2F;â€œ); æ–¹æ³•æ¥è·å–è¯¥ç›®å½•ï¼Œå®ƒæ˜¯ç”¨æ¥è·å–Output directoryç›®å½•çš„è·¯å¾„çš„</p><p>è€Œæ˜¯é€šè¿‡String path&#x3D;â€E:\ideaUI\javaworkspace\springmvcTest\web\WEB-INF\imageâ€; æ¥æŒ‡å®šå›¾ç‰‡ä¿å­˜ç›®å½•</p><p>Â <img src="https://img2018.cnblogs.com/blog/1418529/201907/1418529-20190702095151267-1116514114.png"></p><p><img src="https://img2018.cnblogs.com/blog/1418529/201907/1418529-20190702101240267-552918868.png"></p><p>3ã€Run â†’ Edit Configurations . . . â†’ Deployment â†’ + â†’ External Source . . .</p><p><img src="https://img2018.cnblogs.com/blog/1418529/201907/1418529-20190702101252412-224344527.png"></p><p>4ã€é€‰æ‹©ä¿å­˜ä¸Šä¼ å›¾ç‰‡çš„ç£ç›˜è·¯å¾„ï¼Œå¹¶è®¾ç½®è™šæ‹Ÿè·¯å¾„ä¸º&#x2F;img<br>â€ƒ â€ƒé…ç½®æˆåŠŸåï¼Œå°±å¯ä»¥é€šè¿‡ localhostï¼š8080&#x2F;img&#x2F;å›¾ç‰‡åç§°å…¨ç§° è®¿é—®åˆ°å›¾ç‰‡</p><p>Â <img src="https://img2018.cnblogs.com/blog/1418529/201907/1418529-20190702101324941-579734131.png"></p><h1 id="ç¬¬äºŒç§ï¼šåœ¨-Tomcat-ä¸­è®¾ç½®-è™šæ‹Ÿè·¯å¾„"><a href="#ç¬¬äºŒç§ï¼šåœ¨-Tomcat-ä¸­è®¾ç½®-è™šæ‹Ÿè·¯å¾„" class="headerlink" title="ç¬¬äºŒç§ï¼šåœ¨ Tomcat ä¸­è®¾ç½® è™šæ‹Ÿè·¯å¾„"></a>ç¬¬äºŒç§ï¼šåœ¨ Tomcat ä¸­è®¾ç½® è™šæ‹Ÿè·¯å¾„</h1><p>1ã€è¿›å…¥tomcatå®‰è£…ç›®å½•ï¼Œæ‰¾åˆ°confæ–‡ä»¶å¤¹ä¸‹çš„server.xmlæ–‡ä»¶</p><p><img src="https://img2018.cnblogs.com/blog/1418529/201907/1418529-20190702101405666-1676849834.png"></p><p>2ã€åœ¨æ ‡ç­¾ä¸­æ·»åŠ  <Context path="/img" docBase="E:\\ideaUI\\javaworkspace\\springmvcTest\\out\\artifacts\\springmvcTest\_war\_exploded\\image" reloadable="true"/> è®¾ç½®è™šæ‹Ÿè·¯å¾„</p><p>path&#x3D;â€&#x2F;imgâ€ â€ƒâ†’ æ˜¯è™šæ‹Ÿè·¯å¾„<br>docBase&#x3D;â€œE:\ideaUI\javaworkspace\springmvcTest\out\artifacts\springmvcTest_war_exploded\imageâ€ â€ƒ â†’ æ˜¯ç£ç›˜ä¸­ä¿å­˜å›¾ç‰‡çš„çœŸå®ç›®å½•</p><p><img src="https://img2018.cnblogs.com/blog/1418529/201907/1418529-20190702101419382-1124377410.png"></p><p>3ã€Run â†’ Edit Configurations . . . â†’ å‹¾é€‰ Deploy applications configured in Tomcat instance</p><p><img src="https://img2018.cnblogs.com/blog/1418529/201907/1418529-20190702101445323-1411097593.png"></p><h1 id="ç¬¬ä¸‰ç§-ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶è·¯å¾„ä¸ºArtifactsçš„è¾“å‡ºç›®å½•ã€‚"><a href="#ç¬¬ä¸‰ç§-ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶è·¯å¾„ä¸ºArtifactsçš„è¾“å‡ºç›®å½•ã€‚" class="headerlink" title="ç¬¬ä¸‰ç§ ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶è·¯å¾„ä¸ºArtifactsçš„è¾“å‡ºç›®å½•ã€‚"></a>ç¬¬ä¸‰ç§ ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶è·¯å¾„ä¸ºArtifactsçš„è¾“å‡ºç›®å½•ã€‚</h1><p>D:&#x2F;adopt-master&#x2F;target&#x2F;adopt&#x2F;static&#x2F;images&#x2F;animal&#x2F;</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redisé›†ç¾¤èŠ‚ç‚¹æ˜¾ç¤ºnoaddr</title>
    <link href="/article/175c32e0.html"/>
    <url>/article/175c32e0.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /><p>1.å½“é›†ç¾¤ä½¿ç”¨killå‘½ä»¤æ€æ­»æŸä¸ªä¸»èŠ‚ç‚¹åï¼Œå†å¯åŠ¨æ­¤èŠ‚ç‚¹æ— æ³•åŠ å…¥åˆ°é›†ç¾¤ä¸­<br>æ˜¾ç¤ºno addr<br>78641a9cf0098e1c5c07821266dcd1feae21bcd3 :0 slave,noaddr - 1530942381678 1530942361875 0 disconnected</p><p>æ’æŸ¥åŸå› :<br>    killä¹‹åå†å¯åŠ¨æ‰§è¡Œå‘½ä»¤æ—¶è·¯å¾„å’ŒåŸå…ˆä¸ä¸€è‡´ï¼Œredis.conf dir é…ç½®.&#x2F;  æ•°æ®ä½ç½®å˜äº†<br>è§£å†³æ–¹æ¡ˆï¼š<br>    redis.conf é…ç½®dirç›®å½•ï¼Œè®©æ•°æ®å­˜å‚¨åœ¨å›ºå®šç›®å½•ï¼Œå†å¯åŠ¨æ—¶å°±å¯ä»¥è¯»å–æ­¤ç›®å½•ä¸‹é…ç½®</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å°ç±³æ‰‹æœºRootæ–¹æ³• - çŸ¥ä¹</title>
    <link href="/article/5cd588af.html"/>
    <url>/article/5cd588af.html</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /># å°ç±³æ‰‹æœºRootæ–¹æ³• - çŸ¥ä¹<blockquote><h2 id="Excerpt"><a href="#Excerpt" class="headerlink" title="Excerpt"></a>Excerpt</h2><p>åŸæ–‡å‡ºå¤„ï¼š å°ç±³æ‰‹æœºå®‰è£…é¢å…·æ•™ç¨‹ï¼ˆXiaomiæ‰‹æœºè·å–rootæƒé™ï¼‰ã€‚æ ¹æ®ä½œè€…è‡ªèº«çš„æ“ä½œç»“æœæœ‰æ‰€æ”¹åŠ¨ã€‚ æ¼”ç¤ºç¯å¢ƒï¼š æ‰‹æœºæœºå‹ï¼š å°ç±³ 8 SE æ‰‹æœºç³»ç»Ÿï¼šMIUI12.5.1ç¨³å®šç‰ˆï¼ˆå®‰å“10ï¼‰ ç”µè„‘ç³»ç»Ÿï¼šWindows7 64ä½æ¼”ç¤ºæ­¥éª¤ï¼š ä¸€â€¦</p></blockquote><hr><p>åŸæ–‡å‡ºå¤„ï¼š<a href="https://link.zhihu.com/?target=https://magiskcn.com/">å°ç±³æ‰‹æœºå®‰è£…é¢å…·æ•™ç¨‹ï¼ˆXiaomiæ‰‹æœºè·å–rootæƒé™ï¼‰</a>ã€‚</p><p>æ ¹æ®ä½œè€…è‡ªèº«çš„æ“ä½œç»“æœæœ‰æ‰€æ”¹åŠ¨ã€‚</p><p>æ¼”ç¤ºç¯å¢ƒï¼š</p><p>æ‰‹æœºæœºå‹ï¼š<strong>å°ç±³ 8 SE</strong><br>æ‰‹æœºç³»ç»Ÿï¼šMIUI12.5.1ç¨³å®šç‰ˆï¼ˆå®‰å“10ï¼‰<br>ç”µè„‘ç³»ç»Ÿï¼šWindows7 64ä½</p><p>æ¼”ç¤ºæ­¥éª¤ï¼š</p><p>ä¸€ã€<strong>Bootloader</strong>è§£é”ï¼š<a href="https://link.zhihu.com/?target=https://magiskcn.com/xiaomi-unlock">Xiaomi-unlock</a><br><em>å¦‚æœä½ çš„æ‰‹æœºä¸èƒ½è§£é”BLï¼Œæ¨è</em> <em>**<a href="https://link.zhihu.com/?target=https://magiskcn.com/gsxnj">å…‰é€Ÿè™šæ‹Ÿæœº</a>**ï¼ˆä¸ç”¨è§£é”BLä¹Ÿå¯ä»¥åˆ·é¢å…·ï¼‰</em></p><p><em>ä½œè€…æ‰‹æœºå·²ç»ä¹‹å‰å·²ç»è§£é”ï¼Œæ‰€ä»¥è¿™æ­¥çœç•¥ï¼ŒæˆåŠŸä¹‹åæ¯æ¬¡å¯åŠ¨æ‰‹æœºé¡µé¢æœ€ä¸Šç«¯ä¸­é—´ä¼šæœ‰ä¸ªè§£å¼€çš„é”çš„logoã€‚</em></p><p>äºŒã€ä¸‹è½½<strong>ç³»ç»Ÿå®‰è£…åŒ…</strong>ï¼š<a href="https://link.zhihu.com/?target=https://magiskcn.com/get-miui">Get-miui</a></p><p>ä½œè€…æç¤ºï¼šç³»ç»ŸåŒ…åˆ†å¡åˆ·åŒ…å’Œçº¿åˆ·åŒ…ï¼Œæˆ‘éƒ½ä¸‹è½½äº†ï¼Œä¸è¿‡åé¢æˆ‘æ˜¯çº¿åˆ·çš„ã€‘</p><p>ä¸‰ã€è§£åŒ…æå–bootï¼š<a href="https://link.zhihu.com/?target=https://magiskcn.com/payload-dumper-go">Payload-dumper-go</a>ï¼ˆå¦‚æœç³»ç»ŸåŒ…æœ‰ <strong>boot.img</strong>ï¼Œå¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ï¼‰</p><p>ä½œè€…æç¤ºï¼šè¿™æ­¥å¤šåŠæ˜¯å¤šä½™çš„ï¼Œä¸ç®¡æˆ‘ä¸‹è½½çš„å¡åˆ·åŒ…å’Œçº¿åˆ·åŒ…ï¼Œè§£å‹ä¹‹ååŒ…é‡Œéƒ½æœ‰boot.imgï¼Œå¯ä»¥ç›´æ¥ç”¨ã€‚</p><p>å››ã€æ‰‹æœºæ’ç”µè„‘ï¼Œæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œå¤åˆ¶ <strong>boot.img</strong> å’Œ <strong>ç³»ç»ŸåŒ…</strong> åˆ°æ‰‹æœº <strong>Download</strong> ç›®å½•</p><p>ä½œè€…æç¤ºï¼šæˆ‘åªå¤åˆ¶äº†boot.imgåˆ°æ‰‹æœº<strong>Download</strong> ç›®å½•ï¼Œæ‰‹æœºä½ç½®ä¹Ÿä¸æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥è‡ªå·±æ–°å»ºåœ¨æ ¹ç›®å½•ä½ç½®ã€‚</p><p>äº”ã€1.è¿å‡»LOGOï¼ˆå¼€å¯ç³»ç»Ÿæ›´æ–°æ‰©å±•åŠŸèƒ½ï¼‰- 2.æ‰‹åŠ¨é€‰æ‹©å®‰è£…åŒ… â€“ 3.é€‰æ‹©ç³»ç»ŸåŒ…å‡çº§<br><em>ï¼ˆè¿™é‡Œæ˜¯ä¿è¯</em> <em><strong>ç³»ç»ŸåŒ…ç‰ˆæœ¬</strong></em> <em>å’Œ</em> <em><strong>æ‰‹æœºç³»ç»Ÿç‰ˆæœ¬</strong></em> <em>ä¸€è‡´ï¼Œå¦‚æœç‰ˆæœ¬ä¸€è‡´å¯ä»¥è·³è¿‡ï¼‰</em></p><p><img src="https://pic3.zhimg.com/v2-0f8753d50d123fea8525c80857180dee_b.jpg"></p><p>ä½œè€…æç¤ºï¼šè¿™æ­¥æˆ‘æ²¡æœ‰åšï¼Œåé¢å¯åŠ¨ä¸èµ·æ¥å¯èƒ½è·Ÿè¿™æ­¥æœ‰å…³ç³»ã€‚</p><p>å…­ã€æ‰‹æœºä¸‹è½½å®‰è£…<strong>Magisk</strong> appï¼š<a href="https://link.zhihu.com/?target=https://magiskcn.com/magisk-download">Magisk-download</a></p><p>ä¸ƒã€1.å®‰è£… â€“ 2.é€‰é¡¹ <strong>éƒ½ä¸å‹¾</strong>ï¼ˆå‹¾äº†ä¼šå¡ç±³ï¼Œéƒ¨åˆ†æ‰‹æœºæ²¡æœ‰é€‰é¡¹ï¼‰- 3.é€‰æ‹©å¹¶ä¿®è¡¥ä¸€ä¸ªæ–‡ä»¶</p><p><img src="https://pic2.zhimg.com/v2-b9e012189b784d0ea027927a5ec9e119_b.jpg"></p><p>å…«ã€4.é€‰æ‹©<strong>boot.img</strong> â€“ 5.å¼€å§‹ â€“ 6.ä¿®è¡¥æˆåŠŸ</p><p><img src="https://pic4.zhimg.com/v2-b5c59f4dee9d77783cca2c5eef62460b_b.jpg"></p><p>ä¹ã€ä¿®è¡¥æˆåŠŸï¼Œä¼šåœ¨ <strong>Download</strong> ç›®å½•ç”Ÿæˆï¼ˆ<strong>magisk_patched-ç‰ˆæœ¬_éšæœº.img</strong>ï¼‰æ–‡ä»¶ï¼Œæ¯æ¬¡ç”Ÿæˆçš„éšæœºå­—ç¬¦éƒ½ä¸ä¸€æ ·ï¼Œä½¿ç”¨çš„æ—¶å€™è¯·è¾“å…¥ç”Ÿæˆçš„åå­—ã€‚</p><p><img src="https://pic2.zhimg.com/v2-d5ea535fe343a49bcf9a93b01d1e6a7d_b.jpg"></p><p>åã€ç”µè„‘ä¸‹è½½ <strong>adb-fastboot</strong>ï¼š<a href="https://link.zhihu.com/?target=https://mrzzoxo.lanzoub.com/b02plghuh">lanzoub.com&#x2F;b02plghuh</a>ï¼ˆè§£å‹å‡ºæ¥ï¼‰</p><p>åä¸€ã€æ‰‹æœºæ’ç”µè„‘ï¼Œæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼ŒæŠŠ <strong>boot.img</strong> å’Œ <strong>magisk_patched-ç‰ˆæœ¬_éšæœº.img</strong> ä¸¤ä¸ªæ–‡ä»¶å¤åˆ¶åˆ° <strong>adb-fastboot</strong> ç›®å½•</p><p><img src="https://pic4.zhimg.com/v2-e6e57a7570af6742796f6f955055289f_b.jpg"></p><p>åäºŒã€æ‰‹æœºé‡å¯åˆ° <strong>fastboot</strong> æ¨¡å¼ï¼ˆæŒ‰ç”µæºé”®é‡å¯ é©¬ä¸ŠæŒ‰ä½ éŸ³é‡é”® â€“ï¼‰æ’ä¸Šç”µè„‘</p><p>åä¸‰ã€æ‰“å¼€â€œ<strong>æ‰“å¼€CMDå‘½ä»¤è¡Œ.bat</strong>â€ï¼Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">fastboot flash boot magisk_patched-ç‰ˆæœ¬<span class="hljs-literal">_</span>éšæœº.img<br></code></pre></td></tr></table></figure><p><img src="https://pic4.zhimg.com/v2-fee3db9851312a67e7781b0024b5542b_b.jpg"></p><p>ä½œè€…æç¤ºï¼šè¿™æ­¥æˆ‘è‡ªå·±æ“ä½œç¢°åˆ°é—®é¢˜ã€‚ç”µè„‘ä¸Šç‚¹å‡»batæ–‡ä»¶ä¸è¿è¡Œï¼ŒæŠ˜è…¾ä¸€ç•ªåç”¨cmdï¼Œç›´æ¥è¾“å…¥ï¼Œæ€»ç®—æ˜¯æˆåŠŸäº†ã€‚å¦‚æœæœ‰åŒæ ·ç¢°åˆ°æ­¤é—®é¢˜ï¼Œå¯ä»¥cmdä¸­ç›´æ¥å…ˆè¿è¡Œadbè¯•è¯•ã€‚</p><p>åå››ã€å‡ºç°ä¸‹é¢è¿™ä¸‰è¡Œä»£ç ï¼Œå°±æ˜¯æˆåŠŸåˆ·å…¥äº†ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Sending</span> &#x27;boot&#x27; (<span class="hljs-number">131072</span> KB) OKAY<span class="hljs-meta"> [ 3.311s]</span><br><span class="hljs-attribute">Writing</span> &#x27;boot&#x27; OKAY<span class="hljs-meta"> [ 0.441s]</span><br><span class="hljs-attribute">Finished</span>. Total time: <span class="hljs-number">3</span>.<span class="hljs-number">794</span>s<br></code></pre></td></tr></table></figure><p>åäº”ã€é‡å¯æ‰‹æœºï¼ˆå¼€æœºæœ‰éœ‡åŠ¨åŸºæœ¬æ²¡é—®é¢˜äº†ï¼‰è€å¿ƒç­‰æ‰‹æœºå¼€æœºã€‚ï¼ˆæ˜¾ç¤ºMagiskçš„ç‰ˆæœ¬ï¼Œå°±æ˜¯åˆ·å¥½äº†çš„ï¼‰</p><p><img src="https://pic2.zhimg.com/v2-d8b9963983cc8659d6aab67060db9431_b.jpg"></p><p>ä½œè€…æç¤ºï¼šè§è¯å¥‡è¿¹çš„æ—¶åˆ»åˆ°äº†ã€‚å¯æƒœï¼Œæˆ‘çš„æ²¡æˆåŠŸï¼Œå¯åŠ¨åä¸€ç›´åœç•™åœ¨miå­—ç•Œé¢ï¼ŒæˆåŠŸå˜ç –ã€‚å’‹æ•´ï¼Ÿæœ€åè¿™å‡ æ­¥åˆé‡æ–°è¯•äº†å‡ æ¬¡ï¼Œæœ€åè¿˜æ˜¯ä¸è¡Œã€‚è¿˜å¥½æ“ä½œä¹‹å‰å·²ç»å¤‡ä»½å¥½äº†æ•°æ®ï¼Œç›´æ¥ä¸Šçº¿åˆ·åŒ…ï¼Œç”¨å°ç±³flashå·¥å…·ç›´æ¥åˆ·ï¼Œåˆšå¼€å§‹å³ä¸‹è§’é€‰çš„ä¿ç•™æ•°æ®ï¼Œå¼€æœºè¿˜æ˜¯ä¸è¡Œï¼Œæ‰€ä»¥å¹²è„†æ¸…é™¤æ•°æ®ï¼Œæœæ–­é‡æ–°åˆ·æœºï¼Œç„¶åæˆåŠŸå¼€æœºäº†ã€‚çŒœæƒ³å¤±è´¥çš„åŸå› æ˜¯miuiç‰ˆæœ¬ä½äº†ï¼Œæœ¬èº«æ‰‹æœºä¸Šçš„ç‰ˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚</p><p><strong>æ¸©é¦¨æç¤º</strong><br>å¦‚æœåˆ·æ¨¡å—ä¸å…¼å®¹æˆ–è€…å…¶ä»–éªšæ“ä½œå¯¼è‡´ä¸èƒ½å¼€æœºï¼Œå¯ä»¥æŠŠæˆ‘ä»¬å‰é¢æå–çš„<strong>boot.img</strong>é€šè¿‡<strong>fastboot</strong>åˆ·å›å»ï¼Œæ¢å¤åŸç³»ç»Ÿï¼Œä¸€èˆ¬éƒ½èƒ½æ­£å¸¸å¼€æœºï¼<br><strong>boot.img</strong>ä¿ç•™ä¸€ä»½åœ¨ç”µè„‘ï¼Œé¿å…å‡ºé—®é¢˜äº†å¯ä»¥è‡ªæ•‘ä¸‹ï¼è¿˜åŸbootæŒ‡ä»¤</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">fastboot flash <span class="hljs-keyword">boot</span> <span class="hljs-keyword">boot</span>.img<br></code></pre></td></tr></table></figure><p>åæœŸç³»ç»Ÿæ›´æ–°ï¼Œç›´æ¥ä¸‹è½½å…¨é‡å®Œæ•´åŒ…å‡çº§ï¼Œç„¶åé‡å¤ä¸Šé¢çš„æ­¥éª¤å°±å¯ä»¥ç»§ç»­æ„‰å¿«çš„ä½¿ç”¨<strong>Magisk</strong>äº†ï¼</p><p>æœ€åæ€»ç»“ï¼šæ‰‹æœºä¸æ˜¯å¡çš„ä¸èƒ½ç”¨çš„æƒ…å†µï¼Œä¸è¦çææœºï¼Œé¦–å…ˆè¿™ä¸ªæ­¥éª¤èµ°ä¸‹æ¥ï¼Œæ–°æ‰‹å¯èƒ½å°±ä¼šèŠ±æ‰ä¸€å¤©çš„æ—¶é—´ï¼Œè€—æ—¶è€—åŠ›ï¼ŒäºŒæ˜¯å³ä½¿ROOTæˆåŠŸï¼Œå¯¹æ™®é€šç”¨æˆ·æ¥è®²ï¼Œæ²¡å¤šå°‘ä¸ªåµç”¨ï¼Œè¿˜ä¼šè¢«æç¤ºå„ç§é£é™©ã€‚æ€»çš„æ¥è¯´å¯¹äºæ™®é€šç”¨æˆ·è€Œè¨€ï¼Œå¼Šå¤§äºåˆ©ï¼Œä¸å»ºè®®Rootã€‚ææœºæœ‰é£é™©ï¼Œåæœéœ€è‡ªè´Ÿã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>ç½‘ç»œæœå¯»</tag>
      
      <tag>Root</tag>
      
      <tag>(Android)</tag>
      
      <tag>rootæ–¹æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®‰å“å¼€å‘day01</title>
    <link href="/article/2dae291a.html"/>
    <url>/article/2dae291a.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li>å®‰å“ASè°ƒè¯•å®‰è£…åè‡ªåŠ¨æ‰“å¼€ï¼ŒRun&#x2F;Debug Configurations è®¾ç½® appçš„Launch é€‰æ‹©DefaultActivity</li></ul>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>chownå’ŒchmodåŒºåˆ«</title>
    <link href="/article/cd33d05d.html"/>
    <url>/article/cd33d05d.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><p><code>chown</code>å’Œ<code>chmod</code>æ˜¯ä¸¤ä¸ªåœ¨Linuxå’ŒUNIXç³»ç»Ÿä¸­ä½¿ç”¨çš„å‘½ä»¤ï¼Œç”¨äºä¿®æ”¹æ–‡ä»¶å’Œç›®å½•çš„æƒé™å’Œæ‰€æœ‰è€…ã€‚å®ƒä»¬çš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</p><ol><li><p>chownï¼ˆChange Ownerï¼‰ï¼š</p><ul><li><code>chown</code>å‘½ä»¤ç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ï¼ˆå³ç”¨æˆ·ï¼‰ã€‚</li><li>å®ƒå¯ä»¥å°†æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰æƒè½¬ç§»ç»™ä¸åŒçš„ç”¨æˆ·ã€‚</li><li>è¯­æ³•ï¼š<code>chown [options] owner[:group] file(s)</code></li><li>ç¤ºä¾‹ï¼š<code>chown user1:group1 file.txt</code></li></ul></li><li><p>chmodï¼ˆChange Modeï¼‰ï¼š</p><ul><li><code>chmod</code>å‘½ä»¤ç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„è®¿é—®æƒé™ã€‚</li><li>å®ƒå¯ä»¥è®¾ç½®æ–‡ä»¶æˆ–ç›®å½•çš„è¯»ã€å†™å’Œæ‰§è¡Œæƒé™ï¼Œä»¥åŠç‰¹æ®Šæƒé™ï¼ˆå¦‚SUIDã€SGIDå’ŒStickyä½ï¼‰ã€‚</li><li>è¯­æ³•ï¼š<code>chmod [options] mode file(s)</code></li><li>ç¤ºä¾‹ï¼š<code>chmod 755 file.txt</code></li></ul></li></ol><p>ä¸»è¦åŒºåˆ«ï¼š</p><ul><li><code>chown</code>ç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ï¼Œè€Œ<code>chmod</code>ç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚</li><li><code>chown</code>éœ€è¦æä¾›æ–°çš„æ‰€æœ‰è€…çš„ç”¨æˆ·åï¼ˆä»¥åŠå¯é€‰çš„ç»„åï¼‰ï¼Œè€Œ<code>chmod</code>éœ€è¦æä¾›æ–°çš„æƒé™æ¨¡å¼ã€‚</li><li><code>chown</code>åªèƒ½ç”±æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…æˆ–è¶…çº§ç”¨æˆ·æ‰§è¡Œï¼Œè€Œ<code>chmod</code>å¯ä»¥ç”±æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ã€æ‰€å±ç»„ã€å…¶ä»–ç”¨æˆ·æˆ–è¶…çº§ç”¨æˆ·æ‰§è¡Œã€‚</li><li><code>chown</code>æ›´æ”¹æ‰€æœ‰è€…ä¿¡æ¯ä¸ä¼šå½±å“æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ï¼Œè€Œ<code>chmod</code>æ›´æ”¹æƒé™ä¸ä¼šå½±å“æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ã€‚</li></ul><p>æ€»ç»“èµ·æ¥ï¼Œ<code>chown</code>ç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ï¼Œè€Œ<code>chmod</code>ç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚å®ƒä»¬æ˜¯ä¸åŒçš„å‘½ä»¤ï¼Œç”¨äºä¸åŒçš„ç›®çš„ã€‚</p><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶å’Œç›®å½•çš„æƒé™ç”¨ä¸€ä¸²å­—ç¬¦è¡¨ç¤ºï¼Œå…¶ä¸­åŒ…æ‹¬10ä¸ªå­—ç¬¦ï¼šç¬¬ä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºæ–‡ä»¶ç±»å‹ï¼Œåç»­ä¹ä¸ªå­—ç¬¦è¡¨ç¤ºå¯¹åº”çš„æƒé™ã€‚</p><p>å¯¹äºç›®å½•ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯<code>d</code>ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªç›®å½•ã€‚å¯¹äºæ–‡ä»¶ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦å¯ä»¥æ˜¯å…¶ä»–ç±»å‹çš„æ ‡è¯†ç¬¦ï¼Œå¦‚<code>-</code>è¡¨ç¤ºæ™®é€šæ–‡ä»¶ã€‚</p><p>åç»­çš„ä¹ä¸ªå­—ç¬¦æ˜¯åˆ†ä¸ºä¸‰ç»„ï¼Œæ¯ç»„ä¸‰ä¸ªå­—ç¬¦ï¼Œåˆ†åˆ«è¡¨ç¤ºæ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™ã€æ–‡ä»¶æ‰€å±ç»„çš„æƒé™å’Œå…¶ä»–ç”¨æˆ·çš„æƒé™ã€‚è¿™ä¸‰ç»„å­—ç¬¦çš„é¡ºåºæ˜¯å›ºå®šçš„ï¼Œä¾æ¬¡æ˜¯è¯»å–ï¼ˆ<code>r</code>ï¼‰ã€å†™å…¥ï¼ˆ<code>w</code>ï¼‰å’Œæ‰§è¡Œï¼ˆ<code>x</code>ï¼‰çš„æƒé™ã€‚</p><p>æƒé™å­—ç¬¦çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li><code>r</code>ï¼šè¯»å–æƒé™ï¼Œè¡¨ç¤ºå¯ä»¥è¯»å–æ–‡ä»¶çš„å†…å®¹æˆ–æŸ¥çœ‹ç›®å½•çš„å†…å®¹åˆ—è¡¨ã€‚</li><li><code>w</code>ï¼šå†™å…¥æƒé™ï¼Œè¡¨ç¤ºå¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„å†…å®¹æˆ–åœ¨ç›®å½•ä¸­åˆ›å»ºã€åˆ é™¤æˆ–é‡å‘½åæ–‡ä»¶ã€‚</li><li><code>x</code>ï¼šæ‰§è¡Œæƒé™ï¼Œå¯¹äºæ–‡ä»¶è¡¨ç¤ºå¯ä»¥æ‰§è¡Œå®ƒä½œä¸ºå¯æ‰§è¡Œç¨‹åºï¼Œå¯¹äºç›®å½•è¡¨ç¤ºå¯ä»¥è¿›å…¥ç›®å½•ã€‚</li></ul><p>å¦‚æœå¯¹åº”ä½ç½®çš„å­—ç¬¦æ˜¯<code>-</code>ï¼Œè¡¨ç¤ºç›¸åº”çš„æƒé™è¢«ç¦æ­¢ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªç›®å½•çš„æƒé™ä¸º<code>drwxr-xr-x</code>ï¼Œè§£è¯»å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå­—ç¬¦<code>d</code>è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªç›®å½•ã€‚</li><li>åç»­ä¹ä¸ªå­—ç¬¦å¯ä»¥åˆ†ä¸ºä¸‰ç»„ï¼š<code>rwx</code>ã€<code>r-x</code>å’Œ<code>r-x</code>ã€‚</li><li><code>rwx</code>è¡¨ç¤ºæ–‡ä»¶æ‰€æœ‰è€…å…·æœ‰è¯»å–ã€å†™å…¥å’Œæ‰§è¡Œçš„æƒé™ã€‚</li><li><code>r-x</code>è¡¨ç¤ºæ–‡ä»¶æ‰€å±ç»„å…·æœ‰è¯»å–å’Œæ‰§è¡Œçš„æƒé™ï¼Œä½†æ²¡æœ‰å†™å…¥çš„æƒé™ã€‚</li><li><code>r-x</code>è¡¨ç¤ºå…¶ä»–ç”¨æˆ·å…·æœ‰è¯»å–å’Œæ‰§è¡Œçš„æƒé™ï¼Œä½†æ²¡æœ‰å†™å…¥çš„æƒé™ã€‚</li></ul><p>æ€»ç»“èµ·æ¥ï¼Œ<code>drwxr-xr-x</code>è¡¨ç¤ºä¸€ä¸ªç›®å½•ï¼Œæ–‡ä»¶æ‰€æœ‰è€…å…·æœ‰å®Œå…¨æƒé™ï¼Œæ–‡ä»¶æ‰€å±ç»„å’Œå…¶ä»–ç”¨æˆ·å…·æœ‰è¯»å–å’Œæ‰§è¡Œçš„æƒé™ï¼Œä½†æ²¡æœ‰å†™å…¥çš„æƒé™ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>obsidianä¸­ä½¿ç”¨ç½‘é¡µå‰ªæŠ¥ - å“”å“©å“”å“©</title>
    <link href="/article/2e271d30.html"/>
    <url>/article/2e271d30.html</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="obsidianä¸­ä½¿ç”¨ç½‘é¡µå‰ªæŠ¥-å“”å“©å“”å“©"><a href="#obsidianä¸­ä½¿ç”¨ç½‘é¡µå‰ªæŠ¥-å“”å“©å“”å“©" class="headerlink" title="obsidianä¸­ä½¿ç”¨ç½‘é¡µå‰ªæŠ¥ - å“”å“©å“”å“©"></a>obsidianä¸­ä½¿ç”¨ç½‘é¡µå‰ªæŠ¥ - å“”å“©å“”å“©</h1><blockquote><h2 id="Excerpt"><a href="#Excerpt" class="headerlink" title="Excerpt"></a>Excerpt</h2><h2 id="èƒŒæ™¯ï¼šå¹³æ—¶ç»å¸¸ä½¿ç”¨ç½‘é¡µå‰ªæŠ¥æ¥åšä¸€äº›è®°å½•ï¼Œä½†æ˜¯åˆ‡æ¢åˆ°obsidianåï¼Œæ²¡æœ‰å‰ªæŠ¥æœ‰äº›ä¸ä¹ æƒ¯ï¼Œäºæ˜¯æ‰¾äº†ä¸‹ç›¸å…³çš„æ’ä»¶ï¼Œå®‰è£…åè®°å½•-æ’ä»¶ä¸‹è½½ï¼šobsidianæ’ä»¶ï¼šadvanced-obsidian-uriè¿™ä¸ªæ’ä»¶ç”¨æ¥æ§åˆ¶obsidian-uriç›¸å…³æ“ä½œã€‚markdownloadè¿™ä¸ªæ’ä»¶ç”¨æ¥å°†æµè§ˆå™¨ä¸­çš„å†…å®¹å‰ªåˆ‡ä¸ºmarkdownæ ¼å¼ã€‚-å®‰è£…é…ç½®obsidianä¸­çš„advanced-obsidian-uriæ’ä»¶èƒ½ä¸€é”®å®‰è£…ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ï¼Œä¸»è¦æ˜¯chromeä¸­markdownloadæ’ä»¶çš„"><a href="#èƒŒæ™¯ï¼šå¹³æ—¶ç»å¸¸ä½¿ç”¨ç½‘é¡µå‰ªæŠ¥æ¥åšä¸€äº›è®°å½•ï¼Œä½†æ˜¯åˆ‡æ¢åˆ°obsidianåï¼Œæ²¡æœ‰å‰ªæŠ¥æœ‰äº›ä¸ä¹ æƒ¯ï¼Œäºæ˜¯æ‰¾äº†ä¸‹ç›¸å…³çš„æ’ä»¶ï¼Œå®‰è£…åè®°å½•-æ’ä»¶ä¸‹è½½ï¼šobsidianæ’ä»¶ï¼šadvanced-obsidian-uriè¿™ä¸ªæ’ä»¶ç”¨æ¥æ§åˆ¶obsidian-uriç›¸å…³æ“ä½œã€‚markdownloadè¿™ä¸ªæ’ä»¶ç”¨æ¥å°†æµè§ˆå™¨ä¸­çš„å†…å®¹å‰ªåˆ‡ä¸ºmarkdownæ ¼å¼ã€‚-å®‰è£…é…ç½®obsidianä¸­çš„advanced-obsidian-uriæ’ä»¶èƒ½ä¸€é”®å®‰è£…ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ï¼Œä¸»è¦æ˜¯chromeä¸­markdownloadæ’ä»¶çš„" class="headerlink" title="èƒŒæ™¯ï¼šå¹³æ—¶ç»å¸¸ä½¿ç”¨ç½‘é¡µå‰ªæŠ¥æ¥åšä¸€äº›è®°å½•ï¼Œä½†æ˜¯åˆ‡æ¢åˆ°obsidianåï¼Œæ²¡æœ‰å‰ªæŠ¥æœ‰äº›ä¸ä¹ æƒ¯ï¼Œäºæ˜¯æ‰¾äº†ä¸‹ç›¸å…³çš„æ’ä»¶ï¼Œå®‰è£…åè®°å½•## æ’ä»¶ä¸‹è½½ï¼šobsidianæ’ä»¶ï¼šadvanced obsidian uriè¿™ä¸ªæ’ä»¶ç”¨æ¥æ§åˆ¶obsidian uriç›¸å…³æ“ä½œã€‚markdownloadè¿™ä¸ªæ’ä»¶ç”¨æ¥å°†æµè§ˆå™¨ä¸­çš„å†…å®¹å‰ªåˆ‡ä¸ºmarkdownæ ¼å¼ã€‚## å®‰è£…é…ç½®obsidianä¸­çš„advanced obsidian uriæ’ä»¶èƒ½ä¸€é”®å®‰è£…ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ï¼Œä¸»è¦æ˜¯chromeä¸­markdownloadæ’ä»¶çš„"></a>èƒŒæ™¯ï¼šå¹³æ—¶ç»å¸¸ä½¿ç”¨ç½‘é¡µå‰ªæŠ¥æ¥åšä¸€äº›è®°å½•ï¼Œä½†æ˜¯åˆ‡æ¢åˆ°obsidianåï¼Œæ²¡æœ‰å‰ªæŠ¥æœ‰äº›ä¸ä¹ æƒ¯ï¼Œäºæ˜¯æ‰¾äº†ä¸‹ç›¸å…³çš„æ’ä»¶ï¼Œå®‰è£…åè®°å½•## æ’ä»¶ä¸‹è½½ï¼š<strong>obsidianæ’ä»¶ï¼š</strong>advanced obsidian uriè¿™ä¸ªæ’ä»¶ç”¨æ¥æ§åˆ¶obsidian uriç›¸å…³æ“ä½œã€‚<strong>markdownload</strong>è¿™ä¸ªæ’ä»¶ç”¨æ¥å°†æµè§ˆå™¨ä¸­çš„å†…å®¹å‰ªåˆ‡ä¸ºmarkdownæ ¼å¼ã€‚## å®‰è£…é…ç½®obsidianä¸­çš„advanced obsidian uriæ’ä»¶èƒ½ä¸€é”®å®‰è£…ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ï¼Œä¸»è¦æ˜¯chromeä¸­markdownloadæ’ä»¶çš„</h2></blockquote><hr><p><strong>## èƒŒæ™¯ï¼š</strong>  </p><p>å¹³æ—¶ç»å¸¸ä½¿ç”¨ç½‘é¡µå‰ªæŠ¥æ¥åšä¸€äº›è®°å½•ï¼Œä½†æ˜¯åˆ‡æ¢åˆ°obsidianåï¼Œæ²¡æœ‰å‰ªæŠ¥æœ‰äº›ä¸ä¹ æƒ¯ï¼Œäºæ˜¯æ‰¾äº†ä¸‹ç›¸å…³çš„æ’ä»¶ï¼Œå®‰è£…åè®°å½•</p><p><strong>## æ’ä»¶ä¸‹è½½ï¼š</strong></p><p><strong>**obsidianæ’ä»¶ï¼š**</strong></p><p>advanced obsidian uri</p><p>è¿™ä¸ªæ’ä»¶ç”¨æ¥æ§åˆ¶obsidian uriç›¸å…³æ“ä½œã€‚</p><p><img src="https://i0.hdslb.com/bfs/article/157fe16638857a03442126c65b7039507f55b83e.png@1256w_1142h_!web-article-pic.avif"></p><p><strong>**markdownload**</strong>  </p><p>è¿™ä¸ªæ’ä»¶ç”¨æ¥å°†æµè§ˆå™¨ä¸­çš„å†…å®¹å‰ªåˆ‡ä¸ºmarkdownæ ¼å¼ã€‚</p><p><img src="https://i0.hdslb.com/bfs/article/f40d3bd258ea67975bece878517d8ec3ea313ab3.png@1256w_1144h_!web-article-pic.avif"></p><p><strong>## å®‰è£…é…ç½®</strong>  </p><p>obsidianä¸­çš„advanced obsidian uriæ’ä»¶èƒ½ä¸€é”®å®‰è£…ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ï¼Œä¸»è¦æ˜¯chromeä¸­markdownloadæ’ä»¶çš„é…ç½®ã€‚</p><p>åœ¨chrome æ‰©å±•ç¨‹åºä¸­æ‰©å±•ç¨‹åºé€‰é¡¹é…ç½®markdownloadæ’ä»¶è®¾ç½®ã€‚</p><p><img src="https://i0.hdslb.com/bfs/article/2b45f85d31b050823b7b5595e80aef10fabe1703.png@1256w_894h_!web-article-pic.avif"></p><p>é…ç½®ä¸­éœ€è¦æ›´æ”¹çš„ä¸»è¦æ˜¯ä¸¤ä¸ªåœ°æ–¹ï¼š</p><p>1ã€å¼€å¯chrome markdownloadæ’ä»¶ä¸obsidianè”åŠ¨åŠŸèƒ½ï¼Œé…ç½®ç½‘é¡µå‰ªåˆ‡ä¿å­˜ä½ç½®ï¼Œè¿™æ˜¯æ ¸å¿ƒï¼Œå¦åˆ™ä¸èƒ½è‡ªåŠ¨ä¿å­˜åˆ°obsidianä¸­ã€‚</p><p><img src="https://i0.hdslb.com/bfs/article/218db792a3e7b644cad53833f2c9f1e259a201cf.png@1256w_402h_!web-article-pic.avif"></p><p>2ã€å¼€å¯å‰ªåˆ‡æ¨¡æ¿ï¼Œå¼€å¯åä¼šæœ‰ä¸€ä¸ªå›ºå®šæ ¼å¼ï¼Œè·Ÿå†™ä»£ç æ—¶é…ç½®çš„ä»£ç æ–‡æ¡£æ ¼å¼ä¸€æ ·ã€‚ï¼ˆæˆ‘ä¸ªäººå–œæ¬¢é…ä¸Šï¼‰</p><p><img src="https://i0.hdslb.com/bfs/article/2fdf96490624ffbde9e02fd324ae507977020b44.png@1256w_296h_!web-article-pic.avif"></p><p>å…¶ä»–çš„æ¯”å¦‚èƒŒæ™¯ä»€ä¹ˆçš„å°±çœ‹ä¸ªäººå–œå¥½å»è°ƒæ•´ä¸‹ã€‚</p><p><strong>## å®æ–½æ•ˆæœ</strong></p><p>**å…¨ç½‘é¡µå‰ªåˆ‡**ï¼šåœ¨è¦å‰ªåˆ‡çš„é¡µé¢ä¸Šå³é”®-ã€‹markdownloadæ’ä»¶-ã€‹send tab to obsidian</p><p><img src="https://i0.hdslb.com/bfs/article/9664d263fda3f792c495434ab6da496df10e697a.png@1256w_1308h_!web-article-pic.avif"></p><p>**éƒ¨åˆ†æ–‡å­—å‰ªåˆ‡**:é€‰ä¸­è¦å‰ªåˆ‡çš„æ–‡å­—ï¼Œå³é”®-ã€‹markdownloadæ’ä»¶-ã€‹send textÂ  selection to obsidian</p><p><img src="https://i0.hdslb.com/bfs/article/c7040b64297097656d88a088b7cf1f611374267f.png@1256w_1062h_!web-article-pic.avif"><br>{<br>  â€œbackmatterâ€: â€œâ€,<br>  â€œbulletListMarkerâ€: â€œ-â€œ,<br>  â€œcodeBlockStyleâ€: â€œfencedâ€,<br>  â€œcontextMenusâ€: true,<br>  â€œdisallowedCharsâ€: â€œ[]#^â€,<br>  â€œdownloadImagesâ€: true,<br>  â€œdownloadModeâ€: â€œdownloadsApiâ€,<br>  â€œemDelimiterâ€: â€œ<em>â€œ,<br>  â€œfenceâ€: â€œ&#96;&#96;&#96;â€,<br>  â€œfrontmatterâ€: â€œâ€”\ncreated: {date:YYYY-MM-DDTHH:mm:ss} (UTC {date:Z})\ntags: [{keywords},ç½‘ç»œæœå¯»]\nsource: {baseURI}\nauthor: {byline}\ntitle: {pageTitle}\nâ€”\n\n# {pageTitle}\n\n&gt; ## Excerpt\n&gt; {excerpt}\n\nâ€”â€œ,<br>  â€œheadingStyleâ€: â€œatxâ€,<br>  â€œhrâ€: â€œ</em>__â€,<br>  â€œimagePrefixâ€: â€œ{pageTitle}&#x2F;â€œ,<br>  â€œimageRefStyleâ€: â€œinlinedâ€,<br>  â€œimageStyleâ€: â€œbase64â€,<br>  â€œincludeTemplateâ€: true,<br>  â€œlinkReferenceStyleâ€: â€œfullâ€,<br>  â€œlinkStyleâ€: â€œinlinedâ€,<br>  â€œmdClipsFolderâ€: null,<br>  â€œobsidianFolderâ€: â€œä½¿ç”¨æ•™ç¨‹â€,<br>  â€œobsidianIntegrationâ€: true,<br>  â€œobsidianVaultâ€: â€œobsidianâ€,<br>  â€œsaveAsâ€: false,<br>  â€œstrongDelimiterâ€: â€œ**â€,<br>  â€œtitleâ€: â€œ{pageTitle}â€,<br>  â€œturndownEscapeâ€: true<br>}</p>]]></content>
    
    
    
    <tags>
      
      <tag>MARKDOWN</tag>
      
      <tag>æ’ä»¶ä¸‹è½½</tag>
      
      <tag>æ’ä»¶è®¾ç½®</tag>
      
      <tag>CHROME</tag>
      
      <tag>å†™ä»£ç </tag>
      
      <tag>ä¸ªäººå–œå¥½</tag>
      
      <tag>æµè§ˆå™¨</tag>
      
      <tag>ç½‘ç»œæœå¯»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kafkaä¸¤ç§é›†ç¾¤è¯¦è§£å’Œæ­å»ºæ•™ç¨‹</title>
    <link href="/article/d6131b35.html"/>
    <url>/article/d6131b35.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" />Kafkaæ˜¯ä¸€ä¸ªèƒ½å¤Ÿæ”¯æŒé«˜å¹¶å‘ä»¥åŠæµå¼æ¶ˆæ¯å¤„ç†çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¹¶ä¸”Kafkaå¤©ç”Ÿå°±æ˜¯æ”¯æŒé›†ç¾¤çš„ï¼Œä»Šå¤©å°±ä¸»è¦æ¥ä»‹ç»ä¸€ä¸‹å¦‚ä½•æ­å»ºKafkaé›†ç¾¤ã€‚<p>Kafkaç›®å‰æ”¯æŒä½¿ç”¨Zookeeperæ¨¡å¼æ­å»ºé›†ç¾¤ä»¥åŠKRaftæ¨¡å¼ï¼ˆå³æ— Zookeeperï¼‰æ¨¡å¼è¿™ä¸¤ç§æ¨¡å¼æ­å»ºé›†ç¾¤ï¼Œè¿™ä¸¤ç§æ¨¡å¼å„æœ‰å„çš„å¥½å¤„ï¼Œä»Šå¤©å°±æ¥åˆ†åˆ«ä»‹ç»ä¸€ä¸‹è¿™ä¸¤ç§æ–¹å¼ã€‚</p><h2 id="1ï¼ŒKafkaé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ç±»å‹"><a href="#1ï¼ŒKafkaé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ç±»å‹" class="headerlink" title="1ï¼ŒKafkaé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ç±»å‹"></a>1ï¼ŒKafkaé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ç±»å‹</h2><p>æˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€ä¸‹ï¼Œä¸€ä¸ªKafkaé›†ç¾¤æ˜¯ç”±ä¸‹åˆ—å‡ ç§ç±»å‹çš„èŠ‚ç‚¹æ„æˆçš„ï¼Œå®ƒä»¬å……å½“ç€ä¸åŒçš„ä½œç”¨ï¼š</p><ul><li><strong><code>Broker</code>èŠ‚ç‚¹</strong>ï¼šå³<strong>ä»£ç†èŠ‚ç‚¹</strong>ï¼Œæ˜¯Kafkaä¸­çš„å·¥ä½œèŠ‚ç‚¹ï¼Œå……å½“æ¶ˆæ¯é˜Ÿåˆ—çš„è§’è‰²ï¼Œ<strong>è´Ÿè´£å‚¨å­˜å’Œå¤„ç†æ¶ˆæ¯</strong>ï¼Œæ¯ä¸ªBrokeréƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„KafkaæœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œï¼Œé™¤æ­¤ä¹‹å¤–Brokerè¿˜è´Ÿè´£åˆ†åŒºï¼ˆpartitionï¼‰çš„ç®¡ç†ï¼Œå°†ä¸»é¢˜ï¼ˆtopicï¼‰åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œå¹¶åˆ†å¸ƒåœ¨é›†ç¾¤çš„ä¸åŒBrokerä¸Š</li><li><strong><code>Controller</code>èŠ‚ç‚¹</strong>ï¼šå³<strong>æ§åˆ¶å™¨èŠ‚ç‚¹</strong>ï¼Œæ˜¯é›†ç¾¤ä¸­çš„ç‰¹æ®ŠèŠ‚ç‚¹ï¼Œè´Ÿè´£å‚¨å­˜å’Œç®¡ç†æ•´ä¸ª<strong>é›†ç¾¤å…ƒæ•°æ®</strong>å’Œ<strong>çŠ¶æ€</strong>ï¼Œå®ƒèƒ½å¤Ÿç›‘æ§æ•´ä¸ªé›†ç¾¤ä¸­çš„Brokerï¼Œåœ¨éœ€è¦æ—¶è¿˜èƒ½å¤Ÿè¿›è¡Œå¹³è¡¡æ“ä½œ</li><li><strong>æ··åˆèŠ‚ç‚¹</strong>ï¼šå³åŒæ—¶æ‹…ä»»Brokerå’ŒControllerèŠ‚ç‚¹è§’è‰²çš„èŠ‚ç‚¹</li></ul><h2 id="2ï¼Œä¸¤ç§æ¨¡å¼é›†ç¾¤çš„æ­å»ºæ–¹å¼"><a href="#2ï¼Œä¸¤ç§æ¨¡å¼é›†ç¾¤çš„æ­å»ºæ–¹å¼" class="headerlink" title="2ï¼Œä¸¤ç§æ¨¡å¼é›†ç¾¤çš„æ­å»ºæ–¹å¼"></a>2ï¼Œä¸¤ç§æ¨¡å¼é›†ç¾¤çš„æ­å»ºæ–¹å¼</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±æ¥ä»‹ç»ä¸€ä¸‹ä¸¤ç§æ¨¡å¼çš„é›†ç¾¤æ¶æ„å’Œæ­å»ºæ–¹å¼ï¼Œå³Zookeeperæ¨¡å¼é›†ç¾¤å’ŒKRaftæ¨¡å¼é›†ç¾¤ã€‚</p><h3 id="1-Zookeeperæ¨¡å¼é›†ç¾¤"><a href="#1-Zookeeperæ¨¡å¼é›†ç¾¤" class="headerlink" title="(1) Zookeeperæ¨¡å¼é›†ç¾¤"></a>(1) Zookeeperæ¨¡å¼é›†ç¾¤</h3><p>è¿™æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•ï¼Œç›¸å¯¹â€œä¼ ç»Ÿâ€çš„æ­å»ºæ–¹å¼äº†ï¼åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªKafkaèŠ‚ç‚¹éƒ½æ˜¯ä¾èµ–äºZookeeperçš„ï¼Œä½¿ç”¨Zookeeperå­˜å‚¨é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å…ƒæ•°æ®ã€‚</p><p>åªè¦æ‰€æœ‰çš„KafkaèŠ‚ç‚¹è¿æ¥åˆ°<strong>åŒä¸€ä¸ªZookeeperä¸Šé¢</strong>ï¼ˆæˆ–è€…åŒä¸€ä¸ªZookeeperé›†ç¾¤ï¼‰ï¼Œ<strong>è¿™äº›KafkaèŠ‚ç‚¹å°±æ„æˆäº†ä¸€ä¸ªé›†ç¾¤</strong>ã€‚æ‰€ä»¥è¯´å°±ç®—æ˜¯åªæœ‰ä¸€ä¸ªKafkaèŠ‚ç‚¹åœ¨è¿è¡Œï¼Œè¿™ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥ç§°ä½œä¸€ä¸ªé›†ç¾¤ã€‚</p><p>åœ¨Zookeeperæ¨¡å¼é›†ç¾¤ä¸­ï¼ŒZookeeperèŠ‚ç‚¹ï¼ˆæˆ–è€…é›†ç¾¤ï¼‰å°±å……å½“äº†Controllerçš„è§’è‰²ï¼Œè€Œæ‰€æœ‰çš„KafkaèŠ‚ç‚¹å°±å……å½“ç€Brokerçš„è§’è‰²ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b59e81dddf064aa6af65004ab79fb081~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p><p>ä¸‹é¢å°±æ¥ä»‹ç»ä¸€ä¸‹æ­å»ºè¿‡ç¨‹ï¼Œè¿™é‡Œæˆ‘åœ¨4å°Linuxè™šæ‹Ÿæœºä¸Šåˆ†åˆ«è¿è¡ŒZookeeperå’ŒKafkaæ¥æ¨¡æ‹Ÿä¸€ä¸ªé›†ç¾¤ï¼Œä¸€å…±ä¸€ä¸ªZookeeperèŠ‚ç‚¹å’Œä¸‰ä¸ªKafkaèŠ‚ç‚¹æ„æˆï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr><th align="center">èŠ‚ç‚¹å</th><th align="center">åœ°å€å’Œç«¯å£</th></tr></thead><tbody><tr><td align="center">ZookeeperèŠ‚ç‚¹</td><td align="center"><code>zookeeper:2181</code></td></tr><tr><td align="center">KafkaèŠ‚ç‚¹1</td><td align="center"><code>kafka1:9092</code></td></tr><tr><td align="center">KafkaèŠ‚ç‚¹2</td><td align="center"><code>kafka2:9092</code></td></tr><tr><td align="center">KafkaèŠ‚ç‚¹3</td><td align="center"><code>kafka3:9092</code></td></tr></tbody></table><p>ä¸Šè¿°åœ°å€ä¾‹å¦‚<code>kafka1</code>ç­‰ç­‰ï¼Œæ˜¯é€šè¿‡ä¿®æ”¹è™šæ‹Ÿæœºçš„ä¸»æœºåï¼ˆhostnameï¼‰å®ç°çš„ï¼Œè¿™æ ·è™šæ‹Ÿæœºä¹‹é—´å¯ä»¥ç›´æ¥é€šè¿‡è¿™äº›ä¸»æœºåç›¸äº’è®¿é—®ï¼Œ<strong>è¿™ä¸ªä¸»æœºåæˆ‘ä»¬å°±å¯ä»¥è§†ä½œå®é™…åœ¨æœåŠ¡å™¨ä¸Šé¢æ­å»ºæ—¶ï¼ŒæœåŠ¡å™¨çš„å¤–ç½‘åœ°å€æˆ–è€…åŸŸå</strong>ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°å¦‚ä½•ä¿®æ”¹è™šæ‹Ÿæœºçš„ä¸»æœºåäº†ï¼Œéœ€è¦ä¿è¯ä¸Šè¿°æ‰€æœ‰è™šæ‹Ÿæœºåœ¨ä¸€ä¸ªè™šæ‹Ÿæœºç½‘æ®µä¸­å¹¶ä¸”èƒ½å¤Ÿäº’ç›¸<code>ping</code>é€šï¼Œå³ä¸Šè¿°æ‰€æœ‰è™šæ‹Ÿæœºéœ€è¦ä¸¤ä¸¤ä¹‹é—´å¯ä»¥é€šè¿‡ç½‘ç»œäº’ç›¸è®¿é—®ã€‚</p><p>è¿è¡ŒKafkaå’ŒZookeeperéƒ½éœ€è¦Java 8åŠå…¶ä»¥ä¸Šè¿è¡Œç¯å¢ƒï¼Œå¤§å®¶è¦é¦–å…ˆåœ¨è™šæ‹Ÿæœºä¸­å®‰è£…å¹¶é…ç½®å¥½ã€‚</p><h4 id="â‘ -æ­å»ºZookeeper"><a href="#â‘ -æ­å»ºZookeeper" class="headerlink" title="â‘  æ­å»ºZookeeper"></a>â‘  æ­å»ºZookeeper</h4><p>é¦–å…ˆæˆ‘ä»¬è¦è¿è¡Œèµ·ä¸€ä¸ªZookeeperèŠ‚ç‚¹ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ZookeeperèŠ‚ç‚¹å¦‚ä½•æ­å»ºäº†ï¼æ­å»ºå¯ä»¥æŸ¥çœ‹<a href="https://link.juejin.cn/?target=https://zookeeper.apache.org/doc/r3.8.1/zookeeperStarted.html" title="https://zookeeper.apache.org/doc/r3.8.1/zookeeperStarted.html">å®˜æ–¹æ–‡æ¡£</a>ï¼Œæˆ–è€…ä½¿ç”¨<a href="https://link.juejin.cn/?target=https://hub.docker.com/_/zookeeper" title="https://hub.docker.com/_/zookeeper">Dockerçš„æ–¹å¼</a>æ­å»ºã€‚</p><p>æ­å»ºå®Œæˆå¹¶è¿è¡ŒZookeeperä¹‹åï¼Œæˆ‘ä»¬ä¼šæŠŠæ‰€æœ‰çš„KafkaèŠ‚ç‚¹éƒ½é…ç½®åˆ°è¿™ä¸€ä¸ªZookeeperèŠ‚ç‚¹ä¸Šã€‚</p><h4 id="â‘¡-é…ç½®å¹¶è¿è¡Œæ‰€æœ‰KafkaèŠ‚ç‚¹"><a href="#â‘¡-é…ç½®å¹¶è¿è¡Œæ‰€æœ‰KafkaèŠ‚ç‚¹" class="headerlink" title="â‘¡ é…ç½®å¹¶è¿è¡Œæ‰€æœ‰KafkaèŠ‚ç‚¹"></a>â‘¡ é…ç½®å¹¶è¿è¡Œæ‰€æœ‰KafkaèŠ‚ç‚¹</h4><p>é¦–å…ˆå»<a href="https://link.juejin.cn/?target=https://kafka.apache.org/downloads" title="https://kafka.apache.org/downloads">Kafkaå®˜ç½‘ä¸‹è½½</a>æœ€æ–°ç‰ˆå¹¶è§£å‹ï¼Œç„¶åå°†è§£å‹å‡ºæ¥çš„Kafka<strong>åˆ†åˆ«å¤åˆ¶åˆ°ä¸‰å°è™šæ‹Ÿæœºä¸­</strong>ã€‚</p><p>ç„¶åä¿®æ”¹<strong>æ¯å°è™šæ‹Ÿæœº</strong>çš„Kafkaç›®å½•ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶ä½äºè§£å‹çš„Kafkaæ–‡ä»¶å¤¹ä¸­çš„<code>config/server.properties</code>ï¼Œä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¹¶æ‰¾åˆ°ä¸‹åˆ—é…ç½®é¡¹è¿›è¡Œé…ç½®ï¼š</p><ul><li><code>broker.id</code> è¡¨ç¤ºæ¯ä¸ªèŠ‚ç‚¹çš„<code>id</code>ï¼Œ<strong>æ¯ä¸ªèŠ‚ç‚¹éœ€è¦è®¾ç½®ä¸ºä¸ä¸€æ ·çš„æ•´æ•°</strong>ï¼Œæˆ‘è¿™é‡Œåˆ†åˆ«è®¾ç½®ä¸º<code>1</code>ï¼Œ<code>2</code>å’Œ<code>3</code></li><li><code>zookeeper.connect</code> è¡¨ç¤º<strong>è¦ä½¿ç”¨çš„Zookeeperçš„åœ°å€å’Œç«¯å£</strong>ï¼Œæˆ‘è¿™é‡Œéƒ½é…ç½®ä¸º<code>zookeeper:2181</code></li><li><code>advertised.listeners</code> è¡¨ç¤º<strong>è¿™ä¸ªKafkaèŠ‚ç‚¹çš„å¤–ç½‘åœ°å€</strong>ï¼Œè¿™é‡Œåˆ†åˆ«é…ç½®ä¸º<code>PLAINTEXT://kafka1:9092</code>ï¼Œ<code>PLAINTEXT://kafka2:9092</code>å’Œ<code>PLAINTEXT://kafka3:9092</code>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªé…ç½®é¡¹å¿…é¡»è¦é…ç½®ä¸ºå…¶æ‰€åœ¨æœåŠ¡å™¨çš„å¤–ç½‘åœ°å€ï¼Œå¦‚æœè¯´ä½ æ˜¯åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šé¢é…ç½®Kafkaå¹¶è¦é€šè¿‡å¤–ç½‘è®¿é—®ï¼Œè¿™ä¸ªé…ç½®å°±éœ€è¦é…ç½®ä¸ºæœåŠ¡å™¨å¤–ç½‘åœ°å€ï¼ˆåŸŸåï¼‰ï¼Œå¹¶ä¸”éƒ½ä»¥<code>PLAINTEXT://</code>å¼€å¤´</li></ul><p>æ³¨æ„ä¸Šè¿°<code>advertised.listeners</code>è¿™ä¸ªé…ç½®é¡¹é»˜è®¤æƒ…å†µä¸‹æ˜¯è¢«æ³¨é‡Šæ‰äº†çš„ï¼Œå¤§å®¶éœ€è¦å»ä»”ç»†æ‰¾ä¸€ä¸‹å¹¶å»æ‰æ³¨é‡Šï¼ˆå¼€å¤´çš„<code>#</code>ï¼‰ç„¶åå†è¿›è¡Œé…ç½®ã€‚</p><p>ä¸‰å°è™šæ‹Ÿæœºé…ç½®å®Œæˆåï¼Œåˆ†åˆ«ä½¿ç”¨ç»ˆç«¯è¿›å…¥åˆ°Kafkaç›®å½•ä¸‹å¹¶å¯åŠ¨ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š</p><p>bash</p><p>å¤åˆ¶ä»£ç </p><p><code>bin/kafka-server-start.sh config/server.properties</code></p><p>åœ¨ä¸Šè¿°ä¸‰å°è™šæ‹Ÿæœºä¸Šé¢éƒ½é€šè¿‡è¿™ä¸ªå‘½ä»¤å¯åŠ¨Kafkaï¼Œå¦‚å›¾åˆ™å¯åŠ¨æˆåŠŸï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ea9ecb836134fd59d4ec003f01c9267~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p><p>åˆ°æ­¤ï¼Œæ•´ä¸ªé›†ç¾¤å°±æ­å»ºå®Œæˆäº†ï¼å¤§å®¶éœ€è¦ä¿è¯ä¸Šè¿°ä¸‰å°è™šæ‹Ÿæœºä¸­çš„ç»ˆç«¯ä¸è¢«å…³é—­ã€‚</p><h4 id="â‘¢-åˆ›å»ºè¯é¢˜æµ‹è¯•"><a href="#â‘¢-åˆ›å»ºè¯é¢˜æµ‹è¯•" class="headerlink" title="â‘¢ åˆ›å»ºè¯é¢˜æµ‹è¯•"></a>â‘¢ åˆ›å»ºè¯é¢˜æµ‹è¯•</h4><p>æˆ‘ä»¬å…ˆåœ¨<code>kafka1</code>çš„è™šæ‹Ÿæœºä¸Šé¢å†å¼€ä¸€ä¸ªç»ˆç«¯å¹¶è¿›å…¥Kafkaç›®å½•ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤åˆ›å»ºTopicï¼š</p><p>bash</p><p>å¤åˆ¶ä»£ç </p><p><code>bin/kafka-topics.sh --create --topic my-topic --bootstrap-server localhost:9092</code></p><p>ç„¶åå»<code>kafka2</code>çš„è™šæ‹Ÿæœºä¸Šé¢å†å¼€ä¸€ä¸ªç»ˆç«¯å¹¶è¿›å…¥Kafkaç›®å½•ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤åˆ—å‡ºTopicï¼š</p><p>bash</p><p>å¤åˆ¶ä»£ç </p><p><code>bin/kafka-topics.sh --list --bootstrap-server localhost:9092</code></p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/309a0e640f974307bb760ffd82963821~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p><p>å¯è§æˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºäº†è¯é¢˜ï¼Œä½†æ˜¯åœ¨ç¬¬äºŒä¸ªèŠ‚ç‚¹ä¸Šä»ç„¶å¯ä»¥è·å–è¿™ä¸ªè¯é¢˜ï¼Œè¯´æ˜é›†ç¾¤åˆ›å»ºæˆåŠŸï¼Œæ•°æ®åœ¨é›†ç¾¤ä¹‹é—´å¯ä»¥å…±äº«ã€‚</p><h3 id="2-KRaftæ¨¡å¼é›†ç¾¤"><a href="#2-KRaftæ¨¡å¼é›†ç¾¤" class="headerlink" title="(2) KRaftæ¨¡å¼é›†ç¾¤"></a>(2) KRaftæ¨¡å¼é›†ç¾¤</h3><p>åœ¨ä¸Šè¿°ä¼ ç»Ÿæ–¹æ¡ˆä¸­ï¼ŒKafkaéœ€è¦ä¾èµ–Zookeeperå®Œæˆå…ƒæ•°æ®å­˜æ”¾å’Œå…±äº«ï¼Œè¿™æ ·ä¹Ÿå°±æš´éœ²å‡ºäº†ä¸€äº›é—®é¢˜ï¼š</p><ul><li>æ­å»ºKafkaé›†ç¾¤æ—¶è¿˜éœ€è¦é¢å¤–æ­å»ºZookeeperï¼Œå¢åŠ äº†è¿ç»´æˆæœ¬</li><li>Zookeeperæ˜¯å¼ºä¸€è‡´æ€§çš„ç»„ä»¶ï¼ˆç¬¦åˆCPç†è®ºï¼‰ï¼Œå¦‚æœé›†ç¾¤ä¸­æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå¿…é¡»è¦ç­‰åˆ°å…¶å®ƒèŠ‚ç‚¹éƒ½åŒæ­¥ï¼Œè‡³å°‘è¶…è¿‡ä¸€åŠåŒæ­¥å®Œæˆï¼Œè¿™æ ·èŠ‚ç‚¹æ•°å¤šæ€§èƒ½å·®</li></ul><p>é‚£ä¹ˆKRaftæ¨¡å¼æ˜¯æ–°ç‰ˆæœ¬Kafkaä¸­æ¨å‡ºçš„é›†ç¾¤æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ä¸‹å°±å®Œå…¨ä¸éœ€è¦Zookeeperäº†ï¼<strong>åªéœ€è¦æ•°ä¸ªKafkaèŠ‚ç‚¹å°±å¯ä»¥ç›´æ¥æ„æˆé›†ç¾¤</strong>ï¼Œåœ¨è¿™æ—¶<strong>é›†ç¾¤ä¸­çš„KafkaèŠ‚ç‚¹æ—¢æœ‰å¯èƒ½æ˜¯ControllerèŠ‚ç‚¹ä¹Ÿå¯èƒ½æ˜¯BrokerèŠ‚ç‚¹</strong>ï¼Œåœ¨è¿™ä¸ªæ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥æ‰‹åŠ¨é…ç½®æŸä¸ªèŠ‚ç‚¹çš„è§’è‰²ï¼ˆæ˜¯Controllerè¿˜æ˜¯Brokerï¼‰ï¼Œè¿˜å¯ä»¥ä½¿å…¶åŒæ—¶æ‹…ä»»Brokerå’ŒControllerè§’è‰²ï¼ˆæ··åˆèŠ‚ç‚¹ï¼‰ã€‚</p><p>åœ¨KRaftæ¨¡å¼ä¸­ï¼Œé›†ç¾¤çš„èŠ‚ç‚¹ä¼šé€šè¿‡<strong>æŠ•ç¥¨é€‰ä¸¾</strong>çš„æ–¹å¼ï¼Œé€‰æ‹©å‡ºä¸€ä¸ªä¸»è¦çš„ControllerèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¹Ÿç§°ä½œ<strong>é¢†å¯¼è€…</strong>ï¼Œå®ƒå°†è´Ÿè´£ç»´æŠ¤æ•´ä¸ªé›†ç¾¤çš„å…ƒæ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯ï¼Œé‚£ä¹ˆå…¶å®ƒçš„ControllerèŠ‚ç‚¹æˆ–è€…æ··åˆèŠ‚ç‚¹å°±ç§°ä¹‹ä¸º<strong>è¿½éšè€…</strong>ï¼Œå®ƒä»¬ä¼šä»é¢†å¯¼è€…åŒæ­¥é›†ç¾¤å…ƒæ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯ã€‚å¦‚æœé¢†å¯¼è€…å®•æœºäº†ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹ä¼šé‡æ–°æŠ•ç¥¨é€‰ä¸¾ä¸€ä¸ªæ–°çš„é¢†å¯¼è€…ã€‚</p><p>åœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½ä¼šå‚ä¸æŠ•ç¥¨è¿‡ç¨‹ï¼Œè€Œå€™é€‰èŠ‚ç‚¹åªä¼šæ˜¯ControllerèŠ‚ç‚¹æˆ–è€…æ··åˆèŠ‚ç‚¹ï¼ˆå³BrokerèŠ‚ç‚¹ä¸ä¼šè¢«é€‰ä¸¾ä¸ºé¢†å¯¼è€…ï¼‰ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹Kafkaé›†ç¾¤ä¸­çš„BrokerèŠ‚ç‚¹å’ŒControllerèŠ‚ç‚¹é€šå¸¸ä¼šç›‘å¬ä¸åŒçš„ç«¯å£ï¼š</p><ul><li>BrokerèŠ‚ç‚¹æ˜¯Kafkaé›†ç¾¤ä¸­çš„æ•°æ®èŠ‚ç‚¹ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œå®ƒä»¬è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„æ¶ˆæ¯å’Œä¼ é€’æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªBrokerèŠ‚ç‚¹ä¼šç›‘å¬<code>9092</code>ç«¯å£ï¼Œè¯¥ç«¯å£ç”¨äºä¸å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œå®¢æˆ·ç«¯å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°è¿™ä¸ªç«¯å£ï¼Œæˆ–è€…ä»è¿™ä¸ªç«¯å£æ¥æ”¶æ¶ˆæ¯ï¼Œè¿™ä¸ªç«¯å£å¯ä»¥ç§°ä½œ<strong>å®¢æˆ·ç«¯é€šä¿¡ç«¯å£</strong></li><li>ControllerèŠ‚ç‚¹æ˜¯Kafkaé›†ç¾¤ä¸­çš„æ§åˆ¶å™¨èŠ‚ç‚¹ï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤çš„çŠ¶æ€å’Œå…ƒæ•°æ®ï¼ŒControllerèŠ‚ç‚¹ç›‘å¬çš„ç«¯å£é€šå¸¸æ˜¯<code>9093</code>ï¼Œè¯¥ç«¯å£ç”¨äºé›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹è·å–å…ƒæ•°æ®æˆ–åœ¨æ··åˆèŠ‚ç‚¹é€‰ä¸¾æ–°çš„Controlleræ—¶è¿›è¡Œé€šä¿¡ï¼Œé€šè¿‡è¯¥ç«¯å£ï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥ä¸ControllerèŠ‚ç‚¹äº¤äº’ï¼Œè·å–é›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯æˆ–å‚ä¸æ§åˆ¶å™¨çš„é€‰ä¸¾è¿‡ç¨‹ï¼Œè¿™ä¸ªç«¯å£å¯ä»¥ç§°ä½œ<strong>æ§åˆ¶å™¨ç«¯å£</strong></li><li>æ··åˆèŠ‚ç‚¹ï¼ˆå³åŒæ—¶æ‹…ä»»Brokerå’ŒControllerè§’è‰²çš„èŠ‚ç‚¹ï¼‰ä¸­ï¼Œè¿™ä¸¤ä¸ªç«¯å£éƒ½ä¼šè¢«ä½¿ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹æ··åˆèŠ‚ç‚¹å°†ç›‘å¬<code>9092</code>ç«¯å£æ¥æ”¶å’Œä¼ é€’æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ç›‘å¬<code>9093</code>ç«¯å£ç”¨äºä¸å…¶ä»–èŠ‚ç‚¹è¿›è¡Œå…ƒæ•°æ®äº¤æ¢å’Œæ§åˆ¶å™¨é€‰ä¸¾é€šä¿¡ï¼Œå¯è§æ··åˆèŠ‚ç‚¹ä¼šåŒæ—¶ä½¿ç”¨ä¸¤ä¸ªç«¯å£åˆ†åˆ«ä½œä¸º<strong>å®¢æˆ·ç«¯é€šä¿¡ç«¯å£</strong>ä¸<strong>æ§åˆ¶å™¨ç«¯å£</strong></li></ul><p>æ‰€ä»¥éœ€è¦æ ¹æ®å®é™…æƒ…å†µé…ç½®ç½‘ç»œè®¾ç½®å’Œé˜²ç«å¢™è§„åˆ™ï¼Œä»¥ç¡®ä¿Kafkaé›†ç¾¤ä¸­çš„èŠ‚ç‚¹èƒ½å¤Ÿåœ¨æ­£ç¡®çš„ç«¯å£ä¸Šè¿›è¡Œé€šä¿¡ã€‚ä¸Šè¿°æåˆ°çš„ä¸¤ç§ç«¯å£ä¹Ÿæ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œå½“ç„¶ä¸å»ºè®®ä¿®æ”¹ã€‚</p><p>åŒæ ·åœ°ï¼Œå°±ç®—æ˜¯ä½ åªæ˜¯æ­å»ºäº†ä¸€ä¸ªKafkaèŠ‚ç‚¹ï¼Œè¿™ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿä»ç„¶è¢«è§†ä¸ºä¸€ä¸ªKafkaé›†ç¾¤ï¼Œå¹¶ä¸”KRaftæ¨¡å¼ä¸‹å¦‚æœåªéœ€è¦å»ºç«‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å¿…é¡»æ˜¯æ··åˆèŠ‚ç‚¹ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7fce47477bec44e28304e28243280e4e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p><p>ä¸‹é¢åŒæ ·æ˜¯å¼€å¯ä¸‰å°è™šæ‹Ÿæœºï¼Œæ­å»ºä¸‰ä¸ªKafkaèŠ‚ç‚¹æ„æˆçš„KRaftæ¨¡å¼é›†ç¾¤å¦‚ä¸‹ï¼š</p><table><thead><tr><th align="center">èŠ‚ç‚¹å</th><th align="center">åœ°å€</th><th align="center">èŠ‚ç‚¹ç±»å‹</th><th align="center">å®¢æˆ·ç«¯é€šä¿¡ç«¯å£</th><th align="center">æ§åˆ¶å™¨ç«¯å£</th></tr></thead><tbody><tr><td align="center">KafkaèŠ‚ç‚¹1</td><td align="center"><code>kafka1</code></td><td align="center">æ··åˆèŠ‚ç‚¹</td><td align="center"><code>9092</code></td><td align="center"><code>9093</code></td></tr><tr><td align="center">KafkaèŠ‚ç‚¹2</td><td align="center"><code>kafka2</code></td><td align="center">æ··åˆèŠ‚ç‚¹</td><td align="center"><code>9092</code></td><td align="center"><code>9093</code></td></tr><tr><td align="center">KafkaèŠ‚ç‚¹3</td><td align="center"><code>kafka3</code></td><td align="center">æ··åˆèŠ‚ç‚¹</td><td align="center"><code>9092</code></td><td align="center"><code>9093</code></td></tr></tbody></table><p>è¿™é‡Œå°±ä¸å†èµ˜è¿°ä¸‹è½½Kafkaçš„è¿‡ç¨‹äº†ï¼</p><h4 id="â‘ -ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#â‘ -ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="â‘  ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>â‘  ä¿®æ”¹é…ç½®æ–‡ä»¶</h4><p>åœ¨KRaftæ¨¡å¼ä¸‹ï¼Œé…ç½®æ–‡ä»¶ä½äºKafkaç›®å½•ä¸­çš„<code>config/kraft/server.properties</code>ï¼Œä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€å¹¶æ‰¾åˆ°ä¸‹åˆ—é…ç½®ä»¥ä¿®æ”¹ï¼š</p><ul><li><code>node.id</code> è¡¨ç¤ºè¿™ä¸ª**èŠ‚ç‚¹çš„<code>id</code>**ï¼Œä¸€ä¸ªé›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹<code>id</code>ä¸èƒ½é‡å¤ï¼Œéœ€è¦æ˜¯ä¸å°äº<code>1</code>çš„æ•´æ•°ï¼Œè¿™é‡Œä¸‰å°è™šæ‹Ÿæœºçš„é…ç½®åˆ†åˆ«ä¸º<code>1</code>ï¼Œ<code>2</code>å’Œ<code>3</code>ï¼ˆç±»ä¼¼ä¸Šè¿°Zookeeperçš„<code>broker.id</code>é…ç½®ï¼‰</li><li><code>controller.quorum.voters</code> è®¾å®š<strong>æŠ•ç¥¨è€…åˆ—è¡¨</strong>ï¼Œå³éœ€è¦<strong>é…ç½®æ‰€æœ‰çš„ControllerèŠ‚ç‚¹<code>id</code>åŠå…¶åœ°å€ç«¯å£</strong>ï¼Œé…ç½®æ ¼å¼ä¸º<code>èŠ‚ç‚¹1çš„id@èŠ‚ç‚¹1åœ°å€:èŠ‚ç‚¹1ç«¯å£,èŠ‚ç‚¹2çš„id@èŠ‚ç‚¹2åœ°å€:èŠ‚ç‚¹2ç«¯å£,èŠ‚ç‚¹3çš„id@èŠ‚ç‚¹3åœ°å€:èŠ‚ç‚¹3ç«¯å£...</code>ï¼Œè¿™é‡Œçš„ç«¯å£éœ€è¦æ˜¯<strong>æ§åˆ¶å™¨ç«¯å£</strong>ï¼Œé»˜è®¤éƒ½æ˜¯<code>9093</code>ï¼Œä¸Šé¢ä¹Ÿæåˆ°è¿‡äº†ï¼Œé»˜è®¤ä¸éœ€è¦ä¿®æ”¹ï¼Œæˆ‘è¿™é‡Œä¸‰å°è™šæ‹Ÿæœºçš„éƒ½é…ç½®ä¸º<code>1@kafka1:9093,2@kafka2:9093,3@kafka3:9093</code>ï¼ˆå®é™…åœ¨æœåŠ¡å™¨ä¸Šæ­å»ºæ—¶æ›¿æ¢ä¸ºæœåŠ¡å™¨çš„å¤–ç½‘åœ°å€æˆ–è€…åŸŸåï¼‰</li><li><code>advertised.listeners</code> è¡¨ç¤º<strong>è¿™ä¸ªKafkaèŠ‚ç‚¹çš„å¤–ç½‘åœ°å€</strong>ï¼Œè¿™é‡Œåˆ†åˆ«é…ç½®ä¸º<code>PLAINTEXT://kafka1:9092</code>ï¼Œ<code>PLAINTEXT://kafka2:9092</code>å’Œ<code>PLAINTEXT://kafka3:9092</code>ï¼ˆå’Œä¸Šè¿°Zookeeperæ¨¡å¼ä¸­çš„ä¸€æ ·ï¼Œå®é™…åœ¨æœåŠ¡å™¨ä¸Šæ­å»ºæ—¶æ›¿æ¢ä¸ºæœåŠ¡å™¨çš„å¤–ç½‘åœ°å€æˆ–è€…åŸŸåï¼‰</li></ul><p>ä¸Šè¿°æ˜¯å¿…é¡»è¦è¿›è¡Œé…ç½®çš„ï¼Œè¿˜æœ‰ä¸‹é¢é…ç½®æ˜¯å¯ä»¥é€‰æ‹©æ€§é…ç½®çš„ï¼š</p><ul><li><code>process.roles</code> è¡¨ç¤ºè®¾å®šè¿™ä¸ª<strong>èŠ‚ç‚¹çš„ç±»å‹</strong>ï¼Œè®¾å®šä¸º<code>broker</code>è¡¨ç¤ºè®¾å®šè¿™ä¸ªèŠ‚ç‚¹ä¸ºBrokerèŠ‚ç‚¹ï¼ŒåŒæ ·åœ°è®¾å®š<code>controller</code>è¡¨ç¤ºè®¾å®šä¸ºControllerèŠ‚ç‚¹ï¼Œé»˜è®¤æ˜¯<code>broker,controller</code>è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹ä¼šè‡ªåŠ¨åˆ‡æ¢èŠ‚ç‚¹ç±»å‹ï¼Œè¿™é‡Œå…ˆä¿æŒé»˜è®¤ä¸å˜ï¼Œä¸‹é¢å†æ¥è¯¦ç»†è®¨è®º</li></ul><h4 id="â‘¡-ç”Ÿæˆé›†ç¾¤IDå¹¶ä½¿ç”¨é›†ç¾¤IDæ ¼å¼åŒ–æ•°æ®ç›®å½•"><a href="#â‘¡-ç”Ÿæˆé›†ç¾¤IDå¹¶ä½¿ç”¨é›†ç¾¤IDæ ¼å¼åŒ–æ•°æ®ç›®å½•" class="headerlink" title="â‘¡ ç”Ÿæˆé›†ç¾¤IDå¹¶ä½¿ç”¨é›†ç¾¤IDæ ¼å¼åŒ–æ•°æ®ç›®å½•"></a>â‘¡ ç”Ÿæˆé›†ç¾¤IDå¹¶ä½¿ç”¨é›†ç¾¤IDæ ¼å¼åŒ–æ•°æ®ç›®å½•</h4><p>åœ¨KRaftæ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªé›†ç¾¤éœ€è¦è®¾å®šä¸€ä¸ª<code>id</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå¸¦çš„å‘½ä»¤ç”Ÿæˆï¼Œå…ˆè¿›å…¥ä¸Šè¿°ä»»æ„ä¸€å°è™šæ‹Ÿæœºå¹¶ä½¿ç”¨ç»ˆç«¯è¿›å…¥Kafkaç›®å½•ä¸­ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ç”Ÿæˆä¸€ä¸ªUUIDï¼š</p><p>arduino</p><p>å¤åˆ¶ä»£ç </p><p><code>bin/kafka-storage.sh random-uuid</code></p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2db785f21f7041f597aa1c70088f828a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p><p>æˆ‘ä»¬è¿™é‡Œè®°å½•ä¸‹è¿™ä¸ªIDä»¥å¤‡ç”¨ã€‚</p><blockquote><p>è¿™ä¸ªé›†ç¾¤IDäº‹å®ä¸Šæ˜¯ä¸€ä¸ªé•¿åº¦16ä½çš„å­—ç¬¦ä¸²é€šè¿‡Base64ç¼–ç åå¾—æ¥çš„ï¼Œå› æ­¤ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ï¼Œç›´æ¥è‡ªå®šä¹‰ä¸€ä¸ª16ä½é•¿åº¦çš„çº¯è‹±æ–‡å’Œæ•°å­—ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œç„¶åå°†è¿™ä¸ªå­—ç¬¦ä¸²ç¼–ç ä¸ºBase64æ ¼å¼ä½œä¸ºè¿™ä¸ªé›†ç¾¤IDä¹Ÿå¯ä»¥ã€‚å¯ä»¥ä½¿ç”¨<a href="https://link.juejin.cn/?target=https://c.runoob.com/front-end/693/" title="https://c.runoob.com/front-end/693/">èœé¸Ÿå·¥å…·</a>ä¸­çš„åœ¨çº¿Base64ç¼–ç å·¥å…·ã€‚</p></blockquote><p>ç„¶ååœ¨ä¸Šè¿°ä¸‰å°è™šæ‹Ÿæœºä¸­ï¼Œéƒ½ä½¿ç”¨ç»ˆç«¯è¿›å…¥Kafkaç›®å½•åï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š</p><p>bash</p><p>å¤åˆ¶ä»£ç </p><p><code>bin/kafka-storage.sh format -t ç”Ÿæˆçš„é›†ç¾¤ID -c config/kraft/server.properties</code></p><p>è¿™æ ·ï¼Œä¸‰ä¸ªKafkaèŠ‚ç‚¹éƒ½ä½¿ç”¨äº†è¿™ä¸€ä¸ªIDå®Œæˆäº†é›†ç¾¤å…ƒæ•°æ®é…ç½®ï¼Œè¡¨ç¤ºè¿™ä¸‰ä¸ªKafkaèŠ‚ç‚¹æ„æˆä¸€ä¸ªé›†ç¾¤ã€‚</p><h4 id="â‘¢-å¯åŠ¨Kafka"><a href="#â‘¢-å¯åŠ¨Kafka" class="headerlink" title="â‘¢ å¯åŠ¨Kafka"></a>â‘¢ å¯åŠ¨Kafka</h4><p>åŒæ ·åœ°ï¼Œåœ¨ä¸‰å°è™šæ‹Ÿæœºä¸­ï¼Œéƒ½ä½¿ç”¨ç»ˆç«¯è¿›å…¥Kafkaç›®å½•åï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š</p><p>bash</p><p>å¤åˆ¶ä»£ç </p><p><code>bin/kafka-server-start.sh config/kraft/server.properties</code></p><p>ä¸‰å°è™šæ‹Ÿæœºå…¨éƒ¨å¯åŠ¨åï¼Œè¿™ä¸ªé›†ç¾¤æ‰å¯åŠ¨å®Œæ¯•ã€‚</p><h4 id="â‘£-åˆ›å»ºè¯é¢˜æµ‹è¯•"><a href="#â‘£-åˆ›å»ºè¯é¢˜æµ‹è¯•" class="headerlink" title="â‘£ åˆ›å»ºè¯é¢˜æµ‹è¯•"></a>â‘£ åˆ›å»ºè¯é¢˜æµ‹è¯•</h4><p>åŒæ ·åœ°ï¼Œç°åœ¨ç¬¬ä¸€ä¸ªè™šæ‹Ÿæœºçš„Kafkaç›®å½•ä¸‹æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š</p><p>bash</p><p>å¤åˆ¶ä»£ç </p><p><code>bin/kafka-topics.sh --create --topic my-topic-kraft --bootstrap-server localhost:9092</code></p><p>ç„¶ååœ¨ç¬¬äºŒä¸ªè™šæ‹Ÿæœºçš„Kafkaç›®å½•ä¸‹æŸ¥çœ‹è¯é¢˜ï¼š</p><p>bash</p><p>å¤åˆ¶ä»£ç </p><p><code>bin/kafka-topics.sh --list --bootstrap-server localhost:9092</code></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2753c5435163415eb7f62c7694f9221f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20230612212505591"></p><p>å¯è§é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ã€‚</p><blockquote><p>æ— è®ºæ˜¯åœ¨è™šæ‹Ÿæœºè¿˜æ˜¯æœåŠ¡å™¨ä¸Šï¼Œéƒ½è¦ä¿è¯<code>9092</code>å’Œ<code>9093</code>ç«¯å£å¼€æ”¾ï¼Œä¸”æ‰€æœ‰è™šæ‹Ÿæœº&#x2F;æœåŠ¡å™¨ä¹‹é—´éƒ½èƒ½å¤Ÿä¸¤ä¸¤äº’ç›¸è®¿é—®ï¼ˆç½‘ç»œè¿é€šï¼‰ï¼</p></blockquote><h2 id="3ï¼Œé‡è¦é…ç½®ä»‹ç»"><a href="#3ï¼Œé‡è¦é…ç½®ä»‹ç»" class="headerlink" title="3ï¼Œé‡è¦é…ç½®ä»‹ç»"></a>3ï¼Œé‡è¦é…ç½®ä»‹ç»</h2><p>æ— è®ºæ˜¯é‚£ç§æ¨¡å¼çš„é›†ç¾¤ï¼Œæˆ‘ä»¬éƒ½æ¶‰åŠåˆ°äº†è®¸å¤šé…ç½®é¡¹ï¼Œå¤§å®¶é€šè¿‡ä¸Šè¿°çš„æ­å»ºç¤ºä¾‹ä¹Ÿèƒ½å¤Ÿäº†è§£åˆ°æ¯ä¸ªé…ç½®é¡¹çš„æ„ä¹‰ï¼Œè¿™é‡Œå°±ä¸“é—¨æ¥ç€é‡ä»‹ç»ä¸€ä¸‹ï¼ŒKafkaä¸­ä¸€äº›é‡è¦çš„é…ç½®é¡¹ã€‚</p><h3 id="1-listeners"><a href="#1-listeners" class="headerlink" title="(1) listeners"></a>(1) <code>listeners</code></h3><p>è¿™ä¸ªé…ç½®é¡¹ç”¨äº<strong>æŒ‡å®šKafkaæœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„åœ°å€å’Œç«¯å£</strong>ï¼Œå½“ Kafka æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå®ƒå°†ç›‘å¬<code>listeners</code>é…ç½®é¡¹ä¸­æŒ‡å®šçš„åœ°å€å’Œç«¯å£ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªé…ç½®ä»¥<code>PLAINTEXT://</code>æˆ–è€…<code>CONTROLLER://</code>å¼€å¤´ï¼Œæ„ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>è‹¥è¿™ä¸ªèŠ‚ç‚¹æ˜¯BrokerèŠ‚ç‚¹ï¼Œåˆ™ä»¥<code>PLAINTEXT://</code>å¼€å¤´</li><li>è‹¥è¿™ä¸ªèŠ‚ç‚¹æ˜¯ControllerèŠ‚ç‚¹ï¼Œåˆ™ä»¥<code>CONTROLLER://</code>å¼€å¤´</li><li>è‹¥è¿™ä¸ªèŠ‚ç‚¹æ˜¯æ··åˆèŠ‚ç‚¹ï¼Œåˆ™éœ€è¦åŒæ—¶é…ç½®ä¸¤è€…å¼€å¤´çš„åœ°å€</li></ul><p>è¿™ä¸ªé…ç½®é¡¹<strong>é€šå¸¸ä¸éœ€è¦ä¿®æ”¹</strong>ï¼Œä¸‹é¢ç»™å‡ºå‡ ä¸ªé…ç½®ç¤ºä¾‹ï¼š</p><ul><li><code>PLAINTEXT://:9092</code> æœ¬èŠ‚ç‚¹ä½œä¸ºBrokerèŠ‚ç‚¹ï¼Œç›‘å¬æœ¬æœº<strong>æ‰€æœ‰å¯ç”¨ç½‘å¡</strong>çš„<code>9092</code>ç«¯å£ï¼ˆä½¿ç”¨<code>9092</code>ç«¯å£ä½œä¸º<strong>å®¢æˆ·ç«¯é€šä¿¡ç«¯å£</strong>ï¼‰ï¼Œä¹Ÿæ˜¯é»˜è®¤é…ç½®</li><li><code>PLAINTEXT://127.0.0.1:9092</code> æœ¬èŠ‚ç‚¹ä½œä¸ºBrokerèŠ‚ç‚¹ï¼Œç›‘å¬æœ¬åœ°çš„<code>9092</code>ç«¯å£ï¼Œè¿™æ ·ä»…æ¥å—æ¥è‡ªæœ¬åœ°çš„è¯·æ±‚</li><li><code>CONTROLLER://:10000</code> æœ¬èŠ‚ç‚¹ä½œä¸ºControllerèŠ‚ç‚¹ï¼Œç›‘å¬æœ¬æœº<strong>æ‰€æœ‰å¯ç”¨ç½‘å¡</strong>çš„<code>10000</code>ç«¯å£ï¼ˆä½¿ç”¨<code>10000</code>ç«¯å£ä½œä¸º<strong>æ§åˆ¶å™¨ç«¯å£</strong>ï¼‰</li><li><code>PLAINTEXT://:9092,CONTROLLER://:9093</code> æœ¬èŠ‚ç‚¹ä½œä¸ºæ··åˆèŠ‚ç‚¹ï¼Œç›‘å¬æœ¬æœº<strong>æ‰€æœ‰å¯ç”¨ç½‘å¡</strong>çš„<code>9092</code>å’Œ<code>9093</code>ç«¯å£ï¼Œå…¶ä¸­<code>9092</code>ä½œä¸º<strong>å®¢æˆ·ç«¯é€šä¿¡ç«¯å£</strong>ï¼Œ<code>9093</code>ä½œä¸º<strong>æ§åˆ¶å™¨ç«¯å£</strong></li></ul><h3 id="2-advertise-listeners"><a href="#2-advertise-listeners" class="headerlink" title="(2) advertise.listeners"></a>(2) <code>advertise.listeners</code></h3><p>è¿™ä¸ªé…ç½®å®¹æ˜“å’Œ<code>listeners</code>æ··æ·†ï¼Œäº‹å®ä¸Šå®ƒä»¬æ˜¯æœ‰è¾ƒå¤§çš„åŒºåˆ«çš„ã€‚</p><p>è¯¥é…ç½®é¡¹æŒ‡å®šKafkaæœåŠ¡å™¨<strong>å¹¿æ’­ç»™å®¢æˆ·ç«¯çš„åœ°å€å’Œç«¯å£</strong>ï¼Œé€šå¸¸é…ç½®ä¸º<strong>Kafkaæ‰€åœ¨æœåŠ¡å™¨çš„å¤–ç½‘åœ°å€</strong>ã€‚</p><p>å½“å®¢æˆ·ç«¯ï¼ˆç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ï¼‰å°è¯•è¿æ¥åˆ°KafkaæœåŠ¡å™¨æ—¶ï¼Œå®ƒé¦–å…ˆä¼šè·å–KafkaæœåŠ¡å™¨å¹¿æ’­çš„åœ°å€å’Œç«¯å£ï¼Œä¹Ÿå°±æ˜¯<code>advertise.listeners</code>é…ç½®æ‰€æŒ‡å®šçš„åœ°å€å’Œç«¯å£ï¼Œç„¶åæ‰ä¼šä½¿ç”¨<code>advertise.listeners</code>é…ç½®æ‰€æŒ‡å®šçš„åœ°å€å’Œç«¯å£æ¥å»ºç«‹ä¸KafkaæœåŠ¡å™¨çš„è¿æ¥ã€‚</p><p>ç›¸ä¿¡è¿™æ—¶å¤§å®¶ä¼šæœ‰ä¸ªç–‘é—®ï¼šæ—¢ç„¶å®¢æˆ·ç«¯è¦è¿æ¥Kafkaï¼ˆä¾‹å¦‚Spring Booté›†æˆKafkaå®¢æˆ·ç«¯ï¼‰ï¼Œé‚£ä¸€å®šæ˜¯å·²ç»çŸ¥é“äº†Kafkaå¯¹å¤–çš„åœ°å€ç«¯å£äº†ï¼Œé‚£ä¸ºä»€ä¹ˆè¿æ¥çš„æ—¶å€™è¿˜éœ€è¦è·å–ä¸€ä¸‹å¹¿æ’­çš„åœ°å€ç«¯å£å†è¿›è¡Œè¿æ¥å‘¢ï¼Ÿè¿™æ ·æ˜¯ä¸æ˜¯æœ‰ä¸€äº›å¤šæ­¤ä¸€ä¸¾ï¼Ÿ</p><p>äº‹å®ä¸Šï¼ŒKafkaè®¾è®¡è¿™ä¸ªé…ç½®æ˜¯ä¸ºäº†è§£å†³ä¸‹é¢è¾ƒä¸ºå¤æ‚çš„ç½‘ç»œåœºæ™¯ï¼š</p><ul><li><strong>å¤šç½‘ç»œæ¥å£çš„ä¸»æœºéƒ¨ç½²</strong>ï¼šåœ¨ä¸€ä¸ªå¤šç½‘ç»œæ¥å£çš„ä¸»æœºéƒ¨ç½²Kafkaæ—¶ï¼ŒKafkaæœåŠ¡å™¨å¯èƒ½ä¼šç›‘å¬å¤šä¸ªåœ°å€å’Œç«¯å£ï¼Œè¿™äº›åœ°å€å’Œç«¯å£å¯èƒ½ä¸å®¢æˆ·ç«¯å®é™…è®¿é—®çš„åœ°å€å’Œç«¯å£ä¸åŒï¼Œ<code>advertise.listeners</code>å…è®¸æœåŠ¡å™¨æŒ‡å®šä¸€ä¸ªå…¬å¼€çš„ã€å¯è®¿é—®çš„åœ°å€å’Œç«¯å£ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯èƒ½å¤Ÿæ­£ç¡®è¿æ¥</li><li><strong>NAT&#x2F;ä»£ç†ç¯å¢ƒ</strong>ï¼šåœ¨æŸäº›ç½‘ç»œç¯å¢ƒä¸‹ï¼ŒKafkaæœåŠ¡å™¨ä½äºä¸€ä¸ªç§æœ‰ç½‘ç»œä¸­ï¼Œå®¢æˆ·ç«¯ä½äºä¸€ä¸ªå…¬å…±ç½‘ç»œä¸­ï¼Œä¸¤è€…ä¹‹é—´å¯èƒ½å­˜åœ¨ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰æˆ–ä»£ç†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒKafkaæœåŠ¡å™¨çš„å†…éƒ¨åœ°å€å’Œç«¯å£å¯¹å®¢æˆ·ç«¯æ¥è¯´æ˜¯ä¸å¯è®¿é—®çš„ã€‚é€šè¿‡ä½¿ç”¨<code>advertise.listeners</code>ï¼ŒKafkaæœåŠ¡å™¨å¯ä»¥å°†ä¸€ä¸ªå…¬å…±åœ°å€å’Œç«¯å£å¹¿æ’­ç»™å®¢æˆ·ç«¯ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿé€šè¿‡å…¬å…±ç½‘ç»œè¿æ¥åˆ°æœåŠ¡å™¨</li><li><strong>å®¹å™¨ç¯å¢ƒ</strong>ï¼šä¾‹å¦‚ä½ æŠŠKafkaæ”¾åœ¨Dockerå®¹å™¨ä¸­è¿è¡Œï¼ŒæŒ‰ç…§é»˜è®¤é…ç½®ï¼ŒKafkaæœåŠ¡ç«¯åªä¼šç›‘å¬å®¹å™¨ç½‘ç»œçš„<code>9092</code>ç«¯å£ï¼Œæˆ‘ä»¬çŸ¥é“å¤–éƒ¨ä¸èƒ½ç›´æ¥è®¿é—®å®¹å™¨çš„ç½‘ç»œï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨ç½‘ç»œæ˜ å°„ï¼Œå‡è®¾ä½ æŠŠKafkaå®¹å™¨çš„<code>9092</code>ç«¯å£æ˜ å°„è‡³äº†å®¿ä¸»æœº<code>9095</code>ç«¯å£ï¼Œä¹Ÿå°±æ˜¯è¯´å¤–éƒ¨éœ€è¦é€šè¿‡<code>9095</code>ç«¯å£è®¿é—®åˆ°Kafkaå®¹å™¨çš„<code>9092</code>ç«¯å£ï¼Œé‚£ä¹ˆä½ å°±é…ç½®<code>advertise.listeners</code>ä¸º<code>PLAINTEXT://æœåŠ¡å™¨å¤–ç½‘åœ°å€:9095</code>ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥æ­£ç¡®è®¿é—®å®¹å™¨ä¸­çš„Kafkaäº†</li></ul><p>æ€»ä¹‹ï¼Œè¿™ä¸ªé…ç½®è®¾ç½®ä¸º<strong>KafkaæœåŠ¡å™¨æ‰€åœ¨çš„å¤–ç½‘åœ°å€å³å¯</strong>ï¼ä¾‹å¦‚<code>PLAINTEXT://69.54.112.239:9092</code>ã€‚</p><h3 id="3-process-roles"><a href="#3-process-roles" class="headerlink" title="(3) process.roles"></a>(3) <code>process.roles</code></h3><p>è¿™æ˜¯KRaftæ¨¡å¼ä¸‹ä¸“é—¨çš„é…ç½®ï¼Œç”¨äºé…ç½®è¿™ä¸ªèŠ‚ç‚¹çš„ç±»å‹ï¼Œå¯ä»¥é…ç½®ä¸ºä¸‹åˆ—å€¼ï¼š</p><ul><li><code>broker</code> è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹æ˜¯BrokerèŠ‚ç‚¹ï¼Œå……å½“æ¶ˆæ¯é˜Ÿåˆ—çš„è§’è‰²</li><li><code>controller</code> è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹æ˜¯ControllerèŠ‚ç‚¹ï¼Œå……å½“å…ƒæ•°æ®å­˜æ”¾å’Œç®¡ç†çš„è§’è‰²</li><li><code>broker,controller</code> è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹åŒæ—¶æ‹…ä»»Brokerå’ŒControllerçš„è§’è‰²ï¼Œä¹Ÿç§°ä½œ<strong>æ··åˆèŠ‚ç‚¹</strong></li></ul><p>å¦‚æœæ²¡æœ‰é…ç½®è¿™ä¸ªé€‰é¡¹ï¼Œåˆ™Kafkaä¼šä»¥Zookeeperæ¨¡å¼è¿è¡Œã€‚</p><p>è¿™é‡Œæœ‰ä¸‹åˆ—æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>å¦‚æœè®¾å®šèŠ‚ç‚¹ä¸º<code>controller</code>ï¼š<ul><li>åˆ™<strong>ä¸èƒ½</strong>é…ç½®<code>advertised.listeners</code>ï¼Œå¯ä»¥å°†å…¶æ³¨é‡Šæ‰æˆ–è€…åˆ æ‰</li><li><code>listeners</code>éœ€è¦é…ç½®ä¸º<code>CONTROLLER://</code>å¼€å¤´ï¼Œå»ºè®®é…ç½®ä¸º<code>CONTROLLER://:9093</code></li></ul></li><li>å¦‚æœè®¾å®šèŠ‚ç‚¹ä¸º<code>broker</code>ï¼š<ul><li>åˆ™éœ€è¦é…ç½®<code>advertised.listeners</code>ä¸ºæœåŠ¡å™¨å¤–ç½‘åœ°å€å’Œç«¯å£ï¼Œè¿™å’ŒZookeeperæ¨¡å¼ä¸­ç›¸åŒ</li><li><code>listeners</code>éœ€è¦é…ç½®ä¸º<code>PLAINTEXT://</code>å¼€å¤´ï¼Œå»ºè®®é…ç½®ä¸º<code>PLAINTEXT://:9092</code></li></ul></li><li>å¦‚æœè®¾å®šèŠ‚ç‚¹ä¸ºæ··åˆèŠ‚ç‚¹ï¼š<ul><li>åŒæ ·éœ€è¦é…ç½®<code>advertised.listeners</code>ä¸ºæœåŠ¡å™¨å¤–ç½‘åœ°å€å’Œç«¯å£</li><li><code>listeners</code>éœ€è¦åŒæ—¶é…ç½®<code>CONTROLLER://</code>å’Œ<code>PLAINTEXT://</code>ï¼Œå»ºè®®é…ç½®ä¸º<code>PLAINTEXT://:9092,CONTROLLER://:9093</code></li></ul></li></ul><p>åœ¨å¼€å‘ç¯å¢ƒæˆ–è€…å°è§„æ¨¡é›†ç¾¤ï¼Œå¯ä»¥å…¨éƒ¨ä½¿ç”¨æ··åˆèŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒå°±å»ºè®®è®¾å®šå¥½æ¯ä¸ªèŠ‚ç‚¹çš„ç±»å‹äº†ï¼å¹¶ä¸”é€šå¸¸éœ€è¦å…ˆå¯åŠ¨ControllerèŠ‚ç‚¹å†å¯åŠ¨BrokerèŠ‚ç‚¹ã€‚</p><blockquote><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å‘ç°Kafkaçš„KRafté…ç½®ç›®å½•<code>config/kraft</code>ä¸‹æœ‰ä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­<code>server.properties</code>æ˜¯æ··åˆèŠ‚ç‚¹çš„é…ç½®æ¨¡æ¿ï¼Œè€Œ<code>broker.properties</code>å’Œ<code>controller.properties</code>åˆ†åˆ«æ˜¯BrokerèŠ‚ç‚¹å’ŒControllerèŠ‚ç‚¹çš„é…ç½®æ¨¡æ¿ï¼Œå¤§å®¶å¦‚æœè¦è®¾å®šèŠ‚ç‚¹ç±»å‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œå°†å¯¹åº”é…ç½®æ–‡ä»¶éœ€è¦ä¿®æ”¹çš„éƒ¨åˆ†ä¿®æ”¹ä¸€ä¸‹ï¼Œç„¶åå°†ä¸Šè¿°æ ¼å¼åŒ–æ•°æ®ç›®å½•å‘½ä»¤å’Œå¯åŠ¨å‘½ä»¤ä¸­çš„é…ç½®æ–‡ä»¶è·¯å¾„æ”¹å˜ä¸€ä¸‹å³å¯ï¼Œè¿™æ ·å¯ä»¥çœç•¥æˆ‘ä»¬è®¾å®š<code>process.roles</code>å’Œ<code>listeners</code>æˆ–è€…æ§åˆ¶å™¨èŠ‚ç‚¹åˆ é™¤<code>advertise.listeners</code>é…ç½®çš„æ“ä½œã€‚</p></blockquote><h3 id="4-controller-quorum-voters"><a href="#4-controller-quorum-voters" class="headerlink" title="(4) controller.quorum.voters"></a>(4) <code>controller.quorum.voters</code></h3><p>è¯¥é…ç½®é¡¹ç”¨äºé…ç½®é›†ç¾¤ä¸­ControllerèŠ‚ç‚¹é€‰ä¸¾è¿‡ç¨‹ä¸­çš„æŠ•ç¥¨è€…ï¼Œé›†ç¾¤ä¸­<strong>æ‰€æœ‰çš„ControllerèŠ‚ç‚¹éƒ½éœ€è¦è¢«ç½—åˆ—åœ¨è¿™ä¸ªé…ç½®é¡¹ä¸­</strong>ï¼Œå…¶é…ç½®æ ¼å¼ä¸º<code>id1@host1:port1,id2@host2:port2,id3@host3:port3...</code>ã€‚</p><p>æœ‰çš„åŒå­¦å¯èƒ½è®¤ä¸ºè¿™é‡Œéœ€è¦æŠŠé›†ç¾¤ä¸­<strong>æ‰€æœ‰èŠ‚ç‚¹</strong>éƒ½å†™è¿›å»ï¼Œäº‹å®ä¸Šè¿™æ˜¯é”™è¯¯çš„ï¼Œè¿™é‡Œåªéœ€è¦å†™<strong>æ‰€æœ‰çš„ControllerèŠ‚ç‚¹å’Œæ··åˆèŠ‚ç‚¹</strong>çš„<code>id</code>ã€åœ°å€å’Œç«¯å£å³å¯ï¼Œè¿™ä¸ªé…ç½®ä¸­é…ç½®çš„ç«¯å£å½“ç„¶æ˜¯<strong>æ§åˆ¶å™¨ç«¯å£</strong>ã€‚</p><p>ä¸Šè¿°é›†ç¾¤æ­å»ºçš„ä¾‹å­ä¸­ï¼Œç”±äºæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯æ··åˆèŠ‚ç‚¹ï¼Œå› æ­¤å°±å…¨éƒ¨å†™åœ¨å…¶ä¸­äº†ï¼å¦‚æœæˆ‘ä»¬æ‰‹åŠ¨è®¾å®šæ¯ä¸ªèŠ‚ç‚¹çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p><table><thead><tr><th align="center">èŠ‚ç‚¹å</th><th align="center">èŠ‚ç‚¹<code>id</code></th><th align="center">åœ°å€</th><th align="center">æœåŠ¡å™¨é€šä¿¡ç«¯å£</th><th align="center">æ§åˆ¶å™¨ç«¯å£</th><th align="center">èŠ‚ç‚¹ç±»å‹</th></tr></thead><tbody><tr><td align="center">KafkaèŠ‚ç‚¹1</td><td align="center"><code>1</code></td><td align="center"><code>kafka1</code></td><td align="center">&#x2F;</td><td align="center"><code>9093</code></td><td align="center">Controller</td></tr><tr><td align="center">KafkaèŠ‚ç‚¹2</td><td align="center"><code>2</code></td><td align="center"><code>kafka2</code></td><td align="center"><code>9092</code></td><td align="center">&#x2F;</td><td align="center">Broker</td></tr><tr><td align="center">KafkaèŠ‚ç‚¹3</td><td align="center"><code>3</code></td><td align="center"><code>kafka3</code></td><td align="center"><code>9092</code></td><td align="center">&#x2F;</td><td align="center">Broker</td></tr></tbody></table><p>é‚£ä¹ˆæ‰€æœ‰èŠ‚ç‚¹çš„<code>controller.quorum.voters</code>éƒ½éœ€è¦é…ç½®ä¸º<code>1@kafka1:9093</code>ã€‚</p><p>äº‹å®ä¸Šï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯é€šè¿‡è¿™ä¸ªé…ç½®ä¸­çš„èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ¥å¾—çŸ¥æ‰€æœ‰çš„æ§åˆ¶å™¨èŠ‚ç‚¹ä¿¡æ¯ï¼ˆä»¥è·å–é›†ç¾¤å…ƒæ•°æ®ï¼‰å¹¶å¾—åˆ°æŠ•ç¥¨å€™é€‰è€…çš„ï¼Œå› æ­¤é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¸è®ºæ˜¯Brokerè¿˜æ˜¯Controllerï¼Œè¿˜æ˜¯æ··åˆèŠ‚ç‚¹ï¼Œéƒ½éœ€è¦é…ç½®è¿™ä¸€é¡¹ã€‚</p><h3 id="5-å…¶å®ƒé…ç½®"><a href="#5-å…¶å®ƒé…ç½®" class="headerlink" title="(5) å…¶å®ƒé…ç½®"></a>(5) å…¶å®ƒé…ç½®</h3><p>é™¤äº†ä¸Šè¿°æˆ‘ä»¬æ¶‰åŠåˆ°çš„ä¸€äº›é…ç½®ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸‹åˆ—é…ç½®å¤§å®¶å¯ä»¥è¿›è¡Œä¿®æ”¹ï¼š</p><ul><li><code>socket.send.buffer.bytes</code> æ¯æ¬¡å‘é€çš„æ•°æ®åŒ…çš„æœ€å¤§å¤§å°ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰</li><li><code>socket.receive.buffer.bytes</code> æ¯æ¬¡æ¥æ”¶çš„æ•°æ®åŒ…çš„æœ€å¤§å¤§å°ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰</li><li><code>socket.request.max.bytes</code> æ¥æ”¶çš„æœ€å¤§è¯·æ±‚å¤§å°ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰</li><li><code>num.partitions</code> æ¯ä¸ª<code>Topic</code>çš„é»˜è®¤åˆ†åŒºæ•°</li></ul><p>ä¸Šè¿°æ— è®ºæ˜¯å“ªä¸ªæ¨¡å¼çš„é›†ç¾¤ï¼Œéƒ½å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°è¿™äº›é…ç½®ï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯æ‰‹åŠ¨åŠ å…¥ã€‚é™¤äº†ä¿®æ”¹é…ç½®æ–‡ä»¶ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨å¯åŠ¨Kafkaçš„å‘½ä»¤ä¸­æŒ‡å®šé…ç½®å’Œå€¼ï¼Œä¾‹å¦‚ï¼š</p><p>bash</p><p>å¤åˆ¶ä»£ç </p><p><code>bin/kafka-server-start.sh config/server.properties --override zookeeper.connect=127.0.0.1:2181 --override broker.id=1</code></p><p>ä¸Šè¿°å‘½ä»¤åœ¨å¯åŠ¨æ—¶é€šè¿‡å‘½ä»¤æŒ‡å®šäº†<code>zookeeper.connect</code>é…ç½®å€¼ä¸º<code>127.0.0.1:2181</code>ï¼Œä»¥åŠ<code>broker.id</code>ä¸º<code>1</code>ï¼Œå¯è§åœ¨åé¢è¿½åŠ <code>--override é…ç½®å=å€¼</code>å³å¯ï¼Œæ³¨æ„å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„é…ç½®å€¼ä¼šè¦†ç›–æ‰é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®å€¼ï¼</p><h2 id="4ï¼Œæ€»ç»“"><a href="#4ï¼Œæ€»ç»“" class="headerlink" title="4ï¼Œæ€»ç»“"></a>4ï¼Œæ€»ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº†Kafkaçš„ä¸¤ç§é›†ç¾¤æ¨¡å¼ç»“æ„åŠå…¶æ­å»ºæ–¹å¼ï¼Œå…¶ä¸­ä¸€äº›æ¦‚å¿µå°¤å…¶æ˜¯KRaftæ¨¡å¼å¯èƒ½éœ€è¦å¤§å®¶å¤šè¯»å‡ éï¼Œå¹¶ç»“åˆå®é™…æ“ä½œæ‰èƒ½æ˜ç™½ã€‚</p><p>å‚è€ƒæ–‡æ¡£ï¼š</p><ul><li>Kafkaå¿«é€Ÿå¼€å§‹ï¼š<a href="https://link.juejin.cn/?target=https://kafka.apache.org/quickstart" title="https://kafka.apache.org/quickstart">ä¼ é€é—¨</a></li><li>Kafkaæ‰€æœ‰é…ç½®ï¼š<a href="https://link.juejin.cn/?target=https://kafka.apache.org/documentation/%23configuration" title="https://kafka.apache.org/documentation/#configuration">ä¼ é€é—¨</a></li><li>KRaftæ¨¡å¼é›†ç¾¤é…ç½®ï¼š<a href="https://link.juejin.cn/?target=https://kafka.apache.org/documentation/%23kraft" title="https://kafka.apache.org/documentation/#kraft">ä¼ é€é—¨</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kafka</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis6.0+ç‰ˆæœ¬ä¿®æ”¹å¯†ç æ— æ•ˆ</title>
    <link href="/article/2bab8fa4.html"/>
    <url>/article/2bab8fa4.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><meta name="referrer" content="no-referrer" /><p>1ã€é—®é¢˜æè¿°<br>åœ¨æ­å»ºredisä¸»ä»é›†ç¾¤çš„æ—¶å€™ï¼Œä¸€ç›´å‡ºç°å¯†ç é—®é¢˜ï¼Œä¹‹å‰è®¾ç½®çš„æ˜¯é»˜è®¤å¯†ç 123456.åæ¥å‘ç°å³ä½¿ä¿®æ”¹äº†é»˜è®¤å¯†ç ä¹‹åå¯†ç è¿˜æ˜¯éœ€è¦å†™åŸæ¥çš„æ‰èƒ½ç™»å…¥ï¼Œç”šè‡³æ³¨é‡Šrequirepassåï¼Œè¿˜æ˜¯éœ€è¦123456çš„å¯†ç ã€‚<br>çœ‹äº†å¾ˆå¤šæ–‡ç« ï¼Œè¦ä¹ˆæ²¡æ³•è§£å†³ï¼Œè¦ä¹ˆä¸‹æ¬¡ç™»å…¥åè¿˜æ˜¯ä¸€æ ·çš„é—®é¢˜ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§èƒ½è§£å†³çš„<br>2ã€è§£å†³æ–¹æ¡ˆï¼š</p><p>ä¿®æ”¹redis.conf ä¸­çš„ user default on nopass ~* &amp;* +@all<br>æ³¨æ„é»˜è®¤æ”¹æˆè¿™ä¸ªnopassï¼ï¼ï¼<br>æ²¡æ”¹ä¹‹å‰æ˜¯ä¸€é•¿ä¸²åŠ å¯†çš„ä¸œè¥¿ï¼Œæˆ‘çŒœå°±æ˜¯123456ï¼Œæ”¹æˆnopassï¼Œæˆ–è€…æ”¹æˆè‡ªå·±ç‰¹å®šçš„å¯†ç ï¼Œæˆ–è€…ç›´æ¥åˆ é™¤generated by config rewrite ä¸‹é¢è¿™äº›ä¸œè¥¿ï¼Œé—®é¢˜è§£å†³ï¼</p><p>3ã€æˆåŠŸæ— å¯†ç ç™»å…¥<br>å…ˆçœ‹ä¸€ä¸‹çº¿ç¨‹ ps aux | grep redis ,æŸ¥å‡ºå·ç åkillï¼Œé‡å¯ä¸€ä¸‹redisï¼ˆä¹Ÿé‡å¯ä¸‹xshellï¼‰ï¼Œå¤§åŠŸå‘Šæˆï¼ï¼</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLå®ç°å¤šä¸ªæ¨¡ç³ŠæŸ¥è¯¢å’Œåˆ é™¤æŒ‡ä»¤</title>
    <link href="/article/c7577f7f.html"/>
    <url>/article/c7577f7f.html</url>
    
    <content type="html"><![CDATA[<h1 id="MySQLå®ç°å¤šä¸ªæ¨¡ç³ŠæŸ¥è¯¢å’Œåˆ é™¤æŒ‡ä»¤"><a href="#MySQLå®ç°å¤šä¸ªæ¨¡ç³ŠæŸ¥è¯¢å’Œåˆ é™¤æŒ‡ä»¤" class="headerlink" title="MySQLå®ç°å¤šä¸ªæ¨¡ç³ŠæŸ¥è¯¢å’Œåˆ é™¤æŒ‡ä»¤"></a>MySQLå®ç°å¤šä¸ªæ¨¡ç³ŠæŸ¥è¯¢å’Œåˆ é™¤æŒ‡ä»¤</h1><p>MySQLå•è¡¨å¤šå­—æ®µæ¨¡ç³ŠæŸ¥è¯¢çš„æ˜¯æŒ‡å®ç°åœ¨å•è¡¨ä¸­å¯¹å¤šå­—æ®µè¿›è¡Œå¤šä¸ªå…³é”®å­—çš„æ¨¡ç³ŠæŸ¥è¯¢</p><p>æŸ¥è¯¢ä¸å­˜åœ¨æŸäº›å…³é”®è¯çš„è®°å½•æŒ‡ä»¤ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">selectÂ \*Â fromÂ \`è¡¨å\`Â whereÂ \`å­—æ®µå\`Â notÂ regexpÂ <span class="hljs-emphasis">&#x27;å…³é”®è¯1|å…³é”®è¯2|å…³é”®è¯3&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢å­˜åœ¨æŸäº›å…³é”®è¯çš„è®°å½•æŒ‡ä»¤ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><br>selectÂ \*Â fromÂ \`è¡¨å\`Â whereÂ \`å­—æ®µå\`Â regexpÂ <span class="hljs-emphasis">&#x27;å…³é”®è¯1|å…³é”®è¯2|å…³é”®è¯3&#x27;</span>;<br></code></pre></td></tr></table></figure><p>åˆ é™¤ä¸åŒ…å«æŒ‡å®šå…³é”®è¯çš„è®°å½•æŒ‡ä»¤ï¼š</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><br><span class="hljs-keyword">delete</span>Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">\`è¡¨\`</span>Â whereÂ <span class="hljs-string">\`å­—æ®µ\`</span>Â Â <span class="hljs-keyword">not</span>Â likeÂ <span class="hljs-string">&#x27;%å…³é”®è¯%&#x27;</span><br></code></pre></td></tr></table></figure><p>åˆ é™¤åŒ…å«æŒ‡å®šå…³é”®è¯çš„è®°å½•æŒ‡ä»¤ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">delete</span>Â <span class="hljs-keyword">from</span>Â \`è¡¨\`Â <span class="hljs-keyword">where</span>Â \`å­—æ®µ\`Â <span class="hljs-keyword">like</span>Â <span class="hljs-string">&#x27;%å…³é”®è¯1%&#x27;</span>Â <span class="hljs-keyword">or</span>Â <span class="hljs-keyword">like</span>Â <span class="hljs-string">&#x27;%å…³é”®è¯2%&#x27;</span>Â <span class="hljs-keyword">or</span>Â <span class="hljs-keyword">like</span>Â <span class="hljs-string">&#x27;%å…³é”®è¯3%&#x27;</span><br></code></pre></td></tr></table></figure><p>AND  </p><p>MySQLå•è¡¨å¤šå­—æ®µæ¨¡ç³ŠæŸ¥è¯¢ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸ªSQLæŸ¥è¯¢å®ç°</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">SELECTÂ \*Â FROMÂ \`magazine\`Â WHEREÂ CONCAT(\`title\`,\`tag\`,\`description\`)Â LIKEÂ â€˜%å…³é”®å­—%â€™<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœè¿™ä¸‰ä¸ªå­—æ®µä¸­æœ‰å€¼ä¸ºNULLï¼Œåˆ™è¿”å›çš„ä¹Ÿæ˜¯NULLï¼Œé‚£ä¹ˆè¿™ä¸€æ¡è®°å½•å¯èƒ½å°±ä¼šè¢«é”™è¿‡ï¼Œé‚£ä¹ˆè¦ç”¨IFNULLè¿›è¡Œåˆ¤æ–­ï¼Œåˆ™sqlæ”¹ä¸ºï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-keyword">SELECT</span>Â \*Â FROMÂ \<span class="hljs-string">`magazine\`</span>Â <span class="hljs-keyword">WHERE</span>Â CONCAT(IFNULL(\<span class="hljs-string">`title\`</span>,<span class="hljs-string">&#x27;&#x27;</span>),IFNULL(\<span class="hljs-string">`tag\`</span>,<span class="hljs-string">&#x27;&#x27;</span>),IFNULL(\<span class="hljs-string">`description\`</span>,<span class="hljs-string">&#x27;&#x27;</span>))Â LIKEÂ â€˜%å…³é”®å­—%â€™<br><br></code></pre></td></tr></table></figure><p>Â ç±»ä¼¼äºå¦‚æ­¤åˆ™å¯ä»¥è¿›è¡Œç®€å•çš„å¤šå­—æ®µæ¨¡ç³Šæœç´¢äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlè½¬sqlliteæ•°æ®è¡¨</title>
    <link href="/article/c7875919.html"/>
    <url>/article/c7875919.html</url>
    
    <content type="html"><![CDATA[<h2 id="mysqlæ€ä¹ˆè½¬æ¢ä¸ºsqlite"><a href="#mysqlæ€ä¹ˆè½¬æ¢ä¸ºsqlite" class="headerlink" title="mysqlæ€ä¹ˆè½¬æ¢ä¸ºsqlite"></a>mysqlæ€ä¹ˆè½¬æ¢ä¸ºsqlite</h2><p>éœ€è¦å…ˆå®‰è£…å·¥å…·ï¼šNavicat Premium ï¼ˆæ”¯æŒMySQLã€Oracleã€PostgreSQLã€SQLite åŠ SQL Serve çš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼‰</p><p><strong>ç¬¬ä¸€æ­¥ï¼šå…ˆæŠŠmysqlå¯¼å‡ºæˆtxtæ–‡ä»¶</strong></p><p>è®°ä½â€œåŒ…å«åˆ—è¡¨çš„æ ‡é¢˜â€ å¤é€‰æ¡†è¦å‹¾é€‰ï¼Œ å¦åˆ™ç”Ÿæˆçš„txtæ²¡æœ‰é”®ã€‚</p><p><strong>ç¬¬äºŒæ­¥ï¼šæ‰“å¼€ Navicate Premium ï¼Œæ–°å»ºSQLite è¿æ¥</strong></p><p><img src="https://img.php.cn/upload/image/505/834/242/1652953790978024.png" alt="10.png" title="1652953790978024.png"></p><p>è¿™é‡Œçš„æ•°æ®åº“æ–‡ä»¶æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®çš„æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ç”¨è®°äº‹æœ¬æ–°å»ºä¸€ä¸ªåæœ€ä¸ºdb çš„æ–‡ä»¶ã€‚</p><p><img src="https://img.php.cn/upload/image/747/724/546/1652953838356473.png" alt="31.png" title="1652953838356473.png"></p><p><strong>ç¬¬ä¸‰æ­¥ã€æŠŠç¬¬ä¸€æ­¥å¯¼å‡ºçš„txtæ–‡ä»¶å¯¼å…¥åˆ°ç¬¬äºŒæ­¥æ–°å»ºçš„SQLiteæ•°æ®åº“ä¸­</strong></p><p>ç‚¹å‡»è¡¨ï¼Œå³é”®â€œå¯¼å…¥å‘å¯¼â€ï¼Œé€‰æ‹©â€œæ–‡æœ¬æ–‡ä»¶â€ï¼Œç„¶åä¸€è·¯ä¸‹ä¸€æ­¥å°±å¯ä»¥äº†ã€‚</p><p><img src="https://img.php.cn/upload/image/635/713/577/1652953857746636.png" alt="32.png" title="1652953857746636.png"></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
      <tag>sqllite</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>xxl-jobçŸ¥è¯†ç‚¹</title>
    <link href="/article/65a98f40.html"/>
    <url>/article/65a98f40.html</url>
    
    <content type="html"><![CDATA[<p> æœ€è¿‘å¯¹åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿæ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œäºæ˜¯äº†è§£äº†ä¸‹ç½‘ä¸Šçš„å¼€æºé¡¹ç›®ã€‚</p><p>å‘ç°æœ‰ä¸€ä¸ªå›½å†…çš„å¼€æºé¡¹ç›®xxl-jobå†™çš„è¿˜ä¸é”™ï¼Œå¼€æºä»£ç æ¯”è¾ƒç®€å•æ˜“æ‡‚çš„ã€æ–‡æ¡£ä¹Ÿæ¯”è¾ƒé½å…¨ã€‚</p><p>é¦–å…ˆæ˜¯xxl-jobç³»ç»Ÿçš„æ¶æ„ä»‹ç»ï¼š</p><p><img src="https://pic4.zhimg.com/v2-70a6d9e0c3c658a7e10376666130d763_r.jpg"></p><p>xxl-jobå°±æ˜¯ä¸€ä¸ªä¸­å¿ƒåŒ–ç®¡ç†ç³»ç»Ÿï¼Œç³»ç»Ÿä¸»è¦é€šè¿‡MySQLç®¡ç†å„ç§å®šæ—¶ä»»åŠ¡ä¿¡æ¯ï¼Œå½“åˆ°äº†å®šæ—¶ä»»åŠ¡çš„è§¦å‘æ—¶é—´ï¼Œå°±æŠŠä»»åŠ¡ä¿¡æ¯ä»dbä¸­æ‹‰è¿›å†…å­˜ï¼Œå¯¹ä»»åŠ¡æ‰§è¡Œå™¨å‘èµ·è§¦å‘è¯·æ±‚ã€‚è¿™ä¸ªä»»åŠ¡æ‰§è¡Œå™¨ï¼Œæ—¢å¯ä»¥æ˜¯beanã€groovyè„šæœ¬ã€pythonè„šæœ¬ç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤–éƒ¨çš„httpæ¥å£ã€‚</p><p>ç›¸æ¯”èµ·å½“å½“ç½‘å¼€æºçš„elastic-job-liteï¼ˆåŸºäºzookeeperä½œä¸ºåè°ƒå™¨çš„â€œæ— ä¸­å¿ƒâ€æ¶æ„ï¼‰ï¼Œè¿™ç§ä¸­å¿ƒåŒ–ç®¡ç†çš„ç³»ç»Ÿå…¶å®æ›´ç®€å•ã€æ˜“äºç»´æŠ¤ã€‚</p><p>ä¸‹é¢æ ¸å¿ƒä»‹ç»ä¸‹æˆ‘æ„Ÿå…´è¶£çš„å‡ ä¸ªç‰¹æ€§çš„å®ç°åŸç†ï¼š</p><p><strong>1ã€å®šæ—¶è§¦å‘ä»»åŠ¡æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿï¼šä½¿ç”¨æ—¶é—´è½®å®ç°</strong></p><ul><li><p>xxl_job_infoè¡¨æ˜¯è®°å½•å®šæ—¶ä»»åŠ¡çš„dbè¡¨ï¼Œé‡Œé¢æœ‰ä¸ªtrigger_next_timeï¼ˆLongï¼‰å­—æ®µï¼Œè¡¨ç¤ºä¸‹ä¸€æ¬¡è§¦å‘çš„æ—¶é—´ç‚¹</p></li><li><p>ä»»åŠ¡æ—¶é—´è¢«ä¿®æ”¹ &#x2F; æ¯ä¸€æ¬¡ä»»åŠ¡è§¦å‘åï¼Œå¯ä»¥æ ¹æ®cronbè¡¨è¾¾å¼è®¡ç®—ä¸‹ä¸€æ¬¡è§¦å‘æ—¶é—´æˆ³ï¼šDate nextValidTime &#x3D; new CronExpression(jobInfo.getJobCron()).getNextValidTimeAfter(new Date())ï¼‰ï¼Œæ›´æ–°trigger_next_timeå­—æ®µ</p></li><li><p>å®šæ—¶æ‰§è¡Œä»»åŠ¡é€»è¾‘ï¼š</p></li><li><p>å®šæ—¶ä»»åŠ¡scheduleThreadï¼šä¸æ–­ä»dbæŠŠ5ç§’å†…è¦æ‰§è¡Œçš„ä»»åŠ¡è¯»å‡ºï¼Œç«‹å³è§¦å‘ &#x2F; æ”¾åˆ°æ—¶é—´è½®ç­‰å¾…è§¦å‘ï¼Œå¹¶æ›´æ–°trigger_next_time</p></li><li><p>è·å–å½“å‰æ—¶é—´now</p></li><li><p>è½®è¯¢dbï¼Œæ‰¾å‡ºtrigger_next_timeåœ¨è·now 5ç§’å†…çš„ä»»åŠ¡</p></li><li><p>ï¼ˆ0ï¼‰å¯¹åˆ°è¾¾nowæ—¶é—´åçš„ä»»åŠ¡ï¼ˆè¶…å‡ºnow 5ç§’å¤–ï¼‰ï¼š</p></li><li><p>ç›´æ¥è·³è¿‡ä¸æ‰§è¡Œï¼›</p></li><li><p>é‡ç½®trigger_next_time</p></li><li><p>ï¼ˆ1ï¼‰å¯¹åˆ°è¾¾nowæ—¶é—´åçš„ä»»åŠ¡ï¼ˆè¶…å‡ºnow 5ç§’å†…ï¼‰ï¼š</p></li><li><p>å¼€çº¿ç¨‹æ‰§è¡Œè§¦å‘é€»è¾‘ï¼›</p></li><li><p>è‹¥ä»»åŠ¡ä¸‹ä¸€æ¬¡è§¦å‘æ—¶é—´æ˜¯åœ¨5ç§’å†…ï¼Œåˆ™æ”¾åˆ°æ—¶é—´è½®å†…ï¼ˆMap&lt;Integer, List<Integer>&gt; ç§’æ•°(1-60) &#x3D;&gt; ä»»åŠ¡idåˆ—è¡¨ï¼‰ï¼›</p></li><li><p>é‡ç½®trigger_next_time</p></li><li><p>ï¼ˆ2ï¼‰å¯¹æœªåˆ°è¾¾nowæ—¶é—´çš„ä»»åŠ¡ï¼š</p></li><li><p>ç›´æ¥æ”¾åˆ°æ—¶é—´è½®å†…ï¼›</p></li><li><p>é‡ç½®trigger_next_time</p></li><li><p>å®šæ—¶ä»»åŠ¡ringThreadï¼šæ—¶é—´è½®å®ç°åˆ°ç‚¹è§¦å‘ä»»åŠ¡</p></li><li><p>æ—¶é—´è½®æ•°æ®ç»“æ„ï¼šMap&lt;Integer, List<Integer>&gt; keyæ˜¯ç§’æ•°(1-60) ï¼Œvalueæ˜¯ä»»åŠ¡idåˆ—è¡¨</p></li></ul><p><img src="https://pic1.zhimg.com/80/v2-7e9f3e0f1e561c5d02c364d6d48545c0_720w.webp"></p><ul><li>è·å–å½“å‰æ—¶é—´ç§’æ•°</li><li>ä»æ—¶é—´è½®å†…ç§»å‡ºå½“å‰ç§’æ•°å‰2ä¸ªç§’æ•°ï¼ˆé¿å…å¤„ç†è€—æ—¶å¤ªé•¿ï¼Œè·¨è¿‡åˆ»åº¦ï¼Œå‘å‰æ ¡éªŒä¸€ä¸ªåˆ»åº¦ï¼‰çš„ä»»åŠ¡åˆ—è¡¨idï¼Œä¸€ä¸€è§¦å‘ä»»åŠ¡ï¼›</li></ul><p><strong>2ã€å½“xxl-jobåº”ç”¨æœ¬èº«é›†ç¾¤éƒ¨ç½²ï¼ˆå®ç°é«˜å¯ç”¨HAï¼‰æ—¶ï¼Œå¦‚ä½•é¿å…é›†ç¾¤ä¸­çš„å¤šä¸ªæœåŠ¡å™¨åŒæ—¶è°ƒåº¦ä»»åŠ¡ï¼Ÿï¼šé€šè¿‡mysqlæ‚²è§‚é”å®ç°åˆ†å¸ƒå¼é”ï¼ˆfor updateè¯­å¥ï¼‰</strong></p><ul><li>setAutoCommit(false)å…³é—­éšå¼è‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œå¯åŠ¨äº‹åŠ¡</li><li>select lock for updateï¼ˆæ˜¾å¼æ’ä»–é”ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•è¿›å…¥&amp;æ— æ³•å®ç°for updateï¼‰</li><li>è¯»dbä»»åŠ¡ä¿¡æ¯ -&gt; æ‹‰ä»»åŠ¡åˆ°å†…å­˜æ—¶é—´è½® -&gt; æ›´æ–°dbä»»åŠ¡ä¿¡æ¯</li><li>commitæäº¤äº‹åŠ¡ï¼ŒåŒæ—¶ä¼šé‡Šæ”¾for updateçš„æ’ä»–é”ï¼ˆæ‚²è§‚é”ï¼‰</li></ul><p><strong>3ã€ä»»åŠ¡æ‰§è¡Œå™¨æ³¨å†Œä¸­å¿ƒæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</strong></p><ul><li>ä½¿ç”¨dbè¡¨xxl_job_groupè®°å½•ä¸‹æ‰§è¡Œå™¨çš„ä¿¡æ¯ï¼šæ‰§è¡Œå™¨AppNameã€æ‰§è¡Œå™¨åç§°titleã€æ‰§è¡Œå™¨åœ°å€åˆ—è¡¨address_list(å¤šåœ°å€é€—å·åˆ†éš”)</li></ul><p><strong>4ã€å¦‚ä½•å®ç°ä»»åŠ¡æ‰§è¡Œå™¨çš„è·¯ç”±ï¼Ÿ</strong></p><ul><li><p>æ‰§è¡Œå™¨é›†ç¾¤éƒ¨ç½²æ—¶æä¾›ä¸°å¯Œçš„è·¯ç”±ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼šç¬¬ä¸€ä¸ªã€æœ€åä¸€ä¸ªã€è½®è¯¢ã€éšæœºã€ä¸€è‡´æ€§HASHã€æœ€ä¸ç»å¸¸ä½¿ç”¨ã€æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ã€æ•…éšœè½¬ç§»ã€å¿™ç¢Œè½¬ç§»ç­‰ï¼›</p></li><li><p><strong>ç¬¬ä¸€ä¸ªã€æœ€åä¸€ä¸ªã€è½®è¯¢ã€éšæœº</strong>ï¼šéƒ½æ˜¯ç®€å•è¯»address_listå³å¯</p></li><li><p><strong>ä¸€è‡´æ€§HASH</strong>ï¼šTreeSetå®ç°ä¸€è‡´æ€§hashç®—æ³•</p></li><li><p><strong>æœ€ä¸ç»å¸¸ä½¿ç”¨ã€æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨</strong>ï¼šHashMapã€LinkedHashMap</p></li><li><p><strong>æ•…éšœè½¬ç§»</strong>ï¼šéå†address_listè·å–addressæ—¶ï¼Œé€ä¸ªæ£€æŸ¥è¯¥addressçš„å¿ƒè·³ï¼ˆè¯·æ±‚è¿”å›çŠ¶æ€ï¼‰ï¼›åªæœ‰å¿ƒè·³æ­£å¸¸çš„addressæ‰è¿”å›ä½¿ç”¨</p></li><li><p><strong>å¿™ç¢Œè½¬ç§»</strong>ï¼šéå†address_listè·å–addressæ—¶ï¼Œé€ä¸ªæ£€æŸ¥è¯¥addressæ˜¯å¦å¿™ç¢Œï¼ˆè¯·æ±‚è¿”å›çŠ¶æ€ï¼‰ï¼›åªæœ‰çŠ¶æ€ä¸ºidleçš„addressæ‰è¿”å›ä½¿ç”¨</p></li></ul><p><strong>5ã€å¦‚ä½•å®ç°ä»»åŠ¡åˆ†ç‰‡ã€å¹¶è¡Œæ‰§è¡Œï¼Ÿ</strong></p><ul><li>æ‹‰å‡ºä»»åŠ¡çš„æ‰§è¡Œæœºå™¨åˆ—è¡¨ï¼Œé€ä¸ªè®¾ç½®index &#x2F; totalï¼ŒæŠŠindex &#x2F; totalåˆ†å‘åˆ°ä»»åŠ¡æ‰§è¡Œå™¨</li><li>ä»»åŠ¡æ‰§è¡Œå™¨å¯æ ¹æ®index &#x2F; totalå‚æ•°å¼€å‘åˆ†ç‰‡ä»»åŠ¡</li></ul><p>å…¶ä»–æ›´å¤šç‰¹æ€§ï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ä»£ç ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>xxl-job</tag>
      
      <tag>å®šæ—¶ä»»åŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redisé›†ç¾¤æ“ä½œå‘½ä»¤</title>
    <link href="/article/27010637.html"/>
    <url>/article/27010637.html</url>
    
    <content type="html"><![CDATA[<h2 id="redisé›†ç¾¤æ“ä½œ"><a href="#redisé›†ç¾¤æ“ä½œ" class="headerlink" title="redisé›†ç¾¤æ“ä½œ"></a>redisé›†ç¾¤æ“ä½œ</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">//é›†ç¾¤(cluster)  </span><br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> INFO æ‰“å°é›†ç¾¤çš„ä¿¡æ¯  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> NODES åˆ—å‡ºé›†ç¾¤å½“å‰å·²çŸ¥çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆnodeï¼‰ï¼Œä»¥åŠè¿™äº›èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ã€‚   <br><br>ã€€ã€€<span class="hljs-comment">//èŠ‚ç‚¹(node)  </span><br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> MEET &lt;ip&gt; &lt;port&gt; å°† ip å’Œ port æ‰€æŒ‡å®šçš„èŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤å½“ä¸­ï¼Œè®©å®ƒæˆä¸ºé›†ç¾¤çš„ä¸€ä»½å­ã€‚  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> FORGET &lt;node_id&gt; ä»é›†ç¾¤ä¸­ç§»é™¤ node_id æŒ‡å®šçš„èŠ‚ç‚¹ã€‚  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> REPLICATE &lt;node_id&gt; å°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸º node_id æŒ‡å®šçš„èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ã€‚  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> SAVECONFIG å°†èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¿å­˜åˆ°ç¡¬ç›˜é‡Œé¢ã€‚   <br><br>ã€€ã€€<span class="hljs-comment">//æ§½(slot)  </span><br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> ADDSLOTS &lt;slot&gt; [slot ...] å°†ä¸€ä¸ªæˆ–å¤šä¸ªæ§½ï¼ˆslotï¼‰æŒ‡æ´¾ï¼ˆ<span class="hljs-keyword">assign</span>ï¼‰ç»™å½“å‰èŠ‚ç‚¹ã€‚  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> DELSLOTS &lt;slot&gt; [slot ...] ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ§½å¯¹å½“å‰èŠ‚ç‚¹çš„æŒ‡æ´¾ã€‚  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> FLUSHSLOTS ç§»é™¤æŒ‡æ´¾ç»™å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰æ§½ï¼Œè®©å½“å‰èŠ‚ç‚¹å˜æˆä¸€ä¸ªæ²¡æœ‰æŒ‡æ´¾ä»»ä½•æ§½çš„èŠ‚ç‚¹ã€‚  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> SETSLOT &lt;slot&gt; NODE &lt;node_id&gt; å°†æ§½ slot æŒ‡æ´¾ç»™ node_id æŒ‡å®šçš„èŠ‚ç‚¹ï¼Œå¦‚æœæ§½å·²ç»æŒ‡æ´¾ç»™å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå…ˆè®©å¦ä¸€ä¸ªèŠ‚ç‚¹åˆ é™¤è¯¥æ§½&gt;ï¼Œç„¶åå†è¿›è¡ŒæŒ‡æ´¾ã€‚  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> SETSLOT &lt;slot&gt; MIGRATING &lt;node_id&gt; å°†æœ¬èŠ‚ç‚¹çš„æ§½ slot è¿ç§»åˆ° node_id æŒ‡å®šçš„èŠ‚ç‚¹ä¸­ã€‚  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> SETSLOT &lt;slot&gt; IMPORTING &lt;node_id&gt; ä» node_id æŒ‡å®šçš„èŠ‚ç‚¹ä¸­å¯¼å…¥æ§½ slot åˆ°æœ¬èŠ‚ç‚¹ã€‚  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> SETSLOT &lt;slot&gt; STABLE å–æ¶ˆå¯¹æ§½ slot çš„å¯¼å…¥ï¼ˆimportï¼‰æˆ–è€…è¿ç§»ï¼ˆmigrateï¼‰ã€‚   <br><br>ã€€ã€€<span class="hljs-comment">//é”® (key)  </span><br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> KEYSLOT &lt;key&gt; è®¡ç®—é”® key åº”è¯¥è¢«æ”¾ç½®åœ¨å“ªä¸ªæ§½ä¸Šã€‚  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> COUNTKEYSINSLOT &lt;slot&gt; è¿”å›æ§½ slot ç›®å‰åŒ…å«çš„é”®å€¼å¯¹æ•°é‡ã€‚  <br><br>ã€€ã€€<span class="hljs-built_in">CLUSTER</span> GETKEYSINSLOT &lt;slot&gt; &lt;count&gt; è¿”å› count ä¸ª slot æ§½ä¸­çš„é”®ã€‚  <br></code></pre></td></tr></table></figure><p> <strong>Rediså¢åŠ åˆ é™¤ï¼ˆä¼¸ç¼©ï¼‰èŠ‚ç‚¹æ“ä½œæ­¥éª¤.</strong></p><blockquote><p><strong><code>è¯´æ˜ï¼š</code></strong></p><ol><li>ç”±äºæ˜¯ç»ƒä¹ ï¼Œæ‰€ä»¥è®¾ç½®çš„æ˜¯åŒä¸€å°æœåŠ¡å™¨å¤šä¸ªrediså®ä¾‹æ¥æ“ä½œçš„redisé›†ç¾¤ã€‚æ‰€ä»¥ä¸‹é¢çš„æ­¥éª¤æ˜¯åŸºäºè¿™ä¸ªæ¥åšçš„ã€‚å¦‚æœæ˜¯ä¸åŒçš„æœåŠ¡å™¨æ­¥éª¤ç¨å¾®æœ‰ä¸€ç‚¹çš„åŒºåˆ«ã€‚</li><li>Redisç‰ˆæœ¬æ˜¯6.2.6ç‰ˆæœ¬</li><li>å¦‚æœæœ‰å¯†ç ï¼Œå¿…é¡»ä¿è¯æ‰€æœ‰å®ä¾‹çš„å¯†ç ä¸€è‡´ã€‚</li><li>äº‹å…ˆå‡†å¤‡å¥½äº†3ä¸»3ä»6ä¸ªrediså®ä¾‹ã€‚</li></ol></blockquote><!--toc--><h2 id="ä¸€ã€-å¢åŠ èŠ‚ç‚¹"><a href="#ä¸€ã€-å¢åŠ èŠ‚ç‚¹" class="headerlink" title="ä¸€ã€ å¢åŠ èŠ‚ç‚¹"></a>ä¸€ã€ å¢åŠ èŠ‚ç‚¹</h2><p><strong>ä¸»è¦åˆ†ä¸¤ç§æƒ…å†µ</strong></p><ol><li>å¢åŠ èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹</li><li>å¢åŠ èŠ‚ç‚¹æ˜¯ä»èŠ‚ç‚¹</li></ol><h3 id="1ã€å¢åŠ èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹"><a href="#1ã€å¢åŠ èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹" class="headerlink" title="1ã€å¢åŠ èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹"></a>1ã€å¢åŠ èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹</h3><p><strong>éœ€æ±‚ï¼šå¢åŠ 7004ä¸»èŠ‚ç‚¹ï¼Œå¦‚æœéœ€æ±‚éœ€è¦åŒ…å«æŸä¸ªå€¼æˆ–è€…æŸäº›å€¼ä¸€å¹¶ç§»åŠ¨åˆ°æ–°èŠ‚ç‚¹å»ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰¾åˆ°ç§»åŠ¨çš„å€¼çš„æœ€å¤§æ•£åˆ—æ’æ§½çš„å€¼ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</strong></p><ol><li><strong>é¦–å…ˆåˆ›å»ºï¼ˆå¤åˆ¶ï¼‰ä¸€ä¸ªredis.confæ–‡ä»¶ã€‚</strong>ï¼ˆæˆ‘çš„æ˜¯æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢çš„ï¼Œæ‰€ä»¥å°±ç›´æ¥å¤åˆ¶æ–‡ä»¶å¤¹äº†ï¼‰</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> ./redis7001 -r  ./redis7004<br><br></code></pre></td></tr></table></figure><p><strong><code>å‚æ•°è¯´æ˜ï¼š</code></strong></p><ul><li><code>cp:</code>å¤åˆ¶å‘½ä»¤ã€‚</li><li><code>-r:</code>é€’å½’å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹ã€‚å¿½ç•¥redis7004è¿™ä¸ªè¿™ä¸ªç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼ˆç›®å½•ï¼‰ã€‚</li></ul><ol start="2"><li><strong>ä¿®æ”¹å¤åˆ¶çš„æ–‡ä»¶ç«¯å£å·ï¼Œæ—¥å¿—æ–‡ä»¶åœ°å€åå­—ï¼Œè¿˜æœ‰RDBæ–‡ä»¶åï¼ˆä¸‡ä¸€åæœŸè‡ªåŠ¨é€‰ä¸¾æˆä¸»èŠ‚ç‚¹äº†å‘¢ï¼‰ç­‰å¿…è¦çš„ä¿¡æ¯ã€‚</strong></li></ol><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#å…¨å±€æœç´¢æ–‡ä»¶.<span class="hljs-regexp">/redis7004/</span>conf/redis.confçš„æ‰€æœ‰<span class="hljs-number">7001</span>æ”¹æˆ<span class="hljs-number">7004</span>ã€‚<br>sed -i s<span class="hljs-regexp">/7001/</span><span class="hljs-number">7004</span><span class="hljs-regexp">/g ./</span>redis7004<span class="hljs-regexp">/conf/</span>redis.conf <br><br></code></pre></td></tr></table></figure><ol start="3"><li><strong>å¯åŠ¨æœåŠ¡ã€‚</strong></li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">redis-server <span class="hljs-regexp">/www/</span>server<span class="hljs-regexp">/redis/</span>redis7004<span class="hljs-regexp">/conf/</span>redis.conf <br><br></code></pre></td></tr></table></figure><ol start="4"><li><strong>å°†7004èŠ‚ç‚¹æ·»åŠ åˆ°æˆ‘ä»¬çš„é›†ç¾¤èŠ‚ç‚¹ä¸­ã€‚</strong></li></ol><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs smali"><span class="hljs-comment">#1.å‘½ä»¤ï¼šold_ipåªè¦æ˜¯é›†ç¾¤ä¸­çš„ä»»æ„ä¸€ä¸ªipå³å¯</span><br>redis-cli -a [password] --cluster<span class="hljs-built_in"> add-node </span>[new_ip] [old_ip]<br><span class="hljs-comment">#2.ä¾‹å­</span><br>redis-cli -a 123456 --cluster<span class="hljs-built_in"> add-node </span>127.0.0.1:7004 127.0.0.1:7001<br><br></code></pre></td></tr></table></figure><ol start="5"><li><strong>æŸ¥çœ‹æ˜¯å¦æ·»åŠ åˆ°é›†ç¾¤ä¸­æˆåŠŸã€‚</strong></li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-id">#1</span>.å‘½ä»¤<br>redis-cli -<span class="hljs-selector-tag">a</span> <span class="hljs-selector-attr">[password]</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-selector-attr">[ip]</span> cluster nodes<br>#æŸ¥çœ‹é›†ç¾¤çš„å‘½ä»¤<br>redis-cli <span class="hljs-attr">--cluster</span> help<br><span class="hljs-selector-id">#2</span>.ä¾‹å­<br>redis-cli -<span class="hljs-selector-tag">a</span> <span class="hljs-number">123456</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-number">7004</span> cluster nodes<br><br></code></pre></td></tr></table></figure><ol start="6"><li><strong>åˆ†é…æ•£åˆ—æ§½</strong></li></ol><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment">#1.å‘½ä»¤</span><br>redis-cli -a [password] --cluster reshard [new_ip]<br><span class="hljs-comment">#2.ä¾‹å­</span><br>redis-cli -a <span class="hljs-number">123456</span> --cluster reshard <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span><br>[root@T98899999 redis]<span class="hljs-comment"># redis-cli -a 123456 --cluster reshard 127.0.0.1:7004</span><br>Warning: Using a password with &#x27;-a&#x27; <span class="hljs-keyword">or</span> &#x27;-u&#x27; option on the command line interface may not be safe.<br>&gt;&gt;&gt; Performing Cluster Check (using <span class="hljs-keyword">node</span> <span class="hljs-title">127</span>.<span class="hljs-number">0.0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">7004</span>)<br>M: <span class="hljs-number">11</span>c3459ccdb510973ed5e61a755aaecc923405f7 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span><br>   slots: (<span class="hljs-number">0</span> slots) <span class="hljs-keyword">master</span><br><span class="hljs-title">S</span>: c836695daad38bcea59eb71dece7f860eab5f15e <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8003</span><br>   slots: (<span class="hljs-number">0</span> slots) <span class="hljs-literal">slave</span><br>   replicates <span class="hljs-number">8140</span>ca0e986ec863881b6dede6f7555d04fe5c06<br>S: <span class="hljs-number">633546</span>d3d75199e202d66ac56bca7e4c387bb453 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8002</span><br>   slots: (<span class="hljs-number">0</span> slots) <span class="hljs-literal">slave</span><br>   replicates <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818<br>M: <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7001</span><br>   slots:[<span class="hljs-number">0</span>-<span class="hljs-number">5460</span>] (<span class="hljs-number">5461</span> slots) <span class="hljs-keyword">master</span><br>   <span class="hljs-title">1</span> additional replica(s)<br>M: <span class="hljs-number">8140</span>ca0e986ec863881b6dede6f7555d04fe5c06 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7002</span><br>   slots:[<span class="hljs-number">5461</span>-<span class="hljs-number">10922</span>] (<span class="hljs-number">5462</span> slots) <span class="hljs-keyword">master</span><br>   <span class="hljs-title">1</span> additional replica(s)<br>S: e236e0ec685118abc67da92ad67c2db4b3f1abc6 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8001</span><br>   slots: (<span class="hljs-number">0</span> slots) <span class="hljs-literal">slave</span><br>   replicates <span class="hljs-number">4</span>efa79ebad2f410049ab59edf695d6be63ed0a25<br>M: <span class="hljs-number">4</span>efa79ebad2f410049ab59edf695d6be63ed0a25 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7003</span><br>   slots:[<span class="hljs-number">10923</span>-<span class="hljs-number">16383</span>] (<span class="hljs-number">5461</span> slots) <span class="hljs-keyword">master</span><br>   <span class="hljs-title">1</span> additional replica(s)<br>[OK] All nodes agree about slots configuration.<br>&gt;&gt;&gt; Check for open slots...<br>&gt;&gt;&gt; Check slots coverage...<br>[OK] All <span class="hljs-number">16384</span> slots covered.<br>How many slots do you want to move (from <span class="hljs-number">1</span> to <span class="hljs-number">16384</span>)? <span class="hljs-number">100</span><br>What is the receiving <span class="hljs-keyword">node</span> <span class="hljs-title">ID</span>? <span class="hljs-number">11</span>c3459ccdb510973ed5e61a755aaecc923405f7<br>Please enter all the source <span class="hljs-keyword">node</span> <span class="hljs-title">IDs</span>.<br>  <span class="hljs-keyword">Type</span> &#x27;all&#x27; to use all the nodes as source nodes for the hash slots.<br>  <span class="hljs-keyword">Type</span> &#x27;done&#x27; once you entered all the source nodes IDs.<br>Source <span class="hljs-keyword">node</span> <span class="hljs-title">#1</span>: <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818<br>Source <span class="hljs-keyword">node</span> <span class="hljs-title">#2</span>: done<br>Ready to move <span class="hljs-number">100</span> slots.<br>  Source nodes:<br>    M: <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7001</span><br>       slots:[<span class="hljs-number">0</span>-<span class="hljs-number">5460</span>] (<span class="hljs-number">5461</span> slots) <span class="hljs-keyword">master</span><br>       <span class="hljs-title">1</span> additional replica(s)<br>  Destination <span class="hljs-keyword">node</span><span class="hljs-title">:</span><br><span class="hljs-title">    M</span>: <span class="hljs-number">11</span>c3459ccdb510973ed5e61a755aaecc923405f7 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span><br>       slots: (<span class="hljs-number">0</span> slots) <span class="hljs-keyword">master</span><br>  <span class="hljs-title">Resharding</span> plan:<br>    Moving slot <span class="hljs-number">0</span> from <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818<br>    Moving slot <span class="hljs-number">1</span> from <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818<br>    Moving slot <span class="hljs-number">2</span> from <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818<br>.....<br>Do you want to proceed with the proposed reshard plan (yes/no)? yes<br><br></code></pre></td></tr></table></figure><p><strong><code>è¯´æ˜ä¸‹æ‰§è¡Œå‘½ä»¤redis-cli -a 123456 --cluster reshard 127.0.0.1:7004æ—¶å‡ºç°çš„è¯¢é—®ï¼š</code></strong></p><ul><li><code>How many slots do you want to move (from 1 to 16384)?:</code>è¡¨ç¤ºéœ€è¦ç§»åŠ¨æ§½çš„æ•°é‡ã€‚å¡«å†™è‡ªå·±çš„éœ€è¦å³å¯ã€‚</li><li><code>What is the receiving node ID?ï¼š</code>è¡¨ç¤ºï¼šé‚£ä¸ªidæ¥æ¥æ”¶å®ƒã€‚å³æ–°çš„7004çš„idã€‚</li><li><code>Source node #1:</code>ä»é‚£ä¸ªèŠ‚ç‚¹idä¸Šç§»åŠ¨æ•£åˆ—æ’æ§½ã€‚å¡«å†™ç§»åŠ¨çš„7001çš„idã€‚å½“ç„¶å¦‚æœéœ€è¦å¹³å‡èŠ‚ç‚¹æ’æ§½ï¼Œé‚£ä¹ˆæ¯ä¸ªä¸»èŠ‚ç‚¹çš„idéƒ½å†™ä¸Šæˆ–è€…å†™allï¼Œç„¶åéœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹æ•°é‡å¤„ç†ä¸»èŠ‚ç‚¹æ•°ã€‚</li><li><code>Source node #2:</code>æœ€åæ—¶å¡«å†™doneç»“æŸã€‚</li><li><code>Do you want to proceed with the proposed reshard plan (yes/no)?ï¼š</code>ç¡®å®šè¦ç§»åŠ¨è¿™äº›æ§½çš„è®¡åˆ’å—ï¼Ÿè¾“å…¥yesæˆ–è€…noã€‚</li></ul><blockquote><p><strong>è¡¥å……è¯´æ˜ï¼š</strong><br>å¦‚æœéœ€è¦åŒ…å«æŸä¸ªå€¼ç§»åŠ¨åˆ°æ–°çš„èŠ‚ç‚¹ï¼ˆ7004ï¼‰ä¸Šï¼Œé‚£ä¹ˆå°±éœ€è¦æŸ¥è¯¢åˆ°ç§»åŠ¨çš„å€¼çš„æ•£åˆ—æ’æ§½å€¼æ˜¯å¤šå°‘ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">redis-cli -a <span class="hljs-number">123456</span>-c -p <span class="hljs-number">7004</span><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">Using</span> a <span class="hljs-keyword">password</span> <span class="hljs-keyword">with</span> <span class="hljs-string">&#x27;-a&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;-u&#x27;</span> <span class="hljs-keyword">option</span> <span class="hljs-keyword">on</span> the command <span class="hljs-type">line</span> interface may <span class="hljs-keyword">not</span> be safe.<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">7004</span>&gt; <span class="hljs-keyword">get</span> num<br> Redirected <span class="hljs-keyword">to</span> slot [<span class="hljs-number">2765</span>] located at <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">7001</span><br> &quot;10&quot;<br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°numçš„slotæ§½æ˜¯2765ã€‚</p></blockquote><ol start="7"><li><strong>æŸ¥çœ‹æ˜¯å¦æ·»åŠ æˆåŠŸã€‚</strong></li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">redis</span>-cli -a <span class="hljs-number">123456</span> -p <span class="hljs-number">7004</span> cluster nodes<br><span class="hljs-comment">#ç»“æœï¼Œå¯ä»¥å‘ç°7004ä¸Šæœ‰0-99å…±100ä¸ªæ•£åˆ—æ’æ§½</span><br> <span class="hljs-attribute">redis</span>-cli -a <span class="hljs-number">123456</span> -p <span class="hljs-number">7004</span> cluster nodes<br><span class="hljs-attribute">Warning</span>: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option <span class="hljs-literal">on</span> the command line interface may not be safe.<br><span class="hljs-attribute">c836695daad38bcea59eb71dece7f860eab5f15e</span> <span class="hljs-number">127.0.0.1:8003</span>@<span class="hljs-number">18003</span> slave <span class="hljs-number">8140</span>ca0e986ec863881b6dede6f7555d04fe5c06 <span class="hljs-number">0</span> <span class="hljs-number">1656342598000</span> <span class="hljs-number">2</span> connected<br><span class="hljs-attribute">11c3459ccdb510973ed5e61a755aaecc923405f7</span> <span class="hljs-number">127.0.0.1:7004</span>@<span class="hljs-number">17004</span> myself,master - <span class="hljs-number">0</span> <span class="hljs-number">1656342595000</span> <span class="hljs-number">9</span> connected <span class="hljs-number">0</span>-<span class="hljs-number">99</span><br><span class="hljs-attribute">633546d3d75199e202d66ac56bca7e4c387bb453</span> <span class="hljs-number">127.0.0.1:8002</span>@<span class="hljs-number">18002</span> slave <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818 <span class="hljs-number">0</span> <span class="hljs-number">1656342597000</span> <span class="hljs-number">8</span> connected<br><span class="hljs-attribute">145b99ca42e4ddf2ad7fc43bdbc410ed0729e818</span> <span class="hljs-number">127.0.0.1:7001</span>@<span class="hljs-number">17001</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1656342596000</span> <span class="hljs-number">8</span> connected <span class="hljs-number">100</span>-<span class="hljs-number">5460</span><br><span class="hljs-attribute">8140ca0e986ec863881b6dede6f7555d04fe5c06</span> <span class="hljs-number">127.0.0.1:7002</span>@<span class="hljs-number">17002</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1656342598804</span> <span class="hljs-number">2</span> connected <span class="hljs-number">5461</span>-<span class="hljs-number">10922</span><br><span class="hljs-attribute">e236e0ec685118abc67da92ad67c2db4b3f1abc6</span> <span class="hljs-number">127.0.0.1:8001</span>@<span class="hljs-number">18001</span> slave <span class="hljs-number">4</span>efa79ebad2f410049ab59edf695d6be63ed0a25 <span class="hljs-number">0</span> <span class="hljs-number">1656342597801</span> <span class="hljs-number">3</span> connected<br><span class="hljs-attribute">4efa79ebad2f410049ab59edf695d6be63ed0a25</span> <span class="hljs-number">127.0.0.1:7003</span>@<span class="hljs-number">17003</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1656342595777</span> <span class="hljs-number">3</span> connected <span class="hljs-number">10923</span>-<span class="hljs-number">16383</span><br><br><br></code></pre></td></tr></table></figure><h3 id="2ã€å¢åŠ slaveèŠ‚ç‚¹"><a href="#2ã€å¢åŠ slaveèŠ‚ç‚¹" class="headerlink" title="2ã€å¢åŠ slaveèŠ‚ç‚¹"></a>2ã€å¢åŠ slaveèŠ‚ç‚¹</h3><p><strong>éœ€æ±‚æƒ³è¦åœ¨master7001ä¸Šå¢åŠ 7004å­èŠ‚ç‚¹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼ˆå‰é¢çš„ä¸»èŠ‚ç‚¹å‰3ä¸ªæ­¥éª¤ä¸æƒ…å†µ1ä¸€æ ·çš„ï¼‰ï¼š</strong></p><ol><li><strong>é¦–å…ˆåˆ›å»ºï¼ˆå¤åˆ¶ï¼‰ä¸€ä¸ªredis.confæ–‡ä»¶ã€‚</strong>ï¼ˆæˆ‘çš„æ˜¯æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢çš„ï¼Œæ‰€ä»¥å°±ç›´æ¥å¤åˆ¶æ–‡ä»¶å¤¹äº†ï¼‰</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> ./redis7001 -r  ./redis7004<br><br></code></pre></td></tr></table></figure><p><strong><code>å‚æ•°è¯´æ˜ï¼š</code></strong></p><ul><li><code>cp:</code>å¤åˆ¶å‘½ä»¤ã€‚</li><li><code>-r:</code>é€’å½’å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹ã€‚å¿½ç•¥redis7004è¿™ä¸ªè¿™ä¸ªç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼ˆç›®å½•ï¼‰ã€‚</li></ul><ol start="2"><li><strong>ä¿®æ”¹å¤åˆ¶çš„æ–‡ä»¶ç«¯å£å·ï¼Œæ—¥å¿—æ–‡ä»¶åœ°å€åå­—ï¼Œè¿˜æœ‰RDBæ–‡ä»¶åï¼ˆä¸‡ä¸€åæœŸè‡ªåŠ¨é€‰ä¸¾æˆä¸»èŠ‚ç‚¹äº†å‘¢ï¼‰ç­‰å¿…è¦çš„ä¿¡æ¯ã€‚</strong></li></ol><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#å…¨å±€æœç´¢æ–‡ä»¶.<span class="hljs-regexp">/redis7004/</span>conf/redis.confçš„æ‰€æœ‰<span class="hljs-number">7001</span>æ”¹æˆ<span class="hljs-number">7004</span>ã€‚<br>sed -i s<span class="hljs-regexp">/7001/</span><span class="hljs-number">7004</span><span class="hljs-regexp">/g ./</span>redis7004<span class="hljs-regexp">/conf/</span>redis.conf <br><br></code></pre></td></tr></table></figure><ol start="3"><li><strong>å¯åŠ¨æœåŠ¡ã€‚</strong></li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">redis-server <span class="hljs-regexp">/www/</span>server<span class="hljs-regexp">/redis/</span>redis7004<span class="hljs-regexp">/conf/</span>redis.conf <br><br></code></pre></td></tr></table></figure><ol start="4"><li>æ·»åŠ åˆ°é›†ç¾¤ä¸­è®¾ç½®ä¸ºä»èŠ‚ç‚¹</li></ol><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs smali"><span class="hljs-comment">#1,å‘½ä»¤</span><br>redis-cli -a [password] --cluster<span class="hljs-built_in"> add-node </span>[old_host:old_port] -a [password] --cluster-slave [old_id]<br><span class="hljs-comment">#2.æœ€å¿«æ·çš„æ–¹å¼ï¼ˆå½“ç„¶ä½ é¦–å…ˆè¦æŸ¥çœ‹ä¸»èŠ‚ç‚¹çš„idï¼‰</span><br>redis-cli -a 123456 --cluster<span class="hljs-built_in"> add-node </span>127.0.0.1:7004 127.0.0.1:7001 -a 123456 --cluster-slave 145b99ca42e4ddf2ad7fc43bdbc410ed0729e818<br><br></code></pre></td></tr></table></figure><p><strong><code>å‚æ•°è¯´æ˜ï¼š</code></strong></p><ul><li><code>-a 123456 :</code> å¦‚æœredisæœ‰å¯†ç åˆ™éœ€è¦åŠ è¿™ä¸ªå‘½ä»¤</li><li><code>127.0.0.1:7004ï¼š</code>æ–°èŠ‚ç‚¹host+port</li><li><code>127.0.0.1:7001ï¼š</code>å·²ç»å­˜åœ¨é›†ç¾¤çš„ä»»æ„host+ç«¯å£</li><li><code>--cluster-slaveï¼š</code>è¡¨ç¤ºæ–°çš„èŠ‚ç‚¹æ˜¯ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå¦‚æœåé¢æ²¡æœ‰è·ŸIDåˆ™éšæœºåˆ†é…åˆ°ä¸€ä¸ªmasterä¸‹ã€‚</li><li><code>145b99ca42e4ddf2ad7fc43bdbc410ed0729e818</code>ï¼šæŒ‡å®šmasterçš„ID</li></ul><ol start="5"><li><strong>æŸ¥çœ‹æ˜¯å¦æ·»åŠ æˆåŠŸ</strong></li></ol><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dns">[root@T<span class="hljs-number">98899999</span> ~]# redis-cli -a <span class="hljs-number">123456</span> -p  <span class="hljs-number">7001</span> cluster nodes<br>Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.<br><span class="hljs-number">4</span>efa79ebad2f410049ab59edf695d6be63ed<span class="hljs-number">0a25 127.0</span>.<span class="hljs-number">0.1:7003</span>@<span class="hljs-number">17003</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1654181965000</span> <span class="hljs-number">3</span> connected <span class="hljs-number">10923-16383</span><br><span class="hljs-number">11</span>c3459ccdb510973ed5e61a755aaecc<span class="hljs-number">923405f7</span> `<span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7004@17004</span> slave` `<span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed<span class="hljs-number">0729e818</span>` <span class="hljs-number">0</span> <span class="hljs-number">1654181966807</span> <span class="hljs-number">8</span> connected<br><span class="hljs-number">8140</span>ca0e986ec863881b6dede6f7555d04fe<span class="hljs-number">5c06 127.0</span>.<span class="hljs-number">0.1:7002</span>@<span class="hljs-number">17002</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1654181968816</span> <span class="hljs-number">2</span> connected <span class="hljs-number">5461-10922</span><br>e236e0ec685118abc67da92ad67c2db4b3f1abc<span class="hljs-number">6 127.0.0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">8001@18001</span> slave <span class="hljs-number">4</span>efa79ebad2f410049ab59edf695d6be63ed0a25 <span class="hljs-number">0</span> <span class="hljs-number">1654181965801</span> <span class="hljs-number">3</span> connected<br>c836695daad38bcea59eb71dece7f860eab5f15e <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">8003@18003</span> slave <span class="hljs-number">8140</span>ca0e986ec863881b6dede6f7555d04fe5c06 <span class="hljs-number">0</span> <span class="hljs-number">1654181967000</span> <span class="hljs-number">2</span> connected<br>`<span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed<span class="hljs-number">0729e818</span>` <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7001@17001</span> myself,master - <span class="hljs-number">0</span> <span class="hljs-number">1654181964000</span> <span class="hljs-number">8</span> connected <span class="hljs-number">0</span>-<span class="hljs-number">5460</span><br><span class="hljs-number">633546d</span>3d75199e202d66ac56bca7e4c387bb<span class="hljs-number">453 127.0</span>.<span class="hljs-number">0.1:8002</span>@<span class="hljs-number">18002</span> slave <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed<span class="hljs-number">0729e818</span> <span class="hljs-number">0</span> <span class="hljs-number">1654181967812</span> <span class="hljs-number">8</span> connected<br><br></code></pre></td></tr></table></figure><h2 id="äºŒã€åˆ é™¤èŠ‚ç‚¹"><a href="#äºŒã€åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="äºŒã€åˆ é™¤èŠ‚ç‚¹"></a>äºŒã€åˆ é™¤èŠ‚ç‚¹</h2><p><strong>ä¸»è¦åˆ†ä¸¤ç§æƒ…å†µ</strong></p><ol><li>åˆ é™¤èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹</li><li>åˆ é™¤èŠ‚ç‚¹æ˜¯ä»èŠ‚</li></ol><h3 id="1ã€åˆ é™¤ä¸»èŠ‚ç‚¹7004"><a href="#1ã€åˆ é™¤ä¸»èŠ‚ç‚¹7004" class="headerlink" title="1ã€åˆ é™¤ä¸»èŠ‚ç‚¹7004"></a>1ã€åˆ é™¤ä¸»èŠ‚ç‚¹7004</h3><p><strong><code>å› ä¸ºä¸»èŠ‚ç‚¹æ˜¯åˆ†é…äº†slotæ§½çš„ï¼Œæ‰€ä»¥éœ€è¦æŠŠåˆ é™¤èŠ‚ç‚¹çš„soltæ§½ç§»åŠ¨åˆ°å…¶ä»–masterèŠ‚ç‚¹ä¸­å»ï¼Œå¦åˆ™æ•°æ®ä¼šä¸¢å¤±ã€‚</code></strong></p><p><strong>éœ€æ±‚æƒ³è¦åˆ é™¤7004èŠ‚ç‚¹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</strong></p><ul><li><strong>æ•°æ®è¿ç§»åˆ°å…¶ä»–ä¸»èŠ‚ç‚¹ä¸­ ï¼ˆé€»è¾‘å’Œæ·»åŠ èŠ‚ç‚¹åˆ†é…æ•£åˆ—æ§½ä¸€æ ·ï¼‰</strong></li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment">#1.æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯ -a password å¦‚æœæ²¡æœ‰å¯†ç å°±ä¸éœ€è¦è¿™ä¸ªå‘½ä»¤</span><br>redis-cli -a <span class="hljs-number">123456</span> -p <span class="hljs-number">7004</span> cluster nodes<br>Warning: Using a password with &#x27;-a&#x27; <span class="hljs-keyword">or</span> &#x27;-u&#x27; option on the command line interface may not be safe.<br>e236e0ec685118abc67da92ad67c2db4b3f1abc6 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8001</span>@<span class="hljs-number">18001</span> <span class="hljs-literal">slave</span> <span class="hljs-number">4</span>efa79ebad2f410049ab59edf695d6be63ed0a25 <span class="hljs-number">0</span> <span class="hljs-number">1654091452576</span> <span class="hljs-number">3</span> connected<br>c836695daad38bcea59eb71dece7f860eab5f15e <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8003</span>@<span class="hljs-number">18003</span> <span class="hljs-literal">slave</span> <span class="hljs-number">8140</span>ca0e986ec863881b6dede6f7555d04fe5c06 <span class="hljs-number">0</span> <span class="hljs-number">1654091452000</span> <span class="hljs-number">2</span> connected<br><span class="hljs-number">4</span>efa79ebad2f410049ab59edf695d6be63ed0a25 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7003</span>@<span class="hljs-number">17003</span> <span class="hljs-keyword">master</span> <span class="hljs-title">- 0</span> <span class="hljs-number">1654091453593</span> <span class="hljs-number">3</span> connected <span class="hljs-number">10923</span>-<span class="hljs-number">16383</span><br><span class="hljs-number">633546</span>d3d75199e202d66ac56bca7e4c387bb453 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8002</span>@<span class="hljs-number">18002</span> <span class="hljs-literal">slave</span> <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818 <span class="hljs-number">0</span> <span class="hljs-number">1654091452000</span> <span class="hljs-number">1</span> connected<br><span class="hljs-number">11</span>c3459ccdb510973ed5e61a755aaecc923405f7 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span>@<span class="hljs-number">17004</span> myself,<span class="hljs-keyword">master</span> <span class="hljs-title">- 0</span> <span class="hljs-number">1654091451000</span> <span class="hljs-number">7</span> connected <span class="hljs-number">0</span>-<span class="hljs-number">2999</span><br><span class="hljs-number">8140</span>ca0e986ec863881b6dede6f7555d04fe5c06 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7002</span>@<span class="hljs-number">17002</span> <span class="hljs-keyword">master</span> <span class="hljs-title">- 0</span> <span class="hljs-number">1654091453000</span> <span class="hljs-number">2</span> connected <span class="hljs-number">5461</span>-<span class="hljs-number">10922</span><br><span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7001</span>@<span class="hljs-number">17001</span> <span class="hljs-keyword">master</span> <span class="hljs-title">- 0</span> <span class="hljs-number">1654091454597</span> <span class="hljs-number">1</span> connected <span class="hljs-number">3000</span>-<span class="hljs-number">5460</span><br><span class="hljs-comment">#2.ç§»åŠ¨slotæ§½:éœ€è¦æ³¨æ„çš„æ˜¯idé¡ºåºä¸è¦æé”™äº† </span><br><span class="hljs-comment">#2.1 æ‰§è¡Œå‘½ä»¤ï¼šredis-cli -a 123456 --cluster reshard 127.0.0.1:7004</span><br><span class="hljs-comment">#2.2 ä¼šå‡ºç°å¦‚ä¸‹çš„å†…å®¹ï¼šèƒ½çœ‹åˆ°ä½ è¦ç§»é™¤èŠ‚ç‚¹çš„slotsæ§½</span><br>redis-cli -a <span class="hljs-number">123456</span> --cluster reshard <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span><br>Warning: Using a <span class="hljs-number">123456</span> with &#x27;-a&#x27; <span class="hljs-keyword">or</span> &#x27;-u&#x27; option on the command line interface may not be safe.<br>&gt;&gt;&gt; Performing Cluster Check (using <span class="hljs-keyword">node</span> <span class="hljs-title">127</span>.<span class="hljs-number">0.0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">7004</span>)<br>M: <span class="hljs-number">11</span>c3459ccdb510973ed5e61a755aaecc923405f7 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span><br>   slots:[<span class="hljs-number">0</span>-<span class="hljs-number">2999</span>] (<span class="hljs-number">3000</span> slots) <span class="hljs-keyword">master</span><br>   <span class="hljs-title">1</span> additional replica(s)<br>S: e236e0ec685118abc67da92ad67c2db4b3f1abc6 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8001</span><br>   slots: (<span class="hljs-number">0</span> slots) <span class="hljs-literal">slave</span><br>   replicates <span class="hljs-number">4</span>efa79ebad2f410049ab59edf695d6be63ed0a25<br>S: c836695daad38bcea59eb71dece7f860eab5f15e <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8003</span><br>   slots: (<span class="hljs-number">0</span> slots) <span class="hljs-literal">slave</span><br>   replicates <span class="hljs-number">8140</span>ca0e986ec863881b6dede6f7555d04fe5c06<br>M: <span class="hljs-number">4</span>efa79ebad2f410049ab59edf695d6be63ed0a25 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7003</span><br>   slots:[<span class="hljs-number">10923</span>-<span class="hljs-number">16383</span>] (<span class="hljs-number">5461</span> slots) <span class="hljs-keyword">master</span><br>   <span class="hljs-title">1</span> additional replica(s)<br>S: <span class="hljs-number">633546</span>d3d75199e202d66ac56bca7e4c387bb453 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8002</span><br>   slots: (<span class="hljs-number">0</span> slots) <span class="hljs-literal">slave</span><br>   replicates <span class="hljs-number">11</span>c3459ccdb510973ed5e61a755aaecc923405f7<br>M: <span class="hljs-number">8140</span>ca0e986ec863881b6dede6f7555d04fe5c06 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7002</span><br>   slots:[<span class="hljs-number">5461</span>-<span class="hljs-number">10922</span>] (<span class="hljs-number">5462</span> slots) <span class="hljs-keyword">master</span><br>   <span class="hljs-title">1</span> additional replica(s)<br>M: <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7001</span><br>   slots:[<span class="hljs-number">3000</span>-<span class="hljs-number">5460</span>] (<span class="hljs-number">2641</span> slots) <span class="hljs-keyword">master</span><br><span class="hljs-title">[OK</span>] All nodes agree about slots configuration.<br>&gt;&gt;&gt; Check for open slots...<br>&gt;&gt;&gt; Check slots coverage...<br>[OK] All <span class="hljs-number">16384</span> slots covered.<br><span class="hljs-comment">#2.3è¡¨ç¤ºç§»åŠ¨slotsçš„æ•°é‡</span><br>How many slots do you want to move (from <span class="hljs-number">1</span> to <span class="hljs-number">16384</span>)?<span class="hljs-number">3000</span><br><span class="hljs-comment">#2.4 è¡¨ç¤ºç§»åŠ¨åˆ°é‚£ä¸ªèŠ‚ç‚¹IDï¼ˆæˆ–è€…è¯´é‚£ä¸ªèŠ‚ç‚¹IDæ¥æ¥å—è¿™ä¸ªç§»åŠ¨çš„slotsï¼‰</span><br>What is the receiving <span class="hljs-keyword">node</span> <span class="hljs-title">ID</span>? <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed0729e818<br><span class="hljs-comment">#2.5 è¡¨ç¤ºé‚£ä¸ªèŠ‚ç‚¹IDéœ€è¦ç§»åŠ¨</span><br>Please enter all the source <span class="hljs-keyword">node</span> <span class="hljs-title">IDs</span>.<br>  <span class="hljs-keyword">Type</span> &#x27;all&#x27; to use all the nodes as source nodes for the hash slots.<br>  <span class="hljs-keyword">Type</span> &#x27;done&#x27; once you entered all the source nodes IDs.<br>Source <span class="hljs-keyword">node</span> <span class="hljs-title">#1</span>: <span class="hljs-number">11</span>c3459ccdb510973ed5e61a755aaecc923405f7<br><span class="hljs-comment">#2.6è¾“å…¥done</span><br>Source <span class="hljs-keyword">node</span> <span class="hljs-title">#1</span>:done<br><span class="hljs-comment">#2.7æœ€åç¡®è®¤æ˜¯å¦æ˜¯æƒ³è¦çš„ç»“æœ</span><br>Do you want to proceed with the proposed reshard plan (yes/no)? yes<br><span class="hljs-comment">#2.8 å¼€å§‹æ‰§è¡Œç§»åŠ¨åŠŸèƒ½ã€‚ç­‰ç€ç§»åŠ¨å®Œæˆåå°±å¯ä»¥åˆ é™¤èŠ‚ç‚¹äº†ã€‚</span><br>Moving slot <span class="hljs-number">1546</span> from <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span> to <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7001</span>: <br>Moving slot <span class="hljs-number">1547</span> from <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span> to <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7001</span>: <br>Moving slot <span class="hljs-number">1548</span> from <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span> to <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7001</span>: <br>Moving slot <span class="hljs-number">1549</span> from <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span> to <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7001</span>: <br>çœç•¥.....<br><span class="hljs-comment">#3.å¯ä»¥å†æ¬¡æ‰§è¡Œ1å‘½ä»¤æ£€æŸ¥ä¸€ä¸‹</span><br><br></code></pre></td></tr></table></figure><p><strong><code>ç”¨åˆ°çš„å‘½ä»¤ï¼š</code></strong></p><ul><li><code>redis-cli -a password -p 7004 cluster nodes</code></li><li><code>redis-cli -a password --cluster reshard host:prot</code></li></ul><ol start="2"><li><strong>æ‰§è¡Œåˆ é™¤å‘½ä»¤</strong>:</li></ol><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-string">#1</span>.å‘½ä»¤<br>redis-cli -a password --cluster del-node ip:prot åˆ é™¤ç‚¹ID<br><span class="hljs-string">#2</span>.ä¾‹å­<br>[root@T98899999 ~]# redis-cli -a <span class="hljs-number">123456</span> --cluster del-node <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span> <span class="hljs-number">11</span>c3459ccdb510973ed5e61a755aaecc923405f7<br>Warning: <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">with</span> <span class="hljs-string">&#x27;-a&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;-u&#x27;</span> option <span class="hljs-keyword">on</span> the command line <span class="hljs-keyword">interface</span> may <span class="hljs-keyword">not</span> be safe.<br>&gt;&gt;&gt; Removing node <span class="hljs-number">11</span>c3459ccdb510973ed5e61a755aaecc923405f7 <span class="hljs-keyword">from</span> cluster <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7004</span><br>&gt;&gt;&gt; Sending CLUSTER FORGET messages <span class="hljs-keyword">to</span> the cluster...<br>&gt;&gt;&gt; Sending CLUSTER RESET <span class="hljs-keyword">SOFT</span> <span class="hljs-keyword">to</span> the deleted node.<br><br></code></pre></td></tr></table></figure><ol start="3"><li><strong>æŸ¥çœ‹æ˜¯å¦åˆ é™¤æˆåŠŸ(å‘ç°å·²ç»æ²¡æœ‰è¿™ä¸ªèŠ‚ç‚¹äº†)</strong></li></ol><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dns">[root@T<span class="hljs-number">98899999</span> ~]# redis-cli -a <span class="hljs-number">123456</span> -p <span class="hljs-number">7001</span> cluster nodes<br>Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.<br><br><span class="hljs-number">4</span>efa79ebad2f410049ab59edf695d6be63ed<span class="hljs-number">0a25 127.0</span>.<span class="hljs-number">0.1:7003</span>@<span class="hljs-number">17003</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1654095165860</span> <span class="hljs-number">3</span> connected <span class="hljs-number">10923-16383</span><br><br><span class="hljs-number">8140</span>ca0e986ec863881b6dede6f7555d04fe<span class="hljs-number">5c06 127.0</span>.<span class="hljs-number">0.1:7002</span>@<span class="hljs-number">17002</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1654095164857</span> <span class="hljs-number">2</span> connected <span class="hljs-number">5461-10922</span><br><br>e236e0ec685118abc67da92ad67c2db4b3f1abc<span class="hljs-number">6 127.0.0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">8001@18001</span> slave <span class="hljs-number">4</span>efa79ebad2f410049ab59edf695d6be63ed0a25 <span class="hljs-number">0</span> <span class="hljs-number">1654095163854</span> <span class="hljs-number">3</span> connected<br><br>c836695daad38bcea59eb71dece7f860eab5f15e <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">8003@18003</span> slave <span class="hljs-number">8140</span>ca0e986ec863881b6dede6f7555d04fe5c06 <span class="hljs-number">0</span> <span class="hljs-number">1654095164000</span> <span class="hljs-number">2</span> connected<br><br><span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed<span class="hljs-number">0729e818</span> <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">7001@17001</span> myself,master - <span class="hljs-number">0</span> <span class="hljs-number">1654095164000</span> <span class="hljs-number">8</span> connected <span class="hljs-number">0</span>-<span class="hljs-number">5460</span><br><br><span class="hljs-number">633546d</span>3d75199e202d66ac56bca7e4c387bb<span class="hljs-number">453 127.0</span>.<span class="hljs-number">0.1:8002</span>@<span class="hljs-number">18002</span> slave <span class="hljs-number">145</span>b99ca42e4ddf2ad7fc43bdbc410ed<span class="hljs-number">0729e818</span> <span class="hljs-number">0</span> <span class="hljs-number">1654095164000</span> <span class="hljs-number">8</span> connected<br><br></code></pre></td></tr></table></figure><ol start="4"><li><strong>å…³é—­æœåŠ¡ï¼šå…ˆæŸ¥çœ‹psè¿›ç¨‹ï¼Œç„¶åkillæ‰è¿›ç¨‹</strong></li></ol><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@T98899999 ~]<span class="hljs-comment"># ps -ef|grep  redis-server</span><br>root    <span class="hljs-number"> 1751233 </span>     <span class="hljs-number"> 1 </span><span class="hljs-number"> 0 </span>5æœˆ26 ?       00:06:51 redis-server *:6379<br>root    <span class="hljs-number"> 2244353 </span>     <span class="hljs-number"> 1 </span><span class="hljs-number"> 0 </span>5æœˆ27 ?       00:05:55 redis-server 0.0.0.0:7001 [cluster]<br>root    <span class="hljs-number"> 2244355 </span>     <span class="hljs-number"> 1 </span><span class="hljs-number"> 0 </span>5æœˆ27 ?       00:06:00 redis-server 0.0.0.0:7002 [cluster]<br>root    <span class="hljs-number"> 2244357 </span>     <span class="hljs-number"> 1 </span><span class="hljs-number"> 0 </span>5æœˆ27 ?       00:05:56 redis-server 0.0.0.0:7003 [cluster]<br>root    <span class="hljs-number"> 2244359 </span>     <span class="hljs-number"> 1 </span><span class="hljs-number"> 0 </span>5æœˆ27 ?       00:05:53 redis-server 0.0.0.0:8001 [cluster]<br>root    <span class="hljs-number"> 2244361 </span>     <span class="hljs-number"> 1 </span><span class="hljs-number"> 0 </span>5æœˆ27 ?       00:05:53 redis-server 0.0.0.0:8002 [cluster]<br>root    <span class="hljs-number"> 2244367 </span>     <span class="hljs-number"> 1 </span><span class="hljs-number"> 0 </span>5æœˆ27 ?       00:05:56 redis-server 0.0.0.0:8003 [cluster]<br>root    <span class="hljs-number"> 2749064 </span>     <span class="hljs-number"> 1 </span><span class="hljs-number"> 0 </span>5æœˆ30 ?       00:02:17 redis-server 0.0.0.0:7004 [cluster]<br>root    <span class="hljs-number"> 3875558 </span>3762488 <span class="hljs-number"> 0 </span>22:54 pts/4    00:00:00 grep --color=auto redis-server<br>[root@T98899999 ~]<span class="hljs-comment"># kill -9 2749064</span><br><br></code></pre></td></tr></table></figure><h3 id="2ã€åˆ é™¤slaveèŠ‚ç‚¹"><a href="#2ã€åˆ é™¤slaveèŠ‚ç‚¹" class="headerlink" title="2ã€åˆ é™¤slaveèŠ‚ç‚¹"></a>2ã€åˆ é™¤slaveèŠ‚ç‚¹</h3><p><strong>åˆ é™¤ä»èŠ‚ç‚¹å°±æ¯”è¾ƒç®€å•äº†ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</strong></p><ol><li><strong>æ‰§è¡Œåˆ é™¤å‘½ä»¤</strong></li></ol><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment">#1.å‘½ä»¤</span><br>redis-cli -a password --cluster del-<span class="hljs-keyword">node</span> ip:<span class="hljs-title">prot</span> åˆ é™¤ç‚¹ID<br><span class="hljs-comment">#2.ä¾‹å­</span><br>redis-cli -a <span class="hljs-number">123456</span> --cluster del-<span class="hljs-keyword">node</span> <span class="hljs-title">127</span>.<span class="hljs-number">0.0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">7004</span> <span class="hljs-number">11</span>c3459ccdb510973ed5e61a755aaecc923405f7<br><br></code></pre></td></tr></table></figure><ol start="2"><li><strong>å…³é—­æœåŠ¡ï¼šå…ˆæŸ¥çœ‹ps -ef|grep redis-serverï¼Œç„¶åæ‰§è¡Œkillå‘½ä»¤ã€‚</strong></li></ol>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤šæ¬¾è§†é¢‘ APP æºç ï¼ˆå‰ç«¯+åç«¯ï¼‰æ‰“åŒ…å‡ºå”®</title>
    <link href="/article/d06cc010.html"/>
    <url>/article/d06cc010.html</url>
    
    <content type="html"><![CDATA[<h2 id="è§†é¢‘-APP-æºç ï¼ˆå‰ç«¯-åç«¯ï¼‰æ‰“åŒ…"><a href="#è§†é¢‘-APP-æºç ï¼ˆå‰ç«¯-åç«¯ï¼‰æ‰“åŒ…" class="headerlink" title="è§†é¢‘ APP æºç ï¼ˆå‰ç«¯+åç«¯ï¼‰æ‰“åŒ…"></a>è§†é¢‘ APP æºç ï¼ˆå‰ç«¯+åç«¯ï¼‰æ‰“åŒ…</h2><p class="note note-error">è¿™äº›æºç æ˜¯æœ¬äººç½‘ç»œæ”¶é›†åˆ°çš„ï¼Œå®å±ä¸æ˜“ï¼Œä¸è¿‡å¼€æºçš„ä¸œè¥¿éƒ½æ˜¯å…è´¹çš„ï¼Œæˆ‘ä¹Ÿä¸æ”¶è´¹ï¼Œæºç å…è´¹ï¼Œä½†æ˜¯ç¯å¢ƒæ­å»ºå’Œç–‘éš¾è§£ç­”æ”¶è´¹ï¼Œå¦‚æœè‡ªå·±åŠ¨æ‰‹èƒ½åŠ›å¼ºå¯ä»¥å…è´¹é€æºç ã€‚ç–‘éš¾è§£ç­”æ¯ä¸ª APP10 å…ƒï¼Œéœ€è¦çš„+V:fyyy566</p><h2 id="ç»¿è±†è§†é¢‘ï¼ˆAS-PHPï¼‰"><a href="#ç»¿è±†è§†é¢‘ï¼ˆAS-PHPï¼‰" class="headerlink" title="ç»¿è±†è§†é¢‘ï¼ˆAS+PHPï¼‰"></a>ç»¿è±†è§†é¢‘ï¼ˆAS+PHPï¼‰</h2><p class="note note-primary">å‰åç«¯æºç éƒ½æœ‰ï¼Œè¿˜æœ‰ä¸€æ¬¾æ”¹ç‰ˆ+äº†èšåˆç›´æ’­ï¼ˆä½ æ‡‚çš„ç›´æ’­èšåˆï¼‰è¿™ä¸ªå•ç‹¬ä»˜è´¹ 5 å…ƒã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/6b618c2993684403b26bfb3ccf6154200336394f7cc429d4bf1cd9077c2418e5.png" alt="å›¾ 2">  </p><h2 id="ç‘ä¸°èåœè§†é¢‘ï¼ˆAS-PHPï¼‰"><a href="#ç‘ä¸°èåœè§†é¢‘ï¼ˆAS-PHPï¼‰" class="headerlink" title="ç‘ä¸°èåœè§†é¢‘ï¼ˆAS+PHPï¼‰"></a>ç‘ä¸°èåœè§†é¢‘ï¼ˆAS+PHPï¼‰</h2><p class="note note-primary">ä¸çŸ¥é“ç»¿è±†å’Œèåœè°å…ˆå‡ºçš„ï¼ŒåŸºç¡€ä»£ç ä¸€æ¨¡ä¸€æ ·ï¼Œåå°é€šç”¨ï¼Œä¸‰å¥—æ ·å¼</p><p><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/3ddd92ed3901924c44bcc4cde53aeb1aef9e6b43ac1e5d6bddfab0d35d88c0ae.png" alt="å›¾ 1">  </p><h2 id="ä¹æª¬-TV-AS-PHP"><a href="#ä¹æª¬-TV-AS-PHP" class="headerlink" title="ä¹æª¬ TV(AS+PHP)"></a>ä¹æª¬ TV(AS+PHP)</h2><p class="note note-primary">bug å¤šï¼Œè‡ªå·±ä¿®å¤äº†ä¸€äº›ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å®Œç¾</p><p><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/ae421587d74b924ef21f7b6f272c3478e47ca3c937add785e2e10f655377489e.png" alt="å›¾ 3">  </p><h2 id="ç¥é©¬-TVï¼ˆAS-PHP-æ˜“å¦‚æ„ï¼‰"><a href="#ç¥é©¬-TVï¼ˆAS-PHP-æ˜“å¦‚æ„ï¼‰" class="headerlink" title="ç¥é©¬ TVï¼ˆAS+PHP+æ˜“å¦‚æ„ï¼‰"></a>ç¥é©¬ TVï¼ˆAS+PHP+æ˜“å¦‚æ„ï¼‰</h2><p class="note note-primary">github æœ‰æœ€åŸºç¡€çš„å¼€æºç‰ˆæœ¬å—ï¼Œå¯¹æ¥åŸç”Ÿè‹¹æœ CMS, ä¹Ÿæœ‰ä¸€æ¬¾ 5.4 çš„ä¼˜åŒ–çš„ AS æºç </p><p><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/1f749d9dcbd1dce3f54a238021e255cbf46da77220264a22a0aae5006ecf0a9e.png" alt="å›¾ 4">  </p><h2 id="éª¡é©¬-TV-php-å®‰å“æ— å£³ï¼‰"><a href="#éª¡é©¬-TV-php-å®‰å“æ— å£³ï¼‰" class="headerlink" title="éª¡é©¬ TV(php+å®‰å“æ— å£³ï¼‰"></a>éª¡é©¬ TV(php+å®‰å“æ— å£³ï¼‰</h2><p class="note note-primary">ç¥é©¬å’Œéª†é©¼æ‚äº¤çš„ä¸€æ¬¾ï¼Œåªæœ‰å®‰å“å£³ï¼Œæ²¡æœ‰ AS æºç </p><p><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/5a2398a1e1472bfebb8dd0d406f039b779150d42dbde1ed60d0dfe7efb481ea5.png" alt="å›¾ 5">  </p><h2 id="éª†é©¼ç›´æ’­ï¼ˆAS-PHP-æ— å£³-APPï¼‰"><a href="#éª†é©¼ç›´æ’­ï¼ˆAS-PHP-æ— å£³-APPï¼‰" class="headerlink" title="éª†é©¼ç›´æ’­ï¼ˆAS+PHP+æ— å£³ APPï¼‰"></a>éª†é©¼ç›´æ’­ï¼ˆAS+PHP+æ— å£³ APPï¼‰</h2><p class="note note-primary">ä¸€æ¬¾ç›´æ’­ APPï¼Œæœ‰å¼€å‘ç‰ˆæœ¬æºç ï¼Œå¾ˆè€çš„ï¼Œä¸è¿‡èƒ½ç”¨ï¼Œå¯¹æ¥çš„æ˜¯è€ç‰ˆæœ¬çš„ PHP æºç ï¼Œè¿˜æœ‰ä¸€æ¬¾ EZ é­”æ”¹çš„åå°+æ— å£³çš„ APP</p><p><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/60f57af8bb55f67b796746730b376eb95436a9a0037dae58f1f973074528192c.png" alt="å›¾ 7">  </p><h2 id="TV-BOX-AS"><a href="#TV-BOX-AS" class="headerlink" title="TV_BOX(AS)"></a>TV_BOX(AS)</h2><p class="note note-primary">å¼€æºçš„æºç ï¼Œç¨³å®šæ¥å£æ¸ é“åˆ†äº« 5 å…ƒ</p><p><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/5c8ed4e6f9b1bb5cfca737db0cbc45f838c16b64d8007b487806654042a09964.png" alt="å›¾ 6">  </p><p style="font-size:30px;color:red">50 å…ƒæ‰€æœ‰æ‰“åŒ…ï¼Œå¸®åŠ©æ­å»ºï¼Œ+TV è½¯ä»¶ç½‘ç«™åˆ†äº«ï¼Œ+m3u8 ç›´æ’­æºåˆ†äº«100 å…ƒä»¥ä¸ŠåŠŸèƒ½+æ¥å—å®šåˆ¶å¼€å‘ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å½±è§†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è§†é¢‘ APP</tag>
      
      <tag>CMS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IDEAæ— æ³•å¯¼å…¥javaåŸºç¡€åŒ…çš„é—®é¢˜</title>
    <link href="/article/c7f64ee6.html"/>
    <url>/article/c7f64ee6.html</url>
    
    <content type="html"><![CDATA[<h2 id="IDEAæ— æ³•å¯¼å…¥javaåŸºç¡€åŒ…çš„é—®é¢˜"><a href="#IDEAæ— æ³•å¯¼å…¥javaåŸºç¡€åŒ…çš„é—®é¢˜" class="headerlink" title="IDEAæ— æ³•å¯¼å…¥javaåŸºç¡€åŒ…çš„é—®é¢˜"></a>IDEAæ— æ³•å¯¼å…¥javaåŸºç¡€åŒ…çš„é—®é¢˜</h2><p>ä»Šå¤©ç”¨IDEAæ™ºèƒ½å¯¼åŒ…å‘ç°Mapå…³è”å‡ºæ¥çš„åŒ…ä¸æ˜¯java.utilä¸‹é¢ã€‚ç™¾åº¦å¥½ä¹…å‘ç°äº†ç­”æ¡ˆ</p><p>  ä¹‹å‰æœ‰ä¸€æ®µæ—¶é—´åœ¨ä½¿ç”¨IDEAçš„æ—¶å€™ï¼Œå‘ç°é€šè¿‡å¿«æ·é”®Alt + Enterå¯¼å…¥å¹¶æ²¡æœ‰æç¤ºæœ‰java.util.Dateçš„åŒ…ï¼Œä»…ä»…åªæœ‰java.sql.Dateçš„åŒ…ã€‚äºæ˜¯æ¯æ¬¡ä½¿ç”¨éƒ½éœ€è¦é€šè¿‡æ‰‹å†™import java.util.Date;æ¥è¿›è¡Œå¯¼åŒ…ã€‚åšä¸»åœ¨å¥½ç”Ÿä¸çˆ½äº†ä¸€æ®µæ—¶é—´åï¼Œç»ˆäºåœ¨ç½‘ä¸Šæ‰¾åˆ°äº†è§£å†³åŠæ³•ï¼Œæœ¬æ–‡å°±æ˜¯ç”¨æ¥è®°å½•ä¸€ä¸‹è§£å†³è¿‡ç¨‹çš„ã€‚<br>  <img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/ce44dbcdfe5af996f11cc4562cba666fca790740442bafebeba9a975ae7196f6.png" alt="å›¾ 1">  </p><p> æ‰¾åˆ°è®¾ç½®ï¼ˆAlt + Shift + Sï¼‰ï¼Œæœç´¢â€œAuto Importâ€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåªéœ€è¦æŠŠjava.util.Dateå¯¼å…¥æç¤ºçš„æ’é™¤è®¾ç½®åˆ é™¤å³å¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/f349b7d8e48ae0fb3f16809ffa24dd030c7e02b1b4a9927b76d7ba9d70ccf617.png" alt="å›¾ 2">  </p><p>åŒç†ï¼Œå› ä¸ºä¸€èˆ¬é¡¹ç›®ä¸­å¾ˆå°‘ä½¿ç”¨å¾—åˆ°java.sql.Dateï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ·»åŠ è¿™ä¹ˆä¸€æ¡è®¾ç½®ï¼Œç”¨äºæ’é™¤java.sql.Dateçš„å¯¼å…¥æç¤ºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDEA</tag>
      
      <tag>JAVA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æˆ‘ç»å†çš„æŠ€æœ¯æ¶æ„è½¬å˜</title>
    <link href="/article/20083f70.html"/>
    <url>/article/20083f70.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><h2 id="å¤§å­¦æ—¶ä»£"><a href="#å¤§å­¦æ—¶ä»£" class="headerlink" title="å¤§å­¦æ—¶ä»£"></a>å¤§å­¦æ—¶ä»£</h2><p class="note note-primary">åªæœ‰æ¯•ä¸šäº†æ‰ä¼šæ€€å¿µé‚£äº›ç¾å¥½çš„å­¦ç”Ÿæ—¶ä»£</p><p>å¤§å­¦è®¡ç®—æœºä¸“ä¸šå…¥é—¨è¯¾ç¨‹åº”è¯¥å°±æ˜¯<code>Cè¯­è¨€</code>,åæ¥å­¦ä¹ äº†<code>JAVA</code>ï¼Œä»æ­¤å¼€å¯äº†æ’¸ç ï¼Œå¤§ä¸‰åº”è¯¥æ‰å¼€å§‹æœ‰æ­£è§„çš„ç¼–ç¨‹è¯¾ï¼Œè€å¸ˆç»™æˆ‘ä»¬ä»‹ç»äº†ä¸€äº›æŠ€æœ¯çŸ¥è¯†ï¼Œç„¶åå¸¦ç€æˆ‘ä»¬åšäº›å°DEMOï¼Œå½“æ—¶çš„æŠ€æœ¯æ ˆåº”è¯¥æ˜¯ç”¨äº†<code>Spring+Hibernate+Struts2</code>æ¡†æ¶ã€‚</p><h2 id="èœé¸Ÿæ—¶ä»£"><a href="#èœé¸Ÿæ—¶ä»£" class="headerlink" title="èœé¸Ÿæ—¶ä»£"></a>èœé¸Ÿæ—¶ä»£</h2><p class="note note-primary">é‚£äº›è®©ä½ ç—›è‹¦çš„æ‰ä¼šè®©ä½ æˆé•¿</p><p>æ¯•ä¸šä»¥åç¬¬ä¸€æ¬¡é¢è¯•ç«Ÿç„¶è¢«æ— æƒ…passæ‰äº†ï¼Œå°±å½“æ—¶çœ‹æ¥åº”è¯¥æ˜¯æˆ‘çš„å…«è‚¡æ–‡æ²¡æœ‰èƒŒç†Ÿç»ƒï¼Œåæ¥è¾—è½¬æ¥åˆ°äº†ç¬¬ä¸€å®¶åˆ›ä¸šå…¬å¸ï¼Œå½“æ—¶æˆ‘ä»¬æ˜¯åœ¨ä¸€æ ‹å±…æ°‘æ¥¼é‡ŒåŠå…¬ï¼Œè€æ¿å’ŒæŠ€æœ¯æ€»ç›‘éƒ½æ˜¯å±±å¤§åšå£«ï¼Œé¡¹ç›®ç»ç†æ˜¯ç ”ç©¶ç”Ÿå‡†å¤‡è¯»åšã€‚å¾…äº†å¤§çº¦ä¸¤å¹´ï¼Œå°å…¬å¸å¥½å¤„å°±æ˜¯èƒ½å¤šå­¦ä¸œè¥¿ã€‚å‰å‰ååæ¥è§¦äº†å¥½å¤šé¡¹ç›®ï¼Œé”»ç‚¼äº†è‡ªå·±çš„èƒ½åŠ›ã€‚</p><ul><li>ç±»ä¼¼ä»“å‚¨ç®¡ç†ç³»ç»Ÿï¼š<code>Spring+Struts2+JSF(åŠ å¼ºç‰ˆçš„JSP)+JPA</code></li><li>æŸè½¦å•†å…¬ä¼—å·:<code>SSMæ¡†æ¶+jspï¼ˆé”»ç‚¼äº†è‡ªå·±å‰ç«¯èƒ½åŠ›ï¼‰</code></li><li>æŸè½¦å•†åœè½¦ä½ç³»ç»Ÿï¼š<code>SSM,VUE,nativeJS</code></li><li>è¢«å¤–åŒ…å»äº†æŸå®¶ä¸Šå¸‚å…¬å¸ï¼š<code>Dubbo+SSM</code></li></ul><h2 id="æ‘¸é±¼æ—¶ä»£"><a href="#æ‘¸é±¼æ—¶ä»£" class="headerlink" title="æ‘¸é±¼æ—¶ä»£"></a>æ‘¸é±¼æ—¶ä»£</h2><p class="note note-primary">å·å¾—æµ®ç”ŸåŠæ—¥é—²</p>ä»ç¬¬ä¸€å®¶å…¬å¸ç¦»å¼€åï¼Œæ¥åˆ°äº†ä¸€ä¸ªå’ŒHWå¤–åŒ…çš„å¤§å…¬å¸ï¼Œåœ¨è¿™é‡Œå¾…äº†å¤§çº¦ä¸€å¹´åŠå·¦å³ï¼Œè®©æˆ‘å¯¹ç¨‹åºå‘˜æœ‰äº†æ›´å¤šç†è§£ï¼Œä¸šåŠ¡æ˜¯ä¼ä¸šç”Ÿå­˜æ¥æºï¼Œ80%çš„ç¨‹åºå‘˜åœ¨åšä¸šåŠ¡ï¼Œæˆ‘æ€»è§‰å¾—è‡ªå·±æ˜¯é‚£20%ï¼Œåº”è¯¥ä¹Ÿæ˜¯ä¹‹åç¦»èŒçš„ä¸»è¦å› ç´ ã€‚é¡¹ç›®å›ºå®šï¼Œä¸€ä¸ªè€çš„é¡¹ç›®å¤šä¸ªæ¨¡å—ï¼Œä¸åœçš„å¾€ä¸Šå †æ–°çš„ä¸šåŠ¡é€»è¾‘ã€‚èƒ½ç”¨å°±è¡Œã€‚<ul><li>Aæ¨¡å—ï¼šç±»ä¼¼SSHæ¡†æ¶ï¼Œå¤§å‚è‡ªå·±å°è£…çš„ã€‚</li><li>Bæ¨¡å—ï¼šå¼€æºSpring+Struts1</li><li>Cæ¨¡å—ï¼šç±»ä¼¼SSM+dubboï¼Œå¤§å‚å°çš„</li><li>Dæ¨¡å—ï¼šåªæœ‰å‰ç«¯ç”¨çš„<code>react</code>æ¡†æ¶</li></ul><p>å¾…äº†ä¸€æ®µæ—¶é—´æƒ³å‡ºå»é¢è¯•çœ‹çœ‹ã€‚ç»“æœç°åœ¨å¤§è¡—ä¸Šå…¨æ˜¯é—®ä½ Springbootå’ŒSpringCloudçš„ï¼Œå¾…ä¸ä½äº†ï¼Œåˆè·³æ§½åˆ°ç°åœ¨è¿™å®¶å…¬å¸ï¼Œå·§äº†ã€‚åˆæ˜¯å¤–åŒ…ã€‚<br>åˆ«äººçœ¼ä¸­çš„å¤–åŒ…æ˜¯åŠ ç­ç‹—ï¼ŒèƒŒé”…ä¾ ã€‚ä¸è¿‡æˆ‘åˆ°ç°åœ¨æ„Ÿè§‰æˆ‘ä»¬äººåŠ›å¤–åŒ…è¦æ¯”ä»–ä»¬è‡ªå·±çš„å¼€å‘æ‚ é—²çš„å¤šï¼Œå¯èƒ½éƒ¨é—¨åŸå› ï¼Œæˆ‘ä»¬æ²¡æœ‰ç”Ÿäº§çš„æ“ä½œæƒé™ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¥å¸¸è¿ç»´ï¼ŒèŠ‚æ—¥å€¼ç­ä¹Ÿæ²¡æˆ‘ä»¬å•¥äº‹ã€‚å¹³å¸¸å¼€ä¼šå•¥çš„ä¹Ÿä¸æ‰¾æˆ‘ä»¬ã€‚å°±æ˜¯æ’¸ç‚¹ä»£ç ã€‚é…åˆå…¶ä»–æ¥å£äººå¯¹æ¥ä¸€ä¸‹æ•°æ®ã€‚å‡ ä¹æ²¡åŠ è¿‡ç­ã€‚ä¸»è¦æ˜¯è´Ÿè´£ç»´æŠ¤ä¸€ä¸ªå…¶ä»–éƒ¨é—¨ï¼ˆå·²è§£æ•£ï¼‰çš„ç³»ç»Ÿï¼Œè¿™ä¸ªç³»ç»Ÿå°±æ˜¯å°†å¼€æºè½¯ä»¶ç®¡ç†ï¼Œç„¶åç»™ä¸šåŠ¡éƒ¨é—¨æ¥å…¥ã€‚</p><ul><li>ç®¡æ§å°ï¼š<code>Springboot+mybatis+redis+nacos+swagger</code></li><li>ç¼“å­˜ï¼š<code>redis</code>6èŠ‚ç‚¹é›†ç¾¤</li><li>æ¶ˆæ¯ï¼š<code>amq</code>ï¼š6èŠ‚ç‚¹é›†ç¾¤</li><li>æ³¨å†Œä¸­å¿ƒï¼š<code>zk</code> 6èŠ‚ç‚¹é›†ç¾¤</li><li>é…ç½®ï¼š<code>nacos</code></li><li><code>docker</code>å®¹å™¨åŒ–ï¼Œ<code>K8S</code>ç¼–æ’</li></ul><h2 id="æ—¶ä»£"><a href="#æ—¶ä»£" class="headerlink" title="??æ—¶ä»£"></a>??æ—¶ä»£</h2><p>æ€»å¹²å¤–åŒ…ä¸æ˜¯åŠæ³•ï¼ŒåŠ ä¸Šç”Ÿæ´»ä¸Šè½¦è´·æˆ¿è´·å‹åŠ›ï¼Œè¿˜æ˜¯å¤šå­¦ç‚¹ä¸œè¥¿ã€‚ä¸‹ä¸€ä»½å·¥ä½œäº‰å–ç¨³å®šä¸‹æ¥ï¼Œæ— è®ºåšæŠ€æœ¯è¿˜æ˜¯ä¸šåŠ¡ã€‚åšæŒä¸‹æ¥éƒ½æŒºå¥½çš„ã€‚æ„Ÿè°¢ç½‘ç»œç§‘æŠ€æ—¶ä»£çš„çº¢åˆ©ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>èŠèŠ VIP è§†é¢‘è§£æçš„é‚£äº›äº‹å„¿</title>
    <link href="/article/6f6c6959.html"/>
    <url>/article/6f6c6959.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><h1 id="VIP-è§†é¢‘è§£æçš„é‚£äº›äº‹å„¿"><a href="#VIP-è§†é¢‘è§£æçš„é‚£äº›äº‹å„¿" class="headerlink" title="VIP è§†é¢‘è§£æçš„é‚£äº›äº‹å„¿"></a>VIP è§†é¢‘è§£æçš„é‚£äº›äº‹å„¿</h1><p>ç°åœ¨ï¼Œå„å¤§å®˜æ–¹å½±è§†ç«™ï¼Œä¸å¼€ä¸ªä¼šå‘˜åŸºæœ¬ä¸Šå•¥ä¹Ÿçœ‹ä¸äº†ã€‚ä¸è¿‡ä¸Šæœ‰æ”¿ç­–ä¸‹æœ‰å¯¹ç­–ï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠä¸€ä¸‹ç°åœ¨ç½‘ç»œä¸Šå…è´¹å½±è§†ç«™çš„æ•°æ®æ¥æºå’Œè§£æåŸç†ã€‚</p><h2 id="è§†é¢‘é‡‡é›†"><a href="#è§†é¢‘é‡‡é›†" class="headerlink" title="è§†é¢‘é‡‡é›†"></a>è§†é¢‘é‡‡é›†</h2><p>é‡‡é›†é¡¾åæ€ä¹‰å°±æ˜¯åˆ©ç”¨å„ç§æŠ€æœ¯ï¼Œå°†å®˜æ–¹è§†é¢‘ç«™ä¸Šçš„æ•°æ®é‡‡é›†åˆ°ä¸€å—ã€‚é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œå¹¶ä¸æ˜¯äººäººéƒ½æ˜¯å¼€å‘ï¼Œå°±ç®—æ˜¯å¼€å‘ä¹Ÿä¸ä¸€å®šä»€ä¹ˆè¯­è¨€éƒ½ä¼šï¼Œç¯å¢ƒæ­å»ºç­‰ç¯èŠ‚ä¼šè®©å¥½å¤šäººæœ›è€Œå´æ­¥ï¼Œéœ€æ±‚æ˜¯ç¬¬ä¸€ç”Ÿäº§åŠ›ï¼Œæ‰€ä»¥å¯è§†åŒ–è½¯ä»¶çš„å¼€å‘é™ä½äº†å¾ˆå¤šé—¨æ§›ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œç°åœ¨æ¯”è¾ƒå‡ºåçš„å«ç«è½¦å¤´é‡‡é›†</p><p><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/56a7c71d1c6f31e0c762b35499569b025685f3ed4e83c3ca500b386d3c2962fe.png" alt="å›¾ 1">  </p><p>å…¶å®åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨ç½‘é¡µæºæ•°æ®è§£æï¼Œè·å–æ•°æ®å®šæ—¶æ‰§è¡Œï¼Œç„¶åé‡‡é›†åˆ°æ•°æ®åº“ï¼ˆcms ä¸‹é¢ä¼šæåˆ°ï¼‰ã€‚è¿™æ ·æˆ‘ä»¬é¦–å…ˆå°±è·å–åˆ°äº†æ‰€æœ‰çš„è§†é¢‘æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¹¶ä¸èƒ½é‡‡é›†åˆ°çœŸæ­£çš„è§†é¢‘é“¾æ¥ï¼Œè·å–åˆ°çš„éƒ½æ˜¯è§†é¢‘æ’­æ”¾é¡µé¢çš„é“¾æ¥ï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°±è¦å»è§£æé¡µé¢è§†é¢‘å•¦ï¼</p><h2 id="è§†é¢‘è§£æ"><a href="#è§†é¢‘è§£æ" class="headerlink" title="è§†é¢‘è§£æ"></a>è§†é¢‘è§£æ</h2><p>è§†é¢‘è§£ææ˜¯æ•´ä¸ªæµç¨‹ä¸­æœ€é‡è¦çš„ç¯èŠ‚ï¼Œèƒ½è§£æåˆ°çœŸæ­£çš„è§†é¢‘é“¾æ¥æ‰èƒ½æ‹¿åˆ°å„ä¸ªåº”ç”¨å†…æ’­æ”¾ã€‚ä¸Šé¢æåˆ°æˆ‘ä»¬é‡‡é›†åˆ°çš„æ˜¯è§†é¢‘æ’­æ”¾é¡µé¢çš„é“¾æ¥ï¼Œå…¶å®æœ‰äº†è¿™ä¸ªé“¾æ¥ä¹Ÿå°±èƒ½é€šè¿‡æ•°æ®è§£æï¼Œå“åº”æ‹¦æˆªï¼Œè§†é¢‘å—…æ¢ç­‰è·å–åˆ°è§†é¢‘çœŸæ­£é“¾æ¥ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ²¡æœ‰ä¼šå‘˜ï¼Œèƒ½è®¿é—®çš„èµ„æºä¹Ÿæ˜¯å…è´¹è§†é¢‘ï¼Œä¼šå‘˜è§†é¢‘æ˜¯æ²¡æœ‰æƒé™çš„ã€‚æ‰€ä»¥ç°åœ¨è§†é¢‘ä¸Šçš„ VIP è§†é¢‘è§£æï¼Œ<strong>ä¸€è§£</strong>çš„åŸç†å°±æ˜¯ï¼Œç”¨ä¼šå‘˜è´¦å·çš„ cookie å»è®¿é—®è§†é¢‘æ•°æ®è·å–åˆ°è§†é¢‘é“¾æ¥ï¼Œæ‰€ä»¥ä½ å¾—ç°æœ‰ä¸€ä¸ª VIP å“ˆå“ˆå“ˆå“ˆå“ˆï¼Œä¸è¿‡ç°åœ¨å¾ˆå¤šè§†é¢‘è§£æç½‘ç«™éƒ½æ˜¯å°è£…çš„ä¸€è§£ï¼Œç§°ä½œ<strong>äºŒè§£</strong>ç”šè‡³æ˜¯ä¸‰ï¼Œå››ï¼Œäº”ã€‚N å±‚åµŒå¥—ã€‚æ–‡ç« æœ«å°¾ä¼šç»™å¤§å®¶é€ç¦åˆ©çš„å“ˆå“ˆã€‚æœ‰äº†è§†é¢‘æ•°æ®æˆ‘ä»¬å°±å¯ä»¥æŠŠä»–æ‹¿åˆ°å„ç§åº”ç”¨ä¸Šå»å±•ç¤ºï¼Œå°±æœ‰äº†å„å¼å„æ ·çš„è§†é¢‘ç«™ï¼ŒAPPã€‚</p><h2 id="è§†é¢‘åº”ç”¨"><a href="#è§†é¢‘åº”ç”¨" class="headerlink" title="è§†é¢‘åº”ç”¨"></a>è§†é¢‘åº”ç”¨</h2><ol><li>å½±è§†ç«™ï¼šç°åœ¨ç½‘ä¸Šæœ‰å¤§å¤§å°å°çš„å½±è§†ç«™ï¼Œä¸€ä¸ªå½±è§†ç«™ï¼Œä»å‰ç«¯é¡µé¢åˆ°åå°ç®¡ç†ï¼Œä¸ªäººå¼€å‘å°‘è¯´ä¹Ÿè¦å‡ ä¸ªæœˆçš„å‘¨æœŸï¼Œé‚£ç°åœ¨è¿™ä¹ˆå¤šå½±è§†ç«™æ€ä¹ˆæ¥çš„å‘¢ï¼Œå¤§å¤šéƒ½æ˜¯æ¨¡æ¿åˆ›å»ºçš„ï¼Œä¸åŒä¸»é¢˜è€Œå·²ã€‚æ¯”è¾ƒå‡ºåçš„å‡ ä¸ªå»ºç«™æ¨¡æ¿ï¼Œè‹¹æœ CMS, æµ·æ´‹ CMSï¼Œæˆ‘è®°å¾—æˆ‘åˆšç©ç½‘ç»œæ—¶å°±å¬è¯´è¿‡æµ·æ´‹ CMSï¼Œåˆ°ç°åœ¨ç®—æ¥ä¹Ÿæœ‰ 10 å¤šå¹´äº†ï¼Œåªä¸è¿‡å½“æ—¶é‡‡é›†çš„ä¸æ˜¯æ­£è§„è§†é¢‘ã€‚æ€è·¯å°±æ˜¯ï¼Œå°†é‡‡é›†çš„è§†é¢‘ä¿å­˜æ•°æ®åº“ï¼Œæœ‰ä¸ªç®¡ç†é¡µé¢ï¼Œå‰ç«¯æ¥å£å¯¹æ¥ã€‚</li><li>APP: ä»ç°åœ¨æ¥è§¦è¿‡å’Œäº†è§£è¿‡çš„å¤§å¤šéƒ½è¿˜æ˜¯å¯¹æ¥ CMS ä¸»é¢˜ç«™çš„æ¥å£ï¼Œæ¯”è¾ƒå‡ºåçš„æœ‰ç¥é©¬å£³ 293ï¼Œéª¡é©¬å£³ï¼ˆç¥é©¬å’Œéª†é©¼ç›´æ’­æ‚äº¤çš„ï¼‰ï¼Œä¹æª¬ã€‚æœ€è¿‘æ¯”è¾ƒç«çš„åº”è¯¥æ˜¯çŒ« TV çš„å¼€æºç‰ˆ TV-BOXï¼ŒåŸºäºå—…æ¢ï¼Œè§£æçš„ä¸€æ¬¾äº§å“ã€‚åœ¨æ­¤æ€è·¯ä¸Šè¡ç”Ÿçš„ biubiuã€‚</li></ol><h2 id="é˜…è¯»ç¦åˆ©"><a href="#é˜…è¯»ç¦åˆ©" class="headerlink" title="é˜…è¯»ç¦åˆ©"></a>é˜…è¯»ç¦åˆ©</h2><h3 id="VIP-è§†é¢‘åœ¨çº¿è§£æ"><a href="#VIP-è§†é¢‘åœ¨çº¿è§£æ" class="headerlink" title="VIP è§†é¢‘åœ¨çº¿è§£æ"></a>VIP è§†é¢‘åœ¨çº¿è§£æ</h3><div class="note note-info">            <ol><li><a href="http://tv.wandhi.com/go.html">http://tv.wandhi.com/go.html</a></li><li><a href="http://www.ikukk.com/">http://www.ikukk.com/</a></li></ol>          </div><h3 id="å½±è§†ç«™"><a href="#å½±è§†ç«™" class="headerlink" title="å½±è§†ç«™"></a>å½±è§†ç«™</h3><div class="note note-info">            <ol><li><a href="https://www.52bdys.com/">https://www.52bdys.com/</a></li><li>å…¶ä»–çš„å°ç½‘ç«™å¯ä»¥è‡ªå·±ç™¾åº¦æœç´¢ç”µå½±å+â€œåœ¨çº¿å…è´¹è§‚çœ‹â€ eg:â€åº†ä½™å¹´åœ¨çº¿å…è´¹è§‚çœ‹â€ï¼Œæœç´¢éšä¾¿ç‚¹ä¸€ä¸ªé“¾æ¥èƒ½è§‚çœ‹çš„æ¦‚ç‡ 90%å§ã€‚</li></ol>          </div><h3 id="APP"><a href="#APP" class="headerlink" title="APP"></a>APP</h3><div class="note note-info">            <p>åˆ†äº«å‡ ä¸ª APP ç½‘ç«™</p><ol><li><a href="https://fsylr.com/tv">https://fsylr.com/tv</a></li><li><a href="https://www.sharerw.com/a/ziyuan/">https://www.sharerw.com/a/ziyuan/</a></li><li><a href="https://www.fenxm.com/tv">https://www.fenxm.com/tv</a></li></ol>          </div>]]></content>
    
    
    <categories>
      
      <category>å½±è§†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CMS</tag>
      
      <tag>è§†é¢‘è§£æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo æ­å»º+è‡ªåŠ¨éƒ¨ç½²+å¼€å‘</title>
    <link href="/article/c208d6fa.html"/>
    <url>/article/c208d6fa.html</url>
    
    <content type="html"><![CDATA[<!-- toc --><h2 id="hexo-æ­å»º"><a href="#hexo-æ­å»º" class="headerlink" title="hexo æ­å»º"></a>hexo æ­å»º</h2><h3 id="å®‰è£…-nodeJs"><a href="#å®‰è£…-nodeJs" class="headerlink" title="å®‰è£… nodeJs"></a>å®‰è£… nodeJs</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">1. ä¸‹è½½å®‰è£… nodejs<br>2. è®¾ç½®æ·˜å®é•œåƒï¼š npm<span class="hljs-built_in"> config </span><span class="hljs-built_in">set</span> <span class="hljs-attribute">registry</span>=https://registry.npm.taobao.org<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…-hexo"><a href="#å®‰è£…-hexo" class="headerlink" title="å®‰è£… hexo"></a>å®‰è£… hexo</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> å®‰è£… hexo npm install -g hexo-cli <br><span class="hljs-bullet">2.</span> hexo init &quot;ç›®å½•å&quot;<br><span class="hljs-bullet">3.</span> hexo g ï¼ˆå¼€å‘é…ç½®æ—¶å…ˆæ‰§è¡Œä¸‹ hexo clean æ“ä½œï¼‰<br><span class="hljs-bullet">4.</span> hexo s  è®¿é—® http://localhost:4000<br></code></pre></td></tr></table></figure><h2 id="hexo-éƒ¨ç½²-Github"><a href="#hexo-éƒ¨ç½²-Github" class="headerlink" title="hexo éƒ¨ç½² Github"></a>hexo éƒ¨ç½² Github</h2><p>###åˆ›å»ºå¯†é’¥å¯¹<br>ä¸ºäº†æ–¹ä¾¿è¿è¡Œ GitHub Actions æ—¶ç™»å½• GitHub è´¦å·ï¼Œæˆ‘ä»¬ä½¿ç”¨ SSH æ–¹å¼ç™»å½•ã€‚å°±æ˜¯è¦æŠŠè®¾å¤‡çš„ç§é’¥äº¤ç»™ GitHub Actionsï¼Œå…¬é’¥äº¤ç»™ GitHubï¼Œéœ€è¦å» Settings é‡Œå»é…ç½®ã€‚</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs excel">ssh-keygen -<span class="hljs-built_in">t</span> rsa -C <span class="hljs-string">&quot;Github çš„é‚®ç®±åœ°å€&quot;</span><br>å¦‚ ssh-keygen -<span class="hljs-built_in">t</span> rsa -C <span class="hljs-string">&quot;123123123@gmail.com&quot;</span><br></code></pre></td></tr></table></figure><p>å¯†é’¥å¯¹ç”Ÿæˆåé»˜è®¤çš„ä½ç½®æ˜¯ç”¨æˆ·æ–‡ä»¶ã€‚ä»¥ windows ä¸ºä¾‹ï¼šå¯†é’¥å¯¹æ–‡ä»¶åœ¨ C:\Users\ç”¨æˆ·åé‡Œï¼Œå…¶ä¸­ Users å¯èƒ½å› ä¸ºç³»ç»ŸåŸå› æ˜¾ç¤ºçš„æ˜¯ç”¨æˆ·ã€‚è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œä¼šæœ‰ä¸€ä¸ªã€‚ssh çš„ç›®å½•ï¼Œè¿™ä¸ªé‡Œé¢å°±æ˜¯æˆ‘ä»¬çš„å¯†é’¥å¯¹ã€‚</p><p>å…¶ä¸­ id_rsa æ˜¯ç§é’¥ï¼Œid_rsa.pub æ˜¯å…¬é’¥ã€‚</p><ul><li><p>é…ç½®å…¬é’¥ï¼Œåº”è¯¥å·²ç»é…å¥½ï¼Œä¸ç„¶å¦‚ä½•ä¸Šåˆ°çš„é¡¹ç›®èµ„æºï¼Œé…ç½®è·¯å¾„ï¼šgithub ç½‘ç«™â€“&gt;Settingsâ€“&gt;SSH and GPG keys<br><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/5241d4b61bba491724687b87c1de7370772562f19384e2b337414d0a0b25640b.png" alt="å›¾ 1">  </p></li><li><p>é…ç½®ç§é’¥ï¼Œblog ç§æœ‰ä»“åº“çš„ Settings-&gt;Secrets é‡Œæ·»åŠ ç§é’¥ï¼Œåç§°ä¸º HEXO_DEPLOY_PRIVATE_KEY<br><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/424ddd690018ae4d1310bfee160d2177a345b0618d8401774f2ad0f6f613e702.png" alt="å›¾ 2"></p></li></ul><h3 id="åˆ›å»ºä»“åº“"><a href="#åˆ›å»ºä»“åº“" class="headerlink" title="åˆ›å»ºä»“åº“"></a>åˆ›å»ºä»“åº“</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">åˆ›å»ºä¸€ä¸ªå…¬æœ‰ä»“åº“ï¼Œå‘½åå¿…é¡»ä¸º username<span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.io</span> ï¼ˆusername ä¸ºè‡ªå·± GitHub è´¦å·ï¼‰<br>åˆ›å»ºä¸€ä¸ªç§æœ‰ä»“åº“ï¼Œéšæ„å‘½å ï¼ˆå°† hexo çš„æºä»£ç ä¸Šä¼ åˆ°æ­¤ä»“åº“ï¼‰<br><br></code></pre></td></tr></table></figure><h3 id="åˆ›å»º-Github-Action"><a href="#åˆ›å»º-Github-Action" class="headerlink" title="åˆ›å»º Github Action"></a>åˆ›å»º Github Action</h3><p>è¿›å…¥ä»“åº“ Actions-&gt;new workflow</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Hexo</span> <span class="hljs-string">åšå®¢æŒç»­é›†æˆ</span><br><br><span class="hljs-attr">on:</span> <br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">master</span><br>      <br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span> <br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span> <br><br>    <span class="hljs-attr">steps:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">æ£€å‡ºä»“åº“ä»£ç </span><br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@master</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">å®‰è£…</span> <span class="hljs-string">Node.js</span> <span class="hljs-number">11.</span><span class="hljs-string">x</span> <br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@master</span><br>      <span class="hljs-attr">with:</span><br>        <span class="hljs-attr">node-version:</span> <span class="hljs-string">&quot;11.x&quot;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">å®‰è£…</span> <span class="hljs-string">Hexo</span> <span class="hljs-string">ä¾èµ–</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">        npm install hexo-cli -g</span><br><span class="hljs-string">        npm install</span><br><span class="hljs-string"></span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">æ„å»º</span> <span class="hljs-string">Hexo</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">        hexo clean</span><br><span class="hljs-string">        hexo generate</span><br></code></pre></td></tr></table></figure><p>ğŸ‘†ä¸Šé¢ nodeJs ç‰ˆæœ¬éœ€è¦ä¸æœ¬åœ°å¯¹åº”<br>é…ç½®éƒ¨ç½²åˆ° Github.io ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">- name: é…ç½® Github éƒ¨ç½²ç§é’¥<br>  <span class="hljs-built_in">env</span>:<br>    HEXO_DEPLOY_PRIVATE_KEY: <span class="hljs-variable">$&#123;&#123; secrets.HEXO_DEPLOY_PRIVATE_KEY &#125;</span>&#125;<br>  run: |<br>    <span class="hljs-built_in">mkdir</span> -p ~/.ssh/<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$HEXO_DEPLOY_PRIVATE_KEY</span>&quot;</span> &gt; ~/.ssh/id_rsa<br>    <span class="hljs-built_in">chmod</span> 600 ~/.ssh/id_rsa<br>    ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts<br>    <br>- name: é…ç½® Git ä¿¡æ¯<br>  run: |<br>    git config --global user.name <span class="hljs-string">&#x27;åç§°&#x27;</span><br>    git config --global user.email <span class="hljs-string">&#x27;é‚®ç®±&#x27;</span><br><br>- name: éƒ¨ç½² Hexo åˆ° Github<br>  run: hexo deploy<br></code></pre></td></tr></table></figure><p>ä¿å­˜ä¹‹åè¿›åˆ°ç§æœ‰ä»“åº“çš„ Github Action å¯ä»¥çœ‹åˆ°ç¼–è¯‘æµç¨‹ï¼ŒæŸ¥çœ‹æ˜¯å¦è¿è¡ŒæˆåŠŸã€‚<br><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/4cddbb9da8d16a0bf29f093a0485064a1d765f5b2cbc6fa2929834039a9353c1.png" alt="å›¾ 3">  </p><h2 id="hexo-å¼€å‘"><a href="#hexo-å¼€å‘" class="headerlink" title="hexo å¼€å‘"></a>hexo å¼€å‘</h2><p>æ¨èä½¿ç”¨VSCODEå¼€å‘ï¼Œæ’ä»¶å¤šã€‚<br><img src="https://cdn.jsdelivr.net/gh/fyyCode/imageStore/acec13dcfa48b42626bbee94fbac4ea5834ea94a9e34726359cce8529b77be7a.png" alt="å›¾ 4">  </p><h2 id="hexo-ç–‘éš¾è§£ç­”"><a href="#hexo-ç–‘éš¾è§£ç­”" class="headerlink" title="hexo ç–‘éš¾è§£ç­”"></a>hexo ç–‘éš¾è§£ç­”</h2><p>æ–‡ç« å³ä¾§çš„ç›®å½•åŠŸèƒ½ä¸èƒ½è·³è½¬</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å¸è½½hexo-tocï¼Œå› ä¸ºä¼šå†²çª<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><blockquote><p><a href="https://blog.ctftools.com/2021/07/newpost-18/">https://blog.ctftools.com/2021/07/newpost-18/</a><br><a href="https://cloud.tencent.com/developer/article/1611808">https://cloud.tencent.com/developer/article/1611808</a><br><a href="https://hexo.fluid-dev.com/docs/guide/">https://hexo.fluid-dev.com/docs/guide/</a><br><a href="https://www.bilibili.com/read/cv12633102">https://www.bilibili.com/read/cv12633102</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
